/* DeoVR v-1.7.1 */
!function o(a,s,u){function l(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(c)return c(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return l(a[t][1][e]||e)},i,i.exports,o,a,s,u)}return s[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)l(u[e]);return l}({1:[function(e,i,o){(function(t){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}e.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:s.now();0<r.length;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var i=this._tweens[r[n]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[r[n]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var n,r,s=new e;s.Group=e,s._nextId=0,s.nextId=function(){return s._nextId++},"undefined"==typeof self&&void 0!==t&&t.hrtime?s.now=function(){var e=t.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?s.now=self.performance.now.bind(self.performance):void 0!==Date.now?s.now=Date.now:s.now=function(){return(new Date).getTime()},s.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=s.Easing.Linear.None,this._interpolationFunction=s.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||s,this._id=s.nextId()},s.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?s.now()+parseFloat(e):e:s.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,n;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||1<r?1:r,n=this._easingFunction(r),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,n):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?i+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=i+(o-i)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1!==r)return!0;if(0<this._repeat){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,u=this._chainedTweens.length;s<u;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}},s.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((1+t)*e-t)*.5:.5*((e-=2)*e*((1+t)*e+t)+2)}},Bounce:{In:function(e){return 1-s.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*s.Easing.Bounce.In(2*e):.5*s.Easing.Bounce.Out(2*e-1)+.5}}},s.Interpolation={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),o=s.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],n):1<t?o(e[r],e[r-1],r-n):o(e[i],e[r<i+1?r:i+1],n-i)},Bezier:function(e,t){for(var r=0,n=e.length-1,i=Math.pow,o=s.Interpolation.Utils.Bernstein,a=0;a<=n;a++)r+=i(1-t,n-a)*i(t,a)*e[a]*o(n,a);return r},CatmullRom:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),o=s.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(i=Math.floor(n=r*(1+t))),o(e[(i-1+r)%r],e[i],e[(i+1)%r],e[(i+2)%r],n-i)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-n)-e[0]):1<t?e[r]-(o(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):o(e[i?i-1:0],e[i],e[r<i+1?r:i+1],e[r<i+2?r:i+2],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=s.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(n=[1],function(e){var t=1;if(n[e])return n[e];for(var r=e;1<r;r--)t*=r;return n[e]=t}),CatmullRom:function(e,t,r,n,i){var o=.5*(r-e),a=.5*(n-t),s=i*i;return(2*t-2*r+o+a)*(i*s)+(-3*t+3*r-2*o-a)*s+o*i+t}}},r=this,"function"==typeof define&&define.amd?define([],function(){return s}):void 0!==i&&"object"==typeof o?i.exports=s:void 0!==r&&(r.TWEEN=s)}).call(this,e("_process"))},{_process:589}],2:[function(e,t,r){t.exports=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0}},{}],3:[function(r,e,t){(function(e){"use strict";if(r("core-js/shim"),r("regenerator-runtime/runtime"),r("core-js/fn/regexp/escape"),e._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");e._babelPolyfill=!0;function t(e,t,r){e[t]||Object.defineProperty(e,t,{writable:!0,configurable:!0,value:r})}t(String.prototype,"padLeft","".padStart),t(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(e){[][e]&&t(Array,e,Function.call.bind([][e]))})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"core-js/fn/regexp/escape":10,"core-js/shim":338,"regenerator-runtime/runtime":608}],4:[function(e,t,r){"use strict";r.byteLength=function(e){var t=d(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){for(var t,r=d(e),n=r[0],i=r[1],o=new c(function(e,t,r){return 3*(t+r)/4-r}(0,n,i)),a=0,s=0<i?n-4:n,u=0;u<s;u+=4)t=l[e.charCodeAt(u)]<<18|l[e.charCodeAt(u+1)]<<12|l[e.charCodeAt(u+2)]<<6|l[e.charCodeAt(u+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;2===i&&(t=l[e.charCodeAt(u)]<<2|l[e.charCodeAt(u+1)]>>4,o[a++]=255&t);1===i&&(t=l[e.charCodeAt(u)]<<10|l[e.charCodeAt(u+1)]<<4|l[e.charCodeAt(u+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t);return o},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i=[],o=0,a=r-n;o<a;o+=16383)i.push(u(e,o,a<o+16383?a:o+16383));1==n?(t=e[r-1],i.push(s[t>>2]+s[t<<4&63]+"==")):2==n&&(t=(e[r-2]<<8)+e[r-1],i.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return i.join("")};for(var s=[],l=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=n.length;i<o;++i)s[i]=n[i],l[n.charCodeAt(i)]=i;function d(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,r){for(var n,i,o=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(s[(i=n)>>18&63]+s[i>>12&63]+s[i>>6&63]+s[63&i]);return o.join("")}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],5:[function(e,t,r){},{}],6:[function(e,t,k){(function(d){"use strict";var n=e("base64-js"),o=e("ieee754");k.Buffer=d,k.SlowBuffer=function(e){+e!=e&&(e=0);return d.alloc(+e)},k.INSPECT_MAX_BYTES=50;var r=2147483647;function a(e){if(r<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=d.prototype,t}function d(e,t,r){if("number"!=typeof e)return i(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}function i(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!d.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|f(e,t),n=a(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(L(e,ArrayBuffer)||e&&L(e.buffer,ArrayBuffer))return function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=d.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return d.from(n,t,r);var i=function(e){if(d.isBuffer(e)){var t=0|c(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||N(e.length)?a(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return d.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return s(e),a(e<0?0:0|c(e))}function l(e){for(var t=e.length<0?0:0|c(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e){if(r<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function f(e,t){if(d.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||L(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return C(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return D(e).length;default:if(i)return n?-1:C(e).length;t=(""+t).toLowerCase(),i=!0}}function h(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function p(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),N(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=d.from(t,n)),d.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s/=a=2,u/=2,r/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(o=r;o<s;o++)if(l(e,o)===l(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(s<r+u&&(r=s-u),o=r;0<=o;o--){for(var d=!0,f=0;f<u;f++)if(l(e,o+f)!==l(t,f)){d=!1;break}if(d)return o}return-1}function g(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?i<(n=Number(n))&&(n=i):n=i;var o=t.length;o/2<n&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(N(s))return a;e[r+a]=s}return a}function v(e,t,r,n){return I(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function y(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function _(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,l=e[i],c=null,d=239<l?4:223<l?3:191<l?2:1;if(i+d<=r)switch(d){case 1:l<128&&(c=l);break;case 2:128==(192&(o=e[i+1]))&&127<(u=(31&l)<<6|63&o)&&(c=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&2047<(u=(15&l)<<12|(63&o)<<6|63&a)&&(u<55296||57343<u)&&(c=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)&&u<1114112&&(c=u)}null===c?(c=65533,d=1):65535<c&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=d}return function(e){var t=e.length;if(t<=b)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=b));return r}(n)}k.kMaxLength=r,(d.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(d.prototype,"parent",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.buffer}}),Object.defineProperty(d.prototype,"offset",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),d.poolSize=8192,d.from=function(e,t,r){return i(e,t,r)},d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,d.alloc=function(e,t,r){return function(e,t,r){return s(e),e<=0?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)}(e,t,r)},d.allocUnsafe=function(e){return u(e)},d.allocUnsafeSlow=function(e){return u(e)},d.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==d.prototype},d.compare=function(e,t){if(L(e,Uint8Array)&&(e=d.from(e,e.offset,e.byteLength)),L(t,Uint8Array)&&(t=d.from(t,t.offset,t.byteLength)),!d.isBuffer(e)||!d.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},d.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return d.alloc(0);var r;if(void 0===t)for(r=t=0;r<e.length;++r)t+=e[r].length;var n=d.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(L(o,Uint8Array)&&(o=d.from(o)),!d.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},d.byteLength=f,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},d.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},d.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},d.prototype.toLocaleString=d.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?_(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return A(this,t,r);case"utf8":case"utf-8":return _(this,t,r);case"ascii":return E(this,t,r);case"latin1":case"binary":return w(this,t,r);case"base64":return y(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},d.prototype.equals=function(e){if(!d.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===d.compare(this,e)},d.prototype.inspect=function(){var e="",t=k.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},d.prototype.compare=function(e,t,r,n,i){if(L(e,Uint8Array)&&(e=d.from(e,e.offset,e.byteLength)),!d.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=t)return 0;if(i<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(o,a),u=this.slice(n,i),l=e.slice(t,r),c=0;c<s;++c)if(u[c]!==l[c]){o=u[c],a=l[c];break}return o<a?-1:a<o?1:0},d.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},d.prototype.indexOf=function(e,t,r){return p(this,e,t,r,!0)},d.prototype.lastIndexOf=function(e,t,r){return p(this,e,t,r,!1)},d.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||i<r)&&(r=i),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var o,a,s,u,l,c,d,f,h,p=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return f=t,h=r,I(C(e,(d=this).length-f),d,f,h);case"ascii":return v(this,e,t,r);case"latin1":case"binary":return v(this,e,t,r);case"base64":return u=this,l=t,c=r,I(D(e),u,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=t,s=r,I(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,(o=this).length-a),o,a,s);default:if(p)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),p=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var b=4096;function E(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function w(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function A(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||n<r)&&(r=n);for(var i="",o=t;o<r;++o)i+=P(e[o]);return i}function T(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function S(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,r,n,i,o){if(!d.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function M(e,t,r,n){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function R(e,t,r,n,i){return t=+t,r>>>=0,i||M(e,0,r,4),o.write(e,t,r,n,23,4),r+4}function O(e,t,r,n,i){return t=+t,r>>>=0,i||M(e,0,r,8),o.write(e,t,r,n,52,8),r+8}d.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=d.prototype,n},d.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},d.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e+--t],i=1;0<t&&(i*=256);)n+=this[e+--t]*i;return n},d.prototype.readUInt8=function(e,t){return e>>>=0,t||S(e,1,this.length),this[e]},d.prototype.readUInt16LE=function(e,t){return e>>>=0,t||S(e,2,this.length),this[e]|this[e+1]<<8},d.prototype.readUInt16BE=function(e,t){return e>>>=0,t||S(e,2,this.length),this[e]<<8|this[e+1]},d.prototype.readUInt32LE=function(e,t){return e>>>=0,t||S(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},d.prototype.readUInt32BE=function(e,t){return e>>>=0,t||S(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},d.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*t)),n},d.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=t,i=1,o=this[e+--n];0<n&&(i*=256);)o+=this[e+--n]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*t)),o},d.prototype.readInt8=function(e,t){return e>>>=0,t||S(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},d.prototype.readInt16LE=function(e,t){e>>>=0,t||S(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},d.prototype.readInt16BE=function(e,t){e>>>=0,t||S(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},d.prototype.readInt32LE=function(e,t){return e>>>=0,t||S(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},d.prototype.readInt32BE=function(e,t){return e>>>=0,t||S(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},d.prototype.readFloatLE=function(e,t){return e>>>=0,t||S(e,4,this.length),o.read(this,e,!0,23,4)},d.prototype.readFloatBE=function(e,t){return e>>>=0,t||S(e,4,this.length),o.read(this,e,!1,23,4)},d.prototype.readDoubleLE=function(e,t){return e>>>=0,t||S(e,8,this.length),o.read(this,e,!0,52,8)},d.prototype.readDoubleBE=function(e,t){return e>>>=0,t||S(e,8,this.length),o.read(this,e,!1,52,8)},d.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||x(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},d.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||x(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;0<=--i&&(o*=256);)this[t+i]=e/o&255;return t+r},d.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,1,255,0),this[t]=255&e,t+1},d.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},d.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},d.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},d.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},d.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);x(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},d.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);x(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;0<=--o&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},d.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},d.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},d.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},d.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},d.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},d.prototype.writeFloatLE=function(e,t,r){return R(this,e,t,!0,r)},d.prototype.writeFloatBE=function(e,t,r){return R(this,e,t,!1,r)},d.prototype.writeDoubleLE=function(e,t,r){return O(this,e,t,!0,r)},d.prototype.writeDoubleBE=function(e,t,r){return O(this,e,t,!1,r)},d.prototype.copy=function(e,t,r,n){if(!d.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r=r||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),t=t||0,0<n&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var o=i-1;0<=o;--o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},d.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!d.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(o=t;o<r;++o)this[o]=e;else{var a=d.isBuffer(e)?e:d.from(e,n),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var t=/[^+/0-9A-Za-z-_]/g;function P(e){return e<16?"0"+e.toString(16):e.toString(16)}function C(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if(55295<(r=e.charCodeAt(a))&&r<57344){if(!i){if(56319<r){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===n){-1<(t-=3)&&o.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(t-=3)&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function D(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(t,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function I(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function L(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function N(e){return e!=e}}).call(this,e("buffer").Buffer)},{"base64-js":4,buffer:6,ieee754:566}],7:[function(e,t,r){var u=Object.create||function(e){function t(){}return t.prototype=e,new t},a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=u(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0;var i,s=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),i=0===l.x}catch(e){i=!1}function c(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]):(o=e._events=u(null),e._eventsCount=0),a){if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),!a.warned&&(i=c(e))&&0<i&&a.length>i){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",s.name,s.message)}}else a=o[t]=r,++e._eventsCount;return e}function f(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=o.call(f,n);return i.listener=r,n.wrapFn=i}function p(e,t,r){var n=e._events;if(!n)return[];var i=n[t];return i?"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length):[]}function m(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}i?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');s=e}}):n.defaultMaxListeners=s,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(e,t,r,n){var i,o,a,s,u,l,c="error"===e;if(l=this._events)c=c&&null==l.error;else if(!c)return!1;if(c){if(1<arguments.length&&(i=t),i instanceof Error)throw i;var d=new Error('Unhandled "error" event. ('+i+")");throw d.context=i,d}if(!(o=l[e]))return!1;var f="function"==typeof o;switch(a=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=g(e,n),o=0;o<n;++o)i[o].call(r)}(o,f,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,o=g(e,i),a=0;a<i;++a)o[a].call(r,n)}(o,f,this,t);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=e.length,a=g(e,o),s=0;s<o;++s)a[s].call(r,n,i)}(o,f,this,t,r);break;case 4:!function(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var a=e.length,s=g(e,a),u=0;u<a;++u)s[u].call(r,n,i,o)}(o,f,this,t,r,n);break;default:for(s=new Array(a-1),u=1;u<a;u++)s[u-1]=arguments[u];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,o=g(e,i),a=0;a<i;++a)o[a].apply(r,n)}(o,f,this,s)}return!0},n.prototype.on=n.prototype.addListener=function(e,t){return d(this,e,t,!1)},n.prototype.prependListener=function(e,t){return d(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h(this,e,t)),this},n.prototype.removeListener=function(e,t){var r,n,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=u(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;0<=o;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),n.removeListener&&this.emit("removeListener",e,a||t)}return this},n.prototype.removeAllListeners=function(e){var t,r,n;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=u(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=u(null):delete r[e]),this;if(0===arguments.length){var i,o=a(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=u(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(n=t.length-1;0<=n;n--)this.removeListener(e,t[n]);return this},n.prototype.listeners=function(e){return p(this,e,!0)},n.prototype.rawListeners=function(e){return p(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},n.prototype.listenerCount=m,n.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],8:[function(e,t,r){var i={parseBuffer:function(e){return new o(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(a.prototype._boxProcessors[e]=t)},createFile:function(){return new o},createBox:function(e,t,r){var n=a.create(e);return t&&t.append(n,r),n},createFullBox:function(e,t,r){var n=i.createBox(e,t,r);return n.version=0,n.flags=0,n},Utils:{}};i.Utils.dataViewToString=function(e,t){var r=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(r).decode(e);var n=[],i=0;if("utf-8"===r)for(;i<e.byteLength;){var o=e.getUint8(i++);o<128||(o<224?o=(31&o)<<6:(o<240?o=(15&o)<<12:(o=(7&o)<<18,o|=(63&e.getUint8(i++))<<12),o|=(63&e.getUint8(i++))<<6),o|=63&e.getUint8(i++)),n.push(String.fromCharCode(o))}else for(;i<e.byteLength;)n.push(String.fromCharCode(e.getUint8(i++)));return n.join("")},i.Utils.utf8ToByteArray=function(e){var t,r;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):(n<2048?t.push(192|n>>6):(n<65536?t.push(224|n>>12):(t.push(240|n>>18),t.push(128|63&n>>12)),t.push(128|63&n>>6)),t.push(128|63&n))}return t},i.Utils.appendBox=function(e,t,r){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==r)if(null!=r){var n,i=-1;if("number"==typeof r)i=r;else{if("string"==typeof r)n=r;else{if("object"!=typeof r||!r.type)return void e.boxes.push(t);n=r.type}for(var o=0;o<e.boxes.length;o++)if(n===e.boxes[o].type){i=o+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},void 0!==r&&(r.parseBuffer=i.parseBuffer,r.addBoxProcessor=i.addBoxProcessor,r.createFile=i.createFile,r.createBox=i.createBox,r.createFullBox=i.createFullBox,r.Utils=i.Utils),i.Cursor=function(e){this.offset=void 0===e?0:e};var o=function(e){this._cursor=new i.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};o.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},o.prototype.fetchAll=function(e,t){var r=[];return o._sweep.call(this,e,r,t),r},o.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=a.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},o._sweep=function(e,t,r){for(var n in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&r)return;o._sweep.call(this.boxes[n],e,t,r)}},o.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var r=new Uint8Array(t);for(this._rawo=new DataView(r.buffer),this.bytes=r,e=this._cursor.offset=0;e<this.boxes.length;e++)this.boxes[e].write();return r.buffer},o.prototype.append=function(e,t){i.Utils.appendBox(this,e,t)};var a=function(){this._cursor=new i.Cursor};a.parse=function(e){var t=new a;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},a.create=function(e){var t=new a;return t.type=e,t.boxes=[],t},a.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],a.prototype._boxProcessors={},a.prototype._procField=function(e,t,r){this._parsing?this[e]=this._readField(t,r):this._writeField(t,r,this[e])},a.prototype._procFieldArray=function(e,t,r,n){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(r,n);else for(i=0;i<this[e].length;i++)this._writeField(r,n,this[e][i])},a.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},a.prototype._procEntries=function(e,t,r){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push({}),r.call(this,this[e][n]);else for(n=0;n<t;n++)r.call(this,this[e][n])},a.prototype._procSubEntries=function(e,t,r,n){var i;if(this._parsing)for(e[t]=[],i=0;i<r;i++)e[t].push({}),n.call(this,e[t][i]);else for(i=0;i<r;i++)n.call(this,e[t][i])},a.prototype._procEntryField=function(e,t,r,n){this._parsing?e[t]=this._readField(r,n):this._writeField(r,n,e[t])},a.prototype._procSubBoxes=function(e,t){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push(a.parse(this));else for(r=0;r<t;r++)this._rawo?this[e][r].write():this.size+=this[e][r].getLength()},a.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},a.prototype._readInt=function(e){var t=null,r=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(r);break;case 16:t=this._raw.getInt16(r);break;case 32:t=this._raw.getInt32(r);break;case 64:var n=this._raw.getInt32(r),i=this._raw.getInt32(4+r);t=n*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},a.prototype._readUint=function(e){var t,r,n=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:n=this._raw.getUint8(i);break;case 16:n=this._raw.getUint16(i);break;case 24:n=((t=this._raw.getUint16(i))<<8)+(r=this._raw.getUint8(2+i));break;case 32:n=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),r=this._raw.getUint32(4+i),n=t*Math.pow(2,32)+r}return this._cursor.offset+=e>>3,n},a.prototype._readString=function(e){for(var t="",r=0;r<e;r++){var n=this._readUint(8);t+=String.fromCharCode(n)}return t},a.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},a.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},a.prototype._readData=function(e){var t=0<e?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(0<t){var r=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,r}return null},a.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return 0<e&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?i.Utils.dataViewToString(t):t},a.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},a.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},a.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(a.parse(this))},a.prototype.append=function(e,t){i.Utils.appendBox(this,e,t)},a.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},a.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},a.prototype._writeInt=function(e,t){if(this._rawo){var r=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(r,t);break;case 16:this._rawo.setInt16(r,t);break;case 32:this._rawo.setInt32(r,t);break;case 64:var n=Math.floor(t/Math.pow(2,32)),i=t-n*Math.pow(2,32);this._rawo.setUint32(r,n),this._rawo.setUint32(4+r,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},a.prototype._writeUint=function(e,t){if(this._rawo){var r,n,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:r=(16776960&t)>>8,n=255&t,this._rawo.setUint16(i,r),this._rawo.setUint8(2+i,n);break;case 32:this._rawo.setUint32(i,t);break;case 64:n=t-(r=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,r),this._rawo.setUint32(4+i,n)}this._cursor.offset+=e>>3}else this.size+=e>>3},a.prototype._writeString=function(e,t){for(var r=0;r<e;r++)this._writeUint(8,t.charCodeAt(r))},a.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},a.prototype._writeTemplate=function(e,t){var r=Math.floor(t),n=(t-r)*Math.pow(2,e/2);this._writeUint(e/2,r),this._writeUint(e/2,n)},a.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,r=0;r<e.length;r++)this._rawo.setInt8(t+r,e[r]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},a.prototype._writeUTF8String=function(e){var t=i.Utils.utf8ToByteArray(e);if(this._rawo)for(var r=new DataView(this._rawo.buffer,this._cursor.offset,t.length),n=0;n<t.length;n++)r.setUint8(n,t[n]);else this.size+=t.length},a.prototype._writeField=function(e,t,r){switch(e){case"uint":this._writeUint(t,r);break;case"int":this._writeInt(t,r);break;case"template":this._writeTemplate(t,r);break;case"string":-1==t?this._writeTerminatedString(r):this._writeString(t,r);break;case"data":this._writeData(r);break;case"utf8":this._writeUTF8String(r)}},a.prototype._boxProcessors.avc1=a.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},a.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},a.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)})},a.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},a.prototype._boxProcessors.free=a.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},a.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},a.prototype._boxProcessors.ftyp=a.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},a.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},a.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},a.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},a.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},a.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},a.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},a.prototype._boxProcessors.mp4a=a.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},a.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},a.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},a.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},a.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},a.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},a.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)})},a.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},a.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)})})},a.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},a.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)})})},a.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},a.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},a.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},a.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))})},a.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},a.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},a.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)})},a.prototype._boxProcessors["url "]=a.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},a.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},a.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},a.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},a.prototype._boxProcessors.vtte=function(){}},{}],9:[function(e,t,r){"use strict";var l=e("toggle-selection");t.exports=function(t,r){var n,i,e,o,a,s,u=!1;n=(r=r||{}).debug||!1;try{if(e=l(),o=document.createRange(),a=document.getSelection(),(s=document.createElement("span")).textContent=t,s.style.all="unset",s.style.position="fixed",s.style.top=0,s.style.clip="rect(0, 0, 0, 0)",s.style.whiteSpace="pre",s.style.webkitUserSelect="text",s.style.MozUserSelect="text",s.style.msUserSelect="text",s.style.userSelect="text",s.addEventListener("copy",function(e){e.stopPropagation(),r.format&&(e.preventDefault(),e.clipboardData.clearData(),e.clipboardData.setData(r.format,t))}),document.body.appendChild(s),o.selectNodeContents(s),a.addRange(o),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");u=!0}catch(e){n&&console.error("unable to copy using execCommand: ",e),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(r.format||"text",t),u=!0}catch(e){n&&console.error("unable to copy using clipboardData: ",e),n&&console.error("falling back to prompt"),i=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in r?r.message:"Copy to clipboard: #{key}, Enter"),window.prompt(i,t)}}finally{a&&("function"==typeof a.removeRange?a.removeRange(o):a.removeAllRanges()),s&&document.body.removeChild(s),e()}return u}},{"toggle-selection":617}],10:[function(e,t,r){e("../../modules/core.regexp.escape"),t.exports=e("../../modules/_core").RegExp.escape},{"../../modules/_core":32,"../../modules/core.regexp.escape":140}],11:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],12:[function(e,t,r){var n=e("./_cof");t.exports=function(e,t){if("number"!=typeof e&&"Number"!=n(e))throw TypeError(t);return+e}},{"./_cof":27}],13:[function(e,t,r){var n=e("./_wks")("unscopables"),i=Array.prototype;null==i[n]&&e("./_hide")(i,n,{}),t.exports=function(e){i[n][e]=!0}},{"./_hide":52,"./_wks":138}],14:[function(e,t,r){"use strict";var n=e("./_string-at")(!0);t.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},{"./_string-at":115}],15:[function(e,t,r){t.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},{}],16:[function(e,t,r){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":61}],17:[function(e,t,r){"use strict";var c=e("./_to-object"),d=e("./_to-absolute-index"),f=e("./_to-length");t.exports=[].copyWithin||function(e,t,r){var n=c(this),i=f(n.length),o=d(e,i),a=d(t,i),s=2<arguments.length?r:void 0,u=Math.min((void 0===s?i:d(s,i))-a,i-o),l=1;for(a<o&&o<a+u&&(l=-1,a+=u-1,o+=u-1);0<u--;)a in n?n[o]=n[a]:delete n[o],o+=l,a+=l;return n}},{"./_to-absolute-index":123,"./_to-length":127,"./_to-object":128}],18:[function(e,t,r){"use strict";var l=e("./_to-object"),c=e("./_to-absolute-index"),d=e("./_to-length");t.exports=function(e,t,r){for(var n=l(this),i=d(n.length),o=arguments.length,a=c(1<o?t:void 0,i),s=2<o?r:void 0,u=void 0===s?i:c(s,i);a<u;)n[a++]=e;return n}},{"./_to-absolute-index":123,"./_to-length":127,"./_to-object":128}],19:[function(e,t,r){var n=e("./_for-of");t.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},{"./_for-of":48}],20:[function(e,t,r){var u=e("./_to-iobject"),l=e("./_to-length"),c=e("./_to-absolute-index");t.exports=function(s){return function(e,t,r){var n,i=u(e),o=l(i.length),a=c(r,o);if(s&&t!=t){for(;a<o;)if((n=i[a++])!=n)return!0}else for(;a<o;a++)if((s||a in i)&&i[a]===t)return s||a||0;return!s&&-1}}},{"./_to-absolute-index":123,"./_to-iobject":126,"./_to-length":127}],21:[function(e,t,r){var _=e("./_ctx"),b=e("./_iobject"),E=e("./_to-object"),w=e("./_to-length"),n=e("./_array-species-create");t.exports=function(d,e){var f=1==d,h=2==d,p=3==d,m=4==d,g=6==d,v=5==d||g,y=e||n;return function(e,t,r){for(var n,i,o=E(e),a=b(o),s=_(t,r,3),u=w(a.length),l=0,c=f?y(e,u):h?y(e,0):void 0;l<u;l++)if((v||l in a)&&(i=s(n=a[l],l,o),d))if(f)c[l]=i;else if(i)switch(d){case 3:return!0;case 5:return n;case 6:return l;case 2:c.push(n)}else if(m)return!1;return g?-1:p||m?m:c}}},{"./_array-species-create":24,"./_ctx":34,"./_iobject":57,"./_to-length":127,"./_to-object":128}],22:[function(e,t,r){var c=e("./_a-function"),d=e("./_to-object"),f=e("./_iobject"),h=e("./_to-length");t.exports=function(e,t,r,n,i){c(t);var o=d(e),a=f(o),s=h(o.length),u=i?s-1:0,l=i?-1:1;if(r<2)for(;;){if(u in a){n=a[u],u+=l;break}if(u+=l,i?u<0:s<=u)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=u:u<s;u+=l)u in a&&(n=t(n,a[u],u,o));return n}},{"./_a-function":11,"./_iobject":57,"./_to-length":127,"./_to-object":128}],23:[function(e,t,r){var n=e("./_is-object"),i=e("./_is-array"),o=e("./_wks")("species");t.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":59,"./_is-object":61,"./_wks":138}],24:[function(e,t,r){var n=e("./_array-species-constructor");t.exports=function(e,t){return new(n(e))(t)}},{"./_array-species-constructor":23}],25:[function(e,t,r){"use strict";var o=e("./_a-function"),a=e("./_is-object"),s=e("./_invoke"),u=[].slice,l={};t.exports=Function.bind||function(t){var r=o(this),n=u.call(arguments,1),i=function(){var e=n.concat(u.call(arguments));return this instanceof i?function(e,t,r){if(!(t in l)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";l[t]=Function("F,a","return new F("+n.join(",")+")")}return l[t](e,r)}(r,e.length,e):s(r,e,t)};return a(r.prototype)&&(i.prototype=r.prototype),i}},{"./_a-function":11,"./_invoke":56,"./_is-object":61}],26:[function(e,t,r){var i=e("./_cof"),o=e("./_wks")("toStringTag"),a="Arguments"==i(function(){return arguments}());t.exports=function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?r:a?i(t):"Object"==(n=i(t))&&"function"==typeof t.callee?"Arguments":n}},{"./_cof":27,"./_wks":138}],27:[function(e,t,r){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],28:[function(e,t,r){"use strict";function a(e,t){var r,n=p(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r}var s=e("./_object-dp").f,u=e("./_object-create"),l=e("./_redefine-all"),c=e("./_ctx"),d=e("./_an-instance"),f=e("./_for-of"),n=e("./_iter-define"),i=e("./_iter-step"),o=e("./_set-species"),h=e("./_descriptors"),p=e("./_meta").fastKey,m=e("./_validate-collection"),g=h?"_s":"size";t.exports={getConstructor:function(e,o,r,n){var i=e(function(e,t){d(e,i,o,"_i"),e._t=o,e._i=u(null),e._f=void 0,e._l=void 0,e[g]=0,null!=t&&f(t,r,e[n],e)});return l(i.prototype,{clear:function(){for(var e=m(this,o),t=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete t[r.i];e._f=e._l=void 0,e[g]=0},delete:function(e){var t=m(this,o),r=a(t,e);if(r){var n=r.n,i=r.p;delete t._i[r.i],r.r=!0,i&&(i.n=n),n&&(n.p=i),t._f==r&&(t._f=n),t._l==r&&(t._l=i),t[g]--}return!!r},forEach:function(e,t){m(this,o);for(var r,n=c(e,1<arguments.length?t:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!a(m(this,o),e)}}),h&&s(i.prototype,"size",{get:function(){return m(this,o)[g]}}),i},def:function(e,t,r){var n,i,o=a(e,t);return o?o.v=r:(e._l=o={i:i=p(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[g]++,"F"!==i&&(e._i[i]=o)),e},getEntry:a,setStrong:function(e,r,t){n(e,r,function(e,t){this._t=m(e,r),this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,r=e._l;r&&r.r;)r=r.p;return e._t&&(e._l=r=r?r.n:e._t._f)?i(0,"keys"==t?r.k:"values"==t?r.v:[r.k,r.v]):(e._t=void 0,i(1))},t?"entries":"values",!t,!0),o(r)}}},{"./_an-instance":15,"./_ctx":34,"./_descriptors":38,"./_for-of":48,"./_iter-define":65,"./_iter-step":67,"./_meta":75,"./_object-create":80,"./_object-dp":81,"./_redefine-all":100,"./_set-species":109,"./_validate-collection":135}],29:[function(e,t,r){var n=e("./_classof"),i=e("./_array-from-iterable");t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},{"./_array-from-iterable":19,"./_classof":26}],30:[function(e,t,r){"use strict";function a(e){return e._l||(e._l=new v)}function n(e,t){return p(e.a,function(e){return e[0]===t})}var s=e("./_redefine-all"),u=e("./_meta").getWeak,i=e("./_an-object"),l=e("./_is-object"),c=e("./_an-instance"),d=e("./_for-of"),o=e("./_array-methods"),f=e("./_has"),h=e("./_validate-collection"),p=o(5),m=o(6),g=0,v=function(){this.a=[]};v.prototype={get:function(e){var t=n(this,e);if(t)return t[1]},has:function(e){return!!n(this,e)},set:function(e,t){var r=n(this,e);r?r[1]=t:this.a.push([e,t])},delete:function(t){var e=m(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(e,r,n,i){var o=e(function(e,t){c(e,o,r,"_i"),e._t=r,e._i=g++,e._l=void 0,null!=t&&d(t,n,e[i],e)});return s(o.prototype,{delete:function(e){if(!l(e))return!1;var t=u(e);return!0===t?a(h(this,r)).delete(e):t&&f(t,this._i)&&delete t[this._i]},has:function(e){if(!l(e))return!1;var t=u(e);return!0===t?a(h(this,r)).has(e):t&&f(t,this._i)}}),o},def:function(e,t,r){var n=u(i(t),!0);return!0===n?a(e).set(t,r):n[e._i]=r,e},ufstore:a}},{"./_an-instance":15,"./_an-object":16,"./_array-methods":21,"./_for-of":48,"./_has":51,"./_is-object":61,"./_meta":75,"./_redefine-all":100,"./_validate-collection":135}],31:[function(e,t,r){"use strict";var v=e("./_global"),y=e("./_export"),_=e("./_redefine"),b=e("./_redefine-all"),E=e("./_meta"),w=e("./_for-of"),A=e("./_an-instance"),T=e("./_is-object"),S=e("./_fails"),x=e("./_iter-detect"),M=e("./_set-to-string-tag"),R=e("./_inherit-if-required");t.exports=function(n,e,t,r,i,o){function a(e){var r=c[e];_(c,e,"delete"==e?function(e){return!(o&&!T(e))&&r.call(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!T(e))&&r.call(this,0===e?0:e)}:"get"==e?function(e){return o&&!T(e)?void 0:r.call(this,0===e?0:e)}:"add"==e?function(e){return r.call(this,0===e?0:e),this}:function(e,t){return r.call(this,0===e?0:e,t),this})}var s=v[n],u=s,l=i?"set":"add",c=u&&u.prototype,d={};if("function"==typeof u&&(o||c.forEach&&!S(function(){(new u).entries().next()}))){var f=new u,h=f[l](o?{}:-0,1)!=f,p=S(function(){f.has(1)}),m=x(function(e){new u(e)}),g=!o&&S(function(){for(var e=new u,t=5;t--;)e[l](t,t);return!e.has(-0)});m||(((u=e(function(e,t){A(e,u,n);var r=R(new s,e,u);return null!=t&&w(t,i,r[l],r),r})).prototype=c).constructor=u),(p||g)&&(a("delete"),a("has"),i&&a("get")),(g||h)&&a(l),o&&c.clear&&delete c.clear}else u=r.getConstructor(e,n,i,l),b(u.prototype,t),E.NEED=!0;return M(u,n),d[n]=u,y(y.G+y.W+y.F*(u!=s),d),o||r.setStrong(u,n,i),u}},{"./_an-instance":15,"./_export":42,"./_fails":44,"./_for-of":48,"./_global":50,"./_inherit-if-required":55,"./_is-object":61,"./_iter-detect":66,"./_meta":75,"./_redefine":101,"./_redefine-all":100,"./_set-to-string-tag":110}],32:[function(e,t,r){var n=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=n)},{}],33:[function(e,t,r){"use strict";var n=e("./_object-dp"),i=e("./_property-desc");t.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},{"./_object-dp":81,"./_property-desc":99}],34:[function(e,t,r){var o=e("./_a-function");t.exports=function(n,i,e){if(o(n),void 0===i)return n;switch(e){case 1:return function(e){return n.call(i,e)};case 2:return function(e,t){return n.call(i,e,t)};case 3:return function(e,t,r){return n.call(i,e,t,r)}}return function(){return n.apply(i,arguments)}}},{"./_a-function":11}],35:[function(e,t,r){"use strict";function i(e){return 9<e?e:"0"+e}var n=e("./_fails"),o=Date.prototype.getTime,a=Date.prototype.toISOString;t.exports=n(function(){return"0385-07-25T07:06:39.999Z"!=a.call(new Date(-5e13-1))})||!n(function(){a.call(new Date(NaN))})?function(){if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),r=e.getUTCMilliseconds(),n=t<0?"-":9999<t?"+":"";return n+("00000"+Math.abs(t)).slice(n?-6:-4)+"-"+i(e.getUTCMonth()+1)+"-"+i(e.getUTCDate())+"T"+i(e.getUTCHours())+":"+i(e.getUTCMinutes())+":"+i(e.getUTCSeconds())+"."+(99<r?r:"0"+i(r))+"Z"}:a},{"./_fails":44}],36:[function(e,t,r){"use strict";var n=e("./_an-object"),i=e("./_to-primitive");t.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(n(this),"number"!=e)}},{"./_an-object":16,"./_to-primitive":129}],37:[function(e,t,r){t.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},{}],38:[function(e,t,r){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":44}],39:[function(e,t,r){var n=e("./_is-object"),i=e("./_global").document,o=n(i)&&n(i.createElement);t.exports=function(e){return o?i.createElement(e):{}}},{"./_global":50,"./_is-object":61}],40:[function(e,t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],41:[function(e,t,r){var s=e("./_object-keys"),u=e("./_object-gops"),l=e("./_object-pie");t.exports=function(e){var t=s(e),r=u.f;if(r)for(var n,i=r(e),o=l.f,a=0;i.length>a;)o.call(e,n=i[a++])&&t.push(n);return t}},{"./_object-gops":87,"./_object-keys":90,"./_object-pie":91}],42:[function(e,t,r){var m=e("./_global"),g=e("./_core"),v=e("./_hide"),y=e("./_redefine"),_=e("./_ctx"),b="prototype",E=function(e,t,r){var n,i,o,a,s=e&E.F,u=e&E.G,l=e&E.S,c=e&E.P,d=e&E.B,f=u?m:l?m[t]||(m[t]={}):(m[t]||{})[b],h=u?g:g[t]||(g[t]={}),p=h[b]||(h[b]={});for(n in u&&(r=t),r)o=((i=!s&&f&&void 0!==f[n])?f:r)[n],a=d&&i?_(o,m):c&&"function"==typeof o?_(Function.call,o):o,f&&y(f,n,o,e&E.U),h[n]!=o&&v(h,n,a),c&&p[n]!=o&&(p[n]=o)};m.core=g,E.F=1,E.G=2,E.S=4,E.P=8,E.B=16,E.W=32,E.U=64,E.R=128,t.exports=E},{"./_core":32,"./_ctx":34,"./_global":50,"./_hide":52,"./_redefine":101}],43:[function(e,t,r){var n=e("./_wks")("match");t.exports=function(t){var r=/./;try{"/./"[t](r)}catch(e){try{return r[n]=!1,!"/./"[t](r)}catch(e){}}return!0}},{"./_wks":138}],44:[function(e,t,r){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],45:[function(e,t,r){"use strict";e("./es6.regexp.exec");var c=e("./_redefine"),d=e("./_hide"),f=e("./_fails"),h=e("./_defined"),p=e("./_wks"),m=e("./_regexp-exec"),g=p("species"),v=!f(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),y=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2===r.length&&"a"===r[0]&&"b"===r[1]}();t.exports=function(r,e,t){var n=p(r),o=!f(function(){var e={};return e[n]=function(){return 7},7!=""[r](e)}),i=o?!f(function(){var e=!1,t=/a/;return t.exec=function(){return e=!0,null},"split"===r&&(t.constructor={},t.constructor[g]=function(){return t}),t[n](""),!e}):void 0;if(!o||!i||"replace"===r&&!v||"split"===r&&!y){var a=/./[n],s=t(h,n,""[r],function(e,t,r,n,i){return t.exec===m?o&&!i?{done:!0,value:a.call(t,r,n)}:{done:!0,value:e.call(r,t,n)}:{done:!1}}),u=s[0],l=s[1];c(String.prototype,r,u),d(RegExp.prototype,n,2==e?function(e,t){return l.call(e,this,t)}:function(e){return l.call(e,this)})}}},{"./_defined":37,"./_fails":44,"./_hide":52,"./_redefine":101,"./_regexp-exec":103,"./_wks":138,"./es6.regexp.exec":235}],46:[function(e,t,r){"use strict";var n=e("./_an-object");t.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},{"./_an-object":16}],47:[function(e,t,r){"use strict";var p=e("./_is-array"),m=e("./_is-object"),g=e("./_to-length"),v=e("./_ctx"),y=e("./_wks")("isConcatSpreadable");t.exports=function e(t,r,n,i,o,a,s,u){for(var l,c,d=o,f=0,h=!!s&&v(s,u,3);f<i;){if(f in n){if(l=h?h(n[f],f,r):n[f],c=!1,m(l)&&(c=void 0!==(c=l[y])?!!c:p(l)),c&&0<a)d=e(t,r,l,g(l.length),d,a-1)-1;else{if(9007199254740991<=d)throw TypeError();t[d]=l}d++}f++}return d}},{"./_ctx":34,"./_is-array":59,"./_is-object":61,"./_to-length":127,"./_wks":138}],48:[function(e,t,r){var f=e("./_ctx"),h=e("./_iter-call"),p=e("./_is-array-iter"),m=e("./_an-object"),g=e("./_to-length"),v=e("./core.get-iterator-method"),y={},_={};(r=t.exports=function(e,t,r,n,i){var o,a,s,u,l=i?function(){return e}:v(e),c=f(r,n,t?2:1),d=0;if("function"!=typeof l)throw TypeError(e+" is not iterable!");if(p(l)){for(o=g(e.length);d<o;d++)if((u=t?c(m(a=e[d])[0],a[1]):c(e[d]))===y||u===_)return u}else for(s=l.call(e);!(a=s.next()).done;)if((u=h(s,c,a.value,t))===y||u===_)return u}).BREAK=y,r.RETURN=_},{"./_an-object":16,"./_ctx":34,"./_is-array-iter":58,"./_iter-call":63,"./_to-length":127,"./core.get-iterator-method":139}],49:[function(e,t,r){t.exports=e("./_shared")("native-function-to-string",Function.toString)},{"./_shared":112}],50:[function(e,t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],51:[function(e,t,r){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],52:[function(e,t,r){var n=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},{"./_descriptors":38,"./_object-dp":81,"./_property-desc":99}],53:[function(e,t,r){var n=e("./_global").document;t.exports=n&&n.documentElement},{"./_global":50}],54:[function(e,t,r){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":38,"./_dom-create":39,"./_fails":44}],55:[function(e,t,r){var o=e("./_is-object"),a=e("./_set-proto").set;t.exports=function(e,t,r){var n,i=t.constructor;return i!==r&&"function"==typeof i&&(n=i.prototype)!==r.prototype&&o(n)&&a&&a(e,n),e}},{"./_is-object":61,"./_set-proto":108}],56:[function(e,t,r){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},{}],57:[function(e,t,r){var n=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{"./_cof":27}],58:[function(e,t,r){var n=e("./_iterators"),i=e("./_wks")("iterator"),o=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},{"./_iterators":68,"./_wks":138}],59:[function(e,t,r){var n=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==n(e)}},{"./_cof":27}],60:[function(e,t,r){var n=e("./_is-object"),i=Math.floor;t.exports=function(e){return!n(e)&&isFinite(e)&&i(e)===e}},{"./_is-object":61}],61:[function(e,t,r){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],62:[function(e,t,r){var n=e("./_is-object"),i=e("./_cof"),o=e("./_wks")("match");t.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},{"./_cof":27,"./_is-object":61,"./_wks":138}],63:[function(e,t,r){var o=e("./_an-object");t.exports=function(t,e,r,n){try{return n?e(o(r)[0],r[1]):e(r)}catch(e){var i=t.return;throw void 0!==i&&o(i.call(t)),e}}},{"./_an-object":16}],64:[function(e,t,r){"use strict";var n=e("./_object-create"),i=e("./_property-desc"),o=e("./_set-to-string-tag"),a={};e("./_hide")(a,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,r){e.prototype=n(a,{next:i(1,r)}),o(e,t+" Iterator")}},{"./_hide":52,"./_object-create":80,"./_property-desc":99,"./_set-to-string-tag":110,"./_wks":138}],65:[function(e,t,r){"use strict";function _(){return this}var b=e("./_library"),E=e("./_export"),w=e("./_redefine"),A=e("./_hide"),T=e("./_iterators"),S=e("./_iter-create"),x=e("./_set-to-string-tag"),M=e("./_object-gpo"),R=e("./_wks")("iterator"),O=!([].keys&&"next"in[].keys()),P="values";t.exports=function(e,t,r,n,i,o,a){S(r,t,n);function s(e){if(!O&&e in p)return p[e];switch(e){case"keys":case P:return function(){return new r(this,e)}}return function(){return new r(this,e)}}var u,l,c,d=t+" Iterator",f=i==P,h=!1,p=e.prototype,m=p[R]||p["@@iterator"]||i&&p[i],g=m||s(i),v=i?f?s("entries"):g:void 0,y="Array"==t&&p.entries||m;if(y&&(c=M(y.call(new e)))!==Object.prototype&&c.next&&(x(c,d,!0),b||"function"==typeof c[R]||A(c,R,_)),f&&m&&m.name!==P&&(h=!0,g=function(){return m.call(this)}),b&&!a||!O&&!h&&p[R]||A(p,R,g),T[t]=g,T[d]=_,i)if(u={values:f?g:s(P),keys:o?g:s("keys"),entries:v},a)for(l in u)l in p||w(p,l,u[l]);else E(E.P+E.F*(O||h),t,u);return u}},{"./_export":42,"./_hide":52,"./_iter-create":64,"./_iterators":68,"./_library":69,"./_object-gpo":88,"./_redefine":101,"./_set-to-string-tag":110,"./_wks":138}],66:[function(e,t,r){var o=e("./_wks")("iterator"),a=!1;try{var n=[7][o]();n.return=function(){a=!0},Array.from(n,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!a)return!1;var r=!1;try{var n=[7],i=n[o]();i.next=function(){return{done:r=!0}},n[o]=function(){return i},e(n)}catch(e){}return r}},{"./_wks":138}],67:[function(e,t,r){t.exports=function(e,t){return{value:t,done:!!e}}},{}],68:[function(e,t,r){t.exports={}},{}],69:[function(e,t,r){t.exports=!1},{}],70:[function(e,t,r){var n=Math.expm1;t.exports=!n||22025.465794806718<n(10)||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:-1e-6<e&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},{}],71:[function(e,t,r){var o=e("./_math-sign"),n=Math.pow,a=n(2,-52),s=n(2,-23),u=n(2,127)*(2-s),l=n(2,-126);t.exports=Math.fround||function(e){var t,r,n=Math.abs(e),i=o(e);return n<l?i*function(e){return e+1/a-1/a}(n/l/s)*l*s:u<(r=(t=(1+s/a)*n)-(t-n))||r!=r?i*(1/0):i*r}},{"./_math-sign":74}],72:[function(e,t,r){t.exports=Math.log1p||function(e){return-1e-8<(e=+e)&&e<1e-8?e-e*e/2:Math.log(1+e)}},{}],73:[function(e,t,r){t.exports=Math.scale||function(e,t,r,n,i){return 0===arguments.length||e!=e||t!=t||r!=r||n!=n||i!=i?NaN:e===1/0||e===-1/0?e:(e-t)*(i-n)/(r-t)+n}},{}],74:[function(e,t,r){t.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},{}],75:[function(e,t,r){function n(e){s(e,i,{value:{i:"O"+ ++u,w:{}}})}var i=e("./_uid")("meta"),o=e("./_is-object"),a=e("./_has"),s=e("./_object-dp").f,u=0,l=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return l(Object.preventExtensions({}))}),d=t.exports={KEY:i,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,i)){if(!l(e))return"F";if(!t)return"E";n(e)}return e[i].i},getWeak:function(e,t){if(!a(e,i)){if(!l(e))return!0;if(!t)return!1;n(e)}return e[i].w},onFreeze:function(e){return c&&d.NEED&&l(e)&&!a(e,i)&&n(e),e}}},{"./_fails":44,"./_has":51,"./_is-object":61,"./_object-dp":81,"./_uid":133}],76:[function(e,t,r){function i(e,t,r){var n=s.get(e);if(!n){if(!r)return;s.set(e,n=new o)}var i=n.get(t);if(!i){if(!r)return;n.set(t,i=new o)}return i}var o=e("./es6.map"),n=e("./_export"),a=e("./_shared")("metadata"),s=a.store||(a.store=new(e("./es6.weak-map")));t.exports={store:s,map:i,has:function(e,t,r){var n=i(t,r,!1);return void 0!==n&&n.has(e)},get:function(e,t,r){var n=i(t,r,!1);return void 0===n?void 0:n.get(e)},set:function(e,t,r,n){i(r,n,!0).set(e,t)},keys:function(e,t){var r=i(e,t,!1),n=[];return r&&r.forEach(function(e,t){n.push(t)}),n},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){n(n.S,"Reflect",e)}}},{"./_export":42,"./_shared":112,"./es6.map":170,"./es6.weak-map":277}],77:[function(e,t,r){var s=e("./_global"),u=e("./_task").set,l=s.MutationObserver||s.WebKitMutationObserver,c=s.process,d=s.Promise,f="process"==e("./_cof")(c);t.exports=function(){function e(){var e,t;for(f&&(e=c.domain)&&e.exit();r;){t=r.fn,r=r.next;try{t()}catch(e){throw r?i():n=void 0,e}}n=void 0,e&&e.enter()}var r,n,i;if(f)i=function(){c.nextTick(e)};else if(!l||s.navigator&&s.navigator.standalone)if(d&&d.resolve){var t=d.resolve(void 0);i=function(){t.then(e)}}else i=function(){u.call(s,e)};else{var o=!0,a=document.createTextNode("");new l(e).observe(a,{characterData:!0}),i=function(){a.data=o=!o}}return function(e){var t={fn:e,next:void 0};n&&(n.next=t),r||(r=t,i()),n=t}}},{"./_cof":27,"./_global":50,"./_task":122}],78:[function(e,t,r){"use strict";var i=e("./_a-function");function n(e){var r,n;this.promise=new e(function(e,t){if(void 0!==r||void 0!==n)throw TypeError("Bad Promise constructor");r=e,n=t}),this.resolve=i(r),this.reject=i(n)}t.exports.f=function(e){return new n(e)}},{"./_a-function":11}],79:[function(e,t,r){"use strict";var f=e("./_descriptors"),h=e("./_object-keys"),p=e("./_object-gops"),m=e("./_object-pie"),g=e("./_to-object"),v=e("./_iobject"),i=Object.assign;t.exports=!i||e("./_fails")(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=i({},e)[r]||Object.keys(i({},t)).join("")!=n})?function(e,t){for(var r=g(e),n=arguments.length,i=1,o=p.f,a=m.f;i<n;)for(var s,u=v(arguments[i++]),l=o?h(u).concat(o(u)):h(u),c=l.length,d=0;d<c;)s=l[d++],f&&!a.call(u,s)||(r[s]=u[s]);return r}:i},{"./_descriptors":38,"./_fails":44,"./_iobject":57,"./_object-gops":87,"./_object-keys":90,"./_object-pie":91,"./_to-object":128}],80:[function(n,e,t){function i(){}var o=n("./_an-object"),a=n("./_object-dps"),s=n("./_enum-bug-keys"),u=n("./_shared-key")("IE_PROTO"),l="prototype",c=function(){var e,t=n("./_dom-create")("iframe"),r=s.length;for(t.style.display="none",n("./_html").appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c[l][s[r]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(i[l]=o(e),r=new i,i[l]=null,r[u]=e):r=c(),void 0===t?r:a(r,t)}},{"./_an-object":16,"./_dom-create":39,"./_enum-bug-keys":40,"./_html":53,"./_object-dps":82,"./_shared-key":111}],81:[function(e,t,r){var n=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),a=Object.defineProperty;r.f=e("./_descriptors")?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},{"./_an-object":16,"./_descriptors":38,"./_ie8-dom-define":54,"./_to-primitive":129}],82:[function(e,t,r){var a=e("./_object-dp"),s=e("./_an-object"),u=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){s(e);for(var r,n=u(t),i=n.length,o=0;o<i;)a.f(e,r=n[o++],t[r]);return e}},{"./_an-object":16,"./_descriptors":38,"./_object-dp":81,"./_object-keys":90}],83:[function(t,e,r){"use strict";e.exports=t("./_library")||!t("./_fails")(function(){var e=Math.random();__defineSetter__.call(null,e,function(){}),delete t("./_global")[e]})},{"./_fails":44,"./_global":50,"./_library":69}],84:[function(e,t,r){var n=e("./_object-pie"),i=e("./_property-desc"),o=e("./_to-iobject"),a=e("./_to-primitive"),s=e("./_has"),u=e("./_ie8-dom-define"),l=Object.getOwnPropertyDescriptor;r.f=e("./_descriptors")?l:function(e,t){if(e=o(e),t=a(t,!0),u)try{return l(e,t)}catch(e){}if(s(e,t))return i(!n.f.call(e,t),e[t])}},{"./_descriptors":38,"./_has":51,"./_ie8-dom-define":54,"./_object-pie":91,"./_property-desc":99,"./_to-iobject":126,"./_to-primitive":129}],85:[function(e,t,r){var n=e("./_to-iobject"),i=e("./_object-gopn").f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},{"./_object-gopn":86,"./_to-iobject":126}],86:[function(e,t,r){var n=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");r.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},{"./_enum-bug-keys":40,"./_object-keys-internal":89}],87:[function(e,t,r){r.f=Object.getOwnPropertySymbols},{}],88:[function(e,t,r){var n=e("./_has"),i=e("./_to-object"),o=e("./_shared-key")("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},{"./_has":51,"./_shared-key":111,"./_to-object":128}],89:[function(e,t,r){var a=e("./_has"),s=e("./_to-iobject"),u=e("./_array-includes")(!1),l=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var r,n=s(e),i=0,o=[];for(r in n)r!=l&&a(n,r)&&o.push(r);for(;t.length>i;)a(n,r=t[i++])&&(~u(o,r)||o.push(r));return o}},{"./_array-includes":20,"./_has":51,"./_shared-key":111,"./_to-iobject":126}],90:[function(e,t,r){var n=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return n(e,i)}},{"./_enum-bug-keys":40,"./_object-keys-internal":89}],91:[function(e,t,r){r.f={}.propertyIsEnumerable},{}],92:[function(e,t,r){var i=e("./_export"),o=e("./_core"),a=e("./_fails");t.exports=function(e,t){var r=(o.Object||{})[e]||Object[e],n={};n[e]=t(r),i(i.S+i.F*a(function(){r(1)}),"Object",n)}},{"./_core":32,"./_export":42,"./_fails":44}],93:[function(e,t,r){var u=e("./_descriptors"),l=e("./_object-keys"),c=e("./_to-iobject"),d=e("./_object-pie").f;t.exports=function(s){return function(e){for(var t,r=c(e),n=l(r),i=n.length,o=0,a=[];o<i;)t=n[o++],u&&!d.call(r,t)||a.push(s?[t,r[t]]:r[t]);return a}}},{"./_descriptors":38,"./_object-keys":90,"./_object-pie":91,"./_to-iobject":126}],94:[function(e,t,r){var n=e("./_object-gopn"),i=e("./_object-gops"),o=e("./_an-object"),a=e("./_global").Reflect;t.exports=a&&a.ownKeys||function(e){var t=n.f(o(e)),r=i.f;return r?t.concat(r(e)):t}},{"./_an-object":16,"./_global":50,"./_object-gopn":86,"./_object-gops":87}],95:[function(e,t,r){var n=e("./_global").parseFloat,i=e("./_string-trim").trim;t.exports=1/n(e("./_string-ws")+"-0")!=-1/0?function(e){var t=i(String(e),3),r=n(t);return 0===r&&"-"==t.charAt(0)?-0:r}:n},{"./_global":50,"./_string-trim":120,"./_string-ws":121}],96:[function(e,t,r){var n=e("./_global").parseInt,i=e("./_string-trim").trim,o=e("./_string-ws"),a=/^[-+]?0[xX]/;t.exports=8!==n(o+"08")||22!==n(o+"0x16")?function(e,t){var r=i(String(e),3);return n(r,t>>>0||(a.test(r)?16:10))}:n},{"./_global":50,"./_string-trim":120,"./_string-ws":121}],97:[function(e,t,r){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],98:[function(e,t,r){var n=e("./_an-object"),i=e("./_is-object"),o=e("./_new-promise-capability");t.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},{"./_an-object":16,"./_is-object":61,"./_new-promise-capability":78}],99:[function(e,t,r){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],100:[function(e,t,r){var i=e("./_redefine");t.exports=function(e,t,r){for(var n in t)i(e,n,t[n],r);return e}},{"./_redefine":101}],101:[function(e,t,r){var o=e("./_global"),a=e("./_hide"),s=e("./_has"),u=e("./_uid")("src"),n=e("./_function-to-string"),i="toString",l=(""+n).split(i);e("./_core").inspectSource=function(e){return n.call(e)},(t.exports=function(e,t,r,n){var i="function"==typeof r;i&&(s(r,"name")||a(r,"name",t)),e[t]!==r&&(i&&(s(r,u)||a(r,u,e[t]?""+e[t]:l.join(String(t)))),e===o?e[t]=r:n?e[t]?e[t]=r:a(e,t,r):(delete e[t],a(e,t,r)))})(Function.prototype,i,function(){return"function"==typeof this&&this[u]||n.call(this)})},{"./_core":32,"./_function-to-string":49,"./_global":50,"./_has":51,"./_hide":52,"./_uid":133}],102:[function(e,t,r){"use strict";var i=e("./_classof"),o=RegExp.prototype.exec;t.exports=function(e,t){var r=e.exec;if("function"==typeof r){var n=r.call(e,t);if("object"!=typeof n)throw new TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==i(e))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(e,t)}},{"./_classof":26}],103:[function(e,t,r){"use strict";var n,i,a=e("./_flags"),s=RegExp.prototype.exec,u=String.prototype.replace,o=s,l="lastIndex",c=(n=/a/,i=/b*/g,s.call(n,"a"),s.call(i,"a"),0!==n[l]||0!==i[l]),d=void 0!==/()??/.exec("")[1];(c||d)&&(o=function(e){var t,r,n,i,o=this;return d&&(r=new RegExp("^"+o.source+"$(?!\\s)",a.call(o))),c&&(t=o[l]),n=s.call(o,e),c&&n&&(o[l]=o.global?n.index+n[0].length:t),d&&n&&1<n.length&&u.call(n[0],r,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(n[i]=void 0)}),n}),t.exports=o},{"./_flags":46}],104:[function(e,t,r){t.exports=function(t,r){var n=r===Object(r)?function(e){return r[e]}:r;return function(e){return String(e).replace(t,n)}}},{}],105:[function(e,t,r){t.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},{}],106:[function(e,t,r){"use strict";var n=e("./_export"),u=e("./_a-function"),l=e("./_ctx"),c=e("./_for-of");t.exports=function(e){n(n.S,e,{from:function(e,t,r){var n,i,o,a,s=t;return u(this),(n=void 0!==s)&&u(s),null==e?new this:(i=[],n?(o=0,a=l(s,r,2),c(e,!1,function(e){i.push(a(e,o++))})):c(e,!1,i.push,i),new this(i))}})}},{"./_a-function":11,"./_ctx":34,"./_export":42,"./_for-of":48}],107:[function(e,t,r){"use strict";var n=e("./_export");t.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{"./_export":42}],108:[function(t,e,r){function i(e,t){if(o(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")}var n=t("./_is-object"),o=t("./_an-object");e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,r,n){try{(n=t("./_ctx")(Function.call,t("./_object-gopd").f(Object.prototype,"__proto__").set,2))(e,[]),r=!(e instanceof Array)}catch(e){r=!0}return function(e,t){return i(e,t),r?e.__proto__=t:n(e,t),e}}({},!1):void 0),check:i}},{"./_an-object":16,"./_ctx":34,"./_is-object":61,"./_object-gopd":84}],109:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_object-dp"),o=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t=n[e];o&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_descriptors":38,"./_global":50,"./_object-dp":81,"./_wks":138}],110:[function(e,t,r){var n=e("./_object-dp").f,i=e("./_has"),o=e("./_wks")("toStringTag");t.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},{"./_has":51,"./_object-dp":81,"./_wks":138}],111:[function(e,t,r){var n=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return n[e]||(n[e]=i(e))}},{"./_shared":112,"./_uid":133}],112:[function(e,t,r){var n=e("./_core"),i=e("./_global"),o="__core-js_shared__",a=i[o]||(i[o]={});(t.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:e("./_library")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},{"./_core":32,"./_global":50,"./_library":69}],113:[function(e,t,r){var i=e("./_an-object"),o=e("./_a-function"),a=e("./_wks")("species");t.exports=function(e,t){var r,n=i(e).constructor;return void 0===n||null==(r=i(n)[a])?t:o(r)}},{"./_a-function":11,"./_an-object":16,"./_wks":138}],114:[function(e,t,r){"use strict";var n=e("./_fails");t.exports=function(e,t){return!!e&&n(function(){t?e.call(null,function(){},1):e.call(null)})}},{"./_fails":44}],115:[function(e,t,r){var u=e("./_to-integer"),l=e("./_defined");t.exports=function(s){return function(e,t){var r,n,i=String(l(e)),o=u(t),a=i.length;return o<0||a<=o?s?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===a||(n=i.charCodeAt(o+1))<56320||57343<n?s?i.charAt(o):r:s?i.slice(o,o+2):n-56320+(r-55296<<10)+65536}}},{"./_defined":37,"./_to-integer":125}],116:[function(e,t,r){var n=e("./_is-regexp"),i=e("./_defined");t.exports=function(e,t,r){if(n(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(e))}},{"./_defined":37,"./_is-regexp":62}],117:[function(e,t,r){function n(e,t,r,n){var i=String(a(e)),o="<"+t;return""!==r&&(o+=" "+r+'="'+String(n).replace(s,"&quot;")+'"'),o+">"+i+"</"+t+">"}var i=e("./_export"),o=e("./_fails"),a=e("./_defined"),s=/"/g;t.exports=function(t,e){var r={};r[t]=e(n),i(i.P+i.F*o(function(){var e=""[t]('"');return e!==e.toLowerCase()||3<e.split('"').length}),"String",r)}},{"./_defined":37,"./_export":42,"./_fails":44}],118:[function(e,t,r){var c=e("./_to-length"),d=e("./_string-repeat"),f=e("./_defined");t.exports=function(e,t,r,n){var i=String(f(e)),o=i.length,a=void 0===r?" ":String(r),s=c(t);if(s<=o||""==a)return i;var u=s-o,l=d.call(a,Math.ceil(u/a.length));return l.length>u&&(l=l.slice(0,u)),n?l+i:i+l}},{"./_defined":37,"./_string-repeat":119,"./_to-length":127}],119:[function(e,t,r){"use strict";var i=e("./_to-integer"),o=e("./_defined");t.exports=function(e){var t=String(o(this)),r="",n=i(e);if(n<0||n==1/0)throw RangeError("Count can't be negative");for(;0<n;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r}},{"./_defined":37,"./_to-integer":125}],120:[function(e,t,r){function n(e,t,r){var n={},i=s(function(){return!!u[e]()||"​"!="​"[e]()}),o=n[e]=i?t(d):u[e];r&&(n[r]=o),a(a.P+a.F*i,"String",n)}var a=e("./_export"),i=e("./_defined"),s=e("./_fails"),u=e("./_string-ws"),o="["+u+"]",l=RegExp("^"+o+o+"*"),c=RegExp(o+o+"*$"),d=n.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(c,"")),e};t.exports=n},{"./_defined":37,"./_export":42,"./_fails":44,"./_string-ws":121}],121:[function(e,t,r){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},{}],122:[function(e,t,r){function n(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}}function i(e){n.call(e.data)}var o,a,s,u=e("./_ctx"),l=e("./_invoke"),c=e("./_html"),d=e("./_dom-create"),f=e("./_global"),h=f.process,p=f.setImmediate,m=f.clearImmediate,g=f.MessageChannel,v=f.Dispatch,y=0,_={},b="onreadystatechange";p&&m||(p=function(e){for(var t=[],r=1;r<arguments.length;)t.push(arguments[r++]);return _[++y]=function(){l("function"==typeof e?e:Function(e),t)},o(y),y},m=function(e){delete _[e]},"process"==e("./_cof")(h)?o=function(e){h.nextTick(u(n,e,1))}:v&&v.now?o=function(e){v.now(u(n,e,1))}:g?(s=(a=new g).port2,a.port1.onmessage=i,o=u(s.postMessage,s,1)):f.addEventListener&&"function"==typeof postMessage&&!f.importScripts?(o=function(e){f.postMessage(e+"","*")},f.addEventListener("message",i,!1)):o=b in d("script")?function(e){c.appendChild(d("script"))[b]=function(){c.removeChild(this),n.call(e)}}:function(e){setTimeout(u(n,e,1),0)}),t.exports={set:p,clear:m}},{"./_cof":27,"./_ctx":34,"./_dom-create":39,"./_global":50,"./_html":53,"./_invoke":56}],123:[function(e,t,r){var n=e("./_to-integer"),i=Math.max,o=Math.min;t.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},{"./_to-integer":125}],124:[function(e,t,r){var n=e("./_to-integer"),i=e("./_to-length");t.exports=function(e){if(void 0===e)return 0;var t=n(e),r=i(t);if(t!==r)throw RangeError("Wrong length!");return r}},{"./_to-integer":125,"./_to-length":127}],125:[function(e,t,r){var n=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(0<e?i:n)(e)}},{}],126:[function(e,t,r){var n=e("./_iobject"),i=e("./_defined");t.exports=function(e){return n(i(e))}},{"./_defined":37,"./_iobject":57}],127:[function(e,t,r){var n=e("./_to-integer"),i=Math.min;t.exports=function(e){return 0<e?i(n(e),9007199254740991):0}},{"./_to-integer":125}],128:[function(e,t,r){var n=e("./_defined");t.exports=function(e){return Object(n(e))}},{"./_defined":37}],129:[function(e,t,r){var i=e("./_is-object");t.exports=function(e,t){if(!i(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!i(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!i(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!i(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":61}],130:[function(e,t,r){"use strict";if(e("./_descriptors")){var v=e("./_library"),y=e("./_global"),_=e("./_fails"),b=e("./_export"),E=e("./_typed"),n=e("./_typed-buffer"),p=e("./_ctx"),w=e("./_an-instance"),i=e("./_property-desc"),A=e("./_hide"),o=e("./_redefine-all"),a=e("./_to-integer"),T=e("./_to-length"),S=e("./_to-index"),s=e("./_to-absolute-index"),u=e("./_to-primitive"),l=e("./_has"),x=e("./_classof"),M=e("./_is-object"),m=e("./_to-object"),g=e("./_is-array-iter"),R=e("./_object-create"),O=e("./_object-gpo"),P=e("./_object-gopn").f,C=e("./core.get-iterator-method"),c=e("./_uid"),d=e("./_wks"),f=e("./_array-methods"),h=e("./_array-includes"),D=e("./_species-constructor"),I=e("./es6.array.iterator"),L=e("./_iterators"),N=e("./_iter-detect"),k=e("./_set-species"),F=e("./_array-fill"),j=e("./_array-copy-within"),B=e("./_object-dp"),U=e("./_object-gopd"),G=B.f,H=U.f,V=y.RangeError,z=y.TypeError,W=y.Uint8Array,q="ArrayBuffer",Y="Shared"+q,K="BYTES_PER_ELEMENT",X="prototype",Q=Array[X],J=n.ArrayBuffer,Z=n.DataView,$=f(0),ee=f(2),te=f(3),re=f(4),ne=f(5),ie=f(6),oe=h(!0),ae=h(!1),se=I.values,ue=I.keys,le=I.entries,ce=Q.lastIndexOf,de=Q.reduce,fe=Q.reduceRight,he=Q.join,pe=Q.sort,me=Q.slice,ge=Q.toString,ve=Q.toLocaleString,ye=d("iterator"),_e=d("toStringTag"),be=c("typed_constructor"),Ee=c("def_constructor"),we=E.CONSTR,Ae=E.TYPED,Te=E.VIEW,Se="Wrong length!",xe=f(1,function(e,t){return Ce(D(e,e[Ee]),t)}),Me=_(function(){return 1===new W(new Uint16Array([1]).buffer)[0]}),Re=!!W&&!!W[X].set&&_(function(){new W(1).set({})}),Oe=function(e,t){var r=a(e);if(r<0||r%t)throw V("Wrong offset!");return r},Pe=function(e){if(M(e)&&Ae in e)return e;throw z(e+" is not a typed array!")},Ce=function(e,t){if(!(M(e)&&be in e))throw z("It is not a typed array constructor!");return new e(t)},De=function(e,t){return Ie(D(e,e[Ee]),t)},Ie=function(e,t){for(var r=0,n=t.length,i=Ce(e,n);r<n;)i[r]=t[r++];return i},Le=function(e,t,r){G(e,t,{get:function(){return this._d[r]}})},Ne=function(e,t,r){var n,i,o,a,s,u,l=m(e),c=arguments.length,d=1<c?t:void 0,f=void 0!==d,h=C(l);if(null!=h&&!g(h)){for(u=h.call(l),o=[],n=0;!(s=u.next()).done;n++)o.push(s.value);l=o}for(f&&2<c&&(d=p(d,r,2)),n=0,i=T(l.length),a=Ce(this,i);n<i;n++)a[n]=f?d(l[n],n):l[n];return a},ke=function(){for(var e=0,t=arguments.length,r=Ce(this,t);e<t;)r[e]=arguments[e++];return r},Fe=!!W&&_(function(){ve.call(new W(1))}),je=function(){return ve.apply(Fe?me.call(Pe(this)):Pe(this),arguments)},Be={copyWithin:function(e,t,r){return j.call(Pe(this),e,t,2<arguments.length?r:void 0)},every:function(e,t){return re(Pe(this),e,1<arguments.length?t:void 0)},fill:function(e){return F.apply(Pe(this),arguments)},filter:function(e,t){return De(this,ee(Pe(this),e,1<arguments.length?t:void 0))},find:function(e,t){return ne(Pe(this),e,1<arguments.length?t:void 0)},findIndex:function(e,t){return ie(Pe(this),e,1<arguments.length?t:void 0)},forEach:function(e,t){$(Pe(this),e,1<arguments.length?t:void 0)},indexOf:function(e,t){return ae(Pe(this),e,1<arguments.length?t:void 0)},includes:function(e,t){return oe(Pe(this),e,1<arguments.length?t:void 0)},join:function(e){return he.apply(Pe(this),arguments)},lastIndexOf:function(e){return ce.apply(Pe(this),arguments)},map:function(e,t){return xe(Pe(this),e,1<arguments.length?t:void 0)},reduce:function(e){return de.apply(Pe(this),arguments)},reduceRight:function(e){return fe.apply(Pe(this),arguments)},reverse:function(){for(var e,t=this,r=Pe(t).length,n=Math.floor(r/2),i=0;i<n;)e=t[i],t[i++]=t[--r],t[r]=e;return t},some:function(e,t){return te(Pe(this),e,1<arguments.length?t:void 0)},sort:function(e){return pe.call(Pe(this),e)},subarray:function(e,t){var r=Pe(this),n=r.length,i=s(e,n);return new(D(r,r[Ee]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,T((void 0===t?n:s(t,n))-i))}},Ue=function(e,t){return De(this,me.call(Pe(this),e,t))},Ge=function(e,t){Pe(this);var r=Oe(t,1),n=this.length,i=m(e),o=T(i.length),a=0;if(n<o+r)throw V(Se);for(;a<o;)this[r+a]=i[a++]},He={entries:function(){return le.call(Pe(this))},keys:function(){return ue.call(Pe(this))},values:function(){return se.call(Pe(this))}},Ve=function(e,t){return M(e)&&e[Ae]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},ze=function(e,t){return Ve(e,t=u(t,!0))?i(2,e[t]):H(e,t)},We=function(e,t,r){return!(Ve(e,t=u(t,!0))&&M(r)&&l(r,"value"))||l(r,"get")||l(r,"set")||r.configurable||l(r,"writable")&&!r.writable||l(r,"enumerable")&&!r.enumerable?G(e,t,r):(e[t]=r.value,e)};we||(U.f=ze,B.f=We),b(b.S+b.F*!we,"Object",{getOwnPropertyDescriptor:ze,defineProperty:We}),_(function(){ge.call({})})&&(ge=ve=function(){return he.call(this)});var qe=o({},Be);o(qe,He),A(qe,ye,He.values),o(qe,{slice:Ue,set:Ge,constructor:function(){},toString:ge,toLocaleString:je}),Le(qe,"buffer","b"),Le(qe,"byteOffset","o"),Le(qe,"byteLength","l"),Le(qe,"length","e"),G(qe,_e,{get:function(){return this[Ae]}}),t.exports=function(e,d,t,i){function f(e,t){G(e,t,{get:function(){return function(e,t){var r=e._d;return r.v[n](t*d+r.o,Me)}(this,t)},set:function(e){return function(e,t,r){var n=e._d;i&&(r=(r=Math.round(r))<0?0:255<r?255:255&r),n.v[o](t*d+n.o,r,Me)}(this,t,e)},enumerable:!0})}var h=e+((i=!!i)?"Clamped":"")+"Array",n="get"+e,o="set"+e,p=y[h],a=p||{},r=p&&O(p),s=!p||!E.ABV,u={},l=p&&p[X];s?(p=t(function(e,t,r,n){w(e,p,h,"_d");var i,o,a,s,u=0,l=0;if(M(t)){if(!(t instanceof J||(s=x(t))==q||s==Y))return Ae in t?Ie(p,t):Ne.call(p,t);i=t,l=Oe(r,d);var c=t.byteLength;if(void 0===n){if(c%d)throw V(Se);if((o=c-l)<0)throw V(Se)}else if(c<(o=T(n)*d)+l)throw V(Se);a=o/d}else a=S(t),i=new J(o=a*d);for(A(e,"_d",{b:i,o:l,l:o,e:a,v:new Z(i)});u<a;)f(e,u++)}),l=p[X]=R(qe),A(l,"constructor",p)):_(function(){p(1)})&&_(function(){new p(-1)})&&N(function(e){new p,new p(null),new p(1.5),new p(e)},!0)||(p=t(function(e,t,r,n){var i;return w(e,p,h),M(t)?t instanceof J||(i=x(t))==q||i==Y?void 0!==n?new a(t,Oe(r,d),n):void 0!==r?new a(t,Oe(r,d)):new a(t):Ae in t?Ie(p,t):Ne.call(p,t):new a(S(t))}),$(r!==Function.prototype?P(a).concat(P(r)):P(a),function(e){e in p||A(p,e,a[e])}),p[X]=l,v||(l.constructor=p));var c=l[ye],m=!!c&&("values"==c.name||null==c.name),g=He.values;A(p,be,!0),A(l,Ae,h),A(l,Te,!0),A(l,Ee,p),(i?new p(1)[_e]==h:_e in l)||G(l,_e,{get:function(){return h}}),u[h]=p,b(b.G+b.W+b.F*(p!=a),u),b(b.S,h,{BYTES_PER_ELEMENT:d}),b(b.S+b.F*_(function(){a.of.call(p,1)}),h,{from:Ne,of:ke}),K in l||A(l,K,d),b(b.P,h,Be),k(h),b(b.P+b.F*Re,h,{set:Ge}),b(b.P+b.F*!m,h,He),v||l.toString==ge||(l.toString=ge),b(b.P+b.F*_(function(){new p(1).slice()}),h,{slice:Ue}),b(b.P+b.F*(_(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!_(function(){l.toLocaleString.call([1,2])})),h,{toLocaleString:je}),L[h]=m?c:g,v||m||A(l,ye,g)}}else t.exports=function(){}},{"./_an-instance":15,"./_array-copy-within":17,"./_array-fill":18,"./_array-includes":20,"./_array-methods":21,"./_classof":26,"./_ctx":34,"./_descriptors":38,"./_export":42,"./_fails":44,"./_global":50,"./_has":51,"./_hide":52,"./_is-array-iter":58,"./_is-object":61,"./_iter-detect":66,"./_iterators":68,"./_library":69,"./_object-create":80,"./_object-dp":81,"./_object-gopd":84,"./_object-gopn":86,"./_object-gpo":88,"./_property-desc":99,"./_redefine-all":100,"./_set-species":109,"./_species-constructor":113,"./_to-absolute-index":123,"./_to-index":124,"./_to-integer":125,"./_to-length":127,"./_to-object":128,"./_to-primitive":129,"./_typed":132,"./_typed-buffer":131,"./_uid":133,"./_wks":138,"./core.get-iterator-method":139,"./es6.array.iterator":151}],131:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_descriptors"),o=e("./_library"),a=e("./_typed"),s=e("./_hide"),u=e("./_redefine-all"),l=e("./_fails"),c=e("./_an-instance"),d=e("./_to-integer"),f=e("./_to-length"),h=e("./_to-index"),p=e("./_object-gopn").f,m=e("./_object-dp").f,g=e("./_array-fill"),v=e("./_set-to-string-tag"),y="ArrayBuffer",_="DataView",b="prototype",E="Wrong index!",w=n[y],A=n[_],T=n.Math,S=n.RangeError,x=n.Infinity,M=w,R=T.abs,O=T.pow,P=T.floor,C=T.log,D=T.LN2,I="byteLength",L="byteOffset",N=i?"_b":"buffer",k=i?"_l":I,F=i?"_o":L;function j(e,t,r){var n,i,o,a=new Array(r),s=8*r-t-1,u=(1<<s)-1,l=u>>1,c=23===t?O(2,-24)-O(2,-77):0,d=0,f=e<0||0===e&&1/e<0?1:0;for((e=R(e))!=e||e===x?(i=e!=e?1:0,n=u):(n=P(C(e)/D),e*(o=O(2,-n))<1&&(n--,o*=2),2<=(e+=1<=n+l?c/o:c*O(2,1-l))*o&&(n++,o/=2),u<=n+l?(i=0,n=u):1<=n+l?(i=(e*o-1)*O(2,t),n+=l):(i=e*O(2,l-1)*O(2,t),n=0));8<=t;a[d++]=255&i,i/=256,t-=8);for(n=n<<t|i,s+=t;0<s;a[d++]=255&n,n/=256,s-=8);return a[--d]|=128*f,a}function B(e,t,r){var n,i=8*r-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=r-1,l=e[u--],c=127&l;for(l>>=7;0<s;c=256*c+e[u],u--,s-=8);for(n=c&(1<<-s)-1,c>>=-s,s+=t;0<s;n=256*n+e[u],u--,s-=8);if(0===c)c=1-a;else{if(c===o)return n?NaN:l?-x:x;n+=O(2,t),c-=a}return(l?-1:1)*n*O(2,c-t)}function U(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function G(e){return[255&e]}function H(e){return[255&e,e>>8&255]}function V(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function z(e){return j(e,52,8)}function W(e){return j(e,23,4)}function q(e,t,r){m(e[b],t,{get:function(){return this[r]}})}function Y(e,t,r,n){var i=h(+r);if(i+t>e[k])throw S(E);var o=e[N]._b,a=i+e[F],s=o.slice(a,a+t);return n?s:s.reverse()}function K(e,t,r,n,i,o){var a=h(+r);if(a+t>e[k])throw S(E);for(var s=e[N]._b,u=a+e[F],l=n(+i),c=0;c<t;c++)s[u+c]=l[o?c:t-c-1]}if(a.ABV){if(!l(function(){w(1)})||!l(function(){new w(-1)})||l(function(){return new w,new w(1.5),new w(NaN),w.name!=y})){for(var X,Q=(w=function(e){return c(this,w),new M(h(e))})[b]=M[b],J=p(M),Z=0;J.length>Z;)(X=J[Z++])in w||s(w,X,M[X]);o||(Q.constructor=w)}var $=new A(new w(2)),ee=A[b].setInt8;$.setInt8(0,2147483648),$.setInt8(1,2147483649),!$.getInt8(0)&&$.getInt8(1)||u(A[b],{setInt8:function(e,t){ee.call(this,e,t<<24>>24)},setUint8:function(e,t){ee.call(this,e,t<<24>>24)}},!0)}else w=function(e){c(this,w,y);var t=h(e);this._b=g.call(new Array(t),0),this[k]=t},A=function(e,t,r){c(this,A,_),c(e,w,_);var n=e[k],i=d(t);if(i<0||n<i)throw S("Wrong offset!");if(n<i+(r=void 0===r?n-i:f(r)))throw S("Wrong length!");this[N]=e,this[F]=i,this[k]=r},i&&(q(w,I,"_l"),q(A,"buffer","_b"),q(A,I,"_l"),q(A,L,"_o")),u(A[b],{getInt8:function(e){return Y(this,1,e)[0]<<24>>24},getUint8:function(e){return Y(this,1,e)[0]},getInt16:function(e,t){var r=Y(this,2,e,t);return(r[1]<<8|r[0])<<16>>16},getUint16:function(e,t){var r=Y(this,2,e,t);return r[1]<<8|r[0]},getInt32:function(e,t){return U(Y(this,4,e,t))},getUint32:function(e,t){return U(Y(this,4,e,t))>>>0},getFloat32:function(e,t){return B(Y(this,4,e,t),23,4)},getFloat64:function(e,t){return B(Y(this,8,e,t),52,8)},setInt8:function(e,t){K(this,1,e,G,t)},setUint8:function(e,t){K(this,1,e,G,t)},setInt16:function(e,t,r){K(this,2,e,H,t,r)},setUint16:function(e,t,r){K(this,2,e,H,t,r)},setInt32:function(e,t,r){K(this,4,e,V,t,r)},setUint32:function(e,t,r){K(this,4,e,V,t,r)},setFloat32:function(e,t,r){K(this,4,e,W,t,r)},setFloat64:function(e,t,r){K(this,8,e,z,t,r)}});v(w,y),v(A,_),s(A[b],a.VIEW,!0),r[y]=w,r[_]=A},{"./_an-instance":15,"./_array-fill":18,"./_descriptors":38,"./_fails":44,"./_global":50,"./_hide":52,"./_library":69,"./_object-dp":81,"./_object-gopn":86,"./_redefine-all":100,"./_set-to-string-tag":110,"./_to-index":124,"./_to-integer":125,"./_to-length":127,"./_typed":132}],132:[function(e,t,r){for(var n,i=e("./_global"),o=e("./_hide"),a=e("./_uid"),s=a("typed_array"),u=a("view"),l=!(!i.ArrayBuffer||!i.DataView),c=l,d=0,f="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");d<9;)(n=i[f[d++]])?(o(n.prototype,s,!0),o(n.prototype,u,!0)):c=!1;t.exports={ABV:l,CONSTR:c,TYPED:s,VIEW:u}},{"./_global":50,"./_hide":52,"./_uid":133}],133:[function(e,t,r){var n=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},{}],134:[function(e,t,r){var n=e("./_global").navigator;t.exports=n&&n.userAgent||""},{"./_global":50}],135:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{"./_is-object":61}],136:[function(e,t,r){var n=e("./_global"),i=e("./_core"),o=e("./_library"),a=e("./_wks-ext"),s=e("./_object-dp").f;t.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},{"./_core":32,"./_global":50,"./_library":69,"./_object-dp":81,"./_wks-ext":137}],137:[function(e,t,r){r.f=e("./_wks")},{"./_wks":138}],138:[function(e,t,r){var n=e("./_shared")("wks"),i=e("./_uid"),o=e("./_global").Symbol,a="function"==typeof o;(t.exports=function(e){return n[e]||(n[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=n},{"./_global":50,"./_shared":112,"./_uid":133}],139:[function(e,t,r){var n=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[n(e)]}},{"./_classof":26,"./_core":32,"./_iterators":68,"./_wks":138}],140:[function(e,t,r){var n=e("./_export"),i=e("./_replacer")(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function(e){return i(e)}})},{"./_export":42,"./_replacer":104}],141:[function(e,t,r){var n=e("./_export");n(n.P,"Array",{copyWithin:e("./_array-copy-within")}),e("./_add-to-unscopables")("copyWithin")},{"./_add-to-unscopables":13,"./_array-copy-within":17,"./_export":42}],142:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-methods")(4);n(n.P+n.F*!e("./_strict-method")([].every,!0),"Array",{every:function(e,t){return i(this,e,t)}})},{"./_array-methods":21,"./_export":42,"./_strict-method":114}],143:[function(e,t,r){var n=e("./_export");n(n.P,"Array",{fill:e("./_array-fill")}),e("./_add-to-unscopables")("fill")},{"./_add-to-unscopables":13,"./_array-fill":18,"./_export":42}],144:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-methods")(2);n(n.P+n.F*!e("./_strict-method")([].filter,!0),"Array",{filter:function(e,t){return i(this,e,t)}})},{"./_array-methods":21,"./_export":42,"./_strict-method":114}],145:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-methods")(6),o="findIndex",a=!0;o in[]&&Array(1)[o](function(){a=!1}),n(n.P+n.F*a,"Array",{findIndex:function(e,t){return i(this,e,1<arguments.length?t:void 0)}}),e("./_add-to-unscopables")(o)},{"./_add-to-unscopables":13,"./_array-methods":21,"./_export":42}],146:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-methods")(5),o="find",a=!0;o in[]&&Array(1)[o](function(){a=!1}),n(n.P+n.F*a,"Array",{find:function(e,t){return i(this,e,1<arguments.length?t:void 0)}}),e("./_add-to-unscopables")(o)},{"./_add-to-unscopables":13,"./_array-methods":21,"./_export":42}],147:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-methods")(0),o=e("./_strict-method")([].forEach,!0);n(n.P+n.F*!o,"Array",{forEach:function(e,t){return i(this,e,t)}})},{"./_array-methods":21,"./_export":42,"./_strict-method":114}],148:[function(e,t,r){"use strict";var p=e("./_ctx"),n=e("./_export"),m=e("./_to-object"),g=e("./_iter-call"),v=e("./_is-array-iter"),y=e("./_to-length"),_=e("./_create-property"),b=e("./core.get-iterator-method");n(n.S+n.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e,t,r){var n,i,o,a,s=m(e),u="function"==typeof this?this:Array,l=arguments.length,c=1<l?t:void 0,d=void 0!==c,f=0,h=b(s);if(d&&(c=p(c,2<l?r:void 0,2)),null==h||u==Array&&v(h))for(i=new u(n=y(s.length));f<n;f++)_(i,f,d?c(s[f],f):s[f]);else for(a=h.call(s),i=new u;!(o=a.next()).done;f++)_(i,f,d?g(a,c,[o.value,f],!0):o.value);return i.length=f,i}})},{"./_create-property":33,"./_ctx":34,"./_export":42,"./_is-array-iter":58,"./_iter-call":63,"./_iter-detect":66,"./_to-length":127,"./_to-object":128,"./core.get-iterator-method":139}],149:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-includes")(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(a||!e("./_strict-method")(o)),"Array",{indexOf:function(e,t){return a?o.apply(this,arguments)||0:i(this,e,t)}})},{"./_array-includes":20,"./_export":42,"./_strict-method":114}],150:[function(e,t,r){var n=e("./_export");n(n.S,"Array",{isArray:e("./_is-array")})},{"./_export":42,"./_is-array":59}],151:[function(e,t,r){"use strict";var n=e("./_add-to-unscopables"),i=e("./_iter-step"),o=e("./_iterators"),a=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},{"./_add-to-unscopables":13,"./_iter-define":65,"./_iter-step":67,"./_iterators":68,"./_to-iobject":126}],152:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_to-iobject"),o=[].join;n(n.P+n.F*(e("./_iobject")!=Object||!e("./_strict-method")(o)),"Array",{join:function(e){return o.call(i(this),void 0===e?",":e)}})},{"./_export":42,"./_iobject":57,"./_strict-method":114,"./_to-iobject":126}],153:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_to-iobject"),a=e("./_to-integer"),s=e("./_to-length"),u=[].lastIndexOf,l=!!u&&1/[1].lastIndexOf(1,-0)<0;n(n.P+n.F*(l||!e("./_strict-method")(u)),"Array",{lastIndexOf:function(e,t){if(l)return u.apply(this,arguments)||0;var r=o(this),n=s(r.length),i=n-1;for(1<arguments.length&&(i=Math.min(i,a(t))),i<0&&(i=n+i);0<=i;i--)if(i in r&&r[i]===e)return i||0;return-1}})},{"./_export":42,"./_strict-method":114,"./_to-integer":125,"./_to-iobject":126,"./_to-length":127}],154:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-methods")(1);n(n.P+n.F*!e("./_strict-method")([].map,!0),"Array",{map:function(e,t){return i(this,e,t)}})},{"./_array-methods":21,"./_export":42,"./_strict-method":114}],155:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_create-property");n(n.S+n.F*e("./_fails")(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,r=new("function"==typeof this?this:Array)(t);e<t;)i(r,e,arguments[e++]);return r.length=t,r}})},{"./_create-property":33,"./_export":42,"./_fails":44}],156:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-reduce");n(n.P+n.F*!e("./_strict-method")([].reduceRight,!0),"Array",{reduceRight:function(e,t){return i(this,e,arguments.length,t,!0)}})},{"./_array-reduce":22,"./_export":42,"./_strict-method":114}],157:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-reduce");n(n.P+n.F*!e("./_strict-method")([].reduce,!0),"Array",{reduce:function(e,t){return i(this,e,arguments.length,t,!1)}})},{"./_array-reduce":22,"./_export":42,"./_strict-method":114}],158:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_html"),l=e("./_cof"),c=e("./_to-absolute-index"),d=e("./_to-length"),f=[].slice;n(n.P+n.F*e("./_fails")(function(){i&&f.call(i)}),"Array",{slice:function(e,t){var r=d(this.length),n=l(this);if(t=void 0===t?r:t,"Array"==n)return f.call(this,e,t);for(var i=c(e,r),o=c(t,r),a=d(o-i),s=new Array(a),u=0;u<a;u++)s[u]="String"==n?this.charAt(i+u):this[i+u];return s}})},{"./_cof":27,"./_export":42,"./_fails":44,"./_html":53,"./_to-absolute-index":123,"./_to-length":127}],159:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-methods")(3);n(n.P+n.F*!e("./_strict-method")([].some,!0),"Array",{some:function(e,t){return i(this,e,t)}})},{"./_array-methods":21,"./_export":42,"./_strict-method":114}],160:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_a-function"),o=e("./_to-object"),a=e("./_fails"),s=[].sort,u=[1,2,3];n(n.P+n.F*(a(function(){u.sort(void 0)})||!a(function(){u.sort(null)})||!e("./_strict-method")(s)),"Array",{sort:function(e){return void 0===e?s.call(o(this)):s.call(o(this),i(e))}})},{"./_a-function":11,"./_export":42,"./_fails":44,"./_strict-method":114,"./_to-object":128}],161:[function(e,t,r){e("./_set-species")("Array")},{"./_set-species":109}],162:[function(e,t,r){var n=e("./_export");n(n.S,"Date",{now:function(){return(new Date).getTime()}})},{"./_export":42}],163:[function(e,t,r){var n=e("./_export"),i=e("./_date-to-iso-string");n(n.P+n.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},{"./_date-to-iso-string":35,"./_export":42}],164:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_to-object"),o=e("./_to-primitive");n(n.P+n.F*e("./_fails")(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(e){var t=i(this),r=o(t);return"number"!=typeof r||isFinite(r)?t.toISOString():null}})},{"./_export":42,"./_fails":44,"./_to-object":128,"./_to-primitive":129}],165:[function(e,t,r){var n=e("./_wks")("toPrimitive"),i=Date.prototype;n in i||e("./_hide")(i,n,e("./_date-to-primitive"))},{"./_date-to-primitive":36,"./_hide":52,"./_wks":138}],166:[function(e,t,r){var n=Date.prototype,i="Invalid Date",o="toString",a=n[o],s=n.getTime;new Date(NaN)+""!=i&&e("./_redefine")(n,o,function(){var e=s.call(this);return e==e?a.call(this):i})},{"./_redefine":101}],167:[function(e,t,r){var n=e("./_export");n(n.P,"Function",{bind:e("./_bind")})},{"./_bind":25,"./_export":42}],168:[function(e,t,r){"use strict";var n=e("./_is-object"),i=e("./_object-gpo"),o=e("./_wks")("hasInstance"),a=Function.prototype;o in a||e("./_object-dp").f(a,o,{value:function(e){if("function"!=typeof this||!n(e))return!1;if(!n(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},{"./_is-object":61,"./_object-dp":81,"./_object-gpo":88,"./_wks":138}],169:[function(e,t,r){var n=e("./_object-dp").f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||e("./_descriptors")&&n(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(e){return""}}})},{"./_descriptors":38,"./_object-dp":81}],170:[function(e,t,r){"use strict";var n=e("./_collection-strong"),i=e("./_validate-collection");t.exports=e("./_collection")("Map",function(t){return function(e){return t(this,0<arguments.length?e:void 0)}},{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},{"./_collection":31,"./_collection-strong":28,"./_validate-collection":135}],171:[function(e,t,r){var n=e("./_export"),i=e("./_math-log1p"),o=Math.sqrt,a=Math.acosh;n(n.S+n.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:94906265.62425156<e?Math.log(e)+Math.LN2:i(e-1+o(e-1)*o(e+1))}})},{"./_export":42,"./_math-log1p":72}],172:[function(e,t,r){var n=e("./_export"),i=Math.asinh;n(n.S+n.F*!(i&&0<1/i(0)),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},{"./_export":42}],173:[function(e,t,r){var n=e("./_export"),i=Math.atanh;n(n.S+n.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},{"./_export":42}],174:[function(e,t,r){var n=e("./_export"),i=e("./_math-sign");n(n.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},{"./_export":42,"./_math-sign":74}],175:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},{"./_export":42}],176:[function(e,t,r){var n=e("./_export"),i=Math.exp;n(n.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},{"./_export":42}],177:[function(e,t,r){var n=e("./_export"),i=e("./_math-expm1");n(n.S+n.F*(i!=Math.expm1),"Math",{expm1:i})},{"./_export":42,"./_math-expm1":70}],178:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{fround:e("./_math-fround")})},{"./_export":42,"./_math-fround":71}],179:[function(e,t,r){var n=e("./_export"),u=Math.abs;n(n.S,"Math",{hypot:function(e,t){for(var r,n,i=0,o=0,a=arguments.length,s=0;o<a;)s<(r=u(arguments[o++]))?(i=i*(n=s/r)*n+1,s=r):i+=0<r?(n=r/s)*n:r;return s===1/0?1/0:s*Math.sqrt(i)}})},{"./_export":42}],180:[function(e,t,r){var n=e("./_export"),i=Math.imul;n(n.S+n.F*e("./_fails")(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(e,t){var r=65535,n=+e,i=+t,o=r&n,a=r&i;return 0|o*a+((r&n>>>16)*a+o*(r&i>>>16)<<16>>>0)}})},{"./_export":42,"./_fails":44}],181:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},{"./_export":42}],182:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{log1p:e("./_math-log1p")})},{"./_export":42,"./_math-log1p":72}],183:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},{"./_export":42}],184:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{sign:e("./_math-sign")})},{"./_export":42,"./_math-sign":74}],185:[function(e,t,r){var n=e("./_export"),i=e("./_math-expm1"),o=Math.exp;n(n.S+n.F*e("./_fails")(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(o(e-1)-o(-e-1))*(Math.E/2)}})},{"./_export":42,"./_fails":44,"./_math-expm1":70}],186:[function(e,t,r){var n=e("./_export"),i=e("./_math-expm1"),o=Math.exp;n(n.S,"Math",{tanh:function(e){var t=i(e=+e),r=i(-e);return t==1/0?1:r==1/0?-1:(t-r)/(o(e)+o(-e))}})},{"./_export":42,"./_math-expm1":70}],187:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{trunc:function(e){return(0<e?Math.floor:Math.ceil)(e)}})},{"./_export":42}],188:[function(e,t,r){"use strict";function n(e){var t=c(e,!1);if("string"==typeof t&&2<t.length){var r,n,i,o=(t=_?t.trim():h(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(r=t.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+t}for(var a,s=t.slice(2),u=0,l=s.length;u<l;u++)if((a=s.charCodeAt(u))<48||i<a)return NaN;return parseInt(s,n)}}return+t}var i=e("./_global"),o=e("./_has"),a=e("./_cof"),s=e("./_inherit-if-required"),c=e("./_to-primitive"),u=e("./_fails"),l=e("./_object-gopn").f,d=e("./_object-gopd").f,f=e("./_object-dp").f,h=e("./_string-trim").trim,p="Number",m=i[p],g=m,v=m.prototype,y=a(e("./_object-create")(v))==p,_="trim"in String.prototype;if(!m(" 0o1")||!m("0b1")||m("+0x1")){m=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof m&&(y?u(function(){v.valueOf.call(r)}):a(r)!=p)?s(new g(n(t)),r,m):n(t)};for(var b,E=e("./_descriptors")?l(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;E.length>w;w++)o(g,b=E[w])&&!o(m,b)&&f(m,b,d(g,b));(m.prototype=v).constructor=m,e("./_redefine")(i,p,m)}},{"./_cof":27,"./_descriptors":38,"./_fails":44,"./_global":50,"./_has":51,"./_inherit-if-required":55,"./_object-create":80,"./_object-dp":81,"./_object-gopd":84,"./_object-gopn":86,"./_redefine":101,"./_string-trim":120,"./_to-primitive":129}],189:[function(e,t,r){var n=e("./_export");n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},{"./_export":42}],190:[function(e,t,r){var n=e("./_export"),i=e("./_global").isFinite;n(n.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},{"./_export":42,"./_global":50}],191:[function(e,t,r){var n=e("./_export");n(n.S,"Number",{isInteger:e("./_is-integer")})},{"./_export":42,"./_is-integer":60}],192:[function(e,t,r){var n=e("./_export");n(n.S,"Number",{isNaN:function(e){return e!=e}})},{"./_export":42}],193:[function(e,t,r){var n=e("./_export"),i=e("./_is-integer"),o=Math.abs;n(n.S,"Number",{isSafeInteger:function(e){return i(e)&&o(e)<=9007199254740991}})},{"./_export":42,"./_is-integer":60}],194:[function(e,t,r){var n=e("./_export");n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{"./_export":42}],195:[function(e,t,r){var n=e("./_export");n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},{"./_export":42}],196:[function(e,t,r){var n=e("./_export"),i=e("./_parse-float");n(n.S+n.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},{"./_export":42,"./_parse-float":95}],197:[function(e,t,r){var n=e("./_export"),i=e("./_parse-int");n(n.S+n.F*(Number.parseInt!=i),"Number",{parseInt:i})},{"./_export":42,"./_parse-int":96}],198:[function(e,t,r){"use strict";function l(e,t){for(var r=-1,n=t;++r<6;)n+=e*a[r],a[r]=n%1e7,n=o(n/1e7)}function c(e){for(var t=6,r=0;0<=--t;)r+=a[t],a[t]=o(r/e),r=r%e*1e7}function d(){for(var e=6,t="";0<=--e;)if(""!==t||0===e||0!==a[e]){var r=String(a[e]);t=""===t?r:t+p.call("0",7-r.length)+r}return t}var n=e("./_export"),f=e("./_to-integer"),h=e("./_a-number-value"),p=e("./_string-repeat"),i=1..toFixed,o=Math.floor,a=[0,0,0,0,0,0],m="Number.toFixed: incorrect invocation!",g=function(e,t,r){return 0===t?r:t%2==1?g(e,t-1,r*e):g(e*e,t/2,r)};n(n.P+n.F*(!!i&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!e("./_fails")(function(){i.call({})})),"Number",{toFixed:function(e){var t,r,n,i,o=h(this,m),a=f(e),s="",u="0";if(a<0||20<a)throw RangeError(m);if(o!=o)return"NaN";if(o<=-1e21||1e21<=o)return String(o);if(o<0&&(s="-",o=-o),1e-21<o)if(r=(t=function(e){for(var t=0,r=e;4096<=r;)t+=12,r/=4096;for(;2<=r;)t+=1,r/=2;return t}(o*g(2,69,1))-69)<0?o*g(2,-t,1):o/g(2,t,1),r*=4503599627370496,0<(t=52-t)){for(l(0,r),n=a;7<=n;)l(1e7,0),n-=7;for(l(g(10,n,1),0),n=t-1;23<=n;)c(1<<23),n-=23;c(1<<n),l(1,1),c(2),u=d()}else l(0,r),l(1<<-t,0),u=d()+p.call("0",a);return u=0<a?s+((i=u.length)<=a?"0."+p.call("0",a-i)+u:u.slice(0,i-a)+"."+u.slice(i-a)):s+u}})},{"./_a-number-value":12,"./_export":42,"./_fails":44,"./_string-repeat":119,"./_to-integer":125}],199:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_fails"),o=e("./_a-number-value"),a=1..toPrecision;n(n.P+n.F*(i(function(){return"1"!==a.call(1,void 0)})||!i(function(){a.call({})})),"Number",{toPrecision:function(e){var t=o(this,"Number#toPrecision: incorrect invocation!");return void 0===e?a.call(t):a.call(t,e)}})},{"./_a-number-value":12,"./_export":42,"./_fails":44}],200:[function(e,t,r){var n=e("./_export");n(n.S+n.F,"Object",{assign:e("./_object-assign")})},{"./_export":42,"./_object-assign":79}],201:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{create:e("./_object-create")})},{"./_export":42,"./_object-create":80}],202:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperties:e("./_object-dps")})},{"./_descriptors":38,"./_export":42,"./_object-dps":82}],203:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":38,"./_export":42,"./_object-dp":81}],204:[function(e,t,r){var n=e("./_is-object"),i=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(t){return function(e){return t&&n(e)?t(i(e)):e}})},{"./_is-object":61,"./_meta":75,"./_object-sap":92}],205:[function(e,t,r){var n=e("./_to-iobject"),i=e("./_object-gopd").f;e("./_object-sap")("getOwnPropertyDescriptor",function(){return function(e,t){return i(n(e),t)}})},{"./_object-gopd":84,"./_object-sap":92,"./_to-iobject":126}],206:[function(e,t,r){e("./_object-sap")("getOwnPropertyNames",function(){return e("./_object-gopn-ext").f})},{"./_object-gopn-ext":85,"./_object-sap":92}],207:[function(e,t,r){var n=e("./_to-object"),i=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return i(n(e))}})},{"./_object-gpo":88,"./_object-sap":92,"./_to-object":128}],208:[function(e,t,r){var n=e("./_is-object");e("./_object-sap")("isExtensible",function(t){return function(e){return!!n(e)&&(!t||t(e))}})},{"./_is-object":61,"./_object-sap":92}],209:[function(e,t,r){var n=e("./_is-object");e("./_object-sap")("isFrozen",function(t){return function(e){return!n(e)||!!t&&t(e)}})},{"./_is-object":61,"./_object-sap":92}],210:[function(e,t,r){var n=e("./_is-object");e("./_object-sap")("isSealed",function(t){return function(e){return!n(e)||!!t&&t(e)}})},{"./_is-object":61,"./_object-sap":92}],211:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{is:e("./_same-value")})},{"./_export":42,"./_same-value":105}],212:[function(e,t,r){var n=e("./_to-object"),i=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return i(n(e))}})},{"./_object-keys":90,"./_object-sap":92,"./_to-object":128}],213:[function(e,t,r){var n=e("./_is-object"),i=e("./_meta").onFreeze;e("./_object-sap")("preventExtensions",function(t){return function(e){return t&&n(e)?t(i(e)):e}})},{"./_is-object":61,"./_meta":75,"./_object-sap":92}],214:[function(e,t,r){var n=e("./_is-object"),i=e("./_meta").onFreeze;e("./_object-sap")("seal",function(t){return function(e){return t&&n(e)?t(i(e)):e}})},{"./_is-object":61,"./_meta":75,"./_object-sap":92}],215:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":42,"./_set-proto":108}],216:[function(e,t,r){"use strict";var n=e("./_classof"),i={};i[e("./_wks")("toStringTag")]="z",i+""!="[object z]"&&e("./_redefine")(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},{"./_classof":26,"./_redefine":101,"./_wks":138}],217:[function(e,t,r){var n=e("./_export"),i=e("./_parse-float");n(n.G+n.F*(parseFloat!=i),{parseFloat:i})},{"./_export":42,"./_parse-float":95}],218:[function(e,t,r){var n=e("./_export"),i=e("./_parse-int");n(n.G+n.F*(parseInt!=i),{parseInt:i})},{"./_export":42,"./_parse-int":96}],219:[function(r,e,t){"use strict";function n(){}function d(e){var t;return!(!g(e)||"function"!=typeof(t=e.then))&&t}function i(c,r){if(!c._n){c._n=!0;var n=c._c;w(function(){for(var u=c._v,l=1==c._s,e=0,t=function(e){var t,r,n,i=l?e.ok:e.fail,o=e.resolve,a=e.reject,s=e.domain;try{i?(l||(2==c._h&&j(c),c._h=1),!0===i?t=u:(s&&s.enter(),t=i(u),s&&(s.exit(),n=!0)),t===e.promise?a(R("Promise-chain cycle")):(r=d(t))?r.call(t,o,a):o(t)):a(u)}catch(e){s&&!n&&s.exit(),a(e)}};n.length>e;)t(n[e++]);c._c=[],c._n=!1,r&&!c._h&&k(c)})}}function o(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),i(t,!0))}var a,s,u,l,c=r("./_library"),f=r("./_global"),h=r("./_ctx"),p=r("./_classof"),m=r("./_export"),g=r("./_is-object"),v=r("./_a-function"),y=r("./_an-instance"),_=r("./_for-of"),b=r("./_species-constructor"),E=r("./_task").set,w=r("./_microtask")(),A=r("./_new-promise-capability"),T=r("./_perform"),S=r("./_user-agent"),x=r("./_promise-resolve"),M="Promise",R=f.TypeError,O=f.process,P=O&&O.versions,C=P&&P.v8||"",D=f[M],I="process"==p(O),L=s=A.f,N=!!function(){try{var e=D.resolve(1),t=(e.constructor={})[r("./_wks")("species")]=function(e){e(n,n)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then(n)instanceof t&&0!==C.indexOf("6.6")&&-1===S.indexOf("Chrome/66")}catch(e){}}(),k=function(o){E.call(f,function(){var e,t,r,n=o._v,i=F(o);if(i&&(e=T(function(){I?O.emit("unhandledRejection",n,o):(t=f.onunhandledrejection)?t({promise:o,reason:n}):(r=f.console)&&r.error&&r.error("Unhandled promise rejection",n)}),o._h=I||F(o)?2:1),o._a=void 0,i&&e.e)throw e.v})},F=function(e){return 1!==e._h&&0===(e._a||e._c).length},j=function(t){E.call(f,function(){var e;I?O.emit("rejectionHandled",t):(e=f.onrejectionhandled)&&e({promise:t,reason:t._v})})},B=function(e){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw R("Promise can't be resolved itself");(r=d(e))?w(function(){var t={_w:n,_d:!1};try{r.call(e,h(B,t,1),h(o,t,1))}catch(e){o.call(t,e)}}):(n._v=e,n._s=1,i(n,!1))}catch(e){o.call({_w:n,_d:!1},e)}}};N||(D=function(e){y(this,D,M,"_h"),v(e),a.call(this);try{e(h(B,this,1),h(o,this,1))}catch(e){o.call(this,e)}},(a=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r("./_redefine-all")(D.prototype,{then:function(e,t){var r=L(b(this,D));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=I?O.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&i(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),u=function(){var e=new a;this.promise=e,this.resolve=h(B,e,1),this.reject=h(o,e,1)},A.f=L=function(e){return e===D||e===l?new u(e):s(e)}),m(m.G+m.W+m.F*!N,{Promise:D}),r("./_set-to-string-tag")(D,M),r("./_set-species")(M),l=r("./_core")[M],m(m.S+m.F*!N,M,{reject:function(e){var t=L(this);return(0,t.reject)(e),t.promise}}),m(m.S+m.F*(c||!N),M,{resolve:function(e){return x(c&&this===l?D:this,e)}}),m(m.S+m.F*!(N&&r("./_iter-detect")(function(e){D.all(e).catch(n)})),M,{all:function(e){var a=this,t=L(a),s=t.resolve,u=t.reject,r=T(function(){var n=[],i=0,o=1;_(e,!1,function(e){var t=i++,r=!1;n.push(void 0),o++,a.resolve(e).then(function(e){r||(r=!0,n[t]=e,--o||s(n))},u)}),--o||s(n)});return r.e&&u(r.v),t.promise},race:function(e){var t=this,r=L(t),n=r.reject,i=T(function(){_(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}})},{"./_a-function":11,"./_an-instance":15,"./_classof":26,"./_core":32,"./_ctx":34,"./_export":42,"./_for-of":48,"./_global":50,"./_is-object":61,"./_iter-detect":66,"./_library":69,"./_microtask":77,"./_new-promise-capability":78,"./_perform":97,"./_promise-resolve":98,"./_redefine-all":100,"./_set-species":109,"./_set-to-string-tag":110,"./_species-constructor":113,"./_task":122,"./_user-agent":134,"./_wks":138}],220:[function(e,t,r){var n=e("./_export"),o=e("./_a-function"),a=e("./_an-object"),s=(e("./_global").Reflect||{}).apply,u=Function.apply;n(n.S+n.F*!e("./_fails")(function(){s(function(){})}),"Reflect",{apply:function(e,t,r){var n=o(e),i=a(r);return s?s(n,t,i):u.call(n,t,i)}})},{"./_a-function":11,"./_an-object":16,"./_export":42,"./_fails":44,"./_global":50}],221:[function(e,t,r){var n=e("./_export"),u=e("./_object-create"),l=e("./_a-function"),c=e("./_an-object"),d=e("./_is-object"),i=e("./_fails"),f=e("./_bind"),h=(e("./_global").Reflect||{}).construct,p=i(function(){function e(){}return!(h(function(){},[],e)instanceof e)}),m=!i(function(){h(function(){})});n(n.S+n.F*(p||m),"Reflect",{construct:function(e,t,r){l(e),c(t);var n=arguments.length<3?e:l(r);if(m&&!p)return h(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var i=[null];return i.push.apply(i,t),new(f.apply(e,i))}var o=n.prototype,a=u(d(o)?o:Object.prototype),s=Function.apply.call(e,a,t);return d(s)?s:a}})},{"./_a-function":11,"./_an-object":16,"./_bind":25,"./_export":42,"./_fails":44,"./_global":50,"./_is-object":61,"./_object-create":80}],222:[function(e,t,r){var n=e("./_object-dp"),i=e("./_export"),o=e("./_an-object"),a=e("./_to-primitive");i(i.S+i.F*e("./_fails")(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,r){o(e),t=a(t,!0),o(r);try{return n.f(e,t,r),!0}catch(e){return!1}}})},{"./_an-object":16,"./_export":42,"./_fails":44,"./_object-dp":81,"./_to-primitive":129}],223:[function(e,t,r){var n=e("./_export"),i=e("./_object-gopd").f,o=e("./_an-object");n(n.S,"Reflect",{deleteProperty:function(e,t){var r=i(o(e),t);return!(r&&!r.configurable)&&delete e[t]}})},{"./_an-object":16,"./_export":42,"./_object-gopd":84}],224:[function(e,t,r){"use strict";function n(e){this._t=o(e),this._i=0;var t,r=this._k=[];for(t in e)r.push(t)}var i=e("./_export"),o=e("./_an-object");e("./_iter-create")(n,"Object",function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}}),i(i.S,"Reflect",{enumerate:function(e){return new n(e)}})},{"./_an-object":16,"./_export":42,"./_iter-create":64}],225:[function(e,t,r){var n=e("./_object-gopd"),i=e("./_export"),o=e("./_an-object");i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return n.f(o(e),t)}})},{"./_an-object":16,"./_export":42,"./_object-gopd":84}],226:[function(e,t,r){var n=e("./_export"),i=e("./_object-gpo"),o=e("./_an-object");n(n.S,"Reflect",{getPrototypeOf:function(e){return i(o(e))}})},{"./_an-object":16,"./_export":42,"./_object-gpo":88}],227:[function(e,t,r){var a=e("./_object-gopd"),s=e("./_object-gpo"),u=e("./_has"),n=e("./_export"),l=e("./_is-object"),c=e("./_an-object");n(n.S,"Reflect",{get:function e(t,r){var n,i,o=arguments.length<3?t:arguments[2];return c(t)===o?t[r]:(n=a.f(t,r))?u(n,"value")?n.value:void 0!==n.get?n.get.call(o):void 0:l(i=s(t))?e(i,r,o):void 0}})},{"./_an-object":16,"./_export":42,"./_has":51,"./_is-object":61,"./_object-gopd":84,"./_object-gpo":88}],228:[function(e,t,r){var n=e("./_export");n(n.S,"Reflect",{has:function(e,t){return t in e}})},{"./_export":42}],229:[function(e,t,r){var n=e("./_export"),i=e("./_an-object"),o=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function(e){return i(e),!o||o(e)}})},{"./_an-object":16,"./_export":42}],230:[function(e,t,r){var n=e("./_export");n(n.S,"Reflect",{ownKeys:e("./_own-keys")})},{"./_export":42,"./_own-keys":94}],231:[function(e,t,r){var n=e("./_export"),i=e("./_an-object"),o=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function(e){i(e);try{return o&&o(e),!0}catch(e){return!1}}})},{"./_an-object":16,"./_export":42}],232:[function(e,t,r){var n=e("./_export"),i=e("./_set-proto");i&&n(n.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},{"./_export":42,"./_set-proto":108}],233:[function(e,t,r){var u=e("./_object-dp"),l=e("./_object-gopd"),c=e("./_object-gpo"),d=e("./_has"),n=e("./_export"),f=e("./_property-desc"),h=e("./_an-object"),p=e("./_is-object");n(n.S,"Reflect",{set:function e(t,r,n){var i,o,a=arguments.length<4?t:arguments[3],s=l.f(h(t),r);if(!s){if(p(o=c(t)))return e(o,r,n,a);s=f(0)}if(d(s,"value")){if(!1===s.writable||!p(a))return!1;if(i=l.f(a,r)){if(i.get||i.set||!1===i.writable)return!1;i.value=n,u.f(a,r,i)}else u.f(a,r,f(0,n));return!0}return void 0!==s.set&&(s.set.call(a,n),!0)}})},{"./_an-object":16,"./_export":42,"./_has":51,"./_is-object":61,"./_object-dp":81,"./_object-gopd":84,"./_object-gpo":88,"./_property-desc":99}],234:[function(e,t,r){var n=e("./_global"),o=e("./_inherit-if-required"),i=e("./_object-dp").f,a=e("./_object-gopn").f,s=e("./_is-regexp"),u=e("./_flags"),l=n.RegExp,c=l,d=l.prototype,f=/a/g,h=/a/g,p=new l(f)!==f;if(e("./_descriptors")&&(!p||e("./_fails")(function(){return h[e("./_wks")("match")]=!1,l(f)!=f||l(h)==h||"/a/i"!=l(f,"i")}))){l=function(e,t){var r=this instanceof l,n=s(e),i=void 0===t;return!r&&n&&e.constructor===l&&i?e:o(p?new c(n&&!i?e.source:e,t):c((n=e instanceof l)?e.source:e,n&&i?u.call(e):t),r?this:d,l)};function m(t){t in l||i(l,t,{configurable:!0,get:function(){return c[t]},set:function(e){c[t]=e}})}for(var g=a(c),v=0;g.length>v;)m(g[v++]);(d.constructor=l).prototype=d,e("./_redefine")(n,"RegExp",l)}e("./_set-species")("RegExp")},{"./_descriptors":38,"./_fails":44,"./_flags":46,"./_global":50,"./_inherit-if-required":55,"./_is-regexp":62,"./_object-dp":81,"./_object-gopn":86,"./_redefine":101,"./_set-species":109,"./_wks":138}],235:[function(e,t,r){"use strict";var n=e("./_regexp-exec");e("./_export")({target:"RegExp",proto:!0,forced:n!==/./.exec},{exec:n})},{"./_export":42,"./_regexp-exec":103}],236:[function(e,t,r){e("./_descriptors")&&"g"!=/./g.flags&&e("./_object-dp").f(RegExp.prototype,"flags",{configurable:!0,get:e("./_flags")})},{"./_descriptors":38,"./_flags":46,"./_object-dp":81}],237:[function(e,t,r){"use strict";var d=e("./_an-object"),f=e("./_to-length"),h=e("./_advance-string-index"),p=e("./_regexp-exec-abstract");e("./_fix-re-wks")("match",1,function(n,i,l,c){return[function(e){var t=n(this),r=null==e?void 0:e[i];return void 0!==r?r.call(e,t):new RegExp(e)[i](String(t))},function(e){var t=c(l,e,this);if(t.done)return t.value;var r=d(e),n=String(this);if(!r.global)return p(r,n);for(var i,o=r.unicode,a=[],s=r.lastIndex=0;null!==(i=p(r,n));){var u=String(i[0]);""===(a[s]=u)&&(r.lastIndex=h(n,f(r.lastIndex),o)),s++}return 0===s?null:a}]})},{"./_advance-string-index":14,"./_an-object":16,"./_fix-re-wks":45,"./_regexp-exec-abstract":102,"./_to-length":127}],238:[function(e,t,r){"use strict";var T=e("./_an-object"),n=e("./_to-object"),S=e("./_to-length"),x=e("./_to-integer"),M=e("./_advance-string-index"),R=e("./_regexp-exec-abstract"),O=Math.max,P=Math.min,f=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;e("./_fix-re-wks")("replace",2,function(i,o,E,w){return[function(e,t){var r=i(this),n=null==e?void 0:e[o];return void 0!==n?n.call(e,r,t):E.call(String(r),e,t)},function(e,t){var r=w(E,e,this,t);if(r.done)return r.value;var n=T(e),i=String(this),o="function"==typeof t;o||(t=String(t));var a=n.global;if(a){var s=n.unicode;n.lastIndex=0}for(var u=[];;){var l=R(n,i);if(null===l)break;if(u.push(l),!a)break;""===String(l[0])&&(n.lastIndex=M(i,S(n.lastIndex),s))}for(var c,d="",f=0,h=0;h<u.length;h++){l=u[h];for(var p=String(l[0]),m=O(P(x(l.index),i.length),0),g=[],v=1;v<l.length;v++)g.push(void 0===(c=l[v])?c:String(c));var y=l.groups;if(o){var _=[p].concat(g,m,i);void 0!==y&&_.push(y);var b=String(t.apply(void 0,_))}else b=A(p,i,m,g,y,t);f<=m&&(d+=i.slice(f,m)+b,f=m+p.length)}return d+i.slice(f)}];function A(o,a,s,u,l,e){var c=s+o.length,d=u.length,t=p;return void 0!==l&&(l=n(l),t=h),E.call(e,t,function(e,t){var r;switch(t.charAt(0)){case"$":return"$";case"&":return o;case"`":return a.slice(0,s);case"'":return a.slice(c);case"<":r=l[t.slice(1,-1)];break;default:var n=+t;if(0==n)return e;if(d<n){var i=f(n/10);return 0===i?e:i<=d?void 0===u[i-1]?t.charAt(1):u[i-1]+t.charAt(1):e}r=u[n-1]}return void 0===r?"":r})}})},{"./_advance-string-index":14,"./_an-object":16,"./_fix-re-wks":45,"./_regexp-exec-abstract":102,"./_to-integer":125,"./_to-length":127,"./_to-object":128}],239:[function(e,t,r){"use strict";var u=e("./_an-object"),l=e("./_same-value"),c=e("./_regexp-exec-abstract");e("./_fix-re-wks")("search",1,function(n,i,a,s){return[function(e){var t=n(this),r=null==e?void 0:e[i];return void 0!==r?r.call(e,t):new RegExp(e)[i](String(t))},function(e){var t=s(a,e,this);if(t.done)return t.value;var r=u(e),n=String(this),i=r.lastIndex;l(i,0)||(r.lastIndex=0);var o=c(r,n);return l(r.lastIndex,i)||(r.lastIndex=i),null===o?-1:o.index}]})},{"./_an-object":16,"./_fix-re-wks":45,"./_regexp-exec-abstract":102,"./_same-value":105}],240:[function(e,t,r){"use strict";var d=e("./_is-regexp"),_=e("./_an-object"),b=e("./_species-constructor"),E=e("./_advance-string-index"),w=e("./_to-length"),A=e("./_regexp-exec-abstract"),f=e("./_regexp-exec"),n=e("./_fails"),T=Math.min,h=[].push,a="split",p="length",m="lastIndex",S=4294967295,x=!n(function(){RegExp(S,"y")});e("./_fix-re-wks")("split",2,function(i,o,g,v){var y;return y="c"=="abbc"[a](/(b)*/)[1]||4!="test"[a](/(?:)/,-1)[p]||2!="ab"[a](/(?:ab)*/)[p]||4!="."[a](/(.?)(.?)/)[p]||1<"."[a](/()()/)[p]||""[a](/.?/)[p]?function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!d(e))return g.call(r,e,t);for(var n,i,o,a=[],s=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,l=void 0===t?S:t>>>0,c=new RegExp(e.source,s+"g");(n=f.call(c,r))&&!(u<(i=c[m])&&(a.push(r.slice(u,n.index)),1<n[p]&&n.index<r[p]&&h.apply(a,n.slice(1)),o=n[0][p],u=i,a[p]>=l));)c[m]===n.index&&c[m]++;return u===r[p]?!o&&c.test("")||a.push(""):a.push(r.slice(u)),a[p]>l?a.slice(0,l):a}:"0"[a](void 0,0)[p]?function(e,t){return void 0===e&&0===t?[]:g.call(this,e,t)}:g,[function(e,t){var r=i(this),n=null==e?void 0:e[o];return void 0!==n?n.call(e,r,t):y.call(String(r),e,t)},function(e,t){var r=v(y,e,this,t,y!==g);if(r.done)return r.value;var n=_(e),i=String(this),o=b(n,RegExp),a=n.unicode,s=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(x?"y":"g"),u=new o(x?n:"^(?:"+n.source+")",s),l=void 0===t?S:t>>>0;if(0==l)return[];if(0===i.length)return null===A(u,i)?[i]:[];for(var c=0,d=0,f=[];d<i.length;){u.lastIndex=x?d:0;var h,p=A(u,x?i:i.slice(d));if(null===p||(h=T(w(u.lastIndex+(x?0:d)),i.length))===c)d=E(i,d,a);else{if(f.push(i.slice(c,d)),f.length===l)return f;for(var m=1;m<=p.length-1;m++)if(f.push(p[m]),f.length===l)return f;d=c=h}}return f.push(i.slice(c)),f}]})},{"./_advance-string-index":14,"./_an-object":16,"./_fails":44,"./_fix-re-wks":45,"./_is-regexp":62,"./_regexp-exec":103,"./_regexp-exec-abstract":102,"./_species-constructor":113,"./_to-length":127}],241:[function(t,e,r){"use strict";t("./es6.regexp.flags");function n(e){t("./_redefine")(RegExp.prototype,s,e,!0)}var i=t("./_an-object"),o=t("./_flags"),a=t("./_descriptors"),s="toString",u=/./[s];t("./_fails")(function(){return"/a/b"!=u.call({source:"a",flags:"b"})})?n(function(){var e=i(this);return"/".concat(e.source,"/","flags"in e?e.flags:!a&&e instanceof RegExp?o.call(e):void 0)}):u.name!=s&&n(function(){return u.call(this)})},{"./_an-object":16,"./_descriptors":38,"./_fails":44,"./_flags":46,"./_redefine":101,"./es6.regexp.flags":236}],242:[function(e,t,r){"use strict";var n=e("./_collection-strong"),i=e("./_validate-collection");t.exports=e("./_collection")("Set",function(t){return function(e){return t(this,0<arguments.length?e:void 0)}},{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},{"./_collection":31,"./_collection-strong":28,"./_validate-collection":135}],243:[function(e,t,r){"use strict";e("./_string-html")("anchor",function(t){return function(e){return t(this,"a","name",e)}})},{"./_string-html":117}],244:[function(e,t,r){"use strict";e("./_string-html")("big",function(e){return function(){return e(this,"big","","")}})},{"./_string-html":117}],245:[function(e,t,r){"use strict";e("./_string-html")("blink",function(e){return function(){return e(this,"blink","","")}})},{"./_string-html":117}],246:[function(e,t,r){"use strict";e("./_string-html")("bold",function(e){return function(){return e(this,"b","","")}})},{"./_string-html":117}],247:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_string-at")(!1);n(n.P,"String",{codePointAt:function(e){return i(this,e)}})},{"./_export":42,"./_string-at":115}],248:[function(e,t,r){"use strict";var n=e("./_export"),s=e("./_to-length"),u=e("./_string-context"),l="endsWith",c=""[l];n(n.P+n.F*e("./_fails-is-regexp")(l),"String",{endsWith:function(e,t){var r=u(this,e,l),n=1<arguments.length?t:void 0,i=s(r.length),o=void 0===n?i:Math.min(s(n),i),a=String(e);return c?c.call(r,a,o):r.slice(o-a.length,o)===a}})},{"./_export":42,"./_fails-is-regexp":43,"./_string-context":116,"./_to-length":127}],249:[function(e,t,r){"use strict";e("./_string-html")("fixed",function(e){return function(){return e(this,"tt","","")}})},{"./_string-html":117}],250:[function(e,t,r){"use strict";e("./_string-html")("fontcolor",function(t){return function(e){return t(this,"font","color",e)}})},{"./_string-html":117}],251:[function(e,t,r){"use strict";e("./_string-html")("fontsize",function(t){return function(e){return t(this,"font","size",e)}})},{"./_string-html":117}],252:[function(e,t,r){var n=e("./_export"),o=e("./_to-absolute-index"),a=String.fromCharCode,i=String.fromCodePoint;n(n.S+n.F*(!!i&&1!=i.length),"String",{fromCodePoint:function(e){for(var t,r=[],n=arguments.length,i=0;i<n;){if(t=+arguments[i++],o(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?a(t):a(55296+((t-=65536)>>10),t%1024+56320))}return r.join("")}})},{"./_export":42,"./_to-absolute-index":123}],253:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_string-context");n(n.P+n.F*e("./_fails-is-regexp")("includes"),"String",{includes:function(e,t){return!!~i(this,e,"includes").indexOf(e,1<arguments.length?t:void 0)}})},{"./_export":42,"./_fails-is-regexp":43,"./_string-context":116}],254:[function(e,t,r){"use strict";e("./_string-html")("italics",function(e){return function(){return e(this,"i","","")}})},{"./_string-html":117}],255:[function(e,t,r){"use strict";var n=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":65,"./_string-at":115}],256:[function(e,t,r){"use strict";e("./_string-html")("link",function(t){return function(e){return t(this,"a","href",e)}})},{"./_string-html":117}],257:[function(e,t,r){var n=e("./_export"),a=e("./_to-iobject"),s=e("./_to-length");n(n.S,"String",{raw:function(e){for(var t=a(e.raw),r=s(t.length),n=arguments.length,i=[],o=0;o<r;)i.push(String(t[o++])),o<n&&i.push(String(arguments[o]));return i.join("")}})},{"./_export":42,"./_to-iobject":126,"./_to-length":127}],258:[function(e,t,r){var n=e("./_export");n(n.P,"String",{repeat:e("./_string-repeat")})},{"./_export":42,"./_string-repeat":119}],259:[function(e,t,r){"use strict";e("./_string-html")("small",function(e){return function(){return e(this,"small","","")}})},{"./_string-html":117}],260:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_to-length"),a=e("./_string-context"),s="startsWith",u=""[s];n(n.P+n.F*e("./_fails-is-regexp")(s),"String",{startsWith:function(e,t){var r=a(this,e,s),n=o(Math.min(1<arguments.length?t:void 0,r.length)),i=String(e);return u?u.call(r,i,n):r.slice(n,n+i.length)===i}})},{"./_export":42,"./_fails-is-regexp":43,"./_string-context":116,"./_to-length":127}],261:[function(e,t,r){"use strict";e("./_string-html")("strike",function(e){return function(){return e(this,"strike","","")}})},{"./_string-html":117}],262:[function(e,t,r){"use strict";e("./_string-html")("sub",function(e){return function(){return e(this,"sub","","")}})},{"./_string-html":117}],263:[function(e,t,r){"use strict";e("./_string-html")("sup",function(e){return function(){return e(this,"sup","","")}})},{"./_string-html":117}],264:[function(e,t,r){"use strict";e("./_string-trim")("trim",function(e){return function(){return e(this,3)}})},{"./_string-trim":120}],265:[function(e,t,r){"use strict";function n(e){var t=Y[e]=P(B[H]);return t._k=e,t}function i(e,t){T(e);for(var r,n=w(t=M(t)),i=0,o=n.length;i<o;)te(e,r=n[i++],t[r]);return e}function o(e){var t=W.call(this,e=R(e,!0));return!(this===X&&c(Y,e)&&!c(K,e))&&(!(t||!c(this,e)||!c(Y,e)||c(this,V)&&this[V][e])||t)}function a(e,t){if(e=M(e),t=R(t,!0),e!==X||!c(Y,t)||c(K,t)){var r=k(e,t);return!r||!c(Y,t)||c(e,V)&&e[V][t]||(r.enumerable=!0),r}}function s(e){for(var t,r=j(M(e)),n=[],i=0;r.length>i;)c(Y,t=r[i++])||t==V||t==p||n.push(t);return n}function u(e){for(var t,r=e===X,n=j(r?K:M(e)),i=[],o=0;n.length>o;)!c(Y,t=n[o++])||r&&!c(X,t)||i.push(Y[t]);return i}var l=e("./_global"),c=e("./_has"),d=e("./_descriptors"),f=e("./_export"),h=e("./_redefine"),p=e("./_meta").KEY,m=e("./_fails"),g=e("./_shared"),v=e("./_set-to-string-tag"),y=e("./_uid"),_=e("./_wks"),b=e("./_wks-ext"),E=e("./_wks-define"),w=e("./_enum-keys"),A=e("./_is-array"),T=e("./_an-object"),S=e("./_is-object"),x=e("./_to-object"),M=e("./_to-iobject"),R=e("./_to-primitive"),O=e("./_property-desc"),P=e("./_object-create"),C=e("./_object-gopn-ext"),D=e("./_object-gopd"),I=e("./_object-gops"),L=e("./_object-dp"),N=e("./_object-keys"),k=D.f,F=L.f,j=C.f,B=l.Symbol,U=l.JSON,G=U&&U.stringify,H="prototype",V=_("_hidden"),z=_("toPrimitive"),W={}.propertyIsEnumerable,q=g("symbol-registry"),Y=g("symbols"),K=g("op-symbols"),X=Object[H],Q="function"==typeof B&&!!I.f,J=l.QObject,Z=!J||!J[H]||!J[H].findChild,$=d&&m(function(){return 7!=P(F({},"a",{get:function(){return F(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=k(X,t);n&&delete X[t],F(e,t,r),n&&e!==X&&F(X,t,n)}:F,ee=Q&&"symbol"==typeof B.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof B},te=function(e,t,r){return e===X&&te(K,t,r),T(e),t=R(t,!0),T(r),c(Y,t)?(r.enumerable?(c(e,V)&&e[V][t]&&(e[V][t]=!1),r=P(r,{enumerable:O(0,!1)})):(c(e,V)||F(e,V,O(1,{})),e[V][t]=!0),$(e,t,r)):F(e,t,r)};Q||(h((B=function(e){if(this instanceof B)throw TypeError("Symbol is not a constructor!");var t=y(0<arguments.length?e:void 0),r=function(e){this===X&&r.call(K,e),c(this,V)&&c(this[V],t)&&(this[V][t]=!1),$(this,t,O(1,e))};return d&&Z&&$(X,t,{configurable:!0,set:r}),n(t)})[H],"toString",function(){return this._k}),D.f=a,L.f=te,e("./_object-gopn").f=C.f=s,e("./_object-pie").f=o,I.f=u,d&&!e("./_library")&&h(X,"propertyIsEnumerable",o,!0),b.f=function(e){return n(_(e))}),f(f.G+f.W+f.F*!Q,{Symbol:B});for(var re="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;re.length>ne;)_(re[ne++]);for(var ie=N(_.store),oe=0;ie.length>oe;)E(ie[oe++]);f(f.S+f.F*!Q,"Symbol",{for:function(e){return c(q,e+="")?q[e]:q[e]=B(e)},keyFor:function(e){if(!ee(e))throw TypeError(e+" is not a symbol!");for(var t in q)if(q[t]===e)return t},useSetter:function(){Z=!0},useSimple:function(){Z=!1}}),f(f.S+f.F*!Q,"Object",{create:function(e,t){return void 0===t?P(e):i(P(e),t)},defineProperty:te,defineProperties:i,getOwnPropertyDescriptor:a,getOwnPropertyNames:s,getOwnPropertySymbols:u});var ae=m(function(){I.f(1)});f(f.S+f.F*ae,"Object",{getOwnPropertySymbols:function(e){return I.f(x(e))}}),U&&f(f.S+f.F*(!Q||m(function(){var e=B();return"[null]"!=G([e])||"{}"!=G({a:e})||"{}"!=G(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;i<arguments.length;)n.push(arguments[i++]);if(r=t=n[1],(S(t)||void 0!==e)&&!ee(e))return A(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!ee(t))return t}),n[1]=t,G.apply(U,n)}}),B[H][z]||e("./_hide")(B[H],z,B[H].valueOf),v(B,"Symbol"),v(Math,"Math",!0),v(l.JSON,"JSON",!0)},{"./_an-object":16,"./_descriptors":38,"./_enum-keys":41,"./_export":42,"./_fails":44,"./_global":50,"./_has":51,"./_hide":52,"./_is-array":59,"./_is-object":61,"./_library":69,"./_meta":75,"./_object-create":80,"./_object-dp":81,"./_object-gopd":84,"./_object-gopn":86,"./_object-gopn-ext":85,"./_object-gops":87,"./_object-keys":90,"./_object-pie":91,"./_property-desc":99,"./_redefine":101,"./_set-to-string-tag":110,"./_shared":112,"./_to-iobject":126,"./_to-object":128,"./_to-primitive":129,"./_uid":133,"./_wks":138,"./_wks-define":136,"./_wks-ext":137}],266:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_typed"),o=e("./_typed-buffer"),l=e("./_an-object"),c=e("./_to-absolute-index"),d=e("./_to-length"),a=e("./_is-object"),s=e("./_global").ArrayBuffer,f=e("./_species-constructor"),h=o.ArrayBuffer,p=o.DataView,u=i.ABV&&s.isView,m=h.prototype.slice,g=i.VIEW,v="ArrayBuffer";n(n.G+n.W+n.F*(s!==h),{ArrayBuffer:h}),n(n.S+n.F*!i.CONSTR,v,{isView:function(e){return u&&u(e)||a(e)&&g in e}}),n(n.P+n.U+n.F*e("./_fails")(function(){return!new h(2).slice(1,void 0).byteLength}),v,{slice:function(e,t){if(void 0!==m&&void 0===t)return m.call(l(this),e);for(var r=l(this).byteLength,n=c(e,r),i=c(void 0===t?r:t,r),o=new(f(this,h))(d(i-n)),a=new p(this),s=new p(o),u=0;n<i;)s.setUint8(u++,a.getUint8(n++));return o}}),e("./_set-species")(v)},{"./_an-object":16,"./_export":42,"./_fails":44,"./_global":50,"./_is-object":61,"./_set-species":109,"./_species-constructor":113,"./_to-absolute-index":123,"./_to-length":127,"./_typed":132,"./_typed-buffer":131}],267:[function(e,t,r){var n=e("./_export");n(n.G+n.W+n.F*!e("./_typed").ABV,{DataView:e("./_typed-buffer").DataView})},{"./_export":42,"./_typed":132,"./_typed-buffer":131}],268:[function(e,t,r){e("./_typed-array")("Float32",4,function(n){return function(e,t,r){return n(this,e,t,r)}})},{"./_typed-array":130}],269:[function(e,t,r){e("./_typed-array")("Float64",8,function(n){return function(e,t,r){return n(this,e,t,r)}})},{"./_typed-array":130}],270:[function(e,t,r){e("./_typed-array")("Int16",2,function(n){return function(e,t,r){return n(this,e,t,r)}})},{"./_typed-array":130}],271:[function(e,t,r){e("./_typed-array")("Int32",4,function(n){return function(e,t,r){return n(this,e,t,r)}})},{"./_typed-array":130}],272:[function(e,t,r){e("./_typed-array")("Int8",1,function(n){return function(e,t,r){return n(this,e,t,r)}})},{"./_typed-array":130}],273:[function(e,t,r){e("./_typed-array")("Uint16",2,function(n){return function(e,t,r){return n(this,e,t,r)}})},{"./_typed-array":130}],274:[function(e,t,r){e("./_typed-array")("Uint32",4,function(n){return function(e,t,r){return n(this,e,t,r)}})},{"./_typed-array":130}],275:[function(e,t,r){e("./_typed-array")("Uint8",1,function(n){return function(e,t,r){return n(this,e,t,r)}})},{"./_typed-array":130}],276:[function(e,t,r){e("./_typed-array")("Uint8",1,function(n){return function(e,t,r){return n(this,e,t,r)}},!0)},{"./_typed-array":130}],277:[function(e,t,r){"use strict";function n(t){return function(e){return t(this,0<arguments.length?e:void 0)}}var o,i=e("./_global"),a=e("./_array-methods")(0),s=e("./_redefine"),u=e("./_meta"),l=e("./_object-assign"),c=e("./_collection-weak"),d=e("./_is-object"),f=e("./_validate-collection"),h=e("./_validate-collection"),p=!i.ActiveXObject&&"ActiveXObject"in i,m="WeakMap",g=u.getWeak,v=Object.isExtensible,y=c.ufstore,_={get:function(e){if(d(e)){var t=g(e);return!0===t?y(f(this,m)).get(e):t?t[this._i]:void 0}},set:function(e,t){return c.def(f(this,m),e,t)}},b=t.exports=e("./_collection")(m,n,_,c,!0,!0);h&&p&&(l((o=c.getConstructor(n,m)).prototype,_),u.NEED=!0,a(["delete","has","get","set"],function(n){var e=b.prototype,i=e[n];s(e,n,function(e,t){if(!d(e)||v(e))return i.call(this,e,t);this._f||(this._f=new o);var r=this._f[n](e,t);return"set"==n?this:r})}))},{"./_array-methods":21,"./_collection":31,"./_collection-weak":30,"./_global":50,"./_is-object":61,"./_meta":75,"./_object-assign":79,"./_redefine":101,"./_validate-collection":135}],278:[function(e,t,r){"use strict";var n=e("./_collection-weak"),i=e("./_validate-collection");e("./_collection")("WeakSet",function(t){return function(e){return t(this,0<arguments.length?e:void 0)}},{add:function(e){return n.def(i(this,"WeakSet"),e,!0)}},n,!1,!0)},{"./_collection":31,"./_collection-weak":30,"./_validate-collection":135}],279:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_flatten-into-array"),a=e("./_to-object"),s=e("./_to-length"),u=e("./_a-function"),l=e("./_array-species-create");n(n.P,"Array",{flatMap:function(e,t){var r,n,i=a(this);return u(e),r=s(i.length),n=l(i,0),o(n,i,i,r,0,1,e,t),n}}),e("./_add-to-unscopables")("flatMap")},{"./_a-function":11,"./_add-to-unscopables":13,"./_array-species-create":24,"./_export":42,"./_flatten-into-array":47,"./_to-length":127,"./_to-object":128}],280:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_flatten-into-array"),a=e("./_to-object"),s=e("./_to-length"),u=e("./_to-integer"),l=e("./_array-species-create");n(n.P,"Array",{flatten:function(e){var t=e,r=a(this),n=s(r.length),i=l(r,0);return o(i,r,r,n,0,void 0===t?1:u(t)),i}}),e("./_add-to-unscopables")("flatten")},{"./_add-to-unscopables":13,"./_array-species-create":24,"./_export":42,"./_flatten-into-array":47,"./_to-integer":125,"./_to-length":127,"./_to-object":128}],281:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_array-includes")(!0);n(n.P,"Array",{includes:function(e,t){return i(this,e,1<arguments.length?t:void 0)}}),e("./_add-to-unscopables")("includes")},{"./_add-to-unscopables":13,"./_array-includes":20,"./_export":42}],282:[function(e,t,r){var n=e("./_export"),i=e("./_microtask")(),o=e("./_global").process,a="process"==e("./_cof")(o);n(n.G,{asap:function(e){var t=a&&o.domain;i(t?t.bind(e):e)}})},{"./_cof":27,"./_export":42,"./_global":50,"./_microtask":77}],283:[function(e,t,r){var n=e("./_export"),i=e("./_cof");n(n.S,"Error",{isError:function(e){return"Error"===i(e)}})},{"./_cof":27,"./_export":42}],284:[function(e,t,r){var n=e("./_export");n(n.G,{global:e("./_global")})},{"./_export":42,"./_global":50}],285:[function(e,t,r){e("./_set-collection-from")("Map")},{"./_set-collection-from":106}],286:[function(e,t,r){e("./_set-collection-of")("Map")},{"./_set-collection-of":107}],287:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":29,"./_export":42}],288:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{clamp:function(e,t,r){return Math.min(r,Math.max(t,e))}})},{"./_export":42}],289:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{DEG_PER_RAD:Math.PI/180})},{"./_export":42}],290:[function(e,t,r){var n=e("./_export"),i=180/Math.PI;n(n.S,"Math",{degrees:function(e){return e*i}})},{"./_export":42}],291:[function(e,t,r){var n=e("./_export"),o=e("./_math-scale"),a=e("./_math-fround");n(n.S,"Math",{fscale:function(e,t,r,n,i){return a(o(e,t,r,n,i))}})},{"./_export":42,"./_math-fround":71,"./_math-scale":73}],292:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{iaddh:function(e,t,r,n){var i=e>>>0,o=r>>>0;return(t>>>0)+(n>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},{"./_export":42}],293:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{imulh:function(e,t){var r=+e,n=+t,i=65535&r,o=65535&n,a=r>>16,s=n>>16,u=(a*o>>>0)+(i*o>>>16);return a*s+(u>>16)+((i*s>>>0)+(65535&u)>>16)}})},{"./_export":42}],294:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{isubh:function(e,t,r,n){var i=e>>>0,o=r>>>0;return(t>>>0)-(n>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},{"./_export":42}],295:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{RAD_PER_DEG:180/Math.PI})},{"./_export":42}],296:[function(e,t,r){var n=e("./_export"),i=Math.PI/180;n(n.S,"Math",{radians:function(e){return e*i}})},{"./_export":42}],297:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{scale:e("./_math-scale")})},{"./_export":42,"./_math-scale":73}],298:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{signbit:function(e){return(e=+e)!=e?e:0==e?1/e==1/0:0<e}})},{"./_export":42}],299:[function(e,t,r){var n=e("./_export");n(n.S,"Math",{umulh:function(e,t){var r=+e,n=+t,i=65535&r,o=65535&n,a=r>>>16,s=n>>>16,u=(a*o>>>0)+(i*o>>>16);return a*s+(u>>>16)+((i*s>>>0)+(65535&u)>>>16)}})},{"./_export":42}],300:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_to-object"),o=e("./_a-function"),a=e("./_object-dp");e("./_descriptors")&&n(n.P+e("./_object-forced-pam"),"Object",{__defineGetter__:function(e,t){a.f(i(this),e,{get:o(t),enumerable:!0,configurable:!0})}})},{"./_a-function":11,"./_descriptors":38,"./_export":42,"./_object-dp":81,"./_object-forced-pam":83,"./_to-object":128}],301:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_to-object"),o=e("./_a-function"),a=e("./_object-dp");e("./_descriptors")&&n(n.P+e("./_object-forced-pam"),"Object",{__defineSetter__:function(e,t){a.f(i(this),e,{set:o(t),enumerable:!0,configurable:!0})}})},{"./_a-function":11,"./_descriptors":38,"./_export":42,"./_object-dp":81,"./_object-forced-pam":83,"./_to-object":128}],302:[function(e,t,r){var n=e("./_export"),i=e("./_object-to-array")(!0);n(n.S,"Object",{entries:function(e){return i(e)}})},{"./_export":42,"./_object-to-array":93}],303:[function(e,t,r){var n=e("./_export"),u=e("./_own-keys"),l=e("./_to-iobject"),c=e("./_object-gopd"),d=e("./_create-property");n(n.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,r,n=l(e),i=c.f,o=u(n),a={},s=0;o.length>s;)void 0!==(r=i(n,t=o[s++]))&&d(a,t,r);return a}})},{"./_create-property":33,"./_export":42,"./_object-gopd":84,"./_own-keys":94,"./_to-iobject":126}],304:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_to-object"),o=e("./_to-primitive"),a=e("./_object-gpo"),s=e("./_object-gopd").f;e("./_descriptors")&&n(n.P+e("./_object-forced-pam"),"Object",{__lookupGetter__:function(e){var t,r=i(this),n=o(e,!0);do{if(t=s(r,n))return t.get}while(r=a(r))}})},{"./_descriptors":38,"./_export":42,"./_object-forced-pam":83,"./_object-gopd":84,"./_object-gpo":88,"./_to-object":128,"./_to-primitive":129}],305:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_to-object"),o=e("./_to-primitive"),a=e("./_object-gpo"),s=e("./_object-gopd").f;e("./_descriptors")&&n(n.P+e("./_object-forced-pam"),"Object",{__lookupSetter__:function(e){var t,r=i(this),n=o(e,!0);do{if(t=s(r,n))return t.set}while(r=a(r))}})},{"./_descriptors":38,"./_export":42,"./_object-forced-pam":83,"./_object-gopd":84,"./_object-gpo":88,"./_to-object":128,"./_to-primitive":129}],306:[function(e,t,r){var n=e("./_export"),i=e("./_object-to-array")(!1);n(n.S,"Object",{values:function(e){return i(e)}})},{"./_export":42,"./_object-to-array":93}],307:[function(e,t,r){"use strict";function i(e){return null==e?void 0:h(e)}function o(e){var t=e._c;t&&(e._c=void 0,t())}function a(e){return void 0===e._o}function s(e){a(e)||(e._o=void 0,o(e))}function n(t,e){p(t),this._c=void 0,this._o=t,t=new b(this);try{var r=e(t),n=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){n.unsubscribe()}:h(r),this._c=r)}catch(e){return void t.error(e)}a(this)&&o(this)}var u=e("./_export"),l=e("./_global"),c=e("./_core"),d=e("./_microtask")(),f=e("./_wks")("observable"),h=e("./_a-function"),p=e("./_an-object"),m=e("./_an-instance"),g=e("./_redefine-all"),v=e("./_hide"),y=e("./_for-of"),_=y.RETURN;n.prototype=g({},{unsubscribe:function(){s(this)}});var b=function(e){this._s=e};b.prototype=g({},{next:function(e){var t=this._s;if(!a(t)){var r=t._o;try{var n=i(r.next);if(n)return n.call(r,e)}catch(e){try{s(t)}finally{throw e}}}},error:function(e){var t=this._s;if(a(t))throw e;var r=t._o;t._o=void 0;try{var n=i(r.error);if(!n)throw e;e=n.call(r,e)}catch(e){try{o(t)}finally{throw e}}return o(t),e},complete:function(e){var t=this._s;if(!a(t)){var r=t._o;t._o=void 0;try{var n=i(r.complete);e=n?n.call(r,e):void 0}catch(e){try{o(t)}finally{throw e}}return o(t),e}}});var E=function(e){m(this,E,"Observable","_f")._f=h(e)};g(E.prototype,{subscribe:function(e){return new n(e,this._f)},forEach:function(n){var i=this;return new(c.Promise||l.Promise)(function(e,t){h(n);var r=i.subscribe({next:function(e){try{return n(e)}catch(e){t(e),r.unsubscribe()}},error:t,complete:e})})}}),g(E,{from:function(e){var t="function"==typeof this?this:E,r=i(p(e)[f]);if(r){var n=p(r.call(e));return n.constructor===t?n:new t(function(e){return n.subscribe(e)})}return new t(function(t){var r=!1;return d(function(){if(!r){try{if(y(e,!1,function(e){if(t.next(e),r)return _})===_)return}catch(e){if(r)throw e;return void t.error(e)}t.complete()}}),function(){r=!0}})},of:function(){for(var e=0,t=arguments.length,n=new Array(t);e<t;)n[e]=arguments[e++];return new("function"==typeof this?this:E)(function(t){var r=!1;return d(function(){if(!r){for(var e=0;e<n.length;++e)if(t.next(n[e]),r)return;t.complete()}}),function(){r=!0}})}}),v(E.prototype,f,function(){return this}),u(u.G,{Observable:E}),e("./_set-species")("Observable")},{"./_a-function":11,"./_an-instance":15,"./_an-object":16,"./_core":32,"./_export":42,"./_for-of":48,"./_global":50,"./_hide":52,"./_microtask":77,"./_redefine-all":100,"./_set-species":109,"./_wks":138}],308:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_core"),o=e("./_global"),a=e("./_species-constructor"),s=e("./_promise-resolve");n(n.P+n.R,"Promise",{finally:function(t){var r=a(this,i.Promise||o.Promise),e="function"==typeof t;return this.then(e?function(e){return s(r,t()).then(function(){return e})}:t,e?function(e){return s(r,t()).then(function(){throw e})}:t)}})},{"./_core":32,"./_export":42,"./_global":50,"./_promise-resolve":98,"./_species-constructor":113}],309:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_new-promise-capability"),o=e("./_perform");n(n.S,"Promise",{try:function(e){var t=i.f(this),r=o(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},{"./_export":42,"./_new-promise-capability":78,"./_perform":97}],310:[function(e,t,r){var n=e("./_metadata"),i=e("./_an-object"),o=n.key,a=n.set;n.exp({defineMetadata:function(e,t,r,n){a(e,t,i(r),o(n))}})},{"./_an-object":16,"./_metadata":76}],311:[function(e,t,r){var n=e("./_metadata"),a=e("./_an-object"),s=n.key,u=n.map,l=n.store;n.exp({deleteMetadata:function(e,t,r){var n=arguments.length<3?void 0:s(r),i=u(a(t),n,!1);if(void 0===i||!i.delete(e))return!1;if(i.size)return!0;var o=l.get(t);return o.delete(n),!!o.size||l.delete(t)}})},{"./_an-object":16,"./_metadata":76}],312:[function(e,t,r){var o=e("./es6.set"),a=e("./_array-from-iterable"),n=e("./_metadata"),i=e("./_an-object"),s=e("./_object-gpo"),u=n.keys,l=n.key,c=function(e,t){var r=u(e,t),n=s(e);if(null===n)return r;var i=c(n,t);return i.length?r.length?a(new o(r.concat(i))):i:r};n.exp({getMetadataKeys:function(e,t){return c(i(e),arguments.length<2?void 0:l(t))}})},{"./_an-object":16,"./_array-from-iterable":19,"./_metadata":76,"./_object-gpo":88,"./es6.set":242}],313:[function(e,t,r){var n=e("./_metadata"),i=e("./_an-object"),o=e("./_object-gpo"),a=n.has,s=n.get,u=n.key,l=function(e,t,r){if(a(e,t,r))return s(e,t,r);var n=o(t);return null!==n?l(e,n,r):void 0};n.exp({getMetadata:function(e,t,r){return l(e,i(t),arguments.length<3?void 0:u(r))}})},{"./_an-object":16,"./_metadata":76,"./_object-gpo":88}],314:[function(e,t,r){var n=e("./_metadata"),i=e("./_an-object"),o=n.keys,a=n.key;n.exp({getOwnMetadataKeys:function(e,t){return o(i(e),arguments.length<2?void 0:a(t))}})},{"./_an-object":16,"./_metadata":76}],315:[function(e,t,r){var n=e("./_metadata"),i=e("./_an-object"),o=n.get,a=n.key;n.exp({getOwnMetadata:function(e,t,r){return o(e,i(t),arguments.length<3?void 0:a(r))}})},{"./_an-object":16,"./_metadata":76}],316:[function(e,t,r){var n=e("./_metadata"),i=e("./_an-object"),o=e("./_object-gpo"),a=n.has,s=n.key,u=function(e,t,r){if(a(e,t,r))return!0;var n=o(t);return null!==n&&u(e,n,r)};n.exp({hasMetadata:function(e,t,r){return u(e,i(t),arguments.length<3?void 0:s(r))}})},{"./_an-object":16,"./_metadata":76,"./_object-gpo":88}],317:[function(e,t,r){var n=e("./_metadata"),i=e("./_an-object"),o=n.has,a=n.key;n.exp({hasOwnMetadata:function(e,t,r){return o(e,i(t),arguments.length<3?void 0:a(r))}})},{"./_an-object":16,"./_metadata":76}],318:[function(e,t,r){var n=e("./_metadata"),i=e("./_an-object"),o=e("./_a-function"),a=n.key,s=n.set;n.exp({metadata:function(r,n){return function(e,t){s(r,n,(void 0!==t?i:o)(e),a(t))}}})},{"./_a-function":11,"./_an-object":16,"./_metadata":76}],319:[function(e,t,r){e("./_set-collection-from")("Set")},{"./_set-collection-from":106}],320:[function(e,t,r){e("./_set-collection-of")("Set")},{"./_set-collection-of":107}],321:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Set",{toJSON:e("./_collection-to-json")("Set")})},{"./_collection-to-json":29,"./_export":42}],322:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_string-at")(!0);n(n.P,"String",{at:function(e){return i(this,e)}})},{"./_export":42,"./_string-at":115}],323:[function(e,t,r){"use strict";function i(e,t){this._r=e,this._s=t}var n=e("./_export"),o=e("./_defined"),a=e("./_to-length"),s=e("./_is-regexp"),u=e("./_flags"),l=RegExp.prototype;e("./_iter-create")(i,"RegExp String",function(){var e=this._r.exec(this._s);return{value:e,done:null===e}}),n(n.P,"String",{matchAll:function(e){if(o(this),!s(e))throw TypeError(e+" is not a regexp!");var t=String(this),r="flags"in l?String(e.flags):u.call(e),n=new RegExp(e.source,~r.indexOf("g")?r:"g"+r);return n.lastIndex=a(e.lastIndex),new i(n,t)}})},{"./_defined":37,"./_export":42,"./_flags":46,"./_is-regexp":62,"./_iter-create":64,"./_to-length":127}],324:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_string-pad"),o=e("./_user-agent"),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);n(n.P+n.F*a,"String",{padEnd:function(e,t){return i(this,e,1<arguments.length?t:void 0,!1)}})},{"./_export":42,"./_string-pad":118,"./_user-agent":134}],325:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_string-pad"),o=e("./_user-agent"),a=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);n(n.P+n.F*a,"String",{padStart:function(e,t){return i(this,e,1<arguments.length?t:void 0,!0)}})},{"./_export":42,"./_string-pad":118,"./_user-agent":134}],326:[function(e,t,r){"use strict";e("./_string-trim")("trimLeft",function(e){return function(){return e(this,1)}},"trimStart")},{"./_string-trim":120}],327:[function(e,t,r){"use strict";e("./_string-trim")("trimRight",function(e){return function(){return e(this,2)}},"trimEnd")},{"./_string-trim":120}],328:[function(e,t,r){e("./_wks-define")("asyncIterator")},{"./_wks-define":136}],329:[function(e,t,r){e("./_wks-define")("observable")},{"./_wks-define":136}],330:[function(e,t,r){var n=e("./_export");n(n.S,"System",{global:e("./_global")})},{"./_export":42,"./_global":50}],331:[function(e,t,r){e("./_set-collection-from")("WeakMap")},{"./_set-collection-from":106}],332:[function(e,t,r){e("./_set-collection-of")("WeakMap")},{"./_set-collection-of":107}],333:[function(e,t,r){e("./_set-collection-from")("WeakSet")},{"./_set-collection-from":106}],334:[function(e,t,r){e("./_set-collection-of")("WeakSet")},{"./_set-collection-of":107}],335:[function(e,t,r){for(var n=e("./es6.array.iterator"),i=e("./_object-keys"),o=e("./_redefine"),a=e("./_global"),s=e("./_hide"),u=e("./_iterators"),l=e("./_wks"),c=l("iterator"),d=l("toStringTag"),f=u.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(h),m=0;m<p.length;m++){var g,v=p[m],y=h[v],_=a[v],b=_&&_.prototype;if(b&&(b[c]||s(b,c,f),b[d]||s(b,d,v),u[v]=f,y))for(g in n)b[g]||o(b,g,n[g],!0)}},{"./_global":50,"./_hide":52,"./_iterators":68,"./_object-keys":90,"./_redefine":101,"./_wks":138,"./es6.array.iterator":151}],336:[function(e,t,r){var n=e("./_export"),i=e("./_task");n(n.G+n.B,{setImmediate:i.set,clearImmediate:i.clear})},{"./_export":42,"./_task":122}],337:[function(e,t,r){function n(i){return function(e,t){var r=2<arguments.length,n=r&&s.call(arguments,2);return i(r?function(){("function"==typeof e?e:Function(e)).apply(this,n)}:e,t)}}var i=e("./_global"),o=e("./_export"),a=e("./_user-agent"),s=[].slice,u=/MSIE .\./.test(a);o(o.G+o.B+o.F*u,{setTimeout:n(i.setTimeout),setInterval:n(i.setInterval)})},{"./_export":42,"./_global":50,"./_user-agent":134}],338:[function(e,t,r){e("./modules/es6.symbol"),e("./modules/es6.object.create"),e("./modules/es6.object.define-property"),e("./modules/es6.object.define-properties"),e("./modules/es6.object.get-own-property-descriptor"),e("./modules/es6.object.get-prototype-of"),e("./modules/es6.object.keys"),e("./modules/es6.object.get-own-property-names"),e("./modules/es6.object.freeze"),e("./modules/es6.object.seal"),e("./modules/es6.object.prevent-extensions"),e("./modules/es6.object.is-frozen"),e("./modules/es6.object.is-sealed"),e("./modules/es6.object.is-extensible"),e("./modules/es6.object.assign"),e("./modules/es6.object.is"),e("./modules/es6.object.set-prototype-of"),e("./modules/es6.object.to-string"),e("./modules/es6.function.bind"),e("./modules/es6.function.name"),e("./modules/es6.function.has-instance"),e("./modules/es6.parse-int"),e("./modules/es6.parse-float"),e("./modules/es6.number.constructor"),e("./modules/es6.number.to-fixed"),e("./modules/es6.number.to-precision"),e("./modules/es6.number.epsilon"),e("./modules/es6.number.is-finite"),e("./modules/es6.number.is-integer"),e("./modules/es6.number.is-nan"),e("./modules/es6.number.is-safe-integer"),e("./modules/es6.number.max-safe-integer"),e("./modules/es6.number.min-safe-integer"),e("./modules/es6.number.parse-float"),e("./modules/es6.number.parse-int"),e("./modules/es6.math.acosh"),e("./modules/es6.math.asinh"),e("./modules/es6.math.atanh"),e("./modules/es6.math.cbrt"),e("./modules/es6.math.clz32"),e("./modules/es6.math.cosh"),e("./modules/es6.math.expm1"),e("./modules/es6.math.fround"),e("./modules/es6.math.hypot"),e("./modules/es6.math.imul"),e("./modules/es6.math.log10"),e("./modules/es6.math.log1p"),e("./modules/es6.math.log2"),e("./modules/es6.math.sign"),e("./modules/es6.math.sinh"),e("./modules/es6.math.tanh"),e("./modules/es6.math.trunc"),e("./modules/es6.string.from-code-point"),e("./modules/es6.string.raw"),e("./modules/es6.string.trim"),e("./modules/es6.string.iterator"),e("./modules/es6.string.code-point-at"),e("./modules/es6.string.ends-with"),e("./modules/es6.string.includes"),e("./modules/es6.string.repeat"),e("./modules/es6.string.starts-with"),e("./modules/es6.string.anchor"),e("./modules/es6.string.big"),e("./modules/es6.string.blink"),e("./modules/es6.string.bold"),e("./modules/es6.string.fixed"),e("./modules/es6.string.fontcolor"),e("./modules/es6.string.fontsize"),e("./modules/es6.string.italics"),e("./modules/es6.string.link"),e("./modules/es6.string.small"),e("./modules/es6.string.strike"),e("./modules/es6.string.sub"),e("./modules/es6.string.sup"),e("./modules/es6.date.now"),e("./modules/es6.date.to-json"),e("./modules/es6.date.to-iso-string"),e("./modules/es6.date.to-string"),e("./modules/es6.date.to-primitive"),e("./modules/es6.array.is-array"),e("./modules/es6.array.from"),e("./modules/es6.array.of"),e("./modules/es6.array.join"),e("./modules/es6.array.slice"),e("./modules/es6.array.sort"),e("./modules/es6.array.for-each"),e("./modules/es6.array.map"),e("./modules/es6.array.filter"),e("./modules/es6.array.some"),e("./modules/es6.array.every"),e("./modules/es6.array.reduce"),e("./modules/es6.array.reduce-right"),e("./modules/es6.array.index-of"),e("./modules/es6.array.last-index-of"),e("./modules/es6.array.copy-within"),e("./modules/es6.array.fill"),e("./modules/es6.array.find"),e("./modules/es6.array.find-index"),e("./modules/es6.array.species"),e("./modules/es6.array.iterator"),e("./modules/es6.regexp.constructor"),e("./modules/es6.regexp.exec"),e("./modules/es6.regexp.to-string"),e("./modules/es6.regexp.flags"),e("./modules/es6.regexp.match"),e("./modules/es6.regexp.replace"),e("./modules/es6.regexp.search"),e("./modules/es6.regexp.split"),e("./modules/es6.promise"),e("./modules/es6.map"),e("./modules/es6.set"),e("./modules/es6.weak-map"),e("./modules/es6.weak-set"),e("./modules/es6.typed.array-buffer"),e("./modules/es6.typed.data-view"),e("./modules/es6.typed.int8-array"),e("./modules/es6.typed.uint8-array"),e("./modules/es6.typed.uint8-clamped-array"),e("./modules/es6.typed.int16-array"),e("./modules/es6.typed.uint16-array"),e("./modules/es6.typed.int32-array"),e("./modules/es6.typed.uint32-array"),e("./modules/es6.typed.float32-array"),e("./modules/es6.typed.float64-array"),e("./modules/es6.reflect.apply"),e("./modules/es6.reflect.construct"),e("./modules/es6.reflect.define-property"),e("./modules/es6.reflect.delete-property"),e("./modules/es6.reflect.enumerate"),e("./modules/es6.reflect.get"),e("./modules/es6.reflect.get-own-property-descriptor"),e("./modules/es6.reflect.get-prototype-of"),e("./modules/es6.reflect.has"),e("./modules/es6.reflect.is-extensible"),e("./modules/es6.reflect.own-keys"),e("./modules/es6.reflect.prevent-extensions"),e("./modules/es6.reflect.set"),e("./modules/es6.reflect.set-prototype-of"),e("./modules/es7.array.includes"),e("./modules/es7.array.flat-map"),e("./modules/es7.array.flatten"),e("./modules/es7.string.at"),e("./modules/es7.string.pad-start"),e("./modules/es7.string.pad-end"),e("./modules/es7.string.trim-left"),e("./modules/es7.string.trim-right"),e("./modules/es7.string.match-all"),e("./modules/es7.symbol.async-iterator"),e("./modules/es7.symbol.observable"),e("./modules/es7.object.get-own-property-descriptors"),e("./modules/es7.object.values"),e("./modules/es7.object.entries"),e("./modules/es7.object.define-getter"),e("./modules/es7.object.define-setter"),e("./modules/es7.object.lookup-getter"),e("./modules/es7.object.lookup-setter"),e("./modules/es7.map.to-json"),e("./modules/es7.set.to-json"),e("./modules/es7.map.of"),e("./modules/es7.set.of"),e("./modules/es7.weak-map.of"),e("./modules/es7.weak-set.of"),e("./modules/es7.map.from"),e("./modules/es7.set.from"),e("./modules/es7.weak-map.from"),e("./modules/es7.weak-set.from"),e("./modules/es7.global"),e("./modules/es7.system.global"),e("./modules/es7.error.is-error"),e("./modules/es7.math.clamp"),e("./modules/es7.math.deg-per-rad"),e("./modules/es7.math.degrees"),e("./modules/es7.math.fscale"),e("./modules/es7.math.iaddh"),e("./modules/es7.math.isubh"),e("./modules/es7.math.imulh"),e("./modules/es7.math.rad-per-deg"),e("./modules/es7.math.radians"),e("./modules/es7.math.scale"),e("./modules/es7.math.umulh"),e("./modules/es7.math.signbit"),e("./modules/es7.promise.finally"),e("./modules/es7.promise.try"),e("./modules/es7.reflect.define-metadata"),e("./modules/es7.reflect.delete-metadata"),e("./modules/es7.reflect.get-metadata"),e("./modules/es7.reflect.get-metadata-keys"),e("./modules/es7.reflect.get-own-metadata"),e("./modules/es7.reflect.get-own-metadata-keys"),e("./modules/es7.reflect.has-metadata"),e("./modules/es7.reflect.has-own-metadata"),e("./modules/es7.reflect.metadata"),e("./modules/es7.asap"),e("./modules/es7.observable"),e("./modules/web.timers"),e("./modules/web.immediate"),e("./modules/web.dom.iterable"),t.exports=e("./modules/_core")},{"./modules/_core":32,"./modules/es6.array.copy-within":141,"./modules/es6.array.every":142,"./modules/es6.array.fill":143,"./modules/es6.array.filter":144,"./modules/es6.array.find":146,"./modules/es6.array.find-index":145,"./modules/es6.array.for-each":147,"./modules/es6.array.from":148,"./modules/es6.array.index-of":149,"./modules/es6.array.is-array":150,"./modules/es6.array.iterator":151,"./modules/es6.array.join":152,"./modules/es6.array.last-index-of":153,"./modules/es6.array.map":154,"./modules/es6.array.of":155,"./modules/es6.array.reduce":157,"./modules/es6.array.reduce-right":156,"./modules/es6.array.slice":158,"./modules/es6.array.some":159,"./modules/es6.array.sort":160,"./modules/es6.array.species":161,"./modules/es6.date.now":162,"./modules/es6.date.to-iso-string":163,"./modules/es6.date.to-json":164,"./modules/es6.date.to-primitive":165,"./modules/es6.date.to-string":166,"./modules/es6.function.bind":167,"./modules/es6.function.has-instance":168,"./modules/es6.function.name":169,"./modules/es6.map":170,"./modules/es6.math.acosh":171,"./modules/es6.math.asinh":172,"./modules/es6.math.atanh":173,"./modules/es6.math.cbrt":174,"./modules/es6.math.clz32":175,"./modules/es6.math.cosh":176,"./modules/es6.math.expm1":177,"./modules/es6.math.fround":178,"./modules/es6.math.hypot":179,"./modules/es6.math.imul":180,"./modules/es6.math.log10":181,"./modules/es6.math.log1p":182,"./modules/es6.math.log2":183,"./modules/es6.math.sign":184,"./modules/es6.math.sinh":185,"./modules/es6.math.tanh":186,"./modules/es6.math.trunc":187,"./modules/es6.number.constructor":188,"./modules/es6.number.epsilon":189,"./modules/es6.number.is-finite":190,"./modules/es6.number.is-integer":191,"./modules/es6.number.is-nan":192,"./modules/es6.number.is-safe-integer":193,"./modules/es6.number.max-safe-integer":194,"./modules/es6.number.min-safe-integer":195,"./modules/es6.number.parse-float":196,"./modules/es6.number.parse-int":197,"./modules/es6.number.to-fixed":198,"./modules/es6.number.to-precision":199,"./modules/es6.object.assign":200,"./modules/es6.object.create":201,"./modules/es6.object.define-properties":202,"./modules/es6.object.define-property":203,"./modules/es6.object.freeze":204,"./modules/es6.object.get-own-property-descriptor":205,"./modules/es6.object.get-own-property-names":206,"./modules/es6.object.get-prototype-of":207,"./modules/es6.object.is":211,"./modules/es6.object.is-extensible":208,"./modules/es6.object.is-frozen":209,"./modules/es6.object.is-sealed":210,"./modules/es6.object.keys":212,"./modules/es6.object.prevent-extensions":213,"./modules/es6.object.seal":214,"./modules/es6.object.set-prototype-of":215,"./modules/es6.object.to-string":216,"./modules/es6.parse-float":217,"./modules/es6.parse-int":218,"./modules/es6.promise":219,"./modules/es6.reflect.apply":220,"./modules/es6.reflect.construct":221,"./modules/es6.reflect.define-property":222,"./modules/es6.reflect.delete-property":223,"./modules/es6.reflect.enumerate":224,"./modules/es6.reflect.get":227,"./modules/es6.reflect.get-own-property-descriptor":225,"./modules/es6.reflect.get-prototype-of":226,"./modules/es6.reflect.has":228,"./modules/es6.reflect.is-extensible":229,"./modules/es6.reflect.own-keys":230,"./modules/es6.reflect.prevent-extensions":231,"./modules/es6.reflect.set":233,"./modules/es6.reflect.set-prototype-of":232,"./modules/es6.regexp.constructor":234,"./modules/es6.regexp.exec":235,"./modules/es6.regexp.flags":236,"./modules/es6.regexp.match":237,"./modules/es6.regexp.replace":238,"./modules/es6.regexp.search":239,"./modules/es6.regexp.split":240,"./modules/es6.regexp.to-string":241,"./modules/es6.set":242,"./modules/es6.string.anchor":243,"./modules/es6.string.big":244,"./modules/es6.string.blink":245,"./modules/es6.string.bold":246,"./modules/es6.string.code-point-at":247,"./modules/es6.string.ends-with":248,"./modules/es6.string.fixed":249,"./modules/es6.string.fontcolor":250,"./modules/es6.string.fontsize":251,"./modules/es6.string.from-code-point":252,"./modules/es6.string.includes":253,"./modules/es6.string.italics":254,"./modules/es6.string.iterator":255,"./modules/es6.string.link":256,"./modules/es6.string.raw":257,"./modules/es6.string.repeat":258,"./modules/es6.string.small":259,"./modules/es6.string.starts-with":260,"./modules/es6.string.strike":261,"./modules/es6.string.sub":262,"./modules/es6.string.sup":263,"./modules/es6.string.trim":264,"./modules/es6.symbol":265,"./modules/es6.typed.array-buffer":266,"./modules/es6.typed.data-view":267,"./modules/es6.typed.float32-array":268,"./modules/es6.typed.float64-array":269,"./modules/es6.typed.int16-array":270,"./modules/es6.typed.int32-array":271,"./modules/es6.typed.int8-array":272,"./modules/es6.typed.uint16-array":273,"./modules/es6.typed.uint32-array":274,"./modules/es6.typed.uint8-array":275,"./modules/es6.typed.uint8-clamped-array":276,"./modules/es6.weak-map":277,"./modules/es6.weak-set":278,"./modules/es7.array.flat-map":279,"./modules/es7.array.flatten":280,"./modules/es7.array.includes":281,"./modules/es7.asap":282,"./modules/es7.error.is-error":283,"./modules/es7.global":284,"./modules/es7.map.from":285,"./modules/es7.map.of":286,"./modules/es7.map.to-json":287,"./modules/es7.math.clamp":288,"./modules/es7.math.deg-per-rad":289,"./modules/es7.math.degrees":290,"./modules/es7.math.fscale":291,"./modules/es7.math.iaddh":292,"./modules/es7.math.imulh":293,"./modules/es7.math.isubh":294,"./modules/es7.math.rad-per-deg":295,"./modules/es7.math.radians":296,"./modules/es7.math.scale":297,"./modules/es7.math.signbit":298,"./modules/es7.math.umulh":299,"./modules/es7.object.define-getter":300,"./modules/es7.object.define-setter":301,"./modules/es7.object.entries":302,"./modules/es7.object.get-own-property-descriptors":303,"./modules/es7.object.lookup-getter":304,"./modules/es7.object.lookup-setter":305,"./modules/es7.object.values":306,"./modules/es7.observable":307,"./modules/es7.promise.finally":308,"./modules/es7.promise.try":309,"./modules/es7.reflect.define-metadata":310,"./modules/es7.reflect.delete-metadata":311,"./modules/es7.reflect.get-metadata":313,"./modules/es7.reflect.get-metadata-keys":312,"./modules/es7.reflect.get-own-metadata":315,"./modules/es7.reflect.get-own-metadata-keys":314,"./modules/es7.reflect.has-metadata":316,"./modules/es7.reflect.has-own-metadata":317,"./modules/es7.reflect.metadata":318,"./modules/es7.set.from":319,"./modules/es7.set.of":320,"./modules/es7.set.to-json":321,"./modules/es7.string.at":322,"./modules/es7.string.match-all":323,"./modules/es7.string.pad-end":324,"./modules/es7.string.pad-start":325,"./modules/es7.string.trim-left":326,"./modules/es7.string.trim-right":327,"./modules/es7.symbol.async-iterator":328,"./modules/es7.symbol.observable":329,"./modules/es7.system.global":330,"./modules/es7.weak-map.from":331,"./modules/es7.weak-map.of":332,"./modules/es7.weak-set.from":333,"./modules/es7.weak-set.of":334,"./modules/web.dom.iterable":335,"./modules/web.immediate":336,"./modules/web.timers":337}],339:[function(e,t,r){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":575}],340:[function(e,t,r){"use strict";var o,u,n,i={encode:function(e){for(var t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):(n<2048?t.push(192|n>>6):(n<65536?t.push(224|n>>12):(t.push(240|n>>18),t.push(128|63&n>>12)),t.push(128|63&n>>6)),t.push(128|63&n))}return t},decode:function(e){for(var t=[],r=0;r<e.length;){var n=e[r++];n<128||(n<224?n=(31&n)<<6:(n<240?n=(15&n)<<12:(n=(7&n)<<18,n|=(63&e[r++])<<12),n|=(63&e[r++])<<6),n|=63&e[r++]),t.push(String.fromCharCode(n))}return t.join("")}},l={};function c(e){for(var t=0,r=[],n=0|e.length/3;0<n--;){var i=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,r.push(o.charAt(63&i>>18)),r.push(o.charAt(63&i>>12)),r.push(o.charAt(63&i>>6)),r.push(o.charAt(63&i))}if(2==e.length-t){i=(e[t]<<16)+(e[t+1]<<8);r.push(o.charAt(63&i>>18)),r.push(o.charAt(63&i>>12)),r.push(o.charAt(63&i>>6)),r.push("=")}else if(1==e.length-t){i=e[t]<<16;r.push(o.charAt(63&i>>18)),r.push(o.charAt(63&i>>12)),r.push("==")}return r.join("")}function d(e){for(var t=0,r=[],n=0|e.length/4;0<n--;){var i=(u[e.charCodeAt(t)]<<18)+(u[e.charCodeAt(t+1)]<<12)+(u[e.charCodeAt(t+2)]<<6)+u[e.charCodeAt(t+3)];r.push(255&i>>16),r.push(255&i>>8),r.push(255&i),t+=4}return r&&("="==e.charAt(t-2)?(r.pop(),r.pop()):"="==e.charAt(t-1)&&r.pop()),r}o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=function(){for(var e=[],t=0;t<o.length;++t)e[o.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),n={encode:function(e){for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},l.decodeArray=function(e){var t=d(e);return new Uint8Array(t)},l.encodeASCII=function(e){var t=n.encode(e);return c(t)},l.decodeASCII=function(e){var t=d(e);return n.decode(t)},l.encode=function(e){var t=i.encode(e);return c(t)},l.decode=function(e){var t=d(e);return i.decode(t)},void 0!==r&&(r.decode=l.decode,r.decodeArray=l.decodeArray,r.encode=l.encode,r.encodeASCII=l.encodeASCII)},{}],341:[function(e,t,r){"use strict";!function(e){function s(e){var t=e;return r.hasOwnProperty(e)&&(t=r[e]),String.fromCharCode(t)}function u(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t}function a(e,t,r,n,i){this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1}var r={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},l={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},d={25:2,26:4,29:6,30:8,31:10,27:13,28:15},f=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],h={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var r=this.verboseFilter[e];this.verboseLevel>=r&&console.log(this.time+" ["+e+"] "+t)}};a.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};function t(e,t,r,n,i,o){this.uchar=e||" ",this.penState=new a(t,r,n,i,o)}t.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};function n(){this.chars=[];for(var e=0;e<32;e++)this.chars.push(new t);this.pos=0,this.currPenState=new a}n.prototype={equals:function(e){for(var t=!0,r=0;r<32;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<32;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<32;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(h.log("ERROR","Negative cursor position "+this.pos),this.pos=0):32<this.pos&&(h.log("ERROR","Too large cursor position "+this.pos),this.pos=32)},moveCursor:function(e){var t=this.pos+e;if(1<e)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){144<=e&&this.backSpace();var t=s(e);32<=this.pos?h.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<32;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,r=0;r<32;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};function i(){this.rows=[];for(var e=0;e<15;e++)this.rows.push(new n);this.currRow=14,this.nrRollUpRows=null,this.reset()}i.prototype={reset:function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){h.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){h.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var r=this.rows[this.currRow];if(null!==e.indent){var n=e.indent,i=Math.max(n-1,0);r.setCursor(e.indent),e.color=r.chars[i].penState.foreground}var o={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(o)},setBkgData:function(e){h.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){h.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),h.log("INFO","Rolling up")}else h.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],r="",n=-1,i=0;i<15;i++){var o=this.rows[i].getTextString();o&&(n=i+1,e?t.push("Row "+n+': "'+o+'"'):t.push(o.trim()))}return 0<t.length&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},getTextAndFormat:function(){return this.rows}};function p(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new i,this.nonDisplayedMemory=new i,this.lastOutputScreen=new i,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}p.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,h.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";h.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(h.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){h.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){h.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){h.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){h.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){h.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){h.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){h.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){h.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){h.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){h.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){h.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(h.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,h.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){h.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=46<=e,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}h.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=h.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};function m(e,t,r){this.field=e||1,this.outputs=[t,r],this.channels=[new p(1,t),new p(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}m.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var r,n,i,o=!1;this.lastTime=e,h.setTime(e);for(var a=0;a<t.length;a+=2)if(n=127&t[a],i=127&t[a+1],16<=n&&n<=31&&n===this.lastCmdA&&i===this.lastCmdB)this.lastCmdA=null,this.lastCmdB=null,h.log("DEBUG","Repeated command ("+u([n,i])+") is dropped");else if(0!=n||0!=i){if(h.log("DATA","["+u([t[a],t[a+1]])+"] -> ("+u([n,i])+")"),!(r=(r=(r=(r=this.parseCmd(n,i))||this.parseMidrow(n,i))||this.parsePAC(n,i))||this.parseBackgroundAttributes(n,i)))if(o=this.parseChars(n,i))if(this.currChNr&&0<=this.currChNr)this.channels[this.currChNr-1].insertChars(o);else h.log("WARNING","No channel found yet. TEXT-MODE?");r?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,h.log("WARNING","Couldn't parse cleaned data "+u([n,i])+" orig: "+u([t[a],t[a+1]])))}else this.dataCounters.padding+=2},parseCmd:function(e,t){var r=null;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47)&&!((23===e||31===e)&&33<=t&&t<=35))return!1;r=20===e||21===e||23===e?1:2;var n=this.channels[r-1];return 20===e||21===e||28===e||29===e?32===t?n.cc_RCL():33===t?n.cc_BS():34===t?n.cc_AOF():35===t?n.cc_AON():36===t?n.cc_DER():37===t?n.cc_RU(2):38===t?n.cc_RU(3):39===t?n.cc_RU(4):40===t?n.cc_FON():41===t?n.cc_RDC():42===t?n.cc_TR():43===t?n.cc_RTD():44===t?n.cc_EDM():45===t?n.cc_CR():46===t?n.cc_ENM():47===t&&n.cc_EOC():n.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},parseMidrow:function(e,t){var r=null;if((17===e||25===e)&&32<=t&&t<=47){if((r=17===e?1:2)!==this.currChNr)return h.log("ERROR","Mismatch channel in midrow parsing"),!1;var n=this.channels[r-1];return n.insertChars([32]),n.cc_MIDROW(t),h.log("DEBUG","MIDROW ("+u([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var r,n=null;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127)&&!((16===e||24===e)&&64<=t&&t<=95))return!1;r=e<=23?1:2,n=64<=t&&t<=95?1==r?o[e]:c[e]:1==r?l[e]:d[e];var i=this.interpretPAC(n,t);return this.channels[r-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},interpretPAC:function(e,t){var r=t,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=95<t?t-96:t-64,n.underline=1==(1&r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},parseChars:function(e,t){var r=null,n=null,i=null;if(17<=(i=25<=e?(r=2,e-8):(r=1,e))&&i<=19){var o=t;o=17===i?t+80:18===i?t+112:t+144,h.log("INFO","Special char '"+s(o)+"' in channel "+r),n=[o],this.lastCmdA=e,this.lastCmdB=t}else 32<=e&&e<=127&&(n=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null);if(n){var a=u(n);h.log("DEBUG","Char codes =  "+a.join(","))}return n},parseBackgroundAttributes:function(e,t){var r,n,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(r={},16===e||24===e?(n=Math.floor((t-32)/2),r.background=f[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(r),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}};e.logger=h,e.PenState=a,e.CaptionScreen=i,e.Cea608Parser=m,e.findCea608Nalus=function(e,t,r){for(var n=0,i=t,o=[],a=function(e,t,r,n){if(4!==e||t<8)return null;var i=r.getUint8(n),o=r.getUint16(n+1),a=r.getUint32(n+3),s=r.getUint8(n+7);return 181==i&&49==o&&1195456820==a&&3==s};i<t+r;){if(n=e.getUint32(i),6===(31&e.getUint8(i+4)))for(var s=i+5,u=-1;s<i+4+n-1;){u=0;for(var l=255;255===l;)u+=l=e.getUint8(s),s++;var c=0;for(l=255;255===l;)c+=l=e.getUint8(s),s++;a(u,c,e,s)&&o.push([s,c]),s+=c}i+=n+4}return o},e.extractCea608DataFromRange=function(e,t){var r=t[0],n=[[],[]];r+=8;var i=31&e.getUint8(r);r+=2;for(var o=0;o<i;o++){var a=e.getUint8(r),s=4&a,u=3&a;r++;var l=e.getUint8(r);r++;var c=e.getUint8(r);r++,s&&(127&l)+(127&c)!=0&&(0==u?(n[0].push(l),n[0].push(c)):1==u&&(n[1].push(l),n[1].push(c)))}return n}}(void 0===r?(void 0).cea608parser={}:r)},{}],342:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(A){A=A||{},function(){void 0===A.escapeMode&&(A.escapeMode=!0);void 0===A.attributePrefix&&(A.attributePrefix="_");A.arrayAccessForm=A.arrayAccessForm||"none",A.emptyNodeForm=A.emptyNodeForm||"text",void 0===A.enableToStringFunc&&(A.enableToStringFunc=!0);A.arrayAccessFormPaths=A.arrayAccessFormPaths||[],void 0===A.skipEmptyTextNodesForObj&&(A.skipEmptyTextNodesForObj=!0);void 0===A.stripWhitespaces&&(A.stripWhitespaces=!0);A.datetimeAccessFormPaths=A.datetimeAccessFormPaths||[],void 0===A.useDoubleQuotes&&(A.useDoubleQuotes=!1);A.xmlElementsFilter=A.xmlElementsFilter||[],A.jsonPropertiesFilter=A.jsonPropertiesFilter||[],void 0===A.keepCData&&(A.keepCData=!1);void 0===A.ignoreRoot&&(A.ignoreRoot=!1)}();var T={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function S(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function u(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function x(e,t,r,n){for(var i=0;i<e.length;i++){var o=e[i];if("string"==typeof o){if(o==n)break}else if(o instanceof RegExp){if(o.test(n))break}else if("function"==typeof o&&o(t,r,n))break}return i!=e.length}function M(e,t,r){switch(A.arrayAccessForm){case"property":e[t]instanceof Array?e[t+"_asArray"]=e[t]:e[t+"_asArray"]=[e[t]]}!(e[t]instanceof Array)&&0<A.arrayAccessFormPaths.length&&x(A.arrayAccessFormPaths,e,t,r)&&(e[t]=[e[t]])}function R(e){var t=e.split(/[-T:+Z]/g),r=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(r.setHours(t[3],t[4],n[0]),1<n.length&&r.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function O(e,t){if(e.nodeType==T.DOCUMENT_NODE){for(var r=new Object,n=e.childNodes,i=0;i<n.length;i++){if((a=n[i]).nodeType==T.ELEMENT_NODE)if(A.ignoreRoot)r=O(a);else(r={})[s=S(a)]=O(a)}return r}if(e.nodeType==T.ELEMENT_NODE){(r=new Object).__cnt=0;var o=[];for(n=e.childNodes,i=0;i<n.length;i++){var a,s=S(a=n[i]);if(a.nodeType!=T.COMMENT_NODE){var u=t+"."+s;if(_=r,b=a.nodeType,E=s,w=u,!(b==T.ELEMENT_NODE&&0<A.xmlElementsFilter.length)||x(A.xmlElementsFilter,_,E,w))if(r.__cnt++,null==r[s]){var l=O(a,u);if("#text"!=s||/[^\s]/.test(l))(c={})[s]=l,o.push(c);r[s]=l,M(r,s,u)}else{null!=r[s]&&(r[s]instanceof Array||(r[s]=[r[s]],M(r,s,u)));var c;l=O(a,u);if("#text"!=s||/[^\s]/.test(l))(c={})[s]=l,o.push(c);r[s][r[s].length]=l}}}r.__children=o;for(var d=S(e),f=0;f<e.attributes.length;f++){var h=e.attributes[f];r.__cnt++;for(var p=h.value,m=0,g=A.matchers.length;m<g;m++){var v=A.matchers[m];v.test(h,d)&&(p=v.converter(h.value))}r[A.attributePrefix+h.name]=p}var y=function(e){return e.prefix}(e);return null!=y&&""!=y&&(r.__cnt++,r.__prefix=y),null!=r["#text"]&&(r.__text=r["#text"],r.__text instanceof Array&&(r.__text=r.__text.join("\n")),A.stripWhitespaces&&(r.__text=r.__text.trim()),delete r["#text"],"property"==A.arrayAccessForm&&delete r["#text_asArray"],r.__text=function(e,t,r){if(0<A.datetimeAccessFormPaths.length){var n=r.split(".#")[0];return x(A.datetimeAccessFormPaths,e,t,n)?R(e):e}return e}(r.__text,s,t+"."+s)),null!=r["#cdata-section"]&&(r.__cdata=r["#cdata-section"],delete r["#cdata-section"],"property"==A.arrayAccessForm&&delete r["#cdata-section_asArray"]),0==r.__cnt&&"text"==A.emptyNodeForm?r="":1==r.__cnt&&null!=r.__text?r=r.__text:1!=r.__cnt||null==r.__cdata||A.keepCData?1<r.__cnt&&null!=r.__text&&A.skipEmptyTextNodesForObj&&(A.stripWhitespaces&&""==r.__text||""==r.__text.trim())&&delete r.__text:r=r.__cdata,delete r.__cnt,!A.enableToStringFunc||null==r.__text&&null==r.__cdata||(r.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),r}if(e.nodeType==T.TEXT_NODE||e.nodeType==T.CDATA_SECTION_NODE)return e.nodeValue;var _,b,E,w}function l(e,t,r,n){var i="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+t;if(null!=r)for(var o=0;o<r.length;o++){var a=r[o],s=e[a];A.escapeMode&&(s=u(s)),i+=" "+a.substr(A.attributePrefix.length)+"=",A.useDoubleQuotes?i+='"'+s+'"':i+="'"+s+"'"}return i+=n?"/>":">"}function c(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function d(e,t){return!!("property"==A.arrayAccessForm&&function(e,t){return-1!==e.indexOf(t,e.length-t.length)}(t.toString(),"_asArray")||0==t.toString().indexOf(A.attributePrefix)||0==t.toString().indexOf("__")||e[t]instanceof Function)}function f(e){var t=0;if(e instanceof Object)for(var r in e)d(e,r)||t++;return t}function h(e){var t=[];if(e instanceof Object)for(var r in e)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(A.attributePrefix)&&t.push(r);return t}function p(e){var t="";return e instanceof Object?t+=function(e){var t="";return null!=e.__cdata&&(t+="<![CDATA["+e.__cdata+"]]>"),null!=e.__text&&(A.escapeMode?t+=u(e.__text):t+=e.__text),t}(e):null!=e&&(A.escapeMode?t+=u(e):t+=e),t}function m(e,t){return""===e?t:e+"."+t}function g(e,t,r,n){var i="";if(0==e.length)i+=l(e,t,r,!0);else for(var o=0;o<e.length;o++)i+=l(e[o],t,h(e[o]),!1),i+=v(e[o],m(n,t)),i+=c(e[o],t);return i}function v(e,t){var r,n,i,o="";if(0<f(e))for(var a in e)if(!d(e,a)&&(""==t||(r=e,i=m(t,n=a),0==A.jsonPropertiesFilter.length||""==i||x(A.jsonPropertiesFilter,r,n,i)))){var s=e[a],u=h(s);if(null==s||null==s)o+=l(s,a,u,!0);else if(s instanceof Object)if(s instanceof Array)o+=g(s,a,u,t);else if(s instanceof Date)o+=l(s,a,u,!1),o+=s.toISOString(),o+=c(s,a);else{0<f(s)||null!=s.__text||null!=s.__cdata?(o+=l(s,a,u,!1),o+=v(s,m(t,a)),o+=c(s,a)):o+=l(s,a,u,!0)}else o+=l(s,a,u,!1),o+=p(s),o+=c(s,a)}return o+=p(e)}this.parseXmlString=function(e){var t;window.ActiveXObject||window;if(void 0===e)return null;if(window.DOMParser){var r=new window.DOMParser;try{0<(t=r.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?R(e):e},this.xml2json=function(e){return O(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return v(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},t.exports=r.default},{}],343:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./index_mediaplayerOnly"),o=n(e("./src/streaming/metrics/MetricsReporting")),a=n(e("./src/streaming/protection/Protection")),s=n(e("./src/streaming/MediaPlayerFactory")),u=n(e("./src/core/Debug"));dashjs.Protection=a.default,dashjs.MetricsReporting=o.default,dashjs.MediaPlayerFactory=s.default,dashjs.Debug=u.default,r.default=dashjs,r.MediaPlayer=i.MediaPlayer,r.Protection=a.default,r.MetricsReporting=o.default,r.MediaPlayerFactory=s.default,r.Debug=u.default},{"./index_mediaplayerOnly":344,"./src/core/Debug":345,"./src/streaming/MediaPlayerFactory":394,"./src/streaming/metrics/MetricsReporting":416,"./src/streaming/protection/Protection":450}],344:[function(u,e,l){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(l,"__esModule",{value:!0});var r=t(u("./src/streaming/MediaPlayer")),n=t(u("./src/core/FactoryMaker")),i=t(u("./src/core/Debug")),o=u("./src/core/Version"),a="undefined"!=typeof window&&window||e,s=a.dashjs;(s=s||(a.dashjs={})).MediaPlayer=r.default,s.FactoryMaker=n.default,s.Debug=i.default,s.Version=(0,o.getVersionString)(),l.default=s,l.MediaPlayer=r.default,l.FactoryMaker=n.default,l.Debug=i.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/core/Debug":345,"./src/core/FactoryMaker":347,"./src/core/Version":348,"./src/streaming/MediaPlayer":392}],345:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("./EventBus")),h=n(e("./events/Events")),o=n(e("./FactoryMaker")),a=1,p=2,m=3,g=4,v=5;function s(){var e,t=this.context,s=(0,i.default)(t).getInstance(),u=[],l=void 0,c=void 0,d=void 0,f=void 0;function r(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function n(e,t){var r="",n=null;l&&(n=(new Date).getTime(),r+="["+(n-d)+"]"),c&&t&&t.getClassName&&(r+="["+t.getClassName()+"]",t.getType&&(r+="["+t.getType()+"]")),0<r.length&&(r+=" ");for(var i=arguments.length,o=Array(2<i?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];Array.apply(null,o).forEach(function(e){r+=e+" "}),u[e]&&e<=f&&u[e](r),s.trigger(h.default.LOG,{message:r,level:e})}return e={getLogger:function(e){return{fatal:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(void 0,[a,this].concat(t))}.bind(e),error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(void 0,[p,this].concat(t))}.bind(e),warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(void 0,[m,this].concat(t))}.bind(e),info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(void 0,[g,this].concat(t))}.bind(e),debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(void 0,[v,this].concat(t))}.bind(e)}},setLogTimestampVisible:function(e){l=e},setCalleeNameVisible:function(e){c=e},setLogToBrowserConsole:function(e){f=e?v:0},getLogToBrowserConsole:function(){return 0!==f},setLogLevel:function(e){f=e},getLogLevel:function(){return f}},c=l=!0,f=m,d=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(u[a]=r(window.console.error),u[p]=r(window.console.error),u[m]=r(window.console.warn),u[g]=r(window.console.info),u[v]=r(window.console.debug)),e}s.__dashjs_factory_name="Debug";var u=o.default.getSingletonFactory(s);u.LOG_LEVEL_NONE=0,u.LOG_LEVEL_FATAL=a,u.LOG_LEVEL_ERROR=p,u.LOG_LEVEL_WARNING=m,u.LOG_LEVEL_INFO=g,u.LOG_LEVEL_DEBUG=v,o.default.updateSingletonFactory(s.__dashjs_factory_name,u),r.default=u,t.exports=r.default},{"./EventBus":346,"./FactoryMaker":347,"./events/Events":352}],346:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(){var o={};function a(e,r,n){var i=-1;return o[e]&&o[e].some(function(e,t){if(e&&e.callback===r&&(!n||n===e.scope))return i=t,!0}),i}return{on:function(r,e,t){var n=arguments.length<=3||void 0===arguments[3]?0:arguments[3];if(!r)throw new Error("event type cannot be null or undefined");if(!e||"function"!=typeof e)throw new Error("listener must be a function: "+e);if(!(0<=a(r,e,t))){o[r]=o[r]||[];var i={callback:e,scope:t,priority:n};o[r].some(function(e,t){if(e&&n>e.priority)return o[r].splice(t,0,i),!0})||o[r].push(i)}},off:function(e,t,r){if(e&&t&&o[e]){var n=a(e,t,r);n<0||(o[e][n]=null)}},trigger:function(e,t){if(e&&o[e]){if((t=t||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");t.type=e,o[e]=o[e].filter(function(e){return e}),o[e].forEach(function(e){return e&&e.callback.call(e.scope,t)})}},reset:function(){o={}}}}a.__dashjs_factory_name="EventBus";var s=o.default.getSingletonFactory(a);s.EVENT_PRIORITY_LOW=0,s.EVENT_PRIORITY_HIGH=5e3,o.default.updateSingletonFactory(a.__dashjs_factory_name,s),r.default=s,t.exports=r.default},{"./FactoryMaker":347}],347:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u,o,n,i,a=(u=void 0,o=[],n={},i={},u={extend:function(e,t,r,n){!n[e]&&t&&(n[e]={instance:t,override:r})},getSingletonInstance:s,setSingletonInstance:function(e,t,r){for(var n in o){var i=o[n];if(i.context===e&&i.name===t)return void(o[n].instance=r)}o.push({name:t,context:e,instance:r})},getSingletonFactory:function(r){var e=l(r.__dashjs_factory_name,n);return e||(e=function(e){var t=void 0;return void 0===e&&(e={}),{getInstance:function(){return(t=t||s(e,r.__dashjs_factory_name))||(t=d(r,e,arguments),o.push({name:r.__dashjs_factory_name,context:e,instance:t})),t}}},n[r.__dashjs_factory_name]=e),e},getSingletonFactoryByName:function(e){return l(e,n)},updateSingletonFactory:function(e,t){c(e,t,n)},getClassFactory:function(t){var e=l(t.__dashjs_factory_name,i);return e||(e=function(e){return void 0===e&&(e={}),{create:function(){return d(t,e,arguments)}}},i[t.__dashjs_factory_name]=e),e},getClassFactoryByName:function(e){return l(e,i)},updateClassFactory:function(e,t){c(e,t,i)}});function s(e,t){for(var r in o){var n=o[r];if(n.context===e&&n.name===t)return n.instance}return null}function l(e,t){return t[e]}function c(e,t,r){e in r&&(r[e]=t)}function d(e,t,r){var n=void 0,i=e.__dashjs_factory_name,o=t[i];if(o){var a=o.instance;if(!o.override)return a.apply({context:t,factory:u},r);for(var s in n=e.apply({context:t},r),a=a.apply({context:t,factory:u,parent:n},r))n.hasOwnProperty(s)&&(n[s]=a[s])}else n=e.apply({context:t},r);return n.getClassName=function(){return i},n}r.default=a,t.exports=r.default},{}],348:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getVersionString=function(){return n};var n="2.9.3"},{}],349:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./ErrorsBase");function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(o.prototype),"constructor",this).call(this),this.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,this.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,this.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,this.SEGMENTS_UPDATE_FAILED_ERROR_CODE=13,this.SEGMENTS_UNAVAILABLE_ERROR_CODE=14,this.SEGMENT_BASE_LOADER_ERROR_CODE=15,this.TIME_SYNC_FAILED_ERROR_CODE=16,this.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,this.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,this.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,this.APPEND_ERROR_CODE=20,this.REMOVE_ERROR_CODE=21,this.DATA_UPDATE_FAILED_ERROR_CODE=22,this.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,this.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,this.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,this.DOWNLOAD_ERROR_ID_MANIFEST="manifest",this.DOWNLOAD_ERROR_ID_SIDX_CODE=26,this.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,this.DOWNLOAD_ERROR_ID_CONTENT="content",this.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,this.DOWNLOAD_ERROR_ID_INITIALIZATION="initialization",this.DOWNLOAD_ERROR_ID_XLINK_CODE=29,this.DOWNLOAD_ERROR_ID_XLINK="xlink",this.MANIFEST_ERROR_ID_CODEC_CODE=30,this.MANIFEST_ERROR_ID_PARSE_CODE=31,this.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,this.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,this.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,this.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,this.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",this.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",this.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",this.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",this.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",this.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segments",this.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize time",this.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",this.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",this.APPEND_ERROR_MESSAGE="chunk is not defined",this.REMOVE_ERROR_MESSAGE="buffer is not defined",this.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",this.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",this.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",this.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",this.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : "}var a=new(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,((n=i)&&n.__esModule?n:{default:n}).default),o);r.default=a,t.exports=r.default},{"./ErrorsBase":350}],350:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,[{key:"extend",value:function(e,t){if(e){var r=!!t&&t.override,n=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!r||n&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}r.default=i,t.exports=r.default},{}],351:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./EventsBase"),o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,((n=i)&&n.__esModule?n:{default:n}).default),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(a.prototype),"constructor",this).call(this),this.BUFFERING_COMPLETED="bufferingCompleted",this.BUFFER_CLEARED="bufferCleared",this.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",this.BYTES_APPENDED="bytesAppended",this.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",this.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",this.CURRENT_TRACK_CHANGED="currentTrackChanged",this.DATA_UPDATE_COMPLETED="dataUpdateCompleted",this.DATA_UPDATE_STARTED="dataUpdateStarted",this.INITIALIZATION_LOADED="initializationLoaded",this.INIT_FRAGMENT_LOADED="initFragmentLoaded",this.INIT_REQUESTED="initRequested",this.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",this.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",this.LOADING_COMPLETED="loadingCompleted",this.LOADING_PROGRESS="loadingProgress",this.LOADING_DATA_PROGRESS="loadingDataProgress",this.LOADING_ABANDONED="loadingAborted",this.MANIFEST_UPDATED="manifestUpdated",this.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",this.QUOTA_EXCEEDED="quotaExceeded",this.REPRESENTATION_UPDATED="representationUpdated",this.SEGMENTS_LOADED="segmentsLoaded",this.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",this.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",this.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",this.STREAMS_COMPOSED="streamsComposed",this.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",this.STREAM_COMPLETED="streamCompleted",this.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",this.TIMED_TEXT_REQUESTED="timedTextRequested",this.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",this.URL_RESOLUTION_FAILED="urlResolutionFailed",this.VIDEO_CHUNK_RECEIVED="videoChunkReceived",this.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",this.XLINK_ELEMENT_LOADED="xlinkElementLoaded",this.XLINK_READY="xlinkReady"}r.default=o,t.exports=r.default},{"./EventsBase":353}],352:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./CoreEvents");function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(o.prototype),"constructor",this).apply(this,arguments)}var a=new(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,((n=i)&&n.__esModule?n:{default:n}).default),o);r.default=a,t.exports=r.default},{"./CoreEvents":351}],353:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,[{key:"extend",value:function(e,t){if(e){var r=!!t&&t.override,n=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!r||n&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}r.default=i,t.exports=r.default},{}],354:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var x=n(e("../streaming/constants/Constants")),h=n(e("./constants/DashConstants")),i=n(e("../streaming/vo/RepresentationInfo")),o=n(e("../streaming/vo/MediaInfo")),p=n(e("../streaming/vo/StreamInfo")),m=n(e("../streaming/vo/ManifestInfo")),g=n(e("./vo/Event")),a=n(e("../core/FactoryMaker")),v=n(e("../../externals/cea608-parser")),y=e("../streaming/utils/SupervisorTools");function s(){var e,_=void 0,b=void 0,E=void 0,l=void 0;function s(e,t){return t&&e?t.getRepresentationForQuality(e.quality):null}function u(e){return e&&e.streamInfo&&void 0!==e.streamInfo.id&&E[e.streamInfo.id]?E[e.streamInfo.id][e.index]:null}function w(e,t){for(var r=t.length,n=0;n<r;n++){var i=t[n];if(e.id===i.id)return i}return null}function n(e){var t=new i.default,r=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],n=_.getRepresentationFor(e.index,r);return t.id=e.id,t.quality=e.index,t.bandwidth=_.getBandwidth(n),t.DVRWindow=e.segmentAvailabilityRange,t.fragmentDuration=e.segmentDuration||(e.segments&&0<e.segments.length?e.segments[0].duration:NaN),t.MSETimeOffset=e.MSETimeOffset,t.useCalculatedLiveEdgeTime=e.useCalculatedLiveEdgeTime,t.mediaInfo=A(e.adaptation),t}function A(e){var t,n=new o.default,r=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];return n.id=e.id,n.index=e.index,n.type=e.type,n.streamInfo=a(e.period),n.representationCount=_.getRepresentationCount(r),n.labels=_.getLabelsForAdaptation(r),n.lang=_.getLanguageForAdaptation(r),t=_.getViewpointForAdaptation(r),n.viewpoint=t?t.value:void 0,n.accessibility=_.getAccessibilityForAdaptation(r).map(function(e){var t=e.value,r=t;return e.schemeIdUri&&0<=e.schemeIdUri.search("cea-608")&&void 0!==v.default&&(r=t?"cea-608:"+t:"cea-608",n.embeddedCaptions=!0),r}),n.audioChannelConfiguration=_.getAudioChannelConfigurationForAdaptation(r).map(function(e){return e.value}),n.roles=_.getRolesForAdaptation(r).map(function(e){return e.value}),n.codec=_.getCodec(r),n.mimeType=_.getMimeType(r),n.contentProtection=_.getContentProtectionData(r),n.bitrateList=_.getBitrateListForAdaptation(r),n.contentProtection&&n.contentProtection.forEach(function(e){e.KID=_.getKID(e)}),n.isText=_.getIsTextTrack(n.mimeType),n}function T(e,t,r){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=x.default.EMBEDDED_TEXT,e.codec="cea-608-in-SEI",e.isText=!0,e.isEmbedded=!0,e.lang=r,e.roles=["caption"]}function a(e){var t=new p.default;return t.id=e.id,t.index=e.index,t.start=e.start,t.duration=e.duration,t.manifestInfo=function(e){var t=new m.default;return t.DVRWindowSize=e.timeShiftBufferDepth,t.loadedTime=e.manifest.loadedTime,t.availableFrom=e.availabilityStartTime,t.minBufferTime=e.manifest.minBufferTime,t.maxFragmentDuration=e.maxSegmentDuration,t.duration=_.getDuration(e.manifest),t.isDynamic=_.getIsDynamic(e.manifest),t}(e.mpd),t.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(t.start+t.duration-t.manifestInfo.duration)<1,t}function c(e,t,r,n){var i,o=_.getAdaptationsForType(e,t,r);if(!o||0===o.length)return null;if(1<o.length&&n){var a=d(n,r);if(l[n.id]&&l[n.id][r])for(var s=0,u=o.length;s<u;s++)if(l[n.id][r].isMediaInfoEqual(a[s]))return o[s];for(s=0,u=o.length;s<u;s++)if(i=o[s],_.getRolesForAdaptation(i).filter(function(e){return e.value===h.default.MAIN})[0])return o[s]}return o[0]}function d(e,t,r){var n,i=b,o=r,a=[],s=void 0,u=void 0,l=void 0,c=void 0,d=void 0;if(o){S();var f=_.getMpd(o);i=_.getRegularPeriods(f)}else{if(!(0<b.length))return a;o=b[0].mpd.manifest}var h=w(e,i),p=h.id,m=_.getAdaptationsForType(o,e.index,t!==x.default.EMBEDDED_TEXT?t:x.default.VIDEO);if(!m)return a;for(E[p]=E[p]||_.getAdaptationsForPeriod(h),c=0,n=m.length;c<n;c++)if(s=m[c],l=_.getIndexForAdaptation(s,o,e.index),u=A(E[p][l]),t===x.default.EMBEDDED_TEXT){var g=u.accessibility.length;for(d=0;d<g;d++)if(u){var v=u.accessibility[d];if(0===v.indexOf("cea-608:")){var y=v.substring(8).split(";");if("CC"===y[0].substring(0,2))for(d=0;d<y.length;d++)T(u=u||A.call(this,E[p][l]),y[d].substring(0,3),y[d].substring(4)),a.push(u),u=null;else for(d=0;d<y.length;d++)T(u=u||A.call(this,E[p][l]),"CC"+(d+1),y[d]),a.push(u),u=null}else 0===v.indexOf("cea-608")&&(T(u,x.default.CC1,"eng"),a.push(u),u=null)}}else t===x.default.IMAGE?(u.type=x.default.IMAGE,a.push(u),u=null):u&&a.push(u);return a}function S(){if(!_||!_.hasOwnProperty("getMpd")||!_.hasOwnProperty("getRegularPeriods"))throw new Error("setConfig function has to be called previously")}function f(e){if(!(e&&e.hasOwnProperty("getRepresentationController")&&e.hasOwnProperty("getIndexHandler")&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getType")&&e.hasOwnProperty("getStreamInfo")))throw new Error("streamProcessor parameter is missing or malformed!")}function t(){b=[],E={},l={}}return e={convertDataToRepresentationInfo:n,getDataForMedia:u,getStreamsInfo:function(e,t){var r=[],n=b;if(e){S();var i=_.getMpd(e);n=_.getRegularPeriods(i)}t=t||n.length;for(var o=0;o<t;o++)r.push(a(n[o]));return r},getMediaInfoForType:function(e,t){if(0===b.length)return null;var r=b[0].mpd.manifest,n=c(r,e.index,t,e);if(!n)return null;var i=w(e,b),o=i.id,a=_.getIndexForAdaptation(n,r,e.index);return E[o]=E[o]||_.getAdaptationsForPeriod(i),A(E[o][a])},getAllMediaInfoForType:d,getRepresentationInfo:function(e,t){!function(e){if(!e||!e.hasOwnProperty("getRepresentationForQuality")||!e.hasOwnProperty("getCurrentRepresentation"))throw new Error("representationController parameter is missing or malformed!")}(e);var r=void 0;return(r=void 0!==t?((0,y.checkInteger)(t),e.getRepresentationForQuality(t)):e.getCurrentRepresentation())?n(r):null},getAdaptationForType:c,updateData:function(e){f(e);var t,r=w(e.getStreamInfo(),b),n=e.getMediaInfo(),i=u(n),o=e.getType(),a=void 0;t=n?n.id:null,0<b.length&&(a=t?_.getAdaptationForId(t,b[0].mpd.manifest,r.index):_.getAdaptationForIndex(n.index,b[0].mpd.manifest,r.index),e.getRepresentationController().updateData(a,i,o))},getInitRequest:function(e,t){var r,n=void 0,i=void 0;return f(e),(0,y.checkInteger)(t),n=e.getRepresentationController(),i=e.getIndexHandler(),r=n?n.getRepresentationForQuality(t):null,i?i.getInitRequest(r):null},getFragmentRequest:function(e,t,r,n){var i,o=void 0,a=null;return f(e),i=s(t,e.getRepresentationController()),(o=e.getIndexHandler())&&(a=void 0!==r&&void 0!==n?o.getSegmentRequestForTime(i,r,n):o.getNextSegmentRequest(i)),a},getIndexHandlerTime:function(e){f(e);var t=e.getIndexHandler();return t?t.getCurrentTime():NaN},setIndexHandlerTime:function(e,t){f(e);var r=e.getIndexHandler();r&&r.setCurrentTime(t)},getEventsFor:function(e,t){var r=[];if(0===b.length)return r;var n=b[0].mpd.manifest;return e instanceof p.default?r=_.getEventsForPeriod(w(e,b)):e instanceof o.default?r=_.getEventStreamForAdaptationSet(n,u(e)):e instanceof i.default&&(r=_.getEventStreamForRepresentation(n,s(e,t.getRepresentationController()))),r},getEvent:function(e,t,r){if(!e||!t)return null;var n=new g.default,i=e.scheme_id_uri,o=e.value,a=e.timescale,s=e.presentation_time_delta,u=e.event_duration,l=e.id,c=e.message_data,d=r*a+s;return t[i+"/"+o]?(n.eventStream=t[i+"/"+o],n.eventStream.value=o,n.eventStream.timescale=a,n.duration=u,n.id=l,n.presentationTime=d,n.messageData=c,n.presentationTimeDelta=s,n):null},setConfig:function(e){e&&e.dashManifestModel&&(_=e.dashManifestModel)},updatePeriods:function(e){if(!e)return null;S();var t=_.getMpd(e);b=_.getRegularPeriods(t),E={}},reset:t,resetIndexHandler:function(e){f(e);var t=e.getIndexHandler();t&&t.resetIndex()},setCurrentMediaInfo:function(e,t,r){l[e]=l[e]||{},l[e][t]=l[e][t]||{},l[e][t]=r}},t(),e}s.__dashjs_factory_name="DashAdapter",r.default=a.default.getSingletonFactory(s),t.exports=r.default},{"../../externals/cea608-parser":341,"../core/FactoryMaker":347,"../streaming/constants/Constants":400,"../streaming/utils/SupervisorTools":507,"../streaming/vo/ManifestInfo":520,"../streaming/vo/MediaInfo":521,"../streaming/vo/RepresentationInfo":523,"../streaming/vo/StreamInfo":524,"./constants/DashConstants":359,"./vo/Event":382}],355:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var I=n(e("../streaming/constants/Constants")),L=n(e("./constants/DashConstants")),N=n(e("../streaming/vo/FragmentRequest")),k=n(e("../streaming/vo/DashJSError")),F=e("../streaming/vo/metrics/HTTPRequest"),j=n(e("../core/events/Events")),B=n(e("../core/EventBus")),U=n(e("../core/errors/Errors")),i=n(e("../core/FactoryMaker")),G=n(e("../core/Debug")),H=n(e("../streaming/utils/URLUtils")),V=n(e("./vo/Representation")),z=e("./utils/SegmentsUtils"),W=n(e("./utils/SegmentsGetter")),q=n(e("./SegmentBaseLoader")),Y=n(e("./WebmSegmentBaseLoader"));function o(t){t=t||{};var e,r=this.context,l=(0,B.default)(r).getInstance(),a=(0,H.default)(r).getInstance(),o=void 0,c=t.timelineConverter,i=t.dashMetrics,s=t.metricsModel,d=t.mediaPlayerModel,n=t.errHandler,u=t.baseURLController,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0;function _(){return v?v.getType():null}function b(){var e=v?v.getStreamInfo():null;return e?e.manifestInfo.isDynamic:null}function E(){return v?v.getMediaInfo():null}function w(){p=-1}function A(){w(),g=0,y=v=m=null}function T(e,t,r){var n=u.resolve(r.path),i=void 0,o=void 0;return n&&t!==n.url&&a.isRelative(t)?(i=n.url,o=n.serviceLocation,t&&(i=a.resolve(t,i))):i=t,!a.isRelative(i)&&(e.url=i,e.serviceLocation=o,!0)}function S(e){var t=!1,r=b();if(r||p!==e.availableSegmentsNumber){var n=(0,z.getSegmentByIndex)(p,e);if(n){var i=parseFloat((n.presentationStartTime-e.adaptation.period.start).toFixed(5)),o=e.adaptation.period.duration;h.debug(e.segmentInfoType+": "+i+" / "+o),t=(e.segmentInfoType!==L.default.SEGMENT_TIMELINE||!r)&&o<=i}else h.debug("isMediaFinished - no segment found")}else t=!0;return t}function x(e){y.getSegments(e,m,p,M)}function M(e,t){if((e.segments=t)&&0<t.length&&b()){var r=t[t.length-1].presentationStartTime,n=s.getMetricsFor(I.default.STREAM);c.setExpectedLiveEdge(r),s.updateManifestUpdateInfo(i.getCurrentManifestUpdate(n),{presentationStartTime:r})}}function R(e){if(!e)throw new Error("no representation");e.segments=null,x(e)}function O(e,t,r){var n=t.segments,i=n?n.length:null,o=-1,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0;if(n&&0<i)for(r=null==r?d.getSegmentOverlapToleranceTime():r,c=0;c<i;c++)if(u=(s=n[c]).presentationStartTime,l=s.duration,u<=e+(a=null==r?l/2:r)&&e-a<u+l){o=s.availabilityIdx;break}return o}function P(e){if(null==e)return null;var t=new N.default,r=e.representation,n=r.adaptation.period.mpd.manifest.Period_asArray[r.adaptation.period.index].AdaptationSet_asArray[r.adaptation.index].Representation_asArray[r.index].bandwidth,i=e.media;return i=(0,z.replaceTokenForTemplate)(i,"Number",e.replacementNumber),i=(0,z.replaceTokenForTemplate)(i,"Time",e.replacementTime),i=(0,z.replaceTokenForTemplate)(i,"Bandwidth",n),i=(0,z.replaceIDForTemplate)(i,r.id),i=(0,z.unescapeDollarsInTemplate)(i),t.mediaType=_(),t.type=F.HTTPRequest.MEDIA_SEGMENT_TYPE,t.range=e.mediaRange,t.startTime=e.presentationStartTime,t.duration=e.duration,t.timescale=r.timescale,t.availabilityStartTime=e.availabilityStartTime,t.availabilityEndTime=e.availabilityEndTime,t.wallStartTime=e.wallStartTime,t.quality=r.index,t.index=e.availabilityIdx,t.mediaInfo=E(),t.adaptationIndex=r.adaptation.index,t.representationId=r.id,T(t,i,r)?t:void 0}function C(e){var t=e.representation;t.segments&&l.trigger(j.default.REPRESENTATION_UPDATED,{sender:this,representation:t})}function D(e){if(!e.error&&_()===e.mediaType){var t,r=e.segments,n=e.representation,i=[],o=0,a=void 0,s=void 0,u=void 0;for(a=0,t=r.length;a<t;a++)s=r[a],u=(0,z.getTimeBasedSegment)(c,b(),n,s.startTime,s.duration,s.timescale,s.media,s.mediaRange,o),i.push(u),u=null,o++;n.segmentAvailabilityRange={start:i[0].presentationStartTime,end:i[t-1].presentationStartTime},n.availableSegmentsNumber=t,M(n,i),V.default.hasInitialization(n)&&l.trigger(j.default.REPRESENTATION_UPDATED,{sender:this,representation:n})}}return f={initialize:function(e){v=e,o.initialize(),y=(0,W.default)(r).create(t,b())},getStreamProcessor:function(){return v},getInitRequest:function(e){return e?function(e,t){var r=new N.default,n=e.adaptation.period,i=n.start,o=b();if(r.mediaType=t,r.type=F.HTTPRequest.INIT_SEGMENT_TYPE,r.range=e.range,r.availabilityStartTime=c.calcAvailabilityStartTimeFromPresentationTime(i,n.mpd,o),r.availabilityEndTime=c.calcAvailabilityEndTimeFromPresentationTime(i+n.duration,n.mpd,o),r.quality=e.index,r.mediaInfo=E(),r.representationId=e.id,T(r,e.initialization,e))return r}(e,_()):null},getSegmentRequestForTime:function(e,t,r){var n=void 0;if(!e)return null;var i=_(),o=p,a=!!r&&r.keepIdx,s=r?r.timeThreshold:null,u=!(!r||!r.ignoreIsFinished);return m!==t&&(m=t,h.debug("Getting the request for "+i+" time : "+t)),x(e),(p=O(t,e,s))<0&&(x(e),p=O(t,e,s)),0<=p&&h.debug("Index for "+i+" time "+t+" is "+p),!u&&S(e)?((n=new N.default).action=N.default.ACTION_COMPLETE,n.index=p,n.mediaType=i,n.mediaInfo=E(),h.debug("Signal complete in getSegmentRequestForTime -",i)):n=P((0,z.getSegmentByIndex)(p,e)),a&&0<=o&&(p=e.segmentInfoType===L.default.SEGMENT_TIMELINE&&b()?p:o),n},getNextSegmentRequest:function(e){var t=void 0,r=void 0;if(!e||-1===p)return null;var n=_(),i=b();return m=null,p++,h.debug("Getting the next request at index: "+p+", type: "+n),!(0,z.getSegmentByIndex)(p,e)&&i?(h.debug("No segment found at index: "+p+". Wait for next loop"),x(e),p--,null):(S(e)?((t=new N.default).action=N.default.ACTION_COMPLETE,t.index=p,t.mediaType=n,t.mediaInfo=E(),h.debug("Signal complete -",n)):(x(e),t=P(r=(0,z.getSegmentByIndex)(p,e)),!r&&i&&p--),t)},updateRepresentation:function(e,t){var r=V.default.hasInitialization(e),n=V.default.hasSegments(e),i=void 0;if(e.segmentDuration||e.segments||R(e),e.segmentAvailabilityRange=c.calcSegmentAvailabilityRange(e,b()),e.segmentAvailabilityRange.end<e.segmentAvailabilityRange.start&&!e.useCalculatedLiveEdgeTime)return i=new k.default(U.default.SEGMENTS_UNAVAILABLE_ERROR_CODE,U.default.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE,{availabilityDelay:e.segmentAvailabilityRange.start-e.segmentAvailabilityRange.end}),void l.trigger(j.default.REPRESENTATION_UPDATED,{sender:this,representation:e,error:i});t||w(),e.segmentDuration&&R(e),r||o.loadInitialization(e),n||o.loadSegments(e,_(),e.indexRange),r&&n&&l.trigger(j.default.REPRESENTATION_UPDATED,{sender:this,representation:e})},updateSegmentList:R,setCurrentTime:function(e){g=e},getCurrentTime:function(){return g},reset:function(){A(),l.off(j.default.INITIALIZATION_LOADED,C,f),l.off(j.default.SEGMENTS_LOADED,D,f)},resetIndex:w},h=(0,G.default)(r).getInstance().getLogger(f),A(),(e=t.mimeType,o="webm"===e.split("/")[1].toLowerCase()?(0,Y.default)(r).getInstance():(0,q.default)(r).getInstance()).setConfig({baseURLController:u,metricsModel:s,mediaPlayerModel:d,errHandler:n}),l.on(j.default.INITIALIZATION_LOADED,C,f),l.on(j.default.SEGMENTS_LOADED,D,f),f}o.__dashjs_factory_name="DashHandler",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../core/Debug":345,"../core/EventBus":346,"../core/FactoryMaker":347,"../core/errors/Errors":349,"../core/events/Events":352,"../streaming/constants/Constants":400,"../streaming/utils/URLUtils":509,"../streaming/vo/DashJSError":514,"../streaming/vo/FragmentRequest":516,"../streaming/vo/metrics/HTTPRequest":534,"./SegmentBaseLoader":357,"./WebmSegmentBaseLoader":358,"./constants/DashConstants":359,"./utils/SegmentsGetter":375,"./utils/SegmentsUtils":376,"./vo/Representation":386}],356:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("../streaming/vo/metrics/HTTPRequest"),i=n(e("../core/FactoryMaker")),d=n(e("../streaming/constants/MetricsConstants")),f=n(e("./utils/Round10"));function o(e){var u=(e=e||{}).dashManifestModel,r=e.manifestModel;function n(e){var t=r.getValue();return t?t.Period_asArray[e]:-1}function i(e){return t(e,d.default.BUFFER_LEVEL)}function o(e){if(!e)return null;var t=e.HttpList,r=null,n=void 0;if(!t||t.length<=0)return null;for(n=t.length-1;0<=n;){if(t[n].responsecode){r=t[n];break}n--}return r}function a(e){return e&&e.HttpList?e.HttpList:[]}function t(e,t){if(!e)return null;var r=e[t];return!r||r.length<=0?null:r[r.length-1]}function s(e){var t={};if(!e)return t;for(var r=e.trim().split("\r\n"),n=0,i=r.length;n<i;n++){var o=r[n],a=o.indexOf(": ");0<a&&(t[o.substring(0,a)]=o.substring(a+2))}return t}function l(e,t,r){var n=void 0,i=void 0,o=void 0,a=void 0,s=void 0;if(e)for(n=e.AdaptationSet_asArray,a=0;a<n.length;a+=1)for(o=n[a].Representation_asArray,s=0;s<o.length;s+=1)if(t===(i=o[s]).id)return r?s:i;return null}return{getBandwidthForRepresentation:function(e,t){var r;return null===(r=l(n(t),e))?null:r.bandwidth},getIndexForRepresentation:function(e,t){return function(e,t){var r=l(e,t,!0);return null===r?-1:r}(n(t),e)},getMaxIndexForBufferType:function(e,t){return function(e,t){var r,n=void 0,i=void 0,o=void 0;if(!e||!t)return-1;for(r=e.AdaptationSet_asArray,o=0;o<r.length;o+=1)if(n=r[o],i=n.Representation_asArray,a=n,s=t,u.getIsTypeOf(a,s))return i.length;var a,s;return-1}(n(t),e)},getCurrentRepresentationSwitch:function(e){return t(e,d.default.TRACK_SWITCH)},getLatestBufferLevelVO:i,getCurrentBufferLevel:function(e){var t=i(e);return t?f.default.round10(t.level/1e3,-3):0},getCurrentHttpRequest:o,getHttpRequests:a,getCurrentDroppedFrames:function(e){return t(e,d.default.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return t(e,d.default.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return t(e,d.default.DVR_INFO)},getCurrentManifestUpdate:function(e){return t(e,d.default.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){var r={},n=o(e);return n&&(r=s(n._responseHeaders)),void 0===r[t]?null:r[t]},getLatestMPDRequestHeaderValueByID:function(e,t){var r,n={},i=void 0,o=void 0;for(o=(r=a(e)).length-1;0<=o;o--)if((i=r[o]).type===c.HTTPRequest.MPD_TYPE){n=s(i._responseHeaders);break}return void 0===n[t]?null:n[t]},getRequestsQueue:function(e){return e?e.RequestsQueue:null}}}o.__dashjs_factory_name="DashMetrics",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../core/FactoryMaker":347,"../streaming/constants/MetricsConstants":401,"../streaming/vo/metrics/HTTPRequest":534,"./utils/Round10":374}],357:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=n(e("../streaming/utils/RequestModifier")),E=n(e("./vo/Segment")),l=n(e("../streaming/vo/DashJSError")),c=n(e("../core/events/Events")),d=n(e("../core/EventBus")),f=n(e("../streaming/utils/BoxParser")),i=n(e("../core/FactoryMaker")),h=n(e("../core/Debug")),p=e("../streaming/vo/metrics/HTTPRequest"),w=n(e("../streaming/vo/FragmentRequest")),A=n(e("../streaming/net/HTTPLoader")),T=n(e("../core/errors/Errors"));function o(){var e=this.context,s=(0,d.default)(e).getInstance(),t=void 0,m=void 0,r=void 0,g=void 0,n=void 0,i=void 0,o=void 0,u=void 0,v=void 0;function y(){if(!v||!v.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function _(e){if(e.url){var t=new w.default;return t.type=e.init?p.HTTPRequest.INIT_SEGMENT_TYPE:p.HTTPRequest.MEDIA_SEGMENT_TYPE,t.url=e.url,t.range=e.range.start+"-"+e.range.end,t}}function b(e,t,r){e?s.trigger(c.default.SEGMENTS_LOADED,{segments:e,representation:t,mediaType:r}):s.trigger(c.default.SEGMENTS_LOADED,{segments:null,representation:t,mediaType:r,error:new l.default(T.default.SEGMENT_BASE_LOADER_ERROR_CODE,T.default.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}return t={setConfig:function(e){e.baseURLController&&(v=e.baseURLController),e.metricsModel&&(i=e.metricsModel),e.mediaPlayerModel&&(o=e.mediaPlayerModel),e.errHandler&&(r=e.errHandler)},initialize:function(){g=(0,f.default)(e).getInstance(),n=(0,a.default)(e).getInstance(),u=(0,A.default)(e).create({errHandler:r,metricsModel:i,mediaPlayerModel:o,requestModifier:n})},loadInitialization:function t(r,e){y();var n=null,i=v.resolve(r.path),o=e||{init:!0,url:i?i.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500};m.debug("Start searching for initialization.");var a=_(o);u.load({request:a,success:function(e){o.bytesLoaded=o.range.end,(n=g.findInitRange(e))?(r.range=n,s.trigger(c.default.INITIALIZATION_LOADED,{representation:r})):(o.range.end=o.bytesLoaded+o.bytesToLoad,t(r,o))},error:function(){s.trigger(c.default.INITIALIZATION_LOADED,{representation:r})}}),m.debug("Perform init search: "+o.url)},loadSegments:function l(c,d,e,t,f){if(y(),e&&(void 0===e.start||void 0===e.end)){var r=e?e.toString().split("-"):null;e=r?{start:parseFloat(r[0]),end:parseFloat(r[1])}:null}f=f||b;var a=null,h=null,n=!!e,i=v.resolve(c.path),p={init:!1,url:i?i.url:void 0,range:n?e:{start:0,end:1500},searching:!n,bytesLoaded:t?t.bytesLoaded:0,bytesToLoad:1500},o=_(p);u.load({request:o,success:function(e){var t=p.bytesToLoad,r=e.byteLength;if(p.bytesLoaded=p.range.end-p.range.start,a=g.parse(e),(h=a.getBox("sidx"))&&h.isComplete){var u=h.references,n=void 0,i=void 0;null!=u&&0<u.length&&(n=1===u[0].reference_type),n?function(){function e(e){e?(o=o.concat(e),r<=++a&&f(o,c,d)):f(null,c,d)}m.debug("Initiate multiple SIDX load."),p.range.end=p.range.start+h.size;var t=void 0,r=void 0,n=void 0,i=void 0,o=[],a=0,s=(h.offset||p.range.start)+h.size;for(t=0,r=u.length;t<r;t++)i=(n=s)+u[t].referenced_size-1,s+=u[t].referenced_size,l(c,null,{start:n,end:i},p,e)}():(m.debug("Parsing segments from SIDX."),i=function(e,t){for(var r=e.references,n=r.length,i=e.timescale,o=e.earliest_presentation_time,a=t.range.start+e.offset+e.first_offset+e.size,s=[],u=void 0,l=void 0,c=void 0,d=void 0,f=0;f<n;f++)c=r[f].subsegment_duration,d=r[f].referenced_size,(u=new E.default).duration=c,u.startTime=o,u.timescale=i,l=a+d-1,u.mediaRange=a+"-"+l,s.push(u),o+=c,a+=d;return s}(h,p),f(i,c,d))}else{if(h)p.range.start=h.offset||p.range.start,p.range.end=p.range.start+(h.size||t);else{if(r<p.bytesLoaded)return void f(null,c,d);var o=a.getLastBox();o&&o.size?(p.range.start=o.offset+o.size,p.range.end=p.range.start+t):p.range.end+=t}l(c,d,p.range,p,f)}},error:function(){f(null,c,d)}}),m.debug("Perform SIDX load: "+p.url)},reset:function(){u.abort(),n=g=r=u=null}},m=(0,h.default)(e).getInstance().getLogger(t),t}o.__dashjs_factory_name="SegmentBaseLoader",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../core/Debug":345,"../core/EventBus":346,"../core/FactoryMaker":347,"../core/errors/Errors":349,"../core/events/Events":352,"../streaming/net/HTTPLoader":447,"../streaming/utils/BoxParser":496,"../streaming/utils/RequestModifier":506,"../streaming/vo/DashJSError":514,"../streaming/vo/FragmentRequest":516,"../streaming/vo/metrics/HTTPRequest":534,"./vo/Segment":387}],358:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=n(e("../core/events/Events")),o=n(e("../core/EventBus")),b=n(e("../streaming/utils/EBMLParser")),a=n(e("../streaming/constants/Constants")),i=n(e("../core/FactoryMaker")),f=n(e("../core/Debug")),h=n(e("../streaming/utils/RequestModifier")),E=n(e("./vo/Segment")),w=e("../streaming/vo/metrics/HTTPRequest"),A=n(e("../streaming/vo/FragmentRequest")),T=n(e("../streaming/net/HTTPLoader")),S=n(e("../streaming/vo/DashJSError")),x=n(e("../core/errors/Errors"));function s(){var p=this.context,s=(0,o.default)(p).getInstance(),e=void 0,m=void 0,g=void 0,t=void 0,r=void 0,n=void 0,i=void 0,v=void 0,u=void 0;function y(e,t,r,n){var i,o,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0;for(s=[],l=0,o=(i=function(e){var t=[],r=void 0,n=void 0,i=(0,b.default)(p).create({data:e});for(i.consumeTagAndSize(g.Segment.Cues);i.moreData()&&i.consumeTagAndSize(g.Segment.Cues.CuePoint,!0);){for((r={}).CueTime=i.parseTag(g.Segment.Cues.CuePoint.CueTime),r.CueTracks=[];i.moreData()&&i.consumeTag(g.Segment.Cues.CuePoint.CueTrackPositions,!0);){var o=i.getMatroskaCodedNum(),a=i.getPos();if((n={}).Track=i.parseTag(g.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===n.Track)throw new Error("Cue track cannot be 0");n.ClusterPosition=i.parseTag(g.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),r.CueTracks.push(n),i.setPos(a+o)}if(0===r.CueTracks.length)throw new Error("Mandatory cuetrack not found");t.push(r)}if(0===t.length)throw new Error("mandatory cuepoint not found");return t}(e)).length;l<o;l+=1)u=new E.default,a=0,a=l<i.length-1?i[l+1].CueTime-i[l].CueTime:n-i[l].CueTime,u.duration=a,u.startTime=i[l].CueTime,u.timescale=1e3,c=i[l].CueTracks[0].ClusterPosition+t,d=l<i.length-1?i[l+1].CueTracks[0].ClusterPosition+t-1:r-1,u.mediaRange=c+"-"+d,s.push(u);return m.debug("Parsed cues: "+s.length+" cues."),s}function l(){if(!u||!u.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function c(e,t,r){e?s.trigger(d.default.SEGMENTS_LOADED,{segments:e,representation:t,mediaType:r}):s.trigger(d.default.SEGMENTS_LOADED,{segments:null,representation:t,mediaType:r,error:new S.default(x.default.SEGMENT_BASE_LOADER_ERROR_CODE,x.default.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function _(e){var t=new A.default;return t.type=e.init?w.HTTPRequest.INIT_SEGMENT_TYPE:w.HTTPRequest.MEDIA_SEGMENT_TYPE,t.url=e.url,t.range=e.range.start+"-"+e.range.end,t}return e={setConfig:function(e){if(!(e.baseURLController&&e.metricsModel&&e.mediaPlayerModel&&e.errHandler))throw new Error(a.default.MISSING_CONFIG_ERROR);u=e.baseURLController,n=e.metricsModel,i=e.mediaPlayerModel,t=e.errHandler},initialize:function(){r=(0,h.default)(p).getInstance(),v=(0,T.default)(p).create({errHandler:t,metricsModel:n,mediaPlayerModel:i,requestModifier:r})},loadInitialization:function(e,t){l();var r=null,n=u.resolve(e.path),i=n?n.url:void 0,o=e.range.split("-"),a=t||{range:{start:parseFloat(o[0]),end:parseFloat(o[1])},request:r,url:i,init:!0};m.info("Start loading initialization."),r=_(a),v.load({request:r,success:function(){s.trigger(d.default.INITIALIZATION_LOADED,{representation:e})},error:function(){s.trigger(d.default.INITIALIZATION_LOADED,{representation:e})}}),m.debug("Perform init load: "+a.url)},loadSegments:function(t,r,n,i){l();var e=null,o=u.resolve(t.path),a=o?o.url:void 0;i=i||c,e=_({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:e,url:a,init:!1}),m.debug("Parsing ebml header"),v.load({request:e,success:function(e){!function(e,t,r,n){var i,o=(0,b.default)(p).create({data:e}),a=void 0,s=void 0,u=r.split("-"),l=null,c={url:t,range:{start:parseFloat(u[0]),end:parseFloat(u[1])},request:l},d=void 0;for(m.debug("Parse EBML header: "+c.url),o.skipOverElement(g.EBML),o.consumeTag(g.Segment),d=o.getMatroskaCodedNum(),d+=o.getPos(),i=o.getPos();o.moreData()&&!o.consumeTagAndSize(g.Segment.Info,!0);)if(!(o.skipOverElement(g.Segment.SeekHead,!0)||o.skipOverElement(g.Segment.Tracks,!0)||o.skipOverElement(g.Segment.Cues,!0)||o.skipOverElement(g.Void,!0)))throw new Error("no valid top level element found");for(;void 0===a;){var f=o.getMatroskaCodedNum(!0),h=o.getMatroskaCodedNum();switch(f){case g.Segment.Info.Duration.tag:a=o[g.Segment.Info.Duration.parse](h);break;default:o.setPos(o.getPos()+h)}}l=_(c),v.load({request:l,success:function(e){s=y(e,i,d,a),n(s)},error:function(){m.error("Download Error: Cues "+c.url),n(null)}}),m.debug("Perform cues load: "+c.url+" bytes="+c.range.start+"-"+c.range.end)}(e,a,n,function(e){i(e,t,r)})},error:function(){i(null,t,r)}})},reset:function(){r=t=null}},m=(0,f.default)(p).getInstance().getLogger(e),g={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},e}s.__dashjs_factory_name="WebmSegmentBaseLoader",r.default=i.default.getSingletonFactory(s),t.exports=r.default},{"../core/Debug":345,"../core/EventBus":346,"../core/FactoryMaker":347,"../core/errors/Errors":349,"../core/events/Events":352,"../streaming/constants/Constants":400,"../streaming/net/HTTPLoader":447,"../streaming/utils/EBMLParser":500,"../streaming/utils/RequestModifier":506,"../streaming/vo/DashJSError":514,"../streaming/vo/FragmentRequest":516,"../streaming/vo/metrics/HTTPRequest":534,"./vo/Segment":387}],359:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.init()}Object.defineProperty(r,"__esModule",{value:!0});var o=new(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(i,[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight"}}]),i);r.default=o,t.exports=r.default},{}],360:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var P=n(e("../../streaming/constants/Constants")),C=n(e("../../core/errors/Errors")),D=n(e("../constants/DashConstants")),I=n(e("../../streaming/vo/DashJSError")),L=n(e("../../core/EventBus")),N=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),k=n(e("../vo/Representation"));function o(){var e=this.context,d=(0,L.default)(e).getInstance(),r=void 0,f=void 0,l=void 0,h=void 0,p=void 0,m=void 0,g=void 0,c=void 0,v=void 0,y=void 0,n=void 0,i=void 0,_=void 0,b=void 0,E=void 0,t=void 0;function w(){return h}function A(){return m}function o(){l=-1,h=!(f=null),p=[],b=_=i=n=y=v=g=null}function T(){var e=new Date,t=A(),r=1e3*v.getTime();y.addRepresentationSwitch(t.adaptation.type,e,r,t.id)}function S(){var e=E.getStreamInfo(),t=e?e.manifestInfo:null,r=t?t.isDynamic:null,n=i.calcSegmentAvailabilityRange(m,r);y.addDVRInfo(E.getType(),v.getTime(),t,n)}function x(e){return null==e||e>=p.length?null:p[e]}function M(e){var t=e;h=!1,d.trigger(N.default.AST_IN_FUTURE,{delay:t}),setTimeout(function(){if(!w()){h=!0,d.trigger(N.default.DATA_UPDATE_STARTED,{sender:r}),p.forEach(function(e){e.segmentAvailabilityRange=null});for(var e=0;e<p.length;e++)c.updateRepresentation(p[e],!0)}},t)}function a(e){if(e.sender.getStreamProcessor()===E&&w()){var t=e.representation,r=y.getMetricsFor(P.default.STREAM),n=y.getMetricsFor(A().adaptation.type),i=b.getCurrentManifestUpdate(r),o=!1,a=0,s=void 0,u=void 0;if(t.adaptation.period.mpd.manifest.type===D.default.DYNAMIC&&!t.adaptation.period.mpd.manifest.ignorePostponeTimePeriod){var l=t.segmentAvailabilityRange.end-t.segmentAvailabilityRange.start;a=1e3*(v.computeLiveDelay(m.segmentDuration,E.getStreamInfo().manifestInfo.DVRWindowSize)-l)}if(0<a)return S(),M(a),u=new I.default(C.default.SEGMENTS_UPDATE_FAILED_ERROR_CODE,C.default.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE),void d.trigger(N.default.DATA_UPDATE_COMPLETED,{sender:this,data:f,currentRepresentation:m,error:u});if(i){for(var c=0;c<i.representationInfo.length;c++)if((s=i.representationInfo[c]).index===t.index&&s.mediaType===E.getType()){o=!0;break}o||y.addManifestUpdateRepresentationInfo(i,t.id,t.index,t.adaptation.period.index,E.getType(),t.presentationTimeOffset,t.startNumber,t.segmentInfoType)}!function(){for(var e=0,t=p.length;e<t;e++){var r=p[e].segmentInfoType;if(null===p[e].segmentAvailabilityRange||!k.default.hasInitialization(p[e])||(r===D.default.SEGMENT_BASE||r===D.default.BASE_URL)&&!p[e].segments)return!1}return!0}()||(h=!1,g.setPlaybackQuality(E.getType(),E.getStreamInfo(),function(e){return p.indexOf(e)}(m)),y.updateManifestUpdateInfo(i,{latency:m.segmentAvailabilityRange.end-v.getTime()}),b.getCurrentRepresentationSwitch(n)||T(),d.trigger(N.default.DATA_UPDATE_COMPLETED,{sender:this,data:f,currentRepresentation:m}))}}function s(e){e.isDynamic&&function(e){for(var t=void 0,r=0,n=p.length;r<n;r++)(t=p[r]).segmentAvailabilityRange=i.calcSegmentAvailabilityRange(t,e)}(e.isDynamic)}function u(e){e.sender.getStreamProcessor()===E&&(t.getValue().doNotUpdateDVRWindowOnBufferUpdated||S())}function R(e){if(e.mediaType===E.getType()&&E.getStreamInfo().id===e.streamInfo.id&&e.oldQuality!==e.newQuality){m=x(e.newQuality);var t=g.getThroughputHistory().getAverageThroughput(e.mediaType);isNaN(t)||n.setSavedBitrateSettings(e.mediaType,t),T()}}function O(e){if(e.newDuration){var t=A();if(t&&t.adaptation.period)t.adaptation.period.duration=e.newDuration}}return r={initialize:function(){c=E.getIndexHandler()},setConfig:function(e){e.abrController&&(g=e.abrController),e.domStorage&&(n=e.domStorage),e.metricsModel&&(y=e.metricsModel),e.dashMetrics&&(b=e.dashMetrics),e.dashManifestModel&&(_=e.dashManifestModel),e.playbackController&&(v=e.playbackController),e.timelineConverter&&(i=e.timelineConverter),e.manifestModel&&(t=e.manifestModel),e.streamProcessor&&(E=e.streamProcessor)},getData:function(){return f},getDataIndex:function(){return l},isUpdating:w,updateData:function(e,t,r){var n=E.getStreamInfo(),i=g.getTopQualityIndexFor(r,n.id),o=g.getMinAllowedIndexFor(r),a=void 0,s=null;if(h=!0,d.trigger(N.default.DATA_UPDATE_STARTED,{sender:this}),p=function(e){return l=_.getIndexForAdaptation(f,e.period.mpd.manifest,e.period.index),_.getRepresentationsForAdaptation(e)}(t),a=null!==f&&f.id==e.id||r===P.default.FRAGMENTED_TEXT?g.getQualityFor(r,n):(s=g.getThroughputHistory().getAverageThroughput(r)||g.getInitialBitrateFor(r,n),g.getQualityForBitrate(E.getMediaInfo(),s)),void 0!==o&&a<o&&(a=o),i<a&&(a=i),m=x(a),f=e,r!==P.default.VIDEO&&r!==P.default.AUDIO&&r!==P.default.FRAGMENTED_TEXT)return h=!1,void d.trigger(N.default.DATA_UPDATE_COMPLETED,{sender:this,data:f,currentRepresentation:m});for(var u=0;u<p.length;u++)c.updateRepresentation(p[u],!0)},getStreamProcessor:function(){return E},getCurrentRepresentation:A,getRepresentationForQuality:x,reset:function(){d.off(N.default.QUALITY_CHANGE_REQUESTED,R,r),d.off(N.default.REPRESENTATION_UPDATED,a,r),d.off(N.default.WALLCLOCK_TIME_UPDATED,s,r),d.off(N.default.BUFFER_LEVEL_UPDATED,u,r),d.off(N.default.MANIFEST_VALIDITY_CHANGED,O,r),o()}},o(),d.on(N.default.QUALITY_CHANGE_REQUESTED,R,r),d.on(N.default.REPRESENTATION_UPDATED,a,r),d.on(N.default.WALLCLOCK_TIME_UPDATED,s,r),d.on(N.default.BUFFER_LEVEL_UPDATED,u,r),d.on(N.default.MANIFEST_VALIDITY_CHANGED,O,r),r}o.__dashjs_factory_name="RepresentationController",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/errors/Errors":349,"../../core/events/Events":352,"../../streaming/constants/Constants":400,"../../streaming/vo/DashJSError":514,"../constants/DashConstants":359,"../vo/Representation":386}],361:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var T=n(e("../../streaming/constants/Constants")),S=n(e("../constants/DashConstants")),x=n(e("../vo/Representation")),M=n(e("../vo/AdaptationSet")),R=n(e("../vo/Period")),i=n(e("../vo/Mpd")),o=n(e("../vo/UTCTiming")),O=n(e("../vo/Event")),P=n(e("../vo/BaseURL")),C=n(e("../vo/EventStream")),D=n(e("../../streaming/utils/ObjectUtils")),I=n(e("../../streaming/utils/URLUtils")),a=n(e("../../core/FactoryMaker")),L=n(e("../../core/Debug")),N=n(e("../../streaming/vo/DashJSError")),k=n(e("../../core/errors/Errors")),F=e("../../streaming/thumbnail/ThumbnailTracks");function s(e){e=e||{};var t=void 0,l=void 0,a=this.context,s=(0,I.default)(a).getInstance(),d=e.timelineConverter,c=e.errHandler,f=e.BASE64,r="urn:dvb:dash:profile:dvb-dash:2014",h=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function u(e,t){var r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=!1,l=!1;if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.hasOwnProperty("ContentComponent_asArray")&&(o=e.ContentComponent_asArray),a=t!==T.default.TEXT?new RegExp(t):new RegExp("(vtt|ttml)"),e.Representation_asArray&&e.Representation_asArray.length&&0<e.Representation_asArray.length){var c=y(e.Representation_asArray[0]);if(c&&0<c.length&&0<=F.THUMBNAILS_SCHEME_ID_URIS.indexOf(c[0].schemeIdUri))return t===T.default.IMAGE;if(e.Representation_asArray[0].hasOwnProperty(S.default.CODECS)&&(0===(s=e.Representation_asArray[0].codecs).search(T.default.STPP)||0===s.search(T.default.WVTT)))return t===T.default.FRAGMENTED_TEXT}if(o){if(1<o.length)return t===T.default.MUXED;o[0]&&o[0].contentType===t&&(l=u=!0)}if(e.hasOwnProperty(S.default.MIME_TYPE)&&(u=a.test(e.mimeType),l=!0),!l)for(r=0,n=e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0;!l&&r<n;)(i=e.Representation_asArray[r]).hasOwnProperty(S.default.MIME_TYPE)&&(u=a.test(i.mimeType),l=!0),r++;return u}function p(e){return"text/vtt"===e||"application/ttml+xml"===e}function n(){return function(e,t){return e.bandwidth-t.bandwidth}}function m(e){return e&&void 0!==e.Representation_asArray&&null!==e.Representation_asArray&&e.Representation_asArray.sort(function(e,t){return e.bandwidth-t.bandwidth}),e}function g(e,t){return e&&e.Period_asArray&&h(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function v(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===S.default.DYNAMIC),t}function y(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map(function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}}):null}function _(e){if(e&&e.period&&h(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&h(e.index))return m(t.AdaptationSet_asArray[e.index])}}function b(e){var t=e.S_asArray[e.S_asArray.length-1];return!t.hasOwnProperty("r")||0<=t.r}function E(e,t){if(!e)throw new Error("Period cannot be null or undefined");var r=R.default.DEFAULT_ID+"_"+t;return e.hasOwnProperty(S.default.ID)&&0<e.id.length&&"__proto__"!==e.id&&(r=e.id),r}function w(e,t){var r=[],n=void 0;if(!e)return r;for(n=0;n<e.length;n++){var i=new C.default;if(i.timescale=1,i.representation=t,!e[n].hasOwnProperty(T.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");i.schemeIdUri=e[n].schemeIdUri,e[n].hasOwnProperty(S.default.TIMESCALE)&&(i.timescale=e[n].timescale),e[n].hasOwnProperty(S.default.VALUE)&&(i.value=e[n].value),r.push(i)}return r}function A(n){var i=[],e=n.BaseURL_asArray||[n.baseUri],o=!1;return e.some(function(e){if(e){var t=new P.default,r=e.__text||e;return s.isRelative(r)&&(o=!0,n.baseUri&&(r=s.resolve(r,n.baseUri))),t.url=r,e.hasOwnProperty(S.default.SERVICE_LOCATION)&&e.serviceLocation.length?t.serviceLocation=e.serviceLocation:t.serviceLocation=r,e.hasOwnProperty(S.default.DVB_PRIORITY)&&(t.dvb_priority=e[S.default.DVB_PRIORITY]),e.hasOwnProperty(S.default.DVB_WEIGHT)&&(t.dvb_weight=e[S.default.DVB_WEIGHT]),e.hasOwnProperty(S.default.AVAILABILITY_TIME_OFFSET)&&(t.availabilityTimeOffset=e[S.default.AVAILABILITY_TIME_OFFSET]),e.hasOwnProperty(S.default.AVAILABILITY_TIME_COMPLETE)&&(t.availabilityTimeComplete="false"!==e[S.default.AVAILABILITY_TIME_COMPLETE]),i.push(t),o}}),i}return t={getIsTypeOf:u,getIsTextTrack:p,getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(S.default.LANG)&&(t=e.lang.replace(/[^A-Za-z0-9-]/g,"")),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(S.default.VIEWPOINT)?e.Viewpoint:null},getRolesForAdaptation:function(e){return e&&e.hasOwnProperty(S.default.ROLE_ASARRAY)?e.Role_asArray:[]},getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(S.default.ACCESSIBILITY_ASARRAY)?e.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(S.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAdaptationForIndex:function(e,t,r){var n=g(t,r);return 0<n.length&&h(e)?n[e]:null},getIndexForAdaptation:function(e,t,r){var n=g(t,r),i=n.length;if(e)for(var o=0;o<i;o++){if((0,D.default)(a).getInstance().areEqual(n[o],e))return o}return-1},getAdaptationForId:function(e,t,r){var n,i=g(t,r),o=void 0;for(o=0,n=i.length;o<n;o++)if(i[o].hasOwnProperty(S.default.ID)&&i[o].id===e)return i[o];return null},getAdaptationsForType:function(e,t,r){var n,i=g(e,t),o=void 0,a=[];for(o=0,n=i.length;o<n;o++)u(i[o],r)&&a.push(m(i[o]));return a},getCodec:function(e,t,r){var n=null;if(e&&e.Representation_asArray&&0<e.Representation_asArray.length){var i=h(t)&&0<=t&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];i&&(n=i.mimeType+';codecs="'+i.codecs+'"',r&&void 0!==i.width&&(n+=';width="'+i.width+'";height="'+i.height+'"'))}return n},getMimeType:function(e){return e&&e.Representation_asArray&&0<e.Representation_asArray.length?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(S.default.CENC_DEFAULT_KID)?e[S.default.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(e){if(!e.Label_asArray||!e.Label_asArray.length)return[];for(var t=[],r=0;r<e.Label_asArray.length;r++)t.push({lang:e.Label_asArray[r].lang,text:e.Label_asArray[r].__text||e.Label_asArray[r]});return t},getContentProtectionData:function(e){return e&&e.hasOwnProperty(S.default.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:v,getIsDVB:function(e){return function(e,t){var r=!1;return e&&e.profiles&&0<e.profiles.length&&(r=-1!==e.profiles.indexOf(t)),r}(e,r)},getDuration:function(e){return e&&e.hasOwnProperty(S.default.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=NaN;return e&&e.hasOwnProperty(S.default.MINIMUM_UPDATE_PERIOD)&&(r=e.minimumUpdatePeriod),isNaN(r)?r:Math.max(r-t,1)},getRepresentationCount:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length?m(e).Representation_asArray.map(function(e){return{bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null}}):null},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&0<t.Representation_asArray.length&&h(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t=[],r=_(e),n=void 0,i=void 0;if(e&&e.period&&h(e.period.index)){var o=A(e.period.mpd.manifest);o&&(i=o[0])}if(r&&r.Representation_asArray)for(var a=0,s=r.Representation_asArray.length;a<s;++a){var u=r.Representation_asArray[a],l=new x.default;if(l.index=a,l.adaptation=e,u.hasOwnProperty(S.default.ID)&&(l.id=u.id),u.hasOwnProperty(S.default.CODECS)&&(l.codecs=u.codecs),u.hasOwnProperty(S.default.CODEC_PRIVATE_DATA)&&(l.codecPrivateData=u.codecPrivateData),u.hasOwnProperty(S.default.BANDWITH)&&(l.bandwidth=u.bandwidth),u.hasOwnProperty(S.default.WIDTH)&&(l.width=u.width),u.hasOwnProperty(S.default.HEIGHT)&&(l.height=u.height),u.hasOwnProperty(S.default.SCAN_TYPE)&&(l.scanType=u.scanType),u.hasOwnProperty(S.default.MAX_PLAYOUT_RATE)&&(l.maxPlayoutRate=u.maxPlayoutRate),u.hasOwnProperty(S.default.SEGMENT_BASE)?(n=u.SegmentBase,l.segmentInfoType=S.default.SEGMENT_BASE):u.hasOwnProperty(S.default.SEGMENT_LIST)?(n=u.SegmentList).hasOwnProperty(S.default.SEGMENT_TIMELINE)?(l.segmentInfoType=S.default.SEGMENT_TIMELINE,l.useCalculatedLiveEdgeTime=b(n.SegmentTimeline)):(l.segmentInfoType=S.default.SEGMENT_LIST,l.useCalculatedLiveEdgeTime=!0):u.hasOwnProperty(S.default.SEGMENT_TEMPLATE)?((n=u.SegmentTemplate).hasOwnProperty(S.default.SEGMENT_TIMELINE)?(l.segmentInfoType=S.default.SEGMENT_TIMELINE,l.useCalculatedLiveEdgeTime=b(n.SegmentTimeline)):l.segmentInfoType=S.default.SEGMENT_TEMPLATE,n.hasOwnProperty(S.default.INITIALIZATION_MINUS)&&(l.initialization=n.initialization.split("$Bandwidth$").join(u.bandwidth).split("$RepresentationID$").join(u.id))):l.segmentInfoType=S.default.BASE_URL,l.essentialProperties=y(u),n){if(n.hasOwnProperty(S.default.INITIALIZATION)){var c=n.Initialization;c.hasOwnProperty(S.default.SOURCE_URL)?l.initialization=c.sourceURL:c.hasOwnProperty(S.default.RANGE)&&(l.range=c.range)}else u.hasOwnProperty(S.default.MIME_TYPE)&&p(u.mimeType)&&(l.range=0);n.hasOwnProperty(S.default.TIMESCALE)&&(l.timescale=n.timescale),n.hasOwnProperty(S.default.DURATION)&&(l.segmentDuration=n.duration/l.timescale),n.hasOwnProperty(S.default.MEDIA)&&(l.media=n.media),n.hasOwnProperty(S.default.START_NUMBER)&&(l.startNumber=n.startNumber),n.hasOwnProperty(S.default.INDEX_RANGE)&&(l.indexRange=n.indexRange),n.hasOwnProperty(S.default.PRESENTATION_TIME_OFFSET)&&(l.presentationTimeOffset=n.presentationTimeOffset/l.timescale),n.hasOwnProperty(S.default.AVAILABILITY_TIME_OFFSET)?l.availabilityTimeOffset=n.availabilityTimeOffset:i&&void 0!==i.availabilityTimeOffset&&(l.availabilityTimeOffset=i.availabilityTimeOffset),n.hasOwnProperty(S.default.AVAILABILITY_TIME_COMPLETE)?l.availabilityTimeComplete="false"!==n.availabilityTimeComplete:i&&void 0!==i.availabilityTimeComplete&&(l.availabilityTimeComplete=i.availabilityTimeComplete)}l.MSETimeOffset=d.calcMSETimeOffset(l),l.path=[e.period.index,e.index,a],t.push(l)}return t},getAdaptationsForPeriod:function(e){var t=e&&h(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,r=[],n=void 0,i=void 0,o=void 0;if(t&&t.AdaptationSet_asArray)for(o=0;o<t.AdaptationSet_asArray.length;o++)i=t.AdaptationSet_asArray[o],n=new M.default,i.hasOwnProperty(S.default.ID)&&(n.id=i.id),n.index=o,n.period=e,u(i,T.default.MUXED)?n.type=T.default.MUXED:u(i,T.default.AUDIO)?n.type=T.default.AUDIO:u(i,T.default.VIDEO)?n.type=T.default.VIDEO:u(i,T.default.FRAGMENTED_TEXT)?n.type=T.default.FRAGMENTED_TEXT:u(i,T.default.IMAGE)?n.type=T.default.IMAGE:n.type=T.default.TEXT,r.push(n);return r},getRegularPeriods:function(e){var t,r=!!e&&v(e.manifest),n=[],i=null,o=null,a=null,s=null,u=void 0;for(u=0,t=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;u<t;u++)(o=e.manifest.Period_asArray[u]).hasOwnProperty(S.default.START)?(s=new R.default).start=o.start:null!==i&&i.hasOwnProperty(S.default.DURATION)&&null!==a?(s=new R.default).start=parseFloat((a.start+a.duration).toFixed(5)):0!==u||r||((s=new R.default).start=0),null!==a&&isNaN(a.duration)&&(null!==s?a.duration=parseFloat((s.start-a.start).toFixed(5)):l.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==s&&(s.id=E(o,u),s.index=u,s.mpd=e,o.hasOwnProperty(S.default.DURATION)&&(s.duration=o.duration),n.push(s),i=o,a=s),s=o=null;return 0===n.length||null!==a&&isNaN(a.duration)&&(a.duration=parseFloat((function(e){var t=v(e.mpd.manifest),r=void 0;e.mpd.manifest.mediaPresentationDuration?r=e.mpd.manifest.mediaPresentationDuration:e.duration?r=e.duration:t?r=Number.POSITIVE_INFINITY:c.error(new N.default(k.default.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e));return r}(a)-a.start).toFixed(5))),n},getMpd:function(e){var t=new i.default;return e&&((t.manifest=e).hasOwnProperty(S.default.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):t.availabilityStartTime=new Date(e.loadedTime.getTime()),e.hasOwnProperty(S.default.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(S.default.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(S.default.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(T.default.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(S.default.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(S.default.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration)),t},getEventsForPeriod:function(e){var t=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,r=t?t.Period_asArray:null,n=r&&e&&h(e.index)?r[e.index].EventStream_asArray:null,i=[],o=void 0,a=void 0;if(n)for(o=0;o<n.length;o++){var s=new C.default;if(s.period=e,s.timescale=1,!n[o].hasOwnProperty(T.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(s.schemeIdUri=n[o].schemeIdUri,n[o].hasOwnProperty(S.default.TIMESCALE)&&(s.timescale=n[o].timescale),n[o].hasOwnProperty(S.default.VALUE)&&(s.value=n[o].value),a=0;n[o].Event_asArray&&a<n[o].Event_asArray.length;a++){var u=new O.default;u.presentationTime=0,u.eventStream=s,n[o].Event_asArray[a].hasOwnProperty(S.default.PRESENTATION_TIME)&&(u.presentationTime=n[o].Event_asArray[a].presentationTime),n[o].Event_asArray[a].hasOwnProperty(S.default.DURATION)&&(u.duration=n[o].Event_asArray[a].duration),n[o].Event_asArray[a].hasOwnProperty(S.default.ID)&&(u.id=n[o].Event_asArray[a].id),n[o].Event_asArray[a].Signal&&n[o].Event_asArray[a].Signal.Binary?u.messageData=f.decodeArray(n[o].Event_asArray[a].Signal.Binary):u.messageData=n[o].Event_asArray[a].messageData||n[o].Event_asArray[a].__text,i.push(u)}}return i},getEventStreamForAdaptationSet:function(e,t){var r=void 0,n=void 0,i=void 0;return e&&e.Period_asArray&&t&&t.period&&h(t.period.index)&&(n=e.Period_asArray[t.period.index])&&n.AdaptationSet_asArray&&h(t.index)&&(i=n.AdaptationSet_asArray[t.index])&&(r=i.InbandEventStream_asArray),w(r,null)},getEventStreamForRepresentation:function(e,t){var r=void 0,n=void 0,i=void 0,o=void 0;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&h(t.adaptation.period.index)&&(n=e.Period_asArray[t.adaptation.period.index])&&n.AdaptationSet_asArray&&h(t.adaptation.index)&&(i=n.AdaptationSet_asArray[t.adaptation.index])&&i.Representation_asArray&&h(t.index)&&(o=i.Representation_asArray[t.index])&&(r=o.InbandEventStream_asArray),w(r,t)},getUTCTimingSources:function(e){var t=v(e),r=!!e&&e.hasOwnProperty(S.default.AVAILABILITY_START_TIME),n=e?e.UTCTiming_asArray:null,i=[];return(t||r)&&n&&n.forEach(function(e){var t=new o.default;e.hasOwnProperty(T.default.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(S.default.VALUE)&&(t.value=e.value.toString(),i.push(t)))}),i},getBaseURLsFromElement:A,getRepresentationSortFunction:n,getLocation:function(e){if(e&&e.hasOwnProperty(T.default.LOCATION))return e.Location=e.Location_asArray[0],e.Location},getUseCalculatedLiveEdgeTimeForAdaptation:function(e){var t=_(e).Representation_asArray[0],r=void 0;return t.hasOwnProperty(S.default.SEGMENT_LIST)?!(r=t.SegmentList).hasOwnProperty(S.default.SEGMENT_TIMELINE)||b(r.SegmentTimeline):!(!t.hasOwnProperty(S.default.SEGMENT_TEMPLATE)||!(r=t.SegmentTemplate).hasOwnProperty(S.default.SEGMENT_TIMELINE))&&b(r.SegmentTimeline)}},l=(0,L.default)(a).getInstance().getLogger(t),t}s.__dashjs_factory_name="DashManifestModel",r.default=a.default.getSingletonFactory(s),t.exports=r.default},{"../../core/Debug":345,"../../core/FactoryMaker":347,"../../core/errors/Errors":349,"../../streaming/constants/Constants":400,"../../streaming/thumbnail/ThumbnailTracks":494,"../../streaming/utils/ObjectUtils":505,"../../streaming/utils/URLUtils":509,"../../streaming/vo/DashJSError":514,"../constants/DashConstants":359,"../vo/AdaptationSet":380,"../vo/BaseURL":381,"../vo/Event":382,"../vo/EventStream":383,"../vo/Mpd":384,"../vo/Period":385,"../vo/Representation":386,"../vo/UTCTiming":388}],362:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),u=n(e("../../core/Debug")),l=n(e("./objectiron")),c=n(e("../../../externals/xml2json")),d=n(e("./matchers/StringMatcher")),f=n(e("./matchers/DurationMatcher")),h=n(e("./matchers/DateTimeMatcher")),p=n(e("./matchers/NumericMatcher")),m=n(e("./maps/RepresentationBaseValuesMap")),g=n(e("./maps/SegmentValuesMap"));function o(){var e=this.context,t=void 0,o=void 0,r=void 0,a=void 0,s=void 0;return t={parse:function(e){var t,r=window.performance.now();if(!(t=a.xml_str2json(e)))throw new Error("parsing the manifest failed");var n=window.performance.now();s.run(t);var i=window.performance.now();return o.info("Parsing complete: ( xml2json: "+(n-r).toPrecision(3)+"ms, objectiron: "+(i-n).toPrecision(3)+"ms, total: "+((i-r)/1e3).toPrecision(3)+"s)"),t},getMatchers:function(){return r},getIron:function(){return s}},o=(0,u.default)(e).getInstance().getLogger(t),r=[new f.default,new h.default,new p.default,new d.default],a=new c.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:r}),s=(0,l.default)(e).create({adaptationset:new m.default,period:new g.default}),t}o.__dashjs_factory_name="DashParser",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../../externals/xml2json":342,"../../core/Debug":345,"../../core/FactoryMaker":347,"./maps/RepresentationBaseValuesMap":365,"./maps/SegmentValuesMap":366,"./matchers/DateTimeMatcher":368,"./matchers/DurationMatcher":369,"./matchers/NumericMatcher":370,"./matchers/StringMatcher":371,"./objectiron":372}],363:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}]),o);function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var t;this._name=e,this._merge=(t=e)&&t.length&&t.charAt(0)===t.charAt(0).toUpperCase()}r.default=i,t.exports=r.default},{}],364:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e};function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=e("./CommonProperty"),s=(o=a)&&o.__esModule?o:{default:o},u=(n(l,[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),l);function l(e,t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this._name=e||"",this._properties=[],this._children=r||[],Array.isArray(t)&&t.forEach(function(e){n._properties.push(new s.default(e))})}r.default=u,t.exports=r.default},{"./CommonProperty":363}],365:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(e){return e&&e.__esModule?e:{default:e}}var i=n(e("./MapNode")),o=n(e("../../constants/DashConstants")),a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,i.default),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var e=[o.default.PROFILES,o.default.WIDTH,o.default.HEIGHT,o.default.SAR,o.default.FRAMERATE,o.default.AUDIO_SAMPLING_RATE,o.default.MIME_TYPE,o.default.SEGMENT_PROFILES,o.default.CODECS,o.default.MAXIMUM_SAP_PERIOD,o.default.START_WITH_SAP,o.default.MAX_PLAYOUT_RATE,o.default.CODING_DEPENDENCY,o.default.SCAN_TYPE,o.default.FRAME_PACKING,o.default.AUDIO_CHANNEL_CONFIGURATION,o.default.CONTENT_PROTECTION,o.default.ESSENTIAL_PROPERTY,o.default.SUPPLEMENTAL_PROPERTY,o.default.INBAND_EVENT_STREAM];(function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}})(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,o.default.ADAPTATION_SET,e,[new i.default(o.default.REPRESENTATION,e,[new i.default(o.default.SUB_REPRESENTATION,e)])])}r.default=a,t.exports=r.default},{"../../constants/DashConstants":359,"./MapNode":364}],366:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(e){return e&&e.__esModule?e:{default:e}}var i=n(e("./MapNode")),o=n(e("../../constants/DashConstants")),a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,i.default),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var e=[o.default.SEGMENT_BASE,o.default.SEGMENT_TEMPLATE,o.default.SEGMENT_LIST];(function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}})(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,o.default.PERIOD,e,[new i.default(o.default.ADAPTATION_SET,e,[new i.default(o.default.REPRESENTATION,e)])])}r.default=a,t.exports=r.default},{"../../constants/DashConstants":359,"./MapNode":364}],367:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}]),o);function o(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this._test=e,this._converter=t}r.default=i,t.exports=r.default},{}],368:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./BaseMatcher"),o=(n=i)&&n.__esModule?n:{default:n},a=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,s=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,o.default),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(u.prototype),"constructor",this).call(this,function(e){return a.test(e.value)},function(e){var t=a.exec(e),r=void 0;if(r=Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[4],10),parseInt(t[5],10),t[6]&&parseInt(t[6],10)||0,t[7]&&1e3*parseFloat(t[7])||0),t[9]&&t[10]){var n=60*parseInt(t[9],10)+parseInt(t[10],10);r+=("+"===t[8]?-1:1)*n*60*1e3}return new Date(r)})}r.default=s,t.exports=r.default},{"./BaseMatcher":367}],369:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(e){return e&&e.__esModule?e:{default:e}}var i=n(e("./BaseMatcher")),o=n(e("../../../streaming/constants/Constants")),a=n(e("../../constants/DashConstants")),s=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,i.default),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,function(e){for(var t=[a.default.MIN_BUFFER_TIME,a.default.MEDIA_PRESENTATION_DURATION,a.default.MINIMUM_UPDATE_PERIOD,a.default.TIMESHIFT_BUFFER_DEPTH,a.default.MAX_SEGMENT_DURATION,a.default.MAX_SUBSEGMENT_DURATION,o.default.SUGGESTED_PRESENTATION_DELAY,a.default.START,o.default.START_TIME,a.default.DURATION],r=t.length,n=0;n<r;n++)if(e.nodeName===t[n])return s.test(e.value);return!1},function(e){var t=s.exec(e),r=31536e3*parseFloat(t[2]||0)+2592e3*parseFloat(t[4]||0)+86400*parseFloat(t[6]||0)+3600*parseFloat(t[8]||0)+60*parseFloat(t[10]||0)+parseFloat(t[12]||0);return void 0!==t[1]&&(r=-r),r})}r.default=u,t.exports=r.default},{"../../../streaming/constants/Constants":400,"../../constants/DashConstants":359,"./BaseMatcher":367}],370:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./BaseMatcher"),o=(n=i)&&n.__esModule?n:{default:n},a=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,s=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,o.default),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(u.prototype),"constructor",this).call(this,function(e){return a.test(e.value)},function(e){return parseFloat(e)})}r.default=s,t.exports=r.default},{"./BaseMatcher":367}],371:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=n(e("./BaseMatcher")),a=n(e("../../constants/DashConstants")),s=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,i.default),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(u.prototype),"constructor",this).call(this,function(e,t){var r,n=(o(r={},a.default.MPD,[a.default.ID,a.default.PROFILES]),o(r,a.default.PERIOD,[a.default.ID]),o(r,a.default.BASE_URL,[a.default.SERVICE_LOCATION,a.default.BYTE_RANGE]),o(r,a.default.SEGMENT_BASE,[a.default.INDEX_RANGE]),o(r,a.default.INITIALIZATION,[a.default.RANGE]),o(r,a.default.REPRESENTATION_INDEX,[a.default.RANGE]),o(r,a.default.SEGMENT_LIST,[a.default.INDEX_RANGE]),o(r,a.default.BITSTREAM_SWITCHING,[a.default.RANGE]),o(r,a.default.SEGMENT_URL,[a.default.MEDIA_RANGE,a.default.INDEX_RANGE]),o(r,a.default.SEGMENT_TEMPLATE,[a.default.INDEX_RANGE,a.default.MEDIA,a.default.INDEX,a.default.INITIALIZATION_MINUS,a.default.BITSTREAM_SWITCHING_MINUS]),o(r,a.default.ASSET_IDENTIFIER,[a.default.VALUE,a.default.ID]),o(r,a.default.EVENT_STREAM,[a.default.VALUE]),o(r,a.default.ADAPTATION_SET,[a.default.PROFILES,a.default.MIME_TYPE,a.default.SEGMENT_PROFILES,a.default.CODECS,a.default.CONTENT_TYPE]),o(r,a.default.FRAME_PACKING,[a.default.VALUE,a.default.ID]),o(r,a.default.AUDIO_CHANNEL_CONFIGURATION,[a.default.VALUE,a.default.ID]),o(r,a.default.CONTENT_PROTECTION,[a.default.VALUE,a.default.ID]),o(r,a.default.ESSENTIAL_PROPERTY,[a.default.VALUE,a.default.ID]),o(r,a.default.SUPPLEMENTAL_PROPERTY,[a.default.VALUE,a.default.ID]),o(r,a.default.INBAND_EVENT_STREAM,[a.default.VALUE,a.default.ID]),o(r,a.default.ACCESSIBILITY,[a.default.VALUE,a.default.ID]),o(r,a.default.ROLE,[a.default.VALUE,a.default.ID]),o(r,a.default.RATING,[a.default.VALUE,a.default.ID]),o(r,a.default.VIEWPOINT,[a.default.VALUE,a.default.ID]),o(r,a.default.CONTENT_COMPONENT,[a.default.CONTENT_TYPE]),o(r,a.default.REPRESENTATION,[a.default.ID,a.default.DEPENDENCY_ID,a.default.MEDIA_STREAM_STRUCTURE_ID]),o(r,a.default.SUBSET,[a.default.ID]),o(r,a.default.METRICS,[a.default.METRICS_MINUS]),o(r,a.default.REPORTING,[a.default.VALUE,a.default.ID]),r);if(n.hasOwnProperty(t)){var i=n[t];return void 0!==i&&0<=i.indexOf(e.name)}return!1},function(e){return String(e)})}r.default=s,t.exports=r.default},{"../../constants/DashConstants":359,"./BaseMatcher":367}],372:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(c){function u(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function l(e,t,r){for(var n=0,i=e.length;n<i;++n){var o=e[n];if(t[o.name])if(r[o.name]){if(o.merge){var a=t[o.name],s=r[o.name];"object"==typeof a&&"object"==typeof s?u(a,s):r[o.name]=a+s}}else r[o.name]=t[o.name]}}function d(e,t){for(var r=0,n=e.children.length;r<n;++r){var i=e.children[r],o=t[i.name+"_asArray"];if(o)for(var a=0,s=o.length;a<s;++a){var u=o[a];l(e.properties,t,u),d(i,u)}}}return{run:function(e){if(null===e||"object"!=typeof e)return e;if("period"in c)for(var t=c.period,r=e.Period_asArray,n=0,i=r.length;n<i;++n){var o=r[n];if(d(t,o),"adaptationset"in c){var a=o.AdaptationSet_asArray;if(a)for(var s=c.adaptationset,u=0,l=a.length;u<l;++u)d(s,a[u])}}return e}}}a.__dashjs_factory_name="ObjectIron";var s=o.default.getClassFactory(a);r.default=s,t.exports=r.default},{"../../core/FactoryMaker":347}],373:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n},g=e("./SegmentsUtils");function a(e,p){var m=(e=e||{}).timelineConverter;return{getSegments:function(e,t,r,n){var i,o,a,s,u=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,l=u.SegmentURL_asArray.length,c=[],d=void 0,f=void 0,h=void 0;for(s=e.startNumber,i=(0,g.decideSegmentListRangeForTemplate)(m,p,e,t,r,n),o=Math.max(i.start,0),a=Math.min(i.end,u.SegmentURL_asArray.length-1),d=o;d<=a;d++)h=u.SegmentURL_asArray[d],(f=(0,g.getIndexBasedSegment)(m,p,e,d)).replacementTime=(s+d-1)*e.segmentDuration,f.media=h.media?h.media:"",f.mediaRange=h.mediaRange,f.index=h.index,f.indexRange=h.indexRange,c.push(f),f=null;return e.availableSegmentsNumber=l,c}}}a.__dashjs_factory_name="ListSegmentsGetter";var s=o.default.getClassFactory(a);r.default=s,t.exports=r.default},{"../../core/FactoryMaker":347,"./SegmentsUtils":376}],374:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,null,[{key:"round10",value:function(e,t){return function(e,t,r){return void 0!==r&&0!=+r?(r=+r,null===(t=+t)||isNaN(t)||"number"!=typeof r||r%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-r:-r)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+r:r)))):Math[e](t)}("round",e,t)}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}r.default=i,t.exports=r.default},{}],375:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=n(e("../constants/DashConstants")),i=n(e("../../core/FactoryMaker")),o=n(e("./TimelineSegmentsGetter")),a=n(e("./TemplateSegmentsGetter")),d=n(e("./ListSegmentsGetter"));function s(e,t){var r,n=this.context,s=void 0,u=void 0,l=void 0;return r={getSegments:function(e,t,r,n,i){var o=void 0,a=e.segmentInfoType;a!==c.default.SEGMENT_BASE&&a!==c.default.BASE_URL&&function(e,t){var r=e.segments,n=!1,i=void 0,o=void 0;n=!r||0===r.length||(o=r[0].availabilityIdx,i=r[r.length-1].availabilityIdx,t<o||i<t);return n}(e,r)?(a===c.default.SEGMENT_TIMELINE?o=s.getSegments(e,t,r,i):a===c.default.SEGMENT_TEMPLATE?o=u.getSegments(e,t,r,i):a===c.default.SEGMENT_LIST&&(o=l.getSegments(e,t,r,i)),n&&n(e,o)):o=e.segments}},s=(0,o.default)(n).create(e,t),u=(0,a.default)(n).create(e,t),l=(0,d.default)(n).create(e,t),r}s.__dashjs_factory_name="SegmentsGetter";var u=i.default.getClassFactory(s);r.default=u,t.exports=r.default},{"../../core/FactoryMaker":347,"../constants/DashConstants":359,"./ListSegmentsGetter":373,"./TemplateSegmentsGetter":377,"./TimelineSegmentsGetter":379}],376:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.unescapeDollarsInTemplate=function(e){return e?e.split("$$").join("$"):e},r.replaceIDForTemplate=function(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var r=t.toString();return e.split("$RepresentationID$").join(r)},r.replaceTokenForTemplate=v,r.getIndexBasedSegment=function(e,t,r,n){var i,o,a=void 0,s=void 0;s=r.segmentDuration,isNaN(s)&&(s=r.adaptation.period.duration);return i=parseFloat((r.adaptation.period.start+n*s).toFixed(5)),o=parseFloat((i+s).toFixed(5)),(a=new m.default).representation=r,a.duration=s,a.presentationStartTime=i,a.mediaStartTime=e.calcMediaTimeFromPresentationTime(a.presentationStartTime,r),a.availabilityStartTime=e.calcAvailabilityStartTimeFromPresentationTime(a.presentationStartTime,r.adaptation.period.mpd,t),a.availabilityEndTime=e.calcAvailabilityEndTimeFromPresentationTime(o,r.adaptation.period.mpd,t),a.wallStartTime=e.calcWallTimeForSegment(a,t),a.replacementNumber=g(a,n),a.availabilityIdx=n,a},r.getTimeBasedSegment=function(e,t,r,n,i,o,a,s,u,l){var c,d,f=n/o,h=Math.min(i/o,r.adaptation.period.mpd.maxSegmentDuration),p=void 0;return c=e.calcPresentationTimeFromMediaTime(f,r),d=c+h,(p=new m.default).representation=r,p.duration=h,p.mediaStartTime=f,p.presentationStartTime=c,p.availabilityStartTime=r.adaptation.period.mpd.manifest.loadedTime,p.availabilityEndTime=e.calcAvailabilityEndTimeFromPresentationTime(d,r.adaptation.period.mpd,t),p.wallStartTime=e.calcWallTimeForSegment(p,t),p.replacementTime=l||n,p.replacementNumber=g(p,u),a=v(a=v(a,"Number",p.replacementNumber),"Time",p.replacementTime),p.media=a,p.mediaRange=s,p.availabilityIdx=u,p},r.getSegmentByIndex=y,r.decideSegmentListRangeForTemplate=function(e,t,r,n,i,o){var a=r.segmentDuration,s=r.adaptation.period.mpd.manifest.minBufferTime,u=r.segmentAvailabilityRange,l={start:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,u?u.start:NaN),end:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,u?u.end:NaN)},c=r.segments,d=2*a,f=o||Math.max(2*s,10*a),h=NaN,p=null,m=void 0,g=void 0;if(l.start=Math.max(l.start,0),t&&!e.isTimeSyncCompleted())return m=Math.floor(l.start/a),g=Math.floor(l.end/a),{start:m,end:g};h=c&&0<c.length?(p=y(i,r),p?e.calcPeriodRelativeTimeFromMpdRelativeTime(r,p.presentationStartTime):0<i?i*a:e.calcPeriodRelativeTimeFromMpdRelativeTime(r,n)):0<i?i*a:t?l.end:l.start;return m=Math.floor(Math.max(h-d,l.start)/a),g=Math.floor(Math.min(m+f/a,l.end/a)),{start:m,end:g}};var n,i=e("./../vo/Segment"),m=(n=i)&&n.__esModule?n:{default:n};function d(e,t){for(;e.length<t;)e="0"+e;return e}function g(e,t){return e.representation.startNumber+t}function v(e,t,r){var n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=t.length,c="%0".length;if(!e)return e;for(;;){if((n=e.indexOf("$"+t))<0)return e;if((i=e.indexOf("$",n+l))<0)return e;if(n<(o=e.indexOf("%0",n+l))&&o<i)switch(a=e.charAt(i-1),s=parseInt(e.substring(o+c,i-1),10),a){case"d":case"i":case"u":u=d(r.toString(),s);break;case"x":u=d(r.toString(16),s);break;case"X":u=d(r.toString(16),s).toUpperCase();break;case"o":u=d(r.toString(8),s);break;default:return e}else u=r;e=e.substring(0,n)+u+e.substring(i+1)}}function y(e,t){if(!t||!t.segments)return null;var r=t.segments.length,n=void 0,i=void 0;if(e<r&&(n=t.segments[e])&&n.availabilityIdx===e)return n;for(i=0;i<r;i++)if((n=t.segments[i])&&n.availabilityIdx===e)return n;return null}},{"./../vo/Segment":387}],377:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n},v=e("./SegmentsUtils");function a(e,m){var g=e.timelineConverter;return{getSegments:function(e,t,r,n){var i,o,a,s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate,u=e.segmentDuration,l=e.segmentAvailabilityRange,c=[],d=null,f=null,h=void 0,p=void 0;for(a=e.startNumber,i=(h=isNaN(u)&&!m?{start:a,end:a}:(0,v.decideSegmentListRangeForTemplate)(g,m,e,t,r,n)).start,o=h.end,p=i;p<=o;p++)(f=(0,v.getIndexBasedSegment)(g,m,e,p)).replacementTime=(a+p-1)*e.segmentDuration,d=s.media,d=(0,v.replaceTokenForTemplate)(d,"Number",f.replacementNumber),d=(0,v.replaceTokenForTemplate)(d,"Time",f.replacementTime),f.media=d,c.push(f),f=null;return isNaN(u)?e.availableSegmentsNumber=1:e.availableSegmentsNumber=Math.ceil((l.end-l.start)/u),c}}}a.__dashjs_factory_name="TemplateSegmentsGetter";var s=o.default.getClassFactory(a);r.default=s,t.exports=r.default},{"../../core/FactoryMaker":347,"./SegmentsUtils":376}],378:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=n(e("../../core/EventBus")),d=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker"));function o(){var e=this.context,t=(0,c.default)(e).getInstance(),i=void 0,u=void 0,r=void 0;function n(e){i=e}function o(e,t,r,n){return n?r&&t.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(t.availabilityStartTime.getTime()+1e3*(e+t.timeShiftBufferDepth)):t.availabilityEndTime:r?new Date(t.availabilityStartTime.getTime()+1e3*(e-i)):t.availabilityStartTime}function l(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*i)/1e3}function a(e){u||void 0!==e.offset&&(n(e.offset/1e3),u=!0)}function s(){i=0,u=!1,r=NaN}return{initialize:function(){s(),t.on(d.default.TIME_SYNCHRONIZATION_COMPLETED,a,this)},isTimeSyncCompleted:function(){return u},setTimeSyncCompleted:function(e){u=e},getClientTimeOffset:function(){return i},setClientTimeOffset:n,getExpectedLiveEdge:function(){return r},setExpectedLiveEdge:function(e){r=e},calcAvailabilityStartTimeFromPresentationTime:function(e,t,r){return o.call(this,e,t,r)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,r){return o.call(this,e,t,r,!0)},calcPresentationTimeFromWallTime:l,calcPresentationTimeFromMediaTime:function(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)},calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcSegmentAvailabilityRange:function(e,t){var r=e.adaptation.period,n={start:r.start,end:r.start+r.duration};if(!t)return n;if(!u&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;var i=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0),o=l(new Date,r),a=r.start+r.duration;n.start=Math.max(o-r.mpd.timeShiftBufferDepth,r.start);var s=void 0!==e.availabilityTimeOffset&&e.availabilityTimeOffset<i?i-e.availabilityTimeOffset:i;return n.end=a<=o&&o-s<a?a:o-s,n},calcWallTimeForSegment:function(e,t){var r=void 0,n=void 0,i=void 0;return t&&(r=e.representation.adaptation.period.mpd.suggestedPresentationDelay,n=e.presentationStartTime+r,i=new Date(e.availabilityStartTime.getTime()+1e3*n)),i},calcMSETimeOffset:function(e){var t=e.presentationTimeOffset;return e.adaptation.period.start-t},reset:function(){t.off(d.default.TIME_SYNCHRONIZATION_COMPLETED,a,this),s()}}}o.__dashjs_factory_name="TimelineConverter",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352}],379:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),O=n(e("../../streaming/constants/Constants")),P=e("./SegmentsUtils");function o(e,M){var R=(e=e||{}).timelineConverter;return{getSegments:function(i,e,t,r){if(function(){if(!R||!R.hasOwnProperty("calcMediaTimeFromPresentationTime")||!R.hasOwnProperty("calcSegmentAvailabilityRange"))throw new Error(O.default.MISSING_CONFIG_ERROR)}(),!i)throw new Error("no representation");void 0===e&&(e=null);var o=i.adaptation.period.mpd.manifest.Period_asArray[i.adaptation.period.index].AdaptationSet_asArray[i.adaptation.index].Representation_asArray[i.index].SegmentTemplate||i.adaptation.period.mpd.manifest.Period_asArray[i.adaptation.period.index].AdaptationSet_asArray[i.adaptation.index].Representation_asArray[i.index].SegmentList,n=o.SegmentTimeline,a=o.SegmentURL_asArray,s=0<i.availableSegmentsNumber,u=void 0;function l(e,t){var r=o.media,n=e.mediaRange;return a&&(r=a[t].media||"",n=a[t].mediaRange),(0,P.getTimeBasedSegment)(R,M,i,h,e.d,S,r,n,m,e.tManifest)}u=r||(-1<t||null!==e?10:1/0);var c,d,f,h=0,p=0,m=-1,g=[],v=null,y=void 0,_=void 0,b=void 0,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0;for(S=i.timescale,c=n.S_asArray,f=t,null!==e&&(v=R.calcMediaTimeFromPresentationTime(e,i)),_=0,d=c.length;_<d;_++){if(E=0,(y=c[_]).hasOwnProperty("r")&&(E=y.r),y.hasOwnProperty("t")&&(p=(h=y.t)/S),E<0){if((A=c[_+1])&&A.hasOwnProperty("t"))w=A.t/S;else{var x=i.segmentAvailabilityRange?i.segmentAvailabilityRange.end:R.calcSegmentAvailabilityRange(i,M).end;w=R.calcMediaTimeFromPresentationTime(x,i),i.segmentDuration=y.d/S}E=Math.ceil((w-p)/(y.d/S))-1}if(T){if(s)break;m+=E+1}else for(b=0;b<=E;b++)if(m++,g.length>u){if(T=!0,s)break}else null!==v?p>=v-y.d/S*1.5&&g.push(l(y,m)):f<=m&&g.push(l(y,m)),p=(h+=y.d)/S}return s||(i.availableSegmentsNumber=m+1),g}}}o.__dashjs_factory_name="TimelineSegmentsGetter";var a=i.default.getClassFactory(o);r.default=a,t.exports=r.default},{"../../core/FactoryMaker":347,"../../streaming/constants/Constants":400,"./SegmentsUtils":376}],380:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null},t.exports=r.default},{}],381:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function i(e,t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.url=e||"",this.serviceLocation=t||e||"",this.dvb_priority=r||1,this.dvb_weight=n||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}i.DEFAULT_DVB_PRIORITY=1,i.DEFAULT_DVB_WEIGHT=1,r.default=i,t.exports=r.default},{}],382:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},t.exports=r.default},{}],383:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},t.exports=r.default},{}],384:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN},t.exports=r.default},{}],385:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null}n.DEFAULT_ID="defaultId",r.default=n,t.exports=r.default},{}],386:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e};function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o,a=e("../constants/DashConstants"),s=(o=a)&&o.__esModule?o:{default:o},u=(n(l,null,[{key:"hasInitialization",value:function(e){return null!==e.initialization||null!==e.range}},{key:"hasSegments",value:function(e){return e.segmentInfoType!==s.default.BASE_URL&&e.segmentInfoType!==s.default.SEGMENT_BASE&&!e.indexRange}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}r.default=u,t.exports=r.default},{"../constants/DashConstants":359}],387:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null},t.exports=r.default},{}],388:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""},t.exports=r.default},{}],389:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=n(e("./net/HTTPLoader")),u=n(e("./vo/HeadRequest")),l=n(e("./vo/DashJSError")),c=n(e("./../core/EventBus")),d=n(e("../streaming/utils/BoxParser")),f=n(e("./../core/events/Events")),h=n(e("./../core/errors/Errors")),i=n(e("../core/FactoryMaker"));function o(e){e=e||{};var t,r=this.context,i=(0,c.default)(r).getInstance(),o=void 0,a=void 0;return o={checkForExistence:function(t){function e(e){i.trigger(f.default.CHECK_FOR_EXISTENCE_COMPLETED,{request:t,exists:e})}if(t){var r=new u.default(t.url);a.load({request:r,success:function(){e(!0)},error:function(){e(!1)}})}else e(!1)},load:function(r){function n(e,t){i.trigger(f.default.LOADING_COMPLETED,{request:r,response:e||null,error:t||null,sender:o})}r?a.load({request:r,progress:function(e){i.trigger(f.default.LOADING_PROGRESS,{request:r,stream:e.stream}),e.data&&i.trigger(f.default.LOADING_DATA_PROGRESS,{request:r,response:e.data||null,error:null,sender:o})},success:function(e){n(e)},error:function(e,t,r){n(void 0,new l.default(h.default.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,r,t))},abort:function(e){e&&i.trigger(f.default.LOADING_ABANDONED,{request:e,mediaType:e.mediaType,sender:o})}}):n(void 0,new l.default(h.default.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,h.default.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){a&&a.abort()},reset:function(){a&&(a.abort(),a=null)}},t=(0,d.default)(r).getInstance(),a=(0,s.default)(r).create({errHandler:e.errHandler,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,boxParser:t,useFetch:e.mediaPlayerModel.getLowLatencyEnabled()}),o}o.__dashjs_factory_name="FragmentLoader",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../core/FactoryMaker":347,"../streaming/utils/BoxParser":496,"./../core/EventBus":346,"./../core/errors/Errors":349,"./../core/events/Events":352,"./net/HTTPLoader":447,"./vo/DashJSError":514,"./vo/HeadRequest":517}],390:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=n(e("./constants/Constants")),o=n(e("./controllers/XlinkController")),a=n(e("./net/HTTPLoader")),m=n(e("./utils/URLUtils")),g=n(e("./vo/TextRequest")),v=n(e("./vo/DashJSError")),y=e("./vo/metrics/HTTPRequest"),_=n(e("../core/EventBus")),b=n(e("../core/events/Events")),E=n(e("../core/errors/Errors")),i=n(e("../core/FactoryMaker")),w=n(e("../dash/parser/DashParser")),A=n(e("../core/Debug"));function s(e){e=e||{};var s=this.context,u=(0,_.default)(s).getInstance(),l=(0,m.default)(s).getInstance(),t=void 0,c=void 0,r=void 0,d=void 0,f=void 0,h=e.mssHandler,n=e.errHandler;function i(e){u.trigger(b.default.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}return t={load:function(a){var e=new g.default(a,y.HTTPRequest.MPD_TYPE);r.load({request:e,success:function(e,t,r){if(d){var n=void 0,i=void 0,o=void 0;if(r&&r!==a?(i=l.parseBaseUrl(r),n=r):(l.isRelative(a)&&(a=l.resolve(a,window.location.href)),i=l.parseBaseUrl(a)),null===f&&(f=function(e){var t=null;return-1<e.indexOf("SmoothStreamingMedia")?(h&&(t=h.createMssParser(),h.registerEvents()),t):-1<e.indexOf("MPD")?(0,w.default)(s).create():t}(e)),null!==f){d.setMatchers(f.getMatchers()),d.setIron(f.getIron());try{o=f.parse(e)}catch(e){return void u.trigger(b.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new v.default(E.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,E.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+a)})}o?(o.url=n||a,o.originalUrl||(o.originalUrl=o.url),o.hasOwnProperty(p.default.LOCATION)&&(i=l.parseBaseUrl(o.Location_asArray[0]),c.debug("BaseURI set by Location to: "+i)),o.baseUri=i,o.loadedTime=new Date,d.resolveManifestOnLoad(o)):u.trigger(b.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new v.default(E.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,E.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+a)})}else u.trigger(b.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new v.default(E.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,E.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+""+a)})}},error:function(e,t,r){u.trigger(b.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new v.default(E.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,E.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+(a+", ")+r)})}})},reset:function(){u.off(b.default.XLINK_READY,i,t),d&&(d.reset(),d=null),r&&(r.abort(),r=null),h&&h.reset()}},c=(0,A.default)(s).getInstance().getLogger(t),u.on(b.default.XLINK_READY,i,t),r=(0,a.default)(s).create({errHandler:n,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),d=(0,o.default)(s).create({errHandler:n,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),f=null,t}s.__dashjs_factory_name="ManifestLoader";var u=i.default.getClassFactory(s);r.default=u,t.exports=r.default},{"../core/Debug":345,"../core/EventBus":346,"../core/FactoryMaker":347,"../core/errors/Errors":349,"../core/events/Events":352,"../dash/parser/DashParser":362,"./constants/Constants":400,"./controllers/XlinkController":415,"./net/HTTPLoader":447,"./utils/URLUtils":509,"./vo/DashJSError":514,"./vo/TextRequest":525,"./vo/metrics/HTTPRequest":534}],391:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var A=n(e("../core/EventBus")),T=n(e("../core/events/Events")),i=n(e("../core/FactoryMaker")),S=n(e("../core/Debug")),x=n(e("../core/errors/Errors"));function o(){var e=this.context,n=(0,A.default)(e).getInstance(),t=void 0,i=void 0,o=void 0,r=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,f=void 0;function h(){o=NaN,a=!(s=!1),p()}function p(){null!==r&&(clearInterval(r),r=null)}function m(e){p(),isNaN(e)&&!isNaN(o)&&(e=1e3*o),isNaN(e)||(i.debug("Refresh manifest in "+e+" milliseconds."),r=setTimeout(y,e))}function g(){s=!0;var e=l.getValue(),t=e.url,r=c.getLocation(e);r&&(t=r),u.load(t)}function v(e){l.setValue(e);var t=new Date,r=(t.getTime()-e.loadedTime.getTime())/1e3;2147483647<1e3*(o=c.getManifestUpdatePeriod(e,r))&&(o=2147483.647),n.trigger(T.default.MANIFEST_UPDATED,{manifest:e}),i.info("Manifest has been refreshed at "+t+"["+t.getTime()/1e3+"] "),a||m()}function y(){a&&!f.getScheduleWhilePaused()||(s?m(f.getManifestUpdateRetryInterval()):g())}function _(e){e.error?e.error.code===x.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&d.error(e.error):v(e.manifest)}function b(){a=!1,m()}function E(){a=!0,p()}function w(){s=!1}return t={initialize:function(){h(),n.on(T.default.STREAMS_COMPOSED,w,this),n.on(T.default.PLAYBACK_STARTED,b,this),n.on(T.default.PLAYBACK_PAUSED,E,this),n.on(T.default.INTERNAL_MANIFEST_LOADED,_,this)},setManifest:function(e){v(e)},refreshManifest:g,setConfig:function(e){e&&(e.manifestModel&&(l=e.manifestModel),e.dashManifestModel&&(c=e.dashManifestModel),e.mediaPlayerModel&&(f=e.mediaPlayerModel),e.manifestLoader&&(u=e.manifestLoader),e.errHandler&&(d=e.errHandler))},reset:function(){n.off(T.default.PLAYBACK_STARTED,b,this),n.off(T.default.PLAYBACK_PAUSED,E,this),n.off(T.default.STREAMS_COMPOSED,w,this),n.off(T.default.INTERNAL_MANIFEST_LOADED,_,this),h()}},i=(0,S.default)(e).getInstance().getLogger(t),t}o.__dashjs_factory_name="ManifestUpdater",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../core/Debug":345,"../core/EventBus":346,"../core/FactoryMaker":347,"../core/errors/Errors":349,"../core/events/Events":352}],392:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var oe=n(e("./constants/Constants")),ae=n(e("./constants/MetricsConstants")),se=n(e("./controllers/PlaybackController")),ue=n(e("./controllers/StreamController")),le=n(e("./controllers/MediaController")),ce=n(e("./controllers/BaseURLController")),de=n(e("./ManifestLoader")),fe=n(e("./utils/ErrorHandler")),he=n(e("./utils/Capabilities")),pe=n(e("./text/TextTracks")),me=n(e("./utils/RequestModifier")),ge=n(e("./text/TextController")),ve=n(e("./models/URIFragmentModel")),ye=n(e("./models/ManifestModel")),_e=n(e("./models/MediaPlayerModel")),be=n(e("./models/MetricsModel")),Ee=n(e("./controllers/AbrController")),we=n(e("./models/VideoModel")),Ae=n(e("./utils/DOMStorage")),Te=n(e("./../core/Debug")),Se=n(e("./../core/errors/Errors")),xe=n(e("./../core/EventBus")),Me=n(e("./../core/events/Events")),Re=n(e("./MediaPlayerEvents")),Oe=n(e("../core/FactoryMaker")),Pe=e("./../core/Version"),Ce=n(e("../dash/DashAdapter")),De=n(e("../dash/models/DashManifestModel")),Ie=n(e("../dash/DashMetrics")),Le=n(e("../dash/utils/TimelineConverter")),Ne=e("./vo/metrics/HTTPRequest"),ke=n(e("../../externals/base64")),Fe=n(e("codem-isoboxer")),je=n(e("./vo/DashJSError")),Be=e("./utils/SupervisorTools");function i(){var i="You must first call initialize() and set a source before calling this method",n="You must first call initialize() and set a valid source and view before calling this method",t="You must first call attachView() to set the video element before calling this method",e="You must first call attachSource() with a valid source before calling this method",r="MediaPlayer not initialized!",o="Playback minimum drift has an invalid value! Use a number from 0 to 0.5",a="Playback maximum drift has an invalid value! Use a number greater or equal to 0",s=this.context,u=(0,xe.default)(s).getInstance(),l=(0,Te.default)(s).getInstance(),c=void 0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,_=void 0,b=void 0,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,M=void 0,R=void 0,O=void 0,P=void 0,C=void 0,D=void 0,I=void 0,L=void 0,N=void 0,k=void 0,F=void 0;function j(){return!!f&&!!L.getElement()}function B(){return(0,Pe.getVersionString)()}function U(){if(!g)throw n;return P.isPaused()}function G(e){var t=re();if(!t)return 0;var r=P.getLiveDelay(),n=t.range.start+e;return n>t.range.end-r&&(n=t.range.end-r),n}function H(e){if(!g)throw n;var t=K().currentTime;if(void 0!==e)t=O.getTimeRelativeToStreamId(t,e);else if(P.getIsDynamic()){var r=re();t=null===r?0:V()-(r.range.end-r.time)}return t}function V(){if(!g)throw n;var e=K().duration;if(P.getIsDynamic()){var t,r=re();if(!r)return 0;e=(t=r.range.end-r.range.start)<r.manifestInfo.DVRWindowSize?t:r.manifestInfo.DVRWindowSize}return e}function z(e){(0,Be.checkParameterType)(e,"boolean"),v=e}function W(){x.restoreDefaultUTCTimingSources()}function q(){return C}function Y(e){return S.getReadOnlyMetricsFor(e)}function K(){if(!L.getElement())throw t;return L.getElement()}function X(e){if(!p)throw r;L.setElement(e),e&&(te(),function(){if(w)return;var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(s).create();w=t.createMetricsReporting({debug:l,eventBus:u,mediaElement:K(),dashManifestModel:D,metricsModel:S,events:Me.default,constants:oe.default,metricsConstants:ae.default})}}(),function(){if(A)return;var e=dashjs.MssHandler;"function"==typeof e&&(Se.default.extend(e.errors),A=e(s).create({eventBus:u,mediaPlayerModel:x,metricsModel:S,manifestModel:I,playbackController:P,protectionController:E,baseURLController:(0,ce.default)(s).getInstance(),errHandler:M,events:Me.default,constants:oe.default,debug:l,initSegmentType:Ne.HTTPRequest.INIT_SEGMENT_TYPE,BASE64:ke.default,ISOBoxer:Fe.default}))}(),O&&O.switchToVideoElement()),g&&$(),ie()}function Q(e){if(!m)throw i;var t=O.getActiveStreamInfo();return b.getTracksFor(e,t)}function J(e){if(!p)throw r;"string"==typeof e&&k.initialize(e),f=e,(m||g)&&$(),j()&&ie()}function Z(){if(!m)throw i;var e=O.getActiveStreamInfo();return e?O.getStreamById(e.id):null}function $(){m=g=!1,T.reset(),O.reset(),P.reset(),y.reset(),b.reset(),N.reset(),E&&(x.getKeepProtectionMediaKeys()?E.stop():(E.reset(),E=null,te()))}function ee(){return(0,de.default)(s).create({errHandler:M,metricsModel:S,mediaPlayerModel:x,requestModifier:(0,me.default)(s).getInstance(),mssHandler:A})}function te(){if(E)return E;var e=dashjs.Protection;if("function"!=typeof e)return null;var t=e(s).create();return Me.default.extend(e.events),Re.default.extend(e.events,{publicOnly:!0}),Se.default.extend(e.errors),R=R||(0,he.default)(s).getInstance(),E=t.createProtectionSystem({debug:l,errHandler:M,videoModel:L,capabilities:R,eventBus:u,events:Me.default,BASE64:ke.default,constants:oe.default})}function re(){var e=S.getReadOnlyMetricsFor(oe.default.VIDEO)||S.getReadOnlyMetricsFor(oe.default.AUDIO);return C.getCurrentDVRInfo(e)}function ne(e){var t=re();return t?e+(t.manifestInfo.availableFrom.getTime()/1e3+t.range.start):0}function ie(){!m&&f&&(m=!0,d.info("Streaming Initialized"),function(){var e=ee();O=O||(0,ue.default)(s).getInstance(),b.setConfig({domStorage:F}),O.setConfig({capabilities:R,manifestLoader:e,manifestModel:I,dashManifestModel:D,mediaPlayerModel:x,protectionController:E,adapter:T,metricsModel:S,dashMetrics:C,errHandler:M,timelineConverter:_,videoModel:L,playbackController:P,domStorage:F,abrController:y,mediaController:b,textController:N}),P.setConfig({streamController:O,metricsModel:S,dashMetrics:C,manifestModel:I,mediaPlayerModel:x,dashManifestModel:D,adapter:T,videoModel:L,timelineConverter:_,uriFragmentModel:k}),y.setConfig({streamController:O,domStorage:F,mediaPlayerModel:x,metricsModel:S,dashMetrics:C,manifestModel:I,videoModel:L,adapter:T}),y.createAbrRulesCollection(),N.setConfig({errHandler:M,manifestModel:I,dashManifestModel:D,mediaController:b,streamController:O,videoModel:L}),O.initialize(v,h)}(),"string"==typeof f?O.load(f):O.loadWithManifest(f)),!g&&j()&&(g=!0,d.info("Playback Initialized"))}return c={initialize:function(e,t,r){if(R=R||(0,he.default)(s).getInstance(),M=(0,fe.default)(s).getInstance(),!R.supportsMediaSource())return M.capabilityError("mediasource"),void M.error(new je.default(Se.default.CAPABILITY_MEDIASOURCE_ERROR_CODE,Se.default.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE));p||(p=!0,_=(0,Le.default)(s).getInstance(),y=y||(0,Ee.default)(s).getInstance(),P=P||(0,se.default)(s).getInstance(),b=b||(0,le.default)(s).getInstance(),T=(0,Ce.default)(s).getInstance(),D=(0,De.default)(s).getInstance({timelineConverter:_,errHandler:M,BASE64:ke.default}),I=(0,ye.default)(s).getInstance(),C=(0,Ie.default)(s).getInstance({manifestModel:I,dashManifestModel:D}),S=(0,be.default)(s).getInstance(),N=(0,ge.default)(s).getInstance(),F=(0,Ae.default)(s).getInstance({mediaPlayerModel:x}),T.setConfig({dashManifestModel:D}),W(),z(void 0===r||r),e&&X(e),t&&J(t),d.info("[dash.js "+B()+"] MediaPlayer has been initialized"))},setConfig:function(e){e&&(e.capabilities&&(R=e.capabilities),e.streamController&&(O=e.streamController),e.playbackController&&(P=e.playbackController),e.mediaPlayerModel&&(x=e.mediaPlayerModel),e.abrController&&(y=e.abrController),e.mediaController&&(b=e.mediaController))},on:function(e,t,r){u.on(e,t,r)},off:function(e,t,r){u.off(e,t,r)},extend:function(e,t,r){Oe.default.extend(e,t,r,s)},attachView:X,attachSource:J,isReady:j,preload:function(){if(L.getElement()||m)return!1;if(!f)throw e;ie()},play:function(){if(!g)throw n;(!v||U()&&g)&&P.play()},isPaused:U,pause:function(){if(!g)throw n;P.pause()},isSeeking:function(){if(!g)throw n;return P.isSeeking()},isDynamic:function(){if(!g)throw n;return P.getIsDynamic()},seek:function(e){if(!g)throw n;if((0,Be.checkParameterType)(e,"number"),isNaN(e))throw oe.default.BAD_ARGUMENT_ERROR;var t=P.getIsDynamic()?G(e):e;P.seek(t)},setPlaybackRate:function(e){K().playbackRate=e},getPlaybackRate:function(){return K().playbackRate},setMute:function(e){(0,Be.checkParameterType)(e,"boolean"),K().muted=e},isMuted:function(){return K().muted},setVolume:function(e){if("number"!=typeof e||isNaN(e)||e<0||1<e)throw oe.default.BAD_ARGUMENT_ERROR;K().volume=e},getVolume:function(){return K().volume},time:H,duration:V,timeAsUTC:function(){if(!g)throw n;return H()<0?NaN:ne(H())},durationAsUTC:function(){if(!g)throw n;return ne(V())},getActiveStream:Z,getDVRWindowSize:function(){var e=re();return e?e.manifestInfo.DVRWindowSize:0},getDVRSeekOffset:G,convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(r<10?"0"+r.toString():r.toString())+":"+(n<10?"0"+n.toString():n.toString())},formatUTC:function(e,t,r){var n=!(arguments.length<=3||void 0===arguments[3])&&arguments[3],i=new Date(1e3*e),o=i.toLocaleDateString(t),a=i.toLocaleTimeString(t,{hour12:r});return n?a+" "+o:a},getVersion:B,getDebug:function(){return l},getBufferLength:function(e){var t,r=[oe.default.VIDEO,oe.default.AUDIO,oe.default.FRAGMENTED_TEXT];return e?-1===r.indexOf(e)?(d.warn("getBufferLength requested for invalid type"),NaN):(t=q().getCurrentBufferLevel(Y(e)))||NaN:(t=r.map(function(e){return 0<Q(e).length?q().getCurrentBufferLevel(Y(e)):Number.MAX_VALUE}).reduce(function(e,t){return Math.min(e,t)}))===Number.MAX_VALUE?NaN:t},getTTMLRenderingDiv:function(){return L?L.getTTMLRenderingDiv():null},getVideoElement:K,getSource:function(){if(!f)throw e;return f},setLiveDelayFragmentCount:function(e){x.setLiveDelayFragmentCount(e)},setLiveDelay:function(e){x.setLiveDelay(e)},getLiveDelay:function(){return x.getLiveDelay()},getCurrentLiveLatency:function(){if(!p)throw r;return g?P.getCurrentLiveLatency():NaN},useSuggestedPresentationDelay:function(e){x.setUseSuggestedPresentationDelay(e)},enableLastBitrateCaching:function(e,t){x.setLastBitrateCachingInfo(e,t)},enableLastMediaSettingsCaching:function(e,t){x.setLastMediaSettingsCachingInfo(e,t)},setMaxAllowedBitrateFor:function(e,t){y.setMaxAllowedBitrateFor(e,t)},getMaxAllowedBitrateFor:function(e){return y.getMaxAllowedBitrateFor(e)},getTopBitrateInfoFor:function(e){if(!m)throw i;return y.getTopBitrateInfoFor(e)},setMinAllowedBitrateFor:function(e,t){y.setMinAllowedBitrateFor(e,t)},getMinAllowedBitrateFor:function(e){return y.getMinAllowedBitrateFor(e)},setMaxAllowedRepresentationRatioFor:function(e,t){y.setMaxAllowedRepresentationRatioFor(e,t)},getMaxAllowedRepresentationRatioFor:function(e){return y.getMaxAllowedRepresentationRatioFor(e)},setAutoPlay:z,getAutoPlay:function(){return v},setScheduleWhilePaused:function(e){x.setScheduleWhilePaused(e)},getScheduleWhilePaused:function(){return x.getScheduleWhilePaused()},getDashMetrics:q,getMetricsFor:Y,getQualityFor:function(e){if(!m)throw i;if(e!==oe.default.IMAGE)return y.getQualityFor(e,O.getActiveStreamInfo());var t=Z();if(!t)return-1;var r=t.getThumbnailController();return r?r.getCurrentTrackIndex():-1},setQualityFor:function(e,t){if(!m)throw i;if(e===oe.default.IMAGE){var r=Z();if(!r)return;var n=r.getThumbnailController();n&&n.setTrackByIndex(t)}y.setPlaybackQuality(e,O.getActiveStreamInfo(),t)},updatePortalSize:function(){y.setElementSize(),y.setWindowResizeEventCalled(!0)},getLimitBitrateByPortal:function(){return y.getLimitBitrateByPortal()},setLimitBitrateByPortal:function(e){y.setLimitBitrateByPortal(e)},getUsePixelRatioInLimitBitrateByPortal:function(){return y.getUsePixelRatioInLimitBitrateByPortal()},setUsePixelRatioInLimitBitrateByPortal:function(e){y.setUsePixelRatioInLimitBitrateByPortal(e)},setTextDefaultLanguage:function(e){void 0===N&&(N=(0,ge.default)(s).getInstance()),N.setTextDefaultLanguage(e)},getTextDefaultLanguage:function(){return void 0===N&&(N=(0,ge.default)(s).getInstance()),N.getTextDefaultLanguage()},setTextDefaultEnabled:function(e){void 0===N&&(N=(0,ge.default)(s).getInstance()),N.setTextDefaultEnabled(e)},getTextDefaultEnabled:function(){return void 0===N&&(N=(0,ge.default)(s).getInstance()),N.getTextDefaultEnabled()},enableText:function(e){void 0===N&&(N=(0,ge.default)(s).getInstance()),N.enableText(e)},enableForcedTextStreaming:function(e){void 0===N&&(N=(0,ge.default)(s).getInstance()),N.enableForcedTextStreaming(e)},isTextEnabled:function(){return void 0===N&&(N=(0,ge.default)(s).getInstance()),N.isTextEnabled()},setTextTrack:function(e){if(!g)throw n;void 0===N&&(N=(0,ge.default)(s).getInstance()),N.setTextTrack(e)},getBitrateInfoListFor:function(e){if(!m)throw i;var t=Z();return t?t.getBitrateListFor(e):[]},setInitialBitrateFor:function(e,t){y.setInitialBitrateFor(e,t)},getInitialBitrateFor:function(e){if(!m)throw i;return y.getInitialBitrateFor(e)},setInitialRepresentationRatioFor:function(e,t){y.setInitialRepresentationRatioFor(e,t)},getInitialRepresentationRatioFor:function(e){return y.getInitialRepresentationRatioFor(e)},getStreamsFromManifest:function(e){if(!m)throw i;return T.getStreamsInfo(e)},getTracksFor:Q,getTracksForTypeFromManifest:function(e,t,r){if(!m)throw i;return(r=r||T.getStreamsInfo(t,1)[0])?T.getAllMediaInfoForType(r,e,t):[]},getCurrentTrackFor:function(e){if(!m)throw i;var t=O.getActiveStreamInfo();return b.getCurrentTrackFor(e,t)},setInitialMediaSettingsFor:function(e,t){if(!p)throw r;b.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!p)throw r;return b.getInitialSettings(e)},setCurrentTrack:function(e){if(!m)throw i;b.setTrack(e)},getTrackSwitchModeFor:function(e){if(!p)throw r;return b.getSwitchMode(e)},setTrackSwitchModeFor:function(e,t){if(!p)throw r;b.setSwitchMode(e,t)},setSelectionModeForInitialTrack:function(e){if(!p)throw r;b.setSelectionModeForInitialTrack(e)},getSelectionModeForInitialTrack:function(){if(!p)throw r;return b.getSelectionModeForInitialTrack()},setFastSwitchEnabled:function(e){x.setFastSwitchEnabled(e)},getFastSwitchEnabled:function(){return x.getFastSwitchEnabled()},setMovingAverageMethod:function(e){x.setMovingAverageMethod(e)},getMovingAverageMethod:function(){return x.getMovingAverageMethod()},getAutoSwitchQualityFor:function(e){return y.getAutoSwitchBitrateFor(e)},setAutoSwitchQualityFor:function(e,t){y.setAutoSwitchBitrateFor(e,t)},setABRStrategy:function(e){x.setABRStrategy(e)},getABRStrategy:function(){return x.getABRStrategy()},useDefaultABRRules:function(e){x.setUseDefaultABRRules(e)},addABRCustomRule:function(e,t,r){x.addABRCustomRule(e,t,r)},removeABRCustomRule:function(e){x.removeABRCustomRule(e)},removeAllABRCustomRule:function(){x.removeABRCustomRule()},setBandwidthSafetyFactor:function(e){x.setBandwidthSafetyFactor(e)},getBandwidthSafetyFactor:function(){return x.getBandwidthSafetyFactor()},getAverageThroughput:function(e){var t=y.getThroughputHistory();return t?t.getAverageThroughput(e):0},setAbandonLoadTimeout:function(e){x.setAbandonLoadTimeout(e)},retrieveManifest:function(e,r){var n=ee(),i=this;u.on(Me.default.INTERNAL_MANIFEST_LOADED,function e(t){t.error?r(null,t.error):r(t.manifest),u.off(Me.default.INTERNAL_MANIFEST_LOADED,e,i),n.reset()},i),k.initialize(e),n.load(e)},addUTCTimingSource:function(e,t){x.addUTCTimingSource(e,t)},removeUTCTimingSource:function(e,t){x.removeUTCTimingSource(e,t)},clearDefaultUTCTimingSources:function(){x.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:W,setBufferToKeep:function(e){x.setBufferToKeep(e)},setBufferAheadToKeep:function(e){x.setBufferAheadToKeep(e)},setBufferPruningInterval:function(e){x.setBufferPruningInterval(e)},setStableBufferTime:function(e){x.setStableBufferTime(e)},getStableBufferTime:function(){return x.getStableBufferTime()},setBufferTimeAtTopQuality:function(e){x.setBufferTimeAtTopQuality(e)},getBufferTimeAtTopQuality:function(){return x.getBufferTimeAtTopQuality()},setBufferTimeAtTopQualityLongForm:function(e){x.setBufferTimeAtTopQualityLongForm(e)},getBufferTimeAtTopQualityLongForm:function(){return x.getBufferTimeAtTopQualityLongForm()},setFragmentLoaderRetryAttempts:function(e){x.setRetryAttemptsForType(Ne.HTTPRequest.MEDIA_SEGMENT_TYPE,e)},setFragmentLoaderRetryInterval:function(e){x.setRetryIntervalForType(Ne.HTTPRequest.MEDIA_SEGMENT_TYPE,e)},setManifestLoaderRetryAttempts:function(e){x.setRetryAttemptsForType(Ne.HTTPRequest.MPD_TYPE,e)},setManifestLoaderRetryInterval:function(e){x.setRetryIntervalForType(Ne.HTTPRequest.MPD_TYPE,e)},setXHRWithCredentialsForType:function(e,t){x.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return x.getXHRWithCredentialsForType(e)},setJumpGaps:function(e){x.setJumpGaps(e)},getJumpGaps:function(){return x.getJumpGaps()},setSmallGapLimit:function(e){x.setSmallGapLimit(e)},getSmallGapLimit:function(){return x.getSmallGapLimit()},setLowLatencyEnabled:function(e){x.setLowLatencyEnabled(e)},getLowLatencyEnabled:function(){return x.getLowLatencyEnabled()},setCatchUpPlaybackRate:function(e){x.setCatchUpPlaybackRate(e)},getCatchUpPlaybackRate:function(){return x.getCatchUpPlaybackRate()},setLowLatencyMinDrift:function(e){if("number"!=typeof e||isNaN(e)||e<0||.5<e)throw o;x.setLowLatencyMinDrift(e)},getLowLatencyMinDrift:function(){return x.getLowLatencyMinDrift()},setLowLatencyMaxDriftBeforeSeeking:function(e){if("number"!=typeof e||isNaN(e)||e<0)throw a;x.setLowLatencyMaxDriftBeforeSeeking(e)},getLowLatencyMaxDriftBeforeSeeking:function(){return x.getLowLatencyMaxDriftBeforeSeeking()},setManifestUpdateRetryInterval:function(e){x.setManifestUpdateRetryInterval(e)},getManifestUpdateRetryInterval:function(){return x.getManifestUpdateRetryInterval()},setLongFormContentDurationThreshold:function(e){x.setLongFormContentDurationThreshold(e)},setSegmentOverlapToleranceTime:function(e){x.setSegmentOverlapToleranceTime(e)},setCacheLoadThresholdForType:function(e,t){x.setCacheLoadThresholdForType(e,t)},getProtectionController:function(){return te()},attachProtectionController:function(e){E=e},setProtectionData:function(e){h=e,O&&O.setProtectionData(h)},enableManifestDateHeaderTimeSource:function(e){x.setUseManifestDateHeaderTimeSource(e)},displayCaptionsOnTop:function(e){var t=(0,pe.default)(s).getInstance();t.setConfig({videoModel:L}),t.initialize(),t.displayCConTop(e)},attachVideoContainer:function(e){d.warn("attachVideoContainer method has been deprecated and will be removed in dash.js v3.0.0")},attachTTMLRenderingDiv:function(e){if(!L.getElement())throw t;L.setTTMLRenderingDiv(e)},getCurrentTextTrackIndex:function(){var e=NaN;return N&&(e=N.getCurrentTrackIdx()),e},getUseDeadTimeLatencyForAbr:function(){return y.getUseDeadTimeLatency()},setUseDeadTimeLatencyForAbr:function(e){y.setUseDeadTimeLatency(e)},getThumbnail:function(e,t){if(e<0)return null;var r=P.getIsDynamic()?G(e):e,n=O.getStreamForTime(r);if(null===n)return null;var i=n.getThumbnailController();if(!i)return null;var o=O.getTimeRelativeToStreamId(r,n.getId());return i.get(o,t)},keepProtectionMediaKeys:function(e){x.setKeepProtectionMediaKeys(e)},reset:function(){J(null),X(null),h=null,E&&(E.reset(),E=null),w&&(w.reset(),w=null)}},d=l.getLogger(c),v=!(m=g=p=!1),T=h=E=null,Me.default.extend(Re.default),x=(0,_e.default)(s).getInstance(),L=(0,we.default)(s).getInstance(),k=(0,ve.default)(s).getInstance(),c}i.__dashjs_factory_name="MediaPlayer";var o=Oe.default.getClassFactory(i);o.events=Re.default,o.errors=Se.default,Oe.default.updateClassFactory(i.__dashjs_factory_name,o),r.default=o,t.exports=r.default},{"../../externals/base64":340,"../core/FactoryMaker":347,"../dash/DashAdapter":354,"../dash/DashMetrics":356,"../dash/models/DashManifestModel":361,"../dash/utils/TimelineConverter":378,"./../core/Debug":345,"./../core/EventBus":346,"./../core/Version":348,"./../core/errors/Errors":349,"./../core/events/Events":352,"./ManifestLoader":390,"./MediaPlayerEvents":393,"./constants/Constants":400,"./constants/MetricsConstants":401,"./controllers/AbrController":403,"./controllers/BaseURLController":404,"./controllers/MediaController":409,"./controllers/PlaybackController":411,"./controllers/StreamController":413,"./models/ManifestModel":441,"./models/MediaPlayerModel":442,"./models/MetricsModel":443,"./models/URIFragmentModel":444,"./models/VideoModel":445,"./text/TextController":490,"./text/TextTracks":492,"./utils/Capabilities":497,"./utils/DOMStorage":499,"./utils/ErrorHandler":501,"./utils/RequestModifier":506,"./utils/SupervisorTools":507,"./vo/DashJSError":514,"./vo/metrics/HTTPRequest":534,"codem-isoboxer":8}],393:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../core/events/EventsBase");function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(o.prototype),"constructor",this).call(this),this.AST_IN_FUTURE="astInFuture",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_LOADED="bufferLoaded",this.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",this.ERROR="error",this.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",this.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",this.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",this.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",this.LOG="log",this.MANIFEST_LOADED="manifestLoaded",this.METRICS_CHANGED="metricsChanged",this.METRIC_CHANGED="metricChanged",this.METRIC_ADDED="metricAdded",this.METRIC_UPDATED="metricUpdated",this.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",this.PERIOD_SWITCH_STARTED="periodSwitchStarted",this.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",this.QUALITY_CHANGE_RENDERED="qualityChangeRendered",this.TRACK_CHANGE_RENDERED="trackChangeRendered",this.SOURCE_INITIALIZED="sourceInitialized",this.STREAM_INITIALIZED="streamInitialized",this.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",this.TEXT_TRACKS_ADDED="allTextTracksAdded",this.TEXT_TRACK_ADDED="textTrackAdded",this.TTML_PARSED="ttmlParsed",this.TTML_TO_PARSE="ttmlToParse",this.CAPTION_RENDERED="captionRendered",this.CAPTION_CONTAINER_RESIZE="captionContainerResize",this.CAN_PLAY="canPlay",this.PLAYBACK_ENDED="playbackEnded",this.PLAYBACK_ERROR="playbackError",this.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",this.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",this.PLAYBACK_PAUSED="playbackPaused",this.PLAYBACK_PLAYING="playbackPlaying",this.PLAYBACK_PROGRESS="playbackProgress",this.PLAYBACK_RATE_CHANGED="playbackRateChanged",this.PLAYBACK_SEEKED="playbackSeeked",this.PLAYBACK_SEEKING="playbackSeeking",this.PLAYBACK_SEEK_ASKED="playbackSeekAsked",this.PLAYBACK_STALLED="playbackStalled",this.PLAYBACK_STARTED="playbackStarted",this.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",this.PLAYBACK_WAITING="playbackWaiting",this.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged"}var a=new(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,((n=i)&&n.__esModule?n:{default:n}).default),o);r.default=a,t.exports=r.default},{"../core/events/EventsBase":353}],394:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./MediaPlayer"),o=(n=i)&&n.__esModule?n:{default:n};var s,a,u=(s="application/dash+xml",a=void 0,{create:l,createAll:function(e,t){var r=[];e=e||"[data-dashjs-player]";for(var n=(t=t||document).querySelectorAll(e),i=0;i<n.length;i++){var o=l(n[i],null);r.push(o)}var a=t.querySelectorAll('source[type="'+s+'"]');for(i=0;i<a.length;i++)o=l(c(a[i]),null),r.push(o);return r}});function l(e,t,r){if(!e||!/^VIDEO$/i.test(e.nodeName))return null;if(e._dashjs_player)return e._dashjs_player;var n=void 0,i=e.id||e.name||"video element";if(!(t=t||[].slice.call(e.querySelectorAll("source")).filter(function(e){return e.type==s})[0])&&e.src)(t=document.createElement("source")).src=e.src;else if(!t&&!e.src)return null;return r=r||{},(n=(0,o.default)(r).create()).initialize(e,t.src,e.autoplay),(a=a||n.getDebug().getLogger()).debug("Converted "+i+" to dash.js player and added content: "+t.src),e._dashjs_player=n}function c(e){for(var t=!0;t;){var r=e;if(t=!1,/^VIDEO$/i.test(r.nodeName))return r;e=r.parentNode,t=!0}}var d=void 0;"undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate||"undefined"==typeof window||!window||!window.addEventListener||("complete"===window.document.readyState?window.dashjs?u.createAll():d=window.setInterval(function(){window.dashjs&&(window.clearInterval(d),u.createAll())},500):window.addEventListener("load",function e(){window.removeEventListener("load",e),u.createAll()})),r.default=u,t.exports=r.default},{"./MediaPlayer":392}],395:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=n(e("../core/Debug")),i=n(e("../core/FactoryMaker"));function o(e){var t=this.context,r=void 0,n=void 0,i=void 0,o=[],a=e;function s(t,r){o=o.filter(function(e){return!((isNaN(r)||e.start<r)&&(isNaN(t)||e.end>t))})}return r={getAllBufferRanges:function(){for(var t=[],e=0;e<o.length;e++){var r=o[e];0===t.length||r.start>t[t.length-1].end?t.push({start:r.start,end:r.end}):t[t.length-1].end=r.end}var n={start:function(e){return t[e].start},end:function(e){return t[e].end}};return Object.defineProperty(n,"length",{get:function(){return t.length}}),n},append:function(e){i="InitializationSegment"!==e.segmentType?(o.push(e),o.sort(function(e,t){return e.start-t.start}),null):e,n.debug("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),a&&a({chunk:e})},remove:s,abort:function(){},discharge:function(e,t){var r=function(t,r){return o.filter(function(e){return(isNaN(r)||e.start<r)&&(isNaN(t)||e.end>t)})}(e,t);return i&&(r.push(i),i=null),s(e,t),r},reset:function(){o=[],a=i=null},updateTimestampOffset:function(){},hasDiscontinuitiesAfter:function(){return!1}},n=(0,u.default)(t).getInstance().getLogger(r),r}o.__dashjs_factory_name="PreBufferSink";var a=i.default.getClassFactory(o);r.default=a,t.exports=r.default},{"../core/Debug":345,"../core/FactoryMaker":347}],396:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var w=n(e("../core/Debug")),A=n(e("./vo/DashJSError")),T=n(e("../core/EventBus")),S=n(e("../core/events/Events")),i=n(e("../core/FactoryMaker")),x=n(e("./text/TextController")),M=n(e("../core/errors/Errors"));function o(i,n,e,o){var a=this.context,s=(0,T.default)(a).getInstance(),u=void 0,l=void 0,c=void 0,d=void 0,f=void 0,r=[],h=[],p=e;function m(){try{return c.buffered}catch(e){return l.error("getAllBufferRanges exception: "+e.message),null}}function g(e,t,r,n){t&&0<t.length&&t.length<r.length&&function(e,t){for(var r=0;r<e.length;r++){var n=Math.round(e.start(r)),i=Math.round(e.end(r));if(i===t.start||n===t.end||t.start>=n&&t.end<=i)return!0}return!1}(t,n)&&s.trigger(S.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:e,from:r.end(r.length-2),to:r.start(r.length-1),unintended:!0})}function v(){if(0<r.length){var e=r.shift();c.updating?E(c,e):(e(),v())}}function y(){c.updating||v()}function _(){c.updating||v()}function b(){l.error("SourceBufferSink error",n.type)}function E(e,t){r.push(t),e.updating||v()}return u={getAllBufferRanges:m,getBuffer:function(){return c},append:function(e){e?(h.push(e),d||E(c,function n(){var i=this;var o=this;0<h.length&&function(){d=!0;var t=h[0];h.splice(0,1);var r=[],e=function(){var e=m();g(o,r,e,t),0<h.length?n.call(this):(d=!1,p&&p({chunk:t}))};try{0===t.bytes.length?e.call(i):(r=m(),c.appendBuffer?c.appendBuffer(t.bytes):c.append(t.bytes,t),E(c,e.bind(i)))}catch(e){l.fatal('SourceBuffer append failed "'+e+'"'),0<h.length?n():d=!1,p&&p({chunk:t,error:new A.default(e.code,e.message)})}}()}.bind(this))):p({chunk:e,error:new A.default(M.default.APPEND_ERROR_CODE,M.default.APPEND_ERROR_MESSAGE)})},remove:function(t,r,e){var n=this;E(c,function(){try{0<=t&&t<r&&(e||"ended"!==i.readyState)&&c.remove(t,r),E(c,function(){s.trigger(S.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:n,from:t,to:r,unintended:!1})})}catch(e){s.trigger(S.default.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:n,from:t,to:r,unintended:!1,error:new A.default(e.code,e.message)})}})},abort:function(){try{"open"===i.readyState?c.abort():c.setTextTrack&&"ended"===i.readyState&&c.abort()}catch(e){l.error('SourceBuffer append abort failed: "'+e+'"')}h=[]},reset:function(e){if(c){if("function"==typeof c.removeEventListener&&(c.removeEventListener("updateend",_,!1),c.removeEventListener("error",b,!1),c.removeEventListener("abort",b,!1)),clearInterval(f),!e){try{c.getClassName&&"TextSourceBuffer"===c.getClassName()||i.removeSourceBuffer(c)}catch(e){l.error("Failed to remove source buffer from media source.")}c=null}d=!1}h=[],p=null},updateTimestampOffset:function(e){c.timestampOffset===e||isNaN(e)||E(c,function(){c.timestampOffset=e})},hasDiscontinuitiesAfter:function(e){try{var t=m();if(t&&1<t.length)for(var r=0,n=t.length;r<n;r++)if(0<r&&e<t.start(r)&&t.start(r)>t.end(r-1)+.1)return!0}catch(e){l.error("hasDiscontinuities exception: "+e.message)}return!1}},function(){l=(0,w.default)(a).getInstance().getLogger(u),d=!1;var t=n.codec;try{if(t.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))throw new Error("not really supported");(c=o||i.addSourceBuffer(t)).changeType&&o&&(l.debug("Doing period transition with changeType"),c.changeType(t));if("function"==typeof c.addEventListener)try{c.addEventListener("updateend",_,!1),c.addEventListener("error",b,!1),c.addEventListener("abort",b,!1)}catch(e){f=setInterval(y,50)}else f=setInterval(y,50)}catch(e){if(!n.isText&&-1===t.indexOf('codecs="stpp')&&-1===t.indexOf('codecs="wvtt'))throw e;var r=(0,x.default)(a).getInstance();c=r.getTextSourceBuffer()}}(),u}o.__dashjs_factory_name="SourceBufferSink";var a=i.default.getClassFactory(o);r.default=a,t.exports=r.default},{"../core/Debug":345,"../core/EventBus":346,"../core/FactoryMaker":347,"../core/errors/Errors":349,"../core/events/Events":352,"./text/TextController":490,"./vo/DashJSError":514}],397:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var re=n(e("./constants/Constants")),ne=n(e("./StreamProcessor")),ie=n(e("./controllers/EventController")),oe=n(e("./controllers/FragmentController")),ae=n(e("./thumbnail/ThumbnailController")),se=n(e("../core/EventBus")),ue=n(e("../core/events/Events")),le=n(e("../core/Debug")),ce=n(e("../core/errors/Errors")),i=n(e("../core/FactoryMaker")),de=n(e("./vo/DashJSError"));function o(s){s=s||{};var u=this.context,i=(0,se.default)(u).getInstance(),d=s.manifestModel,l=s.dashManifestModel,c=s.mediaPlayerModel,o=s.manifestUpdater,f=s.adapter,a=s.capabilities,h=s.errHandler,p=s.timelineConverter,m=s.metricsModel,g=s.abrController,v=s.playbackController,y=s.mediaController,_=s.textController,b=s.videoModel,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,n=void 0,M=void 0,R=void 0,e=void 0,O=void 0,P=void 0,t=void 0,C=void 0,D=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function r(e){for(var t=A?A.length:0,r=0;r<t;r++){A[r].getFragmentModel().removeExecutedRequestsBeforeTime(k()+N()),A[r].reset(!1,e)}ee(S=T=!(A=[])),i.off(ue.default.CURRENT_TRACK_CHANGED,G,E)}function I(){r(),x=null,M=!(n={})}function L(){v&&v.pause(),e&&(e.reset(),e=null),I(),i.off(ue.default.DATA_UPDATE_COMPLETED,X,E),i.off(ue.default.BUFFERING_COMPLETED,K,E),R&&(i.off(ue.default.KEY_ERROR,B,E),i.off(ue.default.SERVER_CERTIFICATE_UPDATED,B,E),i.off(ue.default.LICENSE_REQUEST_COMPLETE,B,E),i.off(ue.default.KEY_SYSTEM_SELECTED,B,E),i.off(ue.default.KEY_SESSION_CREATED,B,E),i.off(ue.default.KEY_STATUSES_CHANGED,B,E)),ee(!1)}function N(){return x?x.duration:NaN}function k(){return x?x.start:NaN}function F(){return x}function j(){if(!(g&&g.hasOwnProperty("getBitrateList")&&f&&f.hasOwnProperty("getAllMediaInfoForType")&&f.hasOwnProperty("getEventsFor")))throw new Error(re.default.MISSING_CONFIG_ERROR)}function B(e){e.error&&(h.mediaKeySessionError(e.error.message),h.error(e.error),w.fatal(e.error.message),L())}function U(e){var t,r=e.type,n=void 0;if(r===re.default.MUXED&&e)return n="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",w.fatal(n),h.manifestError(n,"multiplexedrep",d.getValue()),h.error(new de.default(ce.default.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,n,d.getValue())),!1;if(r===re.default.TEXT||r===re.default.FRAGMENTED_TEXT||r===re.default.EMBEDDED_TEXT||r===re.default.IMAGE)return!0;if(t=e.codec,w.debug(r+" codec: "+t),e.contentProtection&&!a.supportsEncryptedMedia())h.capabilityError("encryptedmedia"),h.error(new de.default(ce.default.CAPABILITY_MEDIAKEYS_ERROR_CODE,ce.default.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE));else if(!a.supportsCodec(t))return n=r+"Codec ("+t+") is not supported.",w.error(n),!1;return!0}function G(e){if(e.newMediaInfo.streamInfo.id===x.id){var t=Q(e.newMediaInfo);if(t){var r=v.getTime();w.info("Stream -  Process track changed at current time "+r);var n=e.newMediaInfo,i=d.getValue();f.setCurrentMediaInfo(x.id,n.type,n),w.debug("Stream -  Update stream controller"),i.refreshManifestOnSwitchTrack?(w.debug("Stream -  Refreshing manifest for switch track"),C=e,o.refreshManifest()):(t.selectMediaInfo(n),n.type!==re.default.FRAGMENTED_TEXT?(g.updateTopQualityIndex(n),t.switchTrackAsked(),t.getFragmentModel().abortRequests()):(t.getScheduleController().setSeekTarget(NaN),f.setIndexHandlerTime(t,r),f.resetIndexHandler(t)))}}}function H(e,t){var r=f.getAllMediaInfoForType(x,e),n=null,i=void 0;if(r&&0!==r.length){for(var o=0,a=r.length;o<a;o++)if(n=r[o],e===re.default.EMBEDDED_TEXT)_.addEmbeddedTrack(n);else{if(!U(n))continue;y.addTrack(n)}e!==re.default.EMBEDDED_TEXT&&0!==y.getTracksFor(e,x).length&&(e!==re.default.IMAGE?((e!==re.default.FRAGMENTED_TEXT||e===re.default.FRAGMENTED_TEXT&&_.getTextDefaultEnabled())&&(y.checkInitialMediaSettingsForType(e,x),i=y.getCurrentTrackFor(e,x)),e!==re.default.FRAGMENTED_TEXT||_.getTextDefaultEnabled()||(i=y.getTracksFor(e,x)[0]),function(e,t,r,n){var i=(0,ne.default)(u).create({type:e.type,mimeType:e.mimeType,timelineConverter:p,adapter:f,manifestModel:d,dashManifestModel:l,mediaPlayerModel:c,metricsModel:m,dashMetrics:s.dashMetrics,baseURLController:s.baseURLController,stream:E,abrController:g,domStorage:s.domStorage,playbackController:v,mediaController:y,streamController:s.streamController,textController:_,errHandler:h});if(i.initialize(r),g.updateTopQualityIndex(e),n?(i.setBuffer(n.buffer),i.getIndexHandler().setCurrentTime(n.currentTime),A[n.replaceIdx]=i):A.push(i),!n||!n.ignoreMediaInfo)if(e.type===re.default.TEXT||e.type===re.default.FRAGMENTED_TEXT){for(var o=void 0,a=0;a<t.length;a++)t[a].index===e.index&&(o=a),i.addMediaInfo(t[a]);i.selectMediaInfo(t[o])}else i.addMediaInfo(e,!0)}(i,r,t)):O=(0,ae.default)(u).create({dashManifestModel:l,adapter:f,baseURLController:s.baseURLController,stream:E,timelineConverter:s.timelineConverter}))}else w.info("No "+e+" data.")}function V(){P||((P=(0,ie.default)(u).create()).setConfig({manifestUpdater:o,playbackController:v}),z())}function z(){var e=f.getEventsFor(x);P.addInlineEvents(e)}function W(e){var n=f.getAdaptationForType(d.getValue(),x.index,e,x);n&&Array.isArray(n.Representation_asArray)&&(n.Representation_asArray=n.Representation_asArray.filter(function(e,t){if(0===t)return!0;var r=l.getCodec(n,t,!0);return!!a.supportsCodec(r)||(w.error("[Stream] codec not supported: "+r),!1)}))}function q(){for(var e=A.length,t=!!n.audio||!!n.video?new de.default(ce.default.DATA_UPDATE_FAILED_ERROR_CODE,ce.default.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,r=0;r<e;r++)if(A[r].isUpdating()||M)return;if(S){if(R)for(r=0;r<e&&A[r];r++)A[r].getType()!==re.default.AUDIO&&A[r].getType()!==re.default.VIDEO&&A[r].getType()!==re.default.FRAGMENTED_TEXT||R.initializeForMedia(A[r].getMediaInfo());i.trigger(ue.default.STREAM_INITIALIZED,{streamInfo:x,error:t})}}function Y(e){for(var t={},r=0,n=A.length;r<n;r++)t[A[r].getType()]=A[r].createBuffer(e).getBuffer();return t}function K(e){if(e.streamInfo===x){var t=J(),r=t.length;if(0!==r){for(var n=0;n<r;n++)if(!t[n].isBufferingCompleted()&&(t[n].getType()===re.default.AUDIO||t[n].getType()===re.default.VIDEO))return void w.warn("onBufferingCompleted - One streamProcessor has finished but",t[n].getType(),"one is not buffering completed");w.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),i.trigger(ue.default.STREAM_BUFFERING_COMPLETED,{streamInfo:x})}else w.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}}function X(e){var t=e.sender.getStreamProcessor();t.getStreamInfo()===x&&(n[t.getType()]=e.error,q())}function Q(t){return t?J().filter(function(e){return e.getType()===t.type})[0]:null}function J(){for(var e=A.length,t=[],r=void 0,n=void 0,i=0;i<e;i++)(r=(n=A[i]).getType())!==re.default.AUDIO&&r!==re.default.VIDEO&&r!==re.default.FRAGMENTED_TEXT&&r!==re.default.TEXT||t.push(n);return t}function Z(e,t){if(!e)return!1;var r=e.getStreamInfo(),n=F();if(!r||!n)return!1;var i=f.getAdaptationForType(d.getValue(),r.index,t,r),o=f.getAdaptationForType(d.getValue(),n.index,t,n);return i&&o?!i.ContentProtection&&!o.ContentProtection:!i&&!o}function $(e,t){if(!e)return!1;var r=e.getStreamInfo(),n=F();if(!r||!n)return!1;var i=f.getAdaptationForType(d.getValue(),r.index,t,r),o=f.getAdaptationForType(d.getValue(),n.index,t,n);if(!i||!o)return!i&&!o;var a=i&&o&&i.mimeType===o.mimeType,s=o.Representation_asArray.map(function(e){return e.codecs}),u=i.Representation_asArray.map(function(e){return e.codecs}),l=u.some(function(e){return-1<s.indexOf(e)}),c=u.some(function(t){return s.some(function(e){return function(e,t){for(var r=e.split(".")[0],n=0===t.indexOf(r),i=void 0,o=0;o<D.length;o++)if(D[o].codec===r){i=D[o];break}if(i)return n||i.compatibleCodecs.some(function(e){return 0===t.indexOf(e)});return n}(e,t)})});return l||c&&a}function ee(e){t=e}function te(){return t}return E={initialize:function(e,t){x=e,(R=t)&&(i.on(ue.default.KEY_ERROR,B,E),i.on(ue.default.SERVER_CERTIFICATE_UPDATED,B,E),i.on(ue.default.LICENSE_REQUEST_COMPLETE,B,E),i.on(ue.default.KEY_SYSTEM_SELECTED,B,E),i.on(ue.default.KEY_SESSION_CREATED,B,E),i.on(ue.default.KEY_STATUSES_CHANGED,B,E))},activate:function(e,t){if(T)return t;var r=void 0;return i.on(ue.default.CURRENT_TRACK_CHANGED,G,E),r=te()?(function(){if(M=!0,j(),W(re.default.VIDEO),W(re.default.AUDIO),M=!(S=!0),0===A.length){var e="No streams to play.";h.manifestError(e,"nostreams",d.getValue()),w.debug(e)}else q()}(),t):function(e,t){j();var r=b.getElement();V(),M=!0,W(re.default.VIDEO),W(re.default.AUDIO),(null===r||r&&/^VIDEO$/i.test(r.nodeName))&&H(re.default.VIDEO,e);H(re.default.AUDIO,e),H(re.default.TEXT,e),H(re.default.FRAGMENTED_TEXT,e),H(re.default.EMBEDDED_TEXT,e),H(re.default.MUXED,e),H(re.default.IMAGE,e);var n=Y(t);if(M=!(S=!0),0===A.length){var i="No streams to play.";h.manifestError(i,"nostreams",d.getValue()),h.error(new de.default(ce.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,i,d.getValue())),w.fatal(i)}else q();return n}(e,t),T=!0,r},deactivate:r,isActive:function(){return T},getDuration:N,getStartTime:k,getId:function(){return x?x.id:null},getStreamInfo:F,preload:function(e,t){V(),H(re.default.VIDEO,e),H(re.default.AUDIO,e),H(re.default.TEXT,e),H(re.default.FRAGMENTED_TEXT,e),H(re.default.EMBEDDED_TEXT,e),H(re.default.MUXED,e),H(re.default.IMAGE,e),Y(t),i.on(ue.default.CURRENT_TRACK_CHANGED,G,E);for(var r=0;r<A.length&&A[r];r++)A[r].getScheduleController().start();ee(!0)},getFragmentController:function(){return e},getThumbnailController:function(){return O},getBitrateListFor:function(e){if(j(),e===re.default.IMAGE)return O?O.getBitrateList():[];var t=function(e){for(var t=A.length,r=null,n=0;n<t;n++)if((r=A[n]).getType()===e)return r.getMediaInfo();return null}(e);return g.getBitrateList(t)},startEventController:function(){P&&P.start()},stopEventController:function(){P&&P.stop()},updateData:function(e){w.info("Manifest updated... updating data system wide."),M=!(T=!1),x=e,P&&z(),W(re.default.VIDEO),W(re.default.AUDIO);for(var t=0,r=A.length;t<r;t++){var n=A[t],i=f.getMediaInfoForType(x,n.getType());g.updateTopQualityIndex(i),n.addMediaInfo(i,!0)}if(C&&"fragmentedText"!==(i=C.newMediaInfo).type){var o=Q(C.oldMediaInfo);if(!o)return;o.switchTrackAsked(),C=void 0}M=!1,q()},reset:L,getProcessors:J,setMediaSource:function(e){for(var t=0;t<A.length;)U(A[t].getMediaInfo())?(A[t].setMediaSource(e),t++):(A[t].reset(),A.splice(t,1));for(t=0;t<A.length;t++)A[t].dischargePreBuffer();if(0===A.length){var r="No streams to play.";h.manifestError(r,"nostreams",d.getValue()),h.error(new de.default(ce.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,r+"nostreams",d.getValue())),w.fatal(r)}},isMediaCodecCompatible:function(e){return $(e,re.default.VIDEO)&&$(e,re.default.AUDIO)},isProtectionCompatible:function(e){return Z(e,re.default.VIDEO)&&Z(e,re.default.AUDIO)},getPreloaded:te,addInbandEvents:function(e){P&&P.addInbandEvents(e)}},w=(0,le.default)(u).getInstance().getLogger(E),I(),e=(0,oe.default)(u).create({mediaPlayerModel:c,metricsModel:m,errHandler:h}),i.on(ue.default.BUFFERING_COMPLETED,K,E),i.on(ue.default.DATA_UPDATE_COMPLETED,X,E),E}o.__dashjs_factory_name="Stream",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../core/Debug":345,"../core/EventBus":346,"../core/FactoryMaker":347,"../core/errors/Errors":349,"../core/events/Events":352,"./StreamProcessor":398,"./constants/Constants":400,"./controllers/EventController":407,"./controllers/FragmentController":408,"./thumbnail/ThumbnailController":493,"./vo/DashJSError":514}],398:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var I=n(e("./constants/Constants")),L=n(e("./utils/LiveEdgeFinder")),N=n(e("./controllers/BufferController")),k=n(e("./text/TextBufferController")),F=n(e("./controllers/ScheduleController")),j=n(e("../dash/controllers/RepresentationController")),i=n(e("../core/FactoryMaker")),B=n(e("../dash/DashHandler"));function o(t){t=t||{};var r=this.context,n=t.type,i=t.errHandler,o=t.mimeType,a=t.timelineConverter,s=t.adapter,u=t.manifestModel,l=t.mediaPlayerModel,c=t.stream,d=t.abrController,f=t.playbackController,h=t.streamController,p=t.mediaController,m=t.textController,g=t.domStorage,v=t.metricsModel,y=t.dashMetrics,_=t.dashManifestModel,b=void 0,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,M=void 0,R=void 0,O=void 0;function e(){R=[]}function P(){w=[],E=null,e()}function C(){return c?c.getStreamInfo():null}function D(){return E}return b={initialize:function(e){(O=(0,B.default)(r).create({mimeType:o,timelineConverter:a,dashMetrics:y,metricsModel:v,mediaPlayerModel:l,baseURLController:t.baseURLController,errHandler:i})).initialize(b),d.registerStreamType(n,b),(M=c.getFragmentController().getModel(n)).setStreamProcessor(b),A=function(e){var t=null;t=e===I.default.VIDEO||e===I.default.AUDIO?(0,N.default)(r).create({type:e,metricsModel:v,mediaPlayerModel:l,manifestModel:u,errHandler:i,streamController:h,mediaController:p,adapter:s,textController:m,abrController:d,playbackController:f,streamProcessor:b}):(0,k.default)(r).create({type:e,mimeType:o,metricsModel:v,mediaPlayerModel:l,manifestModel:u,errHandler:i,streamController:h,mediaController:p,adapter:s,textController:m,abrController:d,playbackController:f,streamProcessor:b});return t}(n),T=(0,F.default)(r).create({type:n,mimeType:o,metricsModel:v,adapter:s,dashMetrics:y,dashManifestModel:_,timelineConverter:a,mediaPlayerModel:l,abrController:d,playbackController:f,streamController:h,textController:m,streamProcessor:b,mediaController:p}),(x=(0,j.default)(r).create()).setConfig({abrController:d,domStorage:g,metricsModel:v,dashMetrics:y,dashManifestModel:_,manifestModel:u,playbackController:f,timelineConverter:a,streamProcessor:b}),A.initialize(e),T.initialize(),x.initialize()},isUpdating:function(){return!!x&&x.isUpdating()},getType:function(){return n},getBufferController:function(){return A},getFragmentModel:function(){return M},getScheduleController:function(){return T},getLiveEdgeFinder:function(){return S},getFragmentController:function(){return c?c.getFragmentController():null},getRepresentationController:function(){return x},getIndexHandler:function(){return O},getRepresentationInfo:function(e){return s.getRepresentationInfo(x,e)},getBufferLevel:function(){return A.getBufferLevel()},switchInitData:function(e,t){A&&A.switchInitData(C().id,e,t)},isBufferingCompleted:function(){return!!A&&A.getIsBufferingCompleted()},timeIsBuffered:function(e){return!!A&&null!==A.getRangeAt(e,0)},createBuffer:function(e){return A.getBuffer()||A.createBuffer(E,e)},getStreamInfo:C,selectMediaInfo:function(e){e===E||e&&E&&e.type!==E.type||(E=e),s.updateData(this)},addMediaInfo:function(e,t){-1===w.indexOf(e)&&w.push(e),t&&this.selectMediaInfo(e)},switchTrackAsked:function(){T.switchTrackAsked()},getMediaInfoArr:function(){return w},getMediaInfo:D,getMediaSource:function(){return A.getMediaSource()},setMediaSource:function(e){A.setMediaSource(e,D())},dischargePreBuffer:function(){A.dischargePreBuffer()},getBuffer:function(){return A.getBuffer()},setBuffer:function(e){A.setBuffer(e)},registerExternalController:function(e){R.push(e)},unregisterExternalController:function(e){var t=R.indexOf(e);-1!==t&&R.splice(t,1)},getExternalControllers:function(){return R},unregisterAllExternalController:e,addInbandEvents:function(e){c&&c.addInbandEvents(e)},reset:function(e,t){O.reset(),A&&(A.reset(e,t),A=null),T&&(T.reset(),T=null),x&&(x.reset(),x=null),d&&d.unRegisterStreamType(n),R.forEach(function(e){e.reset()}),P(),c=n=null,S&&(S.reset(),S=null)}},f&&f.getIsDynamic()&&(S=(0,L.default)(r).create({timelineConverter:a,streamProcessor:b})),P(),b}o.__dashjs_factory_name="StreamProcessor",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../core/FactoryMaker":347,"../dash/DashHandler":355,"../dash/controllers/RepresentationController":360,"./constants/Constants":400,"./controllers/BufferController":406,"./controllers/ScheduleController":412,"./text/TextBufferController":489,"./utils/LiveEdgeFinder":504}],399:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=n(e("./vo/DashJSError")),i=n(e("./net/HTTPLoader")),l=e("./vo/metrics/HTTPRequest"),c=n(e("./vo/TextRequest")),d=n(e("../core/EventBus")),f=n(e("../core/events/Events")),o=n(e("../core/FactoryMaker")),h=n(e("../core/errors/Errors"));function a(e){e=e||{};var o="urn:mpeg:dash:resolve-to-zero:2013",t=this.context,a=(0,d.default)(t).getInstance(),s=(0,i.default)(t).create({errHandler:e.errHandler,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier});return{load:function(r,n,i){function t(e,t){n.resolved=!0,n.resolvedContent=e||null,a.trigger(f.default.XLINK_ELEMENT_LOADED,{element:n,resolveObject:i,error:e||t?null:new u.default(h.default.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,h.default.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+r)})}if(r===o)t(null,!0);else{var e=new c.default(r,l.HTTPRequest.XLINK_EXPANSION_TYPE);s.load({request:e,success:function(e){t(e)},error:function(){t(null)}})}},reset:function(){s&&(s.abort(),s=null)}}}a.__dashjs_factory_name="XlinkLoader",r.default=o.default.getClassFactory(a),t.exports=r.default},{"../core/EventBus":346,"../core/FactoryMaker":347,"../core/errors/Errors":349,"../core/events/Events":352,"./net/HTTPLoader":447,"./vo/DashJSError":514,"./vo/TextRequest":525,"./vo/metrics/HTTPRequest":534}],400:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.init()}Object.defineProperty(r,"__esModule",{value:!0});var o=new(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(i,[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.FRAGMENTED_TEXT="fragmentedText",this.EMBEDDED_TEXT="embeddedText",this.MUXED="muxed",this.IMAGE="image",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.UTF8="utf-8",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)"}}]),i);r.default=o,t.exports=r.default},{}],401:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.init()}Object.defineProperty(r,"__esModule",{value:!0});var o=new(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(i,[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors"}}]),i);r.default=o,t.exports=r.default},{}],402:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.init()}Object.defineProperty(r,"__esModule",{value:!0});var o=new(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(i,[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready"}}]),i);r.default=o,t.exports=r.default},{}],403:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var $=n(e("../rules/abr/ABRRulesCollection")),ee=n(e("../constants/Constants")),te=n(e("../constants/MetricsConstants")),re=n(e("../vo/BitrateInfo")),ne=n(e("../models/FragmentModel")),ie=n(e("../../core/EventBus")),oe=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),ae=n(e("../rules/RulesContext")),se=n(e("../rules/SwitchRequest")),ue=n(e("../rules/SwitchRequestHistory")),le=n(e("../rules/DroppedFramesHistory")),ce=n(e("../rules/ThroughputHistory")),de=e("../vo/metrics/HTTPRequest"),fe=n(e("../../core/Debug")),he=e("../utils/SupervisorTools"),pe="abandonload",me="allowload";function o(){var d=this.context,f=(0,fe.default)(d).getInstance(),u=(0,ie.default)(d).getInstance(),h=void 0,p=void 0,m=void 0,a=void 0,r=void 0,i=void 0,l=void 0,o=void 0,s=void 0,g=void 0,v=void 0,c=void 0,y=void 0,t=void 0,_=void 0,b=void 0,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,M=void 0,R=void 0,O=void 0,n=void 0,P=void 0,C=void 0,D=void 0,I=void 0;function L(){(m=(0,$.default)(d).create({metricsModel:C,dashMetrics:D,mediaPlayerModel:S,adapter:A})).initialize()}function e(){r={video:!0,audio:!0},i={},l={},o={},s={},v={},g={},R={},t=!(I=!(y=!(P={}))),void 0===_&&(_=!1),n=O=M=void 0,clearTimeout(c),c=null}function N(e){e.mediaType===ee.default.VIDEO&&(M=e.oldQuality,O.push(M,T.getPlaybackQuality()))}function k(e){e.metric!==te.default.HTTP_REQUEST||!e.value||e.value.type!==de.HTTPRequest.MEDIA_SEGMENT_TYPE||e.mediaType!==ee.default.AUDIO&&e.mediaType!==ee.default.VIDEO||n.push(e.mediaType,e.value,I),e.metric!==te.default.BUFFER_LEVEL||e.mediaType!==ee.default.AUDIO&&e.mediaType!==ee.default.VIDEO||function(e,t){var r=S.getABRStrategy();{if(r===ee.default.ABR_STRATEGY_BOLA)return P[e]=!0;if(r===ee.default.ABR_STRATEGY_THROUGHPUT)return P[e]=!1}var n=S.getStableBufferTime(),i=n,o=.5*n,a=P[e],s=(a?o:i)<t;(P[e]=s)!==a&&(s?p.info("AbrController ("+e+") switching from throughput to buffer occupancy ABR rule (buffer: "+t.toFixed(3)+")."):p.info("AbrController ("+e+") switching from buffer occupancy to throughput ABR rule (buffer: "+t.toFixed(3)+")."))}(e.mediaType,.001*e.value.level)}function F(e,t){return i[t]=i[t]||{},i[t].hasOwnProperty(e)||(i[t][e]=0),function(e,t){if(t!==ee.default.VIDEO||!y||!g[t])return e;_||J();var r=w.getValue(),n=A.getAdaptationForType(r,0,t).Representation,i=e;if(0<b&&0<E){for(;0<i&&n[i]&&b<n[i].width&&b-n[i-1].width<n[i].width-b;)i-=1;n.length-2>=i&&n[i].width===n[i+1].width&&(i=Math.min(e,i+1))}return i}(function(e,t,r){var n=H(t);if(isNaN(n)||1<=n||n<0)return e;return Math.min(e,Math.round(r*n))}(function(e,t){var r=e;if(!g[t])return r;var n=G(t);void 0!==n&&(r=Math.max(e,n));var i=U(t);void 0!==i&&(r=Math.min(r,i));return r}(i[t][e],e),e,i[t][e]),e)}function j(e){return o.hasOwnProperty("max")&&o.max.hasOwnProperty(e)?o.max[e]:NaN}function B(e){return o.hasOwnProperty("min")&&o.min.hasOwnProperty(e)?o.min[e]:NaN}function U(e){var t=j(e);return t?Y(g[e].getMediaInfo(),t):void 0}function G(e){var t=B(e);if(t){var r=g[e].getMediaInfo(),n=K(r),i=Y(r,t);return n[i]&&i<n.length-1&&n[i].bitrate<1e3*t&&i++,i}}function H(e){return s.hasOwnProperty("max")&&s.max.hasOwnProperty(e)?s.max[e]:1}function V(e){return r[e]}function z(e,t,r,n){var i=t.id,o=Q(e);(0,he.checkInteger)(r);var a=F(e,i);r!==o&&0<=r&&r<=a&&W(e,o,r,a,n)}function W(e,t,r,n,i){if(e&&g[e]){var o=g[e].getStreamInfo(),a=o?o.id:null;if(f.getLogToBrowserConsole()){var s=D.getCurrentBufferLevel(C.getReadOnlyMetricsFor(e));p.info("AbrController ("+e+") switch from "+t+" to "+r+"/"+n+" (buffer: "+s+") "+(i?JSON.stringify(i):"."))}!function(e,t,r){l[t]=l[t]||{},l[t][e]=r}(e,a,r),u.trigger(oe.default.QUALITY_CHANGE_REQUESTED,{mediaType:e,streamInfo:o,oldQuality:t,newQuality:r,reason:i})}}function q(e,t){v[e].state=t}function Y(e,t,r){var n=e&&e.type?g[e.type].getRepresentationInfo():null;if(I&&r&&n&&n.fragmentDuration){r/=1e3;var i=n.fragmentDuration;if(i<r)return 0;t*=1-r/i}for(var o=K(e),a=o.length-1;0<=a;a--){if(1e3*t>=o[a].bitrate)return a}return 0}function K(e){var t=[];if(!e||!e.bitrateList)return t;for(var r=e.bitrateList,n=e.type,i=void 0,o=0,a=r.length;o<a;o++)(i=new re.default).mediaType=n,i.qualityIndex=o,i.bitrate=r[o].bandwidth,i.width=r[o].width,i.height=r[o].height,i.scanType=r[o].scanType,t.push(i);return t}function X(e){return P[e]}function Q(e){if(e&&g[e]){var t=g[e].getStreamInfo(),r=t?t.id:null;if(r)return l[r]=l[r]||{},l[r].hasOwnProperty(e)||(l[r][e]=0),l[r][e]}return 0}function J(){if(T){var e=t&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;b=T.getClientWidth()*e,E=T.getClientHeight()*e}}function Z(e){var t=e.request.mediaType;if(V(t)){var r=g[t];if(!r)return;var n=(0,ae.default)(d).create({abrController:h,streamProcessor:r,currentRequest:e.request,useBufferOccupancyABR:X(t)}),i=m.shouldAbandonFragment(n);if(i.quality>se.default.NO_CHANGE){var o=r.getFragmentModel();o.getRequests({state:ne.default.FRAGMENT_MODEL_LOADING,index:e.request.index})[0]&&(o.abortRequests(),q(t,pe),R[t].reset(),R[t].push({oldValue:Q(t,a.getActiveStreamInfo()),newValue:i.quality,confidence:1,reason:i.reason}),z(t,a.getActiveStreamInfo(),i.quality,i.reason),clearTimeout(c),c=setTimeout(function(){q(t,me),c=null},S.getAbandonLoadTimeout()))}}}return h={isPlayingAtTopQuality:function(e){var t=e?e.id:null,r=Q(ee.default.AUDIO),n=Q(ee.default.VIDEO);return r===F(ee.default.AUDIO,t)&&n===F(ee.default.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,r=e.streamInfo.id,n=e.representationCount-1;return function(e,t,r){i[t]=i[t]||{},i[t][e]=r}(t,r,n),n},getThroughputHistory:function(){return n},getBitrateList:K,getQualityForBitrate:Y,getMaxAllowedBitrateFor:j,getTopBitrateInfoFor:function(e){if(e&&g&&g[e]){var t=g[e].getStreamInfo();if(t&&t.id){var r=F(e,t.id),n=K(g[e].getMediaInfo());return n[r]?n[r]:null}}return null},getMinAllowedBitrateFor:B,setMaxAllowedBitrateFor:function(e,t){(0,he.checkParameterType)(t,"number"),(0,he.checkIsVideoOrAudioType)(e),o.max=o.max||{},o.max[e]=t},setMinAllowedBitrateFor:function(e,t){(0,he.checkParameterType)(t,"number"),(0,he.checkIsVideoOrAudioType)(e),o.min=o.min||{},o.min[e]=t},getMaxAllowedIndexFor:U,getMinAllowedIndexFor:G,getMaxAllowedRepresentationRatioFor:H,setMaxAllowedRepresentationRatioFor:function(e,t){s.max=s.max||{},s.max[e]=t},getInitialBitrateFor:function(e){!function(){if(!x||!x.hasOwnProperty("getSavedBitrateSettings"))throw new Error(ee.default.MISSING_CONFIG_ERROR)}();var t=x.getSavedBitrateSettings(e);if(!o.hasOwnProperty(e))if(s.hasOwnProperty(e)){var r=w.getValue(),n=A.getAdaptationForType(r,0,e).Representation;if(Array.isArray(n)){var i=Math.max(Math.round(n.length*s[e])-1,0);o[e]=n[i].bandwidth}else o[e]=0}else isNaN(t)?o[e]=e===ee.default.VIDEO?1e3:100:o[e]=t;return o[e]},setInitialBitrateFor:function(e,t){(0,he.checkIsVideoOrAudioType)(e),(0,he.checkParameterType)(t,"number"),o[e]=t},getInitialRepresentationRatioFor:function(e){return s.hasOwnProperty(e)?s[e]:null},setInitialRepresentationRatioFor:function(e,t){s[e]=t},setAutoSwitchBitrateFor:function(e,t){(0,he.checkParameterType)(t,"boolean"),(0,he.checkIsVideoOrAudioType)(e),r[e]=t},getAutoSwitchBitrateFor:V,getUseDeadTimeLatency:function(){return I},setUseDeadTimeLatency:function(e){(0,he.checkParameterType)(e,"boolean"),I=e},setLimitBitrateByPortal:function(e){(0,he.checkParameterType)(e,"boolean"),y=e},getLimitBitrateByPortal:function(){return y},getUsePixelRatioInLimitBitrateByPortal:function(){return t},setUsePixelRatioInLimitBitrateByPortal:function(e){(0,he.checkParameterType)(e,"boolean"),t=e},getQualityFor:Q,getAbandonmentStateFor:function(e){return v[e]?v[e].state:null},setPlaybackQuality:z,checkPlaybackQuality:function(e){if(e&&g&&g[e]){var t=g[e].getStreamInfo(),r=t?t.id:null,n=Q(e),i=(0,ae.default)(d).create({abrController:h,streamProcessor:g[e],currentValue:n,switchHistory:R[e],droppedFramesHistory:O,useBufferOccupancyABR:X(e)});if(O){var o=T.getPlaybackQuality();o&&O.push(M,o)}if(V(e)){var a=G(e),s=F(e,r),u=m.getMaxQuality(i),l=u.quality;if(void 0!==a&&l<a&&(l=a),s<l&&(l=s),R[e].push({oldValue:n,newValue:l}),l>se.default.NO_CHANGE&&l!=n)(v[e].state===me||n<l)&&W(e,n,l,s,u.reason);else if(f.getLogToBrowserConsole()){var c=D.getCurrentBufferLevel(C.getReadOnlyMetricsFor(e));p.debug("AbrController ("+e+") stay on "+n+"/"+s+" (buffer: "+c+")")}}}},getTopQualityIndexFor:F,setElementSize:J,setWindowResizeEventCalled:function(e){_=e},createAbrRulesCollection:L,registerStreamType:function(e,t){R[e]=(0,ue.default)(d).create(),g[e]=t,v[e]=v[e]||{},v[e].state=me,P[e]=!1,u.on(oe.default.LOADING_PROGRESS,Z,this),e==ee.default.VIDEO&&(u.on(oe.default.QUALITY_CHANGE_RENDERED,N,this),O=(0,le.default)(d).create(),J()),u.on(oe.default.METRIC_ADDED,k,this),u.on(oe.default.PERIOD_SWITCH_COMPLETED,L,this),n=(0,ce.default)(d).create({mediaPlayerModel:S})},unRegisterStreamType:function(e){delete g[e]},setConfig:function(e){e&&(e.streamController&&(a=e.streamController),e.domStorage&&(x=e.domStorage),e.mediaPlayerModel&&(S=e.mediaPlayerModel),e.metricsModel&&(C=e.metricsModel),e.dashMetrics&&(D=e.dashMetrics),e.adapter&&(A=e.adapter),e.manifestModel&&(w=e.manifestModel),e.videoModel&&(T=e.videoModel))},reset:function(){e(),u.off(oe.default.LOADING_PROGRESS,Z,this),u.off(oe.default.QUALITY_CHANGE_RENDERED,N,this),u.off(oe.default.METRIC_ADDED,k,this),u.off(oe.default.PERIOD_SWITCH_COMPLETED,L,this),m&&m.reset()}},p=f.getLogger(h),e(),h}o.__dashjs_factory_name="AbrController";var a=i.default.getSingletonFactory(o);a.ABANDON_LOAD=pe,a.QUALITY_DEFAULT=0,i.default.updateSingletonFactory(o.__dashjs_factory_name,a),r.default=a,t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../constants/Constants":400,"../constants/MetricsConstants":401,"../models/FragmentModel":440,"../rules/DroppedFramesHistory":473,"../rules/RulesContext":474,"../rules/SwitchRequest":475,"../rules/SwitchRequestHistory":476,"../rules/ThroughputHistory":477,"../rules/abr/ABRRulesCollection":478,"../utils/SupervisorTools":507,"../vo/BitrateInfo":513,"../vo/metrics/HTTPRequest":534}],404:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=n(e("../models/BaseURLTreeModel")),l=n(e("../utils/BaseURLSelector")),c=n(e("../utils/URLUtils")),d=n(e("../../dash/vo/BaseURL")),i=n(e("../../core/FactoryMaker")),f=n(e("../../core/EventBus")),h=n(e("../../core/events/Events"));function o(){var e=void 0,t=void 0,r=this.context,n=(0,f.default)(r).getInstance(),i=(0,c.default)(r).getInstance(),o=void 0,a=void 0;function s(e){o.invalidateSelectedIndexes(e.entry)}return e={reset:function(){o.reset(),a.reset()},initialize:function(e){o.setConfig({dashManifestModel:t}),a.setConfig({dashManifestModel:t}),function(e){o.update(e),a.chooseSelectorFromManifest(e)}(e)},resolve:function(e){var t=o.getForPath(e).reduce(function(e,t){var r=a.select(t);return r?(i.isRelative(r.url)?e.url=i.resolve(r.url,e.url):(e.url=r.url,e.serviceLocation=r.serviceLocation),e.availabilityTimeOffset=r.availabilityTimeOffset,e.availabilityTimeComplete=r.availabilityTimeComplete,e):new d.default},new d.default);if(!i.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(o=e.baseURLTreeModel),e.baseURLSelector&&(a=e.baseURLSelector),e.dashManifestModel&&(t=e.dashManifestModel)}},o=(0,u.default)(r).create(),a=(0,l.default)(r).create(),n.on(h.default.SERVICE_LOCATION_BLACKLIST_CHANGED,s,e),e}o.__dashjs_factory_name="BaseURLController",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../../dash/vo/BaseURL":381,"../models/BaseURLTreeModel":439,"../utils/BaseURLSelector":495,"../utils/URLUtils":509}],405:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),s=n(e("../../core/EventBus"));function o(e){e=e||{};var t=[],r=(0,s.default)(this.context).getInstance(),n=e.updateEventName,i=e.addBlacklistEventName;function o(e){-1===t.indexOf(e)&&(t.push(e),r.trigger(n,{entry:e}))}function a(e){o(e.entry)}return function(){i&&r.on(i,a,this)}(),{add:o,contains:function(e){return!!(t.length&&e&&e.length)&&-1!==t.indexOf(e)},reset:function(){t=[]}}}o.__dashjs_factory_name="BlackListController",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347}],406:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var pe=n(e("../constants/Constants")),me=n(e("../models/FragmentModel")),ge=n(e("../SourceBufferSink")),ve=n(e("../PreBufferSink")),ye=n(e("./AbrController")),_e=n(e("./MediaController")),be=n(e("../../core/EventBus")),Ee=n(e("../../core/events/Events")),we=n(e("../utils/BoxParser")),i=n(e("../../core/FactoryMaker")),Ae=n(e("../../core/Debug")),Te=n(e("../utils/InitCache")),Se=n(e("../vo/DashJSError")),xe=n(e("../../core/errors/Errors")),Me=e("../vo/metrics/HTTPRequest"),Re="bufferLoaded",Oe="bufferStalled",Pe="BufferController";function o(e){e=e||{};var f=this.context,a=(0,be.default)(f).getInstance(),t=e.metricsModel,u=e.mediaPlayerModel,r=e.errHandler,n=e.streamController,i=e.mediaController,h=e.adapter,o=e.textController,s=e.abrController,l=e.playbackController,c=e.type,d=e.streamProcessor,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,_=void 0,b=void 0,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,M=void 0,R=void 0,O=void 0,P=void 0,C=void 0,D=void 0,I=void 0,L=void 0;function N(e,t){if(!O||!e||!d)return null;if(b)try{"function"==typeof(A=t&&t[c]?(0,ge.default)(f).create(b,e,U.bind(this),t[c]):(0,ge.default)(f).create(b,e,U.bind(this))).getBuffer().initialize&&A.getBuffer().initialize(c,d)}catch(e){m.fatal("Caught error on create SourceBuffer: "+e),r.mediaSourceError("Error creating "+c+" source buffer."),r.error(new Se.default(xe.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,xe.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+c))}else A=(0,ve.default)(f).create(U.bind(this));return ie(d.getRepresentationInfo(g).MSETimeOffset),A}function k(e){e.fragmentModel===d.getFragmentModel()&&(m.info("Init fragment finished loading saving to",c+"'s init cache"),O.save(e.chunk),m.debug("Append Init fragment",c," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),j(e.chunk))}function F(e){if(e.fragmentModel===d.getFragmentModel()){var t=e.chunk,r=t.bytes,n=t.quality,i=d.getRepresentationInfo(n),o=h.getEventsFor(i.mediaInfo,d),a=h.getEventsFor(i,d);if(o&&0<o.length||a&&0<a.length){var s=function(e,t,r,n){for(var i=Math.max(!t||isNaN(t.startTime)?0:t.startTime,0),o=[],a=[],s=r.concat(n),u=0,l=s.length;u<l;u++)o[s[u].schemeIdUri+"/"+s[u].value]=s[u];var c=(0,we.default)(f).getInstance().parse(e).getBoxes("emsg");for(u=0,l=c.length;u<l;u++){var d=h.getEvent(c[u],o,i);d&&a.push(d)}return a}(r,d.getFragmentModel().getRequests({state:me.default.FRAGMENT_MODEL_EXECUTED,quality:n,index:t.index})[0],o,a);d.addInbandEvents(s)}if(I){L=t;var u=A&&A.getAllBufferRanges();u&&0<u.length&&.5<l.getTimeToStreamEnd()&&(m.debug("Clearing buffer because track changed - "+(u.end(u.length-1)+.5)),te([{start:0,end:u.end(u.length-1)+.5,force:!0}]))}else j(t)}}function j(e){A.append(e),e.mediaInfo.type===pe.default.VIDEO&&a.trigger(Ee.default.VIDEO_CHUNK_RECEIVED,{chunk:e})}function B(e){if(e&&0<e.length)for(var t=0,r=e.length;t<r;t++)m.debug("Buffered Range for type:",c,":",e.start(t)," - ",e.end(t)," currentTime = ",l.getTime())}function U(e){if(e.error){if(22===e.error.code&&(_=.8*de(),m.warn("Quota exceeded for type: "+c+", Critical Buffer: "+_),0<_)){var t=Math.max(.2*_,1),r=_-t;u.setBufferToKeep(parseFloat(t.toFixed(5))),u.setBufferAheadToKeep(parseFloat(r.toFixed(5)))}22!==e.error.code&&fe()||(m.warn("Clearing playback buffer to overcome quota exceed situation for type: "+c),a.trigger(Ee.default.QUOTA_EXCEEDED,{sender:p,criticalBufferLevel:_}),z())}else{(x=e.chunk)&&!isNaN(x.index)&&(E=Math.max(x.index,E),J());var n=A.getAllBufferRanges();if(x.segmentType===Me.HTTPRequest.MEDIA_SEGMENT_TYPE)B(n),W();else if(I){var i=l.getTime();m.debug("AppendToBuffer seek target should be "+i),d.getScheduleController().setSeekTarget(i),h.setIndexHandlerTime(d,i)}var o={sender:p,quality:x.quality,startTime:x.start,index:x.index,bufferedRanges:n};x&&!x.endFragment?a.trigger(Ee.default.BYTES_APPENDED,o):x&&a.trigger(Ee.default.BYTES_APPENDED_END_FRAGMENT,o)}}function G(e){g!==e.newQuality&&c===e.mediaType&&d.getStreamInfo().id===e.streamInfo.id&&(ie(d.getRepresentationInfo(e.newQuality).MSETimeOffset),g=e.newQuality)}function H(){v&&(v=!(C=!0),w=Number.POSITIVE_INFINITY),c!==pe.default.FRAGMENTED_TEXT?z():W()}function V(){P=void 0}function z(){var e=function(){var e=[],t=A.getAllBufferRanges();if(!t||0===t.length)return e;var r=l.getTime(),n=t.end(t.length-1)+.5,i=d.getFragmentModel().getRequests({state:me.default.FRAGMENT_MODEL_EXECUTED,time:r,threshold:.01})[0];if(i){var o={start:0,end:i.startTime-.5},a=d.getFragmentModel().getRequests({state:me.default.FRAGMENT_MODEL_EXECUTED,time:i.startTime-i.duration/2,threshold:.01})[0];a&&a.startTime!=i.startTime&&(o.end=a.startTime),o.start<o.end&&o.end>t.start(0)&&e.push(o);var s={start:i.startTime+i.duration+.5,end:n},u=d.getFragmentModel().getRequests({state:me.default.FRAGMENT_MODEL_EXECUTED,time:i.startTime+i.duration+.5,threshold:.01})[0];u&&u.startTime!==i.startTime&&(s.start=u.startTime+u.duration+.5),s.start<s.end&&s.start<n&&e.push(s)}else m.debug("getAllRangesWithSafetyFactor for",c,"- No request found in current time position, removing full buffer 0 -",n),e.push({start:0,end:n});return e}();e&&0!==e.length||W(),te(e)}function W(){(!I||c===pe.default.FRAGMENTED_TEXT&&o.isTextEnabled())&&(X(),Q())}function q(){Z()}function Y(){Z()}function K(e,t){var r=A.getAllBufferRanges(),n=0,i=0,o=null,a=null,s=0,u=void 0,l=void 0,c=t||.15;if(null!=r){for(l=0,u=r.length;l<u;l++)if(n=r.start(l),i=r.end(l),null===o)s=Math.abs(n-e),n<=e&&e<i?(o=n,a=i):s<=c&&(o=n,a=i);else{if(!((s=n-a)<=c))break;a=i}if(null!==o)return{start:o,end:a}}return null}function X(){l&&(y=function(e,t){var r;return null===(r=K(e,t))?0:r.end-e}(function(){var e=l.getTime();if(P){var t=A.getAllBufferRanges();t&&t.length&&(e=Math.max(t.start(0),P))}return e}()||0),a.trigger(Ee.default.BUFFER_LEVEL_UPDATED,{sender:p,bufferLevel:y}),Z())}function Q(){d&&n&&d.getStreamInfo()&&(t.addBufferState(c,S,d.getScheduleController().getBufferTarget()),t.addBufferLevel(c,new Date,1e3*y))}function J(){w-1<=E&&!v&&void 0===A.discharge&&(v=!0,m.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED"),a.trigger(Ee.default.BUFFERING_COMPLETED,{sender:p,streamInfo:d.getStreamInfo()}))}function Z(){"audio"!==c&&"video"!==c||(C&&!v&&l&&l.getTimeToStreamEnd()-y<.5&&(v=!(C=!1),m.debug("checkIfSufficientBuffer trigger BUFFERING_COMPLETED"),a.trigger(Ee.default.BUFFERING_COMPLETED,{sender:p,streamInfo:d.getStreamInfo()})),(!u.getLowLatencyEnabled()&&y<.5||0===y)&&!v?$(Oe):(v||y>=u.getStableBufferTime())&&$(Re))}function $(e){S===e||e===Oe&&0===l.getTime()||c===pe.default.FRAGMENTED_TEXT&&!o.isTextEnabled()||(S=e,Q(),a.trigger(Ee.default.BUFFER_LEVEL_STATE_CHANGED,{sender:p,state:e,mediaType:c,streamInfo:d.getStreamInfo()}),a.trigger(e===Re?Ee.default.BUFFER_LOADED:Ee.default.BUFFER_EMPTY,{mediaType:c}),m.debug(e===Re?"Got enough buffer to start for "+c:"Waiting for more buffer before starting playback for "+c))}function ee(){A&&c!==pe.default.FRAGMENTED_TEXT&&(v||te(function(){var e=[],t=A.getAllBufferRanges();if(!t||0===t.length)return e;var r=l.getTime(),n={start:Math.max(0,r-u.getBufferToKeep()),end:r+u.getBufferAheadToKeep()},i=d.getFragmentModel().getRequests({state:me.default.FRAGMENT_MODEL_EXECUTED,time:r,threshold:.01})[0];if(i)n.start=Math.min(i.startTime,n.start),n.end=Math.max(i.startTime+i.duration,n.end);else if(0===r&&l.getIsDynamic())return[];if(t.start(0)<=n.start){for(var o={start:0,end:n.start},a=0;a<t.length&&t.end(a)<=n.start;a++)o.end=t.end(a);o.start<o.end&&e.push(o)}if(t.end(t.length-1)>=n.end){var s={start:n.end,end:t.end(t.length-1)+.01};s.start<s.end&&e.push(s)}return e}()))}function te(e){e&&A&&0!==e.length&&(D.push.apply(D,e),R||re())}function re(){if(0===D.length||!A)return m.debug("Nothing to prune, halt pruning"),void(R=!(D=[]));var e=A.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return m.debug("SourceBuffer is empty (or does not exist), halt pruning"),void(R=!(D=[]));var t=D.shift();m.debug("Removing",c,"buffer from:",t.start,"to",t.end),R=!0;var r=l.getTime();r<t.end&&(v=!1,E=0,I||(d.getScheduleController().setSeekTarget(r),h.setIndexHandlerTime(d,r))),A.remove(t.start,t.end,t.force)}function ne(e){A===e.buffer&&(m.debug("onRemoved buffer from:",e.from,"to",e.to),B(A.getAllBufferRanges()),0===D.length&&(R=!1),e.unintended&&(m.warn("Detected unintended removal from:",e.from,"to",e.to,"setting index handler time to",e.from),h.setIndexHandlerTime(d,e.from)),R?re():(I?(I=!1,L&&j(L)):(m.debug("onRemoved : call updateBufferLevel"),X()),a.trigger(Ee.default.BUFFER_CLEARED,{sender:p,from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:fe()})))}function ie(e){A&&A.updateTimestampOffset&&A.updateTimestampOffset(e)}function oe(e){e.sender.getStreamProcessor()!==d||e.error||ie(e.currentRepresentation.MSETimeOffset)}function ae(e){e.fragmentModel===d.getFragmentModel()&&(w=e.request.index,J())}function se(e){var t=A&&A.getAllBufferRanges();t&&e.newMediaInfo.type===c&&e.newMediaInfo.streamInfo.id===d.getStreamInfo().id&&(m.info("Track change asked"),i.getSwitchMode(c)===_e.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&t&&0<t.length&&.5<l.getTimeToStreamEnd()&&(v=!1,w=Number.POSITIVE_INFINITY))}function ue(){++M*(u.getWallclockTimeUpdateInterval()/1e3)>=u.getBufferPruningInterval()&&(M=0,ee())}function le(){Z()}function ce(e,t){b=e,A&&t&&"function"==typeof A.discharge&&(T=A,N(t))}function de(){var e,t=A.getAllBufferRanges(),r=0,n=void 0;if(!t)return r;for(n=0,e=t.length;n<e;n++)r+=t.end(n)-t.start(n);return r}function fe(){return de()<_}function he(e,t){_=Number.POSITIVE_INFINITY,S=void 0,g=ye.default.QUALITY_DEFAULT,w=Number.POSITIVE_INFINITY,x=null,C=R=v=!1,M=y=E=0,D=[],A&&(e||A.abort(),A.reset(t),A=null),I=!1}return p={getBufferControllerType:function(){return Pe},initialize:function(e){ce(e),g=s.getQualityFor(c,d.getStreamInfo()),a.on(Ee.default.DATA_UPDATE_COMPLETED,oe,this),a.on(Ee.default.INIT_FRAGMENT_LOADED,k,this),a.on(Ee.default.MEDIA_FRAGMENT_LOADED,F,this),a.on(Ee.default.QUALITY_CHANGE_REQUESTED,G,this),a.on(Ee.default.STREAM_COMPLETED,ae,this),a.on(Ee.default.PLAYBACK_PLAYING,Y,this),a.on(Ee.default.PLAYBACK_PROGRESS,W,this),a.on(Ee.default.PLAYBACK_TIME_UPDATED,W,this),a.on(Ee.default.PLAYBACK_RATE_CHANGED,le,this),a.on(Ee.default.PLAYBACK_SEEKING,H,this),a.on(Ee.default.PLAYBACK_SEEKED,V,this),a.on(Ee.default.PLAYBACK_STALLED,q,this),a.on(Ee.default.WALLCLOCK_TIME_UPDATED,ue,this),a.on(Ee.default.CURRENT_TRACK_CHANGED,se,this,be.default.EVENT_PRIORITY_HIGH),a.on(Ee.default.SOURCEBUFFER_REMOVE_COMPLETED,ne,this)},createBuffer:N,dischargePreBuffer:function(){if(A&&T&&"function"==typeof T.discharge){var e=T.getAllBufferRanges();if(0<e.length){for(var t="Beginning "+c+"PreBuffer discharge, adding buffer for:",r=0;r<e.length;r++)t+=" start: "+e.start(r)+", end: "+e.end(r)+";";m.debug(t)}else m.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");for(var n=T.discharge(),i=null,o=0;o<n.length;o++){var a=n[o],s=O.extract(a.streamId,a.representationId);s&&(i!==s&&(A.append(s),i=s),A.append(a))}T.reset(),T=null}},getType:function(){return c},getStreamProcessor:function(){return d},setSeekStartTime:function(e){P=e},getBuffer:function(){return A},setBuffer:function(e){A=e},getBufferLevel:function(){return y},getRangeAt:K,setMediaSource:ce,getMediaSource:function(){return b},getIsBufferingCompleted:function(){return v},switchInitData:function(e,t,r){var n=O.extract(e,t);I=!0===r&&r,n?(m.info("Append Init fragment",c," with representationId:",n.representationId," and quality:",n.quality,", data size:",n.bytes.byteLength),j(n)):a.trigger(Ee.default.INIT_REQUESTED,{sender:p})},getIsPruningInProgress:function(){return R},reset:function(e,t){a.off(Ee.default.DATA_UPDATE_COMPLETED,oe,this),a.off(Ee.default.QUALITY_CHANGE_REQUESTED,G,this),a.off(Ee.default.INIT_FRAGMENT_LOADED,k,this),a.off(Ee.default.MEDIA_FRAGMENT_LOADED,F,this),a.off(Ee.default.STREAM_COMPLETED,ae,this),a.off(Ee.default.CURRENT_TRACK_CHANGED,se,this),a.off(Ee.default.PLAYBACK_PLAYING,Y,this),a.off(Ee.default.PLAYBACK_PROGRESS,W,this),a.off(Ee.default.PLAYBACK_TIME_UPDATED,W,this),a.off(Ee.default.PLAYBACK_RATE_CHANGED,le,this),a.off(Ee.default.PLAYBACK_SEEKING,H,this),a.off(Ee.default.PLAYBACK_SEEKED,V,this),a.off(Ee.default.PLAYBACK_STALLED,q,this),a.off(Ee.default.WALLCLOCK_TIME_UPDATED,ue,this),a.off(Ee.default.SOURCEBUFFER_REMOVE_COMPLETED,ne,this),he(e,t)}},m=(0,Ae.default)(f).getInstance().getLogger(p),O=(0,Te.default)(f).getInstance(),he(),p}o.__dashjs_factory_name=Pe;var a=i.default.getClassFactory(o);a.BUFFER_LOADED=Re,a.BUFFER_EMPTY=Oe,i.default.updateClassFactory(o.__dashjs_factory_name,a),r.default=a,t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/errors/Errors":349,"../../core/events/Events":352,"../PreBufferSink":395,"../SourceBufferSink":396,"../constants/Constants":400,"../models/FragmentModel":440,"../utils/BoxParser":496,"../utils/InitCache":502,"../vo/DashJSError":514,"../vo/metrics/HTTPRequest":534,"./AbrController":403,"./MediaController":409}],407:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),A=n(e("../../core/Debug")),T=n(e("../../core/EventBus")),S=n(e("../../core/events/Events")),x=n(e("../net/XHRLoader"));function o(){var l="urn:mpeg:dash:event:2012",c=1,d="urn:mpeg:dash:event:callback:2015",f=1,h=this.context,p=(0,T.default)(h).getInstance(),e=void 0,m=void 0,n=void 0,i=void 0,g=void 0,t=void 0,r=void 0,o=void 0,v=void 0,a=void 0,s=void 0;function u(){s=!1,n={},i={},g={},t=null,r=100,o=Date.now()/1e3}function y(){if(!v||!a)throw new Error("setConfig function has to be called previously")}function _(){null!==t&&s&&(clearInterval(t),t=null,s=!1)}function b(e){if(e.eventStream.value==c){var t=e.eventStream.timescale||1,r=e.presentationTime/t,n=void 0;n=4294967295==e.presentationTime?NaN:(e.presentationTime+e.duration)/t,m.info("Manifest validity changed: Valid until: "+r+"; remaining duration: "+n),p.trigger(S.default.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:r,newDuration:n,newManifestValidAfter:NaN})}}function E(){var e=a.getTime(),t=e-o;w(i,t,o=e),w(n,t,e),function(){if(g)for(var e=a.getTime(),t=Object.keys(g),r=0;r<t.length;r++){var n=t[r],i=g[n];null!==i&&(i.duration+i.presentationTime)/i.eventStream.timescale<e&&(m.debug("Remove Event "+n+" at time "+e),i=null,delete g[n])}}()}function w(e,t,r){var n,i;if(e)for(var o=Object.keys(e),a=0;a<o.length;a++){var s=o[a],u=e[s];void 0!==u&&(0==(n=u.presentationTime/u.eventStream.timescale)||n<=r&&r<n+t)&&(m.debug("Start Event "+s+" at "+r),0<u.duration&&(g[s]=u),u.eventStream.schemeIdUri==l&&u.eventStream.value==c?0===u.duration&&0===u.presentationTimeDelta||(y(),v.refreshManifest()):u.eventStream.schemeIdUri==d&&u.eventStream.value==f?(i=u.messageData,(0,x.default)(h).create({}).load({method:"get",url:i,request:{responseType:"arraybuffer"}})):p.trigger(u.eventStream.schemeIdUri,{event:u}),delete e[s])}}return e={addInlineEvents:function(e){if(y(),n={},e)for(var t=0;t<e.length;t++){var r=e[t];n[r.id]=r,m.debug("Add inline event with id "+r.id)}m.debug("Added "+e.length+" inline events")},addInbandEvents:function(e){y();for(var t=0;t<e.length;t++){var r=e[t];r.id in i?m.debug("Repeated event with id "+r.id):(r.eventStream.schemeIdUri===l&&void 0===i[r.id]&&b(r),i[r.id]=r,m.debug("Add inband event with id "+r.id))}},stop:_,start:function(){y(),m.debug("Start Event Controller"),s||isNaN(r)||(s=!0,t=setInterval(E,r))},setConfig:function(e){e&&(e.manifestUpdater&&(v=e.manifestUpdater),e.playbackController&&(a=e.playbackController))},reset:function(){_(),u()}},m=(0,A.default)(h).getInstance().getLogger(e),u(),e}o.__dashjs_factory_name="EventController",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../net/XHRLoader":448}],408:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var f=n(e("../constants/Constants")),h=e("../vo/metrics/HTTPRequest"),p=n(e("../vo/DataChunk")),m=n(e("../models/FragmentModel")),g=n(e("../FragmentLoader")),v=n(e("../utils/RequestModifier")),y=n(e("../../core/EventBus")),_=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),b=n(e("../../core/Debug"));function o(e){e=e||{};var r=this.context,a=(0,y.default)(r).getInstance(),n=e.errHandler,i=e.mediaPlayerModel,o=e.metricsModel,t=void 0,s=void 0,u=void 0;function l(e){return e&&e.type&&e.type===h.HTTPRequest.INIT_SEGMENT_TYPE}function c(){for(var e in u)u[e].reset();u={}}function d(e){if(u[e.request.mediaType]===e.sender){var t=e.request,r=e.response,n=l(t),i=t.mediaInfo.streamInfo;if(e.error&&(e.request.mediaType!==f.default.AUDIO&&e.request.mediaType!==f.default.VIDEO&&e.request.mediaType!==f.default.FRAGMENTED_TEXT||a.trigger(_.default.SERVICE_LOCATION_BLACKLIST_ADD,{entry:e.request.serviceLocation})),r&&i){var o=function(e,t,r,n){var i=new p.default;return i.streamId=r,i.mediaInfo=t.mediaInfo,i.segmentType=t.type,i.start=t.startTime,i.duration=t.duration,i.end=i.start+i.duration,i.bytes=e,i.index=t.index,i.quality=t.quality,i.representationId=t.representationId,i.endFragment=n,i}(r,t,i.id,e.type!==_.default.FRAGMENT_LOADING_PROGRESS);a.trigger(n?_.default.INIT_FRAGMENT_LOADED:_.default.MEDIA_FRAGMENT_LOADED,{chunk:o,fragmentModel:e.sender})}else s.warn("No "+t.mediaType+" bytes to push or stream is inactive.")}}return t={getModel:function(e){var t=u[e];return t||(t=(0,m.default)(r).create({metricsModel:o,fragmentLoader:(0,g.default)(r).create({metricsModel:o,mediaPlayerModel:i,errHandler:n,requestModifier:(0,v.default)(r).getInstance()})}),u[e]=t),t},isInitializationRequest:l,reset:function(){a.off(_.default.FRAGMENT_LOADING_COMPLETED,d,this),a.off(_.default.FRAGMENT_LOADING_PROGRESS,d,this),c()}},s=(0,b.default)(r).getInstance().getLogger(t),c(),a.on(_.default.FRAGMENT_LOADING_COMPLETED,d,t),a.on(_.default.FRAGMENT_LOADING_PROGRESS,d,t),t}o.__dashjs_factory_name="FragmentController",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../FragmentLoader":389,"../constants/Constants":400,"../models/FragmentModel":440,"../utils/RequestModifier":506,"../vo/DataChunk":515,"../vo/metrics/HTTPRequest":534}],409:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var w=n(e("../constants/Constants")),A=n(e("../../core/events/Events")),T=n(e("../../core/EventBus")),i=n(e("../../core/FactoryMaker")),S=n(e("../../core/Debug")),x="neverReplace",M="alwaysReplace",R="highestBitrate",O="widestRange",P=R;function o(){var e=this.context,a=(0,T.default)(e).getInstance(),t=void 0,o=void 0,s=void 0,r=void 0,n=void 0,u=void 0,l=void 0,i=[M,x],c=[R,O];function d(e,t){if(!e||!t)return[];var r=t.id;return s[r]&&s[r][e]?s[r][e].list:[]}function f(e,t){return!e||!t||t&&!s[t.id]?null:s[t.id][e].current}function h(e){if(e&&e.streamInfo){var t=e.type,r=e.streamInfo,n=r.id,i=f(t,r);if(s[n]&&s[n][t]&&!y(e,i)){s[n][t].current=e,s[n][t].current&&a.trigger(A.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:i,newMediaInfo:e,switchMode:u[t]});var o=function(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration};return t.lang||t.viewpoint||t.role&&0<t.role.length||t.accessibility&&0<t.accessibility.length||t.audioChannelConfiguration&&0<t.audioChannelConfiguration.length?t:null}(e);o&&s[n][t].storeLastSettings&&(o.roles&&(o.role=o.roles[0],delete o.roles),o.accessibility&&(o.accessibility=o.accessibility[0]),o.audioChannelConfiguration&&(o.audioChannelConfiguration=o.audioChannelConfiguration[0]),l.setSavedMediaSettings(t,o))}}}function p(e,t){e&&t&&(r[e]=t)}function m(e){return e?r[e]:null}function g(){return n||P}function v(e){return e===w.default.AUDIO||e===w.default.VIDEO||e===w.default.TEXT||e===w.default.FRAGMENTED_TEXT||e===w.default.IMAGE}function y(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var r=e.id===t.id,n=e.viewpoint===t.viewpoint,i=e.lang===t.lang,o=e.roles.toString()===t.roles.toString(),a=e.accessibility.toString()===t.accessibility.toString(),s=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return r&&n&&i&&o&&a&&s}function _(){s={},r={audio:null,video:null},u={audio:M,video:x}}function b(t,e){var r=!t.lang||t.lang===e.lang,n=!t.viewpoint||t.viewpoint===e.viewpoint,i=!t.role||!!e.roles.filter(function(e){return e===t.role})[0],o=!t.accessibility||!!e.accessibility.filter(function(e){return e===t.accessibility})[0],a=!t.audioChannelConfiguration||!!e.audioChannelConfiguration.filter(function(e){return e===t.audioChannelConfiguration})[0];return r&&n&&i&&o&&a}function E(e){function t(e){var t=0,r=[],n=void 0;return e.forEach(function(e){n=Math.max.apply(Math,e.bitrateList.map(function(e){return e.bandwidth})),t<n?(t=n,r=[e]):n===t&&r.push(e)}),r}function r(e){var t=0,r=[],n=void 0;return e.forEach(function(e){n=e.representationCount,t<n?(t=n,r=[e]):n===t&&r.push(e)}),r}var n=g(),i=[];switch(n){case R:1<(i=t(e)).length&&(i=r(i));break;case O:1<(i=r(e)).length&&(i=t(e));break;default:o.warn("Track selection mode is not supported: "+n)}return i[0]}return t={checkInitialMediaSettingsForType:function(e,t){var r=m(e),n=d(e,t),i=[];e!==w.default.FRAGMENTED_TEXT?(r||p(e,r=l.getSavedMediaSettings(e)),n&&0!==n.length&&(r&&n.forEach(function(e){b(r,e)&&i.push(e)}),0===i.length?h(E(n)):1<i.length?h(E(i)):h(i[0]))):h(n[0])},addTrack:function(e){if(e){var t=e.type;if(v(t)){var r=e.streamInfo.id;s[r]||(s[r]={audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}});for(var n=s[r][t].list,i=0,o=n.length;i<o;++i)if(y(n[i],e))return;n.push(e);var a=m(t);a&&b(a,e)&&!f(t,e.streamInfo)&&h(e)}}},getTracksFor:d,getCurrentTrackFor:f,isCurrentTrack:function(e){if(!e)return!1;var t=e.type,r=e.streamInfo.id;return s[r]&&s[r][t]&&y(s[r][t].current,e)},setTrack:h,setInitialSettings:p,getInitialSettings:m,setSwitchMode:function(e,t){-1!==i.indexOf(t)?u[e]=t:o.warn("Track switch mode is not supported: "+t)},getSwitchMode:function(e){return u[e]},setSelectionModeForInitialTrack:function(e){-1!==c.indexOf(e)?n=e:o.warn("Track selection mode is not supported: "+e)},getSelectionModeForInitialTrack:g,isMultiTrackSupportedByType:v,isTracksEqual:y,setConfig:function(e){e&&e.domStorage&&(l=e.domStorage)},reset:_},o=(0,S.default)(e).getInstance().getLogger(t),_(),t}o.__dashjs_factory_name="MediaController";var a=i.default.getSingletonFactory(o);a.TRACK_SWITCH_MODE_NEVER_REPLACE=x,a.TRACK_SWITCH_MODE_ALWAYS_REPLACE=M,a.TRACK_SELECTION_MODE_HIGHEST_BITRATE=R,a.TRACK_SELECTION_MODE_WIDEST_RANGE=O,a.DEFAULT_INIT_TRACK_SELECTION_MODE=P,i.default.updateSingletonFactory(o.__dashjs_factory_name,a),r.default=a,t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../constants/Constants":400}],410:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),o=n(e("../../core/Debug"));function a(){var e=void 0,i=void 0,t=this.context;return e={createMediaSource:function(){var e="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:e?new WebKitMediaSource:null},attachMediaSource:function(e,t){var r=window.URL.createObjectURL(e);return t.setSource(r),r},detachMediaSource:function(e){e.setSource(null)},setDuration:function(e,t){return e.duration!=t&&(e.duration=t),e.duration},setSeekable:function(e,t,r){e&&"function"==typeof e.setLiveSeekableRange&&"function"==typeof e.clearLiveSeekableRange&&"open"===e.readyState&&0<=t&&t<r&&(e.clearLiveSeekableRange(),e.setLiveSeekableRange(t,r))},signalEndOfStream:function(e){var t=e.sourceBuffers,r=t.length;if("open"===e.readyState){for(var n=0;n<r;n++){if(t[n].updating)return;if(0===t[n].buffered.length)return}i.info("call to mediaSource endOfStream"),e.endOfStream()}}},i=(0,o.default)(t).getInstance().getLogger(e),e}a.__dashjs_factory_name="MediaSourceController",r.default=i.default.getSingletonFactory(a),t.exports=r.default},{"../../core/Debug":345,"../../core/FactoryMaker":347}],411:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var me=n(e("../constants/Constants")),ge=n(e("./BufferController")),ve=n(e("../../core/EventBus")),ye=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),_e=n(e("../../core/Debug"));function o(){var e=this.context,i=(0,ve.default)(e).getInstance(),t=void 0,s=void 0,u=void 0,l=void 0,c=void 0,a=void 0,d=void 0,r=void 0,f=void 0,n=void 0,h=void 0,o=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,_=void 0,b=void 0,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,M=void 0;function R(e){!y&&e.fromStreamInfo&&void 0!==p[e.fromStreamInfo.id]&&(delete g[e.fromStreamInfo.id],delete p[e.fromStreamInfo.id])}function O(){return parseFloat((P()-k()).toFixed(5))}function P(){var e=z(!0),t=y&&v?e-v.start:0;return e+(v?v.duration-t:t)}function C(){v&&f&&f.getElement()?f.play():b=!0}function D(){return v&&f?f.isPaused():null}function I(){v&&f&&f.pause()}function L(){return v&&f?f.isSeeking():null}function N(e,t,r){v&&f&&(!0===r?e!==f.getTime()&&(f.removeEventListener("seeking",ee),s.info("Requesting seek to time: "+e),f.setCurrentTime(e,t)):(i.trigger(ye.default.PLAYBACK_SEEK_ASKED),s.info("Requesting seek to time: "+e),f.setCurrentTime(e,t)))}function k(){return v&&f?f.getTime():null}function F(){var e=k();if(y&&!isNaN(w)){var t=w/1e3;t<e&&(e-=t)}return e}function j(){return v&&f?f.getPlaybackRate():null}function B(){return v&&f?f.getEnded():null}function U(){return y}function G(){if(!y||isNaN(w))return NaN;var e=F();if(isNaN(e)||0===e)return 0;var t=(new Date).getTime()+1e3*n.getClientTimeOffset();return Math.max(((t-w-1e3*e)/1e3).toFixed(3),0)}function H(){h=NaN,b=!1,p={},w=m=0,g={},f&&(i.off(ye.default.DATA_UPDATE_COMPLETED,K,this),i.off(ye.default.BUFFER_LEVEL_STATE_CHANGED,he,this),i.off(ye.default.BYTES_APPENDED_END_FRAGMENT,de,this),i.off(ye.default.LOADING_PROGRESS,fe,this),i.off(ye.default.PERIOD_SWITCH_STARTED,R,this),i.off(ye.default.PLAYBACK_PROGRESS,le,this),i.off(ye.default.PLAYBACK_TIME_UPDATED,le,this),i.off(ye.default.PLAYBACK_ENDED,se,this),q(),f.removeEventListener("canplay",X),f.removeEventListener("play",Q),f.removeEventListener("waiting",J),f.removeEventListener("playing",Z),f.removeEventListener("pause",$),f.removeEventListener("error",ue),f.removeEventListener("seeking",ee),f.removeEventListener("seeked",te),f.removeEventListener("timeupdate",re),f.removeEventListener("progress",ne),f.removeEventListener("ratechange",ie),f.removeEventListener("loadedmetadata",oe),f.removeEventListener("stalled",pe),f.removeEventListener("ended",ae)),y=v=f=o=null}function V(){var e=M.getURIFragmentData(),t=void 0;if(e){t={};var r=parseInt(e.r,10);0<=r&&v&&r<v.manifestInfo.DVRWindowSize&&null===e.t&&(e.t=Math.max(Math.floor(Date.now()/1e3)-v.manifestInfo.DVRWindowSize,v.manifestInfo.availableFrom.getTime()/1e3+v.start)+r),t.fragS=parseFloat(e.s),t.fragT=parseFloat(e.t)}return t}function z(e,t){var r=void 0,n=NaN;if(e)n=v?v.start:n;else{var i=V();n=i?isNaN(i.fragS)?i.fragT:i.fragS:0}if(y)!isNaN(n)&&v&&(r=n-v.manifestInfo.availableFrom.getTime()/1e3,(h<r||r<(isNaN(t)?NaN:t-v.manifestInfo.DVRWindowSize))&&(r=null)),r=r||h;else if(v)if(!isNaN(n)&&n<Math.max(v.manifestInfo.duration,v.duration)&&0<=n)r=n;else{var o=p[v.id];r=void 0!==o?Math.max(void 0!==o.audio?o.audio:0,void 0!==o.video?o.video:0,v.start):v.start}return r}function W(){if(null===o){o=setInterval(function(){i.trigger(ye.default.WALLCLOCK_TIME_UPDATED,{isDynamic:y,time:new Date}),U()&&D()&&function(){var e=Date.now();(!E||E+500<e)&&(E=e,re())}()},_.getWallclockTimeUpdateInterval())}}function q(){clearInterval(o),o=null}function Y(){if(!D()&&y&&0!==f.getReadyState()){var e=F(),t=function(e){var t=l.getReadOnlyMetricsFor(me.default.VIDEO)||l.getReadOnlyMetricsFor(me.default.AUDIO),r=c.getCurrentDVRInfo(t),n=r?r.range:null,i=void 0;if(!n)return NaN;if(e>n.end)i=Math.max(n.end-2*v.manifestInfo.minBufferTime,n.start);else{if(!(e+.25<n.start))return e;i=n.start}return i}(e);!isNaN(t)&&t!==e&&N(t)}}function K(e){if(!e.error){var t=r.convertDataToRepresentationInfo(e.currentRepresentation).mediaInfo.streamInfo;v.id===t.id&&(v=t,Y())}}function X(){i.trigger(ye.default.CAN_PLAY)}function Q(){s.info("Native video element event: play"),Y(),W(),i.trigger(ye.default.PLAYBACK_STARTED,{startTime:k()})}function J(){s.info("Native video element event: waiting"),i.trigger(ye.default.PLAYBACK_WAITING,{playingTime:k()})}function Z(){s.info("Native video element event: playing"),i.trigger(ye.default.PLAYBACK_PLAYING,{playingTime:k()})}function $(){s.info("Native video element event: pause"),i.trigger(ye.default.PLAYBACK_PAUSED,{ended:B()})}function ee(){var e=k();s.info("Seeking to: "+e),W(),i.trigger(ye.default.PLAYBACK_SEEKING,{seekTime:e})}function te(){s.info("Native video element event: seeked"),i.trigger(ye.default.PLAYBACK_SEEKED),f.addEventListener("seeking",ee)}function re(){v&&i.trigger(ye.default.PLAYBACK_TIME_UPDATED,{timeToEnd:O(),time:k()})}function ne(){i.trigger(ye.default.PLAYBACK_PROGRESS)}function ie(){var e=j();s.info("Native video element event: ratechange: ",e),i.trigger(ye.default.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function oe(){s.info("Native video element event: loadedmetadata"),i.trigger(ye.default.PLAYBACK_METADATA_LOADED),W()}function ae(){s.info("Native video element event: ended"),I(),q(),i.trigger(ye.default.PLAYBACK_ENDED,{isLast:u.getActiveStreamInfo().isLast})}function se(e){o&&e.isLast&&(s.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended"),f.setCurrentTime(P()),I(),q())}function ue(e){var t=e.target||e.srcElement;i.trigger(ye.default.PLAYBACK_ERROR,{error:t.error})}function le(){y&&_.getLowLatencyEnabled()&&0<_.getCatchUpPlaybackRate()&&!D()&&!L()&&(0<_.getCatchUpPlaybackRate()&&0<k()&&Math.abs(G()-_.getLiveDelay())>_.getLowLatencyMinDrift()?function(){if(f){var e=_.getCatchUpPlaybackRate(),t=_.getLiveDelay(),r=G()-t,n=5*r,i=2*e/(1+Math.pow(Math.E,-n)),o=1-e+i;if(S){var a=function(){var r=null;return u.getActiveStreamProcessors().forEach(function(e){var t=e.getBufferLevel();r=null===r?t:Math.min(r,t)}),r}();t/2<a?S=!1:0<r&&(o=1)}Math.abs(f.getPlaybackRate()-o)>x&&f.setPlaybackRate(o),0<_.getLowLatencyMaxDriftBeforeSeeking()&&!T&&r>_.getLowLatencyMaxDriftBeforeSeeking()?(s.info("Low Latency catchup mechanism. Latency too high, doing a seek to live point"),T=!0,function(){var e=l.getReadOnlyMetricsFor(me.default.VIDEO)||l.getReadOnlyMetricsFor(me.default.AUDIO),t=c.getCurrentDVRInfo(e);N((t?t.range:null).end-_.getLiveDelay(),!0,!1)}()):T=!1}}():ce())}function ce(){f&&f.setPlaybackRate(1)}function de(e){var t,r=void 0,n=e.bufferedRanges;if(n&&n.length&&(!p[v.id]||!0!==p[v.id].started)){var i=e.sender.getType();void 0===g[v.id]&&(g[v.id]=[]),g[v.id][i]=n,void 0===p[v.id]&&(p[v.id]=[],p[v.id].started=!1),void 0===p[v.id][i]&&(p[v.id][i]=Math.max(n.start(0),v.start));var o=u.isTrackTypePresent(me.default.VIDEO),a=u.isTrackTypePresent(me.default.AUDIO);t=z(!1),a&&o?isNaN(p[v.id].audio)||isNaN(p[v.id].video)||(n=p[v.id].audio<p[v.id].video?(r=p[v.id].video>t?p[v.id].video:t,g[v.id].audio):(r=p[v.id].audio>t?p[v.id].audio:t,g[v.id].video),function(e,t){if(t&&0<t.length)for(var r=0,n=t.length;r<n;r++)if(e>=t.start(r)&&e<t.end(r))return!0;return!1}(r,n)&&(L()||A||0===r||N(r,!0,!0),p[v.id].started=!0)):p[v.id][i]&&(r=p[v.id][i]>t?p[v.id][i]:t,L()||A||N(r,!1,!0),p[v.id].started=!0)}}function fe(e){if(!1===e.stream&&_.getLowLatencyEnabled()&&!isNaN(e.request.duration)){var t=1.2*e.request.duration;t>_.getLiveDelay()&&(s.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",t.toFixed(2)),_.setLiveDelay(t))}}function he(e){e.streamInfo.id===v.id&&(_.getLowLatencyEnabled()?e.state!==ge.default.BUFFER_EMPTY||L()||S||(S=!0,ce()):f.setStallState(e.mediaType,e.state===ge.default.BUFFER_EMPTY))}function pe(e){i.trigger(ye.default.PLAYBACK_STALLED,{e:e})}return t={initialize:function(e,t){v=e,f.addEventListener("canplay",X),f.addEventListener("play",Q),f.addEventListener("waiting",J),f.addEventListener("playing",Z),f.addEventListener("pause",$),f.addEventListener("error",ue),f.addEventListener("seeking",ee),f.addEventListener("seeked",te),f.addEventListener("timeupdate",re),f.addEventListener("progress",ne),f.addEventListener("ratechange",ie),f.addEventListener("loadedmetadata",oe),f.addEventListener("stalled",pe),f.addEventListener("ended",ae),y=v.manifestInfo.isDynamic,S=T=!1,h=v.start,A=t;var r="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",n=/safari/.test(r)&&!/chrome/.test(r);x=n?.25:.02,i.on(ye.default.DATA_UPDATE_COMPLETED,K,this),i.on(ye.default.BYTES_APPENDED_END_FRAGMENT,de,this),i.on(ye.default.LOADING_PROGRESS,fe,this),i.on(ye.default.BUFFER_LEVEL_STATE_CHANGED,he,this),i.on(ye.default.PERIOD_SWITCH_STARTED,R,this),i.on(ye.default.PLAYBACK_PROGRESS,le,this),i.on(ye.default.PLAYBACK_TIME_UPDATED,le,this),i.on(ye.default.PLAYBACK_ENDED,se,this),b&&(b=!1,C())},setConfig:function(e){e&&(e.streamController&&(u=e.streamController),e.metricsModel&&(l=e.metricsModel),e.dashMetrics&&(c=e.dashMetrics),e.manifestModel&&(a=e.manifestModel),e.dashManifestModel&&(d=e.dashManifestModel),e.mediaPlayerModel&&(_=e.mediaPlayerModel),e.adapter&&(r=e.adapter),e.videoModel&&(f=e.videoModel),e.timelineConverter&&(n=e.timelineConverter),e.uriFragmentModel&&(M=e.uriFragmentModel))},getStartTimeFromUriParameters:V,getStreamStartTime:z,getTimeToStreamEnd:O,getTime:k,getNormalizedTime:F,getPlaybackRate:j,getPlayedRanges:function(){return v&&f?f.getPlayedRanges():null},getEnded:B,getIsDynamic:U,getStreamController:function(){return u},setLiveStartTime:function(e){h=e},getLiveStartTime:function(){return h},computeLiveDelay:function(e,t){var r=d.getMpd(a.getValue()),n=void 0,i=void 0;if(n=_.getUseSuggestedPresentationDelay()&&r.hasOwnProperty(me.default.SUGGESTED_PRESENTATION_DELAY)?r.suggestedPresentationDelay:_.getLowLatencyEnabled()?0:_.getLiveDelay()?_.getLiveDelay():isNaN(e)?2*v.manifestInfo.minBufferTime:e*_.getLiveDelayFragmentCount(),r.availabilityStartTime&&(w=r.availabilityStartTime.getTime()),0<t){var o=Math.max(t-10,t/2);i=Math.min(n,o)}else i=n;return m=i},getLiveDelay:function(){return m},getCurrentLiveLatency:G,play:C,isPaused:D,pause:I,isSeeking:L,seek:N,reset:H},s=(0,_e.default)(e).getInstance().getLogger(t),H(),t}o.__dashjs_factory_name="PlaybackController",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../constants/Constants":400,"./BufferController":406}],412:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var ge=n(e("../constants/Constants")),ve=e("../vo/metrics/PlayList"),ye=n(e("./AbrController")),_e=n(e("./BufferController")),be=n(e("../rules/scheduling/BufferLevelRule")),Ee=n(e("../rules/scheduling/NextFragmentRequestRule")),we=n(e("../models/FragmentModel")),Ae=n(e("../../core/EventBus")),Te=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),Se=n(e("../../core/Debug")),xe=n(e("./MediaController")),Me=e("../../dash/utils/SegmentsUtils");function o(e){e=e||{};var t=this.context,r=(0,Ae.default)(t).getInstance(),s=e.metricsModel,u=e.adapter,l=e.dashMetrics,c=e.dashManifestModel,d=e.timelineConverter,f=e.mediaPlayerModel,h=e.abrController,p=e.playbackController,i=e.streamController,o=e.textController,m=e.type,g=e.streamProcessor,v=e.mediaController,n=void 0,y=void 0,_=void 0,b=void 0,a=void 0,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,M=void 0,R=void 0,O=void 0,P=void 0,C=void 0,D=void 0,I=void 0,L=void 0,N=void 0,k=void 0,F=void 0,j=void 0;function B(){b&&!g.isBufferingCompleted()?(y.debug("Schedule Controller starts"),pe(),E=!1,a=a&&!1,H(0)):y.warn("Start denied to Schedule Controller")}function U(){E||(y.debug("Schedule Controller stops"),E=!0,clearTimeout(M))}function G(){var e=g.getBufferController();if(E||S||!e||p.isPaused()&&!f.getScheduleWhilePaused()||!(m!==ge.default.FRAGMENTED_TEXT&&m!==ge.default.TEXT||o.isTextEnabled()))y.debug("Schedule stop!");else if(e.getIsBufferingCompleted())y.debug("Schedule stop because buffering is completed!");else{!function(){var e=p.getTime(),t=1.5*b.fragmentDuration,r=_.getRequests({state:we.default.FRAGMENT_MODEL_EXECUTED,time:e+t,threshold:0})[0];if(r&&-1===L.indexOf(r)&&!c.getIsTextTrack(m)){var n=f.getFastSwitchEnabled(),i=g.getBufferLevel(),o=h.getAbandonmentStateFor(m),a=!v.isCurrentTrack(r.mediaInfo)&&v.getSwitchMode(r.mediaInfo.type)===xe.default.TRACK_SWITCH_MODE_NEVER_REPLACE,s=r.quality<b.quality;n&&(a||s)&&t<=i&&o!==ye.default.ABANDON_LOAD?(q(r),j=!0,y.debug("Reloading outdated fragment at index: ",r.index)):r.quality>b.quality&&!k&&de(p.getTime()+g.getBufferLevel())}}();var t=0<L.length,n=g.getStreamInfo();if(k||isNaN(I)||N||t||function(e,t){D[t]=D[t]||{};var r=h.getTopQualityIndexFor(e,t);return D[t][e]!=r&&(y.info("Top quality "+e+" index has changed from "+D[t][e]+" to "+r),D[t][e]=r,!0)}(b.mediaInfo.type,n.id)||O.execute(g,i.isTrackTypePresent(ge.default.VIDEO))){z(!0),t||N||h.checkPlaybackQuality(m),function(){var e=g.getFragmentController();if(b.quality===I&&!N||k){var t=L.shift();if(e.isInitializationRequest(t))g.switchInitData(t.representationId);else{var r=void 0;g.getBufferController().getIsPruningInProgress()||(r=P.execute(g,R,t),de(NaN),r&&!t&&(isNaN(r.startTime+r.duration)||u.setIndexHandlerTime(g,r.startTime+r.duration),r.delayLoadingTime=(new Date).getTime()+x,fe(0)),!r&&n.manifestInfo&&n.manifestInfo.isDynamic&&y.debug("Next fragment seems to be at the bleeding live edge and is not available yet. Rescheduling.")),r?(y.debug("Next fragment request url is "+r.url),_.executeRequest(r)):(z(!1),H(f.getLowLatencyEnabled()?100:500))}}else y.debug("Quality has changed, get init request for representationid = "+b.id),N?(k=v.getSwitchMode(m)===xe.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,y.debug("Switch track has been asked, get init request for "+m+" with representationid = "+b.id+"bufferResetInProgress = "+k),g.switchInitData(b.id,k),N=!1):g.switchInitData(b.id),I=b.quality}()}else H(500)}}function H(e){clearTimeout(M),M=setTimeout(G,e)}function V(e){e.sender&&e.sender.getStreamProcessor()===g&&W(b.quality)}function z(e){S!==e?S=e:y.debug("isFragmentProcessingInProgress is already equal to",e)}function W(e){var t=u.getInitRequest(g,e);t&&(z(!0),t.url=(0,Me.replaceTokenForTemplate)(t.url,"Bandwidth",b?b.bandwidth:null),_.executeRequest(t))}function q(e){L.push(e)}function Y(e){if(m===e.mediaType&&g.getStreamInfo().id===e.streamInfo.id){if(null==(b=g.getRepresentationInfo(e.newQuality)))throw new Error("Unexpected error! - currentRepresentationInfo is null or undefined");he(new Date,ve.PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON),pe()}}function K(e){if(p&&_){var t=_.getRequests({state:we.default.FRAGMENT_MODEL_EXECUTED,time:p.getTime(),threshold:0})[0];t&&p.getTime()>=t.startTime&&((!C.mediaInfo||t.mediaInfo.type===C.mediaInfo.type&&t.mediaInfo.id!==C.mediaInfo.id)&&e&&r.trigger(Te.default.TRACK_CHANGE_RENDERED,{mediaType:m,oldMediaInfo:C.mediaInfo,newMediaInfo:t.mediaInfo}),t.quality===C.quality&&t.adaptationIndex===C.adaptationIndex||!e||r.trigger(Te.default.QUALITY_CHANGE_RENDERED,{mediaType:m,oldQuality:C.quality,newQuality:t.quality}),C={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function X(e){e.error||e.sender.getStreamProcessor()!==g||(b=u.convertDataToRepresentationInfo(e.currentRepresentation))}function Q(e){e.error||g.getStreamInfo().id!==e.streamInfo.id||(b=g.getRepresentationInfo(),a&&(p.getIsDynamic()?(d.setTimeSyncCompleted(!0),function(){var e=g.getLiveEdgeFinder();if(e){var t=e.getLiveEdge(),r=b.mediaInfo.streamInfo.manifestInfo.DVRWindowSize/2,n=t-p.computeLiveDelay(b.fragmentDuration,r),i=u.getFragmentRequest(g,b,n,{ignoreIsFinished:!0});if(i)if(f.getLowLatencyEnabled()){var o=i.duration<f.getLiveDelay()?i.startTime:i.startTime+i.duration-f.getLiveDelay();p.setLiveStartTime(o)}else p.setLiveStartTime(i.startTime);else y.debug("setLiveEdgeSeekTarget : getFragmentRequest returned undefined request object");R=p.getStreamStartTime(!1,t),g.getBufferController().setSeekStartTime(R),R>b.mediaInfo.streamInfo.start+b.mediaInfo.streamInfo.duration&&p.seek(R);var a=l.getCurrentManifestUpdate(s.getMetricsFor(ge.default.STREAM));s.updateManifestUpdateInfo(a,{currentTime:R,presentationStartTime:t,latency:t-R,clientTimeOffset:d.getClientTimeOffset()})}}()):(R=p.getStreamStartTime(!1),g.getBufferController().setSeekStartTime(R))),E&&B())}function J(e){e.fragmentModel===_&&(U(),z(!1),y.info("Stream is complete"))}function Z(e){e.sender===_&&(y.info("OnFragmentLoadingCompleted - Url:",e.request?e.request.url:"undefined",", Range:",e.request.range?e.request.range:"undefined"),c.getIsTextTrack(m)&&z(!1),e.error&&e.request.serviceLocation&&!E&&(q(e.request),z(!1),H(0)),k&&(F=e.request))}function $(){K(!0)}function ee(e){if(e.sender.getStreamProcessor()===g)if(k&&!isNaN(e.startTime)&&(k=!1,_.addExecutedRequest(F)),z(!1),j&&!isNaN(e.startTime)){var t=p.getTime(),r=e.startTime+b.fragmentDuration,n=1.5*b.fragmentDuration;H(r<=t+n?0:1e3*(r-(t+n))),j=!1}else H(0)}function te(e){e.streamProcessor===g&&(y.info("onFragmentLoadingAbandoned for "+m+", request: "+e.request.url+" has been aborted"),p.isSeeking()||N||(y.info("onFragmentLoadingAbandoned for "+m+", request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),q(e.request)),z(!1),H(0))}function re(e){e.sender.getStreamProcessor()===g&&U()}function ne(e){if(e.sender.getStreamProcessor()===g){var t=g.getStreamInfo();t&&(e.unintended?_.removeExecutedRequestsAfterTime(e.from,t.duration):_.syncExecutedRequestsWithBufferedRange(g.getBufferController().getBuffer().getAllBufferRanges(),t.duration)),e.hasEnoughSpaceToAppend&&E&&B()}}function ie(e){e.sender.getStreamProcessor()!==g||e.state!==_e.default.BUFFER_EMPTY||p.isSeeking()||(y.info("Buffer is empty! Stalling!"),he(new Date,ve.PlayListTrace.REBUFFERING_REASON))}function oe(e){e.sender.getStreamProcessor()===g&&(U(),z(!1))}function ae(){_.abortRequests(),U()}function se(e){e.sender.getStreamProcessor()===g&&o.isTextEnabled()&&W(e.index)}function ue(){!E&&f.getScheduleWhilePaused()||B()}function le(e){R=e.seekTime,fe(0),E&&B();var t=l.getCurrentManifestUpdate(s.getMetricsFor(ge.default.STREAM)),r=b.DVRWindow&&p?b.DVRWindow.end-p.getTime():NaN;s.updateManifestUpdateInfo(t,{latency:r}),S?(y.debug("onPlaybackSeeking for "+m+", call fragmentModel.abortRequests in order to seek quicker"),_.abortRequests()):H(0)}function ce(e){A&&(A.playbackspeed=e.playbackRate.toString())}function de(e){R=e}function fe(e){x=e}function he(e,t){if(w&&!1===T){var r=A.start,n=e.getTime()-r.getTime();A.duration=n,A.stopreason=t,w.trace.push(A),T=!0}}function pe(){w&&!0===T&&b&&(T=!1,(A=new ve.PlayListTrace).representationid=b.id,A.start=new Date,A.mstart=1e3*p.getTime(),A.playbackspeed=p.getPlaybackRate().toString())}function me(){C={mediaInfo:void(x=0),quality:I=R=NaN,adaptationIndex:NaN},D={},F=A=w=null,j=k=N=!(E=a=T=!(S=!(L=[])))}return n={initialize:function(){_=g.getFragmentModel(),O=(0,be.default)(t).create({abrController:h,dashMetrics:l,metricsModel:s,mediaPlayerModel:f,textController:o}),P=(0,Ee.default)(t).create({adapter:u,textController:o,playbackController:p}),c.getIsTextTrack(e.mimeType)&&r.on(Te.default.TIMED_TEXT_REQUESTED,se,this),r.on(Te.default.QUALITY_CHANGE_REQUESTED,Y,this),r.on(Te.default.DATA_UPDATE_STARTED,re,this),r.on(Te.default.DATA_UPDATE_COMPLETED,X,this),r.on(Te.default.FRAGMENT_LOADING_COMPLETED,Z,this),r.on(Te.default.STREAM_COMPLETED,J,this),r.on(Te.default.STREAM_INITIALIZED,Q,this),r.on(Te.default.BUFFER_LEVEL_STATE_CHANGED,ie,this),r.on(Te.default.BUFFER_CLEARED,ne,this),r.on(Te.default.BYTES_APPENDED_END_FRAGMENT,ee,this),r.on(Te.default.INIT_REQUESTED,V,this),r.on(Te.default.QUOTA_EXCEEDED,oe,this),r.on(Te.default.PLAYBACK_SEEKING,le,this),r.on(Te.default.PLAYBACK_STARTED,ue,this),r.on(Te.default.PLAYBACK_RATE_CHANGED,ce,this),r.on(Te.default.PLAYBACK_TIME_UPDATED,$,this),r.on(Te.default.URL_RESOLUTION_FAILED,ae,this),r.on(Te.default.FRAGMENT_LOADING_ABANDONED,te,this)},getType:function(){return m},setSeekTarget:de,setTimeToLoadDelay:fe,replaceRequest:q,switchTrackAsked:function(){N=!0},isStarted:function(){return!1===E},start:B,stop:U,reset:function(){r.off(Te.default.DATA_UPDATE_STARTED,re,this),r.off(Te.default.DATA_UPDATE_COMPLETED,X,this),r.off(Te.default.BUFFER_LEVEL_STATE_CHANGED,ie,this),r.off(Te.default.QUALITY_CHANGE_REQUESTED,Y,this),r.off(Te.default.FRAGMENT_LOADING_COMPLETED,Z,this),r.off(Te.default.STREAM_COMPLETED,J,this),r.off(Te.default.STREAM_INITIALIZED,Q,this),r.off(Te.default.QUOTA_EXCEEDED,oe,this),r.off(Te.default.BYTES_APPENDED_END_FRAGMENT,ee,this),r.off(Te.default.BUFFER_CLEARED,ne,this),r.off(Te.default.INIT_REQUESTED,V,this),r.off(Te.default.PLAYBACK_RATE_CHANGED,ce,this),r.off(Te.default.PLAYBACK_SEEKING,le,this),r.off(Te.default.PLAYBACK_STARTED,ue,this),r.off(Te.default.PLAYBACK_TIME_UPDATED,$,this),r.off(Te.default.URL_RESOLUTION_FAILED,ae,this),r.off(Te.default.FRAGMENT_LOADING_ABANDONED,te,this),c.getIsTextTrack(m)&&r.off(Te.default.TIMED_TEXT_REQUESTED,se,this),U(),K(!1),me()},setPlayList:function(e){w=e},getBufferTarget:function(){return O.getBufferTarget(g,i.isTrackTypePresent(ge.default.VIDEO))},finalisePlayList:function(e,t){he(e,t),w=null}},y=(0,Se.default)(t).getInstance().getLogger(n),me(),n}o.__dashjs_factory_name="ScheduleController",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../../dash/utils/SegmentsUtils":376,"../constants/Constants":400,"../models/FragmentModel":440,"../rules/scheduling/BufferLevelRule":485,"../rules/scheduling/NextFragmentRequestRule":486,"../vo/metrics/PlayList":536,"./AbrController":403,"./BufferController":406,"./MediaController":409}],413:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var Oe=n(e("../constants/Constants")),Pe=n(e("../constants/MetricsConstants")),Ce=n(e("../Stream")),De=n(e("../ManifestUpdater")),Ie=n(e("../../core/EventBus")),Le=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),Ne=e("../vo/metrics/PlayList"),ke=n(e("../../core/Debug")),Fe=n(e("../utils/InitCache")),je=n(e("../utils/URLUtils")),Be=n(e("../MediaPlayerEvents")),Ue=n(e("./TimeSyncController")),Ge=n(e("./BaseURLController")),He=n(e("./MediaSourceController")),Ve=n(e("../vo/DashJSError")),ze=n(e("../../core/errors/Errors"));function o(){var t=40,u=this.context,c=(0,Ie.default)(u).getInstance(),l=void 0,d=void 0,f=void 0,h=void 0,r=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,a=void 0,_=void 0,b=void 0,E=void 0,w=void 0,A=void 0,T=void 0,n=void 0,S=void 0,x=void 0,M=void 0,R=void 0,O=void 0,P=void 0,i=void 0,o=void 0,s=void 0,C=void 0,D=void 0,I=void 0,L=void 0,N=void 0,k=void 0,F=void 0,j=void 0,B=void 0,U=void 0,G=void 0,H=void 0,V=void 0,z=void 0,W=void 0,q=void 0,Y=void 0,K=void 0,X=void 0,Q=void 0;function J(){if(ye(Oe.default.VIDEO)){var e=L.getPlaybackQuality();e&&v.addDroppedFrames(Oe.default.VIDEO,e)}}function Z(){if(!(!k.getJumpGaps()||0===ue()||N.isSeeking()||F||s||C||D)&&t<=++W){var e=N.getTime();X===e?function(e){for(var t=ue(),r=k.getSmallGapLimit(),n=void 0,i=0;i<t.length;i++){var o=t[i].getBuffer().getAllBufferRanges(),a=void 0;if(o&&!(o.length<=1)){for(var s=0;s<o.length;s++)if(e<o.start(s)){a=o.start(s);break}if(0<a){var u=a-e;0<u&&u<=r&&(void 0===n||n<a)&&(n=a)}}}var l=N.getTimeToStreamEnd();void 0===n&&!isNaN(l)&&l<r&&(n=e+l);0<n&&(!isNaN(l)&&e+l<=n?(d.info("Jumping media gap (discontinuity) at time ",e,". Jumping to end of the stream"),c.trigger(Le.default.PLAYBACK_ENDED,{isLast:Ae().isLast})):(d.info("Jumping media gap (discontinuity) at time ",e,". Jumping to time position",n),N.seek(n,!0,!0)))}(e):X=e,W=0}}function $(e){var t=se(e.seekTime);V&&(re(),H=!1),z&&(d.debug("[PreloadTimer] stop period preload timer."),clearTimeout(z),z=void 0),t===O&&K&&K.deactivate(!0),t&&(t!==O||K&&!O.isActive())?(be(Ne.PlayListTrace.END_OF_PERIOD_STOP_REASON),de(O,t,e.seekTime)):be(Ne.PlayListTrace.USER_REQUEST_STOP_REASON),Ee(Ne.PlayList.SEEK_START_REASON)}function ee(){d.debug("[onPlaybackStarted]"),j?(j=!1,Ee(Ne.PlayList.INITIAL_PLAYOUT_START_REASON)):F&&(F=!1,Ee(Ne.PlayList.RESUME_FROM_PAUSE_START_REASON),ne())}function te(e){d.debug("[onPlaybackPaused]"),e.ended||(F=!0,be(Ne.PlayListTrace.USER_REQUEST_STOP_REASON),ne())}function re(){d.debug("[toggleEndPeriodTimer] stop end period timer."),clearTimeout(V),V=void 0}function ne(){if(H)if(V)re();else{var e=N.getTimeToStreamEnd(),t=0<e?1e3*e:0,r=t<2e3?t/4:t-2e3;d.debug("[toggleEndPeriodTimer] Going to fire preload in",r,"milliseconds"),z=setTimeout(ae,r),d.debug("[toggleEndPeriodTimer] start-up of timer to notify PLAYBACK_ENDED event. It will be triggered in",t,"milliseconds"),V=setTimeout(function(){c.trigger(Le.default.PLAYBACK_ENDED,{isLast:Ae().isLast})},t)}}function ie(e){if(e.sender&&(e.sender.getType()===Oe.default.AUDIO||e.sender.getType()===Oe.default.VIDEO)){var t=Ae().isLast;I&&!t&&void 0===V&&(d.info("[onTrackBufferingCompleted] end of period detected. Track",e.sender.getType(),"has finished"),!(H=!0)===F&&ne())}}function oe(){var e=Ae().isLast;I&&e&&(d.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),a.signalEndOfStream(I))}function ae(){var t,e=Ae().isLast;I&&!e&&(t=ce(),(Y=O.isProtectionCompatible(t)&&(Q||O.isMediaCodecCompatible(t)))&&(d.info("[onStreamCanLoadNext] Preloading next stream"),O.stopEventController(),O.deactivate(!0),t.preload(I,q),(K=t).getProcessors().forEach(function(e){g.setIndexHandlerTime(e,t.getStartTime())})))}function se(e){var t=0,r=null,n=R.length;0<n&&(t+=R[0].getStartTime());for(var i=0;i<n;i++)if(r=R[i],e<(t=parseFloat((t+r.getDuration()).toFixed(5))))return r;return null}function ue(){return O?O.getProcessors():[]}function le(){var e=ce();e?(U=G=void 0,de(O,e,NaN)):d.debug("StreamController no next stream found"),be(e?Ne.PlayListTrace.END_OF_PERIOD_STOP_REASON:Ne.PlayListTrace.END_OF_CONTENT_STOP_REASON),V=void 0,H=!1}function ce(){if(O){var e=(t=Ae().start,r=Ae().duration,{v:R.filter(function(e){return e.getStreamInfo().start===parseFloat((t+r).toFixed(5))})[0]});if("object"==typeof e)return e.v}var t,r}function de(e,t,r){s||!t||e===t&&t.isActive()||(s=!0,c.trigger(Le.default.PERIOD_SWITCH_STARTED,{fromStreamInfo:e?e.getStreamInfo():null,toStreamInfo:t.getStreamInfo()}),Y=!1,e&&(e.stopEventController(),Y=O.isProtectionCompatible(t)&&(Q||O.isMediaCodecCompatible(t))&&!r||t.getPreloaded(),e.deactivate(Y)),O=t,K=!1,N.initialize(Ae(),Y),L.getElement()?fe(r,e,!1,Y):function(e){he(e,Y)}(r))}function fe(e,t,r,n){var i=void 0;function o(){I&&(d.debug("MediaSource is open!"),window.URL.revokeObjectURL(i),I.removeEventListener("sourceopen",o),I.removeEventListener("webkitsourceopen",o),pe(),t||c.trigger(Le.default.SOURCE_INITIALIZED),r?O.setMediaSource(I):he(e,n))}I?n?(he(e,n),t||c.trigger(Le.default.SOURCE_INITIALIZED)):(a.detachMediaSource(L),I.addEventListener("sourceopen",o,!1),I.addEventListener("webkitsourceopen",o,!1),i=a.attachMediaSource(I,L),d.debug("MediaSource attached to element.  Waiting on open...")):((I=a.createMediaSource()).addEventListener("sourceopen",o,!1),I.addEventListener("webkitsourceopen",o,!1),i=a.attachMediaSource(I,L),d.debug("MediaSource attached to element.  Waiting on open..."))}function he(e,t){if(q=O.activate(I,t?q:void 0),G=_e(Oe.default.AUDIO),U=_e(Oe.default.VIDEO),q){var r=Object.keys(q);0<r.length&&q[r[0]].changeType&&(d.debug("SourceBuffer changeType method supported. Use it to switch codecs in periods transitions"),Q=!0)}var n;j||(isNaN(e)?(n=N.getStreamStartTime(!0),t||ue().forEach(function(e){g.setIndexHandlerTime(e,n)})):N.seek(e)),O.startEventController(),!o&&j||N.play(),s=!1,c.trigger(Le.default.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Ae()})}function pe(e){var t=e||Ae().manifestInfo.duration,r=a.setDuration(I,t);d.debug("Duration successfully set to: "+r)}function me(e){for(var t=0,r=R.length;t<r;t++)if(R[t].getId()===e.id)return R[t];return null}function ge(){var e=p.getValue();P&&(c.trigger(Le.default.PROTECTION_CREATED,{controller:P,manifest:e}),P.setMediaElement(L.getElement()),i&&P.setProtectionData(i)),function(){try{var e=g.getStreamsInfo();if(0===e.length)throw new Error("There are no streams");var t=y.getCurrentManifestUpdate(v.getMetricsFor(Oe.default.STREAM));v.updateManifestUpdateInfo(t,{currentTime:N.getTime(),buffered:L.getBufferRange(),presentationStartTime:e[0].start,clientTimeOffset:M.getClientTimeOffset()});for(var r=0,n=e.length;r<n;r++){var i=e[r],o=me(i);o?o.updateData(i):(o=(0,Ce.default)(u).create({manifestModel:p,dashManifestModel:m,mediaPlayerModel:k,metricsModel:v,dashMetrics:y,manifestUpdater:h,adapter:g,timelineConverter:M,capabilities:f,errHandler:x,baseURLController:b,domStorage:E,abrController:w,playbackController:N,mediaController:A,textController:T,videoModel:L,streamController:l}),R.push(o),o.initialize(i,P)),v.addManifestUpdateStreamInfo(t,i.id,i.index,i.start,i.duration)}if(!O){var a=N.getStartTimeFromUriParameters(),s=null;if(a)s=se(isNaN(a.fragS)?a.fragT:a.fragS);de(null,null!==s?s:R[0],NaN)}c.trigger(Le.default.STREAMS_COMPOSED)}catch(e){x.manifestError(e.message,"nostreamscomposed",p.getValue()),x.error(new Ve.default(ze.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e.message+"nostreamscomposed",p.getValue())),D=!0,Me()}}()}function ve(s){s.error?(D=!0,Me()):function(){var e=s.manifest;g.updatePeriods(e);var t=g.getStreamsInfo(void 0,1)[0],r=g.getMediaInfoForType(t,Oe.default.VIDEO)||g.getMediaInfoForType(t,Oe.default.AUDIO),n=void 0;r&&(n=m.getUseCalculatedLiveEdgeTimeForAdaptation(g.getDataForMedia(r)))&&(d.debug("SegmentTimeline detected using calculated Live Edge Time"),k.setUseManifestDateHeaderTimeSource(!1));var i=m.getUTCTimingSources(s.manifest),o=!m.getIsDynamic(e)||n?i:i.concat(k.getUTCTimingSources()),a=S.isHTTPS(s.manifest.url);o.forEach(function(e){e.value.replace(/.*?:\/\//g,"")===k.getDefaultUtcTimingSource().value.replace(/.*?:\/\//g,"")&&(e.value=e.value.replace(a?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),a?"https://":"http://"),d.debug("Matching default timing source protocol to manifest protocol: ",e.value))}),b.initialize(e),_.setConfig({metricsModel:v,dashMetrics:y,baseURLController:b}),_.initialize(o,k.getUseManifestDateHeaderTimeSource())}()}function ye(e){var t=void 0;if(!e)return t;switch(e){case Oe.default.VIDEO:t=U;break;case Oe.default.AUDIO:t=G}return t}function _e(t){var r=!1;return ue().forEach(function(e){e.getMediaInfo().type===t&&(r=!0)}),r}function be(r,n){n=n||new Date,B&&(ue().forEach(function(e){var t=e.getScheduleController();t&&t.finalisePlayList(n,r)}),v.addPlayList(B),B=null)}function Ee(e){(B=new Ne.PlayList).start=new Date,B.mstart=1e3*N.getTime(),B.starttype=e,ue().forEach(function(e){var t=e.getScheduleController();t&&t.setPlayList(B)})}function we(e){if(e.error){var t="";switch(e.error.code){case 1:t="MEDIA_ERR_ABORTED";break;case 2:t="MEDIA_ERR_NETWORK";break;case 3:t="MEDIA_ERR_DECODE";break;case 4:t="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:t="MEDIA_ERR_ENCRYPTED";break;default:t="UNKNOWN"}C=!0,e.error.message&&(t+=" ("+e.error.message+")"),e.error.msExtendedCode&&(t+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),d.fatal("Video Element Error: "+t),e.error&&d.fatal(e.error),x.mediaSourceError(t),x.error(new Ve.default(e.error.code,t)),Me()}}function Ae(){return O?O.getStreamInfo():null}function Te(){if(!(r&&r.hasOwnProperty("load")&&M&&M.hasOwnProperty("initialize")&&M.hasOwnProperty("reset")&&M.hasOwnProperty("getClientTimeOffset")&&p&&x&&v&&N))throw new Error("setConfig function has to be called previously")}function Se(e){isNaN(e.newDuration)||pe(e.newDuration)}function xe(){B=O=P=null,V=G=U=void 0,H=!(o=!(F=!(j=!(D=C=s=!(R=[]))))),W=0}function Me(){Te(),_.reset(),be(C||D?Ne.PlayListTrace.FAILURE_STOP_REASON:Ne.PlayListTrace.USER_REQUEST_STOP_REASON);for(var e=0,t=R?R.length:0;e<t;e++){R[e].reset(C)}!function(){c.off(Le.default.PLAYBACK_TIME_UPDATED,J,this),c.off(Le.default.PLAYBACK_SEEKING,$,this),c.off(Le.default.PLAYBACK_ERROR,we,this),c.off(Le.default.PLAYBACK_STARTED,ee,this),c.off(Le.default.PLAYBACK_PAUSED,te,this),c.off(Le.default.PLAYBACK_ENDED,le,this),c.off(Le.default.MANIFEST_UPDATED,ve,this),c.off(Le.default.BUFFERING_COMPLETED,ie,this),c.off(Le.default.STREAM_BUFFERING_COMPLETED,oe,this),c.off(Le.default.MANIFEST_VALIDITY_CHANGED,Se,this),c.off(Le.default.TIME_SYNCHRONIZATION_COMPLETED,ge,this),c.off(Le.default.WALLCLOCK_TIME_UPDATED,Z,this),c.off(Be.default.METRIC_ADDED,Re,this)}(),b.reset(),h.reset(),v.clearAllCurrentMetrics(),p.setValue(null),r.reset(),M.reset(),n.reset(),I&&(a.detachMediaSource(L),I=null),L=null,P&&(P.setMediaElement(null),i=P=null,p.getValue()&&c.trigger(Le.default.PROTECTION_DESTROYED,{data:p.getValue().url})),c.trigger(Le.default.STREAM_TEARDOWN_COMPLETE),xe()}function Re(e){e.metric===Pe.default.DVR_INFO&&e.mediaType===Oe.default.AUDIO&&a.setSeekable(I,e.value.range.start,e.value.range.end)}return l={initialize:function(e,t){Te(),o=e,i=t,M.initialize(),(h=(0,De.default)(u).create()).setConfig({manifestModel:p,dashManifestModel:m,mediaPlayerModel:k,manifestLoader:r,errHandler:x}),h.initialize(),b.setConfig({dashManifestModel:m}),function(){c.on(Le.default.PLAYBACK_TIME_UPDATED,J,this),c.on(Le.default.PLAYBACK_SEEKING,$,this),c.on(Le.default.PLAYBACK_ERROR,we,this),c.on(Le.default.PLAYBACK_STARTED,ee,this),c.on(Le.default.PLAYBACK_PAUSED,te,this),c.on(Le.default.PLAYBACK_ENDED,le,this),c.on(Le.default.MANIFEST_UPDATED,ve,this),c.on(Le.default.BUFFERING_COMPLETED,ie,this),c.on(Le.default.STREAM_BUFFERING_COMPLETED,oe,this),c.on(Le.default.MANIFEST_VALIDITY_CHANGED,Se,this),c.on(Le.default.TIME_SYNCHRONIZATION_COMPLETED,ge,this),c.on(Le.default.WALLCLOCK_TIME_UPDATED,Z,this),c.on(Be.default.METRIC_ADDED,Re,this)}()},getActiveStreamInfo:Ae,isTrackTypePresent:ye,switchToVideoElement:function(e){O&&(N.initialize(Ae()),fe(e,null,!0,!1))},getStreamById:function(t){return R.filter(function(e){return e.getId()===t})[0]},getStreamForTime:se,getTimeRelativeToStreamId:function(e,t){for(var r=null,n=0,i=0,o=null,a=R.length,s=0;s<a;s++){if(i=(r=R[s]).getStartTime(),o=r.getDuration(),Number.isFinite(i)&&(n=i),r.getId()===t)return e-n;Number.isFinite(o)&&(n+=o)}return null},load:function(e){Te(),r.load(e)},loadWithManifest:function(e){!function(){if(!h||!h.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}(),h.setManifest(e)},getActiveStreamProcessors:ue,setConfig:function(e){e&&(e.capabilities&&(f=e.capabilities),e.manifestLoader&&(r=e.manifestLoader),e.manifestModel&&(p=e.manifestModel),e.dashManifestModel&&(m=e.dashManifestModel),e.mediaPlayerModel&&(k=e.mediaPlayerModel),e.protectionController&&(P=e.protectionController),e.adapter&&(g=e.adapter),e.metricsModel&&(v=e.metricsModel),e.dashMetrics&&(y=e.dashMetrics),e.errHandler&&(x=e.errHandler),e.timelineConverter&&(M=e.timelineConverter),e.videoModel&&(L=e.videoModel),e.playbackController&&(N=e.playbackController),e.domStorage&&(E=e.domStorage),e.abrController&&(w=e.abrController),e.mediaController&&(A=e.mediaController),e.textController&&(T=e.textController))},setProtectionData:function(e){i=e},reset:Me},d=(0,ke.default)(u).getInstance().getLogger(l),_=(0,Ue.default)(u).getInstance(),b=(0,Ge.default)(u).getInstance(),a=(0,He.default)(u).getInstance(),n=(0,Fe.default)(u).getInstance(),S=(0,je.default)(u).getInstance(),xe(),l}o.__dashjs_factory_name="StreamController",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/errors/Errors":349,"../../core/events/Events":352,"../ManifestUpdater":391,"../MediaPlayerEvents":393,"../Stream":397,"../constants/Constants":400,"../constants/MetricsConstants":401,"../utils/InitCache":502,"../utils/URLUtils":509,"../vo/DashJSError":514,"../vo/metrics/PlayList":536,"./BaseURLController":404,"./MediaSourceController":410,"./TimeSyncController":414}],414:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var A=n(e("../constants/Constants")),T=n(e("./../vo/DashJSError")),S=e("./../vo/metrics/HTTPRequest"),x=n(e("./../../core/EventBus")),M=n(e("./../../core/events/Events")),R=n(e("./../../core/errors/Errors")),i=n(e("../../core/FactoryMaker")),O=n(e("../../core/Debug")),P=n(e("../utils/URLUtils"));function o(){var e=this.context,n=(0,x.default)(e).getInstance(),f=(0,P.default)(e).getInstance(),t=void 0,a=void 0,i=void 0,r=void 0,s=void 0,u=void 0,o=void 0,l=void 0,h=void 0;function c(e){r=e}function d(e){i=e}function p(e){var t=Date.parse(e);return isNaN(t)&&(t=function(e){var t=void 0,r=void 0,n=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&(parseInt(n[6],10)||0),n[7]&&1e3*parseFloat(n[7])||0),n[9]&&n[10]&&(r=60*parseInt(n[9],10)+parseInt(n[10],10),t+=("+"===n[8]?-1:1)*r*60*1e3),new Date(t).getTime()}(e)),t}function m(e){return Date.parse(e)}function g(e){return Date.parse(e)}function v(e,t,r){r()}function y(e,t,r){var n=p(e);isNaN(n)?r():t(n)}function _(r,e,n,t,i){var o,a,s=!1,u=new XMLHttpRequest,l=i?S.HTTPRequest.HEAD:S.HTTPRequest.GET,c=e.match(/\S+/g);if(e=c.shift(),o=function(){s||(s=!0,c.length?_(r,c.join(" "),n,t,i):t())},a=function(){var e=void 0,t=void 0;200===u.status&&(e=i?u.getResponseHeader("Date"):u.response,t=r(e),isNaN(t)||(n(t),s=!0))},f.isRelative(e)){var d=h.resolve();d&&(e=f.resolve(e,d.url))}u.open(l,e),u.timeout=5e3,u.onload=a,u.onloadend=o,u.send()}function b(e,t,r){_(g,e,t,r,!0)}function E(){var e=o.getReadOnlyMetricsFor(A.default.STREAM),t=l.getLatestMPDRequestHeaderValueByID(e,"Date"),r=null!==t?new Date(t).getTime():Number.NaN;isNaN(r)?w(!0):(d(r-(new Date).getTime()),w(!1,r/1e3,i))}function w(e,t,r){c(!1),n.trigger(M.default.TIME_SYNCHRONIZATION_COMPLETED,{time:t,offset:r,error:e?new T.default(R.default.TIME_SYNC_FAILED_ERROR_CODE,R.default.TIME_SYNC_FAILED_ERROR_MESSAGE):null})}return t={initialize:function(e,t){s=t,i=0,r=!1,u={"urn:mpeg:dash:utc:http-head:2014":b,"urn:mpeg:dash:utc:http-xsdate:2014":_.bind(null,p),"urn:mpeg:dash:utc:http-iso:2014":_.bind(null,m),"urn:mpeg:dash:utc:direct:2014":y,"urn:mpeg:dash:utc:http-head:2012":b,"urn:mpeg:dash:utc:http-xsdate:2012":_.bind(null,p),"urn:mpeg:dash:utc:http-iso:2012":_.bind(null,m),"urn:mpeg:dash:utc:direct:2012":y,"urn:mpeg:dash:utc:http-ntp:2014":v,"urn:mpeg:dash:utc:ntp:2014":v,"urn:mpeg:dash:utc:sntp:2014":v},r||function e(t,r){var n=r||0;var i=t[n];var o=function(e,t){var r=!e||!t;r&&s?E():w(r,e,t)};c(!0);i?u.hasOwnProperty(i.schemeIdUri)?u[i.schemeIdUri](i.value,function(e){var t=(new Date).getTime(),r=e-t;d(r),a.info("Local time: "+new Date(t)),a.info("Server time: "+new Date(e)),a.info("Server Time - Local Time (ms): "+r),o(e,r)},function(){e(t,n+1)}):e(t,n+1):(d(0),o())}(e)},getOffsetToDeviceTimeMs:function(){return i},setConfig:function(e){e&&(e.metricsModel&&(o=e.metricsModel),e.dashMetrics&&(l=e.dashMetrics),e.baseURLController&&(h=e.baseURLController))},reset:function(){c(!1)}},a=(0,O.default)(e).getInstance().getLogger(t),t}o.__dashjs_factory_name="TimeSyncController";var a=i.default.getSingletonFactory(o);a.HTTP_TIMEOUT_MS=5e3,i.default.updateSingletonFactory(o.__dashjs_factory_name,a),r.default=a,t.exports=r.default},{"../../core/Debug":345,"../../core/FactoryMaker":347,"../constants/Constants":400,"../utils/URLUtils":509,"./../../core/EventBus":346,"./../../core/errors/Errors":349,"./../../core/events/Events":352,"./../vo/DashJSError":514,"./../vo/metrics/HTTPRequest":534}],415:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=n(e("../XlinkLoader")),m=n(e("../../core/EventBus")),g=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),v=n(e("../../../externals/xml2json")),y=n(e("../utils/URLUtils")),_=n(e("../../dash/constants/DashConstants")),b="onLoad";function o(e){e=e||{};var t=this.context,i=(0,m.default)(t).getInstance(),s=(0,y.default)(t).getInstance(),r=void 0,n=void 0,u=void 0,l=void 0,o=void 0,c=void 0;function a(e,t,r){var n={},i=void 0,o=void 0;n.elements=e,n.type=t,n.resolveType=r,0===n.elements.length&&f(n);for(var a=0;a<n.elements.length;a++)i=n.elements[a],o=s.isHTTPURL(i.url)?i.url:i.originalContent.BaseURL+i.url,c.load(o,i,n)}function d(e){var t,r=void 0,n="";if(r=e.element,t=e.resolveObject,r.resolvedContent){var i=0;0===r.resolvedContent.indexOf("<?xml")&&(i=r.resolvedContent.indexOf("?>")+2),n=r.resolvedContent.substr(0,i)+"<response>"+r.resolvedContent.substr(i)+"</response>",r.resolvedContent=o.xml_str2json(n)}!function(e){var t=void 0;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0}(t)||f(t)}function f(e){var t=[],r=void 0,n=void 0;if(function(e){var t=[],r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0;for(o=e.elements.length-1;0<=o;o--){if(r=e.elements[o],n=r.type+"_asArray",r.resolvedContent){if(r.resolvedContent)for(a=0;a<r.resolvedContent[n].length;a++)i=r.resolvedContent[n][a],t.push(i)}else delete r.originalContent["xlink:actuate"],delete r.originalContent["xlink:href"],t.push(r.originalContent);for(r.parentElement[n].splice(r.index,1),s=0;s<t.length;s++)r.parentElement[n].splice(r.index+s,0,t[s]);t=[]}0<e.elements.length&&u.run(l)}(e),"onActuate"===e.resolveType&&i.trigger(g.default.XLINK_READY,{manifest:l}),e.resolveType===b)switch(e.type){case _.default.PERIOD:for(r=0;r<l[_.default.PERIOD+"_asArray"].length;r++)(n=l[_.default.PERIOD+"_asArray"][r]).hasOwnProperty(_.default.ADAPTATION_SET+"_asArray")&&(t=t.concat(h(n[_.default.ADAPTATION_SET+"_asArray"],n,_.default.ADAPTATION_SET,b))),n.hasOwnProperty(_.default.EVENT_STREAM+"_asArray")&&(t=t.concat(h(n[_.default.EVENT_STREAM+"_asArray"],n,_.default.EVENT_STREAM,b)));a(t,_.default.ADAPTATION_SET,b);break;case _.default.ADAPTATION_SET:i.trigger(g.default.XLINK_READY,{manifest:l})}}function h(e,t,r,n){var i=[],o=void 0,a=void 0,s=void 0;for(a=e.length-1;0<=a;a--)(o=e[a]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===o["xlink:href"]&&e.splice(a,1);for(a=0;a<e.length;a++)(o=e[a]).hasOwnProperty("xlink:href")&&o.hasOwnProperty("xlink:actuate")&&o["xlink:actuate"]===n&&(s={url:o["xlink:href"],parentElement:t,type:r,index:a,resolveType:n,originalContent:o,resolvedContent:null,resolved:!1},i.push(s));return i}return r={resolveManifestOnLoad:function(e){o=new v.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:n}),a(h((l=e).Period_asArray,l,_.default.PERIOD,b),_.default.PERIOD,b)},setMatchers:function(e){e&&(n=e)},setIron:function(e){e&&(u=e)},reset:function(){i.off(g.default.XLINK_ELEMENT_LOADED,d,r),c&&(c.reset(),c=null)}},i.on(g.default.XLINK_ELEMENT_LOADED,d,r),c=(0,p.default)(t).create({errHandler:e.errHandler,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),r}o.__dashjs_factory_name="XlinkController",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../../externals/xml2json":342,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../../dash/constants/DashConstants":359,"../XlinkLoader":399,"../utils/URLUtils":509}],416:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("./utils/DVBErrorsTranslator")),o=n(e("./MetricsReportingEvents")),a=n(e("./controllers/MetricsCollectionController")),s=n(e("./metrics/MetricsHandlerFactory")),u=n(e("./reporting/ReportingFactory"));function l(){var t=this.context;return{createMetricsReporting:function(e){return(0,i.default)(t).getInstance({eventBus:e.eventBus,metricsModel:e.metricsModel,metricsConstants:e.metricsConstants,events:e.events}),(0,a.default)(t).create(e)},getReportingFactory:function(){return(0,u.default)(t).getInstance()},getMetricsHandlerFactory:function(){return(0,s.default)(t).getInstance()}}}l.__dashjs_factory_name="MetricsReporting";var c=dashjs.FactoryMaker.getClassFactory(l);c.events=o.default,dashjs.FactoryMaker.updateClassFactory(l.__dashjs_factory_name,c),r.default=c,t.exports=r.default},{"./MetricsReportingEvents":417,"./controllers/MetricsCollectionController":418,"./metrics/MetricsHandlerFactory":423,"./reporting/ReportingFactory":428,"./utils/DVBErrorsTranslator":430}],417:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/events/EventsBase");function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(o.prototype),"constructor",this).call(this),this.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",this.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer"}var a=new(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,((n=i)&&n.__esModule?n:{default:n}).default),o);r.default=a,t.exports=r.default},{"../../core/events/EventsBase":353}],418:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=n(e("./MetricsController")),u=n(e("../utils/ManifestParsing")),l=n(e("../MetricsReportingEvents"));function i(i){i=i||{};var o={},a=this.context,t=i.eventBus,e=i.events;function r(e){if(!e.error){var n=Object.keys(o);(0,u.default)(a).getInstance({dashManifestModel:i.dashManifestModel,constants:i.constants}).getMetrics(e.manifest).forEach(function(e){var t=JSON.stringify(e);if(o.hasOwnProperty(t))n.splice(t,1);else try{var r=(0,s.default)(a).create(i);r.initialize(e),o[t]=r}catch(e){}}),n.forEach(function(e){o[e].reset(),delete o[e]}),t.trigger(l.default.METRICS_INITIALISATION_COMPLETE)}}function n(){Object.keys(o).forEach(function(e){o[e].reset()}),o={}}return t.on(e.MANIFEST_UPDATED,r),t.on(e.STREAM_TEARDOWN_COMPLETE,n),{reset:function(){t.off(e.MANIFEST_UPDATED,r),t.off(e.STREAM_TEARDOWN_COMPLETE,n)}}}i.__dashjs_factory_name="MetricsCollectionController",r.default=dashjs.FactoryMaker.getClassFactory(i),t.exports=r.default},{"../MetricsReportingEvents":417,"../utils/ManifestParsing":432,"./MetricsController":419}],419:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=n(e("./RangeController")),u=n(e("./ReportingController")),l=n(e("./MetricsHandlersController"));function i(t){t=t||{};var r=void 0,n=void 0,i=void 0,o=this.context;function a(){r&&r.reset(),n&&n.reset(),i&&i.reset()}return{initialize:function(e){try{(i=(0,s.default)(o).create({mediaElement:t.mediaElement})).initialize(e.Range),(n=(0,u.default)(o).create({debug:t.debug,metricsConstants:t.metricsConstants})).initialize(e.Reporting,i),(r=(0,l.default)(o).create({debug:t.debug,eventBus:t.eventBus,metricsConstants:t.metricsConstants,events:t.events})).initialize(e.metrics,n)}catch(e){throw a(),e}},reset:a}}i.__dashjs_factory_name="MetricsController",r.default=dashjs.FactoryMaker.getClassFactory(i),t.exports=r.default},{"./MetricsHandlersController":420,"./RangeController":421,"./ReportingController":422}],420:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../metrics/MetricsHandlerFactory"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){e=e||{};var a=[],t=void 0,r=this.context,n=e.eventBus,i=e.events,s=(0,o.default)(r).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});function u(t){a.forEach(function(e){e.handleNewMetric(t.metric,t.value,t.mediaType)})}return t={initialize:function(e,o){e.split(",").forEach(function(e,t,r){var n;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){var i=r[t+1];i&&-1===i.indexOf("(")&&-1!==i.indexOf(")")&&(e+=","+i,delete r[t+1])}(n=s.create(e,o))&&a.push(n)}),n.on(i.METRIC_ADDED,u,t),n.on(i.METRIC_UPDATED,u,t)},reset:function(){n.off(i.METRIC_ADDED,u,t),n.off(i.METRIC_UPDATED,u,t),a.forEach(function(e){return e.reset()}),a=[]}}}a.__dashjs_factory_name="MetricsHandlersController",r.default=dashjs.FactoryMaker.getClassFactory(a),t.exports=r.default},{"../metrics/MetricsHandlerFactory":423}],421:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../utils/CustomTimeRanges"),u=(n=i)&&n.__esModule?n:{default:n};function o(e){e=e||{};var t,o=!1,r=this.context,a=void 0,s=e.mediaElement;return t={initialize:function(e){e&&e.length&&(e.forEach(function(e){var t=e.starttime,r=t+e.duration;a.add(t,r)}),o=!!e[0]._useWallClockTime)},reset:function(){a.clear()},isEnabled:function(){var e,t=a.length;if(!t)return!0;e=o?(new Date).getTime()/1e3:s.currentTime;for(var r=0;r<t;r+=1){var n=a.start(r),i=a.end(r);if(n<=e&&e<i)return!0}return!1}},a=(0,u.default)(r).create(),t}o.__dashjs_factory_name="RangeController",r.default=dashjs.FactoryMaker.getClassFactory(o),t.exports=r.default},{"../../utils/CustomTimeRanges":498}],422:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../reporting/ReportingFactory"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){var n=[],i=(0,o.default)(this.context).getInstance(e);return{initialize:function(e,r){e.some(function(e){var t=i.create(e,r);if(t)return n.push(t),!0})},reset:function(){n.forEach(function(e){return e.reset()}),n=[]},report:function(t,r){n.forEach(function(e){return e.report(t,r)})}}}a.__dashjs_factory_name="ReportingController",r.default=dashjs.FactoryMaker.getClassFactory(a),t.exports=r.default},{"../reporting/ReportingFactory":428}],423:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=n(e("./handlers/BufferLevelHandler")),c=n(e("./handlers/DVBErrorsHandler")),d=n(e("./handlers/HttpListHandler")),f=n(e("./handlers/GenericMetricHandler"));function i(i){var o=(i=i||{}).debug,a=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,s=this.context,u={BufferLevel:l.default,DVBErrors:c.default,HttpList:d.default,PlayList:f.default,RepSwitchList:f.default,TcpList:f.default};return{create:function(e,t){var r,n=e.match(a);if(n){try{(r=u[n[1]](s).create({eventBus:i.eventBus,metricsConstants:i.metricsConstants})).initialize(n[1],t,n[3],n[5])}catch(e){r=null,o.error("MetricsHandlerFactory: Could not create handler for type "+n[1]+" with args "+n[3]+", "+n[5]+" ("+e.message+")")}return r}},register:function(e,t){u[e]=t},unregister:function(e){delete u[e]}}}i.__dashjs_factory_name="MetricsHandlerFactory",r.default=dashjs.FactoryMaker.getSingletonFactory(i),t.exports=r.default},{"./handlers/BufferLevelHandler":424,"./handlers/DVBErrorsHandler":425,"./handlers/GenericMetricHandler":426,"./handlers/HttpListHandler":427}],424:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../utils/HandlerHelpers"),d=(n=i)&&n.__esModule?n:{default:n};function o(e){e=e||{};var n=void 0,i=void 0,o=void 0,a=void 0,t=void 0,r=this.context,s=(0,d.default)(r).getInstance(),u=[],l=e.metricsConstants;function c(){var e=function(){try{return Object.keys(u).map(function(e){return u[e]}).reduce(function(e,t){return e.level<t.level?e:t})}catch(e){return}}();e&&t!==e.t&&(t=e.t,n.report(o,e))}return{initialize:function(e,t,r){t&&(i=s.validateN(r),n=t,o=s.reconstructFullMetricName(e,r),a=setInterval(c,i))},reset:function(){clearInterval(a),i=0,t=n=a=null},handleNewMetric:function(e,t,r){e===l.BUFFER_LEVEL&&(u[r]=t)}}}o.__dashjs_factory_name="BufferLevelHandler",r.default=dashjs.FactoryMaker.getClassFactory(o),t.exports=r.default},{"../../utils/HandlerHelpers":431}],425:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../MetricsReportingEvents"),a=(n=i)&&n.__esModule?n:{default:n};r.default=dashjs.FactoryMaker.getClassFactory(function(e){var r=void 0,n=(e=e||{}).eventBus,i=e.metricsConstants;function o(){n.off(a.default.METRICS_INITIALISATION_COMPLETE,o,this),n.trigger(a.default.BECAME_REPORTING_PLAYER)}return{initialize:function(e,t){t&&(r=t,n.on(a.default.METRICS_INITIALISATION_COMPLETE,o,this))},reset:function(){r=null},handleNewMetric:function(e,t){e===i.DVB_ERRORS&&r&&r.report(e,t)}}}),t.exports=r.default},{"../../MetricsReportingEvents":417}],426:[function(e,t,r){"use strict";function n(){var r=void 0,n=void 0;return{initialize:function(e,t){r=e,n=t},reset:function(){n=null,r=void 0},handleNewMetric:function(e,t){e===r&&n&&n.report(r,t)}}}Object.defineProperty(r,"__esModule",{value:!0}),n.__dashjs_factory_name="GenericMetricHandler",r.default=dashjs.FactoryMaker.getClassFactory(n),t.exports=r.default},{}],427:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../utils/HandlerHelpers"),d=(n=i)&&n.__esModule?n:{default:n};function o(e){e=e||{};var i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,r=[],l=(0,d.default)(this.context).getInstance(),n=e.metricsConstants;function c(){var e=r;e.length&&i&&i.report(s,e),r=[]}return{initialize:function(e,t,r,n){t&&(o=l.validateN(r),i=t,n&&n.length&&(a=n),s=l.reconstructFullMetricName(e,r,n),u=setInterval(c,o))},reset:function(){clearInterval(u),r=[],i=a=o=u=null},handleNewMetric:function(e,t){e===n.HTTP_REQUEST&&(a&&a!==t.type||r.push(t))}}}o.__dashjs_factory_name="HttpListHandler",r.default=dashjs.FactoryMaker.getClassFactory(o),t.exports=r.default},{"../../utils/HandlerHelpers":431}],428:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./reporters/DVBReporting"),s=(n=i)&&n.__esModule?n:{default:n};function o(e){e=e||{};var n={"urn:dvb:dash:reporting:2014":s.default},i=this.context,o=e.debug,a=e.metricsConstants;return{create:function(t,e){var r=void 0;try{(r=n[t.schemeIdUri](i).create({metricsConstants:a})).initialize(t,e)}catch(e){r=null,o.error("ReportingFactory: could not create Reporting with schemeIdUri "+t.schemeIdUri+" ("+e.message+")")}return r},register:function(e,t){n[e]=t},unregister:function(e){delete n[e]}}}o.__dashjs_factory_name="ReportingFactory",r.default=dashjs.FactoryMaker.getSingletonFactory(o),t.exports=r.default},{"./reporters/DVBReporting":429}],429:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var f=n(e("../../utils/MetricSerialiser")),h=n(e("../../utils/RNG"));function i(e){e=e||{};var t,r=this.context,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=[],c=e.metricsConstants;function d(){a=o=!1,u=s=null}return t={report:function(r,e){Array.isArray(e)||(e=[e]),a&&u.isEnabled()&&e.forEach(function(e){var t=n.serialise(e);r!==c.DVB_ERRORS&&(t="metricname="+r+"&"+t),function(e,t,r){function n(){var e=l.indexOf(i);-1!==e&&(l.splice(e,1),200<=i.status&&i.status<300?t&&t():r&&r())}var i=new XMLHttpRequest;l.push(i);try{i.open("GET",e),i.onloadend=n,i.onerror=n,i.send()}catch(e){i.onerror()}}(t=s+"?"+t,null,function(){a=!1})})},initialize:function(e,t){var r=void 0;if(u=t,!(s=e["dvb:reportingUrl"]))throw new Error("required parameter missing (dvb:reportingUrl)");o||((r=e["dvb:probability"]||e["dvb:priority"]||0)&&(1e3===r||r/1e3>=i.random())&&(a=!0),o=!0)},reset:function(){d()}},n=(0,f.default)(r).getInstance(),i=(0,h.default)(r).getInstance(),d(),t}i.__dashjs_factory_name="DVBReporting",r.default=dashjs.FactoryMaker.getClassFactory(i),t.exports=r.default},{"../../utils/MetricSerialiser":433,"../../utils/RNG":434}],430:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=n(e("../vo/DVBErrors")),m=n(e("../MetricsReportingEvents"));function i(e){var t=void 0,n=void 0,r=(e=e||{}).eventBus,i=e.metricsModel,o=e.metricsConstants,a=e.events;function s(e){var t=new p.default;if(n){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.mpdurl||(t.mpdurl=n.originalUrl||n.url),t.terror||(t.terror=new Date),i.addDVBErrors(t)}}function u(e){e.error||(n=e.manifest)}function l(e){s({errorcode:p.default.BASE_URL_CHANGED,servicelocation:e.entry})}function c(){s({errorcode:p.default.BECAME_REPORTER})}function d(e){switch(e.metric){case o.HTTP_REQUEST:!function(e){(0===e.responsecode||400<=e.responsecode||e.responsecode<100||600<=e.responsecode)&&s({errorcode:e.responsecode||p.default.CONNECTION_ERROR,url:e.url,terror:e.tresponse,servicelocation:e._serviceLocation})}(e.value)}}function f(e){var t=void 0;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:t=p.default.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:t=p.default.CORRUPT_MEDIA_OTHER;break;default:return}s({errorcode:t})}function h(){r.on(a.MANIFEST_UPDATED,u,t),r.on(a.SERVICE_LOCATION_BLACKLIST_CHANGED,l,t),r.on(a.METRIC_ADDED,d,t),r.on(a.METRIC_UPDATED,d,t),r.on(a.PLAYBACK_ERROR,f,t),r.on(m.default.BECAME_REPORTING_PLAYER,c,t)}return t={initialise:h,reset:function(){r.off(a.MANIFEST_UPDATED,u,t),r.off(a.SERVICE_LOCATION_BLACKLIST_CHANGED,l,t),r.off(a.METRIC_ADDED,d,t),r.off(a.METRIC_UPDATED,d,t),r.off(a.PLAYBACK_ERROR,f,t),r.off(m.default.BECAME_REPORTING_PLAYER,c,t)}},h(),t}i.__dashjs_factory_name="DVBErrorsTranslator",r.default=dashjs.FactoryMaker.getSingletonFactory(i),t.exports=r.default},{"../MetricsReportingEvents":417,"../vo/DVBErrors":435}],431:[function(e,t,r){"use strict";function n(){return{reconstructFullMetricName:function(e,t,r){var n=e;return t&&(n+="("+t,r&&r.length&&(n+=","+r),n+=")"),n},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}Object.defineProperty(r,"__esModule",{value:!0}),n.__dashjs_factory_name="HandlerHelpers",r.default=dashjs.FactoryMaker.getSingletonFactory(n),t.exports=r.default},{}],432:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("../vo/Metrics")),a=n(e("../vo/Range")),l=n(e("../vo/Reporting"));function i(e){var s=(e=e||{}).dashManifestModel,u=e.constants;return{getMetrics:function(i){var t=[];return i.Metrics_asArray&&i.Metrics_asArray.forEach(function(e){var n=new o.default,r=s.getIsDynamic(i);e.hasOwnProperty("metrics")&&(n.metrics=e.metrics,e.Range_asArray&&e.Range_asArray.forEach(function(e){var t=new a.default;t.starttime=function(e,t,r){var n,i,o=s.getMpd(e),a=0;return t?a=o.availabilityStartTime.getTime()/1e3:(n=this.getRegularPeriods(o)).length&&(a=n[0].start),i=a,r&&r.hasOwnProperty(u.START_TIME)&&(i+=r.starttime),i}(i,r,e),e.hasOwnProperty("duration")?t.duration=e.duration:t.duration=s.getDuration(i),t._useWallClockTime=r,n.Range.push(t)}),e.Reporting_asArray&&(e.Reporting_asArray.forEach(function(e){var t=new l.default;if(e.hasOwnProperty(u.SCHEME_ID_URI)){for(var r in t.schemeIdUri=e.schemeIdUri,e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.Reporting.push(t)}}),t.push(n)))}),t}}}i.__dashjs_factory_name="ManifestParsing",r.default=dashjs.FactoryMaker.getSingletonFactory(i),t.exports=r.default},{"../vo/Metrics":436,"../vo/Range":437,"../vo/Reporting":438}],433:[function(e,t,r){"use strict";function n(){return{serialise:function r(e){var t=[],n=[],i=void 0,o=void 0;for(i in e)if(e.hasOwnProperty(i)&&0!==i.indexOf("_")){if(null==(o=e[i])&&(o=""),Array.isArray(o)){if(!o.length)continue;n=[],o.forEach(function(e){var t="Object"!==Object.prototype.toString.call(e).slice(8,-1);n.push(t?e:r(e))}),o=n.map(encodeURIComponent).join(",")}else"string"==typeof o?o=encodeURIComponent(o):o instanceof Date?o=o.toISOString():"number"==typeof o&&(o=Math.round(o));t.push(i+"="+o)}return t.join("&")}}}Object.defineProperty(r,"__esModule",{value:!0}),n.__dashjs_factory_name="MetricSerialiser",r.default=dashjs.FactoryMaker.getSingletonFactory(n),t.exports=r.default},{}],434:[function(e,t,r){"use strict";function n(){var e,n=window.crypto||window.msCrypto,t=Uint32Array,i=Math.pow(2,8*t.BYTES_PER_ELEMENT)-1,r=10,o=void 0,a=void 0;function s(){n&&(o=o||new t(r),n.getRandomValues(o),a=0)}return e={random:function(e,t){var r=void 0;return e=e||0,t=t||1,n?(a===o.length&&s(),r=o[a]/i,a+=1):r=Math.random(),r*(t-e)+e}},s(),e}Object.defineProperty(r,"__esModule",{value:!0}),n.__dashjs_factory_name="RNG",r.default=dashjs.FactoryMaker.getSingletonFactory(n),t.exports=r.default},{}],435:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null}n.SSL_CONNECTION_FAILED_PREFIX="SSL",n.DNS_RESOLUTION_FAILED="C00",n.HOST_UNREACHABLE="C01",n.CONNECTION_REFUSED="C02",n.CONNECTION_ERROR="C03",n.CORRUPT_MEDIA_ISOBMFF="M00",n.CORRUPT_MEDIA_OTHER="M01",n.BASE_URL_CHANGED="F00",n.BECAME_REPORTER="S00",r.default=n,t.exports=r.default},{}],436:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metrics="",this.Range=[],this.Reporting=[]},t.exports=r.default},{}],437:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1},t.exports=r.default},{}],438:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""},t.exports=r.default},{}],439:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});function u(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.data={baseUrls:e||null,selectedIdx:t||NaN},this.children=[]}var l=n(e("../utils/ObjectUtils")),i=n(e("../../core/FactoryMaker"));function o(){var e,i=void 0,o=void 0,t=this.context,a=(0,l.default)(t).getInstance();function s(e,t,r){var n=o.getBaseURLsFromElement(r);e[t]?a.areEqual(n,e[t].data.baseUrls)||(e[t].data.baseUrls=n,e[t].data.selectedIdx=NaN):e[t]=new u(n)}function r(e){!function(){if(!o||!o.hasOwnProperty("getBaseURLsFromElement")||!o.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var t=o.getBaseURLsFromElement(e);a.areEqual(t,i.data.baseUrls)||(i.data.baseUrls=t,i.data.selectedIdx=NaN),e&&e.Period_asArray&&e.Period_asArray.forEach(function(e,n){s(i.children,n,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach(function(e,r){s(i.children[n].children,r,e),e.Representation_asArray&&e.Representation_asArray.sort(o.getRepresentationSortFunction()).forEach(function(e,t){s(i.children[n].children[r].children,t,e)})})})}function n(){i=new u}return e={reset:n,update:function(e){r(e)},getForPath:function(e){var t=i,r=[t.data];return e&&e.forEach(function(e){(t=t.children[e])&&r.push(t.data)}),r.filter(function(e){return e.baseUrls.length})},invalidateSelectedIndexes:function(t){!function t(r,e){var n=e||i;r(n.data),n.children&&n.children.forEach(function(e){return t(r,e)})}(function(e){isNaN(e.selectedIdx)||t===e.baseUrls[e.selectedIdx].serviceLocation&&(e.selectedIdx=NaN)})},setConfig:function(e){e.dashManifestModel&&(o=e.dashManifestModel)}},n(),e}o.__dashjs_factory_name="BaseURLTreeModel",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/FactoryMaker":347,"../utils/ObjectUtils":505}],440:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var _=n(e("../../core/EventBus")),b=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),E=n(e("../vo/FragmentRequest")),w=n(e("../../core/Debug")),A="loading",T="executed";function o(e){e=e||{};var t=this.context,r=(0,_.default)(t).getInstance(),n=e.metricsModel,i=e.fragmentLoader,o=void 0,a=void 0,s=void 0,u=void 0,l=void 0;function c(t){var r;return!!t&&(r=!1,u.some(function(e){if(function(e,t){return!isNaN(e.index)&&e.startTime===t.startTime&&e.adaptationIndex===t.adaptationIndex&&e.type===t.type}(t,e)||function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality}(t,e)||function(e,t){return e.action===E.default.ACTION_COMPLETE&&e.action===t.action}(t,e))return r=!0}),r)}function d(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function f(r){u=u.filter(function(e){var t=d(e);return isNaN(e.startTime)||void 0!==r&&e.startTime>=r-t})}function h(r,n){n<=r+.5||(u=u.filter(function(e){var t=d(e);return isNaN(e.startTime)||e.startTime>=n-t||isNaN(e.duration)||e.startTime+e.duration<=r+t}))}function p(e,t){n.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t),n.addRequestsQueue(e.mediaType,l,u)}function m(e){e.sender===i&&(l.splice(l.indexOf(e.request),1),e.response&&!e.error&&u.push(e.request),p(e.request,e.error?"failed":T),r.trigger(b.default.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this}))}function g(e){e.sender===i&&r.trigger(b.default.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this})}function v(e){e.sender===i&&r.trigger(b.default.FRAGMENT_LOADING_ABANDONED,{streamProcessor:this.getStreamProcessor(),request:e.request,mediaType:e.mediaType})}function y(){u=[],l=[]}return o={setStreamProcessor:function(e){s=e},getStreamProcessor:function(){return s},getRequests:function(r){var e=r?r.state instanceof Array?r.state:[r.state]:[],n=[];return e.forEach(function(e){var t=function(e){var t=void 0;switch(e){case A:t=l;break;case T:t=u;break;default:t=[]}return t}(e);n=n.concat(function(e,r){if(r.hasOwnProperty("time"))return[function(e,t,r){for(var n=e.length-1;0<=n;n--){var i=e[n],o=i.startTime,a=o+i.duration;if(r=isNaN(r)?d(i):r,!isNaN(o)&&!isNaN(a)&&o<=t+r&&t-r<a||isNaN(o)&&isNaN(t))return i}return null}(e,r.time,r.threshold)];return e.filter(function(e){for(var t in r)if("state"!==t&&r.hasOwnProperty(t)&&e[t]!=r[t])return!1;return!0})}(t,r))}),n},isFragmentLoaded:c,isFragmentLoadedOrPending:function(e){var t=!1,r=0,n=void 0;if(!(t=c(e)))for(r=0;r<l.length;r++)n=l[r],e.url===n.url&&e.startTime===n.startTime&&(t=!0);return t},removeExecutedRequestsBeforeTime:f,removeExecutedRequestsAfterTime:function(t){u=u.filter(function(e){return isNaN(e.startTime)||void 0!==t&&e.startTime+e.duration<t})},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var r=0,n=0,i=e.length;n<i;n++)h(r,e.start(n)),r=e.end(n);0<t&&h(r,t)}else f()},abortRequests:function(){i.abort(),l=[]},executeRequest:function(e){switch(e.action){case E.default.ACTION_COMPLETE:u.push(e),p(e,T),a.debug("executeRequest trigger STREAM_COMPLETED"),r.trigger(b.default.STREAM_COMPLETED,{request:e,fragmentModel:this});break;case E.default.ACTION_DOWNLOAD:p(e,A),l.push(e),function(e){r.trigger(b.default.FRAGMENT_LOADING_STARTED,{sender:o,request:e}),i.load(e)}(e);break;default:a.warn("Unknown request action.")}},reset:function(){r.off(b.default.LOADING_COMPLETED,m,this),r.off(b.default.LOADING_DATA_PROGRESS,g,this),r.off(b.default.LOADING_ABANDONED,v,this),i&&i.reset(),y()},addExecutedRequest:function(e){u.push(e)}},a=(0,w.default)(t).getInstance().getLogger(o),y(),r.on(b.default.LOADING_COMPLETED,m,o),r.on(b.default.LOADING_DATA_PROGRESS,g,o),r.on(b.default.LOADING_ABANDONED,v,o),o}o.__dashjs_factory_name="FragmentModel";var a=i.default.getClassFactory(o);a.FRAGMENT_MODEL_LOADING=A,a.FRAGMENT_MODEL_EXECUTED=T,a.FRAGMENT_MODEL_CANCELED="canceled",a.FRAGMENT_MODEL_FAILED="failed",i.default.updateClassFactory(o.__dashjs_factory_name,a),r.default=a,t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../vo/FragmentRequest":516}],441:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/EventBus")),o=n(e("../../core/events/Events")),a=n(e("../../core/FactoryMaker"));function s(){var e=this.context,t=(0,i.default)(e).getInstance(),r=void 0;return{getValue:function(){return r},setValue:function(e){(r=e)&&t.trigger(o.default.MANIFEST_LOADED,{data:e})}}}s.__dashjs_factory_name="ManifestModel",r.default=a.default.getSingletonFactory(s),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352}],442:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function W(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(r,"__esModule",{value:!0});var q=n(e("../../dash/vo/UTCTiming")),i=n(e("../../core/FactoryMaker")),Y=e("../vo/metrics/HTTPRequest"),K=n(e("../constants/Constants")),X=n(e("../rules/abr/ABRRulesCollection")),Q=e("../utils/SupervisorTools");function o(){var e,t,r,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,_=void 0,b=void 0,E=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,M=void 0,R=void 0,O=void 0,P=void 0,C=void 0,D=void 0,I=void 0,L=void 0,N=void 0,k=void 0,F=void 0,j=void 0,B={scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso&ms"};function U(e){var t=void 0;for(t=0;t<R.length;t++)if(R[t].rulename===e)return t;return-1}function G(){return I?s||3:s}function H(e,t){V(e,t);var r=new q.default;r.schemeIdUri=e,r.value=t,o.push(r)}function V(r,n){(0,Q.checkParameterType)(r,"string"),(0,Q.checkParameterType)(n,"string"),o.forEach(function(e,t){e.schemeIdUri===r&&e.value===n&&o.splice(t,1)})}function z(){return I}return e={setABRStrategy:function(e){if(e!==K.default.ABR_STRATEGY_DYNAMIC&&e!==K.default.ABR_STRATEGY_BOLA&&e!==K.default.ABR_STRATEGY_THROUGHPUT)throw K.default.BAD_ARGUMENT_ERROR;T=e},getABRStrategy:function(){return T},setUseDefaultABRRules:function(e){(0,Q.checkParameterType)(e,"boolean"),S=e},getUseDefaultABRRules:function(){return S},getABRCustomRules:function(){return R},addABRCustomRule:function(e,t,r){if("string"!=typeof e||e!==X.default.ABANDON_FRAGMENT_RULES&&e!==X.default.QUALITY_SWITCH_RULES||"string"!=typeof t)throw K.default.BAD_ARGUMENT_ERROR;var n=U(t);-1===n?R.push({type:e,rulename:t,rule:r}):(R[n].type=e,R[n].rule=r)},removeABRCustomRule:function(e){if(e){var t=U(e);-1!==t&&R.splice(t,1)}else R=[]},setBandwidthSafetyFactor:function(e){(0,Q.checkParameterType)(e,"number"),_=e},getBandwidthSafetyFactor:function(){return _},setAbandonLoadTimeout:function(e){(0,Q.checkParameterType)(e,"number"),b=e},getAbandonLoadTimeout:function(){return b},setLastBitrateCachingInfo:function(e,t){if("boolean"!=typeof e||void 0!==t&&("number"!=typeof t||isNaN(t)))throw K.default.BAD_ARGUMENT_ERROR;f.enabled=e,void 0!==t&&(f.ttl=t)},getLastBitrateCachingInfo:function(){return f},setLastMediaSettingsCachingInfo:function(e,t){if("boolean"!=typeof e||void 0!==t&&("number"!=typeof t||isNaN(t)))throw K.default.BAD_ARGUMENT_ERROR;h.enabled=e,void 0!==t&&(h.ttl=t)},getLastMediaSettingsCachingInfo:function(){return h},setStableBufferTime:function(e){(0,Q.checkParameterType)(e,"number"),p=e},getStableBufferTime:function(){return z()?.6*G():isNaN(p)?M?20:12:p},setBufferTimeAtTopQuality:function(e){(0,Q.checkParameterType)(e,"number"),m=e},getBufferTimeAtTopQuality:function(){return m},setBufferTimeAtTopQualityLongForm:function(e){(0,Q.checkParameterType)(e,"number"),g=e},getBufferTimeAtTopQualityLongForm:function(){return g},setLongFormContentDurationThreshold:function(e){(0,Q.checkParameterType)(e,"number"),v=e},getLongFormContentDurationThreshold:function(){return v},setSegmentOverlapToleranceTime:function(e){(0,Q.checkParameterType)(e,"number"),y=e},getSegmentOverlapToleranceTime:function(){return y},getCacheLoadThresholdForType:function(e){return P[e]},setCacheLoadThresholdForType:function(e,t){(0,Q.checkParameterType)(t,"number"),(0,Q.checkIsVideoOrAudioType)(e),P[e]=t},setBufferToKeep:function(e){(0,Q.checkParameterType)(e,"number"),l=e},getBufferToKeep:function(){return l},setBufferAheadToKeep:function(e){(0,Q.checkParameterType)(e,"number"),c=e},getBufferAheadToKeep:function(){return c},setBufferPruningInterval:function(e){(0,Q.checkParameterType)(e,"number"),d=e},getBufferPruningInterval:function(){return d},setRetryAttemptsForType:function(e,t){if("number"!=typeof t||"string"!=typeof e||e!==Y.HTTPRequest.MPD_TYPE&&e!==Y.HTTPRequest.MEDIA_SEGMENT_TYPE)throw K.default.BAD_ARGUMENT_ERROR;E[e]=t},getRetryAttemptsForType:function(e){return z()?5*E[e]:E[e]},setRetryIntervalForType:function(e,t){(0,Q.checkParameterType)(t,"number"),w[e]=t},getRetryIntervalForType:function(e){return z()?w[e]/10:w[e]},setWallclockTimeUpdateInterval:function(e){(0,Q.checkParameterType)(e,"number"),A=e},getWallclockTimeUpdateInterval:function(){return A},setScheduleWhilePaused:function(e){(0,Q.checkParameterType)(e,"boolean"),u=e},getScheduleWhilePaused:function(){return u},getUseSuggestedPresentationDelay:function(){return i},setUseSuggestedPresentationDelay:function(e){(0,Q.checkParameterType)(e,"boolean"),i=e},setLiveDelayFragmentCount:function(e){(0,Q.checkParameterType)(e,"number"),a=e},getLiveDelayFragmentCount:function(){return a},getLiveDelay:G,setLiveDelay:function(e){void 0!==e&&(0,Q.checkParameterType)(e,"number"),s=e},setUseManifestDateHeaderTimeSource:function(e){(0,Q.checkParameterType)(e,"boolean"),n=e},getUseManifestDateHeaderTimeSource:function(){return n},addUTCTimingSource:H,removeUTCTimingSource:V,getUTCTimingSources:function(){return o},clearDefaultUTCTimingSources:function(){o=[]},restoreDefaultUTCTimingSources:function(){H(B.scheme,B.value)},setXHRWithCredentialsForType:function t(e,r){e?x[e]=!!r:Object.keys(x).forEach(function(e){t(e,r)})},getXHRWithCredentialsForType:function(e){var t=x[e];return void 0===t?x.default:t},setFastSwitchEnabled:function(e){(0,Q.checkParameterType)(e,"boolean"),M=e},getFastSwitchEnabled:function(){return M},setMovingAverageMethod:function(e){if(e!==K.default.MOVING_AVERAGE_SLIDING_WINDOW&&e!==K.default.MOVING_AVERAGE_EWMA)throw K.default.BAD_ARGUMENT_ERROR;O=e},getMovingAverageMethod:function(){return O},setJumpGaps:function(e){(0,Q.checkParameterType)(e,"boolean"),C=e},getJumpGaps:function(){return C},setSmallGapLimit:function(e){(0,Q.checkParameterType)(e,"number"),D=e},getSmallGapLimit:function(){return D},getLowLatencyEnabled:z,setLowLatencyEnabled:function(e){(0,Q.checkParameterType)(e,"boolean"),I=e},setCatchUpPlaybackRate:function(e){(0,Q.checkParameterType)(e,"number"),(0,Q.checkRange)(e,0,.5),j=e},getCatchUpPlaybackRate:function(){return j},setLowLatencyMinDrift:function(e){(0,Q.checkParameterType)(e,"number"),k=e},getLowLatencyMinDrift:function(){return k},setLowLatencyMaxDriftBeforeSeeking:function(e){(0,Q.checkParameterType)(e,"number"),F=e},getLowLatencyMaxDriftBeforeSeeking:function(){return F},setManifestUpdateRetryInterval:function(e){(0,Q.checkParameterType)(e,"number"),L=e},getManifestUpdateRetryInterval:function(){return L},setKeepProtectionMediaKeys:function(e){(0,Q.checkParameterType)(e,"boolean"),N=e},getKeepProtectionMediaKeys:function(){return N},getDefaultUtcTimingSource:function(){return B},reset:function(){}},u=n=!(i=!(o=[])),T=K.default.ABR_STRATEGY_DYNAMIC,f={enabled:!(M=!(S=!0)),ttl:36e4},h={enabled:!0,ttl:36e4},a=4,s=void 0,l=20,c=80,d=10,p=NaN,m=30,g=60,v=600,y=.2,_=.9,b=1e4,C=!(A=50),D=.8,x={default:!(L=100)},R=[],O=K.default.MOVING_AVERAGE_SLIDING_WINDOW,I=!1,k=.02,F=0,j=.5,W(t={},Y.HTTPRequest.MPD_TYPE,3),W(t,Y.HTTPRequest.XLINK_EXPANSION_TYPE,1),W(t,Y.HTTPRequest.MEDIA_SEGMENT_TYPE,3),W(t,Y.HTTPRequest.INIT_SEGMENT_TYPE,3),W(t,Y.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),W(t,Y.HTTPRequest.INDEX_SEGMENT_TYPE,3),W(t,Y.HTTPRequest.OTHER_TYPE,3),E=t,W(r={},Y.HTTPRequest.MPD_TYPE,500),W(r,Y.HTTPRequest.XLINK_EXPANSION_TYPE,500),W(r,Y.HTTPRequest.MEDIA_SEGMENT_TYPE,1e3),W(r,Y.HTTPRequest.INIT_SEGMENT_TYPE,1e3),W(r,Y.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),W(r,Y.HTTPRequest.INDEX_SEGMENT_TYPE,1e3),W(r,Y.HTTPRequest.OTHER_TYPE,1e3),w=r,(P={})[K.default.VIDEO]=50,P[K.default.AUDIO]=5,N=!1,e}o.__dashjs_factory_name="MediaPlayerModel",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/FactoryMaker":347,"../../dash/vo/UTCTiming":388,"../constants/Constants":400,"../rules/abr/ABRRulesCollection":478,"../utils/SupervisorTools":507,"../vo/metrics/HTTPRequest":534}],443:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var h=n(e("../constants/Constants")),v=n(e("../constants/MetricsConstants")),u=n(e("../vo/MetricsList")),y=e("../vo/metrics/HTTPRequest"),c=n(e("../vo/metrics/RepresentationSwitch")),p=n(e("../vo/metrics/BufferLevel")),m=n(e("../vo/metrics/BufferState")),_=n(e("../vo/metrics/DVRInfo")),b=n(e("../vo/metrics/DroppedFrames")),E=e("../vo/metrics/ManifestUpdate"),w=n(e("../vo/metrics/SchedulingInfo")),A=n(e("../../core/EventBus")),T=n(e("../vo/metrics/RequestsQueue")),S=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker"));function o(){var e,i=1e3,t=this.context,n=(0,A.default)(t).getInstance(),r=void 0;function o(){n.trigger(S.default.METRICS_CHANGED)}function a(e){n.trigger(S.default.METRIC_CHANGED,{mediaType:e}),o()}function l(e,t,r){n.trigger(S.default.METRIC_UPDATED,{mediaType:e,metric:t,value:r}),a(e)}function d(e,t,r){n.trigger(S.default.METRIC_ADDED,{mediaType:e,metric:t,value:r}),a(e)}function s(e){var t=void 0;return r.hasOwnProperty(e)?t=r[e]:(t=new u.default,r[e]=t),t}function f(e,t,r){var n=s(e);n[t].push(r),n[t].length>i&&n[t].shift()}function g(e,t,r){f(e,t,r),d(e,t,r)}return e={clearCurrentMetricsForType:function(e){delete r[e],a(e)},clearAllCurrentMetrics:function(){r={},o()},getReadOnlyMetricsFor:function(e){return r.hasOwnProperty(e)?r[e]:null},getMetricsFor:s,addHttpRequest:function e(t,r,n,i,o,a,s,u,l,c,d,f,h,p){var m=new y.HTTPRequest;o&&o!==i&&(e(t,null,n,i,null,null,s,u,null,null,null,f,null,null),m.actualurl=o),m.tcpid=r,m.type=n,m.url=i,m.range=s,m.trequest=u,m.tresponse=l,m.responsecode=d,m._tfinish=c,m._stream=t,m._mediaduration=f,m._responseHeaders=h,m._serviceLocation=a,p?p.forEach(function(e){!function(e,t,r,n){var i=new y.HTTPRequestTrace;i.s=t,i.d=r,i.b=n,e.trace.push(i),e.interval||(e.interval=0),e.interval+=r}(m,e.s,e.d,e.b)}):(delete m.interval,delete m.trace),g(t,v.default.HTTP_REQUEST,m)},addRepresentationSwitch:function(e,t,r,n,i){var o=new c.default;o.t=t,o.mt=r,o.to=n,i?o.lto=i:delete o.lto,g(e,v.default.TRACK_SWITCH,o)},addBufferLevel:function(e,t,r){var n=new p.default;n.t=t,n.level=r,g(e,v.default.BUFFER_LEVEL,n)},addBufferState:function(e,t,r){var n=new m.default;n.target=r,n.state=t,g(e,v.default.BUFFER_STATE,n)},addDVRInfo:function(e,t,r,n){var i=new _.default;i.time=t,i.range=n,i.manifestInfo=r,g(e,v.default.DVR_INFO,i)},addDroppedFrames:function(e,t){var r=new b.default,n=s(e).DroppedFrames;r.time=t.creationTime,r.droppedFrames=t.droppedVideoFrames,0<n.length&&n[n.length-1]==r||g(e,v.default.DROPPED_FRAMES,r)},addSchedulingInfo:function(e,t,r,n,i,o,a,s,u){var l=new w.default;l.mediaType=e,l.t=t,l.type=r,l.startTime=n,l.availabilityStartTime=i,l.duration=o,l.quality=a,l.range=s,l.state=u,g(e,v.default.SCHEDULING_INFO,l)},addRequestsQueue:function(e,t,r){var n=new T.default;n.loadingRequests=t,n.executedRequests=r,s(e).RequestsQueue=n,d(e,v.default.REQUESTS_QUEUE,n)},addManifestUpdate:function(e,t,r,n,i,o,a,s,u,l){var c=new E.ManifestUpdate;c.mediaType=e,c.type=t,c.requestTime=r,c.fetchTime=n,c.availabilityStartTime=i,c.presentationStartTime=o,c.clientTimeOffset=a,c.currentTime=s,c.buffered=u,c.latency=l,f(h.default.STREAM,v.default.MANIFEST_UPDATE,c),d(e,v.default.MANIFEST_UPDATE,c)},updateManifestUpdateInfo:function(e,t){if(e){for(var r in t)e[r]=t[r];l(e.mediaType,v.default.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,r,n,i){if(e){var o=new E.ManifestUpdateStreamInfo;o.id=t,o.index=r,o.start=n,o.duration=i,e.streamInfo.push(o),l(e.mediaType,v.default.MANIFEST_UPDATE_STREAM_INFO,e)}},addManifestUpdateRepresentationInfo:function(e,t,r,n,i,o,a,s){if(e){var u=new E.ManifestUpdateRepresentationInfo;u.id=t,u.index=r,u.streamIndex=n,u.mediaType=i,u.startNumber=a,u.fragmentInfoType=s,u.presentationTimeOffset=o,e.representationInfo.push(u),l(e.mediaType,v.default.MANIFEST_UPDATE_TRACK_INFO,e)}},addPlayList:function(e){var t=h.default.STREAM;e.trace&&Array.isArray(e.trace)?e.trace.forEach(function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel}):delete e.trace,g(t,v.default.PLAY_LIST,e)},addDVBErrors:function(e){g(h.default.STREAM,v.default.DVB_ERRORS,e)}},r={},e}o.__dashjs_factory_name="MetricsModel",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../constants/Constants":400,"../constants/MetricsConstants":401,"../vo/MetricsList":522,"../vo/metrics/BufferLevel":530,"../vo/metrics/BufferState":531,"../vo/metrics/DVRInfo":532,"../vo/metrics/DroppedFrames":533,"../vo/metrics/HTTPRequest":534,"../vo/metrics/ManifestUpdate":535,"../vo/metrics/RepresentationSwitch":537,"../vo/metrics/RequestsQueue":538,"../vo/metrics/SchedulingInfo":539}],444:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=n(e("../vo/URIFragmentData")),i=n(e("../../core/FactoryMaker"));function o(){var u=void 0;return{initialize:function(e){if(u=new l.default,!e)return null;var t=e.indexOf("#");if(-1!==t)for(var r=e.substr(t+1).split("&"),n=0,i=r.length;n<i;++n){var o=r[n],a=o.indexOf("=");if(-1!==a){var s=o.substring(0,a);u.hasOwnProperty(s)&&(u[s]=o.substr(a+1))}}},getURIFragmentData:function(){return u}}}o.__dashjs_factory_name="URIFragmentModel",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/FactoryMaker":347,"../vo/URIFragmentData":529}],445:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),p=n(e("../../core/EventBus")),m=n(e("../../core/events/Events")),g=n(e("../../core/Debug"));function o(){var e=void 0,t=void 0,a=void 0,r=void 0,n=void 0,i="element is not video or audio DOM type!",o=this.context,s=(0,p.default)(o).getInstance(),u=[];function l(){a&&(a.playbackRate=n||1,a.removeEventListener("canplay",l))}function c(e){a&&(a.readyState<=2&&0<e?a.addEventListener("canplay",l):a.playbackRate=e)}function d(){return 0<u.length}function f(){if(a&&d()&&0===a.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),a.dispatchEvent(e)}}function h(){return a?a.buffered:null}return e={initialize:function(){s.on(m.default.PLAYBACK_PLAYING,f,this)},setCurrentTime:function(t,e){if(a){if(a.currentTime==t)return;try{t=e?function(e){var t=h(),r=e,n=9999999999;if(t)for(var i=0;i<t.length;i++){var o=t.start(i),a=t.end(i),s=Math.abs(o-e),u=Math.abs(a-e);if(o<=e&&e<=a)return e;s<n&&(n=s,r=o),u<n&&(n=u,r=a)}return r}(t):t,a.currentTime=t}catch(e){0===a.readyState&&e.code===e.INVALID_STATE_ERR&&setTimeout(function(){a.currentTime=t},400)}}},play:function(){if(a){a.autoplay=!0;var e=a.play();e&&e.catch&&"undefined"!=typeof Promise&&e.catch(function(e){"NotAllowedError"===e.name&&s.trigger(m.default.PLAYBACK_NOT_ALLOWED),t.warn("Caught pending play exception - continuing ("+e+")")})}},isPaused:function(){return a?a.paused:null},pause:function(){a&&(a.pause(),a.autoplay=!1)},isSeeking:function(){return a?a.seeking:null},getTime:function(){return a?a.currentTime:null},getPlaybackRate:function(){return a?a.playbackRate:null},setPlaybackRate:c,getPlayedRanges:function(){return a?a.played:null},getEnded:function(){return a?a.ended:null},setStallState:function(e,t){!function(e,t){t?function(e){var t=void 0;if(null===e||a.seeking||-1!==u.indexOf(e))return;u.push(e),a&&1===u.length&&((t=document.createEvent("Event")).initEvent("waiting",!0,!1),n=a.playbackRate,c(0),a.dispatchEvent(t))}(e):function(e){var t=u.indexOf(e),r=void 0;if(null===e)return;-1!==t&&u.splice(t,1);a&&!1===d()&&0===a.playbackRate&&(c(n||1),a.paused||((r=document.createEvent("Event")).initEvent("playing",!0,!1),a.dispatchEvent(r)))}(e)}(e,t)},getElement:function(){return a},setElement:function(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw i;(a=e)&&(a.preload="auto")},setSource:function(e){a&&(e?a.src=e:(a.removeAttribute("src"),a.load()))},getSource:function(){return a?a.src:null},getTTMLRenderingDiv:function(){return r},setTTMLRenderingDiv:function(e){(r=e).style.position="absolute",r.style.display="flex",r.style.overflow="hidden",r.style.pointerEvents="none",r.style.top=0,r.style.left=0},getPlaybackQuality:function(){if(!a)return null;var e="webkitDroppedFrameCount"in a&&"webkitDecodedFrameCount"in a,t=null;return"getVideoPlaybackQuality"in a?t=a.getVideoPlaybackQuality():e&&(t={droppedVideoFrames:a.webkitDroppedFrameCount,totalVideoFrames:a.webkitDroppedFrameCount+a.webkitDecodedFrameCount,creationTime:new Date}),t},addEventListener:function(e,t){a&&a.addEventListener(e,t)},removeEventListener:function(e,t){a&&a.removeEventListener(e,t)},getReadyState:function(){return a?a.readyState:NaN},getBufferRange:h,getClientWidth:function(){return a?a.clientWidth:NaN},getClientHeight:function(){return a?a.clientHeight:NaN},getTextTracks:function(){return a?a.textTracks:[]},getTextTrack:function(e,t,r,n,i){if(a)for(var o=0;o<a.textTracks.length;o++)if(a.textTracks[o].kind===e&&(!t||a.textTracks[o].label==t)&&a.textTracks[o].language===r&&a.textTracks[o].isTTML===n&&a.textTracks[o].isEmbedded===i)return a.textTracks[o];return null},addTextTrack:function(e,t,r){return a?a.addTextTrack(e,t,r):null},appendChild:function(e){a&&(a.appendChild(e),void 0!==e.isTTML&&(a.textTracks[a.textTracks.length-1].isTTML=e.isTTML,a.textTracks[a.textTracks.length-1].isEmbedded=e.isEmbedded))},removeChild:function(e){a&&a.removeChild(e)},getVideoWidth:function(){return a?a.videoWidth:NaN},getVideoHeight:function(){return a?a.videoHeight:NaN},getVideoRelativeOffsetTop:function(){return a&&a.parentNode?a.getBoundingClientRect().top-a.parentNode.getBoundingClientRect().top:NaN},getVideoRelativeOffsetLeft:function(){return a&&a.parentNode?a.getBoundingClientRect().left-a.parentNode.getBoundingClientRect().left:NaN},reset:function(){s.off(m.default.PLAYBACK_PLAYING,f,this)}},t=(0,g.default)(o).getInstance().getLogger(e),e}o.__dashjs_factory_name="VideoModel",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352}],446:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){var o=(e=e||{}).requestModifier,m=e.boxParser;function g(t,e){t.reader.read().then(e).catch(function(e){t.onerror&&200===t.response.status&&t.onerror(e)})}function v(i,t){if(1<(i=i.filter(function(e){return e.bytes>t/4/i.length})).length){var e=(o=0,a=(i[i.length-1].ts-i[0].ts)/i.length,i.forEach(function(e,t){var r=i[t+1];if(r){var n=r.ts-e.ts;o+=n<a?n:0}}),{v:o});if("object"==typeof e)return e.v}var o,a;return null}return{load:function(p){var e=new Date,t=p.request,r=new Headers;t.range&&r.append("Range","bytes="+t.range),t.requestStartDate||(t.requestStartDate=e),o&&o.modifyRequestHeader({setRequestHeader:function(e,t){r.append(e,t)}});var n=void 0;"function"==typeof window.AbortController&&(n=new AbortController,p.abortController=n);var i={method:p.method,headers:r,credentials:p.withCredentials?"include":void 0,signal:n?n.signal:void 0};fetch(p.url,i).then(function(e){p.response||(p.response={}),p.response.status=e.status,p.response.statusText=e.statusText,p.response.responseURL=e.url,e.ok||p.onerror();var t="",r=!0,n=!1,i=void 0;try{for(var o,a=e.headers.keys()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t+=s+": "+e.headers.get(s)+"\n"}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}if(p.response.responseHeaders=t,!e.body)return e.arrayBuffer().then(function(e){var t={loaded:(p.response.response=e).byteLength,total:e.byteLength,stream:!1};p.progress(t),p.onload(),p.onend()});var u=parseInt(e.headers.get("Content-Length"),10),l=0,c=!1,d=new Uint8Array,f=0;p.reader=e.body.getReader();var h=[];g(p,function e(t){var r=t.value;if(t.done)return d&&(p.progress({loaded:l,total:isNaN(u)?l:u,lengthComputable:!0,time:v(h,l),stream:!0}),p.response.response=d.buffer),p.onload(),void p.onend();if(r&&0<r.length){d=function(e,t){if(0===e.length)return t;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(d,r),l+=r.length,h.push({ts:Date.now(),bytes:r.length});var n=m.findLastTopIsoBoxCompleted(["moov","mdat"],d,f);if(n.found){var i=n.lastCompletedOffset+n.size,o=void 0;d=i===d.length?(o=d,new Uint8Array):(o=new Uint8Array(d.subarray(0,i)),d.subarray(i)),p.progress({data:o.buffer,lengthComputable:!1,noTrace:!0}),f=0}else f=n.lastCompletedOffset,c||(p.progress({lengthComputable:!1,noTrace:!0}),c=!0)}g(p,e)})}).catch(function(e){p.onerror&&p.onerror(e)})},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel()}catch(e){}},calculateDownloadedTime:v}}a.__dashjs_factory_name="FetchLoader";var s=o.default.getClassFactory(a);r.default=s,t.exports=r.default},{"../../core/FactoryMaker":347}],447:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(r,"__esModule",{value:!0});var C=n(e("./XHRLoader")),D=n(e("./FetchLoader")),I=e("../vo/metrics/HTTPRequest"),o=n(e("../../core/FactoryMaker")),a=n(e("../../core/errors/Errors")),L=n(e("../vo/DashJSError"));function s(e){e=e||{};var t,r,n,_=this.context,b=e.errHandler,E=e.metricsModel,w=e.mediaPlayerModel,A=e.requestModifier,T=e.boxParser,S=e.useFetch||!1,x=void 0,M=void 0,R=void 0,O=void 0,P=void 0;return t={load:function(e){e.request&&!function t(r,n){var i=r.request,o=[],a=!0,s=!0,u=new Date,l=u,c=0,d=void 0;if(!A||!E||!b)throw new Error("config object is not correct or missing");function e(e){s=!1,i.requestStartDate=u,i.requestEndDate=new Date,i.firstByteDate=i.firstByteDate||u,i.checkExistenceOnly||(E.addHttpRequest(i.mediaType,null,i.type,i.url,d.response?d.response.responseURL:null,i.serviceLocation||null,i.range||null,i.requestStartDate,i.firstByteDate,i.requestEndDate,d.response?d.response.status:null,i.duration,d.response&&d.response.getAllResponseHeaders?d.response.getAllResponseHeaders():d.response?d.response.responseHeaders:[],e?o:null),i.type===I.HTTPRequest.MPD_TYPE&&E.addManifestUpdate("stream",i.type,i.requestStartDate,i.requestEndDate))}function f(){-1!==x.indexOf(d)&&(x.splice(x.indexOf(d),1),s&&(e(!1),0<n?function(){n--;var e={config:r};R.push(e),e.timeout=setTimeout(function(){-1!==R.indexOf(e)&&(R.splice(R.indexOf(e),1),t(r,n))},w.getRetryIntervalForType(i.type))}():(b.downloadError(O[i.type],i.url,i),b.error(new L.default(P[i.type],i.url+" is not available",{request:i,response:d.response})),r.error&&r.error(i,"error",d.response.statusText),r.complete&&r.complete(i,d.response.statusText))))}var h=void 0;h=S&&window.fetch&&"arraybuffer"===i.responseType&&i.type===I.HTTPRequest.MEDIA_SEGMENT_TYPE?(0,D.default)(_).create({requestModifier:A,boxParser:T}):(0,C.default)(_).create({requestModifier:A,boxParser:T});var p=A.modifyRequestURL(i.url),m=i.checkExistenceOnly?I.HTTPRequest.HEAD:I.HTTPRequest.GET,g=w.getXHRWithCredentialsForType(i.type);d={url:p,method:m,withCredentials:g,request:i,onload:function(){200<=d.response.status&&d.response.status<=299&&(e(!0),r.success&&r.success(d.response.response,d.response.statusText,d.response.responseURL),r.complete&&r.complete(i,d.response.statusText))},onend:f,onerror:f,progress:function(e){var t=new Date;a&&(a=!1,(!e.lengthComputable||e.lengthComputable&&e.total!==e.loaded)&&(i.firstByteDate=t)),e.lengthComputable&&(i.bytesLoaded=e.loaded,i.bytesTotal=e.total),e.noTrace||(o.push({s:l,d:e.time?e.time:t.getTime()-l.getTime(),b:[e.loaded?e.loaded-c:0]}),l=t,c=e.loaded),r.progress&&e&&r.progress(e)},onabort:function(){r.abort&&r.abort(i)},loader:h};var v,y=(new Date).getTime();isNaN(i.delayLoadingTime)||y>=i.delayLoadingTime?(x.push(d),h.load(d)):(v={httpRequest:d},M.push(v),v.delayTimeout=setTimeout(function(){if(-1!==M.indexOf(v)){M.splice(M.indexOf(v),1);try{u=new Date,l=u,x.push(v.httpRequest),h.load(v.httpRequest)}catch(e){v.httpRequest.onerror()}}},i.delayLoadingTime-y))}(e,w.getRetryAttemptsForType(e.request.type))},abort:function(){R.forEach(function(e){clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)}),R=[],M.forEach(function(e){return clearTimeout(e.delayTimeout)}),M=[],x.forEach(function(e){e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e),e.onabort()}),x=[]}},x=[],M=[],R=[],i(r={},I.HTTPRequest.MPD_TYPE,a.default.DOWNLOAD_ERROR_ID_MANIFEST),i(r,I.HTTPRequest.XLINK_EXPANSION_TYPE,a.default.DOWNLOAD_ERROR_ID_XLINK),i(r,I.HTTPRequest.INIT_SEGMENT_TYPE,a.default.DOWNLOAD_ERROR_ID_INITIALIZATION),i(r,I.HTTPRequest.MEDIA_SEGMENT_TYPE,a.default.DOWNLOAD_ERROR_ID_CONTENT),i(r,I.HTTPRequest.INDEX_SEGMENT_TYPE,a.default.DOWNLOAD_ERROR_ID_CONTENT),i(r,I.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,a.default.DOWNLOAD_ERROR_ID_CONTENT),i(r,I.HTTPRequest.OTHER_TYPE,a.default.DOWNLOAD_ERROR_ID_CONTENT),O=r,i(n={},I.HTTPRequest.MPD_TYPE,a.default.DOWNLOAD_ERROR_ID_MANIFEST_CODE),i(n,I.HTTPRequest.XLINK_EXPANSION_TYPE,a.default.DOWNLOAD_ERROR_ID_XLINK_CODE),i(n,I.HTTPRequest.INIT_SEGMENT_TYPE,a.default.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),i(n,I.HTTPRequest.MEDIA_SEGMENT_TYPE,a.default.DOWNLOAD_ERROR_ID_CONTENT_CODE),i(n,I.HTTPRequest.INDEX_SEGMENT_TYPE,a.default.DOWNLOAD_ERROR_ID_CONTENT_CODE),i(n,I.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,a.default.DOWNLOAD_ERROR_ID_CONTENT_CODE),i(n,I.HTTPRequest.OTHER_TYPE,a.default.DOWNLOAD_ERROR_ID_CONTENT_CODE),P=n,t}s.__dashjs_factory_name="HTTPLoader";var u=o.default.getClassFactory(s);r.default=u,t.exports=r.default},{"../../core/FactoryMaker":347,"../../core/errors/Errors":349,"../vo/DashJSError":514,"../vo/metrics/HTTPRequest":534,"./FetchLoader":446,"./XHRLoader":448}],448:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){var i=(e=e||{}).requestModifier;return{load:function(e){var t=new Date,r=e.request,n=new XMLHttpRequest;n.open(e.method,e.url,!0),r.responseType&&(n.responseType=r.responseType),r.range&&n.setRequestHeader("Range","bytes="+r.range),r.requestStartDate||(r.requestStartDate=t),i&&(n=i.modifyRequestHeader(n)),n.withCredentials=e.withCredentials,n.onload=e.onload,n.onloadend=e.onend,n.onerror=e.onerror,n.onprogress=e.progress,n.onabort=e.onabort,n.send(),e.response=n},abort:function(e){var t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}}}a.__dashjs_factory_name="XHRLoader";var s=o.default.getClassFactory(a);r.default=s,t.exports=r.default},{"../../core/FactoryMaker":347}],449:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,null,[{key:"findCencContentProtection",value:function(e){for(var t=null,r=0;r<e.length;++r){var n=e[r];"urn:mpeg:dash:mp4protection:2011"===n.schemeIdUri.toLowerCase()&&"cenc"===n.value.toLowerCase()&&(t=n)}return t}},{key:"getPSSHData",value:function(e){var t=8,r=new DataView(e),n=r.getUint8(t);return t+=20,0<n&&(t+=4+16*r.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(e,t){var r=o.parsePSSHList(t);return r.hasOwnProperty(e.uuid.toLowerCase())?r[e.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?t.decodeArray(e.pssh.__text).buffer:null}},{key:"parsePSSHList",value:function(e){if(null===e)return[];for(var t=new DataView(e.buffer||e),r={},n=0;;){var i,o,a=void 0,s=n;if(n>=t.buffer.byteLength)break;if(i=n+t.getUint32(n),n+=4,1886614376===t.getUint32(n))if(n+=4,0===(o=t.getUint8(n))||1===o){n++,n+=3,a="";var u=void 0,l=void 0;for(u=0;u<4;u++)a+=1===(l=t.getUint8(n+u).toString(16)).length?"0"+l:l;for(n+=4,a+="-",u=0;u<2;u++)a+=1===(l=t.getUint8(n+u).toString(16)).length?"0"+l:l;for(n+=2,a+="-",u=0;u<2;u++)a+=1===(l=t.getUint8(n+u).toString(16)).length?"0"+l:l;for(n+=2,a+="-",u=0;u<2;u++)a+=1===(l=t.getUint8(n+u).toString(16)).length?"0"+l:l;for(n+=2,a+="-",u=0;u<6;u++)a+=1===(l=t.getUint8(n+u).toString(16)).length?"0"+l:l;n+=6,a=a.toLowerCase(),t.getUint32(n),n+=4,r[a]=t.buffer.slice(s,i),n=i}else n=i;else n=i}return r}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}r.default=i,t.exports=r.default},{}],450:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("./controllers/ProtectionController")),o=n(e("./controllers/ProtectionKeyController")),a=n(e("./ProtectionEvents")),s=n(e("./errors/ProtectionErrors")),l=n(e("./models/ProtectionModel_21Jan2015")),c=n(e("./models/ProtectionModel_3Feb2014")),d=n(e("./models/ProtectionModel_01b")),f=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],h=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function u(){var a=void 0,s=this.context;function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];if("function"==typeof e[n[Object.keys(n)[0]]])return n}return null}return a={createProtectionSystem:function(e){var t=null,r=(0,o.default)(s).getInstance();r.setConfig({debug:e.debug,BASE64:e.BASE64}),r.initialize();var n=function(e){var t=e.debug,r=t.getLogger(a),n=e.eventBus,i=e.errHandler,o=e.videoModel?e.videoModel.getElement():null;return o&&void 0===o.onencrypted||o&&void 0===o.mediaKeys?u(o,h)?(r.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),(0,c.default)(s).create({debug:t,eventBus:n,events:e.events,api:u(o,h)})):u(o,f)?(r.info("EME detected on this user agent! (ProtectionModel_01b)"),(0,d.default)(s).create({debug:t,eventBus:n,errHandler:i,events:e.events,api:u(o,f)})):(r.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(r.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),(0,l.default)(s).create({debug:t,eventBus:n,events:e.events}))}(e);return!t&&n&&(t=(0,i.default)(s).create({protectionModel:n,protectionKeyController:r,eventBus:e.eventBus,debug:e.debug,events:e.events,BASE64:e.BASE64,constants:e.constants}),e.capabilities.setEncryptedMediaSupported(!0)),t}}}u.__dashjs_factory_name="Protection";var p=dashjs.FactoryMaker.getClassFactory(u);p.events=a.default,p.errors=s.default,dashjs.FactoryMaker.updateClassFactory(u.__dashjs_factory_name,p),r.default=p,t.exports=r.default},{"./ProtectionEvents":451,"./controllers/ProtectionController":452,"./controllers/ProtectionKeyController":453,"./errors/ProtectionErrors":458,"./models/ProtectionModel_01b":459,"./models/ProtectionModel_21Jan2015":460,"./models/ProtectionModel_3Feb2014":461}],451:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/events/EventsBase");function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(o.prototype),"constructor",this).call(this),this.INTERNAL_KEY_MESSAGE="internalKeyMessage",this.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",this.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",this.KEY_ADDED="public_keyAdded",this.KEY_ERROR="public_keyError",this.KEY_MESSAGE="public_keyMessage",this.KEY_SESSION_CLOSED="public_keySessionClosed",this.KEY_SESSION_CREATED="public_keySessionCreated",this.KEY_SESSION_REMOVED="public_keySessionRemoved",this.KEY_STATUSES_CHANGED="public_keyStatusesChanged",this.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",this.KEY_SYSTEM_SELECTED="public_keySystemSelected",this.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",this.NEED_KEY="needkey",this.PROTECTION_CREATED="public_protectioncreated",this.PROTECTION_DESTROYED="public_protectiondestroyed",this.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",this.TEARDOWN_COMPLETE="protectionTeardownComplete",this.VIDEO_ELEMENT_SELECTED="videoElementSelected"}var a=new(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,((n=i)&&n.__esModule?n:{default:n}).default),o);r.default=a,t.exports=r.default},{"../../core/events/EventsBase":353}],452:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var R=n(e("../CommonEncryption")),O=n(e("../vo/MediaCapability")),P=n(e("../vo/KeySystemConfiguration")),C=n(e("../errors/ProtectionErrors")),D=n(e("../../vo/DashJSError"));function i(e){var t,b=(e=e||{}).protectionKeyController,E=e.protectionModel,w=e.eventBus,A=e.events,r=e.debug,c=e.BASE64,l=e.constants,s=[],T=void 0,d=void 0,f=void 0,u=void 0,n=void 0,h=void 0,S=void 0;function p(e,t){var r=R.default.getPSSHForKeySystem(S,e),n=x(S);if(r){for(var i=E.getAllInitData(),o=0;o<i.length;o++)if(b.initDataEquals(r,i[o]))return void T.warn("DRM: Ignoring initData because we have already seen it!");try{E.createKeySession(r,n,v(S),t)}catch(e){w.trigger(A.KEY_SESSION_CREATED,{data:null,error:new D.default(C.default.KEY_SESSION_CREATED_ERROR_CODE,C.default.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e?E.createKeySession(e,n,v(S),t):w.trigger(A.KEY_SESSION_CREATED,{data:null,error:new D.default(C.default.KEY_SESSION_CREATED_ERROR_CODE,C.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+S.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function m(e,t){E.loadKeySession(e,t,v(S))}function i(e){e?(E.setMediaElement(e),w.on(A.NEED_KEY,_,this)):null===e&&(E.setMediaElement(e),w.off(A.NEED_KEY,_,this))}function x(e){var t=null;if(e){var r=e.systemString;u&&(t=r in u?u[r]:null)}return t}function g(e){var t=x(e),r=[],n=[],i=t&&t.audioRobustness&&0<t.audioRobustness.length?t.audioRobustness:h,o=t&&t.videoRobustness&&0<t.videoRobustness.length?t.videoRobustness:h,a=v(e),s=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",u=t&&t.persistentState?t.persistentState:"temporary"===a?"optional":"required";return f.forEach(function(e){e.type===l.AUDIO?r.push(new O.default(e.codec,i)):e.type===l.VIDEO&&n.push(new O.default(e.codec,o))}),new P.default(r,n,s,u,[a])}function v(e){var t=x(e);return t&&t.sessionType?t.sessionType:n}function y(r,s){var u=this,t=[],l=void 0;if(S)for(l=0;l<r.length;l++){if(S===r[l].ks)if("break"===function(){t.push({ks:r[l].ks,configs:[g(S)]});return w.on(A.KEY_SYSTEM_ACCESS_COMPLETE,function e(t){w.off(A.KEY_SYSTEM_ACCESS_COMPLETE,e,u),t.error?s||w.trigger(A.KEY_SYSTEM_SELECTED,{error:new D.default(C.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,C.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+t.error)}):(T.info("DRM: KeySystem Access Granted"),w.trigger(A.KEY_SYSTEM_SELECTED,{data:t.data}),r[l].sessionId?m(r[l].sessionId,r[l].initData):r[l].initData&&p(r[l].initData,r[l].cdmData))},u),E.requestKeySystemAccess(t),"break"}())break}else if(void 0===S){var n;!function(){S=null,d.push(r);for(var e=0;e<r.length;e++)t.push({ks:r[e].ks,configs:[g(r[e].ks)]});function o(e){w.off(A.KEY_SYSTEM_ACCESS_COMPLETE,o,u),e.error?(S=void 0,w.off(A.INTERNAL_KEY_SYSTEM_SELECTED,n,u),s||w.trigger(A.KEY_SYSTEM_SELECTED,{data:null,error:new D.default(C.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,C.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+e.error)})):(a=e.data,T.info("DRM: KeySystem Access Granted ("+a.keySystem.systemString+")!  Selecting key system..."),E.selectKeySystem(a))}var a=void 0;n=function e(t){if(w.off(A.INTERNAL_KEY_SYSTEM_SELECTED,e,u),w.off(A.KEY_SYSTEM_ACCESS_COMPLETE,o,u),t.error)S=void 0,s||w.trigger(A.KEY_SYSTEM_SELECTED,{data:null,error:new D.default(C.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,C.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+t.error)});else{if(!E)return;S=E.getKeySystem(),w.trigger(A.KEY_SYSTEM_SELECTED,{data:a});var r=x(S);r&&r.serverCertificate&&0<r.serverCertificate.length&&E.setServerCertificate(c.decodeArray(r.serverCertificate).buffer);for(var n=0;n<d.length;n++)for(l=0;l<d[n].length;l++)if(S===d[n][l].ks){if(b.isClearKey(S)&&r&&r.hasOwnProperty("clearkeys")){var i={kids:Object.keys(r.clearkeys)};d[n][l].initData=(new TextEncoder).encode(JSON.stringify(i))}d[n][l].sessionId?m(d[n][l].sessionId,d[n][l].initData):null!==d[n][l].initData&&p(d[n][l].initData,d[n][l].cdmData);break}}},w.on(A.INTERNAL_KEY_SYSTEM_SELECTED,n,u),w.on(A.KEY_SYSTEM_ACCESS_COMPLETE,o,u),E.requestKeySystemAccess(t)}()}else d.push(r)}function M(e,t){w.trigger(A.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function o(e){e.error?w.trigger(A.KEY_STATUSES_CHANGED,{data:null,error:e.error}):T.debug("DRM: key status = "+e.status)}function a(e){T.debug("DRM: onKeyMessage");var t=e.data;w.trigger(A.KEY_MESSAGE,{data:t});var r=t.messageType?t.messageType:"license-request",n=t.message,i=t.sessionToken,o=x(S),a=S?S.systemString:null,s=b.getLicenseServer(S,o,r),u={sessionToken:i,messageType:r};if(n&&0!==n.byteLength){if(!s)return T.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+i.getSessionID()),void M(u);if(b.isClearKey(S)){var l=b.processClearKeyLicenseRequest(S,o,n);if(l)return T.debug("DRM: ClearKey license request handled by application!"),M(u),void E.updateKeySession(i,l)}var c=null;if(o&&o.serverURL){var d=o.serverURL;"string"==typeof d&&""!==d?c=d:"object"==typeof d&&d.hasOwnProperty(r)&&(c=d[r])}else c=o&&o.laURL&&""!==o.laURL?o.laURL:(c=S.getLicenseServerURLFromInitData(R.default.getPSSHData(i.initData)))||e.data.laURL;if(c=s.getServerURLFromMessage(c,n,r)){var f={},h=!1,p=function(e){if(e)for(var t in e)"authorization"===t.toLowerCase()&&(h=!0),f[t]=e[t]};o&&p(o.httpRequestHeaders),p(S.getRequestHeadersFromMessage(n)),o&&"boolean"==typeof o.withCredentials&&(h=o.withCredentials);var m=function(e,t,r,n){var i=e.response?s.getErrorResponse(e.response,r,n):"NONE";M(t,new D.default(C.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,C.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+r+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+i))},g=S.getLicenseRequestFromMessage(n),v=s.getHTTPMethod(r),y=s.getResponseType(a,r),_=o&&!isNaN(o.httpTimeout)?o.httpTimeout:8e3;!function e(t,r,n,i,o,a,s,u,l,c,d){var f=new XMLHttpRequest;f.open(n,t,!0);f.responseType=i;f.withCredentials=o;0<u&&(f.timeout=u);for(var h in r)f.setRequestHeader(h,r[h]);var p=function(){s--,setTimeout(function(){e(t,r,n,i,o,a,s,u,l,c,d)},1e3)};f.onload=function(){200===this.status||s<=0?l(this):(T.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+s),p())};f.ontimeout=f.onerror=function(){s<=0?d(this):(T.warn("License request network request failed . Retrying it... Pending retries: "+s),p())};f.onabort=function(){c(this)};f.send(a)}(c,f,v,y,h,g,3,_,function(e){if(E)if(200===e.status){var t=s.getLicenseMessage(e.response,a,r);null!==t?(M(u),E.updateKeySession(i,t)):m(e,u,a,r)}else m(e,u,a,r)},function(e){M(u,new D.default(C.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,C.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+a+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},function(e){M(u,new D.default(C.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,C.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+a+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))})}else M(u,new D.default(C.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,C.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}else M(u,new D.default(C.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,C.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function _(e,t){if(T.debug("DRM: onNeedKey"),"cenc"===e.key.initDataType)if(0===f.length&&(T.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(t=void 0===t?1:t+1)<5))s.push(setTimeout(function(){_(e,t)},500));else{var r=e.key.initData;if(ArrayBuffer.isView(r)&&(r=r.buffer),S){var n=R.default.getPSSHForKeySystem(S,r);if(n)for(var i=E.getAllInitData(),o=0;o<i.length;o++)if(b.initDataEquals(n,i[o]))return void T.warn("DRM: Ignoring initData because we have already seen it!")}T.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(r)));var a=b.getSupportedKeySystems(r,u);0!==a.length?y(a,!1):T.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!")}else T.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType)}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");!function(){if(!(w&&w.hasOwnProperty("on")&&b&&b.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}(),w.on(A.INTERNAL_KEY_MESSAGE,a,this),w.on(A.INTERNAL_KEY_STATUS_CHANGED,o,this),f.push(e);var t=b.getSupportedKeySystemsFromContentProtection(e.contentProtection);t&&0<t.length&&y(t,!0)},createKeySession:p,loadKeySession:m,removeKeySession:function(e){E.removeKeySession(e)},closeKeySession:function(e){E.closeKeySession(e)},setServerCertificate:function(e){E.setServerCertificate(e)},setMediaElement:i,setSessionType:function(e){n=e},setRobustnessLevel:function(e){h=e},setProtectionData:function(e){u=e,b.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return b.getSupportedKeySystemsFromContentProtection(e)},getKeySystems:function(){return b?b.getKeySystems():[]},stop:function(){E&&E.stop()},reset:function(){w.off(A.INTERNAL_KEY_MESSAGE,a,this),w.off(A.INTERNAL_KEY_STATUS_CHANGED,o,this),i(null),S=void 0,E&&(E.reset(),E=null),s.forEach(function(e){return clearTimeout(e)}),s=[],f=[]}},T=r.getLogger(t),d=[],f=[],n="temporary",h="",t}i.__dashjs_factory_name="ProtectionController",r.default=dashjs.FactoryMaker.getClassFactory(i),t.exports=r.default},{"../../vo/DashJSError":514,"../CommonEncryption":449,"../errors/ProtectionErrors":458,"../vo/KeySystemConfiguration":470,"../vo/MediaCapability":471}],453:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=n(e("./../CommonEncryption")),c=n(e("./../drm/KeySystemClearKey")),d=n(e("./../drm/KeySystemW3CClearKey")),f=n(e("./../drm/KeySystemWidevine")),h=n(e("./../drm/KeySystemPlayReady")),p=n(e("./../servers/DRMToday")),m=n(e("./../servers/PlayReady")),g=n(e("./../servers/Widevine")),v=n(e("./../servers/ClearKey")),y=n(e("../../constants/ProtectionConstants"));function i(){var i=this.context,t=void 0,r=void 0,n=void 0,u=void 0,o=void 0,a=void 0,s=void 0;return t={initialize:function(){u=[];var e=void 0;e=(0,h.default)(i).getInstance({BASE64:o}),u.push(e),e=(0,f.default)(i).getInstance({BASE64:o}),u.push(e),e=(0,c.default)(i).getInstance({BASE64:o}),u.push(e),a=e,e=(0,d.default)(i).getInstance({BASE64:o,debug:r}),u.push(e),s=e},setProtectionData:function(e){for(var t,r,n=0;n<u.length;n++){var i=u[n];i.hasOwnProperty("init")&&i.init((t=i.systemString,r=void 0,r=null,e&&(r=t in e?e[t]:null),r))}},isClearKey:function(e){return e===a||e===s},initDataEquals:function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0},getKeySystems:function(){return u},getKeySystemBySystemString:function(e){for(var t=0;t<u.length;t++)if(u[t].systemString===e)return u[t];return null},getSupportedKeySystemsFromContentProtection:function(e){var t=void 0,r=void 0,n=void 0,i=void 0,o=[];if(e)for(n=0;n<u.length;++n)for(r=u[n],i=0;i<e.length;++i)if((t=e[i]).schemeIdUri.toLowerCase()===r.schemeIdURI){var a=r.getInitData(t);a?o.push({ks:u[n],initData:a,cdmData:r.getCDMData(),sessionId:r.getSessionId(t)}):this.isClearKey(r)&&o.push({ks:r,initData:null})}return o},getSupportedKeySystems:function(e,t){for(var r=[],n=l.default.parsePSSHList(e),i=void 0,o=void 0,a=void 0,s=0;s<u.length;++s)o=(i=u[s]).systemString,a=!t||o in t,i.uuid in n&&a&&r.push({ks:i,initData:n[i.uuid],cdmData:i.getCDMData(),sessionId:i.getSessionId()});return r},getLicenseServer:function(e,t,r){if("license-release"===r||"individualization-request"===r)return null;var n=null;return t&&t.hasOwnProperty("drmtoday")?n=(0,p.default)(i).getInstance({BASE64:o}):e.systemString===y.default.WIDEVINE_KEYSTEM_STRING?n=(0,g.default)(i).getInstance():e.systemString===y.default.PLAYREADY_KEYSTEM_STRING?n=(0,m.default)(i).getInstance():e.systemString===y.default.CLEARKEY_KEYSTEM_STRING&&(n=(0,v.default)(i).getInstance()),n},processClearKeyLicenseRequest:function(e,t,r){try{return e.getClearKeysFromProtectionData(t,r)}catch(e){return n.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(e){e&&(e.debug&&(r=e.debug,n=r.getLogger(t)),e.BASE64&&(o=e.BASE64))}}}i.__dashjs_factory_name="ProtectionKeyController",r.default=dashjs.FactoryMaker.getSingletonFactory(i),t.exports=r.default},{"../../constants/ProtectionConstants":402,"./../CommonEncryption":449,"./../drm/KeySystemClearKey":454,"./../drm/KeySystemPlayReady":455,"./../drm/KeySystemW3CClearKey":456,"./../drm/KeySystemWidevine":457,"./../servers/ClearKey":462,"./../servers/DRMToday":463,"./../servers/PlayReady":464,"./../servers/Widevine":465}],454:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=n(e("../vo/KeyPair")),l=n(e("../vo/ClearKeyKeySet")),i=n(e("../CommonEncryption")),o=n(e("../../constants/ProtectionConstants")),a="e2719d58-a985-b3c9-781a-b030af78d30e",s=o.default.CLEARKEY_KEYSTEM_STRING;function c(e){var t=(e=e||{}).BASE64;return{uuid:a,schemeIdURI:"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e",systemString:s,getInitData:function(e){return i.default.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){var r=null;if(e){for(var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=[],o=0;o<n.kids.length;o++){var a=n.kids[o],s=e.clearkeys&&e.clearkeys.hasOwnProperty(a)?e.clearkeys[a]:null;if(!s)throw new Error("DRM: ClearKey keyID ("+a+") is not known!");i.push(new u.default(a,s))}r=new l.default(i)}return r}}}c.__dashjs_factory_name="KeySystemClearKey",r.default=dashjs.FactoryMaker.getSingletonFactory(c),t.exports=r.default},{"../../constants/ProtectionConstants":402,"../CommonEncryption":449,"../vo/ClearKeyKeySet":466,"../vo/KeyPair":468}],455:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var f=n(e("../CommonEncryption")),i=n(e("../../constants/ProtectionConstants")),o="9a04f079-9840-4286-ab92-e65be0885f95",a=i.default.PLAYREADY_KEYSTEM_STRING,s=void 0;function u(e){var l="utf16",c=(e=e||{}).BASE64;function d(){if(!c||!c.hasOwnProperty("decodeArray")||!c.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:o,schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:a,getInitData:function(e){var t,r,n,i=new Uint8Array([112,115,115,104,0,0,0,0]),o=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),a=0,s=null,u=void 0,l=void 0;if(d(),"pssh"in e)return f.default.parseInitDataFromContentProtection(e,c);if("pro"in e)s=c.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;s=c.decodeArray(e.prheader.__text)}return t=s.length,r=4+i.length+o.length+4+t,n=new ArrayBuffer(r),u=new Uint8Array(n),(l=new DataView(n)).setUint32(a,r),a+=4,u.set(i,a),a+=i.length,u.set(o,a),a+=o.length,l.setUint32(a,t),a+=4,u.set(s,a),a+=t,u.buffer},getRequestHeadersFromMessage:function(e){var t,r=void 0,n={},i=new DOMParser,o="utf16"===l?new Uint16Array(e):new Uint8Array(e);t=String.fromCharCode.apply(null,o);for(var a=(r=i.parseFromString(t,"application/xml")).getElementsByTagName("name"),s=r.getElementsByTagName("value"),u=0;u<a.length;u++)n[a[u].childNodes[0].nodeValue]=s[u].childNodes[0].nodeValue;return n.hasOwnProperty("Content")&&(n["Content-Type"]=n.Content,delete n.Content),n.hasOwnProperty("Content-Type")||(n["Content-Type"]="text/xml; charset="+l),n},getLicenseRequestFromMessage:function(e){var t=null,r=new DOMParser,n="utf16"===l?new Uint16Array(e):new Uint8Array(e);d();var i=String.fromCharCode.apply(null,n),o=r.parseFromString(i,"application/xml");if(o.getElementsByTagName("Challenge")[0]){var a=o.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;a&&(t=c.decode(a))}else if(o.getElementsByTagName("parsererror").length)return e;return t},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),r=t.getUint16(4,!0),n=6,i=new DOMParser,o=0;o<r;o++){var a=t.getUint16(n,!0);n+=2;var s=t.getUint16(n,!0);if(n+=2,1===a){var u=e.slice(n,n+s),l=String.fromCharCode.apply(null,new Uint16Array(u)),c=i.parseFromString(l,"application/xml");if(c.getElementsByTagName("LA_URL")[0]){var d=c.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(d)return d}if(c.getElementsByTagName("LUI_URL")[0]){var f=c.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(f)return f}}else n+=s}return null},getCDMData:function(){var e=void 0,t=void 0,r=void 0,n=void 0;if(d(),s&&s.cdmData){for(e=[],n=0;n<s.cdmData.length;++n)e.push(s.cdmData.charCodeAt(n)),e.push(0);for(e=String.fromCharCode.apply(null,e),e=c.encode(e),t='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",e),r=[],n=0;n<t.length;++n)r.push(t.charCodeAt(n)),r.push(0);return new Uint8Array(r).buffer}return null},getSessionId:function(e){return s&&s.sessionId?s.sessionId:e&&e.sessionId?e.sessionId:null},setPlayReadyMessageFormat:function(e){if("utf8"!==e&&"utf16"!==e)throw new Error("Illegal PlayReady message format! -- "+e);l=e},init:function(e){e&&(s=e)}}}u.__dashjs_factory_name="KeySystemPlayReady",r.default=dashjs.FactoryMaker.getSingletonFactory(u),t.exports=r.default},{"../../constants/ProtectionConstants":402,"../CommonEncryption":449}],456:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=n(e("../vo/KeyPair")),c=n(e("../vo/ClearKeyKeySet")),i=n(e("../CommonEncryption")),o=n(e("../../constants/ProtectionConstants")),a="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",s=o.default.CLEARKEY_KEYSTEM_STRING;function u(e){var t=void 0,r=e.BASE64,u=e.debug.getLogger(t);return t={uuid:a,schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:s,getInitData:function(e){return i.default.parseInitDataFromContentProtection(e,r)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){var r=null;if(e){for(var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=[],o=0;o<n.kids.length;o++){var a=n.kids[o],s=e.clearkeys&&e.clearkeys.hasOwnProperty(a)?e.clearkeys[a]:null;if(!s)throw new Error("DRM: ClearKey keyID ("+a+") is not known!");i.push(new l.default(a,s))}r=new c.default(i),u.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return r}}}u.__dashjs_factory_name="KeySystemW3CClearKey",r.default=dashjs.FactoryMaker.getSingletonFactory(u),t.exports=r.default},{"../../constants/ProtectionConstants":402,"../CommonEncryption":449,"../vo/ClearKeyKeySet":466,"../vo/KeyPair":468}],457:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../CommonEncryption")),o=n(e("../../constants/ProtectionConstants")),a="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",s=o.default.WIDEVINE_KEYSTEM_STRING;function u(e){var t=null,r=(e=e||{}).BASE64;return{uuid:a,schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:s,init:function(e){e&&(t=e)},getInitData:function(e){return i.default.parseInitDataFromContentProtection(e,r)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(e){return t&&t.sessionId?t.sessionId:e&&e.sessionId?e.sessionId:null}}}u.__dashjs_factory_name="KeySystemWidevine",r.default=dashjs.FactoryMaker.getSingletonFactory(u),t.exports=r.default},{"../../constants/ProtectionConstants":402,"../CommonEncryption":449}],458:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../../core/errors/ErrorsBase");function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(o.prototype),"constructor",this).call(this),this.MEDIA_KEYERR_CODE=100,this.MEDIA_KEYERR_UNKNOWN_CODE=101,this.MEDIA_KEYERR_CLIENT_CODE=102,this.MEDIA_KEYERR_SERVICE_CODE=103,this.MEDIA_KEYERR_OUTPUT_CODE=104,this.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,this.MEDIA_KEYERR_DOMAIN_CODE=106,this.MEDIA_KEY_MESSAGE_ERROR_CODE=107,this.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,this.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,this.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,this.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,this.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,this.KEY_SESSION_CREATED_ERROR_CODE=113,this.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,this.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",this.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",this.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",this.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",this.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",this.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",this.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",this.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",this.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",this.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",this.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",this.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",this.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",this.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --"}var a=new(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,((n=i)&&n.__esModule?n:{default:n}).default),o);r.default=a,t.exports=r.default},{"../../../core/errors/ErrorsBase":350}],459:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var b=n(e("../controllers/ProtectionKeyController")),E=n(e("../vo/NeedKey")),w=n(e("../../vo/DashJSError")),A=n(e("../vo/KeyMessage")),T=n(e("../vo/KeySystemConfiguration")),S=n(e("../vo/KeySystemAccess")),x=n(e("../errors/ProtectionErrors"));function i(e){e=e||{};var t=this.context,f=e.eventBus,h=e.events,r=e.debug,a=e.api,s=e.errHandler,n=void 0,u=void 0,p=void 0,i=void 0,m=void 0,l=void 0,c=void 0,d=void 0,o=void 0;function g(){p&&_();for(var e=0;e<c.length;e++)v(c[e]);f.trigger(h.TEARDOWN_COMPLETE)}function v(t){try{p[a.cancelKeyRequest](i.systemString,t.sessionID)}catch(e){f.trigger(h.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+t.sessionID+") "+e.message})}}function y(e,t){if(t&&e){for(var r=e.length,n=0;n<r;n++)if(e[n].sessionID==t)return e[n];return null}return null}function _(){p.removeEventListener(a.keyerror,o),p.removeEventListener(a.needkey,o),p.removeEventListener(a.keymessage,o),p.removeEventListener(a.keyadded,o)}return n={getAllInitData:function(){for(var e=[],t=0;t<l.length;t++)e.push(l[t].initData);for(t=0;t<c.length;t++)e.push(c[t].initData);return e},requestKeySystemAccess:function(e){var t=p;t=t||document.createElement("video");for(var r=!1,n=0;n<e.length;n++)for(var i=e[n].ks.systemString,o=e[n].configs,a=null,s=0;s<o.length;s++){var u=o[s].videoCapabilities;if(u&&0!==u.length){a=[];for(var l=0;l<u.length;l++)""!==t.canPlayType(u[l].contentType,i)&&a.push(u[l])}if(a&&(!a||0!==a.length)){r=!0;var c=new T.default(null,a),d=m.getKeySystemBySystemString(i);f.trigger(h.KEY_SYSTEM_ACCESS_COMPLETE,{data:new S.default(d,c)});break}}r||f.trigger(h.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return i},selectKeySystem:function(e){i=e.keySystem,f.trigger(h.INTERNAL_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){if(p!==e){if(p){_();for(var t=0;t<c.length;t++)v(c[t]);c=[]}(p=e)&&(p.addEventListener(a.keyerror,o),p.addEventListener(a.needkey,o),p.addEventListener(a.keymessage,o),p.addEventListener(a.keyadded,o),f.trigger(h.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!i)throw new Error("Can not create sessions until you have selected a key system");if(d||0===c.length){var t={sessionID:null,initData:e,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return l.push(t),p[a.generateKeyRequest](i.systemString,new Uint8Array(e)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var r=e.sessionID;if(m.isClearKey(i))for(var n=0;n<t.keyPairs.length;n++)p[a.addKey](i.systemString,t.keyPairs[n].key,t.keyPairs[n].keyID,r);else p[a.addKey](i.systemString,new Uint8Array(t),new Uint8Array(e.initData),r)},closeKeySession:v,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:g,reset:g},u=r.getLogger(n),i=p=null,l=[],c=[],m=(0,b.default)(t).getInstance(),o={handleEvent:function(e){var t=null;switch(e.type){case a.needkey:var r=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;f.trigger(h.NEED_KEY,{key:new E.default(r,"cenc")});break;case a.keyerror:if(t=(t=y(c,e.sessionId))||y(l,e.sessionId)){var n=x.default.MEDIA_KEYERR_CODE,i="";switch(e.errorCode.code){case 1:n=x.default.MEDIA_KEYERR_UNKNOWN_CODE,i+="MEDIA_KEYERR_UNKNOWN - "+x.default.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:n=x.default.MEDIA_KEYERR_CLIENT_CODE,i+="MEDIA_KEYERR_CLIENT - "+x.default.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:n=x.default.MEDIA_KEYERR_SERVICE_CODE,i+="MEDIA_KEYERR_SERVICE - "+x.default.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:n=x.default.MEDIA_KEYERR_OUTPUT_CODE,i+="MEDIA_KEYERR_OUTPUT - "+x.default.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:n=x.default.MEDIA_KEYERR_HARDWARECHANGE_CODE,i+="MEDIA_KEYERR_HARDWARECHANGE - "+x.default.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:n=x.default.MEDIA_KEYERR_DOMAIN_CODE,i+="MEDIA_KEYERR_DOMAIN - "+x.default.MEDIA_KEYERR_DOMAIN_MESSAGE}i+="  System Code = "+e.systemCode,f.trigger(h.KEY_ERROR,{data:new w.default(n,i,t)})}else u.error("No session token found for key error");break;case a.keyadded:(t=(t=y(c,e.sessionId))||y(l,e.sessionId))?(u.debug("DRM: Key added."),f.trigger(h.KEY_ADDED,{data:t})):u.debug("No session token found for key added");break;case a.keymessage:if((d=null!==e.sessionId&&void 0!==e.sessionId)?!(t=y(c,e.sessionId))&&0<l.length&&(t=l.shift(),c.push(t),t.sessionID=e.sessionId,f.trigger(h.KEY_SESSION_CREATED,{data:t})):0<l.length&&(t=l.shift(),c.push(t),0!==l.length&&(s.mediaKeyMessageError(x.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE),s.error(new w.default(x.default.MEDIA_KEY_MESSAGE_ERROR_CODE,x.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE)))),t){var o=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=o,f.trigger(h.INTERNAL_KEY_MESSAGE,{data:new A.default(t,o,e.defaultURL)})}else u.warn("No session token found for key message")}}},n}i.__dashjs_factory_name="ProtectionModel_01b",r.default=dashjs.FactoryMaker.getClassFactory(i),t.exports=r.default},{"../../vo/DashJSError":514,"../controllers/ProtectionKeyController":453,"../errors/ProtectionErrors":458,"../vo/KeyMessage":467,"../vo/KeySystemAccess":469,"../vo/KeySystemConfiguration":470,"../vo/NeedKey":472}],460:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var v=n(e("../controllers/ProtectionKeyController")),y=n(e("../vo/NeedKey")),_=n(e("../errors/ProtectionErrors")),b=n(e("../../vo/DashJSError")),E=n(e("../vo/KeyMessage")),w=n(e("../vo/KeySystemAccess")),A=n(e("../../constants/ProtectionConstants"));function i(e){e=e||{};var t=this.context,a=e.eventBus,s=e.events,r=e.debug,n=void 0,u=void 0,l=void 0,i=void 0,c=void 0,d=void 0,o=void 0,f=void 0;function h(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function p(e){for(var t=0;t<d.length;t++)if(d[t]===e){d.splice(t,1);break}}function m(e){var t=void 0,r=void 0;return e&&0<e.length&&(e[0]&&("string"==typeof e[0]?t=e[0]:r=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:r=e[1])),{status:t,keyId:r}}function g(t,e,r,n){var i={session:t,initData:e,sessionId:n,handleEvent:function(e){switch(e.type){case"keystatuseschange":a.trigger(s.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach(function(){var e=m(arguments);switch(e.status){case"expired":a.trigger(s.INTERNAL_KEY_STATUS_CHANGED,{error:new b.default(_.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,_.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});break;default:a.trigger(s.INTERNAL_KEY_STATUS_CHANGED,e)}});break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;a.trigger(s.INTERNAL_KEY_MESSAGE,{data:new E.default(this,t,void 0,e.messageType)})}},getSessionID:function(){return t.sessionId},getExpirationTime:function(){return t.expiration},getKeyStatuses:function(){return t.keyStatuses},getUsable:function(){var e=!1;return t.keyStatuses.forEach(function(){"usable"===m(arguments).status&&(e=!0)}),e},getSessionType:function(){return r}};return t.addEventListener("keystatuseschange",i),t.addEventListener("message",i),t.closed.then(function(){p(i),u.debug("DRM: Session closed.  SessionID = "+i.getSessionID()),a.trigger(s.KEY_SESSION_CLOSED,{data:i.getSessionID()})}),d.push(i),i}return n={getAllInitData:function(){for(var e=[],t=0;t<d.length;t++)d[t].initData&&e.push(d[t].initData);return e},requestKeySystemAccess:function(e){!function i(o,e){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess)return void a.trigger(s.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Insecure origins are not allowed"});!function(t){var n=o[t].ks,e=o[t].configs,r=n.systemString;r===A.default.PLAYREADY_KEYSTEM_STRING&&"required"===e[0].persistentState&&(r+=".recommendation"),navigator.requestMediaKeySystemAccess(r,e).then(function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,r=new w.default(n,t);r.mksa=e,a.trigger(s.KEY_SYSTEM_ACCESS_COMPLETE,{data:r})}).catch(function(e){++t<o.length?i(o,t):a.trigger(s.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! "+e.message})})}(e)}(e,0)},getKeySystem:function(){return l},selectKeySystem:function(t){t.mksa.createMediaKeys().then(function(e){l=t.keySystem,c=e,i?i.setMediaKeys(c).then(function(){a.trigger(s.INTERNAL_KEY_SYSTEM_SELECTED)}):a.trigger(s.INTERNAL_KEY_SYSTEM_SELECTED)}).catch(function(){a.trigger(s.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+t.keySystem.systemString+")! Could not create MediaKeys -- TODO"})})},setMediaElement:function(e){i!==e&&(i&&(i.removeEventListener("encrypted",o),i.setMediaKeys&&i.setMediaKeys(null)),(i=e)&&(i.addEventListener("encrypted",o),i.setMediaKeys&&c&&i.setMediaKeys(c)))},setServerCertificate:function(e){if(!l||!c)throw new Error("Can not set server certificate until you have selected a key system");c.setServerCertificate(e).then(function(){u.info("DRM: License server certificate successfully updated."),a.trigger(s.SERVER_CERTIFICATE_UPDATED)}).catch(function(e){a.trigger(s.SERVER_CERTIFICATE_UPDATED,{error:new b.default(_.default.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,_.default.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})})},createKeySession:function(e,t,r){if(!l||!c)throw new Error("Can not create sessions until you have selected a key system");var n=c.createSession(r),i=g(n,e,r),o=this.getKeySystem().systemString===A.default.CLEARKEY_KEYSTEM_STRING&&t&&t.clearkeys?"keyids":"cenc";n.generateRequest(o,e).then(function(){u.debug("DRM: Session created.  SessionID = "+i.getSessionID()),a.trigger(s.KEY_SESSION_CREATED,{data:i})}).catch(function(e){p(i),a.trigger(s.KEY_SESSION_CREATED,{data:null,error:new b.default(_.default.KEY_SESSION_CREATED_ERROR_CODE,_.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})})},updateKeySession:function(t,e){var r=t.session;f.isClearKey(l)&&(e=e.toJWK()),r.update(e).catch(function(e){a.trigger(s.KEY_ERROR,{data:new b.default(_.default.MEDIA_KEYERR_CODE,"Error sending update() message! "+e.name,t)})})},loadKeySession:function(t,e,r){if(!l||!c)throw new Error("Can not load sessions until you have selected a key system");for(var n=0;n<d.length;n++)if(t===d[n].sessionId)return void u.warn("DRM: Ignoring session ID because we have already seen it!");var i=c.createSession(r),o=g(i,e,r,t);i.load(t).then(function(e){e?(u.debug("DRM: Session loaded.  SessionID = "+o.getSessionID()),a.trigger(s.KEY_SESSION_CREATED,{data:o})):(p(o),a.trigger(s.KEY_SESSION_CREATED,{data:null,error:new b.default(_.default.KEY_SESSION_CREATED_ERROR_CODE,_.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+t+")")}))}).catch(function(e){p(o),a.trigger(s.KEY_SESSION_CREATED,{data:null,error:new b.default(_.default.KEY_SESSION_CREATED_ERROR_CODE,_.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+t+")! "+e.name)})})},removeKeySession:function(t){t.session.remove().then(function(){u.debug("DRM: Session removed.  SessionID = "+t.getSessionID()),a.trigger(s.KEY_SESSION_REMOVED,{data:t.getSessionID()})},function(e){a.trigger(s.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+t.getSessionID()+"). "+e.name})})},closeKeySession:function(t){h(t).catch(function(e){p(t),a.trigger(s.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+t.getSessionID()+") "+e.name})})},stop:function(){for(var e=void 0,t=0;t<d.length;t++)(e=d[t]).getUsable()||h(e).catch(function(){p(e)})},reset:function(){var r=d.length,n=void 0;0!==r?function(){for(var t=function(e){p(e),0===d.length&&(i?(i.removeEventListener("encrypted",o),i.setMediaKeys(null).then(function(){a.trigger(s.TEARDOWN_COMPLETE)})):a.trigger(s.TEARDOWN_COMPLETE))},e=0;e<r;e++)!function(e){n.session.closed.then(function(){t(e)}),h(n).catch(function(){t(e)})}(n=d[e])}():a.trigger(s.TEARDOWN_COMPLETE)}},u=r.getLogger(n),c=i=l=null,d=[],f=(0,v.default)(t).getInstance(),o={handleEvent:function(e){switch(e.type){case"encrypted":if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;a.trigger(s.NEED_KEY,{key:new y.default(t,e.initDataType)})}}}},n}i.__dashjs_factory_name="ProtectionModel_21Jan2015",r.default=dashjs.FactoryMaker.getClassFactory(i),t.exports=r.default},{"../../constants/ProtectionConstants":402,"../../vo/DashJSError":514,"../controllers/ProtectionKeyController":453,"../errors/ProtectionErrors":458,"../vo/KeyMessage":467,"../vo/KeySystemAccess":469,"../vo/NeedKey":472}],461:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var y=n(e("../controllers/ProtectionKeyController")),_=n(e("../vo/NeedKey")),b=n(e("../../vo/DashJSError")),E=n(e("../errors/ProtectionErrors")),w=n(e("../vo/KeyMessage")),A=n(e("../vo/KeySystemConfiguration")),T=n(e("../vo/KeySystemAccess"));function i(e){e=e||{};var t=this.context,p=e.eventBus,m=e.events,r=e.debug,g=e.api,n=void 0,u=void 0,i=void 0,l=void 0,c=void 0,d=void 0,f=void 0,o=void 0,v=void 0;function a(){try{for(var e=0;e<f.length;e++)s(f[e]);i&&i.removeEventListener(g.needkey,o),p.trigger(m.TEARDOWN_COMPLETE)}catch(e){p.trigger(m.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function s(e){var t=e.session;t.removeEventListener(g.error,e),t.removeEventListener(g.message,e),t.removeEventListener(g.ready,e),t.removeEventListener(g.close,e);for(var r=0;r<f.length;r++)if(f[r]===e){f.splice(r,1);break}t[g.release]()}function h(){function e(){i.removeEventListener("loadedmetadata",t),i[g.setMediaKeys](c),p.trigger(m.VIDEO_ELEMENT_SELECTED)}var t=null;1<=i.readyState?e():(t=e.bind(this),i.addEventListener("loadedmetadata",t))}return n={getAllInitData:function(){for(var e=[],t=0;t<f.length;t++)e.push(f[t].initData);return e},requestKeySystemAccess:function(e){for(var t=!1,r=0;r<e.length;r++)for(var n=e[r].ks.systemString,i=e[r].configs,o=null,a=null,s=0;s<i.length;s++){var u=i[s].audioCapabilities,l=i[s].videoCapabilities;if(u&&0!==u.length){o=[];for(var c=0;c<u.length;c++)window[g.MediaKeys].isTypeSupported(n,u[c].contentType)&&o.push(u[c])}if(l&&0!==l.length){a=[];for(var d=0;d<l.length;d++)window[g.MediaKeys].isTypeSupported(n,l[d].contentType)&&a.push(l[d])}if(!(!o&&!a||o&&0===o.length||a&&0===a.length)){t=!0;var f=new A.default(o,a),h=v.getKeySystemBySystemString(n);p.trigger(m.KEY_SYSTEM_ACCESS_COMPLETE,{data:new T.default(h,f)});break}}t||p.trigger(m.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return l},selectKeySystem:function(e){try{c=e.mediaKeys=new window[g.MediaKeys](e.keySystem.systemString),l=e.keySystem,d=e,i&&h(),p.trigger(m.INTERNAL_KEY_SYSTEM_SELECTED)}catch(e){p.trigger(m.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+l.systemString+")! Could not create MediaKeys -- TODO"})}},setMediaElement:function(e){i!==e&&(i&&i.removeEventListener(g.needkey,o),(i=e)&&(i.addEventListener(g.needkey,o),c&&h()))},createKeySession:function(e,t,r,n){if(!l||!c||!d)throw new Error("Can not create sessions until you have selected a key system");var i=null;if(d.ksConfiguration.videoCapabilities&&0<d.ksConfiguration.videoCapabilities.length&&(i=d.ksConfiguration.videoCapabilities[0]),null===i&&d.ksConfiguration.audioCapabilities&&0<d.ksConfiguration.audioCapabilities.length&&(i=d.ksConfiguration.audioCapabilities[0]),null===i)throw new Error("Can not create sessions for unknown content types.");var o=i.contentType,a=c.createSession(o,new Uint8Array(e),n?new Uint8Array(n):null),s=function(e,t){return{session:e,initData:t,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case g.error:p.trigger(m.KEY_ERROR,{data:new b.default(E.default.MEDIA_KEYERR_CODE,"KeyError",this)});break;case g.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;p.trigger(m.INTERNAL_KEY_MESSAGE,{data:new w.default(this,t,e.destinationURL)});break;case g.ready:u.debug("DRM: Key added."),p.trigger(m.KEY_ADDED);break;case g.close:u.debug("DRM: Session closed.  SessionID = "+this.getSessionID()),p.trigger(m.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}(a,e);a.addEventListener(g.error,s),a.addEventListener(g.message,s),a.addEventListener(g.ready,s),a.addEventListener(g.close,s),f.push(s),u.debug("DRM: Session created.  SessionID = "+s.getSessionID()),p.trigger(m.KEY_SESSION_CREATED,{data:s})},updateKeySession:function(e,t){var r=e.session;v.isClearKey(l)?r.update(new Uint8Array(t.toJWK())):r.update(new Uint8Array(t))},closeKeySession:s,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:a,reset:a},u=r.getLogger(n),d=c=l=i=null,f=[],v=(0,y.default)(t).getInstance(),o={handleEvent:function(e){switch(e.type){case g.needkey:if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;p.trigger(m.NEED_KEY,{key:new _.default(t,"cenc")})}}}},n}i.__dashjs_factory_name="ProtectionModel_3Feb2014",r.default=dashjs.FactoryMaker.getClassFactory(i),t.exports=r.default},{"../../vo/DashJSError":514,"../controllers/ProtectionKeyController":453,"../errors/ProtectionErrors":458,"../vo/KeyMessage":467,"../vo/KeySystemAccess":469,"../vo/KeySystemConfiguration":470,"../vo/NeedKey":472}],462:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=n(e("../vo/KeyPair")),s=n(e("../vo/ClearKeyKeySet"));function i(){return{getServerURLFromMessage:function(e,t){var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t)));e+="/?";for(var n=0;n<r.kids.length;n++)e+=r.kids[n]+"&";return e=e.substring(0,e.length-1)},getHTTPMethod:function(){return"GET"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],r=0;r<e.keys.length;r++){var n=e.keys[r],i=n.kid.replace(/=/g,""),o=n.k.replace(/=/g,"");t.push(new a.default(i,o))}return new s.default(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}i.__dashjs_factory_name="ClearKey",r.default=dashjs.FactoryMaker.getSingletonFactory(i),t.exports=r.default},{"../vo/ClearKeyKeySet":466,"../vo/KeyPair":468}],463:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../constants/ProtectionConstants"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){var r=(e=e||{}).BASE64,n={};n[o.default.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return r.decodeArray(e.license)},getErrorResponse:function(e){return e}},n[o.default.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}};return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return n[e].responseType},getLicenseMessage:function(e,t){return function(){if(!r||!r.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),n[t].getLicenseMessage(e)},getErrorResponse:function(e,t){return n[t].getErrorResponse(e)}}}a.__dashjs_factory_name="DRMToday",r.default=dashjs.FactoryMaker.getSingletonFactory(a),t.exports=r.default},{"../../constants/ProtectionConstants":402}],464:[function(e,t,r){"use strict";function n(){var m="http://schemas.xmlsoap.org/soap/envelope/";function g(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return function(e){if(window.DOMParser){var t=g(e),r=(new window.DOMParser).parseFromString(t,"text/xml"),n=r?r.getElementsByTagNameNS(m,"Envelope")[0]:null,i=n?n.getElementsByTagNameNS(m,"Body")[0]:null;if(i?i.getElementsByTagNameNS(m,"Fault")[0]:null)return null}return e}.call(this,e)},getErrorResponse:function(e){return function(e){var t="",r="",n="",i=-1,o=-1;if(window.DOMParser){var a=g(e),s=(new window.DOMParser).parseFromString(a,"text/xml"),u=s?s.getElementsByTagNameNS(m,"Envelope")[0]:null,l=u?u.getElementsByTagNameNS(m,"Body")[0]:null,c=l?l.getElementsByTagNameNS(m,"Fault")[0]:null,d=c?c.getElementsByTagName("detail")[0]:null,f=d?d.getElementsByTagName("Exception")[0]:null,h=null;if(null===c)return a;t=(h=c.getElementsByTagName("faultstring")[0].firstChild)?h.nodeValue:null,null!==f&&(r=(h=f.getElementsByTagName("StatusCode")[0])?h.firstChild.nodeValue:null,i=(n=(h=f.getElementsByTagName("Message")[0])?h.firstChild.nodeValue:null)?n.lastIndexOf("[")+1:-1,o=n?n.indexOf("]"):-1,n=n?n.substring(i,o):"")}var p="code: "+r+", name: "+t;return n&&(p+=", message: "+n),p}.call(this,e)}}}Object.defineProperty(r,"__esModule",{value:!0}),n.__dashjs_factory_name="PlayReady",r.default=dashjs.FactoryMaker.getSingletonFactory(n),t.exports=r.default},{}],465:[function(e,t,r){"use strict";function n(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}Object.defineProperty(r,"__esModule",{value:!0}),n.__dashjs_factory_name="Widevine",r.default=dashjs.FactoryMaker.getSingletonFactory(n),t.exports=r.default},{}],466:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,[{key:"toJWK",value:function(){var e=void 0,t=this.keyPairs.length,r={keys:[]};for(e=0;e<t;e++){var n={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};r.keys.push(n)}this.type&&(r.type=this.type);var i=JSON.stringify(r),o=i.length,a=new ArrayBuffer(o),s=new Uint8Array(a);for(e=0;e<o;e++)s[e]=i.charCodeAt(e);return a}}]),o);function o(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t&&"persistent"!==t&&"temporary"!==t)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=e,this.type=t}r.default=i,t.exports=r.default},{}],467:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=r,this.defaultURL=n,this.messageType=i||"license-request"},t.exports=r.default},{}],468:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=r},t.exports=r.default},{}],469:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=r},t.exports=r.default},{}],470:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t,r,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),r&&r.length&&(this.videoCapabilities=r),this.distinctiveIdentifier=n,this.persistentState=i,this.sessionTypes=o},t.exports=r.default},{}],471:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=r},t.exports=r.default},{}],472:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=r},t.exports=r.default},{}],473:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(){var a=[],s=0,u=0;return{push:function(e,t){var r=t&&t.droppedVideoFrames?t.droppedVideoFrames:0,n=t&&t.totalVideoFrames?t.totalVideoFrames:0,i=r-s;s=r;var o=n-u;u=n,isNaN(e)||(a[e]?(a[e].droppedVideoFrames+=i,a[e].totalVideoFrames+=o):a[e]={droppedVideoFrames:i,totalVideoFrames:o})},getFrameHistory:function(){return a},reset:function(e){a=[],s=e.droppedVideoFrames,u=e.totalVideoFrames}}}a.__dashjs_factory_name="DroppedFramesHistory";var s=o.default.getClassFactory(a);r.default=s,t.exports=r.default},{"../../core/FactoryMaker":347}],474:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){var t=(e=e||{}).abrController,r=e.switchHistory,n=e.droppedFramesHistory,i=e.currentRequest,o=e.useBufferOccupancyABR,a=e.streamProcessor?e.streamProcessor.getScheduleController():null,s=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null;function u(){return s?s.mediaInfo:null}return{getMediaType:function(){var e=u();return e?e.type:null},getMediaInfo:u,getDroppedFramesHistory:function(){return n},getCurrentRequest:function(){return i},getSwitchHistory:function(){return r},getStreamInfo:function(){var e=u();return e?e.streamInfo:null},getScheduleController:function(){return a},getAbrController:function(){return t},getRepresentationInfo:function(){return s},useBufferOccupancyABR:function(){return o}}}a.__dashjs_factory_name="RulesContext",r.default=o.default.getClassFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347}],475:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n},a={DEFAULT:.5,STRONG:1,WEAK:0};function s(e,t,r){var n,i;return(n=r)!==(i=a.DEFAULT)&&n!==a.STRONG&&n!==a.WEAK||(i=n),{quality:void 0===e?-1:e,reason:void 0===t?null:t,priority:i}}s.__dashjs_factory_name="SwitchRequest";var u=o.default.getClassFactory(s);u.NO_CHANGE=-1,u.PRIORITY=a,o.default.updateClassFactory(s.__dashjs_factory_name,u),r.default=u,t.exports=r.default},{"../../core/FactoryMaker":347}],476:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),u=n(e("./SwitchRequest"));function o(){var a=[],s=[];return{push:function(e){e.newValue===u.default.NO_CHANGE&&(e.newValue=e.oldValue),a[e.oldValue]||(a[e.oldValue]={noDrops:0,drops:0,dropSize:0});var t=e.newValue-e.oldValue,r=t<0?1:0,n=r?-t:0,i=r?0:1;if(a[e.oldValue].drops+=r,a[e.oldValue].dropSize+=n,a[e.oldValue].noDrops+=i,s.push({idx:e.oldValue,noDrop:i,drop:r,dropSize:n}),8<s.length){var o=s.shift();a[o.idx].drops-=o.drop,a[o.idx].dropSize-=o.dropSize,a[o.idx].noDrops-=o.noDrop}},getSwitchRequests:function(){return a},reset:function(){a=[],s=[]}}}o.__dashjs_factory_name="SwitchRequestHistory";var a=i.default.getClassFactory(o);r.default=a,t.exports=r.default},{"../../core/FactoryMaker":347,"./SwitchRequest":475}],477:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var b=n(e("../constants/Constants")),i=n(e("../../core/FactoryMaker"));function o(e){var s=3,u=4,l=4,c=1.3,d=1.3,f=(e=e||{}).mediaPlayerModel,h=void 0,p=void 0,m=void 0,g=void 0,v=void 0;function y(e,t,r,n){var i=Math.pow(.5,r/n.fast);e.fastEstimate=(1-i)*t+i*e.fastEstimate;var o=Math.pow(.5,r/n.slow);e.slowEstimate=(1-o)*t+o*e.slowEstimate,e.totalWeight+=r}function r(e,t,r){return f.getMovingAverageMethod()!==b.default.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var r=e?v.throughputHalfLife:v.latencyHalfLife,n=e?m[t]:g[t];if(!n||n.totalWeight<=0)return NaN;var i=n.fastEstimate/(1-Math.pow(.5,n.totalWeight/r.fast)),o=n.slowEstimate/(1-Math.pow(.5,n.totalWeight/r.slow));return e?Math.min(i,o):Math.max(i,o)}(e,t):function(e,t,r){var n=function(e,t,r){var n=void 0,i=void 0;if(i=e?(n=h[t],r?s:u):(n=p[t],l),n){if(i>=n.length)i=n.length;else if(e)for(var o=1;o<i;++o){var a=n[o]/n[o-1];if((d<=a||a<=1/c)&&(i+=1)===n.length)break}}else i=0;return i}(e,t,r),i=(e?h:p)[t];return 0!==n&&i&&0!==i.length?(i=i.slice(-n)).reduce(function(e,t){return e+t})/i.length:NaN}(e,t,r)}function n(e,t){return r(!0,e,t)}function _(e){h[e]=h[e]||[],p[e]=p[e]||[],m[e]=m[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},g[e]=g[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function t(){h={},p={},m={},g={}}var i={push:function(e,t,r){if(t.trace&&t.trace.length){var n=t.tresponse.getTime()-t.trequest.getTime()||1,i=t._tfinish.getTime()-t.tresponse.getTime()||1,o=t.trace.reduce(function(e,t){return e+t.b[0]},0),a=void 0;a=f.getLowLatencyEnabled()?t.trace.reduce(function(e,t){return e+t.d},0):r?i:n+i;var s=Math.round(8*o/a);if(_(e),function(e,t,r){return e===b.default.VIDEO?r<f.getCacheLoadThresholdForType(b.default.VIDEO):e===b.default.AUDIO?r<f.getCacheLoadThresholdForType(b.default.AUDIO):void 0}(e,0,i)){if(0<h[e].length&&!h[e].hasCachedEntries)return;h[e].hasCachedEntries=!0}else h[e]&&h[e].hasCachedEntries&&function(e){delete h[e],delete p[e],delete m[e],delete g[e],_(e)}(e);h[e].push(s),20<h[e].length&&h[e].shift(),p[e].push(n),20<p[e].length&&p[e].shift(),y(m[e],s,.001*i,v.throughputHalfLife),y(g[e],n,1,v.latencyHalfLife)}},getAverageThroughput:n,getSafeAverageThroughput:function(e,t){var r=n(e,t);return isNaN(r)||(r*=f.getBandwidthSafetyFactor()),r},getAverageLatency:function(e){return r(!1,e)},reset:t};return v={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},t(),i}o.__dashjs_factory_name="ThroughputHistory",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/FactoryMaker":347,"../constants/Constants":400}],478:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=n(e("./ThroughputRule")),c=n(e("./InsufficientBufferRule")),d=n(e("./AbandonRequestsRule")),f=n(e("./DroppedFramesRule")),h=n(e("./SwitchHistoryRule")),p=n(e("./BolaRule")),i=n(e("../../../core/FactoryMaker")),m=n(e("../SwitchRequest")),g="qualitySwitchRules",v="abandonFragmentRules";function o(e){e=e||{};var s=this.context,t=e.mediaPlayerModel,r=e.metricsModel,n=e.dashMetrics,i=void 0,o=void 0;function a(e){return e.filter(function(e){return e.quality>m.default.NO_CHANGE})}function u(e){var t,r={},n=void 0,i=void 0,o=void 0,a=void 0;if(0!==e.length){for(r[m.default.PRIORITY.STRONG]=m.default.NO_CHANGE,r[m.default.PRIORITY.WEAK]=m.default.NO_CHANGE,r[m.default.PRIORITY.DEFAULT]=m.default.NO_CHANGE,n=0,t=e.length;n<t;n+=1)(i=e[n]).quality!==m.default.NO_CHANGE&&(r[i.priority]=r[i.priority]>m.default.NO_CHANGE?Math.min(r[i.priority],i.quality):i.quality);return r[m.default.PRIORITY.WEAK]!==m.default.NO_CHANGE&&(o=r[m.default.PRIORITY.WEAK]),r[m.default.PRIORITY.DEFAULT]!==m.default.NO_CHANGE&&(o=r[m.default.PRIORITY.DEFAULT]),r[m.default.PRIORITY.STRONG]!==m.default.NO_CHANGE&&(o=r[m.default.PRIORITY.STRONG]),o!==m.default.NO_CHANGE&&(a=o),(0,m.default)(s).create(a)}}return{initialize:function(){i=[],o=[],t.getUseDefaultABRRules()&&(i.push((0,p.default)(s).create({metricsModel:r,dashMetrics:n,mediaPlayerModel:t})),i.push((0,l.default)(s).create({metricsModel:r,dashMetrics:n})),i.push((0,c.default)(s).create({metricsModel:r,dashMetrics:n})),i.push((0,h.default)(s).create()),i.push((0,f.default)(s).create()),o.push((0,d.default)(s).create({metricsModel:r,dashMetrics:n,mediaPlayerModel:t}))),t.getABRCustomRules().forEach(function(e){e.type===g&&i.push(e.rule(s).create()),e.type===v&&o.push(e.rule(s).create())})},reset:function(){[i,o].forEach(function(e){e&&e.length&&e.forEach(function(e){return e.reset&&e.reset()})}),i=[],o=[]},getMaxQuality:function(t){return u(a(i.map(function(e){return e.getMaxIndex(t)})))||(0,m.default)(s).create()},shouldAbandonFragment:function(t){return u(a(o.map(function(e){return e.shouldAbandon(t)})))||(0,m.default)(s).create()}}}o.__dashjs_factory_name="ABRRulesCollection";var a=i.default.getClassFactory(o);a.QUALITY_SWITCH_RULES=g,a.ABANDON_FRAGMENT_RULES=v,i.default.updateSingletonFactory(o.__dashjs_factory_name,a),r.default=a,t.exports=r.default},{"../../../core/FactoryMaker":347,"../SwitchRequest":475,"./AbandonRequestsRule":479,"./BolaRule":480,"./DroppedFramesRule":481,"./InsufficientBufferRule":482,"./SwitchHistoryRule":483,"./ThroughputRule":484}],479:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var _=n(e("../SwitchRequest")),i=n(e("../../../core/FactoryMaker")),o=n(e("../../../core/Debug"));function b(e){e=e||{};var d=this.context,f=e.mediaPlayerModel,h=e.metricsModel,p=e.dashMetrics,t=void 0,m=void 0,g=void 0,v=void 0,y=void 0;function r(){g={},v={},y=[]}return t={shouldAbandon:function(e){var t=(0,_.default)(d).create(_.default.NO_CHANGE,{name:b.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return t;var r=e.getMediaInfo(),n=e.getMediaType(),i=e.getCurrentRequest();if(!isNaN(i.index)){if(function(e,t){g[e]=g[e]||{},g[e][t]=g[e][t]||{}}(n,i.index),f.getStableBufferTime()<p.getCurrentBufferLevel(h.getReadOnlyMetricsFor(n)))return t;var o=g[n][i.index];if(null===o||null===i.firstByteDate||v.hasOwnProperty(o.id))return t;if(void 0===o.firstByteTime&&(y[n]=[],o.firstByteTime=i.firstByteDate.getTime(),o.segmentDuration=i.duration,o.bytesTotal=i.bytesTotal,o.id=i.index),o.bytesLoaded=i.bytesLoaded,o.elapsedTime=(new Date).getTime()-o.firstByteTime,0<o.bytesLoaded&&0<o.elapsedTime&&function(e,t){y[e]=y[e]||[],y[e].push(t)}(n,Math.round(8*o.bytesLoaded/o.elapsedTime)),5<=y[n].length&&500<o.elapsedTime&&o.bytesLoaded<o.bytesTotal){var a=y[n].reduce(function(e,t){return e+t},0);if(o.measuredBandwidthInKbps=Math.round(a/y[n].length),o.estimatedTimeOfDownload=+(8*o.bytesTotal/o.measuredBandwidthInKbps/1e3).toFixed(2),o.estimatedTimeOfDownload<1.8*o.segmentDuration||0===e.getRepresentationInfo().quality)return t;if(!v.hasOwnProperty(o.id)){var s=e.getAbrController(),u=o.bytesTotal-o.bytesLoaded,l=s.getBitrateList(r),c=s.getQualityForBitrate(r,o.measuredBandwidthInKbps*f.getBandwidthSafetyFactor());o.bytesTotal*l[c].bitrate/l[s.getQualityFor(n,r.streamInfo)].bitrate<u&&(t.quality=c,t.reason.throughput=o.measuredBandwidthInKbps,t.reason.fragmentID=o.id,v[o.id]=o,m.debug("( ",n,"frag id",o.id,") is asking to abandon and switch to quality to ",c," measured bandwidth was",o.measuredBandwidthInKbps),delete g[n][o.id])}}else o.bytesLoaded===o.bytesTotal&&delete g[n][o.id]}return t},reset:r},m=(0,o.default)(d).getInstance().getLogger(t),r(),t}b.__dashjs_factory_name="AbandonRequestsRule",r.default=i.default.getClassFactory(b),t.exports=r.default},{"../../../core/Debug":345,"../../../core/FactoryMaker":347,"../SwitchRequest":475}],480:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=n(e("../../constants/MetricsConstants")),P=n(e("../SwitchRequest")),i=n(e("../../../core/FactoryMaker")),m=e("../../vo/metrics/HTTPRequest"),g=n(e("../../../core/EventBus")),v=n(e("../../../core/events/Events")),y=n(e("../../../core/Debug"));function o(e){e=e||{};var b=this.context,E=e.dashMetrics,w=e.metricsModel,a=e.mediaPlayerModel,t=(0,g.default)(b).getInstance(),r=void 0,A=void 0,T=void 0;function s(e,t,n){var r=n.reduce(function(e,t,r){return t>n[e]?r:e},0);if(0===r)return null;var i=Math.max(e,10+2*t.length),o=(n[r]-1)/(i/10-1);return{gp:o,Vp:10/o}}function S(e){var t={},r=e.getMediaInfo().bitrateList.map(function(e){return e.bandwidth}),n=function(e){return e.map(function(e){return Math.log(e)})}(r);n=n.map(function(e){return e-n[0]+1});var i=a.getStableBufferTime(),o=s(i,r,n);return o?(t.state=1,t.bitrates=r,t.utilities=n,t.stableBufferTime=i,t.Vp=o.Vp,t.gp=o.gp,t.lastQuality=0,x(t)):t.state=0,t}function x(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function M(e,t){var r=a.getStableBufferTime();if(e.stableBufferTime!==r){var n=s(r,e.bitrates,e.utilities);if(n.Vp!==e.Vp||n.gp!==e.gp){var i=E.getCurrentBufferLevel(w.getReadOnlyMetricsFor(t)),o=i+e.placeholderBuffer;o-=10,o*=n.Vp/e.Vp,o+=10,e.stableBufferTime=r,e.Vp=n.Vp,e.gp=n.gp,e.placeholderBuffer=Math.max(0,o-i)}}}function R(e,t){return e.Vp*(e.utilities[t]+e.gp)}function O(e,t){for(var r=e.bitrates[t],n=e.utilities[t],i=0,o=t-1;0<=o;--o)if(e.utilities[o]<e.utilities[t]){var a=e.bitrates[o],s=e.utilities[o],u=e.Vp*(e.gp+(r*s-a*n)/(r-a));i=Math.max(i,u)}return i}function n(){for(var e in T)T.hasOwnProperty(e)&&2===T[e].state&&(T[e].placeholderBuffer=0)}function i(){for(var e in T)if(T.hasOwnProperty(e)){var t=T[e];0!==t.state&&(t.state=1,x(t))}}function o(){}function u(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=T[e.chunk.mediaInfo.type];if(t&&0!==t.state){var r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,c(t,e.chunk.mediaInfo.type)}}}function l(e){if(e&&e.metric===p.default.HTTP_REQUEST&&e.value&&e.value.type===m.HTTPRequest.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=T[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),c(t,e.mediaType))}}function c(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var r=E.getCurrentBufferLevel(w.getReadOnlyMetricsFor(t))+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),n=R(e,e.lastQuality),i=Math.max(0,n-r);e.placeholderBuffer=Math.min(i,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function d(e){if(e){var t=T[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function f(e){if(e){var t=T[e.mediaType];if(t&&0!==t.state){var r=E.getCurrentBufferLevel(w.getReadOnlyMetricsFor(e.mediaType)),n=void 0;n=0<t.abrQuality?O(t,t.abrQuality):10;var i=Math.max(0,n-r);t.placeholderBuffer=Math.min(t.placeholderBuffer,i)}}}function h(){T={}}return r={getMaxIndex:function(e){var t=e.getMediaInfo(),r=e.getMediaType(),n=w.getReadOnlyMetricsFor(r),i=e.getScheduleController(),o=e.getStreamInfo(),a=e.getAbrController(),s=a.getThroughputHistory(),u=o?o.id:null,l=o&&o.manifestInfo&&o.manifestInfo.isDynamic,c=e.useBufferOccupancyABR(),d=(0,P.default)(b).create();if(d.reason=d.reason||{},!c)return d;i.setTimeToLoadDelay(0);var f=function(e){var t=e.getMediaType(),r=T[t];return r?0!==r.state&&M(r,t):(r=S(e),T[t]=r),r}(e);if(0===f.state)return d;var h=E.getCurrentBufferLevel(n),p=s.getAverageThroughput(r,l),m=s.getSafeAverageThroughput(r,l),g=s.getAverageLatency(r),v=void 0;if(d.reason.state=f.state,d.reason.throughput=p,d.reason.latency=g,isNaN(p))return d;switch(f.state){case 1:v=a.getQualityForBitrate(t,m,g),d.quality=v,d.reason.throughput=m,f.placeholderBuffer=Math.max(0,O(f,v)-h),f.lastQuality=v,!isNaN(f.lastSegmentDurationS)&&h>=f.lastSegmentDurationS&&(f.state=2);break;case 2:!function(e,t){var r=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){n=.001*(r-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,n)}}else{var n=.001*(r-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,n)}e.lastCallTimeMs=r,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,M(e,t)}(f,r),v=function(e,t){for(var r=e.bitrates.length,n=NaN,i=NaN,o=0;o<r;++o){var a=(e.Vp*(e.utilities[o]+e.gp)-t)/e.bitrates[o];(isNaN(i)||i<=a)&&(i=a,n=o)}return n}(f,h+f.placeholderBuffer);var y=a.getQualityForBitrate(t,m,g);v>f.lastQuality&&y<v&&(v=Math.max(y,f.lastQuality));var _=Math.max(0,h+f.placeholderBuffer-R(f,v));_<=f.placeholderBuffer?(f.placeholderBuffer-=_,_=0):(_-=f.placeholderBuffer,f.placeholderBuffer=0,v<a.getTopQualityIndexFor(r,u)?i.setTimeToLoadDelay(1e3*_):_=0),d.quality=v,d.reason.throughput=p,d.reason.latency=g,d.reason.bufferLevel=h,d.reason.placeholderBuffer=f.placeholderBuffer,d.reason.delay=_,f.lastQuality=v;break;default:A.debug("BOLA ABR rule invoked in bad state."),d.quality=a.getQualityForBitrate(t,m,g),d.reason.state=f.state,d.reason.throughput=m,d.reason.latency=g,f.state=1,x(f)}return d},reset:function(){h(),t.off(v.default.BUFFER_EMPTY,n,r),t.off(v.default.PLAYBACK_SEEKING,i,r),t.off(v.default.PERIOD_SWITCH_STARTED,o,r),t.off(v.default.MEDIA_FRAGMENT_LOADED,u,r),t.off(v.default.METRIC_ADDED,l,r),t.off(v.default.QUALITY_CHANGE_REQUESTED,d,r),t.off(v.default.FRAGMENT_LOADING_ABANDONED,f,r)}},A=(0,y.default)(b).getInstance().getLogger(r),h(),t.on(v.default.BUFFER_EMPTY,n,r),t.on(v.default.PLAYBACK_SEEKING,i,r),t.on(v.default.PERIOD_SWITCH_STARTED,o,r),t.on(v.default.MEDIA_FRAGMENT_LOADED,u,r),t.on(v.default.METRIC_ADDED,l,r),t.on(v.default.QUALITY_CHANGE_REQUESTED,d,r),t.on(v.default.FRAGMENT_LOADING_ABANDONED,f,r),r}o.__dashjs_factory_name="BolaRule",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../../core/Debug":345,"../../../core/EventBus":346,"../../../core/FactoryMaker":347,"../../../core/events/Events":352,"../../constants/MetricsConstants":401,"../../vo/metrics/HTTPRequest":534,"../SwitchRequest":475}],481:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../../core/FactoryMaker")),l=n(e("../SwitchRequest")),o=n(e("../../../core/Debug"));function a(){var s=this.context,e=void 0,u=void 0;return e={getMaxIndex:function(e){var t=e.getDroppedFramesHistory();if(t){for(var r=t.getFrameHistory(),n=0,i=0,o=l.default.NO_CHANGE,a=1;a<r.length;a++)if(r[a]&&(n=r[a].droppedVideoFrames,375<(i=r[a].totalVideoFrames)&&.15<n/i)){o=a-1,u.debug("index: "+o+" Dropped Frames: "+n+" Total Frames: "+i);break}return(0,l.default)(s).create(o,{droppedFrames:n})}return(0,l.default)(s).create()}},u=(0,o.default)(s).getInstance().getLogger(e),e}a.__dashjs_factory_name="DroppedFramesRule",r.default=i.default.getClassFactory(a),t.exports=r.default},{"../../../core/Debug":345,"../../../core/FactoryMaker":347,"../SwitchRequest":475}],482:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var _=n(e("../../controllers/BufferController")),o=n(e("../../../core/EventBus")),a=n(e("../../../core/events/Events")),i=n(e("../../../core/FactoryMaker")),s=n(e("../../../core/Debug")),b=n(e("../SwitchRequest")),E=n(e("../../constants/Constants"));function u(e){e=e||{};var h=.5,p=this.context,t=(0,o.default)(p).getInstance(),m=e.metricsModel,g=e.dashMetrics,r=void 0,v=void 0,y=void 0;function n(){y={}}function i(){n()}return r={getMaxIndex:function(e){var t=(0,b.default)(p).create();if(!e||!e.hasOwnProperty("getMediaType"))return t;!function(){if(!(m&&m.hasOwnProperty("getReadOnlyMetricsFor")&&g&&g.hasOwnProperty("getCurrentBufferLevel")))throw new Error(E.default.MISSING_CONFIG_ERROR)}();var r=e.getMediaType(),n=m.getReadOnlyMetricsFor(r),i=0<n.BufferState.length?n.BufferState[n.BufferState.length-1]:null,o=e.getRepresentationInfo().fragmentDuration;if(!i||!function(e,t){y[e]=y[e]||{};var r=!1;y[e].firstBufferLoadedEvent?r=!0:t&&t.state===_.default.BUFFER_LOADED&&(y[e].firstBufferLoadedEvent=!0,r=!0);return r}(r,i)||!o)return t;if(i.state===_.default.BUFFER_EMPTY)v.debug("Switch to index 0; buffer is empty."),t.quality=0,t.reason="InsufficientBufferRule: Buffer is empty";else{var a=e.getMediaInfo(),s=e.getAbrController(),u=s.getThroughputHistory(),l=g.getCurrentBufferLevel(n),c=u.getAverageThroughput(r),d=u.getAverageLatency(r),f=c*(l/o)*h;t.quality=s.getQualityForBitrate(a,f,d),t.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return t},reset:function(){n(),t.off(a.default.PLAYBACK_SEEKING,i,r)}},v=(0,s.default)(p).getInstance().getLogger(r),n(),t.on(a.default.PLAYBACK_SEEKING,i,r),r}u.__dashjs_factory_name="InsufficientBufferRule",r.default=i.default.getClassFactory(u),t.exports=r.default},{"../../../core/Debug":345,"../../../core/EventBus":346,"../../../core/FactoryMaker":347,"../../../core/events/Events":352,"../../constants/Constants":400,"../../controllers/BufferController":406,"../SwitchRequest":475}],483:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../../core/FactoryMaker")),o=n(e("../../../core/Debug")),c=n(e("../SwitchRequest"));function a(){var u=this.context,e=void 0,l=void 0;return e={getMaxIndex:function(e){for(var t=e?e.getSwitchHistory():null,r=t?t.getSwitchRequests():[],n=0,i=0,o=0,a=(0,c.default)(u).create(),s=0;s<r.length;s++)if(void 0!==r[s]&&(n+=r[s].drops,i+=r[s].noDrops,o+=r[s].dropSize,6<=n+i&&.075<n/i)){a.quality=0<s&&0<r[s].drops?s-1:s,a.reason={index:a.quality,drops:n,noDrops:i,dropSize:o},l.debug("Switch history rule index: "+a.quality+" samples: "+(n+i)+" drops: "+n);break}return a}},l=(0,o.default)(u).getInstance().getLogger(e),e}a.__dashjs_factory_name="SwitchHistoryRule",r.default=i.default.getClassFactory(a),t.exports=r.default},{"../../../core/Debug":345,"../../../core/FactoryMaker":347,"../SwitchRequest":475}],484:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var v=n(e("../../controllers/BufferController")),y=n(e("../../controllers/AbrController")),i=n(e("../../../core/FactoryMaker")),o=n(e("../../../core/Debug")),_=n(e("../SwitchRequest")),b=n(e("../../constants/Constants"));function a(e){e=e||{};var p=this.context,m=e.metricsModel,t=void 0,g=void 0;return t={getMaxIndex:function(e){var t=(0,_.default)(p).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return t;!function(){if(!m||!m.hasOwnProperty("getReadOnlyMetricsFor"))throw new Error(b.default.MISSING_CONFIG_ERROR)}();var r=e.getMediaInfo(),n=e.getMediaType(),i=m.getReadOnlyMetricsFor(n),o=e.getScheduleController(),a=e.getAbrController(),s=e.getStreamInfo(),u=s&&s.manifestInfo?s.manifestInfo.isDynamic:null,l=a.getThroughputHistory(),c=l.getSafeAverageThroughput(n,u),d=l.getAverageLatency(n),f=0<i.BufferState.length?i.BufferState[i.BufferState.length-1]:null,h=e.useBufferOccupancyABR();return!i||isNaN(c)||!f||h||a.getAbandonmentStateFor(n)!==y.default.ABANDON_LOAD&&(f.state!==v.default.BUFFER_LOADED&&!u||(t.quality=a.getQualityForBitrate(r,c,d),o.setTimeToLoadDelay(0),g.debug("requesting switch to index: ",t.quality,"type: ",n,"Average throughput",Math.round(c),"kbps"),t.reason={throughput:c,latency:d})),t},reset:function(){}},g=(0,o.default)(p).getInstance().getLogger(t),t}a.__dashjs_factory_name="ThroughputRule",r.default=i.default.getClassFactory(a),t.exports=r.default},{"../../../core/Debug":345,"../../../core/FactoryMaker":347,"../../constants/Constants":400,"../../controllers/AbrController":403,"../../controllers/BufferController":406,"../SwitchRequest":475}],485:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var f=n(e("../../constants/Constants")),i=n(e("../../../core/FactoryMaker"));function o(e){var s=(e=e||{}).dashMetrics,u=e.metricsModel,l=e.mediaPlayerModel,c=e.textController,d=e.abrController;function r(e,t){var r=NaN;if(!e)return r;var n=e.getType(),i=e.getRepresentationInfo();if(n===f.default.FRAGMENTED_TEXT)r=c.isTextEnabled()?i.fragmentDuration:0;else if(n===f.default.AUDIO&&t){var o=s.getCurrentBufferLevel(u.getReadOnlyMetricsFor(f.default.VIDEO));r=isNaN(i.fragmentDuration)?o:Math.max(o,i.fragmentDuration)}else{var a=i.mediaInfo.streamInfo;if(d.isPlayingAtTopQuality(a))r=a.manifestInfo.duration>=l.getLongFormContentDurationThreshold()?l.getBufferTimeAtTopQualityLongForm():l.getBufferTimeAtTopQuality();else r=l.getStableBufferTime()}return r}return{execute:function(e,t){return!e||s.getCurrentBufferLevel(u.getReadOnlyMetricsFor(e.getType()))<r(e,t)},getBufferTarget:r}}o.__dashjs_factory_name="BufferLevelRule",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../../core/FactoryMaker":347,"../../constants/Constants":400}],486:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var y=n(e("../../constants/Constants")),i=n(e("../../../core/Debug")),o=n(e("../../../core/FactoryMaker")),_=n(e("../../../streaming/vo/FragmentRequest"));function a(e){e=e||{};var t=this.context,p=e.adapter,m=e.textController,g=e.playbackController,r=void 0,v=void 0;return r={execute:function(e,t,r){if(!e)return null;var n=e.getRepresentationInfo(),i=e.getType(),o=!isNaN(t),a=e.getBufferController(),s=g.getNormalizedTime(),u=o?t:p.getIndexHandlerTime(e),l=!1,c=void 0;if(isNaN(u)||i===y.default.FRAGMENTED_TEXT&&!m.isTextEnabled())return null;if(a){var d=a.getRangeAt(u),f=a.getRangeAt(s),h=a.getBuffer().hasDiscontinuitiesAfter(s);null===d&&null===f||o||((!d||f&&f.start!=d.start&&f.end!=d.end)&&(h&&i!==y.default.FRAGMENTED_TEXT&&(e.getFragmentModel().removeExecutedRequestsAfterTime(f.end),l=!0),d=f),u!==d.end&&(v.debug("Prior to making a request for time, NextFragmentRequestRule is aligning index handler's currentTime with bufferedRange.end for",i,".",u,"was changed to",d.end),u=d.end))}if(r)u=r.startTime+r.duration/2,c=p.getFragmentRequest(e,n,u,{timeThreshold:0,ignoreIsFinished:!0});else for(c=p.getFragmentRequest(e,n,u,{keepIdx:!o&&!l});c&&c.action!==_.default.ACTION_COMPLETE&&e.getFragmentModel().isFragmentLoaded(c);)c=p.getFragmentRequest(e,n);return c}},v=(0,i.default)(t).getInstance().getLogger(r),r}a.__dashjs_factory_name="NextFragmentRequestRule",r.default=o.default.getClassFactory(a),t.exports=r.default},{"../../../core/Debug":345,"../../../core/FactoryMaker":347,"../../../streaming/vo/FragmentRequest":516,"../../constants/Constants":400}],487:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(){var U=0;function G(e){for(var t="",r=0;r<e.length;++r){t+=e[r].uchar}return t.length-t.replace(/^\s+/,"").length}function n(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function H(e,t){var r=e.videoHeight/15;return t?"font-size: "+r+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?n(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?n(t.background):"transparent")+";":"font-size: "+r+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}return{createHTMLCaptionsFromScreen:function(e,t,r,n){var i=null,o=!1,a=-1,s={start:t,end:r,spans:[]},u="style_cea608_white_black",l={},c={},d=[],f=void 0,h=void 0;for(f=0;f<15;++f){var p=n.rows[f],m="",g=null;if(!1===p.isEmpty()){var v=G(p.chars);null===i&&(i={x:v,y1:f,y2:f+1,p:[]}),v!==a&&o&&(i.p.push(s),s={start:t,end:r,spans:[]},i.y2=f,i.name="region_"+i.x+"_"+i.y1+"_"+i.y2,!1===l.hasOwnProperty(i.name)?(d.push(i),l[i.name]=i):l[i.name].p.contat(i.p),i={x:v,y1:f,y2:f+1,p:[]});for(var y=0;y<p.chars.length;++y){var _=p.chars[y],b=_.penState;if(null===g||!b.equals(g)){0<m.trim().length&&(s.spans.push({name:u,line:m,row:f}),m="");var E="style_cea608_"+b.foreground+"_"+b.background;b.underline&&(E+="_underline"),b.italics&&(E+="_italics"),c.hasOwnProperty(E)||(c[E]=JSON.parse(JSON.stringify(b))),g=b,u=E}m+=_.uchar}0<m.trim().length&&s.spans.push({name:u,line:m,row:f}),o=!0,a=v}else o=!1,a=-1,i&&(i.p.push(s),s={start:t,end:r,spans:[]},i.y2=f,i.name="region_"+i.x+"_"+i.y1+"_"+i.y2,!1===l.hasOwnProperty(i.name)?(d.push(i),l[i.name]=i):l[i.name].p.contat(i.p),i=null)}i&&(i.p.push(s),i.y2=f+1,i.name="region_"+i.x+"_"+i.y1+"_"+i.y2,!1===l.hasOwnProperty(i.name)?(d.push(i),l[i.name]=i):l[i.name].p.contat(i.p),i=null);var w,A=[];for(f=0;f<d.length;++f){var T=d[f],S="sub_cea608_"+U++,x=document.createElement("div");x.id=S;var M="left: "+3.125*(w=T).x+"%; top: "+6.66*w.y1+"%; width: "+(100-3.125*w.x)+"%; height: "+6.66*Math.max(w.y2-1-w.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;";x.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+M;var R=document.createElement("div");R.className="paragraph bodyStyle",R.style.cssText=H(e);var O=document.createElement("div");O.className="cueUniWrapper",O.style.cssText="unicode-bidi: normal; direction: ltr;";for(var P=0;P<T.p.length;++P){var C=T.p[P],D=0;for(h=0;h<C.spans.length;++h){var I=C.spans[h];if(0<I.line.length){if(0!==h&&D!=I.row){var L=document.createElement("br");L.className="lineBreak",O.appendChild(L)}var N=!1;D===I.row&&(N=!0),D=I.row;var k=c[I.name],F=document.createElement("span");F.className="spanPadding "+I.name+" customSpanColor",F.style.cssText=H(e,k),0!==h&&N?h===C.spans.length-1?F.textContent=I.line.replace(/\s+$/g,""):F.textContent=I.line:1<C.spans.length&&h<C.spans.length-1&&I.row===C.spans[h+1].row?F.textContent=I.line.replace(/^\s+/g,""):F.textContent=I.line.trim(),O.appendChild(F)}}}R.appendChild(O),x.appendChild(R);var j={bodyStyle:["%",90]};for(var B in c)c.hasOwnProperty(B)&&(j[B]=["%",90]);A.push({type:"html",start:t,end:r,cueHTMLElement:x,cueID:S,cellResolution:[32,15],isFromCEA608:!0,fontSize:j,lineHeight:{},linePadding:{}})}return A}}}a.__dashjs_factory_name="EmbeddedTextHtmlRender",r.default=o.default.getSingletonFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347}],488:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var v=n(e("../constants/Constants")),y=n(e("../../core/EventBus")),_=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),b=n(e("../utils/InitCache")),E=n(e("../SourceBufferSink")),w=n(e("../../streaming/text/TextController")),A=n(e("../../streaming/vo/DashJSError")),T=n(e("../../core/errors/Errors")),S="NotFragmentedTextBufferController";function o(e){e=e||{};var r=this.context,n=(0,y.default)(r).getInstance(),i=(0,w.default)(r).getInstance(),o=e.errHandler,a=e.type,s=e.mimeType,u=e.streamProcessor,l=void 0,t=void 0,c=void 0,d=void 0,f=void 0,h=void 0;function p(e){d=e}function m(e){e.sender.getStreamProcessor()===u&&(h.extract(u.getStreamInfo().id,e.sender.getCurrentRepresentation().id)||n.trigger(_.default.TIMED_TEXT_REQUESTED,{index:0,sender:e.sender}))}function g(e){e.fragmentModel===u.getFragmentModel()&&e.chunk.bytes&&(h.save(e.chunk),f.append(e.chunk),n.trigger(_.default.STREAM_COMPLETED,{request:e.request,fragmentModel:e.fragmentModel}))}return l={getBufferControllerType:function(){return S},initialize:function(e){p(e),h=(0,b.default)(r).getInstance()},createBuffer:function(t){try{if(f=(0,E.default)(r).create(d,t),!c){var e=f.getBuffer();e.hasOwnProperty(v.default.INITIALIZE)&&e.initialize(s,u),c=!0}return f}catch(e){if(t.isText||-1!==t.codec.indexOf('codecs="stpp')||-1!==t.codec.indexOf('codecs="wvtt'))try{f=i.getTextSourceBuffer()}catch(e){o.mediaSourceError("Error creating "+a+" source buffer."),o.error(new A.default(T.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,T.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+a+" : "+e.message))}else o.mediaSourceError("Error creating "+a+" source buffer."),o.error(new A.default(T.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,T.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+a))}},getType:function(){return a},getStreamProcessor:function(){return u},setSeekStartTime:function(){},getBuffer:function(){return f},getBufferLevel:function(){return 0},setMediaSource:p,getMediaSource:function(){return d},getIsBufferingCompleted:function(){return t},getIsPruningInProgress:function(){return!1},dischargePreBuffer:function(){},switchInitData:function(e,t){h.extract(e,t)||n.trigger(_.default.TIMED_TEXT_REQUESTED,{index:0,sender:l})},getRangeAt:function(){return null},reset:function(e){n.off(_.default.DATA_UPDATE_COMPLETED,m,l),n.off(_.default.INIT_FRAGMENT_LOADED,g,l),!e&&f&&(f.abort(),f.reset(),f=null)},updateTimestampOffset:function(e){f.timestampOffset===e||isNaN(e)||(f.timestampOffset=e)}},d=null,t=c=!1,n.on(_.default.DATA_UPDATE_COMPLETED,m,l),n.on(_.default.INIT_FRAGMENT_LOADED,g,l),l}o.__dashjs_factory_name=S,r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/errors/Errors":349,"../../core/events/Events":352,"../../streaming/text/TextController":490,"../../streaming/vo/DashJSError":514,"../SourceBufferSink":396,"../constants/Constants":400,"../utils/InitCache":502}],489:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("../constants/Constants")),i=n(e("../../core/FactoryMaker")),a=n(e("./../controllers/BufferController")),s=n(e("./NotFragmentedTextBufferController"));function u(e){e=e||{};var t,r=this.context,n=void 0;function i(){return n.getBuffer()}return t={getBufferControllerType:function(){return n.getBufferControllerType()},initialize:function(e,t){return n.initialize(e,t)},createBuffer:function(e){return n.createBuffer(e)},getType:function(){return n.getType()},getStreamProcessor:function(){n.getStreamProcessor()},setSeekStartTime:function(e){n.setSeekStartTime(e)},getBuffer:i,setBuffer:function(e){n.setBuffer(e)},getBufferLevel:function(){return n.getBufferLevel()},setMediaSource:function(e){n.setMediaSource(e)},getMediaSource:function(){return n.getMediaSource()},getIsBufferingCompleted:function(){return n.getIsBufferingCompleted()},getIsPruningInProgress:function(){return n.getIsPruningInProgress()},dischargePreBuffer:function(){return n.dischargePreBuffer()},switchInitData:function(e,t){n.switchInitData(e,t)},getRangeAt:function(e){return n.getRangeAt(e)},reset:function(e){n.reset(e)},updateTimestampOffset:function(e){var t=i();t.timestampOffset===e||isNaN(e)||(t.timestampOffset=e)}},n=e.type===o.default.FRAGMENTED_TEXT?(0,a.default)(r).create({type:e.type,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,manifestModel:e.manifestModel,errHandler:e.errHandler,streamController:e.streamController,mediaController:e.mediaController,adapter:e.adapter,textController:e.textController,abrController:e.abrController,playbackController:e.playbackController,streamProcessor:e.streamProcessor}):(0,s.default)(r).create({type:e.type,mimeType:e.mimeType,errHandler:e.errHandler,streamProcessor:e.streamProcessor}),t}u.__dashjs_factory_name="TextBufferController",r.default=i.default.getClassFactory(u),t.exports=r.default},{"../../core/FactoryMaker":347,"../constants/Constants":400,"./../controllers/BufferController":406,"./NotFragmentedTextBufferController":488}],490:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var E=n(e("../constants/Constants")),i=n(e("../../core/FactoryMaker")),w=n(e("./TextSourceBuffer")),A=n(e("./TextTracks")),T=n(e("../utils/VTTParser")),S=n(e("../utils/TTMLParser")),x=n(e("../../core/EventBus")),M=n(e("../../core/events/Events")),R=e("../utils/SupervisorTools");function o(){var e=this.context,t=void 0,h=void 0,r=void 0,n=void 0,i=void 0,p=void 0,o=void 0,m=void 0,g=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,v=void 0,f=void 0;function y(e){var r=this,t=e.tracks,n=e.index;t.some(function(e,t){if(e.lang===l)return r.setTextTrack(t),n=t,!0}),d||this.setTextTrack(-1),c=n,u.trigger(M.default.TEXT_TRACKS_ADDED,{enabled:_(),index:n,tracks:t})}function _(){var e=!0;return v&&!f&&(e=!1),e}function b(){v=!1}return t={setConfig:function(e){e&&(e.errHandler&&(r=e.errHandler),e.dashManifestModel&&(n=e.dashManifestModel),e.manifestModel&&(i=e.manifestModel),e.mediaController&&(p=e.mediaController),e.videoModel&&(o=e.videoModel),e.streamController&&(m=e.streamController),e.textTracks&&(g=e.textTracks),e.vttParser&&(a=e.vttParser),e.ttmlParser&&(s=e.ttmlParser),h.setConfig({errHandler:r,dashManifestModel:n,manifestModel:i,mediaController:p,videoModel:o,streamController:m,textTracks:g,vttParser:a,ttmlParser:s}))},getTextSourceBuffer:function(){return h},getAllTracksAreDisabled:function(){return v},addEmbeddedTrack:function(e){h.addEmbeddedTrack(e)},getTextDefaultLanguage:function(){return l},setTextDefaultLanguage:function(e){(0,R.checkParameterType)(e,"string"),l=e},setTextDefaultEnabled:function(e){(0,R.checkParameterType)(e,"boolean"),(d=e)||this.setTextTrack(-1)},getTextDefaultEnabled:function(){return d},enableText:function(e){(0,R.checkParameterType)(e,"boolean"),_()!==e&&(e&&this.setTextTrack(c),e||(c=this.getCurrentTrackIdx(),this.setTextTrack(-1)))},isTextEnabled:_,setTextTrack:function(e){var t=h.getConfig(),r=t.fragmentModel,n=t.fragmentedTracks,i=t.videoModel,o=void 0,a=void 0;v=-1===e;var s=g.getCurrentTrackIdx();if(s!==e){g.setModeForTrackIdx(s,E.default.TEXT_HIDDEN),g.setCurrentTrackIdx(e),g.setModeForTrackIdx(e,E.default.TEXT_SHOWING);var u=g.getCurrentTrackInfo();if(u&&u.isFragmented&&!u.isEmbedded)for(var l=0;l<n.length;l++){var c=n[l];if(u.lang===c.lang&&u.index===c.index&&(c.id?u.id===c.id:u.id===c.index))if(c!==p.getCurrentTrackFor(E.default.FRAGMENTED_TEXT,m.getActiveStreamInfo()))r.abortRequests(),r.removeExecutedRequestsBeforeTime(),h.remove(),g.deleteCuesFromTrackIdx(s),p.setTrack(c),h.setCurrentFragmentedTrackIdx(l);else if(-1===s){for(var d=m.getActiveStreamProcessors(),f=0;f<d.length;f++)if(d[f].getType()===E.default.FRAGMENTED_TEXT){a=d[f];break}a.getIndexHandler().setCurrentTime(i.getTime()),a.getScheduleController().start()}}else if(u&&!u.isFragmented){for(d=m.getActiveStreamProcessors(),l=0;l<d.length;l++)if(d[l].getType()===E.default.TEXT){o=(a=d[l]).getMediaInfoArr();break}if(a&&o)for(l=0;l<o.length;l++)if(o[l].index===u.index&&o[l].lang===u.lang){a.selectMediaInfo(o[l]);break}}}},getCurrentTrackIdx:function(){return g.getCurrentTrackIdx()},enableForcedTextStreaming:function(e){(0,R.checkParameterType)(e,"boolean"),f=e},reset:function(){b(),h.resetEmbedded(),h.reset()}},c=-1,f=!(d=!(l="")),g=(0,A.default)(e).getInstance(),a=(0,T.default)(e).getInstance(),s=(0,S.default)(e).getInstance(),h=(0,w.default)(e).getInstance(),u=(0,x.default)(e).getInstance(),g.initialize(),u.on(M.default.TEXT_TRACKS_QUEUE_INITIALIZED,y,t),b(),t}o.__dashjs_factory_name="TextController",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../constants/Constants":400,"../utils/SupervisorTools":507,"../utils/TTMLParser":508,"../utils/VTTParser":510,"./TextSourceBuffer":491,"./TextTracks":492}],491:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var oe=n(e("../constants/Constants")),ae=e("../vo/metrics/HTTPRequest"),v=n(e("../vo/TextTrackInfo")),y=n(e("../utils/BoxParser")),_=n(e("../utils/CustomTimeRanges")),i=n(e("../../core/FactoryMaker")),b=n(e("../../core/Debug")),E=n(e("./TextTracks")),w=n(e("./EmbeddedTextHtmlRender")),se=n(e("codem-isoboxer")),ue=n(e("../../../externals/cea608-parser")),A=n(e("../../core/EventBus")),T=n(e("../../core/events/Events")),le=n(e("../vo/DashJSError")),ce=n(e("../../core/errors/Errors"));function o(){var o=this.context,r=(0,A.default)(o).getInstance(),n=!1,a=void 0,j=void 0,B=void 0,U=void 0,s=void 0,G=void 0,u=void 0,H=void 0,i=void 0,l=void 0,c=void 0,V=void 0,z=void 0,W=void 0,q=void 0,d=void 0,Y=void 0,f=void 0,K=void 0,X=void 0,Q=void 0,J=void 0,Z=void 0,$=void 0,ee=void 0,te=void 0,re=void 0;function e(){q=NaN,K=z=null,W=!(d=[]),c=[],H=null}function h(e){var t=e.chunk;t.mediaInfo.embeddedCaptions&&g(t.bytes,t)}function p(){Q=[],(V=(0,E.default)(o).getInstance()).setConfig({videoModel:Y}),V.initialize(),B=(0,y.default)(o).getInstance(),!1,ee=[],$=[],n=!(Z=X=null),te=(J=0,w.default)(o).getInstance();var e=f.getActiveStreamProcessors();for(var t in e)if("video"===e[t].getType()){re=e[t].getRepresentationInfo().MSETimeOffset;break}r.on(T.default.VIDEO_CHUNK_RECEIVED,h,this)}function m(e){X=e}function ne(e,t){var r,n,i=new v.default,o={subtitle:"subtitles",caption:"captions"};i.captionData=e,i.lang=t.lang,i.labels=t.labels,i.id=t.id?t.id:t.index,i.index=t.index,i.isTTML=(r=!1,t.codec&&0<=t.codec.search(oe.default.STPP)&&(r=!0),t.mimeType&&0<=t.mimeType.search(oe.default.TTML)&&(r=!0),r),i.defaultTrack=function(e){var t=!1;1<Q.length&&e.isEmbedded?t=e.id&&e.id===oe.default.CC1:1===Q.length?e.id&&"string"==typeof e.id&&"CC"===e.id.substring(0,2)&&(t=!0):0===Q.length&&(t=e.index===c[0].index);return t}(t),i.isFragmented=!s.getIsTextTrack(t.mimeType),i.isEmbedded=!!t.isEmbedded,i.kind=n=(n=0<t.roles.length?o[t.roles[0]]:o.caption)===o.caption||n===o.subtitle?n:o.caption,i.roles=t.roles,i.accessibility=t.accessibility;var a=(c?c.length:0)+Q.length;V.addTextTrack(i,a)}function g(e,t){var r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=t.mediaInfo,c=l.type,d=l.mimeType,f=l.codec||d;if(f){if(c===oe.default.FRAGMENTED_TEXT)if(W)if(n=(s=B.getSamplesInfo(e)).sampleList,null===K&&0<n.length&&(K=n[0].cts-t.start*q),0<=f.search(oe.default.STPP))for(H=null!==H?H:ie(f),i=0;i<n.length;i++){var h=(w=n[i]).cts,p=h-K;this.buffered.add(p/q,(p+w.duration)/q);var m=new DataView(e,w.offset,w.subSizes[0]);u=se.default.Utils.dataViewToString(m,oe.default.UTF8);var g=[],v=w.offset+w.subSizes[0];for(o=1;o<w.subSizes.length;o++){var y=new Uint8Array(e,v,w.subSizes[o]),_=String.fromCharCode.apply(null,y);g.push(_),v+=w.subSizes[o]}try{var b=G.getValue().ttmlTimeIsRelative?h/q:0;r=H.parse(u,b,h/q,(h+w.duration)/q,g),V.addCaptions(X,K/q,r)}catch(e){z.removeExecutedRequestsBeforeTime(),this.remove(),j.error("TTML parser error: "+e.message)}}else{var E=[];for(i=0;i<n.length;i++){var w;(w=n[i]).cts-=K,this.buffered.add(w.cts/q,(w.cts+w.duration)/q);var A=e.slice(w.offset,w.offset+w.size),T=se.default.parseBuffer(A);for(o=0;o<T.boxes.length;o++){var S=T.boxes[o];if(j.debug("VTT box1: "+S.type),"vtte"!==S.type&&"vttc"===S.type)for(j.debug("VTT vttc boxes.length = "+S.boxes.length),a=0;a<S.boxes.length;a++){var x=S.boxes[a];if(j.debug("VTT box2: "+x.type),"payl"===x.type){var M=x.cue_text;j.debug("VTT cue_text = "+M);var R=w.cts/q,O=(w.cts+w.duration)/q;E.push({start:R,end:O,data:M,styles:{}}),j.debug("VTT "+R+"-"+O+" : "+M)}}}}0<E.length&&V.addCaptions(X,0,E)}else W=!0,q=B.getMediaTimescaleFromMoov(e);else if(c===oe.default.TEXT){m=new DataView(e,0,e.byteLength);u=se.default.Utils.dataViewToString(m,oe.default.UTF8);try{r=ie(f).parse(u,0),V.addCaptions(V.getCurrentTrackIdx(),0,r)}catch(e){U.timedTextError(e,"parse",u),U.error(new le.default(ce.default.TIMED_TEXT_ERROR_ID_PARSE_CODE,ce.default.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,u))}}else if(c===oe.default.VIDEO)if(t.segmentType===ae.HTTPRequest.INIT_SEGMENT_TYPE){if(0===J)for(J=B.getMediaTimescaleFromMoov(e),i=0;i<Q.length;i++)ne(null,Q[i])}else{if(0===J)return void j.warn("CEA-608: No timescale for embeddedTextTrack yet");var P=function(e,i){return function(e,t,r){var n=null;n=Y.getTTMLRenderingDiv()?te.createHTMLCaptionsFromScreen(Y.getElement(),e,t,r):[{start:e,end:t,data:r.getDisplayText(),styles:{}}],n&&V.addCaptions(i,0,n)}},C=(s=B.getSamplesInfo(e)).lastSequenceNumber;if(!ee[0]&&!ee[1]){var D=void 0,I=void 0;for(i=0;i<Q.length;i++){if(Q[i].id===oe.default.CC1?(0,I=V.getTrackIdxForId(oe.default.CC1)):Q[i].id===oe.default.CC3&&(1,I=V.getTrackIdxForId(oe.default.CC3)),-1===I)return void j.warn("CEA-608: data before track is ready.");D=P(0,I),ee[i]=new ue.default.Cea608Parser(i+1,{newCue:D},null)}}if(J&&-1==$.indexOf(C)){if(null!==Z&&C!==Z+s.numSequences)for(i=0;i<ee.length;i++)ee[i]&&ee[i].reset();for(var L=function(e,t){if(0===t.length)return null;for(var r={splits:[],fields:[[],[]]},n=new DataView(e),i=0;i<t.length;i++)for(var o=t[i],a=ue.default.findCea608Nalus(n,o.offset,o.size),s=null,u=0,l=0;l<a.length;l++)for(var c=ue.default.extractCea608DataFromRange(n,a[l]),d=0;d<2;d++)0<c[d].length&&(o.cts!==s?u=0:u+=1,r.fields[d].push([o.cts+re*J,c[d],u]),s=o.cts);return r.fields.forEach(function(e){e.sort(function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]})}),r}(e,s.sampleList),N=0;N<ee.length;N++){var k=L.fields[N],F=ee[N];if(F)for(i=0;i<k.length;i++)F.addData(k[i][0]/J,k[i][1])}Z=C,$.push(C)}}}else j.error("No text type defined")}function ie(e){var t=void 0;return 0<=e.search(oe.default.VTT)?t=i:(0<=e.search(oe.default.TTML)||0<=e.search(oe.default.STPP))&&(t=l),t}return a={initialize:function(e,t){n||p(),V.setConfig({videoModel:Y}),V.initialize(),B=B||(0,y.default)(o).getInstance(),function(e,t){var r=!s.getIsTextTrack(e);if(t){if(c=c.concat(t.getMediaInfoArr()),r){z=t.getFragmentModel(),a.buffered=(0,_.default)(o).create(),d=u.getTracksFor(oe.default.FRAGMENTED_TEXT,f.getActiveStreamInfo());for(var n=u.getCurrentTrackFor(oe.default.FRAGMENTED_TEXT,f.getActiveStreamInfo()),i=0;i<d.length;i++)if(d[i]===n){m(i);break}}for(i=0;i<c.length;i++)ne(null,c[i])}}(e,t)},append:g,abort:function(){V.deleteAllTextTracks(),z=B=null,W=!(c=[]),d=[]},addEmbeddedTrack:function(e){if(n||p(),e)if(e.id===oe.default.CC1||e.id===oe.default.CC3){for(var t=0;t<Q.length;t++)if(Q[t].id===e.id)return;Q.push(e)}else j.warn("Embedded track "+e.id+" not supported!")},resetEmbedded:function(){r.off(T.default.VIDEO_CHUNK_RECEIVED,h,this),V&&V.deleteAllTextTracks(),n=!1,Q=[],ee=[null,null],$=[],Z=null},setConfig:function(e){e&&(e.errHandler&&(U=e.errHandler),e.dashManifestModel&&(s=e.dashManifestModel),e.manifestModel&&(G=e.manifestModel),e.mediaController&&(u=e.mediaController),e.videoModel&&(Y=e.videoModel),e.streamController&&(f=e.streamController),e.textTracks&&(V=e.textTracks),e.vttParser&&(i=e.vttParser),e.ttmlParser&&(l=e.ttmlParser))},getConfig:function(){return{fragmentModel:z,fragmentedTracks:d,videoModel:Y}},setCurrentFragmentedTrackIdx:m,remove:function(e,t){void 0===e&&e===t&&(e=this.buffered.start(0),t=this.buffered.end(this.buffered.length-1)),this.buffered.remove(e,t)},reset:function(){e(),V=Y=f=null}},j=(0,b.default)(o).getInstance().getLogger(a),e(),a}o.__dashjs_factory_name="TextSourceBuffer",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../../externals/cea608-parser":341,"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/errors/Errors":349,"../../core/events/Events":352,"../constants/Constants":400,"../utils/BoxParser":496,"../utils/CustomTimeRanges":498,"../vo/DashJSError":514,"../vo/TextTrackInfo":526,"../vo/metrics/HTTPRequest":534,"./EmbeddedTextHtmlRender":487,"./TextTracks":492,"codem-isoboxer":8}],492:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var _=n(e("../constants/Constants")),s=n(e("../../core/EventBus")),P=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker")),C=n(e("../../core/Debug")),D=e("imsc");function o(){var e=this.context,b=(0,s.default)(e).getInstance(),t=void 0,u=void 0,l=void 0,E=void 0,c=void 0,d=void 0,f=void 0,w=void 0,A=void 0,T=void 0,S=void 0,x=void 0,n=void 0,M=void 0,R=void 0,r=void 0,O=void 0;function h(e){var t=c[e].kind,r=void 0!==c[e].id?c[e].id:c[e].lang,n=c[e].lang,i=c[e].isTTML,o=c[e].isEmbedded,a=E.addTextTrack(t,r,n);return a.isEmbedded=o,a.isTTML=i,a}function i(e,t){var r=E.getClientWidth(),n=E.getClientHeight(),i=E.getVideoWidth(),o=E.getVideoHeight(),a=E.getVideoRelativeOffsetTop(),s=E.getVideoRelativeOffsetLeft(),u=i/o,l=!1;e.isFromCEA608&&(u=3.5/3,l=!0);var c=function(e,t,r,n,i,o){var a=0,s=0;r/n<e/t?a=(s=t)/n*r:s=(a=e)/r*n;var u,l,c=0,d=0;return i<a/s?c=(d=s)*i:d=(c=a)/i,u=(e-c)/2,l=(t-d)/2,o?{x:u+.1*c,y:l+.1*d,w:.8*c,h:.8*d}:{x:u,y:l,w:c,h:d}}.call(this,r,n,i,o,u,l),d=c.w,f=c.h,h=c.x,p=c.y;if(d!=T||f!=S||h!=w||p!=A||t){if(w=h+s,A=p+a,T=d,S=f,x){var m=x.style;m.left=w+"px",m.top=A+"px",m.width=T+"px",m.height=S+"px",m.zIndex=M&&document[M]||R?O:null,b.trigger(P.default.CAPTION_CONTAINER_RESIZE,{})}var g=e.activeCues;if(g)for(var v=g.length,y=0;y<v;++y){var _=g[y];_.scaleCue(_)}}}function p(e){var t=T,r=S,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0;if(e.cellResolution){var u=[t/e.cellResolution[0],r/e.cellResolution[1]];if(e.linePadding)for(n in e.linePadding)if(e.linePadding.hasOwnProperty(n)){i=(e.linePadding[n]*u[0]).toString();for(var l=document.getElementsByClassName("spanPadding"),c=0;c<l.length;c++)l[c].style.cssText=l[c].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i),l[c].style.cssText=l[c].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}if(e.fontSize){for(n in e.fontSize)if(e.fontSize.hasOwnProperty(n)){"%"===e.fontSize[n][0]?o=e.fontSize[n][1]/100:"c"===e.fontSize[n][0]&&(o=e.fontSize[n][1]),i=(o*u[1]).toString(),s="defaultFontSize"!==n?document.getElementsByClassName(n):document.getElementsByClassName("paragraph");for(var d=0;d<s.length;d++)s[d].style.cssText=s[d].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}if(e.lineHeight)for(n in e.lineHeight)if(e.lineHeight.hasOwnProperty(n)){"%"===e.lineHeight[n][0]?a=e.lineHeight[n][1]/100:"c"===e.fontSize[n][0]&&(a=e.lineHeight[n][1]),i=(a*u[1]).toString(),s=document.getElementsByClassName(n);for(var f=0;f<s.length;f++)s[f].style.cssText=s[f].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}}}if(e.isd){var h=document.getElementById(e.cueID);h&&x.removeChild(h),m(e)}}function m(o){if(x){var e=document.createElement("div");x.appendChild(e),r=(0,D.renderHTML)(o.isd,e,function(e){var t=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,r=/^#(.*)$/;if(t.test(e)){var n=t.exec(e),i=parseInt(n[4],10)-1;return"data:image/png;base64,"+btoa(o.images[i])}if(r.test(e)){i=(n=r.exec(e))[1];return"data:image/png;base64,"+o.embeddedImages[i]}return null},x.clientHeight,x.clientWidth,!1,function(e){u.info("renderCaption :",e)},r,!0),e.id=o.cueID,b.trigger(P.default.CAPTION_RENDERED,{captionDiv:e,currentTrackIdx:f})}}function g(e){return 0<=e&&c[e]?E.getTextTrack(c[e].kind,c[e].id,c[e].lang,c[e].isTTML,c[e].isEmbedded):null}function v(e){if(e!==f){var t=g(f=e);(function(e){a.call(this),e&&"html"===e.renderingType?function(){var e=document.getElementById("native-cue-style");if(e)return;(e=document.createElement("style")).id="native-cue-style",document.head.appendChild(e);var t=e.sheet,r=E.getElement();try{r&&(r.id?t.insertRule("#"+r.id+"::cue {background: transparent}",0):0!==r.classList.length?t.insertRule("."+r.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(e){u.info(""+e.message)}}.call(this):o.call(this)}).call(this,t),n&&(clearInterval(n),n=null),t&&"html"===t.renderingType&&(i.call(this,t,!0),n=setInterval(i.bind(this,t),500))}}function y(e){if(e.cues)for(var t=e.cues,r=t.length-1;0<=r;r--)e.removeCue(t[r])}function o(){var e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}function a(){if(x)for(;x.firstChild;)x.removeChild(x.firstChild)}return t={initialize:function(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(l=window.VTTCue||window.TextTrackCue,c=[],d=[],R=!(f=-1),O=2147483647,r=n=x=null,void(S=T=A=w=0)!==document.fullscreenElement?M="fullscreenElement":void 0!==document.webkitIsFullScreen?M="webkitIsFullScreen":document.msFullscreenElement?M="msFullscreenElement":document.mozFullScreen&&(M="mozFullScreen"))},displayCConTop:function(e){R=e,x&&!document[M]&&(x.style.zIndex=e?O:null)},addTextTrack:function(e,t){if(c.length!==t){if(c.push(e),c.length===t){c.sort(function(e,t){return e.index-t.index}),x=E.getTTMLRenderingDiv();for(var r=-1,n=0;n<c.length;n++){var i=h.call(this,n);d.push(i),c[n].defaultTrack&&(i.default=!0,r=n);var o=g(n);o&&(o.mode=_.default.TEXT_SHOWING,x&&(c[n].isTTML||c[n].isEmbedded)?o.renderingType="html":o.renderingType="default"),this.addCaptions(n,0,c[n].captionData),b.trigger(P.default.TEXT_TRACK_ADDED)}if(v.call(this,r),0<=r)for(var a=0;a<c.length;a++){var s=g(a);s&&(s.mode=a===r?_.default.TEXT_SHOWING:_.default.TEXT_HIDDEN)}b.trigger(P.default.TEXT_TRACKS_QUEUE_INITIALIZED,{index:f,tracks:c})}}else u.error("Trying to add too many tracks.")},addCaptions:function(e,t,r){var n=g(e),i=this;if(n&&r&&0!==r.length)for(var o=0;o<r.length;o++){var a=void 0,s=r[o];n.cellResolution=s.cellResolution,n.isFromCEA608=s.isFromCEA608,"html"===s.type&&x?((a=new l(s.start-t,s.end-t,"")).cueHTMLElement=s.cueHTMLElement,a.isd=s.isd,a.images=s.images,a.embeddedImages=s.embeddedImages,a.cueID=s.cueID,a.scaleCue=p.bind(i),a.cellResolution=s.cellResolution,a.lineHeight=s.lineHeight,a.linePadding=s.linePadding,a.fontSize=s.fontSize,x.style.left=w+"px",x.style.top=A+"px",x.style.width=T+"px",x.style.height=S+"px",a.onenter=function(){n.mode===_.default.TEXT_SHOWING&&(this.isd?(m(this),u.debug("Cue enter id:"+this.cueID)):(x.appendChild(this.cueHTMLElement),p.call(i,this),b.trigger(P.default.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:f})))},a.onexit=function(){if(x)for(var e=x.childNodes,t=0;t<e.length;++t)e[t].id===this.cueID&&(u.debug("Cue exit id:"+e[t].id),x.removeChild(e[t]))}):s.data&&(a=new l(s.start-t,s.end-t,s.data),s.styles&&(void 0!==s.styles.align&&"align"in a&&(a.align=s.styles.align),void 0!==s.styles.line&&"line"in a&&(a.line=s.styles.line),void 0!==s.styles.position&&"position"in a&&(a.position=s.styles.position),void 0!==s.styles.size&&"size"in a&&(a.size=s.styles.size)),a.onenter=function(){n.mode===_.default.TEXT_SHOWING&&b.trigger(P.default.CAPTION_RENDERED,{currentTrackIdx:f})});try{a?n.addCue(a):u.error("impossible to display subtitles.")}catch(e){throw y(n),n.addCue(a),e}}},getCurrentTrackIdx:function(){return f},setCurrentTrackIdx:v,getTrackIdxForId:function(e){for(var t=-1,r=0;r<c.length;r++)if(c[r].id===e){t=r;break}return t},getCurrentTrackInfo:function(){return c[f]},setModeForTrackIdx:function(e,t){var r=g(e);r&&r.mode!==t&&(r.mode=t)},deleteCuesFromTrackIdx:function(e){var t=g(e);t&&y(t)},deleteAllTextTracks:function(){for(var e=d?d.length:0,t=0;t<e;t++){var r=g(t);r&&(y.call(this,r),r.mode="disabled")}d=[],c=[],n&&(clearInterval(n),n=null),f=-1,a.call(this)},deleteTextTrack:function(e){E.removeChild(d[e]),d.splice(e,1)},setConfig:function(e){e&&e.videoModel&&(E=e.videoModel)}},u=(0,C.default)(e).getInstance().getLogger(t),t}o.__dashjs_factory_name="TextTracks",r.default=i.default.getSingletonFactory(o),t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,"../constants/Constants":400,imsc:570}],493:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),o=n(e("../constants/Constants")),u=n(e("../vo/Thumbnail")),a=n(e("./ThumbnailTracks")),l=n(e("../vo/BitrateInfo")),c=e("../../dash/utils/SegmentsUtils");function s(e){var t,r=this.context,s=void 0;function n(){s&&s.reset()}return t={get:function(e,t){var r=s.getCurrentTrack();if(!r||r.segmentDuration<=0||null==e)return null;var n=Math.floor(e/r.segmentDuration),i=e%r.segmentDuration,o=Math.floor(i*r.tilesHor*r.tilesVert/r.segmentDuration),a=new u.default;return a.width=Math.floor(r.widthPerTile),a.height=Math.floor(r.heightPerTile),a.x=Math.floor(o%r.tilesHor)*r.widthPerTile,a.y=Math.floor(o/r.tilesHor)*r.heightPerTile,"readThumbnail"in r?r.readThumbnail(e,function(e){a.url=e,t&&t(a)}):(a.url=function(e,t){var r=t+e.startNumber,n=(0,c.replaceTokenForTemplate)(e.templateUrl,"Number",r);return n=(0,c.replaceTokenForTemplate)(n,"Time",(r-1)*e.segmentDuration),n=(0,c.replaceTokenForTemplate)(n,"Bandwidth",e.bandwidth),(0,c.unescapeDollarsInTemplate)(n)}(r,n),t&&t(a),a)},setTrackByIndex:function(e){s.setTrackByIndex(e)},getCurrentTrackIndex:function(){return s.getCurrentTrackIndex()},getBitrateList:function(){var e=s.getTracks(),r=0;return e.map(function(e){var t=new l.default;return t.mediaType=o.default.IMAGE,t.qualityIndex=r++,t.bitrate=e.bitrate,t.width=e.width,t.height=e.height,t})},reset:n},n(),s=(0,a.default)(r).create({dashManifestModel:e.dashManifestModel,adapter:e.adapter,baseURLController:e.baseURLController,stream:e.stream,timelineConverter:e.timelineConverter}),t}s.__dashjs_factory_name="ThumbnailController",r.default=i.default.getClassFactory(s),t.exports=r.default},{"../../core/FactoryMaker":347,"../../dash/utils/SegmentsUtils":376,"../constants/Constants":400,"../vo/BitrateInfo":513,"../vo/Thumbnail":527,"./ThumbnailTracks":494}],494:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var b=n(e("../constants/Constants")),E=n(e("../../dash/constants/DashConstants")),i=n(e("../../core/FactoryMaker")),w=n(e("../vo/ThumbnailTrackInfo")),A=n(e("../../streaming/utils/URLUtils")),T=e("../../dash/utils/SegmentsUtils"),S=n(e("../../dash/SegmentBaseLoader")),x=n(e("../../streaming/utils/BoxParser")),M=n(e("../../streaming/net/XHRLoader")),R=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function o(e){var t,r=this.context,u=e.dashManifestModel,i=e.adapter,s=e.baseURLController,o=e.stream,l=e.timelineConverter,n=e.metricsModel,a=e.mediaPlayerModel,c=e.errHandler,d=(0,A.default)(r).getInstance(),f=void 0,h=void 0,p=void 0,m=void 0,g=void 0;function v(){_(),p=(0,M.default)(r).create({}),g=(0,x.default)(r).getInstance(),(m=(0,S.default)(r).getInstance()).setConfig({baseURLController:s,metricsModel:n,mediaPlayerModel:a,errHandler:c}),function(){if(!o||!u||!i)return;var e=o.getStreamInfo();if(!e)return;var t=i.getMediaInfoForType(e,b.default.IMAGE);if(!t)return;var r=i.getDataForMedia(t);if(!r)return;var n=u.getRepresentationsForAdaptation(r);n&&0<n.length&&n.forEach(function(e){e.segmentInfoType===E.default.SEGMENT_TEMPLATE&&0<e.segmentDuration&&e.media&&y(e),e.segmentInfoType===E.default.SEGMENT_BASE&&y(e,!0)});0<f.length&&(f.sort(function(e,t){return e.bitrate-t.bitrate}),h=f.length-1)}()}function y(e,t){var r=new w.default;r.id=e.id,r.bitrate=e.bandwidth,r.width=e.width,r.height=e.height,r.tilesHor=1,r.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach(function(e){if(0<=R.indexOf(e.schemeIdUri)&&e.value){var t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(r.tilesHor=parseInt(t[0],10),r.tilesVert=parseInt(t[1],10))}}),t?m.loadSegments(e,b.default.IMAGE,e.indexRange,{},function(e,n){var a=[];e=function(e,t){var r,n=[],i=0,o=void 0,a=void 0,s=void 0;for(o=0,r=e.length;o<r;o++)a=e[o],s=(0,T.getTimeBasedSegment)(l,u.getIsDynamic(),t,a.startTime,a.duration,a.timescale,a.media,a.mediaRange,i),n.push(s),s=null,i++;return n}(e,n),r.segmentDuration=e[0].duration,r.readThumbnail=function(t,o){var r=null;a.some(function(e){if(e.start<=t&&e.end>t)return r=e.url,!0}),r?o(r):e.some(function(i){if(i.mediaStartTime<=t&&i.mediaStartTime+i.duration>t){var e=s.resolve(n.path);return p.load({method:"get",url:e.url,request:{range:i.mediaRange,responseType:"arraybuffer"},onload:function(e){var t=g.getSamplesInfo(e.target.response),r=new Blob([e.target.response.slice(t.sampleList[0].offset,t.sampleList[0].offset+t.sampleList[0].size)],{type:"image/jpeg"}),n=window.URL.createObjectURL(r);a.push({start:i.mediaStartTime,end:i.mediaStartTime+i.duration,url:n}),o&&o(n)}}),!0}})}}):(r.startNumber=e.startNumber,r.segmentDuration=e.segmentDuration,r.timescale=e.timescale,r.templateUrl=function(e){var t=d.isRelative(e.media)?d.resolve(e.media,s.resolve(e.path).url):e.media;return t?(0,T.replaceIDForTemplate)(t,e.id):""}(e)),0<r.tilesHor&&0<r.tilesVert&&(r.widthPerTile=r.width/r.tilesHor,r.heightPerTile=r.height/r.tilesVert,f.push(r))}function _(){f=[],h=-1}return t={initialize:v,getTracks:function(){return f},reset:_,setTrackByIndex:function(e){f&&0!==f.length&&(e>=f.length&&(e=f.length-1),h=e)},getCurrentTrack:function(){return h<0?null:f[h]},getCurrentTrackIndex:function(){return h}},v(),t}r.THUMBNAILS_SCHEME_ID_URIS=R,o.__dashjs_factory_name="ThumbnailTracks",r.default=i.default.getClassFactory(o)},{"../../core/FactoryMaker":347,"../../dash/SegmentBaseLoader":357,"../../dash/constants/DashConstants":359,"../../dash/utils/SegmentsUtils":376,"../../streaming/net/XHRLoader":448,"../../streaming/utils/BoxParser":496,"../../streaming/utils/URLUtils":509,"../constants/Constants":400,"../vo/ThumbnailTrackInfo":528}],495:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=n(e("../../core/errors/Errors")),c=n(e("../../core/EventBus")),d=n(e("../../core/events/Events")),f=n(e("../controllers/BlacklistController")),h=n(e("./baseUrlResolution/DVBSelector")),p=n(e("./baseUrlResolution/BasicSelector")),i=n(e("../../core/FactoryMaker")),m=n(e("../vo/DashJSError")),g=n(e("../constants/Constants"));function o(){var e,t=this.context,i=(0,c.default)(t).getInstance(),r=void 0,n=void 0,o=void 0,a=void 0,s=void 0;function u(){n.reset()}return e={chooseSelectorFromManifest:function(e){!function(){if(!r||!r.hasOwnProperty("getIsDVB"))throw new Error(g.default.MISSING_CONFIG_ERROR)}(),s=r.getIsDVB(e)?a:o},select:function(e){if(e){var t=e.baseUrls,r=e.selectedIdx;if(!isNaN(r))return t[r];var n=s.select(t);return n?(e.selectedIdx=t.indexOf(n),n):(i.trigger(d.default.URL_RESOLUTION_FAILED,{error:new m.default(l.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,l.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(s===o&&u()))}},reset:u,setConfig:function(e){e.selector&&(s=e.selector),e.dashManifestModel&&(r=e.dashManifestModel)}},n=(0,f.default)(t).create({updateEventName:d.default.SERVICE_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:d.default.SERVICE_LOCATION_BLACKLIST_ADD}),o=(0,p.default)(t).create({blacklistController:n}),a=(0,h.default)(t).create({blacklistController:n}),s=o,e}o.__dashjs_factory_name="BaseURLSelector",r.default=i.default.getClassFactory(o),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/errors/Errors":349,"../../core/events/Events":352,"../constants/Constants":400,"../controllers/BlacklistController":405,"../vo/DashJSError":514,"./baseUrlResolution/BasicSelector":511,"./baseUrlResolution/DVBSelector":512}],496:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/Debug")),a=n(e("./IsoFile")),o=n(e("../../core/FactoryMaker")),s=n(e("codem-isoboxer")),f=n(e("../vo/IsoBoxSearchInfo"));function u(){var o=void 0,e=void 0,n=this.context;function I(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=s.default.parseBuffer(e),r=(0,a.default)(n).create();return r.setData(t),r}return e={parse:I,findLastTopIsoBoxCompleted:function(e,t,r){if(void 0===r&&(r=0),!t||r+8>=t.byteLength)return new f.default(0,!1);for(var n,i,o,a,s=t instanceof ArrayBuffer?new Uint8Array(t):t,u=void 0,l=0;r<s.byteLength;){var c=(o=s)[(a=r)+3]>>>0|o[a+2]<<8>>>0|o[a+1]<<16>>>0|o[a]<<24>>>0,d=(n=s,i=r+4,String.fromCharCode(n[i++])+String.fromCharCode(n[i++])+String.fromCharCode(n[i++])+String.fromCharCode(n[i]));if(0==c)break;r+c<=s.byteLength&&(0<=e.indexOf(d)?u=new f.default(r,!0,c):l=r+c),r+=c}return u||new f.default(l,!1)},getMediaTimescaleFromMoov:function(e){var t=I(e),r=t?t.getBox("mdhd"):void 0;return r?r.timescale:NaN},getSamplesInfo:function(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var t,r,n=I(e),i=n.getBoxes("moof"),o=n.getBoxes("mfhd"),a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,_=void 0;r=n.getBoxes("moof").length,t=o[o.length-1].sequence_number,c=[];var b=-1,E=-1;for(m=s=0;m<i.length;m++){var w=i[m],A=w.getChildBoxes("traf");for(h=0;h<A.length;h++){var T=A[h],S=T.getChildBox("tfhd"),x=T.getChildBox("tfdt");l=x.baseMediaDecodeTime;var M=T.getChildBoxes("trun"),R=T.getChildBoxes("subs");for(p=0;p<M.length;p++){var O=M[p];for(s=O.sample_count,y=(S.base_data_offset||0)+(O.data_offset||0),f=0;f<s;f++){a=void 0!==(d=O.samples[f]).sample_duration?d.sample_duration:S.default_sample_duration,u=void 0!==d.sample_size?d.sample_size:S.default_sample_size;var P={dts:l,cts:l+(void 0!==d.sample_composition_time_offset?d.sample_composition_time_offset:0),duration:a,offset:w.offset+y,size:u,subSizes:[u]};if(R)for(g=0;g<R.length;g++){var C=R[g];if(b<C.entry_count-1&&E<f&&(b++,E+=C.entries[b].sample_delta),f==E){P.subSizes=[];var D=C.entries[b];for(v=0;v<D.subsample_count;v++)P.subSizes.push(D.subsamples[v].subsample_size)}}c.push(P),y+=u,l+=a}}_=l-x.baseMediaDecodeTime}}return{sampleList:c,lastSequenceNumber:t,totalDuration:_,numSequences:r}},findInitRange:function(e){var t=null,r=I(e);if(!r)return t;var n=r.getBox("ftyp"),i=r.getBox("moov");return o.debug("Searching for initialization."),i&&i.isComplete&&(t=(n?n.offset:i.offset)+"-"+(i.offset+i.size-1),o.debug("Found the initialization.  Range: "+t)),t}},o=(0,i.default)(n).getInstance().getLogger(e),e}u.__dashjs_factory_name="BoxParser",r.default=o.default.getSingletonFactory(u),t.exports=r.default},{"../../core/Debug":345,"../../core/FactoryMaker":347,"../vo/IsoBoxSearchInfo":519,"./IsoFile":503,"codem-isoboxer":8}],497:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(){var e,t=void 0;return t=!(e={supportsMediaSource:function(){var e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t},supportsEncryptedMedia:function(){return t},supportsCodec:function(e){return!!("MediaSource"in window&&MediaSource.isTypeSupported(e))||!!("WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(e))},setEncryptedMediaSupported:function(e){t=e}}),e}a.__dashjs_factory_name="Capabilities",r.default=o.default.getSingletonFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347}],498:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n},a=e("../utils/SupervisorTools");function s(){return{customTimeRangeArray:[],length:0,add:function(e,t){var r=0;for(r=0;r<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[r].start;r++);for(this.customTimeRangeArray.splice(r,0,{start:e,end:t}),r=0;r<this.customTimeRangeArray.length-1;r++)this.mergeRanges(r,r+1)&&r--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(var r=0;r<this.customTimeRangeArray.length;r++)if(e<=this.customTimeRangeArray[r].start&&t>=this.customTimeRangeArray[r].end)this.customTimeRangeArray.splice(r,1),r--;else{if(e>this.customTimeRangeArray[r].start&&t<this.customTimeRangeArray[r].end){this.customTimeRangeArray.splice(r+1,0,{start:t,end:this.customTimeRangeArray[r].end}),this.customTimeRangeArray[r].end=e;break}e>this.customTimeRangeArray[r].start&&e<this.customTimeRangeArray[r].end?this.customTimeRangeArray[r].end=e:t>this.customTimeRangeArray[r].start&&t<this.customTimeRangeArray[r].end&&(this.customTimeRangeArray[r].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){var r=this.customTimeRangeArray[e],n=this.customTimeRangeArray[t];return r.start<=n.start&&n.start<=r.end&&r.end<=n.end?(r.end=n.end,this.customTimeRangeArray.splice(t,1),!0):n.start<=r.start&&r.start<=n.end&&n.end<=r.end?(r.start=n.start,this.customTimeRangeArray.splice(t,1),!0):n.start<=r.start&&r.start<=n.end&&r.end<=n.end?(this.customTimeRangeArray.splice(e,1),!0):r.start<=n.start&&n.start<=r.end&&n.end<=r.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return(0,a.checkInteger)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start},end:function(e){return(0,a.checkInteger)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}}}s.__dashjs_factory_name="CustomTimeRanges",r.default=o.default.getClassFactory(s),t.exports=r.default},{"../../core/FactoryMaker":347,"../utils/SupervisorTools":507}],499:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),c=n(e("../../core/Debug")),d=n(e("../constants/Constants")),f=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],h="dashjs_?_bitrate",p="dashjs_?_settings",m="localStorage",g="LastBitrate",v="LastMediaSettings";function o(e){e=e||{};var t=this.context,a=e.mediaPlayerModel,r=void 0,s=void 0,n=void 0;function i(e){if(void 0!==n)return n;n=!1;var t=void 0;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return s.warn("DOMStorage access denied: "+e.message),n}if(!t||e!==m&&"sessionStorage"!==e)return n;try{t.setItem("1","1"),t.removeItem("1"),n=!0}catch(e){s.warn("DOMStorage is supported, but cannot be used: "+e.message)}return n}function o(){return 6e5*Math.round((new Date).getTime()/6e5)}function u(e,t){return i(e)&&a["get"+t+"CachingInfo"]().enabled}function l(){if(!a||!a.hasOwnProperty("getLastMediaSettingsCachingInfo"))throw new Error(d.default.MISSING_CONFIG_ERROR)}return r={getSavedBitrateSettings:function(e){var t=NaN;if(l(),u(m,g)){var r=h.replace(/\?/,e);try{var n=JSON.parse(localStorage.getItem(r))||{},i=(new Date).getTime()-parseInt(n.timestamp,10)>=a.getLastMediaSettingsCachingInfo().ttl||!1,o=parseFloat(n.bitrate);isNaN(o)||i?i&&localStorage.removeItem(r):(t=o,s.debug("Last saved bitrate for "+e+" was "+o))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(u(m,g)&&t){var r=h.replace(/\?/,e);try{localStorage.setItem(r,JSON.stringify({bitrate:t.toFixed(3),timestamp:o()}))}catch(e){s.error(e.message)}}},getSavedMediaSettings:function(e){if(l(),!u(m,v))return null;var t=null,r=p.replace(/\?/,e);try{var n=JSON.parse(localStorage.getItem(r))||{},i=(new Date).getTime()-parseInt(n.timestamp,10)>=a.getLastMediaSettingsCachingInfo().ttl||!1;t=n.settings,i&&(localStorage.removeItem(r),t=null)}catch(e){return null}return t},setSavedMediaSettings:function(e,t){if(u(m,v)){var r=p.replace(/\?/,e);try{localStorage.setItem(r,JSON.stringify({settings:t,timestamp:o()}))}catch(e){s.error(e.message)}}}},s=(0,c.default)(t).getInstance().getLogger(r),i(m)&&f.forEach(function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){s.error(e.message)}}}),r}o.__dashjs_factory_name="DOMStorage";var a=i.default.getSingletonFactory(o);r.default=a,t.exports=r.default},{"../../core/Debug":345,"../../core/FactoryMaker":347,"../constants/Constants":400}],500:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){e=e||{};var r=void 0,s=new DataView(e.data),u=0;function i(e,t){var r=!0,n=0;if(void 0===t&&(t=!1),n=16777215<e.tag?(s.getUint32(u)!==e.tag&&(r=!1),4):65535<e.tag?(256*s.getUint16(u)+s.getUint8(u+2)!==e.tag&&(r=!1),3):255<e.tag?(s.getUint16(u)!==e.tag&&(r=!1),2):(s.getUint8(u)!==e.tag&&(r=!1),1),!r&&e.required&&!t)throw new Error("required tag not found");return r&&(u+=n),r}function o(e){var t=1,r=128,n=-1,i=0,o=s.getUint8(u),a=0;for(a=0;a<8;a+=1){if((o&r)===r){i=void 0===e?o&~r:o,n=a;break}r>>=1}for(a=0;a<n;a+=1,t+=1)i=i<<8|255&s.getUint8(u+t);return u+=t,i}return r={getPos:function(){return u},setPos:function(e){u=e},consumeTag:i,consumeTagAndSize:function(e,t){var r=i(e,t);return r&&o(),r},parseTag:function(e){var t;return i(e),t=o(),r[e.parse](t)},skipOverElement:function(e,t){var r=i(e,t),n=void 0;return r&&(n=o(),u+=n),r},getMatroskaCodedNum:o,getMatroskaFloat:function(e){var t=void 0;switch(e){case 4:t=s.getFloat32(u),u+=4;break;case 8:t=s.getFloat64(u),u+=8}return t},getMatroskaUint:function(e){for(var t=0,r=0;r<e;r+=1)t<<=8,t|=255&s.getUint8(u+r);return u+=e,t},moreData:function(){return u<s.byteLength}}}a.__dashjs_factory_name="EBMLParser",r.default=o.default.getClassFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347}],501:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("../../core/EventBus")),a=n(e("../../core/events/Events")),i=n(e("../../core/FactoryMaker"));function s(){var e=this.context,i=(0,o.default)(e).getInstance();return{capabilityError:function(e){i.trigger(a.default.ERROR,{error:"capability",event:e})},downloadError:function(e,t,r){i.trigger(a.default.ERROR,{error:"download",event:{id:e,url:t,request:r}})},manifestError:function(e,t,r,n){i.trigger(a.default.ERROR,{error:"manifestError",event:{message:e,id:t,manifest:r,event:n}})},timedTextError:function(e,t,r){i.trigger(a.default.ERROR,{error:"cc",event:{message:e,id:t,cc:r}})},mediaSourceError:function(e){i.trigger(a.default.ERROR,{error:"mediasource",event:e})},mediaKeySessionError:function(e){i.trigger(a.default.ERROR,{error:"key_session",event:e})},mediaKeyMessageError:function(e){i.trigger(a.default.ERROR,{error:"key_message",event:e})},error:function(e){i.trigger(a.default.ERROR,{error:e})}}}s.__dashjs_factory_name="ErrorHandler",r.default=i.default.getSingletonFactory(s),t.exports=r.default},{"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352}],502:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(){var n={};return{save:function(e){var t=e.streamId,r=e.representationId;n[t]=n[t]||{},n[t][r]=e},extract:function(e,t){return n&&n[e]&&n[e][t]?n[e][t]:null},reset:function(){n={}}}}a.__dashjs_factory_name="InitCache",r.default=o.default.getSingletonFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347}],503:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../vo/IsoBox")),o=n(e("../../core/FactoryMaker"));function a(){var a=void 0;function t(e){var t=[];if(!e||!a||"function"!=typeof a.fetchAll)return t;for(var r=a.fetchAll(e),n=void 0,i=0,o=r.length;i<o;i++)(n=s(r[i]))&&t.push(n);return t}function s(e){if(!e)return null;var t=new i.default(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(e){return e&&a&&a.boxes&&0!==a.boxes.length&&"function"==typeof a.fetch?s(a.fetch(e)):null},getBoxes:t,setData:function(e){a=e},getLastBox:function(){if(!a||!a.boxes||!a.boxes.length)return null;var e=t(a.boxes[a.boxes.length-1].type);return 0<e.length?e[e.length-1]:null}}}a.__dashjs_factory_name="IsoFile",r.default=o.default.getClassFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347,"../vo/IsoBox":518}],504:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),o=n(e("../constants/Constants"));function a(e){var n=(e=e||{}).timelineConverter,i=e.streamProcessor;return{getLiveEdge:function(){!function(){if(!(n&&n.hasOwnProperty("getExpectedLiveEdge")&&i&&i.hasOwnProperty("getRepresentationInfo")))throw new Error(o.default.MISSING_CONFIG_ERROR)}();var e=i.getRepresentationInfo(),t=e.DVRWindow?e.DVRWindow.end:0,r=t;return e.useCalculatedLiveEdgeTime&&(r=n.getExpectedLiveEdge(),n.setClientTimeOffset(r-t)),r},reset:function(){i=n=null}}}a.__dashjs_factory_name="LiveEdgeFinder",r.default=i.default.getClassFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347,"../constants/Constants":400}],505:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),o=n(e("fast-deep-equal"));function a(){return{areEqual:function(e,t){return(0,o.default)(e,t)}}}a.__dashjs_factory_name="ObjectUtils",r.default=i.default.getSingletonFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347,"fast-deep-equal":559}],506:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(){return{modifyRequestURL:function(e){return e},modifyRequestHeader:function(e){return e}}}a.__dashjs_factory_name="RequestModifier",r.default=o.default.getSingletonFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347}],507:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.checkParameterType=function(e,t){if(typeof e!==t)throw o.default.BAD_ARGUMENT_ERROR},r.checkInteger=function(e){if(null===e||isNaN(e)||e%1!=0)throw o.default.BAD_ARGUMENT_ERROR+" : argument is not an integer"},r.checkRange=function(e,t,r){if(e<t||r<e)throw o.default.BAD_ARGUMENT_ERROR+" : argument out of range"},r.checkIsVideoOrAudioType=function(e){if("string"!=typeof e||e!==o.default.AUDIO&&e!==o.default.VIDEO)throw o.default.BAD_ARGUMENT_ERROR};var n,i=e("../constants/Constants"),o=(n=i)&&n.__esModule?n:{default:n}},{"../constants/Constants":400}],508:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),o=n(e("../../core/Debug")),a=n(e("../../core/EventBus")),w=n(e("../../core/events/Events")),A=e("imsc");function s(){var e=this.context,_=(0,a.default)(e).getInstance(),t=void 0,b=void 0,E=0;return t={parse:function(e,t,r,n,i){var o="",a=[],s=void 0,u=void 0,l=void 0,c={},d={},f="",h="",p={onOpenTag:function(e,t,r){if("image"===t&&"http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e){if(!r[" imagetype"]||"PNG"!==r[" imagetype"].value)return void b.warn("smpte-tt imagetype != PNG. Discarded");f=r["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){f&&(d[f]=h.trim()),f=h=""},onText:function(e){f&&(h+=e)}};if(!e)throw o="no ttml data to parse",new Error(o);c.data=e,_.trigger(w.default.TTML_TO_PARSE,c);var m=(0,A.fromXML)(c.data,function(e){o=e},p);_.trigger(w.default.TTML_PARSED,{ttmlString:c.data,ttmlDoc:m});var g,v=m.getMediaTimeEvents();for(l=0;l<v.length;l++){var y=(0,A.generateISD)(m,v[l],function(e){o=e});y.contents.some(function(e){return e.contents.length})&&(s=v[l]+t<r?r:v[l]+t)<(u=v[l+1]+t>n?n:v[l+1]+t)&&a.push({start:s,end:u,type:"html",cueID:(void 0,g="cue_TTML_"+E,E++,g),isd:y,images:i,embeddedImages:d})}if(""!==o)throw b.error(o),new Error(o);return a}},b=(0,o.default)(e).getInstance().getLogger(t),t}s.__dashjs_factory_name="TTMLParser",r.default=i.default.getSingletonFactory(s),t.exports=r.default},{"../../core/Debug":345,"../../core/EventBus":346,"../../core/FactoryMaker":347,"../../core/events/Events":352,imsc:570}],509:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(){function e(t,e){try{return new window.URL(t,e).toString()}catch(e){return t}}function t(e,t){var r=s;if(!t)return e;if(!c(e))return e;d(e)&&(r=u),f(e)&&(r=l);var n=r(t),i="/"!==n.charAt(n.length-1)&&"/"!==e.charAt(0)?"/":"";return[n,e].join(i)}var r=void 0,n=/^[a-z][a-z0-9+\-.]*:/i,i=/^https?:\/\//i,o=/^https:\/\//i,a=/^([a-z][a-z0-9+\-.]*:\/\/[^\/]+)\/?/i;function s(e){var t=e.indexOf("/"),r=e.lastIndexOf("/");return-1!==t?r===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,r+1)):""}function u(e){var t=e.match(a);return t?t[1]:""}function l(e){var t=e.match(n);return t?t[0]:""}function c(e){return!n.test(e)}function d(e){return c(e)&&"/"===e.charAt(0)}function f(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y");r=e}catch(e){}finally{r=r||t}}(),{parseBaseUrl:s,parseOrigin:u,parseScheme:l,isRelative:c,isPathAbsolute:d,isSchemeRelative:f,isHTTPURL:function(e){return i.test(e)},isHTTPS:function(e){return o.test(e)},resolve:function(e,t){return r(e,t)}}}a.__dashjs_factory_name="URLUtils",r.default=o.default.getSingletonFactory(a),t.exports=r.default},{"../../core/FactoryMaker":347}],510:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("../../core/FactoryMaker")),o=n(e("../../core/Debug"));function a(){var e=this.context,t=void 0,f=void 0,h=void 0,p=void 0,m=void 0,n=void 0;function g(e){var t=e.split(":"),r=t.length-1;return e=60*parseInt(t[r-1],10)+parseFloat(t[r]),2==r&&(e+=3600*parseInt(t[0],10)),e}function v(e){var t=e.split(p),r=t[1].split(n);return r.shift(),t[1]=r[0],r.shift(),{cuePoints:t,styles:function(e){var r={};return e.forEach(function(e){if(1<e.split(/:/).length){var t=e.split(/:/)[1];t&&-1!=t.search(/%/)&&(t=parseInt(t.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(r.align=t),(e.match(/line/)||e.match(/L/))&&(r.line=t),(e.match(/position/)||e.match(/P/))&&(r.position=t),(e.match(/size/)||e.match(/S/))&&(r.size=t)}}),r}(r)}}function y(e,t){for(var r,n=t,i="",o="";""!==e[n]&&n<e.length;)n++;if(1<(r=n-t))for(var a=0;a<r;a++){if((o=e[t+a]).match(p)){i="";break}i+=o,a!==r-1&&(i+="\n")}else(o=e[t]).match(p)||(i=o);return i}return t={parse:function(e){var t,r=[],n=void 0;if(!e)return r;t=(e=e.split(h)).length,n=-1;for(var i=0;i<t;i++){var o=e[i];if(0<o.length&&"WEBVTT"!==o&&o.match(p)){var a=v(o),s=a.cuePoints,u=a.styles,l=y(e,i+1),c=g(s[0].replace(m,"")),d=g(s[1].replace(m,""));!isNaN(c)&&!isNaN(d)&&n<=c&&c<d?""!==l?(n=c,r.push({start:c,end:d,data:l,styles:u})):f.error("Skipping cue due to empty/malformed cue text"):f.error("Skipping cue due to incorrect cue timing")}}return r}},f=(0,o.default)(e).getInstance().getLogger(t),h=/(?:\r\n|\r|\n)/gm,p=/-->/,m=/(^[\s]+|[\s]+$)/g,n=/\s\b/g,t}a.__dashjs_factory_name="VTTParser",r.default=i.default.getSingletonFactory(a),t.exports=r.default},{"../../core/Debug":345,"../../core/FactoryMaker":347}],511:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){var n=(e=e||{}).blacklistController;return{select:function(e){var r=0,t=void 0;return e&&e.some(function(e,t){return r=t,!n.contains(e.serviceLocation)})&&(t=e[r]),t}}}a.__dashjs_factory_name="BasicSelector",r.default=o.default.getClassFactory(a),t.exports=r.default},{"../../../core/FactoryMaker":347}],512:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../../core/FactoryMaker"),o=(n=i)&&n.__esModule?n:{default:n};function a(e){var r=(e=e||{}).blacklistController;return{select:function(e){return e&&function(e){var t=0,r=[],n=0,i=void 0,o=void 0;if((o=e.sort(function(e,t){var r=e.dvb_priority-t.dvb_priority;return isNaN(r)?0:r}).filter(function(e,t,r){return!t||r[0].dvb_priority&&e.dvb_priority&&r[0].dvb_priority===e.dvb_priority})).length)return 1<o.length&&(o.forEach(function(e){t+=e.dvb_weight,r.push(t)}),i=Math.floor(Math.random()*(t-1)),r.every(function(e,t){return n=t,!(i<e)})),o[n]}(function(e){var t=[];return e.filter(function(e){return!r.contains(e.serviceLocation)||(e.dvb_priority&&t.push(e.dvb_priority),!1)}).filter(function(e){return!t.length||!e.dvb_priority||-1===t.indexOf(e.dvb_priority)})}(e))}}}a.__dashjs_factory_name="DVBSelector",r.default=o.default.getClassFactory(a),t.exports=r.default},{"../../../core/FactoryMaker":347}],513:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN},t.exports=r.default},{}],514:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=r||null,this.data=n||null},t.exports=r.default},{}],515:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null},t.exports=r.default},{}],516:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.action=n.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}n.ACTION_DOWNLOAD="download",n.ACTION_COMPLETE="complete",r.default=n,t.exports=r.default},{}],517:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./FragmentRequest"),o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,((n=i)&&n.__esModule?n:{default:n}).default),a);function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(a.prototype),"constructor",this).call(this),this.url=e||null,this.checkForExistenceOnly=!0}r.default=o,t.exports=r.default},{"./FragmentRequest":516}],518:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}},{key:"getChildBoxes",value:function(e){for(var t=[],r=0;r<this.boxes.length;r++)this.boxes[r].type===e&&t.push(this.boxes[r]);return t}}]),o);function o(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.offset=e._offset,this.type=e.type,this.size=e.size,this.boxes=[],e.boxes)for(var t=0;t<e.boxes.length;t++)this.boxes.push(new o(e.boxes[t]));switch(this.isComplete=!0,e.type){case"sidx":if(this.timescale=e.timescale,this.earliest_presentation_time=e.earliest_presentation_time,this.first_offset=e.first_offset,this.references=e.references,e.references){this.references=[];for(t=0;t<e.references.length;t++){var r={reference_type:e.references[t].reference_type,referenced_size:e.references[t].referenced_size,subsegment_duration:e.references[t].subsegment_duration};this.references.push(r)}}break;case"emsg":this.id=e.id,this.value=e.value,this.timescale=e.timescale,this.scheme_id_uri=e.scheme_id_uri,this.presentation_time_delta=1===e.version?e.presentation_time:e.presentation_time_delta,this.event_duration=e.event_duration,this.message_data=e.message_data;break;case"mdhd":this.timescale=e.timescale;break;case"mfhd":this.sequence_number=e.sequence_number;break;case"subs":this.entry_count=e.entry_count,this.entries=e.entries;break;case"tfhd":this.base_data_offset=e.base_data_offset,this.sample_description_index=e.sample_description_index,this.default_sample_duration=e.default_sample_duration,this.default_sample_size=e.default_sample_size,this.default_sample_flags=e.default_sample_flags,this.flags=e.flags;break;case"tfdt":this.version=e.version,this.baseMediaDecodeTime=e.baseMediaDecodeTime,this.flags=e.flags;break;case"trun":if(this.sample_count=e.sample_count,this.first_sample_flags=e.first_sample_flags,this.data_offset=e.data_offset,this.flags=e.flags,this.samples=e.samples,e.samples){this.samples=[];t=0;for(var n=e.samples.length;t<n;t++){var i={sample_size:e.samples[t].sample_size,sample_duration:e.samples[t].sample_duration,sample_composition_time_offset:e.samples[t].sample_composition_time_offset};this.samples.push(i)}}}}r.default=i,t.exports=r.default},{}],519:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=t,this.found=r,this.size=n},t.exports=r.default},{}],520:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null},t.exports=r.default},{}],521:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=(function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}(o,[{key:"isMediaInfoEqual",value:function(e){if(!e)return!1;var t=this.id===e.id,r=this.viewpoint===e.viewpoint,n=this.lang===e.lang,i=this.roles.toString()===e.roles.toString(),o=this.accessibility.toString()===e.accessibility.toString(),a=this.audioChannelConfiguration.toString()===e.audioChannelConfiguration.toString();return t&&r&&n&&i&&o&&a}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null}r.default=i,t.exports=r.default},{}],522:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]},t.exports=r.default},{}],523:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},t.exports=r.default},{}],524:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},t.exports=r.default},{}],525:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(e){return e&&e.__esModule?e:{default:e}}var i=n(e("../constants/Constants")),o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,n(e("./FragmentRequest")).default),a);function a(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=o,r=a,n=!0,s=l=void 0}}(Object.getPrototypeOf(a.prototype),"constructor",this).call(this),this.url=e||null,this.type=t||null,this.mediaType=i.default.STREAM,this.responseType=""}r.default=o,t.exports=r.default},{"../constants/Constants":400,"./FragmentRequest":516}],526:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.captionData=null,this.label=null,this.lang=null,this.defaultTrack=!1,this.kind=null,this.isFragmented=!1,this.isEmbedded=!1},t.exports=r.default},{}],527:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null},t.exports=r.default},{}],528:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""},t.exports=r.default},{}],529:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null},t.exports=r.default},{}],530:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null},t.exports=r.default},{}],531:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("../../controllers/BufferController"),o=(n=i)&&n.__esModule?n:{default:n};r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=o.default.BUFFER_EMPTY},t.exports=r.default},{"../../controllers/BufferController":406}],532:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null},t.exports=r.default},{}],533:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null},t.exports=r.default},{}],534:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});function i(){n(this,i),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._responseHeaders=null,this._serviceLocation=null}i.GET="GET",i.HEAD="HEAD",i.MPD_TYPE="MPD",i.XLINK_EXPANSION_TYPE="XLinkExpansion",i.INIT_SEGMENT_TYPE="InitializationSegment",i.INDEX_SEGMENT_TYPE="IndexSegment",i.MEDIA_SEGMENT_TYPE="MediaSegment",i.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",i.OTHER_TYPE="other",r.HTTPRequest=i,r.HTTPRequestTrace=function e(){n(this,e),this.s=null,this.d=null,this.b=[]}},{}],535:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});r.ManifestUpdate=function e(){n(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},r.ManifestUpdateStreamInfo=function e(){n(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},r.ManifestUpdateRepresentationInfo=function e(){n(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null}},{}],536:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});function i(){n(this,i),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]}i.INITIAL_PLAYOUT_START_REASON="initial_playout",i.SEEK_START_REASON="seek",i.RESUME_FROM_PAUSE_START_REASON="resume",i.METRICS_COLLECTION_START_REASON="metrics_collection_start";function o(){n(this,o),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null}o.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",o.REBUFFERING_REASON="rebuffering",o.USER_REQUEST_STOP_REASON="user_request",o.END_OF_PERIOD_STOP_REASON="end_of_period",o.END_OF_CONTENT_STOP_REASON="end_of_content",o.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",o.FAILURE_STOP_REASON="failure",r.PlayList=i,r.PlayListTrace=o},{}],537:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null},t.exports=r.default},{}],538:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]},t.exports=r.default},{}],539:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},t.exports=r.default},{}],540:[function(e,t,r){"use strict";function o(e,t,r,n){t in e&&(!function(e){return"function"==typeof e&&"[object Function]"===i.call(e)}(n)||!n())||(c?l(e,t,{configurable:!0,enumerable:!1,value:r,writable:!0}):e[t]=r)}function n(e,t){var r=2<arguments.length?arguments[2]:{},n=a(t);s&&(n=u.call(n,Object.getOwnPropertySymbols(t)));for(var i=0;i<n.length;i+=1)o(e,n[i],t[n[i]],r[n[i]])}var a=e("object-keys"),s="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),i=Object.prototype.toString,u=Array.prototype.concat,l=Object.defineProperty,c=l&&function(){var e={};try{for(var t in l(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}();n.supportsDescriptors=!!c,t.exports=n},{"object-keys":585}],541:[function(e,t,r){"use strict";var n,i=Object.getOwnPropertyDescriptor?function(){return Object.getOwnPropertyDescriptor(arguments,"callee").get}():function(){throw new TypeError},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,a=Object.getPrototypeOf||function(e){return e.__proto__},s=n,u="undefined"==typeof Uint8Array?n:a(Uint8Array),l={"$ %Array%":Array,"$ %ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"$ %ArrayBufferPrototype%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer.prototype,"$ %ArrayIteratorPrototype%":o?a([][Symbol.iterator]()):n,"$ %ArrayPrototype%":Array.prototype,"$ %ArrayProto_entries%":Array.prototype.entries,"$ %ArrayProto_forEach%":Array.prototype.forEach,"$ %ArrayProto_keys%":Array.prototype.keys,"$ %ArrayProto_values%":Array.prototype.values,"$ %AsyncFromSyncIteratorPrototype%":n,"$ %AsyncFunction%":void 0,"$ %AsyncFunctionPrototype%":n,"$ %AsyncGenerator%":n,"$ %AsyncGeneratorFunction%":void 0,"$ %AsyncGeneratorPrototype%":n,"$ %AsyncIteratorPrototype%":s&&o&&Symbol.asyncIterator?s[Symbol.asyncIterator]():n,"$ %Atomics%":"undefined"==typeof Atomics?n:Atomics,"$ %Boolean%":Boolean,"$ %BooleanPrototype%":Boolean.prototype,"$ %DataView%":"undefined"==typeof DataView?n:DataView,"$ %DataViewPrototype%":"undefined"==typeof DataView?n:DataView.prototype,"$ %Date%":Date,"$ %DatePrototype%":Date.prototype,"$ %decodeURI%":decodeURI,"$ %decodeURIComponent%":decodeURIComponent,"$ %encodeURI%":encodeURI,"$ %encodeURIComponent%":encodeURIComponent,"$ %Error%":Error,"$ %ErrorPrototype%":Error.prototype,"$ %eval%":eval,"$ %EvalError%":EvalError,"$ %EvalErrorPrototype%":EvalError.prototype,"$ %Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"$ %Float32ArrayPrototype%":"undefined"==typeof Float32Array?n:Float32Array.prototype,"$ %Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"$ %Float64ArrayPrototype%":"undefined"==typeof Float64Array?n:Float64Array.prototype,"$ %Function%":Function,"$ %FunctionPrototype%":Function.prototype,"$ %Generator%":n,"$ %GeneratorFunction%":void 0,"$ %GeneratorPrototype%":n,"$ %Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"$ %Int8ArrayPrototype%":"undefined"==typeof Int8Array?n:Int8Array.prototype,"$ %Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"$ %Int16ArrayPrototype%":"undefined"==typeof Int16Array?n:Int8Array.prototype,"$ %Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"$ %Int32ArrayPrototype%":"undefined"==typeof Int32Array?n:Int32Array.prototype,"$ %isFinite%":isFinite,"$ %isNaN%":isNaN,"$ %IteratorPrototype%":o?a(a([][Symbol.iterator]())):n,"$ %JSON%":JSON,"$ %JSONParse%":JSON.parse,"$ %Map%":"undefined"==typeof Map?n:Map,"$ %MapIteratorPrototype%":"undefined"!=typeof Map&&o?a((new Map)[Symbol.iterator]()):n,"$ %MapPrototype%":"undefined"==typeof Map?n:Map.prototype,"$ %Math%":Math,"$ %Number%":Number,"$ %NumberPrototype%":Number.prototype,"$ %Object%":Object,"$ %ObjectPrototype%":Object.prototype,"$ %ObjProto_toString%":Object.prototype.toString,"$ %ObjProto_valueOf%":Object.prototype.valueOf,"$ %parseFloat%":parseFloat,"$ %parseInt%":parseInt,"$ %Promise%":"undefined"==typeof Promise?n:Promise,"$ %PromisePrototype%":"undefined"==typeof Promise?n:Promise.prototype,"$ %PromiseProto_then%":"undefined"==typeof Promise?n:Promise.prototype.then,"$ %Promise_all%":"undefined"==typeof Promise?n:Promise.all,"$ %Promise_reject%":"undefined"==typeof Promise?n:Promise.reject,"$ %Promise_resolve%":"undefined"==typeof Promise?n:Promise.resolve,"$ %Proxy%":"undefined"==typeof Proxy?n:Proxy,"$ %RangeError%":RangeError,"$ %RangeErrorPrototype%":RangeError.prototype,"$ %ReferenceError%":ReferenceError,"$ %ReferenceErrorPrototype%":ReferenceError.prototype,"$ %Reflect%":"undefined"==typeof Reflect?n:Reflect,"$ %RegExp%":RegExp,"$ %RegExpPrototype%":RegExp.prototype,"$ %Set%":"undefined"==typeof Set?n:Set,"$ %SetIteratorPrototype%":"undefined"!=typeof Set&&o?a((new Set)[Symbol.iterator]()):n,"$ %SetPrototype%":"undefined"==typeof Set?n:Set.prototype,"$ %SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"$ %SharedArrayBufferPrototype%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer.prototype,"$ %String%":String,"$ %StringIteratorPrototype%":o?a(""[Symbol.iterator]()):n,"$ %StringPrototype%":String.prototype,"$ %Symbol%":o?Symbol:n,"$ %SymbolPrototype%":o?Symbol.prototype:n,"$ %SyntaxError%":SyntaxError,"$ %SyntaxErrorPrototype%":SyntaxError.prototype,"$ %ThrowTypeError%":i,"$ %TypedArray%":u,"$ %TypedArrayPrototype%":u?u.prototype:n,"$ %TypeError%":TypeError,"$ %TypeErrorPrototype%":TypeError.prototype,"$ %Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"$ %Uint8ArrayPrototype%":"undefined"==typeof Uint8Array?n:Uint8Array.prototype,"$ %Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"$ %Uint8ClampedArrayPrototype%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray.prototype,"$ %Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"$ %Uint16ArrayPrototype%":"undefined"==typeof Uint16Array?n:Uint16Array.prototype,"$ %Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"$ %Uint32ArrayPrototype%":"undefined"==typeof Uint32Array?n:Uint32Array.prototype,"$ %URIError%":URIError,"$ %URIErrorPrototype%":URIError.prototype,"$ %WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"$ %WeakMapPrototype%":"undefined"==typeof WeakMap?n:WeakMap.prototype,"$ %WeakSet%":"undefined"==typeof WeakSet?n:WeakSet,"$ %WeakSetPrototype%":"undefined"==typeof WeakSet?n:WeakSet.prototype};t.exports=function(e,t){if(1<arguments.length&&"boolean"!=typeof t)throw new TypeError('"allowMissing" argument must be a boolean');var r="$ "+e;if(!(r in l))throw new SyntaxError("intrinsic "+e+" does not exist!");if(void 0===l[r]&&!t)throw new TypeError("intrinsic "+e+" exists, but is not available. Please file an issue!");return l[r]}},{}],542:[function(e,t,r){"use strict";var n=e("has"),i=e("es-to-primitive/es6"),o=e("object-keys"),a=e("./GetIntrinsic"),s=a("%TypeError%"),u=a("%SyntaxError%"),l=a("%Array%"),c=a("%String%"),d=a("%Object%"),f=a("%Number%"),h=a("%Symbol%",!0),p=a("%RegExp%"),m=!!h,g=e("./helpers/assertRecord"),v=e("./helpers/isNaN"),y=e("./helpers/isFinite"),_=f.MAX_SAFE_INTEGER||Math.pow(2,53)-1,b=e("./helpers/assign"),E=e("./helpers/sign"),w=e("./helpers/mod"),A=e("./helpers/isPrimitive"),T=parseInt,S=e("function-bind"),x=S.call(Function.call,l.prototype.slice),M=S.call(Function.call,c.prototype.slice),R=S.call(Function.call,p.prototype.test,/^0b[01]+$/i),O=S.call(Function.call,p.prototype.test,/^0o[0-7]+$/i),P=S.call(Function.call,p.prototype.exec),C=new p("["+["","​","￾"].join("")+"]","g"),D=S.call(Function.call,p.prototype.test,C),I=S.call(Function.call,p.prototype.test,/^[-+]0x[0-9a-f]+$/i),L=S.call(Function.call,c.prototype.charCodeAt),N=S.call(Function.call,Object.prototype.toString),k=S.call(Function.call,a("%NumberPrototype%").valueOf),F=S.call(Function.call,a("%BooleanPrototype%").valueOf),j=S.call(Function.call,a("%StringPrototype%").valueOf),B=S.call(Function.call,a("%DatePrototype%").valueOf),U=Math.floor,G=Math.abs,H=Object.create,V=d.getOwnPropertyDescriptor,z=d.isExtensible,W=d.defineProperty,q=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),Y=new RegExp("(^["+q+"]+)|(["+q+"]+$)","g"),K=S.call(Function.call,c.prototype.replace),X=e("./es5"),Q=e("is-regex"),J=b(b({},X),{Call:function(e,t,r){var n=2<arguments.length?r:[];if(!this.IsCallable(e))throw new s(e+" is not a function");return e.apply(t,n)},ToPrimitive:i,ToNumber:function(e){var t=A(e)?e:i(e,f);if("symbol"==typeof t)throw new s("Cannot convert a Symbol value to a number");if("string"==typeof t){if(R(t))return this.ToNumber(T(M(t,2),2));if(O(t))return this.ToNumber(T(M(t,2),8));if(D(t)||I(t))return NaN;var r=function(e){return K(e,Y,"")}(t);if(r!==t)return this.ToNumber(r)}return f(t)},ToInt16:function(e){var t=this.ToUint16(e);return 32768<=t?t-65536:t},ToInt8:function(e){var t=this.ToUint8(e);return 128<=t?t-256:t},ToUint8:function(e){var t=this.ToNumber(e);if(v(t)||0===t||!y(t))return 0;var r=E(t)*U(G(t));return w(r,256)},ToUint8Clamp:function(e){var t=this.ToNumber(e);if(v(t)||t<=0)return 0;if(255<=t)return 255;var r=U(e);return r+.5<t?r+1:t<r+.5?r:r%2!=0?r+1:r},ToString:function(e){if("symbol"==typeof e)throw new s("Cannot convert a Symbol value to a string");return c(e)},ToObject:function(e){return this.RequireObjectCoercible(e),d(e)},ToPropertyKey:function(e){var t=this.ToPrimitive(e,c);return"symbol"==typeof t?t:this.ToString(t)},ToLength:function(e){var t=this.ToInteger(e);return t<=0?0:_<t?_:t},CanonicalNumericIndexString:function(e){if("[object String]"!==N(e))throw new s("must be a string");if("-0"===e)return-0;var t=this.ToNumber(e);return this.SameValue(this.ToString(t),e)?t:void 0},RequireObjectCoercible:X.CheckObjectCoercible,IsArray:l.isArray||function(e){return"[object Array]"===N(e)},IsConstructor:function(e){return"function"==typeof e&&!!e.prototype},IsExtensible:Object.preventExtensions?function(e){return!A(e)&&z(e)}:function(e){return!0},IsInteger:function(e){if("number"!=typeof e||v(e)||!y(e))return!1;var t=G(e);return U(t)===t},IsPropertyKey:function(e){return"string"==typeof e||"symbol"==typeof e},IsRegExp:function(e){if(!e||"object"!=typeof e)return!1;if(m){var t=e[h.match];if(void 0!==t)return X.ToBoolean(t)}return Q(e)},SameValueZero:function(e,t){return e===t||v(e)&&v(t)},GetV:function(e,t){if(!this.IsPropertyKey(t))throw new s("Assertion failed: IsPropertyKey(P) is not true");return this.ToObject(e)[t]},GetMethod:function(e,t){if(!this.IsPropertyKey(t))throw new s("Assertion failed: IsPropertyKey(P) is not true");var r=this.GetV(e,t);if(null!=r){if(!this.IsCallable(r))throw new s(t+"is not a function");return r}},Get:function(e,t){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new s("Assertion failed: IsPropertyKey(P) is not true");return e[t]},Type:function(e){return"symbol"==typeof e?"Symbol":X.Type(e)},SpeciesConstructor:function(e,t){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(O) is not Object");var r=e.constructor;if(void 0===r)return t;if("Object"!==this.Type(r))throw new s("O.constructor is not an Object");var n=m&&h.species?r[h.species]:void 0;if(null==n)return t;if(this.IsConstructor(n))return n;throw new s("no constructor found")},CompletePropertyDescriptor:function(e){return g(this,"Property Descriptor","Desc",e),this.IsGenericDescriptor(e)||this.IsDataDescriptor(e)?(n(e,"[[Value]]")||(e["[[Value]]"]=void 0),n(e,"[[Writable]]")||(e["[[Writable]]"]=!1)):(n(e,"[[Get]]")||(e["[[Get]]"]=void 0),n(e,"[[Set]]")||(e["[[Set]]"]=void 0)),n(e,"[[Enumerable]]")||(e["[[Enumerable]]"]=!1),n(e,"[[Configurable]]")||(e["[[Configurable]]"]=!1),e},Set:function(e,t,r,n){if("Object"!==this.Type(e))throw new s("O must be an Object");if(!this.IsPropertyKey(t))throw new s("P must be a Property Key");if("Boolean"!==this.Type(n))throw new s("Throw must be a Boolean");if(n)return e[t]=r,!0;try{e[t]=r}catch(e){return!1}},HasOwnProperty:function(e,t){if("Object"!==this.Type(e))throw new s("O must be an Object");if(!this.IsPropertyKey(t))throw new s("P must be a Property Key");return n(e,t)},HasProperty:function(e,t){if("Object"!==this.Type(e))throw new s("O must be an Object");if(!this.IsPropertyKey(t))throw new s("P must be a Property Key");return t in e},IsConcatSpreadable:function(e){if("Object"!==this.Type(e))return!1;if(m&&"symbol"==typeof h.isConcatSpreadable){var t=this.Get(e,Symbol.isConcatSpreadable);if(void 0!==t)return this.ToBoolean(t)}return this.IsArray(e)},Invoke:function(e,t){if(!this.IsPropertyKey(t))throw new s("P must be a Property Key");var r=x(arguments,2),n=this.GetV(e,t);return this.Call(n,e,r)},GetIterator:function(e,t){if(!m)throw new SyntaxError("ES.GetIterator depends on native iterator support.");var r=t;arguments.length<2&&(r=this.GetMethod(e,h.iterator));var n=this.Call(r,e);if("Object"!==this.Type(n))throw new s("iterator must return an object");return n},IteratorNext:function(e,t){var r=this.Invoke(e,"next",arguments.length<2?[]:[t]);if("Object"!==this.Type(r))throw new s("iterator next must return an object");return r},IteratorComplete:function(e){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(iterResult) is not Object");return this.ToBoolean(this.Get(e,"done"))},IteratorValue:function(e){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(iterResult) is not Object");return this.Get(e,"value")},IteratorStep:function(e){var t=this.IteratorNext(e);return!0!==this.IteratorComplete(t)&&t},IteratorClose:function(e,t){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(iterator) is not Object");if(!this.IsCallable(t))throw new s("Assertion failed: completion is not a thunk for a Completion Record");var r,n=t,i=this.GetMethod(e,"return");if(void 0===i)return n();try{var o=this.Call(i,e,[])}catch(e){throw r=n(),n=null,e}if(r=n(),n=null,"Object"!==this.Type(o))throw new s("iterator .return must return an object");return r},CreateIterResultObject:function(e,t){if("Boolean"!==this.Type(t))throw new s("Assertion failed: Type(done) is not Boolean");return{value:e,done:t}},RegExpExec:function(e,t){if("Object"!==this.Type(e))throw new s("R must be an Object");if("String"!==this.Type(t))throw new s("S must be a String");var r=this.Get(e,"exec");if(this.IsCallable(r)){var n=this.Call(r,e,[t]);if(null===n||"Object"===this.Type(n))return n;throw new s('"exec" method must return `null` or an Object')}return P(e,t)},ArraySpeciesCreate:function(e,t){if(!this.IsInteger(t)||t<0)throw new s("Assertion failed: length must be an integer >= 0");var r,n=0===t?0:t;if(this.IsArray(e)&&(r=this.Get(e,"constructor"),"Object"===this.Type(r)&&m&&h.species&&null===(r=this.Get(r,h.species))&&(r=void 0)),void 0===r)return l(n);if(!this.IsConstructor(r))throw new s("C must be a constructor");return new r(n)},CreateDataProperty:function(e,t,r){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new s("Assertion failed: IsPropertyKey(P) is not true");var n=V(e,t),i=n||"function"!=typeof z||z(e);return!(!(!n||n.writable&&n.configurable)||!i)&&(W(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}),!0)},CreateDataPropertyOrThrow:function(e,t,r){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new s("Assertion failed: IsPropertyKey(P) is not true");var n=this.CreateDataProperty(e,t,r);if(!n)throw new s("unable to create data property");return n},ObjectCreate:function(e,t){if(null!==e&&"Object"!==this.Type(e))throw new s("Assertion failed: proto must be null or an object");if(0<(arguments.length<2?[]:t).length)throw new u("es-abstract does not yet support internal slots");if(null===e&&!H)throw new u("native Object.create support is required to create null objects");return H(e)},AdvanceStringIndex:function(e,t,r){if("String"!==this.Type(e))throw new s("S must be a String");if(!this.IsInteger(t)||t<0||_<t)throw new s("Assertion failed: length must be an integer >= 0 and <= 2**53");if("Boolean"!==this.Type(r))throw new s("Assertion failed: unicode must be a Boolean");if(!r)return t+1;if(e.length<=t+1)return t+1;var n=L(e,t);if(n<55296||56319<n)return t+1;var i=L(e,t+1);return i<56320||57343<i?t+1:t+2},CreateMethodProperty:function(e,t,r){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new s("Assertion failed: IsPropertyKey(P) is not true");return!!W(e,t,{configurable:!0,enumerable:!1,value:r,writable:!0})},DefinePropertyOrThrow:function(e,t,r){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new s("Assertion failed: IsPropertyKey(P) is not true");return!!W(e,t,r)},DeletePropertyOrThrow:function(e,t){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(t))throw new s("Assertion failed: IsPropertyKey(P) is not true");var r=delete e[t];if(!r)throw new TypeError("Attempt to delete property failed.");return r},EnumerableOwnNames:function(e){if("Object"!==this.Type(e))throw new s("Assertion failed: Type(O) is not Object");return o(e)},thisNumberValue:function(e){return"Number"===this.Type(e)?e:k(e)},thisBooleanValue:function(e){return"Boolean"===this.Type(e)?e:F(e)},thisStringValue:function(e){return"String"===this.Type(e)?e:j(e)},thisTimeValue:function(e){return B(e)}});delete J.CheckObjectCoercible,t.exports=J},{"./GetIntrinsic":541,"./es5":546,"./helpers/assertRecord":547,"./helpers/assign":548,"./helpers/isFinite":550,"./helpers/isNaN":551,"./helpers/isPrimitive":552,"./helpers/mod":553,"./helpers/sign":554,"es-to-primitive/es6":557,"function-bind":561,has:564,"is-regex":578,"object-keys":585}],543:[function(e,t,r){"use strict";var n=e("./es2015"),i=e("./helpers/assign"),o=i(i({},n),{SameValueNonNumber:function(e,t){if("number"==typeof e||typeof e!=typeof t)throw new TypeError("SameValueNonNumber requires two non-number values of the same type.");return this.SameValue(e,t)}});t.exports=o},{"./es2015":542,"./helpers/assign":548}],544:[function(e,t,r){"use strict";var n=e("function-bind"),i=e("./es2016"),o=e("./helpers/assign"),a=e("./helpers/forEach"),s=e("./GetIntrinsic"),u=s("%TypeError%"),l=n.call(Function.call,s("%ObjectPrototype%").propertyIsEnumerable),c=n.call(Function.apply,s("%ArrayPrototype%").push),d=o(o({},i),{ToIndex:function(e){if(void 0===e)return 0;var t=this.ToInteger(e);if(t<0)throw new RangeError("index must be >= 0");var r=this.ToLength(t);if(!this.SameValueZero(t,r))throw new RangeError("index must be >= 0 and < 2 ** 53 - 1");return r},EnumerableOwnProperties:function(t,r){var e=i.EnumerableOwnNames(t);if("key"===r)return e;if("value"!==r&&"key+value"!==r)throw new u('Assertion failed: "kind" is not "key", "value", or "key+value": '+r);var n=[];return a(e,function(e){l(t,e)&&c(n,["value"===r?t[e]:[e,t[e]]])}),n}});delete d.EnumerableOwnNames,t.exports=d},{"./GetIntrinsic":541,"./es2016":543,"./helpers/assign":548,"./helpers/forEach":549,"function-bind":561}],545:[function(e,t,r){"use strict";var n=e("function-bind"),l=e("object-keys"),i=e("./es2017"),o=e("./helpers/assign"),c=e("./helpers/forEach"),a=e("./GetIntrinsic"),s=a("%String%"),u=a("%Object%"),d=a("%SymbolPrototype%",!0),f=d?n.call(Function.call,d.valueOf):null,h=a("%StringPrototype%"),p=n.call(Function.call,h.charAt),m=a("%Promise_resolve%",!0),g=m?n.call(Function.call,m):null,v=n.call(Function.call,a("%ObjectPrototype%").propertyIsEnumerable),y=n.call(Function.apply,a("%ArrayPrototype%").push),_=f?u.getOwnPropertySymbols:null,b=o(o({},i),{EnumerableOwnPropertyNames:i.EnumerableOwnProperties,thisSymbolValue:function(e){if(!f)throw new SyntaxError("Symbols are not supported; thisSymbolValue requires that `value` be a Symbol or a Symbol object");return"Symbol"===this.Type(e)?e:f(e)},IsStringPrefix:function(e,t){if("String"!==this.Type(e))throw new TypeError('Assertion failed: "p" must be a String');if("String"!==this.Type(t))throw new TypeError('Assertion failed: "q" must be a String');if(e===t||""===e)return!0;var r=e.length;if(t.length<=r)return!1;for(var n=0;n<r;n+=1)if(p(e,n)!==p(t,n))return!1;return!0},NumberToString:function(e){if("Number"!==this.Type(e))throw new TypeError('Assertion failed: "m" must be a String');return s(e)},CopyDataProperties:function(i,o,a){if("Object"!==this.Type(i))throw new TypeError('Assertion failed: "target" must be an Object');if(!this.IsArray(a))throw new TypeError('Assertion failed: "excludedItems" must be a List of Property Keys');for(var e=0;e<a.length;e+=1)if(!this.IsPropertyKey(a[e]))throw new TypeError('Assertion failed: "excludedItems" must be a List of Property Keys');if(null==o)return i;var s=this,u=s.ToObject(o),t=function(e,t){var r=l(t);return _&&y(r,_(t)),r}(0,u);return c(t,function(t){var r=!1;c(a,function(e){!0===s.SameValue(e,t)&&(r=!0)});var e=v(u,t)||"string"==typeof o&&0<=t&&s.IsInteger(s.ToNumber(t));if(!1===r&&e){var n=s.Get(u,t);s.CreateDataProperty(i,t,n)}}),i},PromiseResolve:function(e,t){if(!g)throw new SyntaxError("This environment does not support Promises.");return g(e,t)}});delete b.EnumerableOwnProperties,delete b.IsPropertyDescriptor,t.exports=b},{"./GetIntrinsic":541,"./es2017":544,"./helpers/assign":548,"./helpers/forEach":549,"function-bind":561,"object-keys":585}],546:[function(e,t,r){"use strict";var n=e("./GetIntrinsic"),i=n("%Object%"),o=n("%TypeError%"),a=n("%String%"),s=e("./helpers/assertRecord"),u=e("./helpers/isNaN"),l=e("./helpers/isFinite"),c=e("./helpers/sign"),d=e("./helpers/mod"),f=e("is-callable"),h=e("es-to-primitive/es5"),p=e("has"),m={ToPrimitive:h,ToBoolean:function(e){return!!e},ToNumber:function(e){return+e},ToInteger:function(e){var t=this.ToNumber(e);return u(t)?0:0!==t&&l(t)?c(t)*Math.floor(Math.abs(t)):t},ToInt32:function(e){return this.ToNumber(e)>>0},ToUint32:function(e){return this.ToNumber(e)>>>0},ToUint16:function(e){var t=this.ToNumber(e);if(u(t)||0===t||!l(t))return 0;var r=c(t)*Math.floor(Math.abs(t));return d(r,65536)},ToString:function(e){return a(e)},ToObject:function(e){return this.CheckObjectCoercible(e),i(e)},CheckObjectCoercible:function(e,t){if(null==e)throw new o(t||"Cannot call method on "+e);return e},IsCallable:f,SameValue:function(e,t){return e===t?0!==e||1/e==1/t:u(e)&&u(t)},Type:function(e){return null===e?"Null":void 0===e?"Undefined":"function"==typeof e||"object"==typeof e?"Object":"number"==typeof e?"Number":"boolean"==typeof e?"Boolean":"string"==typeof e?"String":void 0},IsPropertyDescriptor:function(e){if("Object"!==this.Type(e))return!1;var t={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var r in e)if(p(e,r)&&!t[r])return!1;var n=p(e,"[[Value]]"),i=p(e,"[[Get]]")||p(e,"[[Set]]");if(n&&i)throw new o("Property Descriptors may not be both accessor and data descriptors");return!0},IsAccessorDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!(!p(e,"[[Get]]")&&!p(e,"[[Set]]")))},IsDataDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!(!p(e,"[[Value]]")&&!p(e,"[[Writable]]")))},IsGenericDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!this.IsAccessorDescriptor(e)&&!this.IsDataDescriptor(e))},FromPropertyDescriptor:function(e){if(void 0===e)return e;if(s(this,"Property Descriptor","Desc",e),this.IsDataDescriptor(e))return{value:e["[[Value]]"],writable:!!e["[[Writable]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};if(this.IsAccessorDescriptor(e))return{get:e["[[Get]]"],set:e["[[Set]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};throw new o("FromPropertyDescriptor must be called with a fully populated Property Descriptor")},ToPropertyDescriptor:function(e){if("Object"!==this.Type(e))throw new o("ToPropertyDescriptor requires an object");var t={};if(p(e,"enumerable")&&(t["[[Enumerable]]"]=this.ToBoolean(e.enumerable)),p(e,"configurable")&&(t["[[Configurable]]"]=this.ToBoolean(e.configurable)),p(e,"value")&&(t["[[Value]]"]=e.value),p(e,"writable")&&(t["[[Writable]]"]=this.ToBoolean(e.writable)),p(e,"get")){var r=e.get;if(void 0!==r&&!this.IsCallable(r))throw new TypeError("getter must be a function");t["[[Get]]"]=r}if(p(e,"set")){var n=e.set;if(void 0!==n&&!this.IsCallable(n))throw new o("setter must be a function");t["[[Set]]"]=n}if((p(t,"[[Get]]")||p(t,"[[Set]]"))&&(p(t,"[[Value]]")||p(t,"[[Writable]]")))throw new o("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t}};t.exports=m},{"./GetIntrinsic":541,"./helpers/assertRecord":547,"./helpers/isFinite":550,"./helpers/isNaN":551,"./helpers/mod":553,"./helpers/sign":554,"es-to-primitive/es5":556,has:564,"is-callable":576}],547:[function(e,t,r){"use strict";var n=e("../GetIntrinsic"),a=n("%TypeError%"),o=n("%SyntaxError%"),s=e("has"),u={"Property Descriptor":function(e,t){if("Object"!==e.Type(t))return!1;var r={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var n in t)if(s(t,n)&&!r[n])return!1;var i=s(t,"[[Value]]"),o=s(t,"[[Get]]")||s(t,"[[Set]]");if(i&&o)throw new a("Property Descriptors may not be both accessor and data descriptors");return!0}};t.exports=function(e,t,r,n){var i=u[t];if("function"!=typeof i)throw new o("unknown record type: "+t);if(!i(e,n))throw new a(r+" must be a "+t);console.log(i(e,n),n)}},{"../GetIntrinsic":541,has:564}],548:[function(e,t,r){var n=e("function-bind").call(Function.call,Object.prototype.hasOwnProperty),i=Object.assign;t.exports=function(e,t){if(i)return i(e,t);for(var r in t)n(t,r)&&(e[r]=t[r]);return e}},{"function-bind":561}],549:[function(e,t,r){"use strict";t.exports=function(e,t){for(var r=0;r<e.length;r+=1)t(e[r],r,e)}},{}],550:[function(e,t,r){var n=Number.isNaN||function(e){return e!=e};t.exports=Number.isFinite||function(e){return"number"==typeof e&&!n(e)&&e!==1/0&&e!==-1/0}},{}],551:[function(e,t,r){t.exports=Number.isNaN||function(e){return e!=e}},{}],552:[function(e,t,r){t.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},{}],553:[function(e,t,r){t.exports=function(e,t){var r=e%t;return Math.floor(0<=r?r:r+t)}},{}],554:[function(e,t,r){t.exports=function(e){return 0<=e?1:-1}},{}],555:[function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,a=e("./helpers/isPrimitive"),s=e("is-callable"),u=e("is-date-object"),l=e("is-symbol");t.exports=function(e,t){if(a(e))return e;var r,n="default";if(1<arguments.length&&(t===String?n="string":t===Number&&(n="number")),o&&(Symbol.toPrimitive?r=function(e,t){var r=e[t];if(null!=r){if(!s(r))throw new TypeError(r+" returned for property "+t+" of object "+e+" is not a function");return r}}(e,Symbol.toPrimitive):l(e)&&(r=Symbol.prototype.valueOf)),void 0===r)return"default"===n&&(u(e)||l(e))&&(n="string"),function(e,t){if(null==e)throw new TypeError("Cannot call method on "+e);if("string"!=typeof t||"number"!==t&&"string"!==t)throw new TypeError('hint must be "string" or "number"');var r,n,i,o="string"===t?["toString","valueOf"]:["valueOf","toString"];for(i=0;i<o.length;++i)if(r=e[o[i]],s(r)&&(n=r.call(e),a(n)))return n;throw new TypeError("No default value")}(e,"default"===n?"number":n);var i=r.call(e,n);if(a(i))return i;throw new TypeError("unable to convert exotic object to primitive")}},{"./helpers/isPrimitive":558,"is-callable":576,"is-date-object":577,"is-symbol":579}],556:[function(e,t,r){"use strict";var o=Object.prototype.toString,a=e("./helpers/isPrimitive"),s=e("is-callable"),n=function(e){var t;if((t=1<arguments.length?arguments[1]:"[object Date]"===o.call(e)?String:Number)!==String&&t!==Number)throw new TypeError("invalid [[DefaultValue]] hint supplied");var r,n,i=t===String?["toString","valueOf"]:["valueOf","toString"];for(n=0;n<i.length;++n)if(s(e[i[n]])&&(r=e[i[n]](),a(r)))return r;throw new TypeError("No default value")};t.exports=function(e,t){return a(e)?e:1<arguments.length?n(e,t):n(e)}},{"./helpers/isPrimitive":558,"is-callable":576}],557:[function(e,t,r){"use strict";t.exports=e("./es2015")},{"./es2015":555}],558:[function(e,t,r){arguments[4][552][0].apply(r,arguments)},{dup:552}],559:[function(e,t,r){"use strict";var h=Array.isArray,p=Object.keys,m=Object.prototype.hasOwnProperty;t.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){var n,i,o,a=h(t),s=h(r);if(a&&s){if((i=t.length)!=r.length)return!1;for(n=i;0!=n--;)if(!e(t[n],r[n]))return!1;return!0}if(a!=s)return!1;var u=t instanceof Date,l=r instanceof Date;if(u!=l)return!1;if(u&&l)return t.getTime()==r.getTime();var c=t instanceof RegExp,d=r instanceof RegExp;if(c!=d)return!1;if(c&&d)return t.toString()==r.toString();var f=p(t);if((i=f.length)!==p(r).length)return!1;for(n=i;0!=n--;)if(!m.call(r,f[n]))return!1;for(n=i;0!=n--;)if(!e(t[o=f[n]],r[o]))return!1;return!0}return t!=t&&r!=r}},{}],560:[function(e,t,r){"use strict";var u=Array.prototype.slice,l=Object.prototype.toString;t.exports=function(t){var r=this;if("function"!=typeof r||"[object Function]"!==l.call(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var n,i=u.call(arguments,1),e=Math.max(0,r.length-i.length),o=[],a=0;a<e;a++)o.push("$"+a);if(n=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof n){var e=r.apply(this,i.concat(u.call(arguments)));return Object(e)===e?e:this}return r.apply(t,i.concat(u.call(arguments)))}),r.prototype){var s=function(){};s.prototype=r.prototype,n.prototype=new s,s.prototype=null}return n}},{}],561:[function(e,t,r){"use strict";var n=e("./implementation");t.exports=Function.prototype.bind||n},{"./implementation":560}],562:[function(n,i,e){(function(e){"use strict";var t=e.Symbol,r=n("./shams");i.exports=function(){return"function"==typeof t&&("function"==typeof Symbol&&("symbol"==typeof t("foo")&&("symbol"==typeof Symbol("bar")&&r())))}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./shams":563}],563:[function(e,t,r){"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},{}],564:[function(e,t,r){"use strict";var n=e("function-bind");t.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":561}],565:[function(e,t,r){var n,i;"undefined"!=typeof window&&(n=this,i=function(){return(n={},i.m=r={"./node_modules/eventemitter3/index.js":function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,h="~";function i(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,n,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,n||e,i),a=h?h+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],o]:e._events[a].push(o):(e._events[a]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(h=!1)),a.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(h?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=h?h+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,i=r.length,o=new Array(i);n<i;n++)o[n]=r[n].fn;return o},a.prototype.listenerCount=function(e){var t=h?h+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,n,i,o){var a=h?h+e:e;if(!this._events[a])return!1;var s,u,l=this._events[a],c=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,i),!0;case 6:return l.fn.call(l.context,t,r,n,i,o),!0}for(u=1,s=new Array(c-1);u<c;u++)s[u-1]=arguments[u];l.fn.apply(l.context,s)}else{var d,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),c){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,n);break;default:if(!s)for(d=1,s=new Array(c-1);d<c;d++)s[d-1]=arguments[d];l[u].fn.apply(l[u].context,s)}}return!0},a.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,r,n){var i=h?h+e:e;if(!this._events[i])return this;if(!t)return l(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||n&&!o.once||r&&o.context!==r||l(this,i);else{for(var a=0,s=[],u=o.length;a<u;a++)(o[a].fn!==t||n&&!o[a].once||r&&o[a].context!==r)&&s.push(o[a]);s.length?this._events[i]=1===s.length?s[0]:s:l(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=h?h+e:e,this._events[t]&&l(this,t)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=h,a.EventEmitter=a,e.exports=a},"./node_modules/node-libs-browser/node_modules/events/events.js":function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function u(e){return"function"==typeof e}function l(e){return"object"==typeof e&&null!==e}function c(e){return void 0===e}((e.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,i,o,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var s=new Error('Uncaught, unspecified "error" event. ('+t+")");throw s.context=t,s}if(c(r=this._events[e]))return!1;if(u(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),r.apply(this,i)}else if(l(r))for(i=Array.prototype.slice.call(arguments,1),n=(a=r.slice()).length,o=0;o<n;o++)a[o].apply(this,i);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var r;if(!u(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,u(t.listener)?t.listener:t),this._events[e]?l(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,l(this._events[e])&&!this._events[e].warned&&(r=c(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!u(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var r,n,i,o;if(!u(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(r=this._events[e]).length,n=-1,r===t||u(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(l(r)){for(o=i;0<o--;)if(r[o]===t||r[o].listener&&r[o].listener===t){n=o;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(u(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?u(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(u(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,r){var n,c,i,o,d;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,c=/^([^\/?#]*)(.*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,d={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=d.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=d.normalizePath(n.path),d.buildURLFromParts(n)}var i=d.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=d.normalizePath(i.path),d.buildURLFromParts(i)):t;var o=d.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var a=c.exec(o.path);o.netLoc=a[1],o.path=a[2]}o.netLoc&&!o.path&&(o.path="/");var s={scheme:o.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(s.netLoc=o.netLoc,"/"!==i.path[0]))if(i.path){var u=o.path,l=u.substring(0,u.lastIndexOf("/")+1)+i.path;s.path=d.normalizePath(l)}else s.path=o.path,i.params||(s.params=o.params,i.query||(s.query=o.query));return null===s.path&&(s.path=r.alwaysNormalize?d.normalizePath(i.path):i.path),d.buildURLFromParts(s)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=d},"./node_modules/webworkify-webpack/index.js":function(e,t,h){function u(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var e=i(i.s=ENTRY_MODULE);return e.default||e}var p="[\\.|\\-|\\+|\\w|/|@]+",m="\\((/\\*.*?\\*/)?s?.*?("+p+").*?\\)";function g(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(e,t,r){var n={};n[r]=[];var i=t.toString(),o=i.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return n;for(var a,s=o[1],u=new RegExp("(\\\\n|\\W)"+g(s)+m,"g");a=u.exec(i);)"dll-reference"!==a[3]&&n[r].push(a[3]);for(u=new RegExp("\\("+g(s)+'\\("(dll-reference\\s('+p+'))"\\)\\)'+m,"g");a=u.exec(i);)e[a[2]]||(n[r].push(a[1]),e[a[2]]=h(a[1]).m),n[a[2]]=n[a[2]]||[],n[a[2]].push(a[4]);for(var l,c=Object.keys(n),d=0;d<c.length;d++)for(var f=0;f<n[c[d]].length;f++)l=n[c[d]][f],isNaN(1*l)||(n[c[d]][f]=1*n[c[d]][f]);return n}function v(r){return Object.keys(r).reduce(function(e,t){return e||0<r[t].length},!1)}e.exports=function(e,t){t=t||{};var r={main:h.m},n=t.all?{main:Object.keys(r.main)}:function(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};v(r);)for(var o=Object.keys(r),a=0;a<o.length;a++){var s=o[a],u=r[s].pop();if(i[s]=i[s]||{},!i[s][u]&&e[s][u]){i[s][u]=!0,n[s]=n[s]||[],n[s].push(u);for(var l=f(e,e[s][u],s),c=Object.keys(l),d=0;d<c.length;d++)r[c[d]]=r[c[d]]||[],r[c[d]]=r[c[d]].concat(l[c[d]])}}return n}(r,e),i="";Object.keys(n).filter(function(e){return"main"!==e}).forEach(function(t){for(var e=0;n[t][e];)e++;n[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+"var "+t+" = ("+u.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n[t].map(function(e){return JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"}),i=i+"new (("+u.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map(function(e){return JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"}))(self);";var o=new window.Blob([i],{type:"text/javascript"});if(t.bare)return o;var a=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(o),s=new window.Worker(a);return s.objectURL=a,s}},"./src/config.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/controller/abr-controller.js"),i=r("./src/controller/buffer-controller.js"),o=r("./src/controller/cap-level-controller.js"),a=r("./src/controller/fps-controller.js"),s=r("./src/utils/xhr-loader.js"),u=r("./src/controller/audio-track-controller.js"),l=r("./src/controller/audio-stream-controller.js"),c=r("./src/utils/cues.js"),d=r("./src/controller/timeline-controller.js"),f=r("./src/controller/subtitle-track-controller.js"),h=r("./src/controller/subtitle-stream-controller.js"),p=r("./src/controller/eme-controller.js"),m=r("./src/utils/mediakeys-helper.js");t.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:s.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:n.default,bufferController:i.default,capLevelController:o.default,fpsController:a.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:m.requestMediaKeySystemAccess},t.hlsDefaultConfig.subtitleStreamController=h.SubtitleStreamController,t.hlsDefaultConfig.subtitleTrackController=f.default,t.hlsDefaultConfig.timelineController=d.default,t.hlsDefaultConfig.cueHandler=c,t.hlsDefaultConfig.enableCEA708Captions=!0,t.hlsDefaultConfig.enableWebVTT=!0,t.hlsDefaultConfig.captionsTextTrack1Label="English",t.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",t.hlsDefaultConfig.captionsTextTrack2Label="Spanish",t.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",t.hlsDefaultConfig.audioStreamController=l.default,t.hlsDefaultConfig.audioTrackController=u.default,t.hlsDefaultConfig.emeController=p.default},"./src/controller/abr-controller.js":function(e,l,c){"use strict";(function(a){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(l,"__esModule",{value:!0});var r,_=c("./src/events.js"),t=c("./src/event-handler.js"),b=c("./src/utils/buffer-helper.js"),i=c("./src/errors.js"),E=c("./src/utils/logger.js"),s=c("./src/utils/ewma-bandwidth-estimator.js"),w=window.performance,o=(r=t.default,e(u,r),u.prototype.destroy=function(){this.clearTimer(),t.default.prototype.destroy.call(this)},u.prototype.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var r=this.hls,n=r.config,i=t.level,o=void 0,a=void 0;a=r.levels[i].details.live?(o=n.abrEwmaFastLive,n.abrEwmaSlowLive):(o=n.abrEwmaFastVoD,n.abrEwmaSlowVoD),this._bwEstimator=new s.default(r,a,o,n.abrEwmaDefaultEstimate)}},u.prototype._abandonRulesCheck=function(){var e=this.hls,t=e.media,r=this.fragCurrent;if(r){var n=r.loader,i=e.minAutoLevel;if(!n||n.stats&&n.stats.aborted)return E.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var o=n.stats;if(t&&o&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var a=w.now()-o.trequest,s=Math.abs(t.playbackRate);if(a>500*r.duration/s){var u=e.levels,l=Math.max(1,o.bw?o.bw/8:1e3*o.loaded/a),c=u[r.level],d=c.realBitrate?Math.max(c.realBitrate,c.bitrate):c.bitrate,f=o.total?o.total:Math.max(o.loaded,Math.round(r.duration*d/8)),h=t.currentTime,p=(f-o.loaded)/l,m=(b.BufferHelper.bufferInfo(t,h,e.config.maxBufferHole).end-h)/s;if(m<2*r.duration/s&&m<p){var g=void 0,v=void 0;for(v=r.level-1;i<v;v--){var y=u[v].realBitrate?Math.max(u[v].realBitrate,u[v].bitrate):u[v].bitrate;if((g=r.duration*y/(6.4*l))<m)break}g<p&&(E.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+g.toFixed(1)+"<"+p.toFixed(1)+":"+m.toFixed(1)),e.nextLoadLevel=v,this._bwEstimator.sample(a,o.loaded),n.abort(),this.clearTimer(),e.trigger(_.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:o}))}}}}},u.prototype.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&a.isFinite(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[t.level],n=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,i=(r.loaded?r.loaded.duration:0)+e.frag.duration;r.loaded={bytes:n,duration:i},r.realBitrate=Math.round(8*n/i)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}},u.prototype.onFragBuffered=function(e){var t=e.stats,r=e.frag;if(!0!==t.aborted&&"main"===r.type&&a.isFinite(r.sn)&&(!r.bitrateTest||t.tload===t.tbuffered)){var n=t.tparsed-t.trequest;E.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(n,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},u.prototype.onError=function(e){switch(e.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},u.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(u.prototype,"nextAutoLevel",{get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var r=this._nextABRAutoLevel;return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_nextABRAutoLevel",{get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.levels,n=e.config,i=e.minAutoLevel,o=e.media,a=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,u=o?o.currentTime:0,l=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,c=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,d=(b.BufferHelper.bufferInfo(o,u,n.maxBufferHole).end-u)/l,f=this._findBestLevel(a,s,c,i,t,d,n.abrBandWidthFactor,n.abrBandWidthUpFactor,r);if(0<=f)return f;E.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var h=s?Math.min(s,n.maxStarvationDelay):n.maxStarvationDelay,p=n.abrBandWidthFactor,m=n.abrBandWidthUpFactor;if(0==d){var g=this.bitrateTestDelay;g&&(h=(s?Math.min(s,n.maxLoadingDelay):n.maxLoadingDelay)-g,E.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*h)+" ms"),p=m=1)}return f=this._findBestLevel(a,s,c,i,t,d+h,p,m,r),Math.max(f,0)},enumerable:!0,configurable:!0}),u.prototype._findBestLevel=function(e,t,r,n,i,o,a,s,u){for(var l=i;n<=l;l--){var c=u[l];if(c){var d=c.details,f=d?d.totalduration/d.fragments.length:t,h=!!d&&d.live,p=void 0;p=l<=e?a*r:s*r;var m=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,g=m*f/p;if(E.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(p)+"/"+m+"/"+f+"/"+o+"/"+g),m<p&&(!g||h&&!this.bitrateTestDelay||g<o))return l}}return-1},u);function u(e){var t=r.call(this,e,_.default.FRAG_LOADING,_.default.FRAG_LOADED,_.default.FRAG_BUFFERED,_.default.ERROR)||this;return t.lastLoadedFragLevel=0,t._nextAutoLevel=-1,t.hls=e,t.timer=null,t._bwEstimator=null,t.onCheck=t._abandonRulesCheck.bind(t),t}l.default=o}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/audio-stream-controller.js":function(e,a,s){"use strict";(function(I){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(a,"__esModule",{value:!0});var i,L=s("./src/utils/binary-search.js"),N=s("./src/utils/buffer-helper.js"),h=s("./src/demux/demuxer.js"),k=s("./src/events.js"),f=s("./src/controller/level-helper.js"),o=s("./src/utils/time-ranges.js"),p=s("./src/errors.js"),F=s("./src/utils/logger.js"),j=s("./src/utils/discontinuities.js"),B=s("./src/controller/fragment-tracker.js"),m=s("./src/loader/fragment.js"),U=s("./src/controller/base-stream-controller.js"),G=window.performance,t=(i=U.default,e(r,i),r.prototype.onInitPtsFound=function(e){var t=e.id,r=e.frag.cc,n=e.initPTS;"main"===t&&(this.initPTS[r]=n,this.videoTrackCC=r,F.logger.log("InitPTS for cc: "+r+" found from video track: "+n),this.state===U.State.WAITING_INIT_PTS&&this.tick())},r.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<t&&-1===e?(F.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=U.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=U.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=U.State.STOPPED},Object.defineProperty(r.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e,F.logger.log("audio stream:"+t+"->"+e)}},enumerable:!0,configurable:!0}),r.prototype.doTick=function(){var e,t,r,n=this.hls,i=n.config;switch(this.state){case U.State.ERROR:case U.State.PAUSED:case U.State.BUFFER_FLUSHING:break;case U.State.STARTING:this.state=U.State.WAITING_TRACK,this.loadedmetadata=!1;break;case U.State.IDLE:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var a=this.mediaBuffer?this.mediaBuffer:this.media,s=this.videoBuffer?this.videoBuffer:this.media,u=N.BufferHelper.bufferInfo(a,e,i.maxBufferHole),l=N.BufferHelper.bufferInfo(s,e,i.maxBufferHole),c=u.len,d=u.end,f=this.fragPrevious,h=Math.min(i.maxBufferLength,i.maxMaxBufferLength),p=Math.max(h,l.len),m=this.audioSwitch,g=this.trackId;if((c<p||m)&&g<o.length){if(void 0===(r=o[g].details)){this.state=U.State.WAITING_TRACK;break}if(!m&&this._streamEnded(u,r))return this.hls.trigger(k.default.BUFFER_EOS,{type:"audio"}),void(this.state=U.State.ENDED);var v=r.fragments,y=v.length,_=v[0].start,b=v[y-1].start+v[y-1].duration,E=void 0;if(m)if(r.live&&!r.PTSKnown)F.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),d=0;else if(d=e,r.PTSKnown&&e<_){if(!(u.end>_||u.nextStart))return;F.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=_+.05}if(r.initSegment&&!r.initSegment.data)E=r.initSegment;else if(d<=_){if(E=v[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=j.findFragWithCC(v,this.videoTrackCC)),r.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var w=u.nextStart?u.nextStart:_;return F.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(w+.05)),void(this.media.currentTime=w+.05)}}else{var A=void 0,T=i.maxFragLookUpTolerance,S=f?v[f.sn-v[0].sn+1]:void 0,x=function(e){var t=Math.min(T,e.duration);return e.start+e.duration-t<=d?1:e.start-t>d&&e.start?-1:0};(A=d<b?(b-T<d&&(T=0),S&&!x(S)?S:L.default.search(v,x)):v[y-1])&&(_=(E=A).start,f&&E.level===f.level&&E.sn===f.sn&&(E.sn<r.endSN?(E=v[E.sn+1-r.startSN],F.logger.log("SN just loaded, load next one: "+E.sn)):E=null))}E&&(E.encrypted?(F.logger.log("Loading key for "+E.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+g),this.state=U.State.KEY_LOADING,n.trigger(k.default.KEY_LOADING,{frag:E})):(F.logger.log("Loading "+E.sn+", cc: "+E.cc+" of ["+r.startSN+" ,"+r.endSN+"],track "+g+", currentTime:"+e+",bufferEnd:"+d.toFixed(3)),this.fragCurrent=E,!m&&this.fragmentTracker.getState(E)!==B.FragmentState.NOT_LOADED||(this.startFragRequested=!0,I.isFinite(E.sn)&&(this.nextLoadPosition=E.start+E.duration),n.trigger(k.default.FRAG_LOADING,{frag:E}),this.state=U.State.FRAG_LOADING)))}break;case U.State.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=U.State.IDLE);break;case U.State.FRAG_LOADING_WAITING_RETRY:var M=G.now(),R=this.retryDate,O=(a=this.media)&&a.seeking;(!R||R<=M||O)&&(F.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=U.State.IDLE);break;case U.State.WAITING_INIT_PTS:var P=this.videoTrackCC;if(void 0===this.initPTS[P])break;var C=this.waitingFragment;if(C){var D=C.frag.cc;P!==D?(t=this.tracks[this.trackId]).details&&t.details.live&&(F.logger.warn("Waiting fragment CC ("+D+") does not match video track CC ("+P+")"),this.waitingFragment=null,this.state=U.State.IDLE):(this.state=U.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=U.State.IDLE;break;case U.State.STOPPED:case U.State.FRAG_LOADING:case U.State.PARSING:case U.State.PARSED:case U.State.ENDED:}},r.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)},r.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(F.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},r.prototype.onAudioTracksUpdated=function(e){F.logger.log("audio tracks updated"),this.tracks=e.audioTracks},r.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=U.State.PAUSED,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=U.State.IDLE),this.tick()},r.prototype.onAudioTrackLoaded=function(e){var t=e.details,r=e.id,n=this.tracks[r],i=t.totalduration,o=0;if(F.logger.log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var a=n.details;a&&0<t.fragments.length?(f.mergeDetails(a,t),o=t.fragments[0].start,t.PTSKnown?F.logger.log("live audio playlist sliding:"+o.toFixed(3)):F.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,F.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(n.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;I.isFinite(s)?(F.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===U.State.WAITING_TRACK&&(this.state=U.State.IDLE),this.tick()},r.prototype.onKeyLoaded=function(){this.state===U.State.KEY_LOADING&&(this.state=U.State.IDLE,this.tick())},r.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag;if(this.state===U.State.FRAG_LOADING&&t&&"audio"===r.type&&r.level===t.level&&r.sn===t.sn){var n=this.tracks[this.trackId],i=n.details,o=i.totalduration,a=t.level,s=t.sn,u=t.cc,l=this.config.defaultAudioCodec||n.audioCodec||"mp4a.40.2",c=this.stats=e.stats;if("initSegment"===s)this.state=U.State.IDLE,c.tparsed=c.tbuffered=G.now(),i.initSegment.data=e.payload,this.hls.trigger(k.default.FRAG_BUFFERED,{stats:c,frag:t,id:"audio"}),this.tick();else{this.state=U.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new h.default(this.hls,"audio"));var d=this.initPTS[u],f=i.initSegment?i.initSegment.data:[];i.initSegment||void 0!==d?(this.pendingBuffering=!0,F.logger.log("Demuxing "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a),this.demuxer.push(e.payload,f,l,null,t,o,!1,d)):(F.logger.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+a),this.waitingFragment=e,this.state=U.State.WAITING_INIT_PTS)}}this.fragLoadError=0},r.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===U.State.PARSING){var n=e.tracks,i=void 0;if(n.video&&delete n.video,i=n.audio){i.levelCodec=i.codec,i.id=e.id,this.hls.trigger(k.default.BUFFER_CODECS,n),F.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var o=i.initSegment;if(o){var a={type:"audio",data:o,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(k.default.BUFFER_APPENDING,a))}this.tick()}}},r.prototype.onFragParsingData=function(t){var r=this,e=this.fragCurrent,n=t.frag;if(e&&"audio"===t.id&&"audio"===t.type&&n.sn===e.sn&&n.level===e.level&&this.state===U.State.PARSING){var i=this.trackId,o=this.tracks[i],a=this.hls;I.isFinite(t.endPTS)||(t.endPTS=t.startPTS+e.duration,t.endDTS=t.startDTS+e.duration),e.addElementaryStream(m.default.ElementaryStreamTypes.AUDIO),F.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),f.updateFragPTSDTS(o.details,e,t.startPTS,t.endPTS);var s=this.audioSwitch,u=this.media,l=!1;if(s&&u)if(u.readyState){var c=u.currentTime;F.logger.log("switching audio track : currentTime:"+c),c>=t.startPTS&&(F.logger.log("switching audio track : flushing all audio"),this.state=U.State.BUFFER_FLUSHING,a.trigger(k.default.BUFFER_FLUSHING,{startOffset:0,endOffset:I.POSITIVE_INFINITY,type:"audio"}),l=!0,this.audioSwitch=!1,a.trigger(k.default.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,a.trigger(k.default.AUDIO_TRACK_SWITCHED,{id:i});var d=this.pendingData;if(!d)return F.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void a.trigger(k.default.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&d.push({type:t.type,data:e,parent:"audio",content:"data"})}),!l&&d.length&&(d.forEach(function(e){r.state===U.State.PARSING&&(r.pendingBuffering=!0,r.hls.trigger(k.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},r.prototype.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===U.State.PARSING&&(this.stats.tparsed=G.now(),this.state=U.State.PARSED,this._checkAppendedParsed())},r.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},r.prototype.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==U.State.PARSING&&t!==U.State.PARSED||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},r.prototype._checkAppendedParsed=function(){if(!(this.state!==U.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e,t.tbuffered=G.now(),r.trigger(k.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;F.logger.log("audio buffered : "+o.default.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(k.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=U.State.IDLE}this.tick()}},r.prototype.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:var r=e.frag;if(r&&"audio"!==r.type)break;if(!e.fatal){var n=this.fragLoadError;if(n?n++:n=1,n<=(o=this.config).fragLoadingMaxRetry){this.fragLoadError=n;var i=Math.min(Math.pow(2,n-1)*o.fragLoadingRetryDelay,o.fragLoadingMaxRetryTimeout);F.logger.warn("AudioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=G.now()+i,this.state=U.State.FRAG_LOADING_WAITING_RETRY}else F.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=U.State.ERROR}break;case p.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case p.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==U.State.ERROR&&(this.state=e.fatal?U.State.ERROR:U.State.IDLE,F.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===U.State.PARSING||this.state===U.State.PARSED)){var o,a=this.mediaBuffer,s=this.media.currentTime;a&&N.BufferHelper.isBuffered(a,s)&&N.BufferHelper.isBuffered(a,s+.5)?((o=this.config).maxMaxBufferLength>=o.maxBufferLength&&(o.maxMaxBufferLength/=2,F.logger.warn("AudioStreamController: reduce max buffer length to "+o.maxMaxBufferLength+"s")),this.state=U.State.IDLE):(F.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=U.State.BUFFER_FLUSHING,this.hls.trigger(k.default.BUFFER_FLUSHING,{startOffset:0,endOffset:I.POSITIVE_INFINITY,type:"audio"}))}}},r.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(F.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(e){t.hls.trigger(k.default.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=U.State.PARSED):(this.state=U.State.IDLE,this.fragPrevious=null,this.tick())},r);function r(e,t){var r=i.call(this,e,k.default.MEDIA_ATTACHED,k.default.MEDIA_DETACHING,k.default.AUDIO_TRACKS_UPDATED,k.default.AUDIO_TRACK_SWITCHING,k.default.AUDIO_TRACK_LOADED,k.default.KEY_LOADED,k.default.FRAG_LOADED,k.default.FRAG_PARSING_INIT_SEGMENT,k.default.FRAG_PARSING_DATA,k.default.FRAG_PARSED,k.default.ERROR,k.default.BUFFER_RESET,k.default.BUFFER_CREATED,k.default.BUFFER_APPENDED,k.default.BUFFER_FLUSHED,k.default.INIT_PTS_FOUND)||this;return r.fragmentTracker=t,r.config=e.config,r.audioCodecSwap=!1,r._state=U.State.STOPPED,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r}a.default=t}).call(this,s("./src/polyfills/number.js").Number)},"./src/controller/audio-track-controller.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=r("./src/events.js"),a=r("./src/task-loop.js"),u=r("./src/utils/logger.js"),l=r("./src/errors.js"),c=(o=a.default,i(d,o),d.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},d.prototype.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(s.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})},d.prototype.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)u.logger.warn("Invalid audio track id:",e.id);else{if(u.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},d.prototype.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},d.prototype.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var r=t.audioGroupIds[t.urlId];this.audioGroupId!==r&&(this.audioGroupId=r,this._selectInitialAudioTrack())}},d.prototype.onError=function(e){e.type===l.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(u.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},Object.defineProperty(d.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"audioTrack",{get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),d.prototype._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)u.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)u.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];u.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var r=t.url,n=t.type,i=t.id;this.hls.trigger(s.default.AUDIO_TRACK_SWITCHING,{id:i,type:n,url:r}),this._loadTrackDetailsIfNeeded(t)}},d.prototype.doTick=function(){this._updateTrack(this._trackId)},d.prototype._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var r=this.tracks[this._trackId],n=null;if(r&&(n=r.name),this._selectDefaultTrack){var i=e.filter(function(e){return e.default});i.length?e=i:u.logger.warn("No default audio tracks defined")}var o=!1,a=function(){e.forEach(function(e){o||t.audioGroupId&&e.groupId!==t.audioGroupId||n&&n!==e.name||(t._setAudioTrack(e.id),o=!0)})};a(),o||(n=null,a()),o||(u.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(s.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},d.prototype._needsTrackLoading=function(e){var t=e.details,r=e.url;return!(t&&!t.live||!r)},d.prototype._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,r=e.id;u.logger.log("loading audio-track playlist for id: "+r),this.hls.trigger(s.default.AUDIO_TRACK_LOADING,{url:t,id:r})}},d.prototype._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,u.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},d.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],r=t.name,n=t.language,i=t.groupId;u.logger.warn("Loading failed on audio track id: "+e+", group-id: "+i+', name/language: "'+r+'" / "'+n+'"');for(var o=e,a=0;a<this.tracks.length;a++)if(!this.trackIdBlacklist[a]&&this.tracks[a].name===r){o=a;break}o!==e?(u.logger.log("Attempting audio-track fallback id:",o,"group-id:",this.tracks[o].groupId),this._setAudioTrack(o)):u.logger.warn('No fallback audio-track found for name/language: "'+r+'" / "'+n+'"')},d);function d(e){var t=o.call(this,e,s.default.MANIFEST_LOADING,s.default.MANIFEST_PARSED,s.default.AUDIO_TRACK_LOADED,s.default.AUDIO_TRACK_SWITCHED,s.default.LEVEL_LOADED,s.default.ERROR)||this;return t._trackId=-1,t._selectDefaultTrack=!0,t.tracks=[],t.trackIdBlacklist=Object.create(null),t.audioGroupId=null,t}t.default=c},"./src/controller/base-stream-controller.js":function(e,h,s){"use strict";(function(c){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(h,"__esModule",{value:!0});var t=s("./src/task-loop.js"),o=s("./src/controller/fragment-tracker.js"),d=s("./src/utils/buffer-helper.js"),f=s("./src/utils/logger.js");h.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var r,i=(r=t.default,e(a,r),a.prototype.doTick=function(){},a.prototype.startLoad=function(){},a.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=h.State.STOPPED},a.prototype._streamEnded=function(e,t){var r=this.fragCurrent,n=this.fragmentTracker;if(t.live||!r||r.backtracked||r.sn!==t.endSN||e.nextStart)return!1;var i=n.getState(r);return i===o.FragmentState.PARTIAL||i===o.FragmentState.OK},a.prototype.onMediaSeeking=function(){var e=this.config,t=this.media,r=this.mediaBuffer,n=this.state,i=t?t.currentTime:null,o=d.BufferHelper.bufferInfo(r||t,i,this.config.maxBufferHole);if(c.isFinite(i)&&f.logger.log("media seeking to "+i.toFixed(3)),n===h.State.FRAG_LOADING){var a=this.fragCurrent;if(0===o.len&&a){var s=e.maxFragLookUpTolerance,u=a.start-s,l=a.start+a.duration+s;i<u||l<i?(a.loader&&(f.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=h.State.IDLE):f.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else n===h.State.ENDED&&(0===o.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=h.State.IDLE);t&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},a.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},a.prototype.onHandlerDestroying=function(){this.stopLoad(),r.prototype.onHandlerDestroying.call(this)},a.prototype.onHandlerDestroyed=function(){this.state=h.State.STOPPED,this.fragmentTracker=null},a);function a(){return null!==r&&r.apply(this,arguments)||this}h.default=i}).call(this,s("./src/polyfills/number.js").Number)},"./src/controller/buffer-controller.js":function(e,d,f){"use strict";(function(n){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(d,"__esModule",{value:!0});var r,u=f("./src/events.js"),t=f("./src/event-handler.js"),l=f("./src/utils/logger.js"),c=f("./src/errors.js"),o=f("./src/utils/mediasource-helper.js").getMediaSource(),a=(r=t.default,e(s,r),s.prototype.destroy=function(){t.default.prototype.destroy.call(this)},s.prototype.onLevelPtsUpdated=function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){var n=this.sourceBuffer.audio;if(.1<Math.abs(n.timestampOffset-e.start)){var i=n.updating;try{n.abort()}catch(e){l.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(l.logger.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+e.start),n.timestampOffset=e.start)}}},s.prototype.onManifestParsed=function(e){this.bufferCodecEventsExpected=e.altAudio?2:1,l.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},s.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var r=this.mediaSource=new o;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),t.src=window.URL.createObjectURL(r),this._objectUrl=t.src}},s.prototype.onMediaDetaching=function(){l.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){l.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):l.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)},s.prototype.onMediaSourceOpen=function(){l.logger.log("media source opened"),this.hls.trigger(u.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},s.prototype.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,r=Object.keys(t).length;(r&&!e||2===r)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},s.prototype.onMediaSourceClose=function(){l.logger.log("media source closed")},s.prototype.onMediaSourceEnded=function(){l.logger.log("media source ended")},s.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;l.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var r=this.parent,t=this.segments.reduce(function(e,t){return t.parent===r?e+1:e},0),n={},i=this.sourceBuffer;for(var o in i)n[o]=i[o].buffered;this.hls.trigger(u.default.BUFFER_APPENDED,{parent:r,pending:t,timeRanges:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===t&&this.flushLiveBackBuffer()},s.prototype.onSBUpdateError=function(e){l.logger.error("sourceBuffer error:",e),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},s.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},s.prototype.onBufferCodecs=function(t){var r=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(t).forEach(function(e){r.pendingTracks[e]=t[e]});var e=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),e&&"open"===e.readyState&&this.checkPendingTracks()}},s.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;for(var n in e)if(!t[n]){var i=e[n],o=i.levelCodec||i.codec,a=i.container+";codecs="+o;l.logger.log("creating sourceBuffer("+a+")");try{var s=t[n]=r.addSourceBuffer(a);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[n]={codec:o,container:i.container},i.buffer=s}catch(e){l.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:a})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:e})},s.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},s.prototype.onBufferAppendFail=function(e){l.logger.error("sourceBuffer error:",e.event),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},s.prototype.onBufferEos=function(e){var t=this.sourceBuffer,r=e.type;for(var n in t)r&&n!==r||t[n].ended||(t[n].ended=!0,l.logger.log(n+" sourceBuffer now EOS"));this.checkEos()},s.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){var n=e[r];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}l.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},s.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},s.prototype.flushLiveBackBuffer=function(){if(this._live){var e=this.hls.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))for(var t=this.media.currentTime,r=this.sourceBuffer,n=Object.keys(r),i=t-Math.max(e,this._levelTargetDuration),o=n.length-1;0<=o;o--){var a=n[o],s=r[a].buffered;0<s.length&&i>s.start(0)&&this.removeBufferRange(a,r[a],0,i)}}},s.prototype.onLevelUpdated=function(e){var t=e.details;0<t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},s.prototype.updateMediaElementDuration=function(){var e,t=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(l.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!n.isFinite(e))&&(l.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},s.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var n in r)t+=r[n].buffered.length}catch(e){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}},s.prototype.doAppending=function(){var t=this.hls,r=this.segments,e=this.sourceBuffer;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void l.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(r&&r.length){var n=r.shift();try{var i=e[n.type];i?i.updating?r.unshift(n):(i.ended=!1,this.parent=n.parent,i.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){l.logger.error("error while trying to append buffer:"+e.message),r.unshift(n);var o={type:c.ErrorTypes.MEDIA_ERROR,parent:n.parent};22!==e.code?(this.appendError?this.appendError++:this.appendError=1,o.details=c.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry?(l.logger.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],o.fatal=!0):o.fatal=!1):(this.segments=[],o.details=c.ErrorDetails.BUFFER_FULL_ERROR,o.fatal=!1),t.trigger(u.default.ERROR,o)}}}},s.prototype.flushBuffer=function(e,t,r){var n,i=this.sourceBuffer;if(Object.keys(i).length){if(l.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var o in i)if(!r||o===r){if((n=i[o]).ended=!1,n.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(o,n,e,t))return this.flushBufferCounter++,!1}}else l.logger.warn("abort flushing too many retries");l.logger.log("buffer flushed")}return!0},s.prototype.removeBufferRange=function(e,t,r,n){try{for(var i=0;i<t.buffered.length;i++){var o=t.buffered.start(i),a=t.buffered.end(i),s=Math.max(o,r),u=Math.min(a,n);if(.5<Math.min(u,a)-s)return l.logger.log("sb remove "+e+" ["+s+","+u+"], of ["+o+","+a+"], pos:"+this.media.currentTime),t.remove(s,u),!0}}catch(e){l.logger.warn("removeBufferRange failed",e)}return!1},s);function s(e){var t=r.call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED)||this;return t._msDuration=null,t._levelDuration=null,t._levelTargetDuration=10,t._live=null,t._objectUrl=null,t.bufferCodecEventsExpected=0,t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t.pendingTracks={},t.tracks={},t}d.default=a}).call(this,f("./src/polyfills/number.js").Number)},"./src/controller/cap-level-controller.js":function(e,u,l){"use strict";(function(r){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(u,"__esModule",{value:!0});var i,o=l("./src/events.js"),t=l("./src/event-handler.js"),a=(i=t.default,e(s,i),s.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},s.prototype.onFpsDropLevelCapping=function(e){s.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},s.prototype.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},s.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this._startCapping()},s.prototype.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()},s.prototype.onLevelsUpdated=function(e){this.levels=e.levels},s.prototype.onMediaDetaching=function(){this._stopCapping()},s.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},s.prototype.getMaxLevel=function(r){var n=this;if(!this.levels)return-1;var e=this.levels.filter(function(e,t){return s.isLevelAllowed(t,n.restrictedLevels)&&t<=r});return s.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)},s.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=r.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=r.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(s.prototype,"mediaWidth",{get:function(){var e,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=s.contentScaleFactor),e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"mediaHeight",{get:function(){var e,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=s.contentScaleFactor),e},enumerable:!0,configurable:!0}),Object.defineProperty(s,"contentScaleFactor",{get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e},enumerable:!0,configurable:!0}),s.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},s.getMaxLevelByMediaSize=function(e,t,r){if(!e||e&&!e.length)return-1;for(var n,i,o=e.length-1,a=0;a<e.length;a+=1){var s=e[a];if((s.width>=t||s.height>=r)&&(n=s,!(i=e[a+1])||n.width!==i.width||n.height!==i.height)){o=a;break}}return o},s);function s(e){var t=i.call(this,e,o.default.FPS_DROP_LEVEL_CAPPING,o.default.MEDIA_ATTACHING,o.default.MANIFEST_PARSED,o.default.BUFFER_CODECS,o.default.MEDIA_DETACHING)||this;return t.autoLevelCapping=r.POSITIVE_INFINITY,t.firstLevel=null,t.levels=[],t.media=null,t.restrictedLevels=[],t.timer=null,t}u.default=a}).call(this,l("./src/polyfills/number.js").Number)},"./src/controller/eme-controller.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=r("./src/event-handler.js"),s=r("./src/events.js"),u=r("./src/errors.js"),l=r("./src/utils/logger.js"),c=window.XMLHttpRequest,d="com.widevine.alpha",f="com.microsoft.playready",h=(o=a.default,i(p,o),p.prototype.getLicenseServerUrl=function(e){var t;switch(e){case d:t=this._widevineLicenseUrl;break;default:t=null}return t||(l.logger.error('No license server URL configured for key-system "'+e+'"'),this.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),t},p.prototype._attemptKeySystemAccess=function(t,e,r){var n=this,i=function(e,t,r){switch(e){case d:return function(e,t){var r={videoCapabilities:[]};return t.forEach(function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[r]}(0,r);default:throw Error("Unknown key-system: "+e)}}(t,0,r);i?(l.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(t,i).then(function(e){n._onMediaKeySystemAccessObtained(t,e)}).catch(function(e){l.logger.error('Failed to obtain key-system "'+t+'" access:',e)})):l.logger.warn("Can not create config for key-system (maybe because platform is not supported):",t)},Object.defineProperty(p.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),p.prototype._onMediaKeySystemAccessObtained=function(t,e){var r=this;l.logger.log('Access for key-system "'+t+'" obtained');var n={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(n),e.createMediaKeys().then(function(e){n.mediaKeys=e,l.logger.log('Media-keys created for key-system "'+t+'"'),r._onMediaKeysCreated()}).catch(function(e){l.logger.error("Failed to create media-keys:",e)})},p.prototype._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},p.prototype._onNewMediaKeySession=function(t){var r=this;l.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",function(e){r._onKeySessionMessage(t,e.message)},!1)},p.prototype._onKeySessionMessage=function(t,e){l.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(e){l.logger.log("Received license data, updating key-session"),t.update(e)})},p.prototype._onMediaEncrypted=function(e,t){l.logger.log('Media is encrypted using "'+e+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=e,this._mediaEncryptionInitData=t,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},p.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});l.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},p.prototype._generateRequestWithPreferredKeySession=function(){var t=this,e=this._mediaKeysList[0];if(!e)return l.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)l.logger.warn("Key-Session already initialized but requested again");else{var r=e.mediaKeysSession;r||(l.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var n=this._mediaEncryptionInitDataType,i=this._mediaEncryptionInitData;l.logger.log('Generating key-session request for "'+n+'" init data type'),e.mediaKeysSessionInitialized=!0,r.generateRequest(n,i).then(function(){l.logger.debug("Key-session generation succeeded")}).catch(function(e){l.logger.error("Error generating key-session request:",e),t.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},p.prototype._createLicenseXhr=function(t,e,r){var n=new c,i=this._licenseXhrSetup;try{if(i)try{i(n,t)}catch(e){n.open("POST",t,!0),i(n,t)}n.readyState||n.open("POST",t,!0)}catch(e){return l.logger.error("Error setting up key-system license XHR",e),void this.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,t,e,r),n},p.prototype._onLicenseRequestReadyStageChange=function(e,t,r,n){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,l.logger.log("License request succeeded"),n(e.response);else{if(l.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount<=3){var i=3-this._requestLicenseFailureCount+1;return l.logger.warn("Retrying license request, "+i+" attempts left"),void this._requestLicense(r,n)}this.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},p.prototype._generateLicenseRequestChallenge=function(e,t){var r;return e.mediaKeySystemDomain===f?l.logger.error("PlayReady is not supported (yet)"):e.mediaKeySystemDomain===d?r=t:l.logger.error("Unsupported key-system:",e.mediaKeySystemDomain),r},p.prototype._requestLicense=function(e,t){l.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return l.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(s.default.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var n=this.getLicenseServerUrl(r.mediaKeySystemDomain),i=this._createLicenseXhr(n,e,t);l.logger.log("Sending license request to URL: "+n),i.send(this._generateLicenseRequestChallenge(r,e))},p.prototype.onMediaAttached=function(e){var t=this;if(this._emeEnabled){var r=e.media;(this._media=r).addEventListener("encrypted",function(e){t._onMediaEncrypted(e.initDataType,e.initData)})}},p.prototype.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),r=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(d,t,r)}},p);function p(e){var t=o.call(this,e,s.default.MEDIA_ATTACHED,s.default.MANIFEST_PARSED)||this;return t._widevineLicenseUrl=e.config.widevineLicenseUrl,t._licenseXhrSetup=e.config.licenseXhrSetup,t._emeEnabled=e.config.emeEnabled,t._requestMediaKeySystemAccess=e.config.requestMediaKeySystemAccessFunc,t._mediaKeysList=[],t._media=null,t._hasSetMediaKeys=!1,t._isMediaEncrypted=!1,t._requestLicenseFailureCount=0,t}t.default=h},"./src/controller/fps-controller.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,c=r("./src/events.js"),a=r("./src/event-handler.js"),d=r("./src/utils/logger.js"),f=window.performance,s=(o=a.default,i(u,o),u.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},u.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},u.prototype.checkFPS=function(e,t,r){var n=f.now();if(t){if(this.lastTime){var i=n-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,s=1e3*o/i,u=this.hls;if(u.trigger(c.default.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),0<s&&o>u.config.fpsDroppedMonitoringThreshold*a){var l=u.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),0<l&&(-1===u.autoLevelCapping||u.autoLevelCapping>=l)&&(l-=1,u.trigger(c.default.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:u.currentLevel}),u.autoLevelCapping=l,u.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},u.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},u);function u(e){return o.call(this,e,c.default.MEDIA_ATTACHING)||this}t.default=s},"./src/controller/fragment-finders.js":function(e,t,r){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0});var a=r("./src/utils/binary-search.js");function s(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0);var n=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=e?1:r.start-n>e&&r.start?-1:0}function u(e,t,r){var n=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.endProgramDateTime-n>e}t.findFragmentByPDT=function(e,t,r){if(!Array.isArray(e)||!e.length||!o.isFinite(t))return null;if(t<e[0].programDateTime)return null;if(t>=e[e.length-1].endProgramDateTime)return null;r=r||0;for(var n=0;n<e.length;++n){var i=e[n];if(u(t,r,i))return i}return null},t.findFragmentByPTS=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=e?t[e.sn-t[0].sn+1]:null;return i&&!s(r,n,i)?i:a.default.search(t,s.bind(null,r,n))},t.fragmentWithinToleranceTest=s,t.pdtWithinToleranceTest=u}).call(this,r("./src/polyfills/number.js").Number)},"./src/controller/fragment-tracker.js":function(e,u,l){"use strict";(function(r){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(u,"__esModule",{value:!0});var t=l("./src/event-handler.js"),i=l("./src/events.js");u.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var o,a=(o=t.default,e(s,o),s.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,t.default.prototype.destroy.call(this),o.prototype.destroy.call(this)},s.prototype.getBufferedFrag=function(n,i){var o=this.fragments,e=Object.keys(o).filter(function(e){var t=o[e];if(t.body.type!==i)return!1;if(!t.buffered)return!1;var r=t.body;return r.startPTS<=n&&n<=r.endPTS});if(0===e.length)return null;var t=e.pop();return o[t].body},s.prototype.detectEvictedFragments=function(i,o){var a,s,u=this;Object.keys(this.fragments).forEach(function(e){var t=u.fragments[e];if(!0===t.buffered){var r=t.range[i];if(r){a=r.time;for(var n=0;n<a.length;n++)if(s=a[n],!1===u.isTimeBuffered(s.startPTS,s.endPTS,o)){u.removeFragment(t.body);break}}}})},s.prototype.detectPartialFragments=function(r){var n=this,e=this.getFragmentKey(r),i=this.fragments[e];i&&(i.buffered=!0,Object.keys(this.timeRanges).forEach(function(e){if(r.hasElementaryStream(e)){var t=n.timeRanges[e];i.range[e]=n.getBufferedTimes(r.startPTS,r.endPTS,t)}}))},s.prototype.getBufferedTimes=function(e,t,r){for(var n,i,o=[],a=!1,s=0;s<r.length;s++){if(n=r.start(s)-this.bufferPadding,i=r.end(s)+this.bufferPadding,n<=e&&t<=i){o.push({startPTS:Math.max(e,r.start(s)),endPTS:Math.min(t,r.end(s))});break}if(e<i&&n<t)o.push({startPTS:Math.max(e,r.start(s)),endPTS:Math.min(t,r.end(s))}),a=!0;else if(t<=n)break}return{time:o,partial:a}},s.prototype.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},s.prototype.getPartialFragment=function(r){var n,i,o,a=this,s=null,u=0;return Object.keys(this.fragments).forEach(function(e){var t=a.fragments[e];a.isPartial(t)&&(i=t.body.startPTS-a.bufferPadding,o=t.body.endPTS+a.bufferPadding,i<=r&&r<=o&&(n=Math.min(r-i,o-r),u<=n&&(s=t.body,u=n)))}),s},s.prototype.getState=function(e){var t=this.getFragmentKey(e),r=this.fragments[t],n=u.FragmentState.NOT_LOADED;return void 0!==r&&(n=r.buffered?!0===this.isPartial(r)?u.FragmentState.PARTIAL:u.FragmentState.OK:u.FragmentState.APPENDING),n},s.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},s.prototype.isTimeBuffered=function(e,t,r){for(var n,i,o=0;o<r.length;o++){if(n=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,n<=e&&t<=i)return!0;if(t<=n)return!1}return!1},s.prototype.onFragLoaded=function(e){var t=e.frag;r.isFinite(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},s.prototype.onBufferAppended=function(e){var r=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var t=r.timeRanges[e];r.detectEvictedFragments(e,t)})},s.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},s.prototype.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},s.prototype.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},s.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},s);function s(e){var t=o.call(this,e,i.default.BUFFER_APPENDED,i.default.FRAG_BUFFERED,i.default.FRAG_LOADED)||this;return t.bufferPadding=.2,t.fragments=Object.create(null),t.timeRanges=Object.create(null),t.config=e.config,t}u.FragmentTracker=a}).call(this,l("./src/polyfills/number.js").Number)},"./src/controller/gap-controller.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=r("./src/utils/buffer-helper.js"),s=r("./src/errors.js"),l=r("./src/events.js"),c=r("./src/utils/logger.js"),n=(i.prototype.poll=function(e,t){var r=this.config,n=this.media,i=n.currentTime,o=window.performance.now();if(i!==e)return this.stallReported&&(c.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(o-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(n.ended||!n.buffered.length||2<n.readyState||n.seeking&&u.BufferHelper.isBuffered(n,i))){var a=o-this.stalled,s=u.BufferHelper.bufferInfo(n,i,r.maxBufferHole);this.stalled?(1e3<=a&&this._reportStall(s.len),this._tryFixBufferStall(s,a)):this.stalled=o}},i.prototype._tryFixBufferStall=function(e,t){var r=this.config,n=this.fragmentTracker,i=this.media.currentTime,o=n.getPartialFragment(i);o&&this._trySkipBufferHole(o),.5<e.len&&t>1e3*r.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},i.prototype._reportStall=function(e){var t=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,c.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer"),t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},i.prototype._trySkipBufferHole=function(e){for(var t=this.hls,r=this.media,n=r.currentTime,i=0,o=0;o<r.buffered.length;o++){var a=r.buffered.start(o);if(i<=n&&n<a)return r.currentTime=Math.max(a,r.currentTime+.1),c.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+r.currentTime),this.stalled=null,void t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+r.currentTime,frag:e});i=r.buffered.end(o)}},i.prototype._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,n=r.currentTime,i=(this.nudgeRetry||0)+1;if((this.nudgeRetry=i)<e.nudgeMaxRetry){var o=n+i*e.nudgeOffset;c.logger.log("adjust currentTime from "+n+" to "+o),r.currentTime=o,t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.logger.error("still stuck in high buffer @"+n+" after "+e.nudgeMaxRetry+", raise fatal error"),t.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},i);function i(e,t,r,n){this.config=e,this.media=t,this.fragmentTracker=r,this.hls=n,this.stallReported=!1}t.default=n},"./src/controller/id3-track-controller.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=r("./src/events.js"),s=r("./src/event-handler.js"),d=r("./src/demux/id3.js"),u=r("./src/utils/texttrack-utils.js"),l=(o=s.default,i(c,o),c.prototype.destroy=function(){s.default.prototype.destroy.call(this)},c.prototype.onMediaAttached=function(e){this.media=e.media,this.media},c.prototype.onMediaDetaching=function(){u.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},c.prototype.getID3Track=function(e){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return u.sendAddTrackEvent(r,this.media),r}return this.media.addTextTrack("metadata","id3")},c.prototype.onFragParsingMetadata=function(e){var t=e.frag,r=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<r.length;i++){var o=d.default.getID3Frames(r[i].data);if(o){var a=r[i].pts,s=i<r.length-1?r[i+1].pts:t.endPTS;a===s&&(s+=1e-4);for(var u=0;u<o.length;u++){var l=o[u];if(!d.default.isTimeStampFrame(l)){var c=new n(a,s,"");c.value=l,this.id3Track.addCue(c)}}}}},c);function c(e){var t=o.call(this,e,a.default.MEDIA_ATTACHED,a.default.MEDIA_DETACHING,a.default.FRAG_PARSING_METADATA)||this;return t.id3Track=void 0,t.media=void 0,t}t.default=l},"./src/controller/level-controller.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var l,o,c=r("./src/events.js"),a=r("./src/event-handler.js"),d=r("./src/utils/logger.js"),f=r("./src/errors.js"),h=r("./src/utils/codecs.js"),p=r("./src/controller/level-helper.js"),s=(window.performance,o=a.default,i(u,o),u.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},u.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},u.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},u.prototype.stopLoad=function(){this.canload=!1},u.prototype.onManifestLoaded=function(e){var t,r=[],n=[],i={},o=null,a=!1,s=!1;if(e.levels.forEach(function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,a=a||!!e.videoCodec,s=s||!!e.audioCodec,l&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(o=i[e.bitrate])?o.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,r.push(e)),t&&(t.AUDIO&&(s=!0,p.addGroupId(o||e,"audio",t.AUDIO)),t.SUBTITLES&&p.addGroupId(o||e,"text",t.SUBTITLES))}),a&&s&&(r=r.filter(function(e){return!!e.videoCodec})),r=r.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||h.isCodecSupportedInMp4(t,"audio"))&&(!r||h.isCodecSupportedInMp4(r,"video"))}),e.audioTracks&&(n=e.audioTracks.filter(function(e){return!e.audioCodec||h.isCodecSupportedInMp4(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),0<r.length){t=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r;for(var u=0;u<r.length;u++)if(r[u].bitrate===t){this._firstLevel=u,d.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(c.default.MANIFEST_PARSED,{levels:r,audioTracks:n,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:a,altAudio:n.some(function(e){return!!e.url})})}else this.hls.trigger(c.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(u.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))},enumerable:!0,configurable:!0}),u.prototype.setLevelInternal=function(e){var t=this._levels,r=this.hls;if(0<=e&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){d.logger.log("switching to level "+e);var n=t[this.currentLevelIndex=e];n.level=e,r.trigger(c.default.LEVEL_SWITCHING,n)}var i=t[e],o=i.details;if(!o||o.live){var a=i.urlId;r.trigger(c.default.LEVEL_LOADING,{url:i.url[a],level:e,id:a})}}else r.trigger(c.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(u.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(e){this._firstLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"startLevel",{get:function(){if(void 0!==this._startLevel)return this._startLevel;var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel},set:function(e){this._startLevel=e},enumerable:!0,configurable:!0}),u.prototype.onError=function(e){if(e.fatal)e.type===f.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,r=!1,n=!1;switch(e.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,n=!0;break;case f.ErrorDetails.LEVEL_LOAD_ERROR:case f.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,r=!0;break;case f.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,r=!0}void 0!==t&&this.recoverLevel(e,t,r,n)}},u.prototype.recoverLevel=function(e,t,r,n){var i,o,a,s=this,u=this.hls.config,l=e.details,c=this._levels[t];if(c.loadError++,c.fragmentError=n,r){if(!(this.levelRetryCount+1<=u.levelLoadingMaxRetry))return d.logger.error("level controller, cannot recover from "+l+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);o=Math.min(Math.pow(2,this.levelRetryCount)*u.levelLoadingRetryDelay,u.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return s.loadLevel()},o),e.levelRetry=!0,this.levelRetryCount++,d.logger.warn("level controller, "+l+", retry in "+o+" ms, current retry count is "+this.levelRetryCount)}(r||n)&&(1<(i=c.url.length)&&c.loadError<i?(c.urlId=(c.urlId+1)%i,c.details=void 0,d.logger.warn("level controller, "+l+" for level "+t+": switching to redundant URL-id "+c.urlId)):-1===this.manualLevelIndex?(a=0===t?this._levels.length-1:t-1,d.logger.warn("level controller, "+l+": switch to "+a),this.hls.nextAutoLevel=this.currentLevelIndex=a):n&&(d.logger.warn("level controller, "+l+": reload a fragment"),this.currentLevelIndex=null))},u.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var r=this._levels[t.level];void 0!==r&&(r.fragmentError=!1,r.loadError=0,this.levelRetryCount=0)}},u.prototype.onLevelLoaded=function(e){var t=this,r=e.level,n=e.details;if(r===this.currentLevelIndex){var i=this._levels[r];if(i.fragmentError||(i.loadError=0,this.levelRetryCount=0),n.live){var o=p.computeReloadInterval(i.details,n,e.stats.trequest);d.logger.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},o)}else this.clearTimer()}},u.prototype.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var n=-1,i=0;i<r.audioGroupIds.length;i++)if(r.audioGroupIds[i]===t){n=i;break}n!==r.urlId&&(r.urlId=n,this.startLoad())}},u.prototype.loadLevel=function(){if(d.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&0<e.url.length){var t=this.currentLevelIndex,r=e.urlId,n=e.url[r];d.logger.log("Attempt loading level index "+t+" with URL-id "+r),this.hls.trigger(c.default.LEVEL_LOADING,{url:n,level:t,id:r})}}},Object.defineProperty(u.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)},enumerable:!0,configurable:!0}),u);function u(e){var t=o.call(this,e,c.default.MANIFEST_LOADED,c.default.LEVEL_LOADED,c.default.AUDIO_TRACK_SWITCHED,c.default.FRAG_LOADED,c.default.ERROR)||this;return t.canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t}t.default=s},"./src/controller/level-helper.js":function(e,t,r){"use strict";(function(h){Object.defineProperty(t,"__esModule",{value:!0});var a=r("./src/utils/logger.js");function p(e,t,r){var n=e[t],i=e[r],o=i.startPTS;h.isFinite(o)?t<r?(n.duration=o-n.start,n.duration<0&&a.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(i.duration=n.start-o,i.duration<0&&a.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):i.start=t<r?n.start+n.duration:Math.max(n.start-i.duration,0)}function s(e,t,r,n,i,o){var a=r;if(h.isFinite(t.startPTS)){var s=Math.abs(t.startPTS-r);h.isFinite(t.deltaPTS)?t.deltaPTS=Math.max(s,t.deltaPTS):t.deltaPTS=s,a=Math.max(r,t.startPTS),r=Math.min(r,t.startPTS),n=Math.max(n,t.endPTS),i=Math.min(i,t.startDTS),o=Math.max(o,t.endDTS)}var u=r-t.start;t.start=t.startPTS=r,t.maxStartPTS=a,t.endPTS=n,t.startDTS=i,t.endDTS=o,t.duration=n-r;var l,c,d,f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;for(l=f-e.startSN,(c=e.fragments)[l]=t,d=l;0<d;d--)p(c,d,d-1);for(d=l;d<c.length-1;d++)p(c,d,d+1);return e.PTSKnown=!0,u}function u(e,t,r){if(e&&t)for(var n=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,o=t.startSN-e.startSN,a=n;a<=i;a++){var s=e.fragments[o+a],u=t.fragments[a];if(!s||!u)break;r(s,u,a)}}function l(e,t){var r=t.startSN-e.startSN,n=e.fragments,i=t.fragments;if(!(r<0||r>n.length))for(var o=0;o<i.length;o++)i[o].start+=n[r].start}t.addGroupId=function(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}},t.updatePTS=p,t.updateFragPTSDTS=s,t.mergeDetails=function(e,r){r.initSegment&&e.initSegment&&(r.initSegment=e.initSegment);var n,i=0;if(u(e,r,function(e,t){i=e.cc-t.cc,h.isFinite(e.startPTS)&&(t.start=t.startPTS=e.startPTS,t.endPTS=e.endPTS,t.duration=e.duration,t.backtracked=e.backtracked,t.dropped=e.dropped,n=t),r.PTSKnown=!0}),r.PTSKnown){if(i){a.logger.log("discontinuity sliding from playlist, take drift into account");for(var t=r.fragments,o=0;o<t.length;o++)t[o].cc+=i}n?s(r,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):l(e,r),r.PTSKnown=e.PTSKnown}},t.mergeSubtitlePlaylists=function(e,t,r){void 0===r&&(r=0);var n=-1;u(e,t,function(e,t,r){t.start=e.start,n=r});var i=t.fragments;if(n<0)i.forEach(function(e){e.start+=r});else for(var o=n+1;o<i.length;o++)i[o].start=i[o-1].start+i[o-1].duration},t.mapFragmentIntersection=u,t.adjustSliding=l,t.computeReloadInterval=function(e,t,r){var n=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),i=n/2;return e&&t.endSN===e.endSN&&(n=i),r&&(n=Math.max(i,n-(window.performance.now()-r))),Math.round(n)}}).call(this,r("./src/polyfills/number.js").Number)},"./src/controller/stream-controller.js":function(e,E,w){"use strict";(function(l){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(E,"__esModule",{value:!0});var i,p=w("./src/utils/binary-search.js"),f=w("./src/utils/buffer-helper.js"),h=w("./src/demux/demuxer.js"),m=w("./src/events.js"),r=w("./src/controller/fragment-tracker.js"),c=w("./src/loader/fragment.js"),t=w("./src/loader/playlist-loader.js"),d=w("./src/controller/level-helper.js"),o=w("./src/utils/time-ranges.js"),a=w("./src/errors.js"),g=w("./src/utils/logger.js"),v=w("./src/utils/discontinuities.js"),y=w("./src/controller/fragment-finders.js"),s=w("./src/controller/gap-controller.js"),_=w("./src/controller/base-stream-controller.js"),u=(i=_.default,e(b,i),b.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=r.startLevel;-1===n&&(n=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1}0<t&&-1===e&&(g.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=_.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=_.State.STOPPED},b.prototype.stopLoad=function(){this.forceStartLoad=!1,i.prototype.stopLoad.call(this)},b.prototype.doTick=function(){switch(this.state){case _.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case _.State.IDLE:this._doTickIdle();break;case _.State.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=_.State.IDLE);break;case _.State.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),r=this.retryDate;(!r||r<=t||this.media&&this.media.seeking)&&(g.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=_.State.IDLE);break;case _.State.ERROR:case _.State.STOPPED:case _.State.FRAG_LOADING:case _.State.PARSING:case _.State.PARSED:case _.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},b.prototype._doTickIdle=function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&t.startFragPrefetch)){var n;n=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,o=this.levels[i];if(o){var a,s=o.bitrate;a=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,a=Math.min(a,t.maxMaxBufferLength);var u=f.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,n,t.maxBufferHole),l=u.len;if(!(a<=l)){g.logger.trace("buffer length of "+l.toFixed(3)+" is below max of "+a.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var c=o.details;if(!c||c.live&&this.levelLastLoaded!==i)this.state=_.State.WAITING_LEVEL;else{if(this._streamEnded(u,c)){var d={};return this.altAudio&&(d.type="video"),this.hls.trigger(m.default.BUFFER_EOS,d),void(this.state=_.State.ENDED)}this._fetchPayloadOrEos(n,u,c)}}}}},b.prototype._fetchPayloadOrEos=function(e,t,r){var n=this.fragPrevious,i=this.level,o=r.fragments,a=o.length;if(0!==a){var s,u=o[0].start,l=o[a-1].start+o[a-1].duration,c=t.end;if(r.initSegment&&!r.initSegment.data)s=r.initSegment;else if(r.live){var d=this.config.initialLiveManifestSize;if(a<d)return void g.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+d);if(null===(s=this._ensureFragmentAtLivePoint(r,c,u,l,n,o,a)))return}else c<u&&(s=o[0]);(s=s||this._findFragment(u,n,a,o,c,l,r))&&(s.encrypted?(g.logger.log("Loading key for "+s.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+i),this._loadKey(s)):(g.logger.log("Loading "+s.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+i+", currentTime:"+e.toFixed(3)+",bufferEnd:"+c.toFixed(3)),this._loadFragment(s)))}},b.prototype._ensureFragmentAtLivePoint=function(e,t,r,n,i,o,a){var s,u=this.hls.config,l=this.media,c=void 0!==u.liveMaxLatencyDuration?u.liveMaxLatencyDuration:u.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-u.maxFragLookUpTolerance,n-c)){var d=this.liveSyncPosition=this.computeLivePosition(r,e);g.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3)),t=d,l&&l.readyState&&l.duration>d&&(l.currentTime=d),this.nextLoadPosition=d}if(e.PTSKnown&&n<t&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(i)if(e.hasProgramDateTime)g.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),s=y.findFragmentByPDT(o,i.endProgramDateTime,u.maxFragLookUpTolerance);else{var f=i.sn+1;if(f>=e.startSN&&f<=e.endSN){var h=o[f-e.startSN];i.cc===h.cc&&(s=h,g.logger.log("live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=p.default.search(o,function(e){return i.cc-e.cc}))&&g.logger.log("live playlist, switching playlist, load frag with same CC: "+s.sn)}s||(s=o[Math.min(a-1,Math.round(a/2))],g.logger.log("live playlist, switching playlist, unknown, load middle frag : "+s.sn))}return s},b.prototype._findFragment=function(e,t,r,n,i,o,a){var s,u=this.hls.config;if(i<o){var l=i>o-u.maxFragLookUpTolerance?0:u.maxFragLookUpTolerance;s=y.findFragmentByPTS(t,n,i,l)}else s=n[r-1];if(s){var c=s.sn-a.startSN,d=t&&s.level===t.level,f=n[c-1],h=n[1+c];if(t&&s.sn===t.sn)if(d&&!s.backtracked)if(s.sn<a.endSN){var p=t.deltaPTS;p&&p>u.maxBufferHole&&t.dropped&&c?(s=f,g.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(s=h,g.logger.log("SN just loaded, load next one: "+s.sn,s))}else s=null;else s.backtracked&&(h&&h.backtracked?(g.logger.warn("Already backtracked from fragment "+h.sn+", will not backtrack to fragment "+s.sn+". Loading fragment "+h.sn),s=h):(g.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),s.dropped=0,f?(s=f).backtracked=!0:c&&(s=null)))}return s},b.prototype._loadKey=function(e){this.state=_.State.KEY_LOADING,this.hls.trigger(m.default.KEY_LOADING,{frag:e})},b.prototype._loadFragment=function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,l.isFinite(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===r.FragmentState.NOT_LOADED||t===r.FragmentState.PARTIAL?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(m.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new h.default(this.hls,"main")),this.state=_.State.FRAG_LOADING):t===r.FragmentState.APPENDING&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},Object.defineProperty(b.prototype,"state",{get:function(){return this._state},set:function(e){if(this.state!==e){var t=this.state;this._state=e,g.logger.log("main stream:"+t+"->"+e),this.hls.trigger(m.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},enumerable:!0,configurable:!0}),b.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,t.default.LevelType.MAIN)},Object.defineProperty(b.prototype,"currentLevel",{get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextBufferedFrag",{get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null},enumerable:!0,configurable:!0}),b.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},Object.defineProperty(b.prototype,"nextLevel",{get:function(){var e=this.nextBufferedFrag;return e?e.level:-1},enumerable:!0,configurable:!0}),b.prototype._checkFragmentChanged=function(){var e,t,r=this.media;if(r&&r.readyState&&!1===r.seeking&&((t=r.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),f.BufferHelper.isBuffered(r,t)?e=this.getBufferedFrag(t):f.BufferHelper.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var n=e;if(n!==this.fragPlaying){this.hls.trigger(m.default.FRAG_CHANGED,{frag:n});var i=n.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(m.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=n}}},b.prototype.immediateLevelSwitch=function(){if(g.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,l.POSITIVE_INFINITY)},b.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.BufferHelper.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},b.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,r=void 0,n=void 0;if((t=this.getBufferedFrag(e.currentTime))&&1<t.startPTS&&this.flushMainBuffer(0,t.startPTS-1),e.paused)r=0;else{var i=this.hls.nextLoadLevel,o=this.levels[i],a=this.fragLastKbps;r=a&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*a)+1:0}if(n=(n=this.getBufferedFrag(e.currentTime+r))&&this.followingBufferedFrag(n)){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(n.maxStartPTS,l.POSITIVE_INFINITY)}}},b.prototype.flushMainBuffer=function(e,t){this.state=_.State.BUFFER_FLUSHING;var r={startOffset:e,endOffset:t};this.altAudio&&(r.type="video"),this.hls.trigger(m.default.BUFFER_FLUSHING,r)},b.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition),this.gapController=new s.default(r,t,this.fragmentTracker,this.hls)},b.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(g.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},b.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;l.isFinite(t)&&g.logger.log("media seeked to "+t.toFixed(3)),this.tick()},b.prototype.onManifestLoading=function(){g.logger.log("trigger BUFFER_RESET"),this.hls.trigger(m.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},b.prototype.onManifestParsed=function(e){var t,r=!1,n=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(r=!0),-1!==t.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=r&&n,this.audioCodecSwitch&&g.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},b.prototype.onLevelLoaded=function(e){var t=e.details,r=e.level,n=this.levels[this.levelLastLoaded],i=this.levels[r],o=t.totalduration,a=0;if(g.logger.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live){var s=i.details;s&&0<t.fragments.length?(d.mergeDetails(s,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,s),t.PTSKnown&&l.isFinite(a)?g.logger.log("live playlist sliding:"+a.toFixed(3)):(g.logger.log("live playlist - outdated PTS, unknown sliding"),v.alignStream(this.fragPrevious,n,t))):(g.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,v.alignStream(this.fragPrevious,n,t))}else t.PTSKnown=!1;if(i.details=t,this.levelLastLoaded=r,this.hls.trigger(m.default.LEVEL_UPDATED,{details:t,level:r}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var u=t.startTimeOffset;l.isFinite(u)?(u<0&&(g.logger.log("negative start time offset "+u+", count from end of last fragment"),u=a+o+u),g.logger.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u):t.live?(this.startPosition=this.computeLivePosition(a,t),g.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===_.State.WAITING_LEVEL&&(this.state=_.State.IDLE),this.tick()},b.prototype.onKeyLoaded=function(){this.state===_.State.KEY_LOADING&&(this.state=_.State.IDLE,this.tick())},b.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=this.hls,n=this.levels,i=this.media,o=e.frag;if(this.state===_.State.FRAG_LOADING&&t&&"main"===o.type&&o.level===t.level&&o.sn===t.sn){var a=e.stats,s=n[t.level],u=s.details;if(this.bitrateTest=!1,this.stats=a,g.logger.log("Loaded "+t.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+t.level),o.bitrateTest&&r.nextLoadLevel)this.state=_.State.IDLE,this.startFragRequested=!1,a.tparsed=a.tbuffered=window.performance.now(),r.trigger(m.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else if("initSegment"===o.sn)this.state=_.State.IDLE,a.tparsed=a.tbuffered=window.performance.now(),u.initSegment.data=e.payload,r.trigger(m.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),this.tick();else{g.logger.log("Parsing "+t.sn+" of ["+u.startSN+" ,"+u.endSN+"],level "+t.level+", cc "+t.cc),this.state=_.State.PARSING,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o}));var l=!(i&&i.seeking)&&(u.PTSKnown||!u.live),c=u.initSegment?u.initSegment.data:[],d=this._getAudioCodec(s);(this.demuxer=this.demuxer||new h.default(this.hls,"main")).push(e.payload,c,d,s.videoCodec,t,u.totalduration,l)}}this.fragLoadError=0},b.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===_.State.PARSING){var n=e.tracks,i=void 0,o=void 0;if(n.audio&&this.altAudio&&delete n.audio,o=n.audio){var a=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(g.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==o.metadata.channelCount&&-1===s.indexOf("firefox")&&(a="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==o.container&&(a="mp4a.40.2",g.logger.log("Android: force audio codec to "+a)),o.levelCodec=a,o.id=e.id}for(i in(o=n.video)&&(o.levelCodec=this.levels[this.level].videoCodec,o.id=e.id),this.hls.trigger(m.default.BUFFER_CODECS,n),n){o=n[i],g.logger.log("main track:"+i+",container:"+o.container+",codecs[level/parsed]=["+o.levelCodec+"/"+o.codec+"]");var u=o.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(m.default.BUFFER_APPENDING,{type:i,data:u,parent:"main",content:"initSegment"}))}this.tick()}},b.prototype.onFragParsingData=function(t){var r=this,e=this.fragCurrent,n=t.frag;if(e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&("audio"!==t.type||!this.altAudio)&&this.state===_.State.PARSING){var i=this.levels[this.level],o=e;if(l.isFinite(t.endPTS)||(t.endPTS=t.startPTS+e.duration,t.endDTS=t.startDTS+e.duration),!0===t.hasAudio&&o.addElementaryStream(c.default.ElementaryStreamTypes.AUDIO),!0===t.hasVideo&&o.addElementaryStream(c.default.ElementaryStreamTypes.VIDEO),g.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(o.dropped=t.dropped,o.dropped)if(o.backtracked)g.logger.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var a=i.details;if(!a||o.sn!==a.startSN)return g.logger.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=_.State.IDLE,this.fragPrevious=o,void this.tick();g.logger.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var s=d.updateFragPTSDTS(i.details,o,t.startPTS,t.endPTS,t.startDTS,t.endDTS),u=this.hls;u.trigger(m.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:s,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(e){e&&e.length&&r.state===_.State.PARSING&&(r.appended=!0,r.pendingBuffering=!0,u.trigger(m.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"}))}),this.tick()}},b.prototype.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===_.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=_.State.PARSED,this._checkAppendedParsed())},b.prototype.onAudioTrackSwitching=function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){g.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n.loader&&(g.logger.log("switching to main audio track, cancel main fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=_.State.IDLE}var i=this.hls;i.trigger(m.default.BUFFER_FLUSHING,{startOffset:0,endOffset:l.POSITIVE_INFINITY,type:"audio"}),i.trigger(m.default.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}},b.prototype.onAudioTrackSwitched=function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(g.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=r,this.tick()},b.prototype.onBufferCreated=function(e){var t,r,n=e.tracks,i=!1;for(var o in n){var a=n[o];"main"===a.id?(t=a,"video"===(r=o)&&(this.videoBuffer=n[o].buffer)):i=!0}i&&t?(g.logger.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},b.prototype.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==_.State.PARSING&&t!==_.State.PARSED||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},b.prototype._checkAppendedParsed=function(){if(!(this.state!==_.State.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;g.logger.log("main buffered : "+o.default.toString(t.buffered)),this.fragPrevious=e;var r=this.stats;r.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*r.total/(r.tbuffered-r.tfirst)),this.hls.trigger(m.default.FRAG_BUFFERED,{stats:r,frag:e,id:"main"}),this.state=_.State.IDLE}this.tick()}},b.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r=!!this.media&&f.BufferHelper.isBuffered(this.media,this.media.currentTime)&&f.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);g.logger.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=window.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=_.State.FRAG_LOADING_WAITING_RETRY}else g.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=_.State.ERROR;break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==_.State.ERROR&&(e.fatal?(this.state=_.State.ERROR,g.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==_.State.WAITING_LEVEL||(this.state=_.State.IDLE));break;case a.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==_.State.PARSING&&this.state!==_.State.PARSED||(r?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=_.State.IDLE):(g.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,l.POSITIVE_INFINITY)))}}},b.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,g.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},b.prototype._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},b.prototype.onFragLoadEmergencyAborted=function(){this.state=_.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},b.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(c.default.ElementaryStreamTypes.VIDEO,e.buffered),this.state=_.State.IDLE,this.fragPrevious=null},b.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},b.prototype.computeLivePosition=function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)},b.prototype._seekToStartPos=function(){var e=this.media,t=e.currentTime,r=e.seeking?t:this.startPosition;t!==r&&(g.logger.log("target start position not buffered, seek to buffered.start(0) "+r+" from current time "+t+" "),e.currentTime=r)},b.prototype._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(g.logger.log("swapping playlist audio codec"),t=t&&(-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},Object.defineProperty(b.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e},enumerable:!0,configurable:!0}),b);function b(e,t){var r=i.call(this,e,m.default.MEDIA_ATTACHED,m.default.MEDIA_DETACHING,m.default.MANIFEST_LOADING,m.default.MANIFEST_PARSED,m.default.LEVEL_LOADED,m.default.KEY_LOADED,m.default.FRAG_LOADED,m.default.FRAG_LOAD_EMERGENCY_ABORTED,m.default.FRAG_PARSING_INIT_SEGMENT,m.default.FRAG_PARSING_DATA,m.default.FRAG_PARSED,m.default.ERROR,m.default.AUDIO_TRACK_SWITCHING,m.default.AUDIO_TRACK_SWITCHED,m.default.BUFFER_CREATED,m.default.BUFFER_APPENDED,m.default.BUFFER_FLUSHED)||this;return r.fragmentTracker=t,r.config=e.config,r.audioCodecSwap=!1,r._state=_.State.STOPPED,r.stallReported=!1,r.gapController=null,r}E.default=u}).call(this,w("./src/polyfills/number.js").Number)},"./src/controller/subtitle-stream-controller.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,v=r("./src/events.js"),y=r("./src/utils/logger.js"),a=r("./src/crypt/decrypter.js"),_=r("./src/utils/buffer-helper.js"),b=r("./src/controller/fragment-finders.js"),E=r("./src/controller/fragment-tracker.js"),w=r("./src/controller/base-stream-controller.js"),s=r("./src/controller/level-helper.js"),u=window.performance,l=(o=w.default,i(c,o),c.prototype.onSubtitleFragProcessed=function(e){var t=e.frag,r=e.success;if(this.fragPrevious=t,this.state=w.State.IDLE,r){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var i,o=t.start,a=0;a<n.length;a++)if(o>=n[a].start&&o<=n[a].end){i=n[a];break}var s=t.start+t.duration;i?i.end=s:(i={start:o,end:s},n.push(i))}}},c.prototype.onMediaAttached=function(e){var t=e.media;(this.media=t).addEventListener("seeking",this._onMediaSeeking),this.state=w.State.IDLE},c.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=w.State.STOPPED},c.prototype.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=w.State.IDLE)},c.prototype.onSubtitleTracksUpdated=function(e){var t=this;y.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})},c.prototype.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},c.prototype.onSubtitleTrackLoaded=function(e){var t=e.id,r=e.details,n=this.currentTrackId,i=this.tracks,o=i[n];t>=i.length||t!==n||!o||(r.live&&s.mergeSubtitlePlaylists(o.details,r,this.lastAVStart),o.details=r,this.setInterval(500))},c.prototype.onKeyLoaded=function(){this.state===w.State.KEY_LOADING&&(this.state=w.State.IDLE)},c.prototype.onFragLoaded=function(e){var t=this.fragCurrent,r=e.frag.decryptdata,n=e.frag,i=this.hls;if(this.state===w.State.FRAG_LOADING&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&0<e.payload.byteLength&&r&&r.key&&"AES-128"===r.method){var o=u.now();this.decrypter.decrypt(e.payload,r.key.buffer,r.iv.buffer,function(e){var t=u.now();i.trigger(v.default.FRAG_DECRYPTED,{frag:n,payload:e,stats:{tstart:o,tdecrypt:t}})})}},c.prototype.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},c.prototype.doTick=function(){if(this.media)switch(this.state){case w.State.IDLE:var e=this.config,t=this.currentTrackId,r=this.fragmentTracker,n=this.media,i=this.tracks;if(!i||!i[t]||!i[t].details)break;var o=e.maxBufferHole,a=e.maxFragLookUpTolerance,s=Math.min(e.maxBufferLength,e.maxMaxBufferLength),u=_.BufferHelper.bufferedInfo(this._getBuffered(),n.currentTime,o),l=u.end,c=u.len,d=i[t].details,f=d.fragments,h=f.length,p=f[h-1].start+f[h-1].duration;if(s<c)return;var m=void 0,g=this.fragPrevious;(m=l<p?(g&&d.hasProgramDateTime&&(m=b.findFragmentByPDT(f,g.endProgramDateTime,a)),m||b.findFragmentByPTS(g,f,l,a)):f[h-1])&&m.encrypted?(y.logger.log("Loading key for "+m.sn),this.state=w.State.KEY_LOADING,this.hls.trigger(v.default.KEY_LOADING,{frag:m})):m&&r.getState(m)===E.FragmentState.NOT_LOADED&&(this.fragCurrent=m,this.state=w.State.FRAG_LOADING,this.hls.trigger(v.default.FRAG_LOADING,{frag:m}))}else this.state=w.State.IDLE},c.prototype.stopLoad=function(){this.lastAVStart=0,o.prototype.stopLoad.call(this)},c.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},c.prototype.onMediaSeeking=function(){this.fragPrevious=null},c);function c(e,t){var r=o.call(this,e,v.default.MEDIA_ATTACHED,v.default.MEDIA_DETACHING,v.default.ERROR,v.default.KEY_LOADED,v.default.FRAG_LOADED,v.default.SUBTITLE_TRACKS_UPDATED,v.default.SUBTITLE_TRACK_SWITCH,v.default.SUBTITLE_TRACK_LOADED,v.default.SUBTITLE_FRAG_PROCESSED,v.default.LEVEL_UPDATED)||this;return r.fragmentTracker=t,r.config=e.config,r.state=w.State.STOPPED,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new a.default(e,e.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(r),r}t.SubtitleStreamController=l},"./src/controller/subtitle-track-controller.js":function(e,d,f){"use strict";(function(n){var i,e=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(d,"__esModule",{value:!0});var r,o=f("./src/events.js"),t=f("./src/event-handler.js"),u=f("./src/utils/logger.js"),l=f("./src/controller/level-helper.js"),a=(r=t.default,e(s,r),s.prototype.destroy=function(){t.default.prototype.destroy.call(this)},s.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},s.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},s.prototype.onManifestLoaded=function(e){var t=this,r=e.subtitles||[];this.tracks=r,this.hls.trigger(o.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:r}),r.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},s.prototype.onSubtitleTrackLoaded=function(e){var t=this,r=e.id,n=e.details,i=this.trackId,o=this.tracks,a=o[i];if(r>=o.length||r!==i||!a||this.stopped)this._clearReloadTimer();else if(u.logger.log("subtitle track "+r+" loaded"),n.live){var s=l.computeReloadInterval(a.details,n,e.stats.trequest);u.logger.log("Reloading live subtitle playlist in "+s+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},s)}else this._clearReloadTimer()},s.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},s.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(s.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))},enumerable:!0,configurable:!0}),s.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},s.prototype._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,r=this.hls,n=t[e];e<0||!n||n.details&&!n.details.live||(u.logger.log("Loading subtitle track "+e),r.trigger(o.default.SUBTITLE_TRACK_LOADING,{url:n.url,id:e}))},s.prototype._toggleTrackModes=function(e){var t=this.media,r=this.subtitleDisplay,n=this.trackId;if(t){var i=c(t.textTracks);if(-1===e)[].slice.call(i).forEach(function(e){e.mode="disabled"});else{var o=i[n];o&&(o.mode="disabled")}var a=i[e];a&&(a.mode=r?"showing":"hidden")}},s.prototype._setSubtitleTrackInternal=function(e){var t=this.hls,r=this.tracks;!n.isFinite(e)||e<-1||e>=r.length||(this.trackId=e,u.logger.log("Switching to subtitle track "+e),t.trigger(o.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},s.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=c(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack=e}},s);function s(e){var t=r.call(this,e,o.default.MEDIA_ATTACHED,o.default.MEDIA_DETACHING,o.default.MANIFEST_LOADED,o.default.SUBTITLE_TRACK_LOADED)||this;return t.tracks=[],t.trackId=-1,t.media=null,t.stopped=!0,t.subtitleDisplay=!0,t}function c(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];"subtitles"===n.kind&&n.label&&t.push(e[r])}return t}d.default=a}).call(this,f("./src/polyfills/number.js").Number)},"./src/controller/timeline-controller.js":function(e,h,p){"use strict";(function(a){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(h,"__esModule",{value:!0});var s=p("./src/events.js"),t=p("./src/event-handler.js"),i=p("./src/utils/cea-608-parser.js"),o=p("./src/utils/output-filter.js"),u=p("./src/utils/webvtt-parser.js"),l=p("./src/utils/logger.js"),c=p("./src/utils/texttrack-utils.js");var d,r=(d=t.default,e(f,d),f.prototype.addCues=function(e,t,r,n){for(var i,o,a,s,u=this.cueRanges,l=!1,c=u.length;c--;){var d=u[c],f=(i=d[0],o=d[1],a=t,s=r,Math.min(o,s)-Math.max(i,a));if(0<=f&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],r),l=!0,.5<f/(r-t)))return}l||u.push([t,r]),this.Cues.newCue(this.captionsTracks[e],t,r,n)},f.prototype.onInitPtsFound=function(e){var t=this;if("main"===e.id&&(this.initPTS[e.frag.cc]=e.initPTS),this.unparsedVttFrags.length){var r=this.unparsedVttFrags;this.unparsedVttFrags=[],r.forEach(function(e){t.onFragLoaded(e)})}},f.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var n=t.textTracks[r];if(n[e])return n}return null},f.prototype.createCaptionsTrack=function(e){var t=this.captionsProperties[e],r=t.label,n=t.languageCode,i=this.captionsTracks;if(!i[e]){var o=this.getExistingTrack(e);if(o)i[e]=o,c.clearCurrentCues(i[e]),c.sendAddTrackEvent(i[e],this.media);else{var a=this.createTextTrack("captions",r,n);a&&(a[e]=!0,i[e]=a)}}},f.prototype.createTextTrack=function(e,t,r){var n=this.media;if(n)return n.addTextTrack(e,t,r)},f.prototype.destroy=function(){t.default.prototype.destroy.call(this)},f.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},f.prototype.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){c.clearCurrentCues(t[e]),delete t[e]})},f.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},f.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)c.clearCurrentCues(t[r])}},f.prototype.onManifestLoaded=function(e){var s=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var u=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,t){var r,n,i;if(t<u.length){for(var o=null,a=0;a<u.length;a++)if(n=u[a],i=e,n&&n.label===i.name&&!n.textTrack1&&!n.textTrack2){o=u[a];break}o&&(r=o)}r=r||s.createTextTrack("subtitles",e.name,e.lang),e.default?r.mode=s.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",s.textTracks.push(r)})}},f.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},f.prototype.onFragLoaded=function(e){var t=e.frag,r=e.payload;if("main"===t.type){var n=t.sn;if(n!==this.lastSn+1){var i=this.cea608Parser;i&&i.reset()}this.lastSn=n}else if("subtitle"===t.type)if(r.byteLength){if(!a.isFinite(this.initPTS[t.cc]))return this.unparsedVttFrags.push(e),void(this.initPTS.length&&this.hls.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var o=t.decryptdata;null!=o&&null!=o.key&&"AES-128"===o.method||this._parseVTTs(t,r)}else this.hls.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},f.prototype._parseVTTs=function(t,e){var r=this.vttCCs;r[t.cc]||(r[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var i=this.textTracks,o=this.hls;u.default.parse(e,this.initPTS[t.cc],r,t.cc,function(e){var n=i[t.level];"disabled"!==n.mode?(e.forEach(function(t){if(!n.cues.getCueById(t.id))try{n.addCue(t)}catch(e){var r=new window.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,n.addCue(r)}}),o.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})):o.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},function(e){l.logger.log("Failed to parse VTT cue: "+e),o.trigger(s.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},f.prototype.onFragDecrypted=function(e){var t=e.payload,r=e.frag;if("subtitle"===r.type){if(!a.isFinite(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(r,t)}},f.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var r=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,r)}},f.prototype.extractCea608Data=function(e){for(var t,r,n,i=31&e[0],o=2,a=[],s=0;s<i;s++)t=e[o++],r=127&e[o++],n=127&e[o++],0==r&&0==n||0!=(4&t)&&0==(3&t)&&(a.push(r),a.push(n));return a},f);function f(e){var t=d.call(this,e,s.default.MEDIA_ATTACHING,s.default.MEDIA_DETACHING,s.default.FRAG_PARSING_USERDATA,s.default.FRAG_DECRYPTED,s.default.MANIFEST_LOADING,s.default.MANIFEST_LOADED,s.default.FRAG_LOADED,s.default.LEVEL_SWITCHING,s.default.INIT_PTS_FOUND)||this;if(t.hls=e,t.config=e.config,t.enabled=!0,t.Cues=e.config.cueHandler,t.textTracks=[],t.tracks=[],t.unparsedVttFrags=[],t.initPTS=[],t.cueRanges=[],t.captionsTracks={},t.captionsProperties={textTrack1:{label:t.config.captionsTextTrack1Label,languageCode:t.config.captionsTextTrack1LanguageCode},textTrack2:{label:t.config.captionsTextTrack2Label,languageCode:t.config.captionsTextTrack2LanguageCode}},t.config.enableCEA708Captions){var r=new o.default(t,"textTrack1"),n=new o.default(t,"textTrack2");t.cea608Parser=new i.default(0,r,n)}return t}h.default=r}).call(this,p("./src/polyfills/number.js").Number)},"./src/crypt/aes-crypto.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(i.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},i);function i(e,t){this.subtle=e,this.aesIV=t}t.default=n},"./src/crypt/aes-decryptor.js":function(e,t,r){"use strict";function L(e){var t=e.byteLength,r=t&&new DataView(e).getUint8(t-1);return r?e.slice(0,t-r):e}Object.defineProperty(t,"__esModule",{value:!0}),t.removePadding=L;var n=(i.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),n=0;n<4;n++)r[n]=t.getUint32(4*n);return r},i.prototype.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],o=r[2],a=r[3],s=this.invSubMix,u=s[0],l=s[1],c=s[2],d=s[3],f=new Uint32Array(256),h=0,p=0,m=0;for(m=0;m<256;m++)f[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99;var v=f[t[e[h]=g]=h],y=f[v],_=f[y],b=257*f[g]^16843008*g;n[h]=b<<24|b>>>8,i[h]=b<<16|b>>>16,o[h]=b<<8|b>>>24,a[h]=b,b=16843009*_^65537*y^257*v^16843008*h,u[g]=b<<24|b>>>8,l[g]=b<<16|b>>>16,c[g]=b<<8|b>>>24,d[g]=b,h?(h=v^f[f[f[_^v]]],p^=f[f[p]]):h=p=1}},i.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<t.length&&r;)r=t[n]===this.key[n],n++;if(!r){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o,a,s,u,l=this.ksRows=4*(i+6+1),c=this.keySchedule=new Uint32Array(l),d=this.invKeySchedule=new Uint32Array(l),f=this.sBox,h=this.rcon,p=this.invSubMix,m=p[0],g=p[1],v=p[2],y=p[3];for(o=0;o<l;o++)o<i?s=c[o]=t[o]:(u=s,o%i==0?(u=f[(u=u<<8|u>>>24)>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u],u^=h[o/i|0]<<24):6<i&&o%i==4&&(u=f[u>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u]),c[o]=s=(c[o-i]^u)>>>0);for(a=0;a<l;a++)o=l-a,u=3&a?c[o]:c[o-4],d[a]=a<4||o<=4?u:m[f[u>>>24]]^g[f[u>>>16&255]]^v[f[u>>>8&255]]^y[f[255&u]],d[a]=d[a]>>>0}},i.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},i.prototype.decrypt=function(e,t,r,n){for(var i,o,a,s,u,l,c,d,f,h,p,m,g,v,y=this.keySize+6,_=this.invKeySchedule,b=this.invSBox,E=this.invSubMix,w=E[0],A=E[1],T=E[2],S=E[3],x=this.uint8ArrayToUint32Array_(r),M=x[0],R=x[1],O=x[2],P=x[3],C=new Int32Array(e),D=new Int32Array(C.length),I=this.networkToHostOrderSwap;t<C.length;){for(f=I(C[t]),h=I(C[t+1]),p=I(C[t+2]),m=I(C[t+3]),u=f^_[0],l=m^_[1],c=p^_[2],d=h^_[3],g=4,v=1;v<y;v++)i=w[u>>>24]^A[l>>16&255]^T[c>>8&255]^S[255&d]^_[g],o=w[l>>>24]^A[c>>16&255]^T[d>>8&255]^S[255&u]^_[g+1],a=w[c>>>24]^A[d>>16&255]^T[u>>8&255]^S[255&l]^_[g+2],s=w[d>>>24]^A[u>>16&255]^T[l>>8&255]^S[255&c]^_[g+3],u=i,l=o,c=a,d=s,g+=4;i=b[u>>>24]<<24^b[l>>16&255]<<16^b[c>>8&255]<<8^b[255&d]^_[g],o=b[l>>>24]<<24^b[c>>16&255]<<16^b[d>>8&255]<<8^b[255&u]^_[g+1],a=b[c>>>24]<<24^b[d>>16&255]<<16^b[u>>8&255]<<8^b[255&l]^_[g+2],s=b[d>>>24]<<24^b[u>>16&255]<<16^b[l>>8&255]<<8^b[255&c]^_[g+3],g+=3,D[t]=I(i^M),D[t+1]=I(s^R),D[t+2]=I(a^O),D[t+3]=I(o^P),M=f,R=h,O=p,P=m,t+=4}return n?L(D.buffer):D.buffer},i.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},i);function i(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}t.default=n},"./src/crypt/decrypter.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("./src/crypt/aes-crypto.js"),u=r("./src/crypt/fast-aes-key.js"),l=r("./src/crypt/aes-decryptor.js"),o=r("./src/errors.js"),c=r("./src/utils/logger.js"),a=r("./src/events.js"),d=r("./src/utils/get-self-scope.js").getSelfScope(),n=(i.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},i.prototype.decrypt=function(t,r,n,i){var o=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(c.logger.log("JS AES decrypt"),this.logEnabled=!1);var e=this.decryptor;e||(this.decryptor=e=new l.default),e.expandKey(r),i(e.decrypt(t,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(c.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var a=this.subtle;this.key!==r&&(this.key=r,this.fastAesKey=new u.default(a,r)),this.fastAesKey.expandKey().then(function(e){new s.default(a,n).decrypt(t,e).catch(function(e){o.onWebCryptoError(e,t,r,n,i)}).then(function(e){i(e)})}).catch(function(e){o.onWebCryptoError(e,t,r,n,i)})}},i.prototype.onWebCryptoError=function(e,t,r,n,i){this.config.enableSoftwareAES?(c.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,n,i)):(c.logger.error("decrypting error : "+e.message),this.observer.trigger(a.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},i.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},i);function i(e,t,r){var n=(void 0===r?{}:r).removePKCS7Padding,i=void 0===n||n;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=i)try{var o=d.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}t.default=n},"./src/crypt/fast-aes-key.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(i.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},i);function i(e,t){this.subtle=e,this.key=t}t.default=n},"./src/demux/aacdemuxer.js":function(e,r,n){"use strict";(function(p){Object.defineProperty(r,"__esModule",{value:!0});var m=n("./src/demux/adts.js"),g=n("./src/utils/logger.js"),v=n("./src/demux/id3.js"),e=(t.prototype.resetInitSegment=function(e,t,r,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(e){if(!e)return!1;for(var t=(v.default.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(m.probe(e,t))return g.logger.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(e,t,r,n){for(var i=this._audioTrack,o=v.default.getID3Data(e,0)||[],a=v.default.getTimeStamp(o),s=p.isFinite(a)?90*a:9e4*t,u=0,l=s,c=e.length,d=o.length,f=[{pts:l,dts:l,data:o}];d<c-1;)if(m.isHeader(e,d)&&d+5<c){m.initTrackConfig(i,this.observer,e,d,i.manifestCodec);var h=m.appendFrame(i,e,d,s,u);if(!h){g.logger.log("Unable to parse AAC frame");break}d+=h.length,l=h.sample.pts,u++}else v.default.isHeader(e,d)?(o=v.default.getID3Data(e,d),f.push({pts:l,dts:l,data:o}),d+=o.length):d++;this.remuxer.remux(i,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,r,n)},t.prototype.destroy=function(){},t);function t(e,t,r){this.observer=e,this.config=r,this.remuxer=t}r.default=e}).call(this,n("./src/polyfills/number.js").Number)},"./src/demux/adts.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=r("./src/utils/logger.js"),h=r("./src/errors.js"),p=r("./src/events.js");function a(e,t,r,n){var i,o,a,s,u,l=navigator.userAgent.toLowerCase(),c=n,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(i=1+((192&t[r+2])>>>6),o=(60&t[r+2])>>>2,!(d.length-1<o))return s=(1&t[r+2])<<2,s|=(192&t[r+3])>>>6,f.logger.log("manifest codec:"+n+",ADTS data:type:"+i+",sampleingIndex:"+o+"["+d[o]+"Hz],channelConfig:"+s),a=/firefox/i.test(l)?6<=o?(i=5,u=new Array(4),o-3):(i=2,u=new Array(2),o):-1!==l.indexOf("android")?(i=2,u=new Array(2),o):(i=5,u=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&6<=o?o-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(6<=o&&1==s||/vivaldi/i.test(l))||!n&&1==s)&&(i=2,u=new Array(2)),o)),u[0]=i<<3,u[0]|=(14&o)>>1,u[1]|=(1&o)<<7,u[1]|=s<<3,5===i&&(u[1]|=(14&a)>>1,u[2]=(1&a)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:d[o],channelCount:s,codec:"mp4a.40."+i,manifestCodec:c};e.trigger(p.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o})}function i(e,t){return 255===e[t]&&240==(246&e[t+1])}function u(e,t){return 1&e[t+1]?7:9}function l(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function c(e){return 9216e4/e}function d(e,t,r,n,i){var o,a,s=e.length;if(o=u(e,t),a=l(e,t),0<(a-=o)&&t+o+a<=s)return{headerLength:o,frameLength:a,stamp:r+n*i}}t.getAudioConfig=a,t.isHeaderPattern=i,t.getHeaderLength=u,t.getFullFrameLength=l,t.isHeader=function(e,t){return!!(t+1<e.length&&i(e,t))},t.probe=function(e,t){if(t+1<e.length&&i(e,t)){var r=u(e,t);t+5<e.length&&(r=l(e,t));var n=t+r;if(n===e.length||n+1<e.length&&i(e,n))return!0}return!1},t.initTrackConfig=function(e,t,r,n,i){if(!e.samplerate){var o=a(t,r,n,i);e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,f.logger.log("parsed codec:"+e.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount)}},t.getFrameDuration=c,t.parseFrameHeader=d,t.appendFrame=function(e,t,r,n,i){var o=d(t,r,n,i,c(e.samplerate));if(o){var a=o.stamp,s=o.headerLength,u=o.frameLength,l={unit:t.subarray(r+s,r+s+u),pts:a,dts:a};return e.samples.push(l),e.len+=u,{sample:l,length:u+s}}}},"./src/demux/demuxer-inline.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m,A=r("./src/events.js"),T=r("./src/errors.js"),g=r("./src/crypt/decrypter.js"),S=r("./src/demux/aacdemuxer.js"),x=r("./src/demux/mp4demuxer.js"),M=r("./src/demux/tsdemuxer.js"),R=r("./src/demux/mp3demuxer.js"),O=r("./src/remux/mp4-remuxer.js"),P=r("./src/remux/passthrough-remuxer.js"),n=r("./src/utils/get-self-scope.js"),i=r("./src/utils/logger.js"),o=n.getSelfScope();try{m=o.performance.now.bind(o.performance)}catch(e){i.logger.debug("Unable to use Performance API on this environment"),m=o.Date.now}var a=(s.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},s.prototype.push=function(e,r,n,i,o,a,s,u,l,c,d,f){var h=this;if(0<e.byteLength&&null!=r&&null!=r.key&&"AES-128"===r.method){var t=this.decrypter;null==t&&(t=this.decrypter=new g.default(this.observer,this.config));var p=m();t.decrypt(e,r.key.buffer,r.iv.buffer,function(e){var t=m();h.observer.trigger(A.default.FRAG_DECRYPTED,{stats:{tstart:p,tdecrypt:t}}),h.pushDecrypted(new Uint8Array(e),r,new Uint8Array(n),i,o,a,s,u,l,c,d,f)})}else this.pushDecrypted(new Uint8Array(e),r,new Uint8Array(n),i,o,a,s,u,l,c,d,f)},s.prototype.pushDecrypted=function(e,t,r,n,i,o,a,s,u,l,c,d){var f=this.demuxer;if(!f||(a||s)&&!this.probe(e)){for(var h=this.observer,p=this.typeSupported,m=this.config,g=[{demux:M.default,remux:O.default},{demux:x.default,remux:P.default},{demux:S.default,remux:O.default},{demux:R.default,remux:O.default}],v=0,y=g.length;v<y;v++){var _=g[v],b=_.demux.probe;if(b(e)){var E=this.remuxer=new _.remux(h,m,p,this.vendor);f=new _.demux(h,E,m,p),this.probe=b;break}}if(!f)return void h.trigger(A.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=f}var w=this.remuxer;(a||s)&&(f.resetInitSegment(r,n,i,l),w.resetInitSegment()),a&&(f.resetTimeStamp(d),w.resetTimeStamp(d)),"function"==typeof f.setDecryptData&&f.setDecryptData(t),f.append(e,o,u,c)},s);function s(e,t,r,n){this.observer=e,this.typeSupported=t,this.config=r,this.vendor=n}t.default=a},"./src/demux/demuxer-worker.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("./src/demux/demuxer-inline.js"),s=r("./src/events.js"),u=r("./src/utils/logger.js"),l=r("./node_modules/node-libs-browser/node_modules/events/events.js");t.default=function(i){var n=new l.EventEmitter;n.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];n.emit.apply(n,[e,e].concat(t))},n.off=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];n.removeListener.apply(n,[e].concat(t))};function o(e,t){i.postMessage({event:e,data:t})}i.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":var r=JSON.parse(t.config);i.demuxer=new a.default(n,t.typeSupported,r,t.vendor),u.enableLogs(r.debug),o("init",null);break;case"demux":i.demuxer.push(t.data,t.decryptdata,t.initSegment,t.audioCodec,t.videoCodec,t.timeOffset,t.discontinuity,t.trackSwitch,t.contiguous,t.duration,t.accurateTimeOffset,t.defaultInitPTS)}}),n.on(s.default.FRAG_DECRYPTED,o),n.on(s.default.FRAG_PARSING_INIT_SEGMENT,o),n.on(s.default.FRAG_PARSED,o),n.on(s.default.ERROR,o),n.on(s.default.FRAG_PARSING_METADATA,o),n.on(s.default.FRAG_PARSING_USERDATA,o),n.on(s.default.INIT_PTS_FOUND,o),n.on(s.default.FRAG_PARSING_DATA,function(e,t){var r=[],n={event:e,data:t};t.data1&&(n.data1=t.data1.buffer,r.push(t.data1.buffer),delete t.data1),t.data2&&(n.data2=t.data2.buffer,r.push(t.data2.buffer),delete t.data2),i.postMessage(n,r)})}},"./src/demux/demuxer.js":function(e,i,o){"use strict";(function(v){Object.defineProperty(i,"__esModule",{value:!0});var l=o("./node_modules/webworkify-webpack/index.js"),c=o("./src/events.js"),d=o("./src/demux/demuxer-inline.js"),y=o("./src/utils/logger.js"),f=o("./src/errors.js"),e=o("./src/utils/mediasource-helper.js"),t=o("./src/utils/get-self-scope.js"),h=o("./src/observer.js"),p=t.getSelfScope(),m=e.getMediaSource(),r=(n.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)},n.prototype.push=function(e,t,r,n,i,o,a,s){var u=this.w,l=v.isFinite(i.startPTS)?i.startPTS:i.start,c=i.decryptdata,d=this.frag,f=!(d&&i.cc===d.cc),h=!(d&&i.level===d.level),p=d&&i.sn===d.sn+1,m=!h&&p;if(f&&y.logger.log(this.id+":discontinuity detected"),h&&y.logger.log(this.id+":switch detected"),this.frag=i,u)u.postMessage({cmd:"demux",data:e,decryptdata:c,initSegment:t,audioCodec:r,videoCodec:n,timeOffset:l,discontinuity:f,trackSwitch:h,contiguous:m,duration:o,accurateTimeOffset:a,defaultInitPTS:s},e instanceof ArrayBuffer?[e]:[]);else{var g=this.demuxer;g&&g.push(e,c,t,r,n,l,f,h,m,o,a,s)}},n.prototype.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":p.URL.revokeObjectURL(this.w.objectURL);break;case c.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},n);function n(r,e){var n=this;this.hls=r,this.id=e;function t(e,t){(t=t||{}).frag=n.frag,t.id=n.id,r.trigger(e,t)}var i=this.observer=new h.Observer,o=r.config;i.on(c.default.FRAG_DECRYPTED,t),i.on(c.default.FRAG_PARSING_INIT_SEGMENT,t),i.on(c.default.FRAG_PARSING_DATA,t),i.on(c.default.FRAG_PARSED,t),i.on(c.default.ERROR,t),i.on(c.default.FRAG_PARSING_METADATA,t),i.on(c.default.FRAG_PARSING_USERDATA,t),i.on(c.default.INIT_PTS_FOUND,t);var a={mp4:m.isTypeSupported("video/mp4"),mpeg:m.isTypeSupported("audio/mpeg"),mp3:m.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(o.enableWorker&&"undefined"!=typeof Worker){y.logger.log("demuxing in webworker");var u=void 0;try{u=this.w=l("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),u.addEventListener("message",this.onwmsg),u.onerror=function(e){r.trigger(c.default.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},u.postMessage({cmd:"init",typeSupported:a,vendor:s,id:e,config:JSON.stringify(o)})}catch(e){y.logger.warn("Error in worker:",e),y.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),u&&p.URL.revokeObjectURL(u.objectURL),this.demuxer=new d.default(i,a,o,s),this.w=void 0}}else this.demuxer=new d.default(i,a,o,s)}i.default=r}).call(this,o("./src/polyfills/number.js").Number)},"./src/demux/exp-golomb.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/logger.js"),i=(o.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},o.prototype.skipBits=function(e){var t;this.bitsAvailable>e||(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e},o.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return 32<e&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?r<<t|this.readBits(t):r},o.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},o.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},o.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},o.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},o.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},o.prototype.readBoolean=function(){return 1===this.readBits(1)},o.prototype.readUByte=function(){return this.readBits(8)},o.prototype.readUShort=function(){return this.readBits(16)},o.prototype.readUInt=function(){return this.readBits(32)},o.prototype.skipScalingList=function(e){var t,r=8,n=8;for(t=0;t<e;t++)0!==n&&(n=(r+this.readEG()+256)%256),r=0===n?r:n},o.prototype.readSPS=function(){var e,t,r,n,i,o,a,s=0,u=0,l=0,c=0,d=this.readUByte.bind(this),f=this.readBits.bind(this),h=this.readUEG.bind(this),p=this.readBoolean.bind(this),m=this.skipBits.bind(this),g=this.skipEG.bind(this),v=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(d(),e=d(),f(5),m(3),d(),v(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var _=h();if(3===_&&m(1),v(),v(),m(1),p())for(o=3!==_?8:12,a=0;a<o;a++)p()&&y(a<6?16:64)}v();var b=h();if(0===b)h();else if(1===b)for(m(1),g(),g(),t=h(),a=0;a<t;a++)g();v(),m(1),r=h(),n=h(),0===(i=f(1))&&m(1),m(1),p()&&(s=h(),u=h(),l=h(),c=h());var E=[1,1];if(p()&&p())switch(d()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(r+1)-2*s-2*u),height:(2-i)*(n+1)*16-(i?2:4)*(l+c),pixelRatio:E}},o.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},o);function o(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}t.default=i},"./src/demux/id3.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(s.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},s.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},s.getID3Data=function(e,t){for(var r=t,n=0;s.isHeader(e,t);)n+=10,n+=s._readSize(e,t+6),s.isFooter(e,t+10)&&(n+=10),t+=n;if(0<n)return e.subarray(r,r+n)},s._readSize=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3]},s.getTimeStamp=function(e){for(var t=s.getID3Frames(e),r=0;r<t.length;r++){var n=t[r];if(s.isTimeStampFrame(n))return s._readTimeStamp(n)}},s.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},s._getFrameData=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=s._readSize(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},s.getID3Frames=function(e){for(var t=0,r=[];s.isHeader(e,t);){for(var n=s._readSize(e,t+6),i=(t+=10)+n;t+8<i;){var o=s._getFrameData(e.subarray(t)),a=s._decodeFrame(o);a&&r.push(a),t+=o.size+10}s.isFooter(e,t)&&(t+=10)}return r},s._decodeFrame=function(e){return"PRIV"===e.type?s._decodePrivFrame(e):"T"===e.type[0]?s._decodeTextFrame(e):"W"===e.type[0]?s._decodeURLFrame(e):void 0},s._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}},s._decodePrivFrame=function(e){if(!(e.size<2)){var t=s._utf8ArrayToStr(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},s._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=s._utf8ArrayToStr(e.data.subarray(t));t+=r.length+1;var n=s._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:r,data:n}}var i=s._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:i}}},s._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=s._utf8ArrayToStr(e.data.subarray(t));t+=r.length+1;var n=s._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:r,data:n}}var i=s._utf8ArrayToStr(e.data);return{key:e.type,data:i}},s._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);for(var r,n,i,o=e.length,a="",s=0;s<o;){if(0===(r=e[s++])&&t)return a;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:n=e[s++],a+=String.fromCharCode((31&r)<<6|63&n);break;case 14:n=e[s++],i=e[s++],a+=String.fromCharCode((15&r)<<12|(63&n)<<6|(63&i)<<0)}}return a},s);function s(){}var i=n._utf8ArrayToStr;t.utf8ArrayToStr=i,t.default=n},"./src/demux/mp3demuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=r("./src/demux/id3.js"),i=r("./src/utils/logger.js"),m=r("./src/demux/mpegaudio.js"),n=(o.prototype.resetInitSegment=function(e,t,r,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},o.prototype.resetTimeStamp=function(){},o.probe=function(e){var t,r,n=p.default.getID3Data(e,0);if(n&&void 0!==p.default.getTimeStamp(n))for(t=n.length,r=Math.min(e.length-1,t+100);t<r;t++)if(m.default.probe(e,t))return i.logger.log("MPEG Audio sync word found !"),!0;return!1},o.prototype.append=function(e,t,r,n){for(var i=p.default.getID3Data(e,0),o=p.default.getTimeStamp(i),a=o?90*o:9e4*t,s=i.length,u=e.length,l=0,c=0,d=this._audioTrack,f=[{pts:a,dts:a,data:i}];s<u;)if(m.default.isHeader(e,s)){var h=m.default.appendFrame(d,e,s,a,l);if(!h)break;s+=h.length,c=h.sample.pts,l++}else p.default.isHeader(e,s)?(i=p.default.getID3Data(e,s),f.push({pts:c,dts:c,data:i}),s+=i.length):s++;this.remuxer.remux(d,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,r,n)},o.prototype.destroy=function(){},o);function o(e,t,r){this.observer=e,this.config=r,this.remuxer=t}t.default=n},"./src/demux/mp4demuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=r("./src/utils/logger.js"),u=r("./src/events.js"),s=Math.pow(2,32)-1,n=(m.prototype.resetTimeStamp=function(e){this.initPTS=e},m.prototype.resetInitSegment=function(e,t,r,n){if(e&&e.byteLength){var i=this.initData=m.parseInitSegment(e);null==t&&(t="mp4a.40.5"),null==r&&(r="avc1.42e01e");var o={};i.audio&&i.video?o.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:n?e:null}:(i.audio&&(o.audio={container:"audio/mp4",codec:t,initSegment:n?e:null}),i.video&&(o.video={container:"video/mp4",codec:r,initSegment:n?e:null})),this.observer.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else t&&(this.audioCodec=t),r&&(this.videoCodec=r)},m.probe=function(e){return 0<m.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length},m.bin2str=function(e){return String.fromCharCode.apply(null,e)},m.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<8|e[t+1];return r<0?65536+r:r},m.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r},m.writeUint32=function(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},m.findBox=function(e,t){var r,n,i,o,a,s,u=[];if(e.data?(a=e.start,i=e.end,e=e.data):(a=0,i=e.byteLength),!t.length)return null;for(r=a;r<i;)s=1<(n=m.readUint32(e,r))?r+n:i,m.bin2str(e.subarray(r+4,r+8))===t[0]&&(1===t.length?u.push({data:e,start:r+8,end:s}):(o=m.findBox({data:e,start:r+8,end:s},t.slice(1))).length&&(u=u.concat(o))),r=s;return u},m.parseSegmentIndex=function(e){var t,r=m.findBox(e,["moov"])[0],n=r?r.end:null,i=0,o=m.findBox(e,["sidx"]);if(!o||!o[0])return null;t=[];var a=(o=o[0]).data[0],s=m.readUint32(o,i=0===a?8:16);i+=4,i+=0===a?8:16,i+=2;var u=o.end+0,l=m.readUint16(o,i);i+=2;for(var c=0;c<l;c++){var d=i,f=m.readUint32(o,d);d+=4;var h=2147483647&f;if(1==(2147483648&f)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var p=m.readUint32(o,d);d+=4,t.push({referenceSize:h,subsegmentDuration:p,info:{duration:p/s,start:u,end:u+h-1}}),u+=h,i=d+=4}return{earliestPresentationTime:0,timescale:s,version:a,referencesCount:l,references:t,moovEndOffset:n}},m.parseInitSegment=function(e){var d=[];return m.findBox(e,["moov","trak"]).forEach(function(e){var t=m.findBox(e,["tkhd"])[0];if(t){var r=t.data[t.start],n=0===r?12:20,i=m.readUint32(t,n),o=m.findBox(e,["mdia","mdhd"])[0];if(o){r=o.data[o.start];var a=m.readUint32(o,n=0===r?12:20),s=m.findBox(e,["mdia","hdlr"])[0];if(s){var u={soun:"audio",vide:"video"}[m.bin2str(s.data.subarray(s.start+8,s.start+12))];if(u){var l=m.findBox(e,["mdia","minf","stbl","stsd"]);if(l.length){l=l[0];var c=m.bin2str(l.data.subarray(l.start+12,l.start+16));f.logger.log("MP4Demuxer:"+u+":"+c+" found")}d[i]={timescale:a,type:u},d[u]={timescale:a,id:i}}}}}}),d},m.getStartDTS=function(i,e){var t,r,n;return t=m.findBox(e,["moof","traf"]),r=[].concat.apply([],t.map(function(n){return m.findBox(n,["tfhd"]).map(function(e){var t,r;return t=m.readUint32(e,4),r=i[t].timescale||9e4,m.findBox(n,["tfdt"]).map(function(e){var t,r;return t=e.data[e.start],r=m.readUint32(e,4),1===t&&(r*=Math.pow(2,32),r+=m.readUint32(e,8)),r})[0]/r})})),n=Math.min.apply(null,r),isFinite(n)?n:0},m.offsetStartDTS=function(n,e,a){m.findBox(e,["moof","traf"]).map(function(r){return m.findBox(r,["tfhd"]).map(function(e){var t=m.readUint32(e,4),o=n[t].timescale||9e4;m.findBox(r,["tfdt"]).map(function(e){var t=e.data[e.start],r=m.readUint32(e,4);if(0===t)m.writeUint32(e,4,r-a*o);else{r*=Math.pow(2,32),r+=m.readUint32(e,8),r-=a*o,r=Math.max(r,0);var n=Math.floor(r/(1+s)),i=Math.floor(r%(1+s));m.writeUint32(e,4,n),m.writeUint32(e,8,i)}})})})},m.prototype.append=function(e,t,r,n){var i=this.initData;i||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),i=this.initData);var o,a=this.initPTS;if(void 0===a){var s=m.getStartDTS(i,e);this.initPTS=a=s-t,this.observer.trigger(u.default.INIT_PTS_FOUND,{initPTS:a})}m.offsetStartDTS(i,e,a),o=m.getStartDTS(i,e),this.remuxer.remux(i.audio,i.video,null,null,o,r,n,e)},m.prototype.destroy=function(){},m);function m(e,t){this.observer=e,this.remuxer=t}t.default=n},"./src/demux/mpegaudio.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,n,i){if(!(r+24>t.length)){var o=this.parseHeader(t,r);if(o&&r+o.frameLength<=t.length){var a=n+i*(9e4*o.samplesPerFrame/o.sampleRate),s={unit:t.subarray(r,r+o.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(s),e.len+=o.frameLength,{sample:s,length:o.frameLength}}}},parseHeader:function(e,t){var r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,o=e[t+2]>>2&3,a=e[t+2]>>1&1;if(1!=r&&0!=i&&15!=i&&3!=o){var s=3==r?3-n:3==n?3:4,u=1e3*m.BitratesMap[14*s+i-1],l=3==r?0:2==r?1:2,c=m.SamplingRateMap[3*l+o],d=e[t+3]>>6==3?1:2,f=m.SamplesCoefficients[r][n],h=m.BytesInSlot[n],p=8*f*h;return{sampleRate:c,channelCount:d,frameLength:parseInt(f*u/c+a,10)*h,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var r=this.parseHeader(e,t),n=4;r&&r.frameLength&&(n=r.frameLength);var i=t+n;if(i===e.length||i+1<e.length&&this.isHeaderPattern(e,i))return!0}return!1}};t.default=m},"./src/demux/sample-aes.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./src/crypt/decrypter.js"),n=(o.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},o.prototype.decryptAacSample=function(t,r,n,i){var o=t[r].unit,e=o.subarray(16,o.length-o.length%16),a=e.buffer.slice(e.byteOffset,e.byteOffset+e.length),s=this;this.decryptBuffer(a,function(e){e=new Uint8Array(e),o.set(e,16),i||s.decryptAacSamples(t,r+1,n)})},o.prototype.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,n),!n)return}}},o.prototype.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),n=0,i=32;i<=e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r},o.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var r=0,n=32;n<=e.length-16;n+=160,r+=16)e.set(t.subarray(r,r+16),n);return e},o.prototype.decryptAvcSample=function(t,r,n,i,o,a){var s=this.discardEPB(o.data),e=this.getAvcEncryptedData(s),u=this;this.decryptBuffer(e.buffer,function(e){o.data=u.getAvcDecryptedUnit(s,e),a||u.decryptAvcSamples(t,r,n+1,i)})},o.prototype.decryptAvcSamples=function(e,t,r,n){for(;;t++,r=0){if(t>=e.length)return void n();for(var i=e[t].units;!(r>=i.length);r++){var o=i[r];if(!(o.length<=48||1!==o.type&&5!==o.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,n,o,a),!a)return}}}},o);function o(e,t,r,n){this.decryptdata=r,this.discardEPB=n,this.decrypter=new i.default(e,t,{removePKCS7Padding:!1})}t.default=n},"./src/demux/tsdemuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=r("./src/demux/adts.js"),s=r("./src/demux/mpegaudio.js"),C=r("./src/events.js"),T=r("./src/demux/exp-golomb.js"),n=r("./src/demux/sample-aes.js"),D=r("./src/utils/logger.js"),I=r("./src/errors.js"),i={video:1,audio:2,id3:3,text:4},o=(L.prototype.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new n.default(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},L.probe=function(e){var t=L._syncOffset(e);return!(t<0||(t&&D.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),0))},L._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},L.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:i[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},L.prototype.resetInitSegment=function(e,t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=L.createTrack("video",n),this._audioTrack=L.createTrack("audio",n),this._id3Track=L.createTrack("id3",n),this._txtTrack=L.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=r,this._duration=n},L.prototype.resetTimeStamp=function(){},L.prototype.append=function(e,t,r,n){var i,o,a,s,u,l=e.length,c=!1;this.contiguous=r;var d=this.pmtParsed,f=this._avcTrack,h=this._audioTrack,p=this._id3Track,m=f.pid,g=h.pid,v=p.pid,y=this._pmtId,_=f.pesData,b=h.pesData,E=p.pesData,w=this._parsePAT,A=this._parsePMT,T=this._parsePES,S=this._parseAVCPES.bind(this),x=this._parseAACPES.bind(this),M=this._parseMPEGPES.bind(this),R=this._parseID3PES.bind(this),O=L._syncOffset(e);for(l-=(l+O)%188,i=O;i<l;i+=188)if(71===e[i]){if(o=!!(64&e[i+1]),a=((31&e[i+1])<<8)+e[i+2],1<(48&e[i+3])>>4){if((s=i+5+e[i+4])===i+188)continue}else s=i+4;switch(a){case m:o&&(_&&(u=T(_))&&void 0!==u.pts&&S(u,!1),_={data:[],size:0}),_&&(_.data.push(e.subarray(s,i+188)),_.size+=i+188-s);break;case g:o&&(b&&(u=T(b))&&void 0!==u.pts&&(h.isAAC?x(u):M(u)),b={data:[],size:0}),b&&(b.data.push(e.subarray(s,i+188)),b.size+=i+188-s);break;case v:o&&(E&&(u=T(E))&&void 0!==u.pts&&R(u),E={data:[],size:0}),E&&(E.data.push(e.subarray(s,i+188)),E.size+=i+188-s);break;case 0:o&&(s+=e[s]+1),y=this._pmtId=w(e,s);break;case y:o&&(s+=e[s]+1);var P=A(e,s,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(m=P.avc)&&(f.pid=m),0<(g=P.audio)&&(h.pid=g,h.isAAC=P.isAAC),0<(v=P.id3)&&(p.pid=v),c&&!d&&(D.logger.log("reparse from beginning"),c=!1,i=O-188),d=this.pmtParsed=!0;break;case 17:case 8191:break;default:c=!0}}else this.observer.trigger(C.default.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});_&&(u=T(_))&&void 0!==u.pts?(S(u,!0),f.pesData=null):f.pesData=_,b&&(u=T(b))&&void 0!==u.pts?(h.isAAC?x(u):M(u),h.pesData=null):(b&&b.size&&D.logger.log("last AAC PES packet truncated,might overlap between fragments"),h.pesData=b),E&&(u=T(E))&&void 0!==u.pts?(R(u),p.pesData=null):p.pesData=E,null==this.sampleAes?this.remuxer.remux(h,f,p,this._txtTrack,t,r,n):this.decryptAndRemux(h,f,p,this._txtTrack,t,r,n)},L.prototype.decryptAndRemux=function(e,t,r,n,i,o,a){if(e.samples&&e.isAAC){var s=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){s.decryptAndRemuxAvc(e,t,r,n,i,o,a)})}else this.decryptAndRemuxAvc(e,t,r,n,i,o,a)},L.prototype.decryptAndRemuxAvc=function(e,t,r,n,i,o,a){if(t.samples){var s=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){s.remuxer.remux(e,t,r,n,i,o,a)})}else this.remuxer.remux(e,t,r,n,i,o,a)},L.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},L.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},L.prototype._parsePMT=function(e,t,r,n){var i,o,a={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){D.logger.log("unkown stream type:"+e[t]);break}case 15:-1===a.audio&&(a.audio=o);break;case 21:-1===a.id3&&(a.id3=o);break;case 219:if(!n){D.logger.log("unkown stream type:"+e[t]);break}case 27:-1===a.avc&&(a.avc=o);break;case 3:case 4:r?-1===a.audio&&(a.audio=o,a.isAAC=!1):D.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:D.logger.warn("HEVC stream type found, not supported for now");break;default:D.logger.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return a},L.prototype._parsePES=function(e){var t,r,n,i,o,a,s,u,l=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&1<c.length;){var d=new Uint8Array(c[0].length+c[1].length);d.set(c[0]),d.set(c[1],c[0].length),c[0]=d,c.splice(1,1)}if(1!==((t=c[0])[0]<<16)+(t[1]<<8)+t[2])return null;if((n=(t[4]<<8)+t[5])&&n>e.size-6)return null;192&(r=t[7])&&(4294967295<(a=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2)&&(a-=8589934592),64&r?(4294967295<(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)&&(s-=8589934592),54e5<a-s&&(D.logger.warn(Math.round((a-s)/9e4)+"s delta between PTS and DTS, align them"),a=s)):s=a),u=(i=t[8])+9,e.size-=u,o=new Uint8Array(e.size);for(var f=0,h=c.length;f<h;f++){var p=(t=c[f]).byteLength;if(u){if(p<u){u-=p;continue}t=t.subarray(u),p-=u,u=0}o.set(t,l),l+=p}return n&&(n-=i+3),{data:o,pts:a,dts:s,len:n}},L.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var r=t.samples,n=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(n||this.contiguous)?(e.id=n,r.push(e)):t.dropped++}e.debug.length&&D.logger.log(e.pts+"/"+e.dts+":"+e.debug)},L.prototype._parseAVCPES=function(p,e){function m(e,t,r,n){return{key:e,pts:t,dts:r,units:[],debug:n}}var g,v,y,_=this,b=this._avcTrack,t=this._parseAVCNALu(p.data),E=this.avcSample,w=!1,A=this.pushAccesUnit.bind(this);p.data=null,E&&t.length&&!b.audFound&&(A(E,b),E=this.avcSample=m(!1,p.pts,p.dts,"")),t.forEach(function(e){switch(e.type){case 1:v=!0,(E=E||(_.avcSample=m(!0,p.pts,p.dts,""))).frame=!0;var t=e.data;if(w&&4<t.length){var r=new T.default(t).readSliceType();2!==r&&4!==r&&7!==r&&9!==r||(E.key=!0)}break;case 5:v=!0,(E=E||(_.avcSample=m(!0,p.pts,p.dts,""))).key=!0,E.frame=!0;break;case 6:v=!0,(g=new T.default(_.discardEPB(e.data))).readUByte();for(var n=0,i=0,o=!1,a=0;!o&&1<g.bytesAvailable;){for(n=0;n+=a=g.readUByte(),255===a;);for(i=0;i+=a=g.readUByte(),255===a;);if(4===n&&0!==g.bytesAvailable){if(o=!0,181===g.readUByte()&&49===g.readUShort()&&1195456820===g.readUInt()&&3===g.readUByte()){var s=g.readUByte(),u=31&s,l=[s,g.readUByte()];for(y=0;y<u;y++)l.push(g.readUByte()),l.push(g.readUByte()),l.push(g.readUByte());_._insertSampleInOrder(_._txtTrack.samples,{type:3,pts:p.pts,bytes:l})}}else if(i<g.bytesAvailable)for(y=0;y<i;y++)g.readUByte()}break;case 7:if(w=v=!0,!b.sps){var c=(g=new T.default(e.data)).readSPS();b.width=c.width,b.height=c.height,b.pixelRatio=c.pixelRatio,b.sps=[e.data],b.duration=_._duration;var d=e.data.subarray(1,4),f="avc1.";for(y=0;y<3;y++){var h=d[y].toString(16);h.length<2&&(h="0"+h),f+=h}b.codec=f}break;case 8:v=!0,b.pps||(b.pps=[e.data]);break;case 9:v=!1,b.audFound=!0,E&&A(E,b),E=_.avcSample=m(!1,p.pts,p.dts,"");break;case 12:v=!1;break;default:v=!1,E&&(E.debug+="unknown NAL "+e.type+" ")}E&&v&&E.units.push(e)}),e&&E&&(A(E,b),this.avcSample=null)},L.prototype._insertSampleInOrder=function(e,t){var r=e.length;if(0<r){if(t.pts>=e[r-1].pts)e.push(t);else for(var n=r-1;0<=n;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},L.prototype._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var r=this._avcTrack.samples;t=r[r.length-1]}if(t){var n=t.units;e=n[n.length-1]}return e},L.prototype._parseAVCNALu=function(e){var t,r,n,i,o=0,a=e.byteLength,s=this._avcTrack,u=s.naluState||0,l=u,c=[],d=-1;for(-1===u&&(i=31&e[d=0],u=0,o=1);o<a;)if(t=e[o++],u)if(1!==u)if(t)if(1===t){var f,h;0<=d?(n={data:e.subarray(d,o-u-1),type:i},c.push(n)):(f=this._getLastNalUnit())&&(l&&o<=4-l&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-l)),0<(r=o-u-1)&&((h=new Uint8Array(f.data.byteLength+r)).set(f.data,0),h.set(e.subarray(0,r),f.data.byteLength),f.data=h)),u=o<a?(i=31&e[d=o],0):-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;return 0<=d&&0<=u&&(n={data:e.subarray(d,a),type:i,state:u},c.push(n)),0!==c.length||(f=this._getLastNalUnit())&&((h=new Uint8Array(f.data.byteLength+e.byteLength)).set(f.data,0),h.set(e,f.data.byteLength),f.data=h),s.naluState=u,c},L.prototype.discardEPB=function(e){for(var t,r,n=e.byteLength,i=[],o=1;o<n-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(i.push(o+2),o+=2):o++;if(0===i.length)return e;t=n-i.length,r=new Uint8Array(t);var a=0;for(o=0;o<t;a++,o++)a===i[0]&&(a++,i.shift()),r[o]=e[a];return r},L.prototype._parseAACPES=function(e){var t,r,n,i,o,a=this._audioTrack,s=e.data,u=e.pts,l=this.aacOverFlow,c=this.aacLastPTS;if(l){var d=new Uint8Array(l.byteLength+s.byteLength);d.set(l,0),d.set(s,l.byteLength),s=d}for(n=0,o=s.length;n<o-1&&!g.isHeader(s,n);n++);if(n){var f=void 0,h=void 0;if(h=n<o-1?(f="AAC PES did not start with ADTS header,offset:"+n,!1):(f="no ADTS header found in AAC PES",!0),D.logger.warn("parsing error:"+f),this.observer.trigger(C.default.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:h,reason:f}),h)return}if(g.initTrackConfig(a,this.observer,s,n,this.audioCodec),r=0,t=g.getFrameDuration(a.samplerate),l&&c){var p=c+t;1<Math.abs(p-u)&&(D.logger.log("AAC: align PTS for overlapping frames by "+Math.round((p-u)/90)),u=p)}for(;n<o;)if(g.isHeader(s,n)&&n+5<o){var m=g.appendFrame(a,s,n,u,r);if(!m)break;n+=m.length,i=m.sample.pts,r++}else n++;l=n<o?s.subarray(n,o):null,this.aacOverFlow=l,this.aacLastPTS=i},L.prototype._parseMPEGPES=function(e){for(var t=e.data,r=t.length,n=0,i=0,o=e.pts;i<r;)if(s.default.isHeader(t,i)){var a=s.default.appendFrame(this._audioTrack,t,i,o,n);if(!a)break;i+=a.length,n++}else i++},L.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},L);function L(e,t,r,n){this.observer=e,this.config=r,this.typeSupported=n,this.remuxer=t,this.sampleAes=null}t.default=o},"./src/errors.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},t.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/logger.js"),i=r("./src/errors.js"),o=r("./src/events.js"),a={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},s=(u.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},u.prototype.onHandlerDestroying=function(){},u.prototype.onHandlerDestroyed=function(){},u.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},u.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(a[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},u.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},u.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},u.prototype.onEventGeneric=function(t,e){try{(function(e,t){var r="on"+e.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)}).call(this,t,e).call()}catch(e){n.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(o.default.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},u);function u(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.hls=e,this.onEvent=this.onEvent.bind(this),this.handledEvents=t,this.useGenericHandler=!0,this.registerListeners()}t.default=s},"./src/events.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},"./src/hls.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var b,o=r("./node_modules/url-toolkit/src/url-toolkit.js"),a=r("./src/errors.js"),E=r("./src/loader/playlist-loader.js"),w=r("./src/loader/fragment-loader.js"),A=r("./src/loader/key-loader.js"),T=r("./src/controller/fragment-tracker.js"),S=r("./src/controller/stream-controller.js"),x=r("./src/controller/level-controller.js"),M=r("./src/controller/id3-track-controller.js"),s=r("./src/is-supported.js"),R=r("./src/utils/logger.js"),u=r("./src/config.js"),l=r("./src/events.js"),c=r("./src/observer.js"),d=(b=c.Observer,i(O,b),Object.defineProperty(O,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),O.isSupported=function(){return s.isSupported()},Object.defineProperty(O,"Events",{get:function(){return l.default},enumerable:!0,configurable:!0}),Object.defineProperty(O,"ErrorTypes",{get:function(){return a.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(O,"ErrorDetails",{get:function(){return a.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(O,"DefaultConfig",{get:function(){return O.defaultConfig?O.defaultConfig:u.hlsDefaultConfig},set:function(e){O.defaultConfig=e},enumerable:!0,configurable:!0}),O.prototype.destroy=function(){R.logger.log("destroy"),this.trigger(l.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},O.prototype.attachMedia=function(e){R.logger.log("attachMedia"),this.media=e,this.trigger(l.default.MEDIA_ATTACHING,{media:e})},O.prototype.detachMedia=function(){R.logger.log("detachMedia"),this.trigger(l.default.MEDIA_DETACHING),this.media=null},O.prototype.loadSource=function(e){e=o.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),R.logger.log("loadSource:"+e),this.url=e,this.trigger(l.default.MANIFEST_LOADING,{url:e})},O.prototype.startLoad=function(t){void 0===t&&(t=-1),R.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},O.prototype.stopLoad=function(){R.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},O.prototype.swapAudioCodec=function(){R.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},O.prototype.recoverMediaError=function(){R.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},Object.defineProperty(O.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(e){R.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(e){R.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(e){R.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){R.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(e){R.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(e){R.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"minAutoLevel",{get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,r=e?e.length:0,n=0;n<r;n++)if(t<(e[n].realBitrate?Math.max(e[n].realBitrate,e[n].bitrate):e[n].bitrate))return n;return 0},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"maxAutoLevel",{get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"nextAutoLevel",{get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"audioTracks",{get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"audioTrack",{get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"subtitleTracks",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"subtitleTrack",{get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)},enumerable:!0,configurable:!0}),Object.defineProperty(O.prototype,"subtitleDisplay",{get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)},enumerable:!0,configurable:!0}),O);function O(e){void 0===e&&(e={});var t=b.call(this)||this,r=O.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var n in r)n in e||(e[n]=r[n]);if(void 0!==e.liveMaxLatencyDurationCount&&e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(e.liveMaxLatencyDuration<=e.liveSyncDuration||void 0===e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');R.enableLogs(e.debug),t.config=e,t._autoLevelCapping=-1;var i=t.abrController=new e.abrController(t),o=new e.bufferController(t),a=new e.capLevelController(t),s=new e.fpsController(t),u=new E.default(t),l=new w.default(t),c=new A.default(t),d=new M.default(t),f=t.levelController=new x.default(t),h=new T.FragmentTracker(t),p=[f,t.streamController=new S.default(t,h)],m=e.audioStreamController;m&&p.push(new m(t,h)),t.networkControllers=p;var g=[u,l,c,i,o,a,s,d,h];if(m=e.audioTrackController){var v=new m(t);t.audioTrackController=v,g.push(v)}if(m=e.subtitleTrackController){var y=new m(t);t.subtitleTrackController=y,p.push(y)}if(m=e.emeController){var _=new m(t);t.emeController=_,g.push(_)}return(m=e.subtitleStreamController)&&p.push(new m(t,h)),(m=e.timelineController)&&g.push(new m(t)),t.coreComponents=g,t}t.default=d},"./src/is-supported.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./src/utils/mediasource-helper.js");t.isSupported=function(){var e=i.getMediaSource(),t=window.SourceBuffer||window.WebKitSourceBuffer,r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!n}},"./src/loader/fragment-loader.js":function(e,u,l){"use strict";(function(h){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(u,"__esModule",{value:!0});var i,a=l("./src/events.js"),t=l("./src/event-handler.js"),o=l("./src/errors.js"),p=l("./src/utils/logger.js"),r=(i=t.default,e(s,i),s.prototype.destroy=function(){var e=this.loaders;for(var t in e){var r=e[t];r&&r.destroy()}this.loaders={},i.prototype.destroy.call(this)},s.prototype.onFragLoading=function(e){var t=e.frag,r=t.type,n=this.loaders,i=this.hls.config,o=i.fLoader,a=i.loader;t.loaded=0;var s,u,l,c=n[r];c&&(p.logger.warn("abort previous fragment loader for type: "+r),c.abort()),c=n[r]=t.loader=i.fLoader?new o(i):new a(i),s={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var d=t.byteRangeStartOffset,f=t.byteRangeEndOffset;h.isFinite(d)&&h.isFinite(f)&&(s.rangeStart=d,s.rangeEnd=f),u={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},c.load(s,u,l)},s.prototype.loadsuccess=function(e,t,r,n){void 0===n&&(n=null);var i=e.data,o=r.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(a.default.FRAG_LOADED,{payload:i,frag:o,stats:t,networkDetails:n})},s.prototype.loaderror=function(e,t,r){void 0===r&&(r=null);var n=t.frag,i=n.loader;i&&i.abort(),this.loaders[n.type]=void 0,this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:r})},s.prototype.loadtimeout=function(e,t,r){void 0===r&&(r=null);var n=t.frag,i=n.loader;i&&i.abort(),this.loaders[n.type]=void 0,this.hls.trigger(a.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:r})},s.prototype.loadprogress=function(e,t,r,n){void 0===n&&(n=null);var i=t.frag;i.loaded=e.loaded,this.hls.trigger(a.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e,networkDetails:n})},s);function s(e){var t=i.call(this,e,a.default.FRAG_LOADING)||this;return t.loaders={},t}u.default=r}).call(this,l("./src/polyfills/number.js").Number)},"./src/loader/fragment.js":function(e,o,a){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0});var e=a("./node_modules/url-toolkit/src/url-toolkit.js"),n=a("./src/loader/level-key.js"),r=(Object.defineProperty(i,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=e.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var r=this.lastByteRangeEndOffset;e[0]=r||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0],this._byteRange=e}return e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"endProgramDateTime",{get:function(){if(!t.isFinite(this.programDateTime))return null;var e=t.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),i.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},i.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},i.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},i.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&((r=new n.default).method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r},i);function i(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=((e={})[i.ElementaryStreamTypes.AUDIO]=!1,e[i.ElementaryStreamTypes.VIDEO]=!1,e)}o.default=r}).call(this,a("./src/polyfills/number.js").Number)},"./src/loader/key-loader.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,c=r("./src/events.js"),a=r("./src/event-handler.js"),s=r("./src/errors.js"),d=r("./src/utils/logger.js"),u=(o=a.default,i(l,o),l.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},a.default.prototype.destroy.call(this)},l.prototype.onKeyLoading=function(e){var t=e.frag,r=t.type,n=this.loaders[r],i=t.decryptdata,o=i.uri;if(o!==this.decrypturl||null===this.decryptkey){var a,s,u,l=this.hls.config;n&&(d.logger.warn("abort previous key loader for type:"+r),n.abort()),t.loader=this.loaders[r]=new l.loader(l),this.decrypturl=o,this.decryptkey=null,a={url:o,frag:t,responseType:"arraybuffer"},s={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(a,s,u)}else this.decryptkey&&(i.key=this.decryptkey,this.hls.trigger(c.default.KEY_LOADED,{frag:t}))},l.prototype.loadsuccess=function(e,t,r){var n=r.frag;this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(c.default.KEY_LOADED,{frag:n})},l.prototype.loaderror=function(e,t){var r=t.frag,n=r.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(c.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},l.prototype.loadtimeout=function(e,t){var r=t.frag,n=r.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(c.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},l);function l(e){var t=o.call(this,e,c.default.KEY_LOADING)||this;return t.loaders={},t.decryptkey=null,t.decrypturl=null,t}t.default=u},"./src/loader/level-key.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/url-toolkit/src/url-toolkit.js"),i=(Object.defineProperty(o.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=n.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),o);function o(){this.method=null,this.key=null,this.iv=null,this._uri=null}t.default=i},"./src/loader/level.js":function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0});var t=(Object.defineProperty(r.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!e.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),r);function r(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}n.default=t}).call(this,t("./src/polyfills/number.js").Number)},"./src/loader/m3u8-parser.js":function(e,t,n){"use strict";(function(O){Object.defineProperty(t,"__esModule",{value:!0});var r=n("./node_modules/url-toolkit/src/url-toolkit.js"),P=n("./src/loader/fragment.js"),C=n("./src/loader/level.js"),D=n("./src/loader/level-key.js"),I=n("./src/utils/attr-list.js"),L=n("./src/utils/logger.js"),u=n("./src/utils/codecs.js"),l=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,c=/#EXT-X-MEDIA:(.*)/g,N=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),k=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,F=/\.(mp4|m4s|m4v|m4a)$/i,e=(d.findGroup=function(e,t){if(!e)return null;for(var r=null,n=0;n<e.length;n++){var i=e[n];i.id===t&&(r=i)}return r},d.convertAVC1ToAVCOTI=function(e){var t,r=e.split(".");return 2<r.length?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t},d.resolve=function(e,t){return r.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},d.parseMasterPlaylist=function(e,t){var r,n=[];function i(n,i){["video","audio"].forEach(function(t){var r=n.filter(function(e){return u.isCodecType(e,t)});if(r.length){var e=r.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});i[t+"Codec"]=0<e.length?e[0]:r[0],n=n.filter(function(e){return-1===r.indexOf(e)})}}),i.unknownCodecs=n}for(l.lastIndex=0;null!=(r=l.exec(e));){var o={},a=o.attrs=new I.default(r[1]);o.url=d.resolve(r[2],t);var s=a.decimalResolution("RESOLUTION");s&&(o.width=s.width,o.height=s.height),o.bitrate=a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),o.name=a.NAME,i([].concat((a.CODECS||"").split(/[ ,]+/)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=d.convertAVC1ToAVCOTI(o.videoCodec)),n.push(o)}return n},d.parseMasterPlaylistMedia=function(e,t,r,n){var i;void 0===n&&(n=[]);var o=[],a=0;for(c.lastIndex=0;null!==(i=c.exec(e));){var s={},u=new I.default(i[1]);if(u.TYPE===r){if(s.groupId=u["GROUP-ID"],s.name=u.NAME,s.type=r,s.default="YES"===u.DEFAULT,s.autoselect="YES"===u.AUTOSELECT,s.forced="YES"===u.FORCED,u.URI&&(s.url=d.resolve(u.URI,t)),s.lang=u.LANGUAGE,s.name||(s.name=s.lang),n.length){var l=d.findGroup(n,s.groupId);s.audioCodec=l?l.codec:n[0].codec}s.id=a++,o.push(s)}}return o},d.parseLevelPlaylist=function(e,t,r,n,i){var o,a,s=0,u=0,l=new C.default(t),c=new D.default,d=0,f=null,h=new P.default,p=null;for(N.lastIndex=0;null!==(o=N.exec(e));){var m=o[1];if(m){h.duration=parseFloat(m);var g=(" "+o[2]).slice(1);h.title=g||null,h.tagList.push(g?["INF",m,g]:["INF",m])}else if(o[3]){if(O.isFinite(h.duration)){var v=s++;h.type=n,h.start=u,h.levelkey=c,h.sn=v,h.level=r,h.cc=d,h.urlId=i,h.baseurl=t,h.relurl=(" "+o[3]).slice(1),j(h,f),l.fragments.push(h),u+=(f=h).duration,h=new P.default}}else if(o[4]){if(h.rawByteRange=(" "+o[4]).slice(1),f){var y=f.byteRangeEndOffset;y&&(h.lastByteRangeEndOffset=y)}}else if(o[5])h.rawProgramDateTime=(" "+o[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]),null===p&&(p=l.fragments.length);else{for(o=o[0].match(k),a=1;a<o.length&&void 0===o[a];a++);var _=(" "+o[a+1]).slice(1),b=(" "+o[a+2]).slice(1);switch(o[a]){case"#":h.tagList.push(b?[_,b]:[_]);break;case"PLAYLIST-TYPE":l.type=_.toUpperCase();break;case"MEDIA-SEQUENCE":s=l.startSN=parseInt(_);break;case"TARGETDURATION":l.targetduration=parseFloat(_);break;case"VERSION":l.version=parseInt(_);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(_);break;case"KEY":var E=_,w=new I.default(E),A=w.enumeratedString("METHOD"),T=w.URI,S=w.hexadecimalInteger("IV");A&&(c=new D.default,T&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(A)&&(c.method=A,c.baseuri=t,c.reluri=T,c.key=null,c.iv=S));break;case"START":var x=_,M=new I.default(x).decimalFloatingPoint("TIME-OFFSET");O.isFinite(M)&&(l.startTimeOffset=M);break;case"MAP":var R=new I.default(_);h.relurl=R.URI,h.rawByteRange=R.BYTERANGE,h.baseurl=t,h.level=r,h.type=n,h.sn="initSegment",l.initSegment=h,(h=new P.default).rawProgramDateTime=l.initSegment.rawProgramDateTime;break;default:L.logger.warn("line parsed but not handled: "+o)}}}return(h=f)&&!h.relurl&&(l.fragments.pop(),u-=h.duration),l.totalduration=u,l.averagetargetduration=u/l.fragments.length,l.endSN=s-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=d,!l.initSegment&&l.fragments.length&&l.fragments.every(function(e){return F.test(e.relurl)})&&(L.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(h=new P.default).relurl=l.fragments[0].relurl,h.baseurl=t,h.level=r,h.type=n,h.sn="initSegment",l.initSegment=h,l.needSidxRanges=!0),p&&function(e,t){for(var r=e[t],n=t-1;0<=n;n--){var i=e[n];i.programDateTime=r.programDateTime-1e3*i.duration,r=i}}(l.fragments,p),l},d);function d(){}function j(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),O.isFinite(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}t.default=e}).call(this,n("./src/polyfills/number.js").Number)},"./src/loader/playlist-loader.js":function(e,s,l){"use strict";(function(m){var n,e=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(s,"__esModule",{value:!0});var r,g=l("./src/events.js"),t=l("./src/event-handler.js"),u=l("./src/errors.js"),f=l("./src/utils/logger.js"),o=l("./src/demux/mp4demuxer.js"),v=l("./src/loader/m3u8-parser.js"),y=window.performance,_={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},i={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},a=(r=t.default,e(b,r),Object.defineProperty(b,"ContextType",{get:function(){return _},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LevelType",{get:function(){return i},enumerable:!0,configurable:!0}),b.canHaveQualityLevels=function(e){return e!==_.AUDIO_TRACK&&e!==_.SUBTITLE_TRACK},b.mapContextToLevelType=function(e){switch(e.type){case _.AUDIO_TRACK:return i.AUDIO;case _.SUBTITLE_TRACK:return i.SUBTITLE;default:return i.MAIN}},b.getResponseUrl=function(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r},b.prototype.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,n=t.loader,i=new(r||n)(t);return e.loader=i,this.loaders[e.type]=i},b.prototype.getInternalLoader=function(e){return this.loaders[e.type]},b.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},b.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},b.prototype.destroy=function(){this.destroyInternalLoaders(),r.prototype.destroy.call(this)},b.prototype.onManifestLoading=function(e){this.load(e.url,{type:_.MANIFEST,level:0,id:null})},b.prototype.onLevelLoading=function(e){this.load(e.url,{type:_.LEVEL,level:e.level,id:e.id})},b.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:_.AUDIO_TRACK,level:null,id:e.id})},b.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:_.SUBTITLE_TRACK,level:null,id:e.id})},b.prototype.load=function(e,t){var r=this.hls.config;f.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var n,i,o,a,s=this.getInternalLoader(t);if(s){var u=s.context;if(u&&u.url===e)return f.logger.trace("playlist request ongoing"),!1;f.logger.warn("aborting previous loader for type: "+t.type),s.abort()}switch(t.type){case _.MANIFEST:n=r.manifestLoadingMaxRetry,i=r.manifestLoadingTimeOut,o=r.manifestLoadingRetryDelay,a=r.manifestLoadingMaxRetryTimeout;break;case _.LEVEL:n=0,i=r.levelLoadingTimeOut;break;default:n=r.levelLoadingMaxRetry,i=r.levelLoadingTimeOut,o=r.levelLoadingRetryDelay,a=r.levelLoadingMaxRetryTimeout}s=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var l={timeout:i,maxRetry:n,retryDelay:o,maxRetryDelay:a},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return f.logger.debug("Calling internal loader delegate for URL: "+e),s.load(t,l,c),!0},b.prototype.loadsuccess=function(e,t,r,n){if(void 0===n&&(n=null),r.isSidxRequest)return this._handleSidxRequest(e,r),void this._handlePlaylistLoaded(e,t,r,n);this.resetInternalLoader(r.type);var i=e.data;t.tload=y.now(),0===i.indexOf("#EXTM3U")?0<i.indexOf("#EXTINF:")||0<i.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(e,t,r,n):this._handleMasterPlaylist(e,t,r,n):this._handleManifestParsingError(e,r,"no EXTM3U delimiter",n)},b.prototype.loaderror=function(e,t,r){void 0===r&&(r=null),this._handleNetworkError(t,r,!1,e)},b.prototype.loadtimeout=function(e,t,r){void 0===r&&(r=null),this._handleNetworkError(t,r,!0)},b.prototype._handleMasterPlaylist=function(e,t,r,n){var i=this.hls,o=e.data,a=b.getResponseUrl(e,r),s=v.default.parseMasterPlaylist(o,a);if(s.length){var u=s.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),l=v.default.parseMasterPlaylistMedia(o,a,"AUDIO",u),c=v.default.parseMasterPlaylistMedia(o,a,"SUBTITLES");if(l.length){var d=!1;l.forEach(function(e){e.url||(d=!0)}),!1===d&&s[0].audioCodec&&!s[0].attrs.AUDIO&&(f.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),l.unshift({type:"main",name:"main"}))}i.trigger(g.default.MANIFEST_LOADED,{levels:s,audioTracks:l,subtitles:c,url:a,stats:t,networkDetails:n})}else this._handleManifestParsingError(e,r,"no level found in manifest",n)},b.prototype._handleTrackOrLevelPlaylist=function(e,t,r,n){var i=this.hls,o=r.id,a=r.level,s=r.type,u=b.getResponseUrl(e,r),l=m.isFinite(o)?o:0,c=m.isFinite(a)?a:l,d=b.mapContextToLevelType(r),f=v.default.parseLevelPlaylist(e.data,u,c,d,l);if(f.tload=t.tload,s===_.MANIFEST){var h={url:u,details:f};i.trigger(g.default.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:u,stats:t,networkDetails:n})}if(t.tparsed=y.now(),f.needSidxRanges){var p=f.initSegment.url;this.load(p,{isSidxRequest:!0,type:s,level:a,levelDetails:f,id:o,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else r.levelDetails=f,this._handlePlaylistLoaded(e,t,r,n)},b.prototype._handleSidxRequest=function(e,t){var r=o.default.parseSegmentIndex(new Uint8Array(e.data));if(r){var n=r.references,i=t.levelDetails;n.forEach(function(e,t){var r=e.info,n=i.fragments[t];0===n.byteRange.length&&(n.rawByteRange=String(1+r.end-r.start)+"@"+String(r.start))}),i.initSegment.rawByteRange=String(r.moovEndOffset)+"@0"}},b.prototype._handleManifestParsingError=function(e,t,r,n){this.hls.trigger(g.default.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:r,networkDetails:n})},b.prototype._handleNetworkError=function(e,t,r,n){var i,o;void 0===r&&(r=!1),void 0===n&&(n=null),f.logger.info("A network error occured while loading a "+e.type+"-type playlist");var a=this.getInternalLoader(e);switch(e.type){case _.MANIFEST:i=r?u.ErrorDetails.MANIFEST_LOAD_TIMEOUT:u.ErrorDetails.MANIFEST_LOAD_ERROR,o=!0;break;case _.LEVEL:i=r?u.ErrorDetails.LEVEL_LOAD_TIMEOUT:u.ErrorDetails.LEVEL_LOAD_ERROR,o=!1;break;case _.AUDIO_TRACK:i=r?u.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,o=!1;break;default:o=!1}a&&(a.abort(),this.resetInternalLoader(e.type));var s={type:u.ErrorTypes.NETWORK_ERROR,details:i,fatal:o,url:a.url,loader:a,context:e,networkDetails:t};n&&(s.response=n),this.hls.trigger(g.default.ERROR,s)},b.prototype._handlePlaylistLoaded=function(e,t,r,n){var i=r.type,o=r.level,a=r.id,s=r.levelDetails;if(s.targetduration)if(b.canHaveQualityLevels(r.type))this.hls.trigger(g.default.LEVEL_LOADED,{details:s,level:o||0,id:a||0,stats:t,networkDetails:n});else switch(i){case _.AUDIO_TRACK:this.hls.trigger(g.default.AUDIO_TRACK_LOADED,{details:s,id:a,stats:t,networkDetails:n});break;case _.SUBTITLE_TRACK:this.hls.trigger(g.default.SUBTITLE_TRACK_LOADED,{details:s,id:a,stats:t,networkDetails:n})}else this._handleManifestParsingError(e,r,"invalid target duration",n)},b);function b(e){var t=r.call(this,e,g.default.MANIFEST_LOADING,g.default.LEVEL_LOADING,g.default.AUDIO_TRACK_LOADING,g.default.SUBTITLE_TRACK_LOADING)||this;return t.loaders={},t}s.default=a}).call(this,l("./src/polyfills/number.js").Number)},"./src/observer.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=r("./node_modules/eventemitter3/index.js"),s=(o=a.EventEmitter,i(u,o),u.prototype.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(t))},u);function u(){return null!==o&&o.apply(this,arguments)||this}t.Observer=s},"./src/polyfills/number.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/get-self-scope.js").getSelfScope().Number;(t.Number=n).isFinite=n.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},"./src/remux/aac-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(i.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},i);function i(){}t.default=n},"./src/remux/mp4-generator.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=Math.pow(2,32)-1,n=(f.init=function(){var e;for(e in f.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})f.types.hasOwnProperty(e)&&(f.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);f.HDLR_TYPES={video:t,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);f.STTS=f.STSC=f.STCO=i,f.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),f.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),f.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),f.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),s=new Uint8Array([0,0,0,1]);f.FTYP=f.box(f.types.ftyp,o,s,o,a),f.DINF=f.box(f.types.dinf,f.box(f.types.dref,n))},f.box=function(e){for(var t,r=Array.prototype.slice.call(arguments,1),n=8,i=r.length,o=i;i--;)n+=r[i].byteLength;for((t=new Uint8Array(n))[0]=n>>24&255,t[1]=n>>16&255,t[2]=n>>8&255,t[3]=255&n,t.set(e,4),i=0,n=8;i<o;i++)t.set(r[i],n),n+=r[i].byteLength;return t},f.hdlr=function(e){return f.box(f.types.hdlr,f.HDLR_TYPES[e])},f.mdat=function(e){return f.box(f.types.mdat,e)},f.mdhd=function(e,t){t*=e;var r=Math.floor(t/(1+s)),n=Math.floor(t%(1+s));return f.box(f.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},f.mdia=function(e){return f.box(f.types.mdia,f.mdhd(e.timescale,e.duration),f.hdlr(e.type),f.minf(e))},f.mfhd=function(e){return f.box(f.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},f.minf=function(e){return"audio"===e.type?f.box(f.types.minf,f.box(f.types.smhd,f.SMHD),f.DINF,f.stbl(e)):f.box(f.types.minf,f.box(f.types.vmhd,f.VMHD),f.DINF,f.stbl(e))},f.moof=function(e,t,r){return f.box(f.types.moof,f.mfhd(e),f.traf(r,t))},f.moov=function(e){for(var t=e.length,r=[];t--;)r[t]=f.trak(e[t]);return f.box.apply(null,[f.types.moov,f.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(f.mvex(e)))},f.mvex=function(e){for(var t=e.length,r=[];t--;)r[t]=f.trex(e[t]);return f.box.apply(null,[f.types.mvex].concat(r))},f.mvhd=function(e,t){t*=e;var r=Math.floor(t/(1+s)),n=Math.floor(t%(1+s)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return f.box(f.types.mvhd,i)},f.sdtp=function(e){var t,r,n=e.samples||[],i=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)t=n[r].flags,i[r+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return f.box(f.types.sdtp,i)},f.stbl=function(e){return f.box(f.types.stbl,f.stsd(e),f.box(f.types.stts,f.STTS),f.box(f.types.stsc,f.STSC),f.box(f.types.stsz,f.STSZ),f.box(f.types.stco,f.STCO))},f.avc1=function(e){var t,r,n,i=[],o=[];for(t=0;t<e.sps.length;t++)n=(r=e.sps[t]).byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)n=(r=e.pps[t]).byteLength,o.push(n>>>8&255),o.push(255&n),o=o.concat(Array.prototype.slice.call(r));var a=f.box(f.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(o))),s=e.width,u=e.height,l=e.pixelRatio[0],c=e.pixelRatio[1];return f.box(f.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,f.box(f.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),f.box(f.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,c>>24,c>>16&255,c>>8&255,255&c])))},f.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},f.mp4a=function(e){var t=e.samplerate;return f.box(f.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),f.box(f.types.esds,f.esds(e)))},f.mp3=function(e){var t=e.samplerate;return f.box(f.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))},f.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?f.box(f.types.stsd,f.STSD,f.mp4a(e)):f.box(f.types.stsd,f.STSD,f.mp3(e)):f.box(f.types.stsd,f.STSD,f.avc1(e))},f.tkhd=function(e){var t=e.id,r=e.duration*e.timescale,n=e.width,i=e.height,o=Math.floor(r/(1+s)),a=Math.floor(r%(1+s));return f.box(f.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))},f.traf=function(e,t){var r=f.sdtp(e),n=e.id,i=Math.floor(t/(1+s)),o=Math.floor(t%(1+s));return f.box(f.types.traf,f.box(f.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),f.box(f.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,o>>24,o>>16&255,o>>8&255,255&o])),f.trun(e,r.length+16+20+8+16+8+8),r)},f.trak=function(e){return e.duration=e.duration||4294967295,f.box(f.types.trak,f.tkhd(e),f.mdia(e))},f.trex=function(e){var t=e.id;return f.box(f.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},f.trun=function(e,t){var r,n,i,o,a,s,u=e.samples||[],l=u.length,c=12+16*l,d=new Uint8Array(c);for(t+=8+c,d.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),r=0;r<l;r++)i=(n=u[r]).duration,o=n.size,a=n.flags,s=n.cts,d.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,o>>>24&255,o>>>16&255,o>>>8&255,255&o,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,s>>>24&255,s>>>16&255,s>>>8&255,255&s],12+16*r);return f.box(f.types.trun,d)},f.initSegment=function(e){f.types||f.init();var t,r=f.moov(e);return(t=new Uint8Array(f.FTYP.byteLength+r.byteLength)).set(f.FTYP),t.set(r,f.FTYP.byteLength),t},f);function f(){}t.default=n},"./src/remux/mp4-remuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var V=r("./src/remux/aac-helper.js"),X=r("./src/remux/mp4-generator.js"),Q=r("./src/events.js"),J=r("./src/errors.js"),Z=r("./src/utils/logger.js"),n=(i.prototype.destroy=function(){},i.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},i.prototype.resetInitSegment=function(){this.ISGenerated=!1},i.prototype.remux=function(e,t,r,n,i,o,a){if(this.ISGenerated||this.generateIS(e,t,i),this.ISGenerated){var s=e.samples.length,u=t.samples.length,l=i,c=i;if(s&&u){var d=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;l+=Math.max(0,d),c+=Math.max(0,-d)}if(s){e.timescale||(Z.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,i));var f=this.remuxAudio(e,l,o,a);if(u){var h=void 0;f&&(h=f.endPTS-f.startPTS),t.timescale||(Z.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,i)),this.remuxVideo(t,c,o,h,a)}}else if(u){var p=this.remuxVideo(t,c,o,0,a);p&&e.codec&&this.remuxEmptyAudio(e,l,o,p)}}r.samples.length&&this.remuxID3(r,i),n.samples.length&&this.remuxText(n,i),this.observer.trigger(Q.default.FRAG_PARSED)},i.prototype.generateIS=function(e,t,r){var n,i,o=this.observer,a=e.samples,s=t.samples,u=this.typeSupported,l="audio/mp4",c={},d={tracks:c},f=void 0===this._initPTS;if(f&&(n=i=1/0),e.config&&a.length&&(e.timescale=e.samplerate,Z.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(u.mpeg?(l="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3")),c.audio={container:l,codec:e.codec,initSegment:!e.isAAC&&u.mpeg?new Uint8Array:X.default.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(n=i=a[0].pts-e.inputTimeScale*r)),t.sps&&t.pps&&s.length){var h=t.inputTimeScale;t.timescale=h,c.video={container:"video/mp4",codec:t.codec,initSegment:X.default.initSegment([t]),metadata:{width:t.width,height:t.height}},f&&(n=Math.min(n,s[0].pts-h*r),i=Math.min(i,s[0].dts-h*r),this.observer.trigger(Q.default.INIT_PTS_FOUND,{initPTS:n}))}Object.keys(c).length?(o.trigger(Q.default.FRAG_PARSING_INIT_SEGMENT,d),this.ISGenerated=!0,f&&(this._initPTS=n,this._initDTS=i)):o.trigger(Q.default.ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},i.prototype.remuxVideo=function(e,t,r,n,i){var o,a,s,u,l,c,d,f=8,h=e.timescale,p=e.samples,m=[],g=p.length,v=this._PTSNormalize,y=this._initPTS,_=this.nextAvcDts,b=this.isSafari;if(0!==g){b&&(r|=p.length&&_&&(i&&Math.abs(t-_/h)<.1||Math.abs(p[0].pts-_-y)<h/5)),r||(_=t*h),p.forEach(function(e){e.pts=v(e.pts-y,_),e.dts=v(e.dts-y,_)}),p.sort(function(e,t){var r=e.dts-t.dts,n=e.pts-t.pts;return r||n||e.id-t.id});var E=p.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(E<0){Z.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(E/90)+" ms to overcome this issue");for(var w=0;w<p.length;w++)p[w].dts+=E}var A=p[0];l=Math.max(A.dts,0),u=Math.max(A.pts,0);var T=Math.round((l-_)/90);r&&T&&(1<T?Z.logger.log("AVC:"+T+" ms hole between fragments detected,filling it"):T<-1&&Z.logger.log("AVC:"+-T+" ms overlapping between fragments detected"),l=_,p[0].dts=l,u=Math.max(u-T,_),p[0].pts=u,Z.logger.log("Video/PTS/DTS adjusted: "+Math.round(u/90)+"/"+Math.round(l/90)+",delta:"+T+" ms")),A=p[p.length-1],d=Math.max(A.dts,0),c=Math.max(A.pts,0,d),b&&(o=Math.round((d-l)/(p.length-1)));var S=0,x=0;for(w=0;w<g;w++){for(var M=p[w],R=M.units,O=R.length,P=0,C=0;C<O;C++)P+=R[C].data.length;x+=P,S+=O,M.length=P,M.dts=b?l+w*o:Math.max(M.dts,l),M.pts=Math.max(M.pts,M.dts)}var D=x+4*S+8;try{a=new Uint8Array(D)}catch(e){return void this.observer.trigger(Q.default.ERROR,{type:J.ErrorTypes.MUX_ERROR,details:J.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:D,reason:"fail allocating video mdat "+D})}var I=new DataView(a.buffer);for(I.setUint32(0,D),a.set(X.default.types.mdat,4),w=0;w<g;w++){var L=p[w],N=L.units,k=0,F=void 0;for(C=0,O=N.length;C<O;C++){var j=N[C],B=j.data,U=j.data.byteLength;I.setUint32(f,U),f+=4,a.set(B,f),f+=U,k+=4+U}if(b)F=Math.max(0,o*Math.round((L.pts-L.dts)/o));else{if(w<g-1)o=p[w+1].dts-L.dts;else{var G=this.config,H=L.dts-p[0<w?w-1:w].dts;if(G.stretchShortVideoTrack){var V=G.maxBufferHole,z=Math.floor(V*h),W=(n?u+n*h:this.nextAudioPts)-L.pts;z<W?((o=W-H)<0&&(o=H),Z.logger.log("It is approximately "+W/90+" ms to the next segment; using duration "+o/90+" ms for the last video frame.")):o=H}else o=H}F=Math.round(L.pts-L.dts)}m.push({size:k,duration:o,cts:F,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:L.key?2:1,isNonSync:L.key?0:1}})}this.nextAvcDts=d+o;var q=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,m.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")){var Y=m[0].flags;Y.dependsOn=2,Y.isNonSync=0}e.samples=m,s=X.default.moof(e.sequenceNumber++,l,e),e.samples=[];var K={data1:s,data2:a,startPTS:u/h,endPTS:(c+o)/h,startDTS:l/h,endDTS:this.nextAvcDts/h,type:"video",hasAudio:!1,hasVideo:!0,nb:m.length,dropped:q};return this.observer.trigger(Q.default.FRAG_PARSING_DATA,K),K}},i.prototype.remuxAudio=function(e,t,r,n){var i,o,a,s,u,l,c,d=e.inputTimeScale,f=e.timescale,h=d/f,p=(e.isAAC?1024:1152)*h,m=this._PTSNormalize,g=this._initPTS,v=!e.isAAC&&this.typeSupported.mpeg,y=e.samples,_=[],b=this.nextAudioPts;if(r|=y.length&&b&&(n&&Math.abs(t-b/d)<.1||Math.abs(y[0].pts-b-g)<20*p),y.forEach(function(e){e.pts=e.dts=m(e.pts-g,t*d)}),0!==(y=y.filter(function(e){return 0<=e.pts})).length){if(r||(b=n?t*d:y[0].pts),e.isAAC)for(var E=this.config.maxAudioFramesDrift,w=0,A=b;w<y.length;){var T,S=y[w];T=(I=S.pts)-A;var x=Math.abs(1e3*T/d);if(T<=-E*p)Z.logger.warn("Dropping 1 audio frame @ "+(A/d).toFixed(3)+"s due to "+Math.round(x)+" ms overlap."),y.splice(w,1),e.len-=S.unit.length;else if(E*p<=T&&x<1e4&&A){var M=Math.round(T/p);Z.logger.warn("Injecting "+M+" audio frame @ "+(A/d).toFixed(3)+"s due to "+Math.round(1e3*T/d)+" ms gap.");for(var R=0;R<M;R++){var O=Math.max(A,0);(a=V.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(Z.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),a=S.unit.subarray()),y.splice(w,0,{unit:a,pts:O,dts:O}),e.len+=a.length,A+=p,w++}S.pts=S.dts=A,A+=p,w++}else Math.abs(T),S.pts=S.dts=A,A+=p,w++}R=0;for(var P=y.length;R<P;R++){var C=y[R],D=C.unit,I=C.pts;if(void 0!==c)o.duration=Math.round((I-c)/h);else{var L=Math.round(1e3*(I-b)/d),N=0;if(r&&e.isAAC&&L){if(0<L&&L<1e4)N=Math.round((I-b)/p),Z.logger.log(L+" ms hole between AAC samples detected,filling it"),0<N&&(a=(a=V.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||D.subarray(),e.len+=N*a.length);else if(L<-12){Z.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(b/d).toFixed(3)+"s/"+(I/d).toFixed(3)+"s/"+-L+"ms"),e.len-=D.byteLength;continue}I=b}if(l=I,!(0<e.len))return;var k=v?e.len:e.len+8;i=v?0:8;try{s=new Uint8Array(k)}catch(e){return void this.observer.trigger(Q.default.ERROR,{type:J.ErrorTypes.MUX_ERROR,details:J.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:k,reason:"fail allocating audio mdat "+k})}for(v||(new DataView(s.buffer).setUint32(0,k),s.set(X.default.types.mdat,4)),w=0;w<N;w++)(a=V.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(Z.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),a=D.subarray()),s.set(a,i),i+=a.byteLength,o={size:a.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},_.push(o)}s.set(D,i);var F=D.byteLength;i+=F,o={size:F,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},_.push(o),c=I}var j=0,B=_.length;if(2<=B&&(j=_[B-2].duration,o.duration=j),B){this.nextAudioPts=b=c+h*j,e.len=0,e.samples=_,u=v?new Uint8Array:X.default.moof(e.sequenceNumber++,l/h,e),e.samples=[];var U=l/d,G=b/d,H={data1:u,data2:s,startPTS:U,endPTS:G,startDTS:U,endDTS:G,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.observer.trigger(Q.default.FRAG_PARSING_DATA,H),H}return null}},i.prototype.remuxEmptyAudio=function(e,t,r,n){var i=e.inputTimeScale,o=i/(e.samplerate?e.samplerate:i),a=this.nextAudioPts,s=(void 0!==a?a:n.startDTS*i)+this._initDTS,u=n.endDTS*i+this._initDTS,l=1024*o,c=Math.ceil((u-s)/l),d=V.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(Z.logger.warn("remux empty Audio"),d){for(var f=[],h=0;h<c;h++){var p=s+h*l;f.push({unit:d,pts:p,dts:p}),e.len+=d.length}e.samples=f,this.remuxAudio(e,t,r)}else Z.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},i.prototype.remuxID3=function(e){var t,r=e.samples.length,n=e.inputTimeScale,i=this._initPTS,o=this._initDTS;if(r){for(var a=0;a<r;a++)(t=e.samples[a]).pts=(t.pts-i)/n,t.dts=(t.dts-o)/n;this.observer.trigger(Q.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},i.prototype.remuxText=function(e){e.samples.sort(function(e,t){return e.pts-t.pts});var t,r=e.samples.length,n=e.inputTimeScale,i=this._initPTS;if(r){for(var o=0;o<r;o++)(t=e.samples[o]).pts=(t.pts-i)/n;this.observer.trigger(Q.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},i.prototype._PTSNormalize=function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=r;return e},i);function i(e,t,r,n){this.observer=e,this.config=t,this.typeSupported=r;var i=navigator.userAgent;this.isSafari=n&&-1<n.indexOf("Apple")&&i&&!i.match("CriOS"),this.ISGenerated=!1}t.default=n},"./src/remux/passthrough-remuxer.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=r("./src/events.js"),n=(i.prototype.destroy=function(){},i.prototype.resetTimeStamp=function(){},i.prototype.resetInitSegment=function(){},i.prototype.remux=function(e,t,r,n,i,o,a,s){var u=this.observer,l="";e&&(l+="audio"),t&&(l+="video"),u.trigger(c.default.FRAG_PARSING_DATA,{data1:s,startPTS:i,startDTS:i,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),u.trigger(c.default.FRAG_PARSED)},i);function i(e){this.observer=e}t.default=n},"./src/task-loop.js":function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=r("./src/event-handler.js"),s=(o=a.default,i(u,o),u.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},u.prototype.hasInterval=function(){return!!this._tickInterval},u.prototype.hasNextTick=function(){return!!this._tickTimer},u.prototype.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)},u.prototype.clearInterval=function(){return!(!this._tickInterval||(clearInterval(this._tickInterval),this._tickInterval=null))},u.prototype.clearNextTick=function(){return!(!this._tickTimer||(clearTimeout(this._tickTimer),this._tickTimer=null))},u.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},u.prototype.doTick=function(){},u);function u(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=o.apply(this,[e].concat(t))||this;return n._tickInterval=null,n._tickTimer=null,n._tickCallCount=0,n._boundTick=n.tick.bind(n),n}t.default=s},"./src/utils/attr-list.js":function(e,t,r){"use strict";(function(r){Object.defineProperty(t,"__esModule",{value:!0});var n=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,e=(o.prototype.decimalInteger=function(e){var t=parseInt(this[e],10);return t>r.MAX_SAFE_INTEGER?1/0:t},o.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null},o.prototype.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>r.MAX_SAFE_INTEGER?1/0:t},o.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},o.prototype.enumeratedString=function(e){return this[e]},o.prototype.decimalResolution=function(e){var t=n.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},o.parseAttrList=function(e){var t,r={};for(i.lastIndex=0;null!==(t=i.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1]]=n}return r},o);function o(e){for(var t in"string"==typeof e&&(e=o.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}t.default=e}).call(this,r("./src/polyfills/number.js").Number)},"./src/utils/binary-search.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={search:function(e,t){for(var r=0,n=e.length-1,i=null,o=null;r<=n;){var a=t(o=e[i=(r+n)/2|0]);if(0<a)r=i+1;else{if(!(a<0))return o;n=i-1}}return null}}},"./src/utils/buffer-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(i.isBuffered=function(e,t){try{if(e)for(var r=e.buffered,n=0;n<r.length;n++)if(t>=r.start(n)&&t<=r.end(n))return!0}catch(e){}return!1},i.bufferInfo=function(e,t,r){try{if(e){var n=e.buffered,i=[],o=void 0;for(o=0;o<n.length;o++)i.push({start:n.start(o),end:n.end(o)});return this.bufferedInfo(i,t,r)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},i.bufferedInfo=function(e,t,r){var n,i,o,a,s,u=[];for(e.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end}),s=0;s<e.length;s++){var l=u.length;if(l){var c=u[l-1].end;e[s].start-c<r?e[s].end>c&&(u[l-1].end=e[s].end):u.push(e[s])}else u.push(e[s])}for(n=s=0,i=o=t;s<u.length;s++){var d=u[s].start,f=u[s].end;if(d<=t+r&&t<f)i=d,n=(o=f)-t;else if(t+r<d){a=d;break}}return{len:n,start:i,end:o,nextStart:a}},i);function i(){}t.BufferHelper=n},"./src/utils/cea-608-parser.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function s(e){var t=e;return n.hasOwnProperty(e)&&(t=n[e]),String.fromCharCode(t)}function u(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t}var n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},a={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},c={25:2,26:4,29:6,30:8,31:10,27:13,28:15},d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],f={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e];this.verboseLevel}},h=(i.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},i.prototype.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},i.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},i.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},i.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},i.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},i);function i(e,t,r,n,i){this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1}var p=(m.prototype.reset=function(){this.uchar=" ",this.penState.reset()},m.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},m.prototype.setPenState=function(e){this.penState.copy(e)},m.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},m.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},m.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},m);function m(e,t,r,n,i,o){this.uchar=e||" ",this.penState=new h(t,r,n,i,o)}var g=(v.prototype.equals=function(e){for(var t=!0,r=0;r<100;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},v.prototype.copy=function(e){for(var t=0;t<100;t++)this.chars[t].copy(e.chars[t])},v.prototype.isEmpty=function(){for(var e=!0,t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},v.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(f.log("ERROR","Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(f.log("ERROR","Too large cursor position "+this.pos),this.pos=100)},v.prototype.moveCursor=function(e){var t=this.pos+e;if(1<e)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},v.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},v.prototype.insertChar=function(e){144<=e&&this.backSpace();var t=s(e);100<=this.pos?f.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},v.prototype.clearFromPos=function(e){var t;for(t=e;t<100;t++)this.chars[t].reset()},v.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},v.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},v.prototype.getTextString=function(){for(var e=[],t=!0,r=0;r<100;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},v.prototype.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},v);function v(){this.chars=[];for(var e=0;e<100;e++)this.chars.push(new p);this.pos=0,this.currPenState=new h}var y=(_.prototype.reset=function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14},_.prototype.equals=function(e){for(var t=!0,r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},_.prototype.copy=function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])},_.prototype.isEmpty=function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},_.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},_.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},_.prototype.insertChar=function(e){this.rows[this.currRow].insertChar(e)},_.prototype.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},_.prototype.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},_.prototype.setCursor=function(e){f.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},_.prototype.setPAC=function(e){f.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<15;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var o=i.rows[n].cueStartTime;if(o&&o<f.time)for(r=0;r<this.nrRollUpRows;r++)this.rows[t-this.nrRollUpRows+r+1].copy(i.rows[n+r])}}this.currRow=t;var a=this.rows[this.currRow];if(null!==e.indent){var s=e.indent,u=Math.max(s-1,0);a.setCursor(e.indent),e.color=a.chars[u].penState.foreground}var l={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(l)},_.prototype.setBkgData=function(e){f.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},_.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},_.prototype.rollUp=function(){if(null!==this.nrRollUpRows){f.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),f.log("INFO","Rolling up")}else f.log("DEBUG","roll_up but nrRollUpRows not set yet")},_.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],r="",n=-1,i=0;i<15;i++){var o=this.rows[i].getTextString();o&&(n=i+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return 0<t.length&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},_.prototype.getTextAndFormat=function(){return this.rows},_);function _(){this.rows=[];for(var e=0;e<15;e++)this.rows.push(new g);this.currRow=14,this.nrRollUpRows=null,this.reset()}var b=(E.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},E.prototype.getHandler=function(){return this.outputFilter},E.prototype.setHandler=function(e){this.outputFilter=e},E.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},E.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},E.prototype.setMode=function(e){e!==this.mode&&(this.mode=e,f.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},E.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";f.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(f.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},E.prototype.ccRCL=function(){f.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},E.prototype.ccBS=function(){f.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},E.prototype.ccAOF=function(){},E.prototype.ccAON=function(){},E.prototype.ccDER=function(){f.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},E.prototype.ccRU=function(e){f.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},E.prototype.ccFON=function(){f.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},E.prototype.ccRDC=function(){f.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},E.prototype.ccTR=function(){f.log("INFO","TR"),this.setMode("MODE_TEXT")},E.prototype.ccRTD=function(){f.log("INFO","RTD"),this.setMode("MODE_TEXT")},E.prototype.ccEDM=function(){f.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},E.prototype.ccCR=function(){f.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},E.prototype.ccENM=function(){f.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},E.prototype.ccEOC=function(){if(f.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,f.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},E.prototype.ccTO=function(e){f.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},E.prototype.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=46<=e,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}f.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},E.prototype.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=f.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},E.prototype.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},E);function E(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new y,this.nonDisplayedMemory=new y,this.lastOutputScreen=new y,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}var w=(A.prototype.getHandler=function(e){return this.channels[e].getHandler()},A.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},A.prototype.addData=function(e,t){var r,n,i,o=!1;this.lastTime=e,f.setTime(e);for(var a=0;a<t.length;a+=2)n=127&t[a],i=127&t[a+1],0!=n||0!=i?(f.log("DATA","["+u([t[a],t[a+1]])+"] -> ("+u([n,i])+")"),(r=(r=(r=(r=this.parseCmd(n,i))||this.parseMidrow(n,i))||this.parsePAC(n,i))||this.parseBackgroundAttributes(n,i))||(o=this.parseChars(n,i))&&(this.currChNr&&0<=this.currChNr?this.channels[this.currChNr-1].insertChars(o):f.log("WARNING","No channel found yet. TEXT-MODE?")),r?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,f.log("WARNING","Couldn't parse cleaned data "+u([n,i])+" orig: "+u([t[a],t[a+1]])))):this.dataCounters.padding+=2},A.prototype.parseCmd=function(e,t){var r=null;if(!((20===e||28===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,f.log("DEBUG","Repeated command ("+u([e,t])+") is dropped"),!0;r=20===e||23===e?1:2;var n=this.channels[r-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},A.prototype.parseMidrow=function(e,t){var r=null;return(17===e||25===e)&&32<=t&&t<=47&&((r=17===e?1:2)!==this.currChNr?(f.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[r-1].ccMIDROW(t),f.log("DEBUG","MIDROW ("+u([e,t])+")"),!0))},A.prototype.parsePAC=function(e,t){var r,n=null;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,!(this.lastCmdB=null);r=e<=23?1:2,n=64<=t&&t<=95?1==r?o[e]:l[e]:1==r?a[e]:c[e];var i=this.interpretPAC(n,t);return this.channels[r-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},A.prototype.interpretPAC=function(e,t){var r=t,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=95<t?t-96:t-64,n.underline=1==(1&r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},A.prototype.parseChars=function(e,t){var r=null,n=null,i=null;if(17<=(i=25<=e?(r=2,e-8):(r=1,e))&&i<=19){var o=t;o=17===i?t+80:18===i?t+112:t+144,f.log("INFO","Special char '"+s(o)+"' in channel "+r),n=[o]}else 32<=e&&e<=127&&(n=0===t?[e]:[e,t]);if(n){var a=u(n);f.log("DEBUG","Char codes =  "+a.join(",")),this.lastCmdA=null,this.lastCmdB=null}return n},A.prototype.parseBackgroundAttributes=function(e,t){var r,n,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(r={},16===e||24===e?(n=Math.floor((t-32)/2),r.background=d[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(r),this.lastCmdA=null,!(this.lastCmdB=null))},A.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},A.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},A);function A(e,t,r){this.field=e||1,this.outputs=[t,r],this.channels=[new b(1,t),new b(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}t.default=w},"./src/utils/codecs.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};t.isCodecType=function(e,t){var r=n[t];return!!r&&!0===r[e.slice(0,4)]},t.isCodecSupportedInMp4=function(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=r("./src/utils/vttparser.js");t.newCue=function(e,t,r,n){for(var i,o,a,s,u,l=window.VTTCue||window.TextTrackCue,c=0;c<n.rows.length;c++)if(a=!0,s=0,u="",!(i=n.rows[c]).isEmpty()){for(var d=0;d<i.chars.length;d++)i.chars[d].uchar.match(/\s/)&&a?s++:(u+=i.chars[d].uchar,a=!1);(i.cueStartTime=t)===r&&(r+=1e-4),o=new l(t,r,f.fixLineBreaks(u.trim())),16<=s?s--:s++,navigator.userAgent.match(/Firefox\//)?o.line=c+1:o.line=7<c?c-2:c+1,o.align="left",o.position=Math.max(0,Math.min(100,s/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(o)}}},"./src/utils/discontinuities.js":function(e,t,d){"use strict";(function(i){Object.defineProperty(t,"__esModule",{value:!0});var r=d("./src/utils/binary-search.js"),o=d("./src/utils/logger.js");function a(e,t){for(var r=null,n=0;n<e.length;n+=1){var i=e[n];if(i&&i.cc===t){r=i;break}}return r}function s(e,t,r){var n=!1;return t&&t.details&&r&&(r.endCC>r.startCC||e&&e.cc<r.startCC)&&(n=!0),n}function u(e,t){var r=e.fragments,n=t.fragments;if(n.length&&r.length){var i=a(r,n[0].cc);if(i&&(!i||i.startPTS))return i;o.logger.log("No frag in previous level to align on")}else o.logger.log("No fragments to align")}function l(r,e){e.fragments.forEach(function(e){if(e){var t=e.start+r;e.start=e.startPTS=t,e.endPTS=t+e.duration}}),e.PTSKnown=!0}function n(e,t,r){if(s(e,r,t)){var n=u(r.details,t);n&&(o.logger.log("Adjusting PTS using last level due to CC increase within current level"),l(n.start,t))}}function c(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var r=t.fragments[0].programDateTime,n=(e.fragments[0].programDateTime-r)/1e3+t.fragments[0].start;i.isFinite(n)&&(o.logger.log("adjusting PTS using programDateTime delta, sliding:"+n.toFixed(3)),l(n,e))}}t.findFirstFragWithCC=a,t.findFragWithCC=function(e,t){return r.default.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})},t.shouldAlignOnDiscontinuities=s,t.findDiscontinuousReferenceFrag=u,t.adjustPts=l,t.alignStream=function(e,t,r){n(e,r,t),!r.PTSKnown&&t&&c(r,t.details)},t.alignDiscontinuities=n,t.alignPDT=c}).call(this,d("./src/polyfills/number.js").Number)},"./src/utils/ewma-bandwidth-estimator.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./src/utils/ewma.js"),n=(o.prototype.sample=function(e,t){var r=8e3*t/(e=Math.max(e,this.minDelayMs_)),n=e/1e3;this.fast_.sample(n,r),this.slow_.sample(n,r)},o.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},o.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},o.prototype.destroy=function(){},o);function o(e,t,r,n){this.hls=e,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new i.default(t),this.fast_=new i.default(r)}t.default=n},"./src/utils/ewma.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(i.prototype.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},i.prototype.getTotalWeight=function(){return this.totalWeight_},i.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},i);function i(e){this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}t.default=n},"./src/utils/get-self-scope.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},"./src/utils/logger.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/get-self-scope.js");function i(){}var o={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=o;var s=n.getSelfScope();function u(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];e.forEach(function(e){a[e]=t[e]?t[e].bind(t):function(r){var n=s.console[r];return n?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e[0]&&(e[0]=function(e,t){return t="["+e+"] > "+t}(r,e[0])),n.apply(s.console,e)}:i}(e)})}t.enableLogs=function(e){if(!0===e||"object"==typeof e){u(e,"debug","log","info","warn","error");try{a.log()}catch(e){a=o}}else a=o},t.logger=a},"./src/utils/mediakeys-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;t.requestMediaKeySystemAccess=n},"./src/utils/mediasource-helper.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaSource=function(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}},"./src/utils/output-filter.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(i.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},i.prototype.newCue=function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},i);function i(e,t){this.timelineController=e,this.trackName=t,this.startTime=null,this.endTime=null,this.screen=null}t.default=n},"./src/utils/texttrack-utils.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendAddTrackEvent=function(e,t){var r=null;try{r=new window.Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)},t.clearCurrentCues=function(e){if(e&&e.cues)for(;0<e.cues.length;)e.removeCue(e.cues[0])}},"./src/utils/time-ranges.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={toString:function(e){for(var t="",r=e.length,n=0;n<r;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}}},"./src/utils/vttcue.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var b={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function E(e){return"string"==typeof e&&(!!t[e.toLowerCase()]&&e.toLowerCase())}function w(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function e(e,t,r){var n=this,i=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),o={};i?n=document.createElement("custom"):o.enumerable=!0,n.hasBeenReset=!1;var a="",s=!1,u=e,l=t,c=r,d=null,f="",h=!0,p="auto",m="start",g=50,v="middle",y=50,_="middle";if(Object.defineProperty(n,"id",w({},o,{get:function(){return a},set:function(e){a=""+e}})),Object.defineProperty(n,"pauseOnExit",w({},o,{get:function(){return s},set:function(e){s=!!e}})),Object.defineProperty(n,"startTime",w({},o,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(n,"endTime",w({},o,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(n,"text",w({},o,{get:function(){return c},set:function(e){c=""+e,this.hasBeenReset=!0}})),Object.defineProperty(n,"region",w({},o,{get:function(){return d},set:function(e){d=e,this.hasBeenReset=!0}})),Object.defineProperty(n,"vertical",w({},o,{get:function(){return f},set:function(e){var t=function(e){return"string"==typeof e&&(!!b[e.toLowerCase()]&&e.toLowerCase())}(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"snapToLines",w({},o,{get:function(){return h},set:function(e){h=!!e,this.hasBeenReset=!0}})),Object.defineProperty(n,"line",w({},o,{get:function(){return p},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(n,"lineAlign",w({},o,{get:function(){return m},set:function(e){var t=E(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"position",w({},o,{get:function(){return g},set:function(e){if(e<0||100<e)throw new Error("Position must be between 0 and 100.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(n,"positionAlign",w({},o,{get:function(){return v},set:function(e){var t=E(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(n,"size",w({},o,{get:function(){return y},set:function(e){if(e<0||100<e)throw new Error("Size must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(n,"align",w({},o,{get:function(){return _},set:function(e){var t=E(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),n.displayState=void 0,i)return n}return e.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},e}()},"./src/utils/vttparser.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function n(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}var s=r("./src/utils/vttcue.js");function i(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new n,this.regionList=[]}function u(){this.values=Object.create(null)}function l(e,t,r,n){var i=n?e.split(n):[e];for(var o in i)if("string"==typeof i[o]){var a=i[o].split(r);if(2===a.length)t(a[0],a[1])}}u.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(t=parseFloat(t))&&t<=100)&&(this.set(e,t),!0)}};var c=new s.default(0,0,0),d="middle"===c.align?"middle":"center";function f(t,e,a){var r=t;function n(){var e=function(e){function t(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+(0|n)/1e3}var r=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return r?r[3]?t(r[1],r[2],r[3].replace(":",""),r[4]):59<r[1]?t(r[1],r[2],0,r[4]):t(0,r[1],r[2],r[4]):null}(t);if(null===e)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function i(){t=t.replace(/^\s+/,"")}if(i(),e.startTime=n(),i(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);t=t.substr(3),i(),e.endTime=n(),i(),function(e,t){var o=new u;l(e,function(e,t){switch(e){case"region":for(var r=a.length-1;0<=r;r--)if(a[r].id===t){o.set(e,a[r].region);break}break;case"vertical":o.alt(e,t,["rl","lr"]);break;case"line":var n=t.split(","),i=n[0];o.integer(e,i),o.percent(e,i)&&o.set("snapToLines",!1),o.alt(e,i,["auto"]),2===n.length&&o.alt("lineAlign",n[1],["start",d,"end"]);break;case"position":n=t.split(","),o.percent(e,n[0]),2===n.length&&o.alt("positionAlign",n[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":o.percent(e,t);break;case"align":o.alt(e,t,["start",d,"end","left","right"])}},/:/,/\s/),t.region=o.get("region",null),t.vertical=o.get("vertical","");var r=o.get("line","auto");"auto"===r&&-1===c.line&&(r=-1),t.line=r,t.lineAlign=o.get("lineAlign","start"),t.snapToLines=o.get("snapToLines",!0),t.size=o.get("size",100),t.align=o.get("align",d);var n=o.get("position","auto");"auto"===n&&50===c.position&&(n="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=n}(t,e)}function h(e){return e.replace(/<br(?: \/)?>/gi,"\n")}t.fixLineBreaks=h,i.prototype={parse:function(e){var n=this;function t(){var e=n.buffer,t=0;for(e=h(e);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,n.buffer=e.substr(t),r}e&&(n.buffer+=n.decoder.decode(e,{stream:!0}));try{var r=void 0;if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;var i=(r=t()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var o=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(o?o=!1:r=t(),n.state){case"HEADER":/:/.test(r)?l(r,function(e,t){},/:/):r||(n.state="ID");continue;case"NOTE":r||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){n.state="NOTE";break}if(!r)continue;if(n.cue=new s.default(0,0,""),n.state="CUE",-1===r.indexOf("--\x3e")){n.cue.id=r;continue}case"CUE":try{f(r,n.cue,n.regionList)}catch(e){n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var a=-1!==r.indexOf("--\x3e");if(!r||a&&(o=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=r;continue;case"BADCUE":r||(n.state="ID");continue}}}catch(e){"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),!this.cue&&"HEADER"!==this.state||(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}},t.default=i},"./src/utils/webvtt-parser.js":function(e,t,r){"use strict";(function(m){Object.defineProperty(t,"__esModule",{value:!0});function g(e,t,r){return e.substr(r||0,t.length)===t}function v(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()}var y=r("./src/utils/vttparser.js"),_=r("./src/demux/id3.js"),e={parse:function(e,r,n,i,t,o){var a,s=_.utf8ArrayToStr(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),u="00:00.000",l=0,c=0,d=0,f=[],h=!0,p=new y.default;p.oncue=function(e){var t=n[i],r=n.ccOffset;t&&t.new&&(void 0!==c?r=n.ccOffset=t.start:function(e,t,r){var n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,n.new=!1;for(;i&&i.new;)e.ccOffset+=n.start-i.start,n.new=!1,i=e[(n=i).prevCC];e.presentationOffset=r}(n,i,d)),d&&(r=d-n.presentationOffset),e.startTime+=r-c,e.endTime+=r-c,e.id=v(e.startTime.toString())+v(e.endTime.toString())+v(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),0<e.endTime&&f.push(e)},p.onparsingerror=function(e){a=e},p.onflush=function(){a&&o?o(a):t(f)},s.forEach(function(t){if(h){if(g(t,"X-TIMESTAMP-MAP=")){h=!1,t.substr(16).split(",").forEach(function(e){g(e,"LOCAL:")?u=e.substr(6):g(e,"MPEGTS:")&&(l=parseInt(e.substr(7)))});try{r+(9e4*n[i].start||0)<0&&(r+=8589934592),l-=r,c=function(e){var t=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),n=parseInt(e.substr(-9,2)),i=9<e.length?parseInt(e.substr(0,e.indexOf(":"))):0;return m.isFinite(t)&&m.isFinite(r)&&m.isFinite(n)&&m.isFinite(i)?(t+=1e3*r,t+=6e4*n,t+=36e5*i):-1}(u)/1e3,d=l/9e4,-1===c&&(a=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){a=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(h=!1)}p.parse(t+"\n")}),p.flush()}};t.default=e}).call(this,r("./src/polyfills/number.js").Number)},"./src/utils/xhr-loader.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=r("./src/utils/logger.js"),d=window.performance,i=window.XMLHttpRequest,n=(o.prototype.destroy=function(){this.abort(),this.loader=null},o.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},o.prototype.load=function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:d.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},o.prototype.loadInternal=function(){var t,r=this.context;t=this.loader=new i;var e=this.stats;e.tfirst=0,e.loaded=0;var n=this.xhrSetup;try{if(n)try{n(t,r.url)}catch(e){t.open("GET",r.url,!0),n(t,r.url)}t.readyState||t.open("GET",r.url,!0)}catch(e){return void this.callbacks.onError({code:t.status,text:e.message},r,t)}r.rangeEnd&&t.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=r.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},o.prototype.readystatechange=function(e){var t=e.currentTarget,r=t.readyState,n=this.stats,i=this.context,o=this.config;if(!n.aborted&&2<=r)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(d.now(),n.trequest)),4===r){var a=t.status;if(200<=a&&a<300){n.tload=Math.max(n.tfirst,d.now());var s=void 0,u=void 0;u="arraybuffer"===i.responseType?(s=t.response).byteLength:(s=t.responseText).length,n.loaded=n.total=u;var l={url:t.responseURL,data:s};this.callbacks.onSuccess(l,n,i,t)}else n.retry>=o.maxRetry||400<=a&&a<499?(c.logger.error(a+" while loading "+i.url),this.callbacks.onError({code:a,text:t.statusText},i,t)):(c.logger.warn(a+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},o.prototype.loadtimeout=function(){c.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},o.prototype.loadprogress=function(e){var t=e.currentTarget,r=this.stats;r.loaded=e.loaded,e.lengthComputable&&(r.total=e.total);var n=this.callbacks.onProgress;n&&n(r,this.context,null,t)},o);function o(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}t.default=n}},i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist/",i(i.s="./src/hls.js")).default;function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var r,n},"object"==typeof r&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof r?r.Hls=i():n.Hls=i())},{}],566:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,d=r?i-1:0,f=r?-1:1,h=e[t+d];for(d+=f,o=h&(1<<-c)-1,h>>=-c,c+=s;0<c;o=256*o+e[t+d],d+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;0<c;a=256*a+e[t+d],d+=f,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),o-=l}return(h?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,d=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),2<=(t+=1<=a+d?f/u:f*Math.pow(2,1-d))*u&&(a++,u/=2),c<=a+d?(s=0,a=c):1<=a+d?(s=(t*u-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));8<=i;e[r+h]=255&s,h+=p,s/=256,i-=8);for(a=a<<i|s,l+=i;0<l;e[r+h]=255&a,h+=p,a/=256,l-=8);e[r+h-p]|=128*m}},{}],567:[function(e,t,r){function c(e,t,r,n){var i=n&&"seq"===n.timeContainer,o=0;n&&(o=i&&r?r.end:n.begin),t.begin=t.explicit_begin?t.explicit_begin+o:o;var a=t.begin,s=null;for(var u in t.sets)c(e,t.sets[u],s,t),a="seq"===t.timeContainer?t.sets[u].end:Math.max(a,t.sets[u].end),s=t.sets[u];if("contents"in t)for(var l in t.contents)c(e,t.contents[l],s,t),a="seq"===t.timeContainer?t.contents[l].end:Math.max(a,t.contents[l].end),s=t.contents[l];else a=i?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,o+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=o+t.explicit_end:t.end=a,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function T(e){this.node=e}function S(){this.events=[],this.head=new x,this.body=null}function x(){this.styling=new M,this.layout=new P}function M(){this.styles={},this.initials={}}function R(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function O(){this.styleAttrs=null}function P(){this.regions={}}function C(e,t){n.call(this,"image"),this.src=e,this.type=t}function n(e){this.kind=e}function i(e){this.id=e}function o(e){this.regionID=e}function a(e){this.styleAttrs=e}function s(e){this.sets=e}function u(e){this.contents=e}function l(e,t,r){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=r}function D(){n.call(this,"body")}function I(){n.call(this,"div")}function L(){n.call(this,"p")}function N(){n.call(this,"span")}function d(){n.call(this,"span")}function k(){n.call(this,"br")}function F(){}function j(){}function f(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function h(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function p(e,t){var r={};if(null!==e)for(var n in e.attributes){var i=e.attributes[n].uri+" "+e.attributes[n].local,o=W.byQName[i];if(void 0!==o){var a=o.parse(e.attributes[n].value);null!==a?(r[i]=a,o===W.byName.zIndex&&y(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):G(t,"Cannot parse styling attribute "+i+" --\x3e "+e.attributes[n].value)}}return r}function m(e,t,r){for(var n in e.attributes)if(e.attributes[n].uri===t&&e.attributes[n].local===r)return e.attributes[n].value;return null}function g(e,t,r){var n,i=null;return null!==(n=/^(\d+(?:\.\d+)?)f$/.exec(r))?null!==t&&(i=parseFloat(n[1])/t):null!==(n=/^(\d+(?:\.\d+)?)t$/.exec(r))?null!==e&&(i=parseFloat(n[1])/e):null!==(n=/^(\d+(?:\.\d+)?)ms$/.exec(r))?i=parseFloat(n[1])/1e3:null!==(n=/^(\d+(?:\.\d+)?)s$/.exec(r))?i=parseFloat(n[1]):null!==(n=/^(\d+(?:\.\d+)?)h$/.exec(r))?i=3600*parseFloat(n[1]):null!==(n=/^(\d+(?:\.\d+)?)m$/.exec(r))?i=60*parseFloat(n[1]):null!==(n=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(r))?i=3600*parseInt(n[1])+60*parseInt(n[2])+parseFloat(n[3]):null!==(n=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(r))&&null!==t&&(i=3600*parseInt(n[1])+60*parseInt(n[2])+parseInt(n[3])+(null===n[4]?0:parseInt(n[4])/t)),i}function B(e,t,r){for(;0<t.styleRefs.length;){var n=t.styleRefs.pop();n in e.styles?(B(e,e.styles[n],r),U(e.styles[n].styleAttrs,t.styleAttrs)):G(r,"Non-existant style id referenced")}}function v(e,t,r,n){for(var i=t.length-1;0<=i;i--){var o=t[i];o in e.styles?U(e.styles[o].styleAttrs,r):G(n,"Non-existant style id referenced")}}function U(e,t){for(var r in e)r in t||(t[r]=e[r])}function y(e,t){if(e&&e.warn&&e.warn(t))throw t}function G(e,t){if(e&&e.error&&e.error(t))throw t}function H(e,t){throw e&&e.fatal&&e.fatal(t),t}function _(e,t){for(var r,n=0,i=e.length-1;n<=i;){var o=e[r=Math.floor((n+i)/2)];if(o<t)n=r+1;else{if(!(t<o))return{found:!0,index:r};i=r-1}}return{found:!1,index:n}}var b,V,z,W,E;b=void 0===r?this.imscDoc={}:r,V="undefined"==typeof sax?e("sax"):sax,z="undefined"==typeof imscNames?e("./names"):imscNames,W="undefined"==typeof imscStyles?e("./styles"):imscStyles,E="undefined"==typeof imscUtils?e("./utils"):imscUtils,b.fromXML=function(e,v,y){var t=V.parser(!0,{xmlns:!0}),_=[],b=[],E=[],w=0,A=null;t.onclosetag=function(e){if(_[0]instanceof M)for(var t in _[0].styles)B(_[0],_[0].styles[t],v);else if(_[0]instanceof L||_[0]instanceof N){if(1<_[0].contents.length){var r,n=[_[0].contents[0]];for(r=1;r<_[0].contents.length;r++)_[0].contents[r]instanceof d&&n[n.length-1]instanceof d?n[n.length-1].text+=_[0].contents[r].text:n.push(_[0].contents[r]);_[0].contents=n}_[0]instanceof N&&1===_[0].contents.length&&_[0].contents[0]instanceof d&&(_[0].text=_[0].contents[0].text,delete _[0].contents)}else _[0]instanceof T&&(_[0].node.uri===z.ns_tt&&"metadata"===_[0].node.local?w--:0<w&&y&&"onCloseTag"in y&&y.onCloseTag());E.shift(),b.shift(),_.shift()},t.ontext=function(e){if(void 0===_[0]);else if(_[0]instanceof N||_[0]instanceof L){if(_[0]instanceof N){var t=_[0].styleAttrs[W.byName.ruby.qname];if("container"===t||"textContainer"===t||"baseContainer"===t)return}var r=new d;r.initFromText(A,_[0],e,E[0],v),_[0].contents.push(r)}else _[0]instanceof T&&0<w&&y&&"onText"in y&&y.onText(e)},t.onopentag=function(e){var t=e.attributes["xml:space"];t?E.unshift(t.value):0===E.length?E.unshift("default"):E.unshift(E[0]);var r=e.attributes["xml:lang"];if(r?b.unshift(r.value):0===b.length?b.unshift(""):b.unshift(b[0]),e.uri===z.ns_tt)if("tt"===e.local)null!==A&&H(v,"Two <tt> elements at ("+this.line+","+this.column+")"),(A=new S).initFromNode(e,v),_.unshift(A);else if("head"===e.local)_[0]instanceof S||H(v,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),_.unshift(A.head);else if("styling"===e.local)_[0]instanceof x||H(v,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),_.unshift(A.head.styling);else if("style"===e.local){var n;_[0]instanceof M?((n=new R).initFromNode(e,v),n.id?A.head.styling.styles[n.id]=n:G(v,"<style> element missing @id attribute"),_.unshift(n)):_[0]instanceof F?((n=new R).initFromNode(e,v),U(n.styleAttrs,_[0].styleAttrs),_.unshift(n)):H(v,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===e.local){var i;if(_[0]instanceof M){for(var o in(i=new O).initFromNode(e,v),i.styleAttrs)A.head.styling.initials[o]=i.styleAttrs[o];_.unshift(i)}else H(v,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===e.local)_[0]instanceof x||H(v,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),_.unshift(A.head.layout);else if("region"===e.local){_[0]instanceof P||H(v,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var a=new F;a.initFromNode(A,e,v),!a.id||a.id in A.head.layout.regions?G(v,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):A.head.layout.regions[a.id]=a,_.unshift(a)}else if("body"===e.local){_[0]instanceof S||H(v,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==A.body&&H(v,"Second <body> element at "+this.line+","+this.column+")");var s=new D;s.initFromNode(A,e,v),A.body=s,_.unshift(s)}else if("div"===e.local){_[0]instanceof I||_[0]instanceof D||H(v,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var u=new I;u.initFromNode(A,_[0],e,v);var l=u.styleAttrs[W.byName.backgroundImage.qname];l&&(u.contents.push(new C(l)),delete u.styleAttrs[W.byName.backgroundImage.qname]),_[0].contents.push(u),_.unshift(u)}else if("image"===e.local){_[0]instanceof I||H(v,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var c=new C;c.initFromNode(A,_[0],e,v),_[0].contents.push(c),_.unshift(c)}else if("p"===e.local){_[0]instanceof I||H(v,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var d=new L;d.initFromNode(A,_[0],e,v),_[0].contents.push(d),_.unshift(d)}else if("span"===e.local){_[0]instanceof N||_[0]instanceof L||H(v,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var f=new N;f.initFromNode(A,_[0],e,E[0],v),_[0].contents.push(f),_.unshift(f)}else if("br"===e.local){_[0]instanceof N||_[0]instanceof L||H(v,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var h=new k;h.initFromNode(A,_[0],e,v),_[0].contents.push(h),_.unshift(h)}else if("set"===e.local){_[0]instanceof N||_[0]instanceof L||_[0]instanceof I||_[0]instanceof D||_[0]instanceof F||_[0]instanceof k||H(v,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var p=new j;p.initFromNode(A,_[0],e,v),_[0].sets.push(p),_.unshift(p)}else _.unshift(new T(e));else _.unshift(new T(e));if(_[0]instanceof T)if(e.uri===z.ns_tt&&"metadata"===e.local)w++;else if(0<w&&y&&"onOpenTag"in y){var m=[];for(var g in e.attributes)m[e.attributes[g].uri+" "+e.attributes[g].local]={uri:e.attributes[g].uri,local:e.attributes[g].local,value:e.attributes[g].value};y.onOpenTag(e.uri,e.local,m)}},t.write(e).close(),delete A.head.styling.styles;var r=!1;for(var n in A.head.layout.regions){r=!0;break}if(!r){var i=F.prototype.createDefaultRegion();A.head.layout.regions[i.id]=i}for(var o in A.head.layout.regions)c(A,A.head.layout.regions[o],null,null);return A.body&&c(A,A.body,null,null),A.body&&function e(t){if("contents"in t)for(var r=("styleAttrs"in t?t.styleAttrs[W.byName.ruby.qname]:null),n="span"===t.kind&&("container"===r||"textContainer"===r||"textContainer"===r),i=t.contents.length-1;0<=i;i--)!n||"styleAttrs"in t.contents[i]&&W.byName.ruby.qname in t.contents[i].styleAttrs?e(t.contents[i]):delete t.contents[i]}(A.body),A},S.prototype.initFromNode=function(e,t){var r=function(e,t){var r=m(e,z.ns_ttp,"cellResolution"),n=15,i=32;if(null!==r){var o=/(\d+) (\d+)/.exec(r);null!==o?(i=parseInt(o[1]),n=parseInt(o[2])):y(t,"Malformed cellResolution value (using initial value instead)")}return{w:i,h:n}}(e,t);this.cellLength={h:new E.ComputedLength(0,1/r.h),w:new E.ComputedLength(1/r.w,0)};var n=function(e,t){var r,n=m(e,z.ns_ttp,"frameRate"),i=30;null!==n&&(null!==(r=/(\d+)/.exec(n))?i=parseInt(r[1]):y(t,"Malformed frame rate attribute (using initial value instead)"));var o=m(e,z.ns_ttp,"frameRateMultiplier"),a=1;null!==o&&(null!==(r=/(\d+) (\d+)/.exec(o))?a=parseInt(r[1])/parseInt(r[2]):y(t,"Malformed frame rate multiplier attribute (using initial value instead)"));var s=a*i,u=1,l=m(e,z.ns_ttp,"tickRate");return null===l?null!==n&&(u=s):null!==(r=/(\d+)/.exec(l))?u=parseInt(r[1]):y(t,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:s,tickRate:u}}(e,t);this.effectiveFrameRate=n.effectiveFrameRate,this.tickRate=n.tickRate,this.aspectRatio=function(e,t){var r=m(e,z.ns_ittp,"aspectRatio");null===r&&(r=m(e,z.ns_ttp,"displayAspectRatio"));var n=null;if(null!==r){var i=/(\d+)\s+(\d+)/.exec(r);if(null!==i){var o=parseInt(i[1]),a=parseInt(i[2]);0!==o&&0!==a?n=o/a:G(t,"Illegal aspectRatio values (ignoring)")}else G(t,"Malformed aspectRatio attribute (ignoring)")}return n}(e,t);var i=m(e,z.ns_ttp,"timeBase");null!==i&&"media"!==i&&H(t,"Unsupported time base");var o=function(e,t){var r=m(e,z.ns_tts,"extent");if(null===r)return null;var n=r.split(" ");if(2!==n.length)return y(t,"Malformed extent (ignoring)"),null;var i=E.parseLength(n[0]),o=E.parseLength(n[1]);return o&&i?{h:o,w:i}:(y(t,"Malformed extent values (ignoring)"),null)}(e,t);null===o?this.pxLength={h:null,w:null}:("px"===o.h.unit&&"px"===o.w.unit||H(t,"Extent on TT must be in px or absent"),this.pxLength={h:new E.ComputedLength(0,1/o.h.value),w:new E.ComputedLength(1/o.w.value,0)}),this.dimensions={h:new E.ComputedLength(0,1),w:new E.ComputedLength(1,0)}},S.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=_(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var r=_(this.events,e.end);r.found||this.events.splice(r.index,0,e.end)}}},S.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},S.prototype.getMediaTimeEvents=function(){return this.events},R.prototype.initFromNode=function(e,t){this.id=f(e),this.styleAttrs=p(e,t),this.styleRefs=h(e)},O.prototype.initFromNode=function(e,t){for(var r in this.styleAttrs={},e.attributes)if(e.attributes[r].uri===z.ns_itts||e.attributes[r].uri===z.ns_ebutts||e.attributes[r].uri===z.ns_tts){var n=e.attributes[r].uri+" "+e.attributes[r].local;this.styleAttrs[n]=e.attributes[r].value}},C.prototype.initFromNode=function(e,t,r,n){this.src="src"in r.attributes?r.attributes.src.value:null,this.src||G(n,"Invalid image@src attribute"),this.type="type"in r.attributes?r.attributes.type.value:null,this.type||G(n,"Invalid image@type attribute"),a.prototype.initFromNode.call(this,e,t,r,n),l.prototype.initFromNode.call(this,e,t,r,n),s.prototype.initFromNode.call(this,e,t,r,n),o.prototype.initFromNode.call(this,e,t,r,n)},i.prototype.initFromNode=function(e,t,r,n){this.id=f(r)},o.prototype.initFromNode=function(e,t,r,n){this.regionID=function(e){return e&&"region"in e.attributes?e.attributes.region.value:""}(r)},a.prototype.initFromNode=function(e,t,r,n){this.styleAttrs=p(r,n),null!==e.head&&null!==e.head.styling&&v(e.head.styling,h(r),this.styleAttrs,n)},s.prototype.initFromNode=function(e,t,r,n){this.sets=[]},u.prototype.initFromNode=function(e,t,r,n){this.contents=[]},l.prototype.initFromNode=function(e,t,r,n){var i=function(e,t,r,n){var i=null;r&&"begin"in r.attributes&&null===(i=g(e.tickRate,e.effectiveFrameRate,r.attributes.begin.value))&&y(n,"Malformed begin value "+r.attributes.begin.value+" (using 0)");var o=null;r&&"dur"in r.attributes&&null===(o=g(e.tickRate,e.effectiveFrameRate,r.attributes.dur.value))&&y(n,"Malformed dur value "+r.attributes.dur.value+" (ignoring)");var a=null;return r&&"end"in r.attributes&&null===(a=g(e.tickRate,e.effectiveFrameRate,r.attributes.end.value))&&y(n,"Malformed end value (ignoring)"),{explicit_begin:i,explicit_end:a,explicit_dur:o}}(e,0,r,n);this.explicit_begin=i.explicit_begin,this.explicit_end=i.explicit_end,this.explicit_dur=i.explicit_dur,this.timeContainer=function(e,t){var r=e&&"timeContainer"in e.attributes?e.attributes.timeContainer.value:null;return r&&"par"!==r?"seq"===r?"seq":(G(t,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}(r,n)},D.prototype.initFromNode=function(e,t,r){a.prototype.initFromNode.call(this,e,null,t,r),l.prototype.initFromNode.call(this,e,null,t,r),s.prototype.initFromNode.call(this,e,null,t,r),o.prototype.initFromNode.call(this,e,null,t,r),u.prototype.initFromNode.call(this,e,null,t,r)},I.prototype.initFromNode=function(e,t,r,n){a.prototype.initFromNode.call(this,e,t,r,n),l.prototype.initFromNode.call(this,e,t,r,n),s.prototype.initFromNode.call(this,e,t,r,n),o.prototype.initFromNode.call(this,e,t,r,n),u.prototype.initFromNode.call(this,e,t,r,n)},L.prototype.initFromNode=function(e,t,r,n){a.prototype.initFromNode.call(this,e,t,r,n),l.prototype.initFromNode.call(this,e,t,r,n),s.prototype.initFromNode.call(this,e,t,r,n),o.prototype.initFromNode.call(this,e,t,r,n),u.prototype.initFromNode.call(this,e,t,r,n)},N.prototype.initFromNode=function(e,t,r,n,i){a.prototype.initFromNode.call(this,e,t,r,i),l.prototype.initFromNode.call(this,e,t,r,i),s.prototype.initFromNode.call(this,e,t,r,i),o.prototype.initFromNode.call(this,e,t,r,i),u.prototype.initFromNode.call(this,e,t,r,i),this.space=n},d.prototype.initFromText=function(e,t,r,n,i){l.prototype.initFromNode.call(this,e,t,null,i),this.text=r,this.space=n},k.prototype.initFromNode=function(e,t,r,n){o.prototype.initFromNode.call(this,e,t,r,n),l.prototype.initFromNode.call(this,e,t,r,n)},F.prototype.createDefaultRegion=function(){var e=new F;return i.call(e,""),a.call(e,{}),s.call(e,[]),l.call(e,0,Number.POSITIVE_INFINITY,null),e},F.prototype.initFromNode=function(e,t,r){i.prototype.initFromNode.call(this,e,null,t,r),a.prototype.initFromNode.call(this,e,null,t,r),l.prototype.initFromNode.call(this,e,null,t,r),s.prototype.initFromNode.call(this,e,null,t,r),null!==e.head&&null!==e.head.styling&&v(e.head.styling,h(t),this.styleAttrs,r)},j.prototype.initFromNode=function(e,t,r,n){l.prototype.initFromNode.call(this,e,t,r,n);var i=p(r,n);for(var o in this.qname=null,this.value=null,i){if(this.qname){G(n,"More than one style specified on set");break}this.qname=o,this.value=i[o]}}},{"./names":571,"./styles":572,"./utils":573,sax:611}],568:[function(e,t,r){!function(e,t,M){function R(e,t,r){var n;if("region"===r.kind)(n=document.createElement("div")).style.position="absolute";else if("body"===r.kind)n=document.createElement("div");else if("div"===r.kind)n=document.createElement("div");else if("image"===r.kind){if(n=document.createElement("img"),null!==e.imgResolver&&null!==r.src){var i=e.imgResolver(r.src,n);i&&(n.src=i),n.height=e.regionH,n.width=e.regionW}}else if("p"===r.kind)n=document.createElement("p");else if("span"===r.kind){if("container"===r.styleAttrs[M.byName.ruby.qname])n=document.createElement("ruby"),e.ruby=!0;else if("base"===r.styleAttrs[M.byName.ruby.qname])n=document.createElement("rb");else if("text"===r.styleAttrs[M.byName.ruby.qname])n=document.createElement("rt");else if("baseContainer"===r.styleAttrs[M.byName.ruby.qname])n=document.createElement("rbc");else if("textContainer"===r.styleAttrs[M.byName.ruby.qname])n=document.createElement("rtc");else{if("delimiter"===r.styleAttrs[M.byName.ruby.qname])return;n=document.createElement("span")}var o=r.styleAttrs[M.byName.textEmphasis.qname];o&&"none"!==o.style&&(e.textEmphasis=!0)}else"br"===r.kind&&(n=document.createElement("br"));if(n){for(var a in t.appendChild(n),n.style.margin="0",D){var s=D[a],u=r.styleAttrs[s.qname];void 0!==u&&null!==s.map&&s.map(e,n,r,u)}var l=n;if("region"===r.kind){var c=r.styleAttrs[M.byName.writingMode.qname];"lrtb"===c||"lr"===c?(e.ipd="lr",e.bpd="tb"):"rltb"===c||"rl"===c?(e.ipd="rl",e.bpd="tb"):"tblr"===c?(e.ipd="tb",e.bpd="lr"):"tbrl"!==c&&"tb"!==c||(e.ipd="tb",e.bpd="rl")}var d=r.styleAttrs[M.byName.linePadding.qname];if(d&&!d.isZero()){var f=d.toUsedLength(e.w,e.h);if(0<f){var h=Math.ceil(f)+"px";"tb"===e.bpd?(l.style.paddingLeft=h,l.style.paddingRight=h):(l.style.paddingTop=h,l.style.paddingBottom=h),e.lp=d}}var p=r.styleAttrs[M.byName.multiRowAlign.qname];if(p&&"auto"!==p){var m=document.createElement("span");m.style.display="inline-block",m.style.textAlign=p,n.appendChild(m),l=m,e.mra=p}var g=r.styleAttrs[M.byName.rubyReserve.qname];if(g&&"none"!==g[0]&&(e.rubyReserve=g),r.styleAttrs[M.byName.fillLineGap.qname]&&(e.flg=!0),"span"===r.kind&&r.text)if(M.byName.textCombine.qname in r.styleAttrs&&"all"===r.styleAttrs[M.byName.textCombine.qname][0])n.textContent=r.text;else for(var v="",y=0;y<r.text.length;y++){v+=r.text.charAt(y);var _=r.text.charCodeAt(y);if(_<55296||56319<_||y===r.text.length){var b=document.createElement("span");b.textContent=v,n.appendChild(b),v=""}}for(var E in r.contents)R(e,l,r.contents[E]);var w=[];if((e.lp||e.mra||e.flg||e.ruby||e.textEmphasis||e.rubyReserve)&&"p"===r.kind&&(C(e,l,w,null),e.rubyReserve&&(function(e,t){for(var r=0;r<e.length;r++){var n,i,o=document.createElement("ruby"),a=document.createElement("rb");a.textContent="​",o.appendChild(a);var s=t.rubyReserve[1].toUsedLength(t.w,t.h)+"px";"both"===t.rubyReserve[0]?((n=document.createElement("rtc")).style.rubyPosition="under",n.textContent="​",n.style.fontSize=s,(i=document.createElement("rtc")).style.rubyPosition="over",i.textContent="​",i.style.fontSize=s,o.appendChild(n),o.appendChild(i)):((n=document.createElement("rtc")).textContent="​",n.style.fontSize=s,"after"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&0<r?n.style.rubyPosition="tb"===t.bpd||"rl"===t.bpd?"under":"over":n.style.rubyPosition="tb"===t.bpd||"rl"===t.bpd?"over":"under",o.appendChild(n));e[r].elements[0].node.parentElement.insertBefore(o,e[r].elements[0].node)}}(w,e),e.rubyReserve=null),(e.ruby||e.rubyReserve)&&(function(e,t){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].rbc.length;n++){var i;if(""===e[r].rbc[n].style.rubyPosition)i="tb"===t.bpd?0===r?"over":"under":"rl"===t.bpd?0===r?"over":"under":0===r?"under":"over",e[r].rbc[n].style.rubyPosition=i}}(w,e),e.ruby=null),e.textEmphasis&&(function(e,t){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].te.length;n++){var i;if(""===e[r].te[n].style.textEmphasisPosition)i="tb"===t.bpd?0===r?"left over":"left under":"rl"===t.bpd?0===r?"right under":"left under":0===r?"left under":"right under",e[r].te[n].style.textEmphasisPosition=i}}(w,e),e.textEmphasis=null),e.mra&&(function(e){for(var t=0;t<e.length-1;t++){var r=e[t].elements.length;if(0!==r&&!1===e[t].br){var n=document.createElement("br"),i=e[t].elements[r-1].node;i.parentElement.insertBefore(n,i.nextSibling)}}}(w),e.mra=null),e.lp&&(function(e,t,r){for(var n in e){var i=e[n].elements.length,o=e[n].elements[e[n].start_elem],a=e[n].elements[e[n].end_elem],s=Math.ceil(t)+"px",u="-"+Math.ceil(t)+"px";0!==i&&("lr"===r.ipd?(o.node.style.borderLeftColor=o.bgcolor||"#00000000",o.node.style.borderLeftStyle="solid",o.node.style.borderLeftWidth=s,o.node.style.marginLeft=u):"rl"===r.ipd?(o.node.style.borderRightColor=o.bgcolor||"#00000000",o.node.style.borderRightStyle="solid",o.node.style.borderRightWidth=s,o.node.style.marginRight=u):"tb"===r.ipd&&(o.node.style.borderTopColor=o.bgcolor||"#00000000",o.node.style.borderTopStyle="solid",o.node.style.borderTopWidth=s,o.node.style.marginTop=u),"lr"===r.ipd?(a.node.style.borderRightColor=a.bgcolor||"#00000000",a.node.style.borderRightStyle="solid",a.node.style.borderRightWidth=s,a.node.style.marginRight=u):"rl"===r.ipd?(a.node.style.borderLeftColor=a.bgcolor||"#00000000",a.node.style.borderLeftStyle="solid",a.node.style.borderLeftWidth=s,a.node.style.marginLeft=u):"tb"===r.ipd&&(a.node.style.borderBottomColor=a.bgcolor||"#00000000",a.node.style.borderBottomStyle="solid",a.node.style.borderBottomWidth=s,a.node.style.marginBottom=u))}}(w,e.lp.toUsedLength(e.w,e.h),e),e.lp=null),e.flg)){var A=P(l.getBoundingClientRect(),e);!function(e,t,r,n){for(var i=Math.sign(r-t),o=0;o<=e.length;o++){var a,s,u;if(a=0===o?t:o===e.length?r:(e[o].before+e[o-1].after)/2,0<o)for(var l=0;l<e[o-1].elements.length;l++)null!==e[o-1].elements[l].bgcolor&&(u=e[o-1].elements[l],i*(u.after-a)<0&&(s=Math.ceil(Math.abs(a-u.after))+"px",u.node.style.backgroundColor=u.bgcolor,"lr"===n.bpd?u.node.style.paddingRight=s:"rl"===n.bpd?u.node.style.paddingLeft=s:"tb"===n.bpd&&(u.node.style.paddingBottom=s)));if(o<e.length)for(var c=0;c<e[o].elements.length;c++)null!==(u=e[o].elements[c]).bgcolor&&0<i*(u.before-a)&&(s=Math.ceil(Math.abs(u.before-a))+"px",u.node.style.backgroundColor=u.bgcolor,"lr"===n.bpd?u.node.style.paddingLeft=s:"rl"===n.bpd?u.node.style.paddingRight=s:"tb"===n.bpd&&(u.node.style.paddingTop=s))}}(w,A.before,A.after,e),e.flg=null}if("region"===r.kind&&(C(e,l,w),"tb"===e.bpd&&e.enableRollUp&&0<r.contents.length&&"after"===r.styleAttrs[M.byName.displayAlign.qname])){var T=new O(""===r.id?"_":r.id,w);if(e.currentISDState[T.id]=T,e.previousISDState&&T.id in e.previousISDState&&0<e.previousISDState[T.id].plist.length&&1<T.plist.length&&T.plist[T.plist.length-2].text===e.previousISDState[T.id].plist[e.previousISDState[T.id].plist.length-1].text){var S=n.firstElementChild,x=T.plist[T.plist.length-1].after-T.plist[T.plist.length-1].before;S.style.bottom="-"+x+"px",S.style.transition="transform 0.4s",S.style.position="relative",S.style.transform="translateY(-"+x+"px)"}}}else!function(e,t){if(e&&e.error&&e.error(t))throw t}(e.errorHandler,"Error processing ISD element kind: "+r.kind)}function O(e,t){this.id=e,this.plist=t}function P(e,t){var r={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(r.before=e.top,r.after=e.bottom,"lr"===t.ipd?(r.start=e.left,r.end=e.right):(r.start=e.right,r.end=e.left)):"lr"===t.bpd?(r.before=e.left,r.after=e.right,r.start=e.top,r.end=e.bottom):"rl"===t.bpd&&(r.before=e.right,r.after=e.left,r.start=e.top,r.end=e.bottom),r}function C(e,t,r,n){if("rt"!==t.localName&&"rtc"!==t.localName){var i=t.style.backgroundColor||n;if(0===t.childElementCount)if("span"===t.localName||"rb"===t.localName){var o=t.getBoundingClientRect();if(0===o.height||0===o.width)return;var a=P(o,e);if(0!==r.length&&function(e,t,r,n){return t<n&&r<e||n<=t&&e<=r}(a.before,a.after,r[r.length-1].before,r[r.length-1].after)){var s=Math.sign(a.after-a.before),u=Math.sign(a.end-a.start);s*(a.before-r[r.length-1].before)<0&&(r[r.length-1].before=a.before),0<s*(a.after-r[r.length-1].after)&&(r[r.length-1].after=a.after),u*(a.start-r[r.length-1].start)<0&&(r[r.length-1].start=a.start,r[r.length-1].start_elem=r[r.length-1].elements.length),0<u*(a.end-r[r.length-1].end)&&(r[r.length-1].end=a.end,r[r.length-1].end_elem=r[r.length-1].elements.length)}else r.push({before:a.before,after:a.after,start:a.start,end:a.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});r[r.length-1].text+=t.textContent,r[r.length-1].elements.push({node:t,bgcolor:i,before:a.before,after:a.after})}else"br"===t.localName&&0!==r.length&&(r[r.length-1].br=!0);else for(var l=t.firstChild;l;)l.nodeType===Node.ELEMENT_NODE&&(C(e,l,r,i),"ruby"===l.localName||"rtc"===l.localName?0<r.length&&r[r.length-1].rbc.push(l):"span"===l.localName&&""!==l.style.textEmphasisStyle&&r[r.length-1].te.push(l)),l=l.nextSibling}}function r(e,t){this.qname=e,this.map=t}e.render=function(e,t,r,n,i,o,a,s,u){var l=n||t.clientHeight,c=i||t.clientWidth;if(null!==e.aspectRatio){var d=l*e.aspectRatio;c<d?l=Math.round(c/e.aspectRatio):c=d}var f=document.createElement("div");f.style.position="relative",f.style.width=c+"px",f.style.height=l+"px",f.style.margin="auto",f.style.top=0,f.style.bottom=0,f.style.left=0,f.style.right=0,f.style.zIndex=0;var h={h:l,w:c,regionH:null,regionW:null,imgResolver:r,displayForcedOnlyMode:o||!1,isd:e,errorHandler:a,previousISDState:s,enableRollUp:u||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};for(var p in t.appendChild(f),e.contents)R(h,f,e.contents[p]);return h.currentISDState};var D=[new r("http://www.w3.org/ns/ttml#styling backgroundColor",function(e,t,r,n){0!==n[3]&&(t.style.backgroundColor="rgba("+n[0].toString()+","+n[1].toString()+","+n[2].toString()+","+(n[3]/255).toString()+")")}),new r("http://www.w3.org/ns/ttml#styling color",function(e,t,r,n){t.style.color="rgba("+n[0].toString()+","+n[1].toString()+","+n[2].toString()+","+(n[3]/255).toString()+")"}),new r("http://www.w3.org/ns/ttml#styling direction",function(e,t,r,n){t.style.direction=n}),new r("http://www.w3.org/ns/ttml#styling display",function(e,t,r,n){}),new r("http://www.w3.org/ns/ttml#styling displayAlign",function(e,t,r,n){t.style.display="flex",t.style.flexDirection="column","before"===n?t.style.justifyContent="flex-start":"center"===n?t.style.justifyContent="center":"after"===n&&(t.style.justifyContent="flex-end")}),new r("http://www.w3.org/ns/ttml#styling extent",function(e,t,r,n){e.regionH=n.h.toUsedLength(e.w,e.h),e.regionW=n.w.toUsedLength(e.w,e.h);var i=0,o=0,a=r.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];a&&(i=a[0].toUsedLength(e.w,e.h)+a[2].toUsedLength(e.w,e.h),o=a[1].toUsedLength(e.w,e.h)+a[3].toUsedLength(e.w,e.h)),t.style.height=e.regionH-i+"px",t.style.width=e.regionW-o+"px"}),new r("http://www.w3.org/ns/ttml#styling fontFamily",function(e,t,r,n){var i=[];for(var o in n)"monospaceSerif"===n[o]?(i.push("Courier New"),i.push('"Liberation Mono"'),i.push("Courier"),i.push("monospace")):"proportionalSansSerif"===n[o]?(i.push("Arial"),i.push("Helvetica"),i.push('"Liberation Sans"'),i.push("sans-serif")):"monospace"===n[o]?i.push("monospace"):"sansSerif"===n[o]?i.push("sans-serif"):"serif"===n[o]?i.push("serif"):"monospaceSansSerif"===n[o]?(i.push("Consolas"),i.push("monospace")):"proportionalSerif"===n[o]?i.push("serif"):i.push(n[o]);t.style.fontFamily=i.join(",")}),new r("http://www.w3.org/ns/ttml#styling shear",function(e,t,r,n){if(0!==n){var i=-.9*n;"tb"===e.bpd?t.style.transform="skewX("+i+"deg)":t.style.transform="skewY("+i+"deg)"}}),new r("http://www.w3.org/ns/ttml#styling fontSize",function(e,t,r,n){t.style.fontSize=n.toUsedLength(e.w,e.h)+"px"}),new r("http://www.w3.org/ns/ttml#styling fontStyle",function(e,t,r,n){t.style.fontStyle=n}),new r("http://www.w3.org/ns/ttml#styling fontWeight",function(e,t,r,n){t.style.fontWeight=n}),new r("http://www.w3.org/ns/ttml#styling lineHeight",function(e,t,r,n){t.style.lineHeight="normal"===n?"normal":n.toUsedLength(e.w,e.h)+"px"}),new r("http://www.w3.org/ns/ttml#styling opacity",function(e,t,r,n){t.style.opacity=n}),new r("http://www.w3.org/ns/ttml#styling origin",function(e,t,r,n){t.style.top=n.h.toUsedLength(e.w,e.h)+"px",t.style.left=n.w.toUsedLength(e.w,e.h)+"px"}),new r("http://www.w3.org/ns/ttml#styling overflow",function(e,t,r,n){t.style.overflow=n}),new r("http://www.w3.org/ns/ttml#styling padding",function(e,t,r,n){var i=[];i[0]=n[0].toUsedLength(e.w,e.h)+"px",i[1]=n[3].toUsedLength(e.w,e.h)+"px",i[2]=n[2].toUsedLength(e.w,e.h)+"px",i[3]=n[1].toUsedLength(e.w,e.h)+"px",t.style.padding=i.join(" ")}),new r("http://www.w3.org/ns/ttml#styling position",function(e,t,r,n){t.style.top=n.h.toUsedLength(e.w,e.h)+"px",t.style.left=n.w.toUsedLength(e.w,e.h)+"px"}),new r("http://www.w3.org/ns/ttml#styling rubyAlign",function(e,t,r,n){t.style.rubyAlign=n}),new r("http://www.w3.org/ns/ttml#styling rubyPosition",function(e,t,r,n){var i;"before"!==n&&"after"!==n||(i="tb"===e.bpd?"before"===n?"over":"under":"rl"===e.bpd?"before"===n?"over":"under":"before"===n?"under":"over",t.parentElement.style.rubyPosition=i)}),new r("http://www.w3.org/ns/ttml#styling showBackground",null),new r("http://www.w3.org/ns/ttml#styling textAlign",function(e,t,r,n){var i,o=r.styleAttrs[M.byName.direction.qname];i="start"===n?"rtl"===o?"right":"left":"end"===n?"rtl"===o?"left":"right":n,t.style.textAlign=i}),new r("http://www.w3.org/ns/ttml#styling textDecoration",function(e,t,r,n){t.style.textDecoration=n.join(" ").replace("lineThrough","line-through")}),new r("http://www.w3.org/ns/ttml#styling textOutline",function(e,t,r,n){}),new r("http://www.w3.org/ns/ttml#styling textShadow",function(e,t,r,n){var i=r.styleAttrs[M.byName.textOutline.qname];if("none"===n&&"none"===i)t.style.textShadow="";else{var o=[];if("none"!==i&&o.push("rgba("+i.color[0].toString()+","+i.color[1].toString()+","+i.color[2].toString()+","+(i.color[3]/255).toString()+") 0px 0px "+i.thickness.toUsedLength(e.w,e.h)+"px"),"none"!==n)for(var a in n)o.push(n[a].x_off.toUsedLength(e.w,e.h)+"px "+n[a].y_off.toUsedLength(e.w,e.h)+"px "+n[a].b_radius.toUsedLength(e.w,e.h)+"px rgba("+n[a].color[0].toString()+","+n[a].color[1].toString()+","+n[a].color[2].toString()+","+(n[a].color[3]/255).toString()+")");t.style.textShadow=o.join(",")}}),new r("http://www.w3.org/ns/ttml#styling textCombine",function(e,t,r,n){t.style.textCombineUpright=n.join(" ")}),new r("http://www.w3.org/ns/ttml#styling textEmphasis",function(e,t,r,n){var i;"none"!==n.style&&(t.style.textEmphasisStyle=n.style+" "+n.symbol),"before"!==n.position&&"after"!==n.position||(i="tb"===e.bpd?"before"===n.position?"left over":"left under":"rl"===e.bpd?"before"===n.position?"right under":"left under":"before"===n.position?"left under":"right under",t.style.textEmphasisPosition=i)}),new r("http://www.w3.org/ns/ttml#styling unicodeBidi",function(e,t,r,n){var i;i="bidiOverride"===n?"bidi-override":n,t.style.unicodeBidi=i}),new r("http://www.w3.org/ns/ttml#styling visibility",function(e,t,r,n){t.style.visibility=n}),new r("http://www.w3.org/ns/ttml#styling wrapOption",function(e,t,r,n){"wrap"===n?"preserve"===r.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===r.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"}),new r("http://www.w3.org/ns/ttml#styling writingMode",function(e,t,r,n){"lrtb"===n||"lr"===n?e.writingMode="horizontal-tb":"rltb"===n||"rl"===n?e.writingMode="horizontal-tb":"tblr"===n?e.writingMode="vertical-lr":"tbrl"!==n&&"tb"!==n||(e.writingMode="vertical-rl"),t.style.writingMode=e.writingMode}),new r("http://www.w3.org/ns/ttml#styling zIndex",function(e,t,r,n){t.style.zIndex=n}),new r("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(e,t,r,n){e.displayForcedOnlyMode&&!1===n&&(t.style.visibility="hidden")})],n={};for(var i in D)n[D[i].qname]=D[i]}(void 0===r?this.imscHTML={}:r,"undefined"==typeof imscNames?e("./names"):imscNames,"undefined"==typeof imscStyles?e("./styles"):imscStyles,"undefined"==typeof imscUtils?e("./utils"):imscUtils)},{"./names":571,"./styles":572,"./utils":573}],569:[function(e,t,r){!function(e,t,B,U){e.generateISD=function(e,t,r){var n=new s(e),i={};for(var o in e.head.layout.regions){var a=H(e,t,e.head.layout.regions[o],e.body,null,"",e.head.layout.regions[o],r,i);null!==a&&n.contents.push(a.element)}return n};var G=[B.byName.color.qname,B.byName.textCombine.qname,B.byName.textDecoration.qname,B.byName.textEmphasis.qname,B.byName.textOutline.qname,B.byName.textShadow.qname];function H(e,t,r,n,i,o,a,s,u){if(t<a.begin||t>=a.end)return null;var l="regionID"in a&&""!==a.regionID?a.regionID:o;if(null!==i&&l!==r.id&&(!("contents"in a)||"contents"in a&&0===a.contents.length||""!==l))return null;var c=new V(a);for(var d in a.sets)t<a.sets[d].begin||t>=a.sets[d].end||(c.styleAttrs[a.sets[d].qname]=a.sets[d].value);var f,h={};for(var p in c.styleAttrs)if(h[p]=!0,p===B.byName.writingMode.qname&&!(B.byName.direction.qname in c.styleAttrs)){var m=c.styleAttrs[p];"lrtb"===m||"lr"===m?c.styleAttrs[B.byName.direction.qname]="ltr":"rltb"!==m&&"rl"!==m||(c.styleAttrs[B.byName.direction.qname]="rtl")}if(null!==i)for(var g in B.all){var v=B.all[g];if(v.qname===B.byName.textDecoration.qname){var y=i.styleAttrs[v.qname],_=c.styleAttrs[v.qname],b=[];void 0===_?b=y:-1===_.indexOf("none")?((-1===_.indexOf("noUnderline")&&-1!==y.indexOf("underline")||-1!==_.indexOf("underline"))&&b.push("underline"),(-1===_.indexOf("noLineThrough")&&-1!==y.indexOf("lineThrough")||-1!==_.indexOf("lineThrough"))&&b.push("lineThrough"),(-1===_.indexOf("noOverline")&&-1!==y.indexOf("overline")||-1!==_.indexOf("overline"))&&b.push("overline")):b.push("none"),c.styleAttrs[v.qname]=b}else if(v.qname!==B.byName.fontSize.qname||v.qname in c.styleAttrs||"span"!==c.kind||"textContainer"!==c.styleAttrs[B.byName.ruby.qname])if(v.qname!==B.byName.fontSize.qname||v.qname in c.styleAttrs||"span"!==c.kind||"text"!==c.styleAttrs[B.byName.ruby.qname])v.inherit&&v.qname in i.styleAttrs&&!(v.qname in c.styleAttrs)&&(c.styleAttrs[v.qname]=i.styleAttrs[v.qname]);else{var E=i.styleAttrs[B.byName.fontSize.qname];"textContainer"===i.styleAttrs[B.byName.ruby.qname]?c.styleAttrs[v.qname]=E:c.styleAttrs[v.qname]=new U.ComputedLength(.5*E.rw,.5*E.rh)}else{var w=i.styleAttrs[B.byName.fontSize.qname];c.styleAttrs[v.qname]=new U.ComputedLength(.5*w.rw,.5*w.rh)}}for(var A in B.all){var T=B.all[A];if(!(T.qname in c.styleAttrs)&&!(T.qname===B.byName.position.qname&&B.byName.origin.qname in c.styleAttrs||T.qname===B.byName.origin.qname&&B.byName.position.qname in c.styleAttrs)){var S=e.head.styling.initials[T.qname]||T.initial;("region"===c.kind||!1===T.inherit&&null!==S)&&(c.styleAttrs[T.qname]=T.parse(S),h[T.qname]=!0)}}for(var x in B.all){var M=B.all[x];if(M.qname in h&&null!==M.compute){var R=M.compute(e,i,c,c.styleAttrs[M.qname],u);null!==R?c.styleAttrs[M.qname]=R:z(s,"Style '"+M.qname+"' on element '"+c.kind+"' cannot be computed")}}if("none"===c.styleAttrs[B.byName.display.qname])return null;for(var O in null===i?f=null===n?[]:[n]:"contents"in a&&(f=a.contents),f){var P=H(e,t,r,n,c,l,f[O],s,u);null!==P&&c.contents.push(P.element)}for(var C in c.styleAttrs){var D=!1;if("span"===c.kind){var I=c.styleAttrs[B.byName.ruby.qname];D=(D=(D=("container"===I||"textContainer"===I||"baseContainer"===I)&&-1!==G.indexOf(C))||"container"!==I&&C===B.byName.rubyAlign.qname)||!("textContainer"===I||"text"===I)&&C===B.byName.rubyPosition.qname}if(!D)D=-1===B.byQName[C].applies.indexOf(c.kind);D&&delete c.styleAttrs[C]}if("span"===c.kind&&c.text&&"default"===c.space){var L=c.text.replace(/[\t\r\n ]+/g," ");c.text=L}if("p"===c.kind){var N=[];!function e(t,r){if("contents"in t)for(var n in t.contents)e(t.contents[n],r);else"span"!==t.kind&&"br"!==t.kind||r.push(t)}(c,N);for(var k=0,F="after_br",j=0;;)if("after_br"===F)k>=N.length||"br"===N[k].kind?(F="before_br",j=k,k--):("preserve"!==N[k].space&&(N[k].text=N[k].text.replace(/^[\t\r\n ]+/g,"")),0<N[k].text.length?(F="looking_br",k++):N.splice(k,1));else if("before_br"===F)if(k<0||"br"===N[k].kind){if(F="after_br",(k=j+1)>=N.length)break}else if("preserve"!==N[k].space&&(N[k].text=N[k].text.replace(/[\t\r\n ]+$/g,"")),0<N[k].text.length){if(F="after_br",(k=j+1)>=N.length)break}else N.splice(k,1),k--;else k>=N.length||"br"===N[k].kind?(F="before_br",j=k,k--):k++;!function e(t){{if("br"===t.kind)return!1;if("text"in t)return 0===t.text.length;if("contents"in t){for(var r=t.contents.length;r--;)e(t.contents[r])&&t.contents.splice(r,1);return 0===t.contents.length}}}(c)}return"div"===c.kind&&B.byName.backgroundImage.qname in c.styleAttrs||"br"===c.kind||"image"===c.kind||"contents"in c&&0<c.contents.length||"span"===c.kind&&null!==c.text||"region"===c.kind&&"always"===c.styleAttrs[B.byName.showBackground.qname]?{region_id:l,element:c}:null}function s(e){this.contents=[],this.aspectRatio=e.aspectRatio}function V(e){for(var t in this.kind=e.kind||"region",e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)this.styleAttrs[t]=e.styleAttrs[t];"src"in e&&(this.src=e.src),"type"in e&&(this.type=e.type),"text"in e?this.text=e.text:("region"===this.kind||"contents"in e)&&(this.contents=[]),"space"in e&&(this.space=e.space)}function z(e,t){if(e&&e.error&&e.error(t))throw t}}(void 0===r?this.imscISD={}:r,"undefined"==typeof imscNames?e("./names"):imscNames,"undefined"==typeof imscStyles?e("./styles"):imscStyles,"undefined"==typeof imscUtils?e("./utils"):imscUtils)},{"./names":571,"./styles":572,"./utils":573}],570:[function(e,t,r){r.generateISD=e("./isd").generateISD,r.fromXML=e("./doc").fromXML,r.renderHTML=e("./html").render},{"./doc":567,"./html":568,"./isd":569}],571:[function(e,t,r){var n;(n=void 0===r?this.imscNames={}:r).ns_tt="http://www.w3.org/ns/ttml",n.ns_tts="http://www.w3.org/ns/ttml#styling",n.ns_ttp="http://www.w3.org/ns/ttml#parameter",n.ns_xml="http://www.w3.org/XML/1998/namespace",n.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",n.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",n.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",n.ns_ebutts="urn:ebu:tt:style"},{}],572:[function(e,t,r){!function(l,e,c){function t(e,t,r,n,i,o,a,s){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=i,this.animatable=o,this.initial=r,this.applies=n,this.parse=a,this.compute=s}for(var r in l.all=[new t(e.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,c.parseColor,null),new t(e.ns_tts,"color","white",["span"],!0,!0,c.parseColor,null),new t(e.ns_tts,"direction","ltr",["p","span"],!0,!0,function(e){return e},null),new t(e.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(e){return e},null),new t(e.ns_tts,"displayAlign","before",["region"],!1,!0,function(e){return e},null),new t(e.ns_tts,"extent","auto",["tt","region"],!1,!0,function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=c.parseLength(t[0]),n=c.parseLength(t[1]);return n&&r?{h:n,w:r}:null},function(e,t,r,n,i){var o,a;if("auto"===n)o=new c.ComputedLength(0,1);else if(null===(o=c.toComputedLength(n.h.value,n.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===n)a=new c.ComputedLength(1,0);else if(null===(a=c.toComputedLength(n.w.value,n.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:o,w:a}}),new t(e.ns_tts,"fontFamily","default",["span"],!0,!0,function(e){var t=e.split(","),r=[];for(var n in t)"'"!==t[n].charAt(0)&&'"'!==t[n].charAt(0)&&"default"===t[n]?r.push("monospaceSerif"):r.push(t[n]);return r},null),new t(e.ns_tts,"shear","0%",["p"],!0,!0,c.parseLength,function(e,t,r,n){return"%"!==n.unit?null:100<Math.abs(n.value)?100*Math.sign(n.value):n.value}),new t(e.ns_tts,"fontSize","1c",["span"],!0,!0,c.parseLength,function(e,t,r,n,i){return c.toComputedLength(n.value,n.unit,null!==t?t.styleAttrs[l.byName.fontSize.qname]:e.cellLength.h,null!==t?t.styleAttrs[l.byName.fontSize.qname]:e.cellLength.h,e.cellLength.h,e.pxLength.h)}),new t(e.ns_tts,"fontStyle","normal",["span"],!0,!0,function(e){return e},null),new t(e.ns_tts,"fontWeight","normal",["span"],!0,!0,function(e){return e},null),new t(e.ns_tts,"lineHeight","normal",["p"],!0,!0,function(e){return"normal"===e?e:c.parseLength(e)},function(e,t,r,n,i){var o;if("normal"===n)o=n;else if(null===(o=c.toComputedLength(n.value,n.unit,r.styleAttrs[l.byName.fontSize.qname],r.styleAttrs[l.byName.fontSize.qname],e.cellLength.h,e.pxLength.h)))return null;return o}),new t(e.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new t(e.ns_tts,"origin","auto",["region"],!1,!0,function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=c.parseLength(t[0]),n=c.parseLength(t[1]);return n&&r?{h:n,w:r}:null},function(e,t,r,n,i){var o,a;if("auto"===n)o=new c.ComputedLength(0,0);else if(null===(o=c.toComputedLength(n.h.value,n.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===n)a=new c.ComputedLength(0,0);else if(null===(a=c.toComputedLength(n.w.value,n.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:o,w:a}}),new t(e.ns_tts,"overflow","hidden",["region"],!1,!0,function(e){return e},null),new t(e.ns_tts,"padding","0px",["region"],!1,!0,function(e){var t=e.split(" ");if(4<t.length)return null;var r=[];for(var n in t){var i=c.parseLength(t[n]);if(!i)return null;r.push(i)}return r},function(e,t,r,n,i){var o;if(1===n.length)o=[n[0],n[0],n[0],n[0]];else if(2===n.length)o=[n[0],n[1],n[0],n[1]];else if(3===n.length)o=[n[0],n[1],n[2],n[1]];else{if(4!==n.length)return null;o=[n[0],n[1],n[2],n[3]]}var a=r.styleAttrs[l.byName.writingMode.qname];if("lrtb"===a||"lr"===a)o=[o[0],o[3],o[2],o[1]];else if("rltb"===a||"rl"===a)o=[o[0],o[1],o[2],o[3]];else if("tblr"===a)o=[o[3],o[0],o[1],o[2]];else{if("tbrl"!==a&&"tb"!==a)return null;o=[o[3],o[2],o[1],o[0]]}var s=[];for(var u in o)if(0===o[u].value)s[u]=new c.ComputedLength(0,0);else if(s[u]=c.toComputedLength(o[u].value,o[u].unit,r.styleAttrs[l.byName.fontSize.qname],"0"===u||"2"===u?r.styleAttrs[l.byName.extent.qname].h:r.styleAttrs[l.byName.extent.qname].w,"0"===u||"2"===u?e.cellLength.h:e.cellLength.w,"0"===u||"2"===u?e.pxLength.h:e.pxLength.w),null===s[u])return null;return s}),new t(e.ns_tts,"position","top left",["region"],!1,!0,function(e){return c.parsePosition(e)},function(e,t,r,n){var i,o;return null===(i=c.toComputedLength(n.v.offset.value,n.v.offset.unit,null,new c.ComputedLength(-r.styleAttrs[l.byName.extent.qname].h.rw,e.dimensions.h.rh-r.styleAttrs[l.byName.extent.qname].h.rh),null,e.pxLength.h))?null:("bottom"===n.v.edge&&(i=new c.ComputedLength(-i.rw-r.styleAttrs[l.byName.extent.qname].h.rw,e.dimensions.h.rh-i.rh-r.styleAttrs[l.byName.extent.qname].h.rh)),o=c.toComputedLength(n.h.offset.value,n.h.offset.unit,null,new c.ComputedLength(e.dimensions.w.rw-r.styleAttrs[l.byName.extent.qname].w.rw,-r.styleAttrs[l.byName.extent.qname].w.rh),null,e.pxLength.w),null===i?null:("right"===n.h.edge&&(o=new c.ComputedLength(e.dimensions.w.rw-o.rw-r.styleAttrs[l.byName.extent.qname].w.rw,-o.rh-r.styleAttrs[l.byName.extent.qname].w.rh)),{h:i,w:o}))}),new t(e.ns_tts,"ruby","none",["span"],!1,!0,function(e){return e},null),new t(e.ns_tts,"rubyAlign","center",["span"],!0,!0,function(e){return"center"!==e&&"spaceAround"!==e?null:e},null),new t(e.ns_tts,"rubyPosition","outside",["span"],!0,!0,function(e){return e},null),new t(e.ns_tts,"rubyReserve","none",["p"],!0,!0,function(e){var t=e.split(" "),r=[null,null];if(0===t.length||2<t.length)return null;if("none"!==t[0]&&"both"!==t[0]&&"after"!==t[0]&&"before"!==t[0]&&"outside"!==t[0])return null;if(r[0]=t[0],2===t.length&&"none"!==t[0]){var n=c.parseLength(t[1]);if(!n)return null;r[1]=n}return r},function(e,t,r,n,i){if("none"===n[0])return n;var o=null;return null===(o=null===n[1]?new c.ComputedLength(.5*r.styleAttrs[l.byName.fontSize.qname].rw,.5*r.styleAttrs[l.byName.fontSize.qname].rh):c.toComputedLength(n[1].value,n[1].unit,r.styleAttrs[l.byName.fontSize.qname],r.styleAttrs[l.byName.fontSize.qname],e.cellLength.h,e.pxLength.h))?null:[n[0],o]}),new t(e.ns_tts,"showBackground","always",["region"],!1,!0,function(e){return e},null),new t(e.ns_tts,"textAlign","start",["p"],!0,!0,function(e){return e},function(e,t,r,n,i){return"left"===n?"start":"right"===n?"end":n}),new t(e.ns_tts,"textCombine","none",["span"],!0,!0,function(e){var t=e.split(" ");return 1!==t.length||"none"!==t[0]&&"all"!==t[0]?null:[t[0]]},null),new t(e.ns_tts,"textDecoration","none",["span"],!0,!0,function(e){return e.split(" ")},null),new t(e.ns_tts,"textEmphasis","none",["span"],!1,!0,function(e){var t=e.split(" "),r={style:"filled",symbol:"circle",color:null,position:null};for(var n in t)if("none"===t[n]||"auto"===t[n])r.style=t[n];else if("filled"===t[n]||"open"===t[n])r.style=t[n];else if("circle"===t[n]||"dot"===t[n]||"sesame"===t[n])r.symbol=t[n];else if("current"===t[n])r.color=t[n];else if("outside"===t[n]||"before"===t[n]||"after"===t[n])r.position=t[n];else if(r.color=c.parseColor(t[n]),null===r.color)return null;return r},null),new t(e.ns_tts,"textOutline","none",["span"],!0,!0,function(e){if("none"===e)return e;var t={},r=e.split(" ");if(0===r.length||2<r.length)return null;var n=c.parseColor(r[0]);if(null!==(t.color=n)&&r.shift(),1!==r.length)return null;var i=c.parseLength(r[0]);return i?(t.thickness=i,t):null},function(e,t,r,n,i){if("none"===n)return n;var o={};return null===n.color?o.color=r.styleAttrs[l.byName.color.qname]:o.color=n.color,o.thickness=c.toComputedLength(n.thickness.value,n.thickness.unit,r.styleAttrs[l.byName.fontSize.qname],r.styleAttrs[l.byName.fontSize.qname],e.cellLength.h,e.pxLength.h),null===o.thickness?null:o}),new t(e.ns_tts,"textShadow","none",["span"],!0,!0,c.parseTextShadow,function(e,t,r,n){if("none"===n)return n;var i=[];for(var o in n){var a={};if(a.x_off=c.toComputedLength(n[o][0].value,n[o][0].unit,null,r.styleAttrs[l.byName.fontSize.qname],null,e.pxLength.w),null===a.x_off)return null;if(a.y_off=c.toComputedLength(n[o][1].value,n[o][1].unit,null,r.styleAttrs[l.byName.fontSize.qname],null,e.pxLength.h),null===a.y_off)return null;if(null===n[o][2])a.b_radius=0;else if(a.b_radius=c.toComputedLength(n[o][2].value,n[o][2].unit,null,r.styleAttrs[l.byName.fontSize.qname],null,e.pxLength.h),null===a.b_radius)return null;null===n[o][3]?a.color=r.styleAttrs[l.byName.color.qname]:a.color=n[o][3],i.push(a)}return i}),new t(e.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(e){return e},null),new t(e.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,function(e){return e},null),new t(e.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(e){return e},null),new t(e.ns_tts,"writingMode","lrtb",["region"],!1,!0,function(e){return e},null),new t(e.ns_tts,"zIndex","auto",["region"],!1,!0,function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t},null),new t(e.ns_ebutts,"linePadding","0c",["p"],!0,!1,c.parseLength,function(e,t,r,n,i){return c.toComputedLength(n.value,n.unit,null,null,e.cellLength.w,null)}),new t(e.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(e){return e},null),new t(e.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(e){return e},null),new t(e.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,function(e){return"true"===e},null),new t(e.ns_itts,"fillLineGap","false",["p"],!0,!0,function(e){return"true"===e},null)],l.byQName={},l.all)l.byQName[l.all[r].qname]=l.all[r];for(var n in l.byName={},l.all)l.byName[l.all[n].name]=l.all[n]}(void 0===r?this.imscStyles={}:r,"undefined"==typeof imscNames?e("./names"):imscNames,"undefined"==typeof imscUtils?e("./utils"):imscUtils)},{"./names":571,"./utils":573}],573:[function(e,t,r){!function(l){var i=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,o=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,a=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,s={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};l.parseColor=function(e){var t,r=null,n=s[e.toLowerCase()];return void 0!==n?r=n:null!==(t=i.exec(e))?r=[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),void 0!==t[4]?parseInt(t[4],16):255]:null!==(t=o.exec(e))?r=[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),255]:null!==(t=a.exec(e))&&(r=[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseInt(t[4])]),r};var n=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;l.parseLength=function(e){var t,r=null;return null!==(t=n.exec(e))&&(r={value:parseFloat(t[1]),unit:t[2]}),r},l.parseTextShadow=function(e){var t=e.split(","),r=[];for(var n in t){var i=t[n].split(" ");if(1===i.length&&"none"===i[0])return"none";if(1<i.length&&i.length<5){var o=[null,null,null,null],a=l.parseLength(i.shift());if(null===a)return null;if(o[0]=a,null===(a=l.parseLength(i.shift())))return null;if(o[1]=a,0===i.length){r.push(o);continue}if(null!==(a=l.parseLength(i[0]))&&(o[2]=a,i.shift()),0===i.length){r.push(o);continue}var s=l.parseColor(i[0]);if(null===s)return null;o[3]=s,r.push(o)}}return r},l.parsePosition=function(e){function t(e){return"center"===e||"left"===e||"top"===e||"bottom"===e||"right"===e}var r=e.split(" ");if(4<r.length)return null;for(var n in r)if(!t(r[n])){var i=l.parseLength(r[n]);if(null===i)return null;r[n]=i}for(var o={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},a=0;a<r.length;){var s=r[a++];if(t(s)){var u={value:0,unit:"%"};2!==r.length&&a<r.length&&!t(r[a])&&(u=r[a++]),"right"===s?(o.h.edge=s,o.h.offset=u):"bottom"===s?(o.v.edge=s,o.v.offset=u):"left"===s?o.h.offset=u:"top"===s&&(o.v.offset=u)}else{if(1!==r.length&&2!==r.length)return null;1===a?o.h.offset=s:o.v.offset=s}}return o},l.ComputedLength=function(e,t){this.rw=e,this.rh=t},l.ComputedLength.prototype.toUsedLength=function(e,t){return e*this.rw+t*this.rh},l.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},l.toComputedLength=function(e,t,r,n,i,o){return"%"===t&&n?new l.ComputedLength(n.rw*e/100,n.rh*e/100):"em"===t&&r?new l.ComputedLength(r.rw*e,r.rh*e):"c"===t&&i?new l.ComputedLength(e*i.rw,e*i.rh):"px"===t&&o?new l.ComputedLength(e*o.rw,e*o.rh):"rh"===t?new l.ComputedLength(0,e/100):"rw"===t?new l.ComputedLength(e/100,0):null}}(void 0===r?this.imscUtils={}:r)},{}],574:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},{}],575:[function(e,t,r){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],576:[function(e,t,r){"use strict";function n(e){try{var t=i.call(e);return o.test(t)}catch(e){return!1}}var i=Function.prototype.toString,o=/^\s*class\b/,a=Object.prototype.toString,s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;t.exports=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(s)return function(e){try{return!n(e)&&(i.call(e),!0)}catch(e){return!1}}(e);if(n(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},{}],577:[function(e,t,r){"use strict";var n=Date.prototype.getDay,i=Object.prototype.toString,o="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;t.exports=function(e){return"object"==typeof e&&null!==e&&(o?function(e){try{return n.call(e),!0}catch(e){return!1}}(e):"[object Date]"===i.call(e))}},{}],578:[function(e,t,r){"use strict";var n=e("has"),i=RegExp.prototype.exec,o=Object.getOwnPropertyDescriptor,a=Object.prototype.toString,s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;t.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!s)return"[object RegExp]"===a.call(e);var t=o(e,"lastIndex");return!(!t||!n(t,"value"))&&function(e){try{var t=e.lastIndex;return e.lastIndex=0,i.call(e),!0}catch(e){return!1}finally{e.lastIndex=t}}(e)}},{has:564}],579:[function(e,t,r){"use strict";var n=Object.prototype.toString;if(e("has-symbols")()){var i=Symbol.prototype.toString,o=/^Symbol\(.*\)$/;t.exports=function(e){if("symbol"==typeof e)return!0;if("[object Symbol]"!==n.call(e))return!1;try{return function(e){return"symbol"==typeof e.valueOf()&&o.test(i.call(e))}(e)}catch(e){return!1}}}else t.exports=function(e){return!1}},{"has-symbols":562}],580:[function(e,r,n){(function(S){var e,t;e=this,t=function(){var o={VERSION:"0.8.0",not:{},all:{},any:{}},n=Object.prototype.toString,r=Array.prototype.slice,i=Object.prototype.hasOwnProperty;function a(e){return function(){return!e.apply(null,r.call(arguments))}}function s(n){return function(){for(var e=d(arguments),t=e.length,r=0;r<t;r++)if(!n.call(null,e[r]))return!1;return!0}}function u(n){return function(){for(var e=d(arguments),t=e.length,r=0;r<t;r++)if(n.call(null,e[r]))return!0;return!1}}var l={"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},">":function(e,t){return t<e},">=":function(e,t){return t<=e}};function c(e,t){var r=t+"",n=+(r.match(/\d+/)||NaN),i=r.match(/^[<>]=?|/)[0];return l[i]?l[i](e,n):e==n||n!=n}function d(e){var t=r.call(e);return 1===t.length&&o.array(t[0])&&(t=t[0]),t}o.arguments=function(e){return"[object Arguments]"===n.call(e)||null!=e&&"object"==typeof e&&"callee"in e},o.array=Array.isArray||function(e){return"[object Array]"===n.call(e)},o.boolean=function(e){return!0===e||!1===e||"[object Boolean]"===n.call(e)},o.char=function(e){return o.string(e)&&1===e.length},o.date=function(e){return"[object Date]"===n.call(e)},o.domNode=function(e){return o.object(e)&&0<e.nodeType},o.error=function(e){return"[object Error]"===n.call(e)},o.function=function(e){return"[object Function]"===n.call(e)||"function"==typeof e},o.json=function(e){return"[object Object]"===n.call(e)},o.nan=function(e){return e!=e},o.null=function(e){return null===e},o.number=function(e){return o.not.nan(e)&&"[object Number]"===n.call(e)},o.object=function(e){return Object(e)===e},o.regexp=function(e){return"[object RegExp]"===n.call(e)},o.sameType=function(e,t){var r=n.call(e);return r===n.call(t)&&("[object Number]"!==r||(!o.any.nan(e,t)||o.all.nan(e,t)))},o.sameType.api=["not"],o.string=function(e){return"[object String]"===n.call(e)},o.undefined=function(e){return void 0===e},o.windowObject=function(e){return null!=e&&"object"==typeof e&&"setInterval"in e},o.empty=function(e){if(o.object(e)){var t=Object.getOwnPropertyNames(e).length;return!!(0===t||1===t&&o.array(e)||2===t&&o.arguments(e))}return""===e},o.existy=function(e){return null!=e},o.falsy=function(e){return!e},o.truthy=a(o.falsy),o.above=function(e,t){return o.all.number(e,t)&&t<e},o.above.api=["not"],o.decimal=function(e){return o.number(e)&&e%1!=0},o.equal=function(e,t){return o.all.number(e,t)?e===t&&1/e==1/t:o.all.string(e,t)||o.all.regexp(e,t)?""+e==""+t:!!o.all.boolean(e,t)&&e===t},o.equal.api=["not"],o.even=function(e){return o.number(e)&&e%2==0},o.finite=isFinite||function(e){return o.not.infinite(e)&&o.not.nan(e)},o.infinite=function(e){return e===1/0||e===-1/0},o.integer=function(e){return o.number(e)&&e%1==0},o.negative=function(e){return o.number(e)&&e<0},o.odd=function(e){return o.number(e)&&e%2==1},o.positive=function(e){return o.number(e)&&0<e},o.under=function(e,t){return o.all.number(e,t)&&e<t},o.under.api=["not"],o.within=function(e,t,r){return o.all.number(e,t,r)&&t<e&&e<r},o.within.api=["not"];var f={affirmative:/^(?:1|t(?:rue)?|y(?:es)?|ok(?:ay)?)$/,alphaNumeric:/^[A-Za-z0-9]+$/,caPostalCode:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s?[0-9][A-Z][0-9]$/,creditCard:/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/,dateString:/^(1[0-2]|0?[1-9])([\/-])(3[01]|[12][0-9]|0?[1-9])(?:\2)(?:[0-9]{2})?[0-9]{2}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,eppPhone:/^\+[0-9]{1,3}\.[0-9]{4,14}(?:x.+)?$/,hexadecimal:/^(?:0x)?[0-9a-fA-F]+$/,hexColor:/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,ipv4:/^(?:(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,nanpPhone:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,socialSecurityNumber:/^(?!000|666)[0-8][0-9]{2}-?(?!00)[0-9]{2}-?(?!0000)[0-9]{4}$/,timeString:/^(2[0-3]|[01]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/,ukPostCode:/^[A-Z]{1,2}[0-9RCHNQ][0-9A-Z]?\s?[0-9][ABD-HJLNP-UW-Z]{2}$|^[A-Z]{2}-?[0-9]{4}$/,url:/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i,usZipCode:/^[0-9]{5}(?:-[0-9]{4})?$/};function e(t,r){o[t]=function(e){return r[t].test(e)}}for(var t in f)f.hasOwnProperty(t)&&e(t,f);o.ip=function(e){return o.ipv4(e)||o.ipv6(e)},o.capitalized=function(e){if(o.not.string(e))return!1;for(var t=e.split(" "),r=0;r<t.length;r++){var n=t[r];if(n.length){var i=n.charAt(0);if(i!==i.toUpperCase())return!1}}return!0},o.endWith=function(e,t){if(o.not.string(e))return!1;t+="";var r=e.length-t.length;return 0<=r&&e.indexOf(t,r)===r},o.endWith.api=["not"],o.include=function(e,t){return-1<e.indexOf(t)},o.include.api=["not"],o.lowerCase=function(e){return o.string(e)&&e===e.toLowerCase()},o.palindrome=function(e){if(o.not.string(e))return!1;for(var t=(e=e.replace(/[^a-zA-Z0-9]+/g,"").toLowerCase()).length-1,r=0,n=Math.floor(t/2);r<=n;r++)if(e.charAt(r)!==e.charAt(t-r))return!1;return!0},o.space=function(e){if(o.not.char(e))return!1;var t=e.charCodeAt(0);return 8<t&&t<14||32===t},o.startWith=function(e,t){return o.string(e)&&0===e.indexOf(t)},o.startWith.api=["not"],o.upperCase=function(e){return o.string(e)&&e===e.toUpperCase()};var h=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],p=["january","february","march","april","may","june","july","august","september","october","november","december"];o.day=function(e,t){return o.date(e)&&t.toLowerCase()===h[e.getDay()]},o.day.api=["not"],o.dayLightSavingTime=function(e){var t=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear(),6,1),n=Math.max(t.getTimezoneOffset(),r.getTimezoneOffset());return e.getTimezoneOffset()<n},o.future=function(e){var t=new Date;return o.date(e)&&e.getTime()>t.getTime()},o.inDateRange=function(e,t,r){if(o.not.date(e)||o.not.date(t)||o.not.date(r))return!1;var n=e.getTime();return n>t.getTime()&&n<r.getTime()},o.inDateRange.api=["not"],o.inLastMonth=function(e){return o.inDateRange(e,new Date((new Date).setMonth((new Date).getMonth()-1)),new Date)},o.inLastWeek=function(e){return o.inDateRange(e,new Date((new Date).setDate((new Date).getDate()-7)),new Date)},o.inLastYear=function(e){return o.inDateRange(e,new Date((new Date).setFullYear((new Date).getFullYear()-1)),new Date)},o.inNextMonth=function(e){return o.inDateRange(e,new Date,new Date((new Date).setMonth((new Date).getMonth()+1)))},o.inNextWeek=function(e){return o.inDateRange(e,new Date,new Date((new Date).setDate((new Date).getDate()+7)))},o.inNextYear=function(e){return o.inDateRange(e,new Date,new Date((new Date).setFullYear((new Date).getFullYear()+1)))},o.leapYear=function(e){return o.number(e)&&(e%4==0&&e%100!=0||e%400==0)},o.month=function(e,t){return o.date(e)&&t.toLowerCase()===p[e.getMonth()]},o.month.api=["not"],o.past=function(e){var t=new Date;return o.date(e)&&e.getTime()<t.getTime()},o.quarterOfYear=function(e,t){return o.date(e)&&o.number(t)&&t===Math.floor((e.getMonth()+3)/3)},o.quarterOfYear.api=["not"],o.today=function(e){var t=(new Date).toDateString();return o.date(e)&&e.toDateString()===t},o.tomorrow=function(e){var t=new Date,r=new Date(t.setDate(t.getDate()+1)).toDateString();return o.date(e)&&e.toDateString()===r},o.weekend=function(e){return o.date(e)&&(6===e.getDay()||0===e.getDay())},o.weekday=a(o.weekend),o.year=function(e,t){return o.date(e)&&o.number(t)&&t===e.getFullYear()},o.year.api=["not"],o.yesterday=function(e){var t=new Date,r=new Date(t.setDate(t.getDate()-1)).toDateString();return o.date(e)&&e.toDateString()===r};var m=o.windowObject("object"==typeof S&&S)&&S,g=o.windowObject("object"==typeof self&&self)&&self,v=o.windowObject("object"==typeof this&&this)&&this,y=m||g||v||Function("return this")(),_=g&&g.document,b=y.is,E=g&&g.navigator,w=(E&&E.appVersion||"").toLowerCase(),A=(E&&E.userAgent||"").toLowerCase(),T=(E&&E.vendor||"").toLowerCase();return o.android=function(){return/android/.test(A)},o.android.api=["not"],o.androidPhone=function(){return/android/.test(A)&&/mobile/.test(A)},o.androidPhone.api=["not"],o.androidTablet=function(){return/android/.test(A)&&!/mobile/.test(A)},o.androidTablet.api=["not"],o.blackberry=function(){return/blackberry/.test(A)||/bb10/.test(A)},o.blackberry.api=["not"],o.chrome=function(e){var t=/google inc/.test(T)?A.match(/(?:chrome|crios)\/(\d+)/):null;return null!==t&&c(t[1],e)},o.chrome.api=["not"],o.desktop=function(){return o.not.mobile()&&o.not.tablet()},o.desktop.api=["not"],o.edge=function(e){var t=A.match(/edge\/(\d+)/);return null!==t&&c(t[1],e)},o.edge.api=["not"],o.firefox=function(e){var t=A.match(/(?:firefox|fxios)\/(\d+)/);return null!==t&&c(t[1],e)},o.firefox.api=["not"],o.ie=function(e){var t=A.match(/(?:msie |trident.+?; rv:)(\d+)/);return null!==t&&c(t[1],e)},o.ie.api=["not"],o.ios=function(){return o.iphone()||o.ipad()||o.ipod()},o.ios.api=["not"],o.ipad=function(e){var t=A.match(/ipad.+?os (\d+)/);return null!==t&&c(t[1],e)},o.ipad.api=["not"],o.iphone=function(e){var t=A.match(/iphone(?:.+?os (\d+))?/);return null!==t&&c(t[1]||1,e)},o.iphone.api=["not"],o.ipod=function(e){var t=A.match(/ipod.+?os (\d+)/);return null!==t&&c(t[1],e)},o.ipod.api=["not"],o.linux=function(){return/linux/.test(w)},o.linux.api=["not"],o.mac=function(){return/mac/.test(w)},o.mac.api=["not"],o.mobile=function(){return o.iphone()||o.ipod()||o.androidPhone()||o.blackberry()||o.windowsPhone()},o.mobile.api=["not"],o.offline=a(o.online),o.offline.api=["not"],o.online=function(){return!E||!0===E.onLine},o.online.api=["not"],o.opera=function(e){var t=A.match(/(?:^opera.+?version|opr)\/(\d+)/);return null!==t&&c(t[1],e)},o.opera.api=["not"],o.phantom=function(e){var t=A.match(/phantomjs\/(\d+)/);return null!==t&&c(t[1],e)},o.phantom.api=["not"],o.safari=function(e){var t=A.match(/version\/(\d+).+?safari/);return null!==t&&c(t[1],e)},o.safari.api=["not"],o.tablet=function(){return o.ipad()||o.androidTablet()||o.windowsTablet()},o.tablet.api=["not"],o.touchDevice=function(){return!!_&&("ontouchstart"in g||"DocumentTouch"in g&&_ instanceof DocumentTouch)},o.touchDevice.api=["not"],o.windows=function(){return/win/.test(w)},o.windows.api=["not"],o.windowsPhone=function(){return o.windows()&&/phone/.test(A)},o.windowsPhone.api=["not"],o.windowsTablet=function(){return o.windows()&&o.not.windowsPhone()&&/touch/.test(A)},o.windowsTablet.api=["not"],o.propertyCount=function(e,t){if(o.not.object(e)||o.not.number(t))return!1;var r=0;for(var n in e)if(i.call(e,n)&&++r>t)return!1;return r===t},o.propertyCount.api=["not"],o.propertyDefined=function(e,t){return o.object(e)&&o.string(t)&&t in e},o.propertyDefined.api=["not"],o.inArray=function(e,t){if(o.not.array(t))return!1;for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},o.inArray.api=["not"],o.sorted=function(e,t){if(o.not.array(e))return!1;for(var r=l[t]||l[">="],n=1;n<e.length;n++)if(!r(e[n],e[n-1]))return!1;return!0},function(){var e=o;for(var t in e)if(i.call(e,t)&&o.function(e[t]))for(var r=e[t].api||["not","all","any"],n=0;n<r.length;n++)"not"===r[n]&&(o.not[t]=a(o[t])),"all"===r[n]&&(o.all[t]=s(o[t])),"any"===r[n]&&(o.any[t]=u(o[t]))}(),o.setNamespace=function(){return y.is=b,this},o.setRegexp=function(e,t){for(var r in f)i.call(f,r)&&t===r&&(f[r]=e)},o},"function"==typeof define&&define.amd?define(function(){return e.is=t()}):"object"==typeof n?r.exports=t():e.is=t()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],581:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],582:[function(e,r,t){!function(e,t){"use strict";"object"==typeof r&&"object"==typeof r.exports?r.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(A,e){"use strict";function m(e){return null!=e&&e===e.window}var t=[],T=A.document,n=Object.getPrototypeOf,s=t.slice,g=t.concat,u=t.push,i=t.indexOf,r={},o=r.toString,v=r.hasOwnProperty,a=v.toString,l=a.call(Object),y={},_=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,r){var n,i,o=(r=r||T).createElement("script");if(o.text=e,t)for(n in c)(i=t[n]||t.getAttribute&&t.getAttribute(n))&&o.setAttribute(n,i);r.head.appendChild(o).parentNode.removeChild(o)}function E(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?r[o.call(e)]||"object":typeof e}var S=function(e,t){return new S.fn.init(e,t)},d=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function f(e){var t=!!e&&"length"in e&&e.length,r=E(e);return!_(e)&&!m(e)&&("array"===r||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:"3.4.1",constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(r){return this.pushStack(S.map(this,function(e,t){return r.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,r=+e+(e<0?t:0);return this.pushStack(0<=r&&r<t?[this[r]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,r,n,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||_(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)n=e[t],"__proto__"!==t&&a!==n&&(l&&n&&(S.isPlainObject(n)||(i=Array.isArray(n)))?(r=a[t],o=i&&!Array.isArray(r)?[]:i||S.isPlainObject(r)?r:{},i=!1,a[t]=S.extend(l,o,n)):void 0!==n&&(a[t]=n));return a},S.extend({expando:"jQuery"+("3.4.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,r;return!(!e||"[object Object]"!==o.call(e))&&(!(t=n(e))||"function"==typeof(r=v.call(t,"constructor")&&t.constructor)&&a.call(r)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t){b(e,{nonce:t&&t.nonce})},each:function(e,t){var r,n=0;if(f(e))for(r=e.length;n<r&&!1!==t.call(e[n],n,e[n]);n++);else for(n in e)if(!1===t.call(e[n],n,e[n]))break;return e},trim:function(e){return null==e?"":(e+"").replace(d,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(f(Object(e))?S.merge(r,"string"==typeof e?[e]:e):u.call(r,e)),r},inArray:function(e,t,r){return null==t?-1:i.call(t,e,r)},merge:function(e,t){for(var r=+t.length,n=0,i=e.length;n<r;n++)e[i++]=t[n];return e.length=i,e},grep:function(e,t,r){for(var n=[],i=0,o=e.length,a=!r;i<o;i++)!t(e[i],i)!=a&&n.push(e[i]);return n},map:function(e,t,r){var n,i,o=0,a=[];if(f(e))for(n=e.length;o<n;o++)null!=(i=t(e[o],o,r))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,r))&&a.push(i);return g.apply([],a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){r["[object "+t+"]"]=t.toLowerCase()});var h=function(r){function d(e,t,r){var n="0x"+t-65536;return n!=n||r?t:n<0?String.fromCharCode(65536+n):String.fromCharCode(n>>10|55296,1023&n|56320)}function i(){w()}var e,h,b,o,a,p,f,m,E,u,l,w,A,s,T,g,c,v,y,S="sizzle"+1*new Date,_=r.document,x=0,n=0,M=ue(),R=ue(),O=ue(),P=ue(),C=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],I=t.pop,L=t.push,N=t.push,k=t.slice,F=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",U="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",G="\\["+B+"*("+U+")(?:"+B+"*([*^$|!~]?=)"+B+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+U+"))|)"+B+"*\\]",H=":("+U+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+G+")*)|.*)\\)|)",V=new RegExp(B+"+","g"),z=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),W=new RegExp("^"+B+"*,"+B+"*"),q=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),Y=new RegExp(B+"|>"),K=new RegExp(H),X=new RegExp("^"+U+"$"),Q={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),TAG:new RegExp("^("+U+"|[*])"),ATTR:new RegExp("^"+G),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},J=/HTML$/i,Z=/^(?:input|select|textarea|button)$/i,$=/^h\d$/i,ee=/^[^{]+\{\s*\[native \w/,te=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,re=/[+~]/,ne=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),ie=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,oe=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{N.apply(t=k.call(_.childNodes),_.childNodes),t[_.childNodes.length].nodeType}catch(e){N={apply:t.length?function(e,t){L.apply(e,k.call(t))}:function(e,t){for(var r=e.length,n=0;e[r++]=t[n++];);e.length=r-1}}}function se(t,e,r,n){var i,o,a,s,u,l,c,d=e&&e.ownerDocument,f=e?e.nodeType:9;if(r=r||[],"string"!=typeof t||!t||1!==f&&9!==f&&11!==f)return r;if(!n&&((e?e.ownerDocument||e:_)!==A&&w(e),e=e||A,T)){if(11!==f&&(u=te.exec(t)))if(i=u[1]){if(9===f){if(!(a=e.getElementById(i)))return r;if(a.id===i)return r.push(a),r}else if(d&&(a=d.getElementById(i))&&y(e,a)&&a.id===i)return r.push(a),r}else{if(u[2])return N.apply(r,e.getElementsByTagName(t)),r;if((i=u[3])&&h.getElementsByClassName&&e.getElementsByClassName)return N.apply(r,e.getElementsByClassName(i)),r}if(h.qsa&&!P[t+" "]&&(!g||!g.test(t))&&(1!==f||"object"!==e.nodeName.toLowerCase())){if(c=t,d=e,1===f&&Y.test(t)){for((s=e.getAttribute("id"))?s=s.replace(ie,oe):e.setAttribute("id",s=S),o=(l=p(t)).length;o--;)l[o]="#"+s+" "+_e(l[o]);c=l.join(","),d=re.test(t)&&ve(e.parentNode)||e}try{return N.apply(r,d.querySelectorAll(c)),r}catch(e){P(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return m(t.replace(z,"$1"),e,r,n)}function ue(){var n=[];return function e(t,r){return n.push(t+" ")>b.cacheLength&&delete e[n.shift()],e[t+" "]=r}}function le(e){return e[S]=!0,e}function ce(e){var t=A.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function de(e,t){for(var r=e.split("|"),n=r.length;n--;)b.attrHandle[r[n]]=t}function fe(e,t){var r=t&&e,n=r&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(r)for(;r=r.nextSibling;)if(r===t)return-1;return e?1:-1}function he(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function pe(r){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===r}}function me(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ge(a){return le(function(o){return o=+o,le(function(e,t){for(var r,n=a([],e.length,o),i=n.length;i--;)e[r=n[i]]&&(e[r]=!(t[r]=e[r]))})})}function ve(e){return e&&void 0!==e.getElementsByTagName&&e}for(e in h=se.support={},a=se.isXML=function(e){var t=e.namespaceURI,r=(e.ownerDocument||e).documentElement;return!J.test(t||r&&r.nodeName||"HTML")},w=se.setDocument=function(e){var t,r,n=e?e.ownerDocument||e:_;return n!==A&&9===n.nodeType&&n.documentElement&&(s=(A=n).documentElement,T=!a(A),_!==A&&(r=A.defaultView)&&r.top!==r&&(r.addEventListener?r.addEventListener("unload",i,!1):r.attachEvent&&r.attachEvent("onunload",i)),h.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),h.getElementsByTagName=ce(function(e){return e.appendChild(A.createComment("")),!e.getElementsByTagName("*").length}),h.getElementsByClassName=ee.test(A.getElementsByClassName),h.getById=ce(function(e){return s.appendChild(e).id=S,!A.getElementsByName||!A.getElementsByName(S).length}),h.getById?(b.filter.ID=function(e){var t=e.replace(ne,d);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if(void 0!==t.getElementById&&T){var r=t.getElementById(e);return r?[r]:[]}}):(b.filter.ID=function(e){var r=e.replace(ne,d);return function(e){var t=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===r}},b.find.ID=function(e,t){if(void 0!==t.getElementById&&T){var r,n,i,o=t.getElementById(e);if(o){if((r=o.getAttributeNode("id"))&&r.value===e)return[o];for(i=t.getElementsByName(e),n=0;o=i[n++];)if((r=o.getAttributeNode("id"))&&r.value===e)return[o]}return[]}}),b.find.TAG=h.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):h.qsa?t.querySelectorAll(e):void 0}:function(e,t){var r,n=[],i=0,o=t.getElementsByTagName(e);if("*"!==e)return o;for(;r=o[i++];)1===r.nodeType&&n.push(r);return n},b.find.CLASS=h.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&T)return t.getElementsByClassName(e)},c=[],g=[],(h.qsa=ee.test(A.querySelectorAll))&&(ce(function(e){s.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&g.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||g.push("\\["+B+"*(?:value|"+j+")"),e.querySelectorAll("[id~="+S+"-]").length||g.push("~="),e.querySelectorAll(":checked").length||g.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||g.push(".#.+[+~]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=A.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&g.push("name"+B+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&g.push(":enabled",":disabled"),s.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(h.matchesSelector=ee.test(v=s.matches||s.webkitMatchesSelector||s.mozMatchesSelector||s.oMatchesSelector||s.msMatchesSelector))&&ce(function(e){h.disconnectedMatch=v.call(e,"*"),v.call(e,"[s!='']:x"),c.push("!=",H)}),g=g.length&&new RegExp(g.join("|")),c=c.length&&new RegExp(c.join("|")),t=ee.test(s.compareDocumentPosition),y=t||ee.test(s.contains)?function(e,t){var r=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(r.contains?r.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},C=t?function(e,t){if(e===t)return l=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!h.sortDetached&&t.compareDocumentPosition(e)===r?e===A||e.ownerDocument===_&&y(_,e)?-1:t===A||t.ownerDocument===_&&y(_,t)?1:u?F(u,e)-F(u,t):0:4&r?-1:1)}:function(e,t){if(e===t)return l=!0,0;var r,n=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===A?-1:t===A?1:i?-1:o?1:u?F(u,e)-F(u,t):0;if(i===o)return fe(e,t);for(r=e;r=r.parentNode;)a.unshift(r);for(r=t;r=r.parentNode;)s.unshift(r);for(;a[n]===s[n];)n++;return n?fe(a[n],s[n]):a[n]===_?-1:s[n]===_?1:0}),A},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if((e.ownerDocument||e)!==A&&w(e),h.matchesSelector&&T&&!P[t+" "]&&(!c||!c.test(t))&&(!g||!g.test(t)))try{var r=v.call(e,t);if(r||h.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){P(t,!0)}return 0<se(t,A,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!==A&&w(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!==A&&w(e);var r=b.attrHandle[t.toLowerCase()],n=r&&D.call(b.attrHandle,t.toLowerCase())?r(e,t,!T):void 0;return void 0!==n?n:h.attributes||!T?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},se.escape=function(e){return(e+"").replace(ie,oe)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,r=[],n=0,i=0;if(l=!h.detectDuplicates,u=!h.sortStable&&e.slice(0),e.sort(C),l){for(;t=e[i++];)t===e[i]&&(n=r.push(i));for(;n--;)e.splice(r[n],1)}return u=null,e},o=se.getText=function(e){var t,r="",n=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[n++];)r+=o(t);return r},(b=se.selectors={cacheLength:50,createPseudo:le,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ne,d),e[3]=(e[3]||e[4]||e[5]||"").replace(ne,d),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,r=!e[6]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":r&&K.test(r)&&(t=p(r,!0))&&(t=r.indexOf(")",r.length-t)-r.length)&&(e[0]=e[0].slice(0,t),e[2]=r.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ne,d).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=M[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&M(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(r,n,i){return function(e){var t=se.attr(e,r);return null==t?"!="===n:!n||(t+="","="===n?t===i:"!="===n?t!==i:"^="===n?i&&0===t.indexOf(i):"*="===n?i&&-1<t.indexOf(i):"$="===n?i&&t.slice(-i.length)===i:"~="===n?-1<(" "+t.replace(V," ")+" ").indexOf(i):"|="===n&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(p,e,t,m,g){var v="nth"!==p.slice(0,3),y="last"!==p.slice(-4),_="of-type"===e;return 1===m&&0===g?function(e){return!!e.parentNode}:function(e,t,r){var n,i,o,a,s,u,l=v!=y?"nextSibling":"previousSibling",c=e.parentNode,d=_&&e.nodeName.toLowerCase(),f=!r&&!_,h=!1;if(c){if(v){for(;l;){for(a=e;a=a[l];)if(_?a.nodeName.toLowerCase()===d:1===a.nodeType)return!1;u=l="only"===p&&!u&&"nextSibling"}return!0}if(u=[y?c.firstChild:c.lastChild],y&&f){for(h=(s=(n=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[p]||[])[0]===x&&n[1])&&n[2],a=s&&c.childNodes[s];a=++s&&a&&a[l]||(h=s=0)||u.pop();)if(1===a.nodeType&&++h&&a===e){i[p]=[x,s,h];break}}else if(f&&(h=s=(n=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[p]||[])[0]===x&&n[1]),!1===h)for(;(a=++s&&a&&a[l]||(h=s=0)||u.pop())&&((_?a.nodeName.toLowerCase()!==d:1!==a.nodeType)||!++h||(f&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[p]=[x,h]),a!==e)););return(h-=g)===m||h%m==0&&0<=h/m}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){for(var r,n=a(e,o),i=n.length;i--;)e[r=F(e,n[i])]=!(t[r]=n[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var n=[],i=[],s=f(e.replace(z,"$1"));return s[S]?le(function(e,t,r,n){for(var i,o=s(e,null,n,[]),a=e.length;a--;)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,r){return n[0]=e,s(n,null,r,i),n[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(ne,d),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(r){return X.test(r||"")||se.error("unsupported lang: "+r),r=r.replace(ne,d).toLowerCase(),function(e){var t;do{if(t=T?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===r||0===t.indexOf(r+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=r.location&&r.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===s},focus:function(e){return e===A.activeElement&&(!A.hasFocus||A.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:me(!1),disabled:me(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return $.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ge(function(){return[0]}),last:ge(function(e,t){return[t-1]}),eq:ge(function(e,t,r){return[r<0?r+t:r]}),even:ge(function(e,t){for(var r=0;r<t;r+=2)e.push(r);return e}),odd:ge(function(e,t){for(var r=1;r<t;r+=2)e.push(r);return e}),lt:ge(function(e,t,r){for(var n=r<0?r+t:t<r?t:r;0<=--n;)e.push(n);return e}),gt:ge(function(e,t,r){for(var n=r<0?r+t:r;++n<t;)e.push(n);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=he(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=pe(e);function ye(){}function _e(e){for(var t=0,r=e.length,n="";t<r;t++)n+=e[t].value;return n}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,d=t&&"parentNode"===c,f=n++;return e.first?function(e,t,r){for(;e=e[u];)if(1===e.nodeType||d)return s(e,t,r);return!1}:function(e,t,r){var n,i,o,a=[x,f];if(r){for(;e=e[u];)if((1===e.nodeType||d)&&s(e,t,r))return!0}else for(;e=e[u];)if(1===e.nodeType||d)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((n=i[c])&&n[0]===x&&n[1]===f)return a[2]=n[2];if((i[c]=a)[2]=s(e,t,r))return!0}return!1}}function Ee(i){return 1<i.length?function(e,t,r){for(var n=i.length;n--;)if(!i[n](e,t,r))return!1;return!0}:i[0]}function we(e,t,r,n,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(r&&!r(o,n,i)||(a.push(o),l&&t.push(s)));return a}function Ae(h,p,m,g,v,e){return g&&!g[S]&&(g=Ae(g)),v&&!v[S]&&(v=Ae(v,e)),le(function(e,t,r,n){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,r){for(var n=0,i=t.length;n<i;n++)se(e,t[n],r);return r}(p||"*",r.nodeType?[r]:r,[]),d=!h||!e&&p?c:we(c,s,h,r,n),f=m?v||(e?h:l||g)?[]:t:d;if(m&&m(d,f,r,n),g)for(i=we(f,u),g(i,[],r,n),o=i.length;o--;)(a=i[o])&&(f[u[o]]=!(d[u[o]]=a));if(e){if(v||h){if(v){for(i=[],o=f.length;o--;)(a=f[o])&&i.push(d[o]=a);v(null,f=[],i,n)}for(o=f.length;o--;)(a=f[o])&&-1<(i=v?F(e,a):s[o])&&(e[i]=!(t[i]=a))}}else f=we(f===t?f.splice(l,f.length):f),v?v(null,t,f,n):N.apply(t,f)})}function Te(e){for(var i,t,r,n=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<F(i,e)},a,!0),c=[function(e,t,r){var n=!o&&(r||t!==E)||((i=t).nodeType?u(e,t,r):l(e,t,r));return i=null,n}];s<n;s++)if(t=b.relative[e[s].type])c=[be(Ee(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(r=++s;r<n&&!b.relative[e[r].type];r++);return Ae(1<s&&Ee(c),1<s&&_e(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(z,"$1"),t,s<r&&Te(e.slice(s,r)),r<n&&Te(e=e.slice(r)),r<n&&_e(e))}c.push(t)}return Ee(c)}return ye.prototype=b.filters=b.pseudos,b.setFilters=new ye,p=se.tokenize=function(e,t){var r,n,i,o,a,s,u,l=R[e+" "];if(l)return t?0:l.slice(0);for(a=e,s=[],u=b.preFilter;a;){for(o in r&&!(n=W.exec(a))||(n&&(a=a.slice(n[0].length)||a),s.push(i=[])),r=!1,(n=q.exec(a))&&(r=n.shift(),i.push({value:r,type:n[0].replace(z," ")}),a=a.slice(r.length)),b.filter)!(n=Q[o].exec(a))||u[o]&&!(n=u[o](n))||(r=n.shift(),i.push({value:r,type:o,matches:n}),a=a.slice(r.length));if(!r)break}return t?a.length:a?se.error(e):R(e,s).slice(0)},f=se.compile=function(e,t){var r,n=[],i=[],o=O[e+" "];if(!o){for(r=(t=t||p(e)).length;r--;)(o=Te(t[r]))[S]?n.push(o):i.push(o);(o=O(e,function(g,v){function e(e,t,r,n,i){var o,a,s,u=0,l="0",c=e&&[],d=[],f=E,h=e||_&&b.find.TAG("*",i),p=x+=null==f?1:Math.random()||.1,m=h.length;for(i&&(E=t===A||t||i);l!==m&&null!=(o=h[l]);l++){if(_&&o){for(a=0,t||o.ownerDocument===A||(w(o),r=!T);s=g[a++];)if(s(o,t||A,r)){n.push(o);break}i&&(x=p)}y&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,y&&l!==u){for(a=0;s=v[a++];)s(c,d,t,r);if(e){if(0<u)for(;l--;)c[l]||d[l]||(d[l]=I.call(n));d=we(d)}N.apply(n,d),i&&!e&&0<d.length&&1<u+v.length&&se.uniqueSort(n)}return i&&(x=p,E=f),c}var y=0<v.length,_=0<g.length;return y?le(e):e}(i,n))).selector=e}return o},m=se.select=function(e,t,r,n){var i,o,a,s,u,l="function"==typeof e&&e,c=!n&&p(e=l.selector||e);if(r=r||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&T&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(ne,d),t)||[])[0]))return r;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=Q.needsContext.test(e)?0:o.length;i--&&(a=o[i],!b.relative[s=a.type]);)if((u=b.find[s])&&(n=u(a.matches[0].replace(ne,d),re.test(o[0].type)&&ve(t.parentNode)||t))){if(o.splice(i,1),!(e=n.length&&_e(o)))return N.apply(r,n),r;break}}return(l||f(e,c))(n,t,!T,r,!t||re.test(e)&&ve(t.parentNode)||t),r},h.sortStable=S.split("").sort(C).join("")===S,h.detectDuplicates=!!l,w(),h.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(A.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||de("type|href|height|width",function(e,t,r){if(!r)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),h.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||de("value",function(e,t,r){if(!r&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||de(j,function(e,t,r){var n;if(!r)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),se}(A);S.find=h,S.expr=h.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=h.uniqueSort,S.text=h.getText,S.isXMLDoc=h.isXML,S.contains=h.contains,S.escapeSelector=h.escape;function p(e,t,r){for(var n=[],i=void 0!==r;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&S(e).is(r))break;n.push(e)}return n}function w(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r}var x=S.expr.match.needsContext;function M(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var R=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function O(e,r,n){return _(r)?S.grep(e,function(e,t){return!!r.call(e,t,e)!==n}):r.nodeType?S.grep(e,function(e){return e===r!==n}):"string"!=typeof r?S.grep(e,function(e){return-1<i.call(r,e)!==n}):S.filter(r,e,n)}S.filter=function(e,t,r){var n=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?S.find.matchesSelector(n,e)?[n]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,r,n=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<n;t++)if(S.contains(i[t],this))return!0}));for(r=this.pushStack([]),t=0;t<n;t++)S.find(e,i[t],r);return 1<n?S.uniqueSort(r):r},filter:function(e){return this.pushStack(O(this,e||[],!1))},not:function(e){return this.pushStack(O(this,e||[],!0))},is:function(e){return!!O(this,"string"==typeof e&&x.test(e)?S(e):e||[],!1).length}});var P,C=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,r){var n,i;if(!e)return this;if(r=r||P,"string"!=typeof e)return e.nodeType?(this[0]=e,this.length=1,this):_(e)?void 0!==r.ready?r.ready(e):e(S):S.makeArray(e,this);if(!(n="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:C.exec(e))||!n[1]&&t)return!t||t.jquery?(t||r).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:T,!0)),R.test(n[1])&&S.isPlainObject(t))for(n in t)_(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return(i=T.getElementById(n[2]))&&(this[0]=i,this.length=1),this}).prototype=S.fn,P=S(T);var D=/^(?:parents|prev(?:Until|All))/,I={children:!0,contents:!0,next:!0,prev:!0};function L(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}S.fn.extend({has:function(e){var t=S(e,this),r=t.length;return this.filter(function(){for(var e=0;e<r;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var r,n=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!x.test(e))for(;n<i;n++)for(r=this[n];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(a?-1<a.index(r):1===r.nodeType&&S.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return p(e,"parentNode")},parentsUntil:function(e,t,r){return p(e,"parentNode",r)},next:function(e){return L(e,"nextSibling")},prev:function(e){return L(e,"previousSibling")},nextAll:function(e){return p(e,"nextSibling")},prevAll:function(e){return p(e,"previousSibling")},nextUntil:function(e,t,r){return p(e,"nextSibling",r)},prevUntil:function(e,t,r){return p(e,"previousSibling",r)},siblings:function(e){return w((e.parentNode||{}).firstChild,e)},children:function(e){return w(e.firstChild)},contents:function(e){return void 0!==e.contentDocument?e.contentDocument:(M(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(n,i){S.fn[n]=function(e,t){var r=S.map(this,i,e);return"Until"!==n.slice(-5)&&(t=e),t&&"string"==typeof t&&(r=S.filter(t,r)),1<this.length&&(I[n]||S.uniqueSort(r),D.test(n)&&r.reverse()),this.pushStack(r)}});var N=/[^\x20\t\r\n\f]+/g;function k(e){return e}function F(e){throw e}function j(e,t,r,n){var i;try{e&&_(i=e.promise)?i.call(e).done(t).fail(r):e&&_(i=e.then)?i.call(e,t,r):t.apply(void 0,[e].slice(n))}catch(e){r.apply(void 0,[e])}}S.Callbacks=function(n){n="string"==typeof n?function(e){var r={};return S.each(e.match(N)||[],function(e,t){r[t]=!0}),r}(n):S.extend({},n);function r(){for(o=o||n.once,t=i=!0;s.length;u=-1)for(e=s.shift();++u<a.length;)!1===a[u].apply(e[0],e[1])&&n.stopOnFalse&&(u=a.length,e=!1);n.memory||(e=!1),i=!1,o&&(a=e?[]:"")}var i,e,t,o,a=[],s=[],u=-1,l={add:function(){return a&&(e&&!i&&(u=a.length-1,s.push(e)),function r(e){S.each(e,function(e,t){_(t)?n.unique&&l.has(t)||a.push(t):t&&t.length&&"string"!==E(t)&&r(t)})}(arguments),e&&!i&&r()),this},remove:function(){return S.each(arguments,function(e,t){for(var r;-1<(r=S.inArray(t,a,r));)a.splice(r,1),r<=u&&u--}),this},has:function(e){return e?-1<S.inArray(e,a):0<a.length},empty:function(){return a=a&&[],this},disable:function(){return o=s=[],a=e="",this},disabled:function(){return!a},lock:function(){return o=s=[],e||i||(a=e=""),this},locked:function(){return!!o},fireWith:function(e,t){return o||(t=[e,(t=t||[]).slice?t.slice():t],s.push(t),i||r()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!t}};return l},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(n){S.each(o,function(e,t){var r=_(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=r&&r.apply(this,arguments);e&&_(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[t[0]+"With"](this,r?[e]:arguments)})}),i=null}).promise()},then:function(t,r,n){var u=0;function l(i,o,a,s){return function(){function e(){var e,t;if(!(i<u)){if((e=a.apply(r,n))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,_(t)?s?t.call(e,l(u,o,k,s),l(u,o,F,s)):(u++,t.call(e,l(u,o,k,s),l(u,o,F,s),l(u,o,k,o.notifyWith))):(a!==k&&(r=void 0,n=[e]),(s||o.resolveWith)(r,n))}}var r=this,n=arguments,t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==F&&(r=void 0,n=[e]),o.rejectWith(r,n))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),A.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,_(n)?n:k,e.notifyWith)),o[1][3].add(l(0,e,_(t)?t:k)),o[2][3].add(l(0,e,_(r)?r:F))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var r=t[2],n=t[5];a[t[1]]=r.add,n&&r.add(function(){i=n},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),r.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=r.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){function t(t){return function(e){i[t]=this,o[t]=1<arguments.length?s.call(arguments):e,--r||a.resolveWith(i,o)}}var r=arguments.length,n=r,i=Array(n),o=s.call(arguments),a=S.Deferred();if(r<=1&&(j(e,a.done(t(n)).resolve,a.reject,!r),"pending"===a.state()||_(o[n]&&o[n].then)))return a.then();for(;n--;)j(o[n],t(n),a.reject);return a.promise()}});var B=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){A.console&&A.console.warn&&e&&B.test(e.name)&&A.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){A.setTimeout(function(){throw e})};var U=S.Deferred();function G(){T.removeEventListener("DOMContentLoaded",G),A.removeEventListener("load",G),S.ready()}S.fn.ready=function(e){return U.then(e).catch(function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||U.resolveWith(T,[S])}}),S.ready.then=U.then,"complete"===T.readyState||"loading"!==T.readyState&&!T.documentElement.doScroll?A.setTimeout(S.ready):(T.addEventListener("DOMContentLoaded",G),A.addEventListener("load",G));var H=function(e,t,r,n,i,o,a){var s=0,u=e.length,l=null==r;if("object"===E(r))for(s in i=!0,r)H(e,t,s,r[s],!0,o,a);else if(void 0!==n&&(i=!0,_(n)||(a=!0),l&&(t=a?(t.call(e,n),null):(l=t,function(e,t,r){return l.call(S(e),r)})),t))for(;s<u;s++)t(e[s],r,a?n:n.call(e[s],s,t(e[s],r)));return i?e:l?t.call(e):u?t(e[0],r):o},V=/^-ms-/,z=/-([a-z])/g;function W(e,t){return t.toUpperCase()}function q(e){return e.replace(V,"ms-").replace(z,W)}function Y(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function K(){this.expando=S.expando+K.uid++}K.uid=1,K.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,r){var n,i=this.cache(e);if("string"==typeof t)i[q(t)]=r;else for(n in t)i[q(n)]=t[n];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][q(t)]},access:function(e,t,r){return void 0===t||t&&"string"==typeof t&&void 0===r?this.get(e,t):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,n=e[this.expando];if(void 0!==n){if(void 0!==t){r=(t=Array.isArray(t)?t.map(q):(t=q(t))in n?[t]:t.match(N)||[]).length;for(;r--;)delete n[t[r]]}void 0!==t&&!S.isEmptyObject(n)||(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var X=new K,Q=new K,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function $(e,t,r){var n;if(void 0===r&&1===e.nodeType)if(n="data-"+t.replace(Z,"-$&").toLowerCase(),"string"==typeof(r=e.getAttribute(n))){try{r=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:J.test(e)?JSON.parse(e):e)}(r)}catch(e){}Q.set(e,t,r)}else r=void 0;return r}S.extend({hasData:function(e){return Q.hasData(e)||X.hasData(e)},data:function(e,t,r){return Q.access(e,t,r)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,r){return X.access(e,t,r)},_removeData:function(e,t){X.remove(e,t)}}),S.fn.extend({data:function(r,e){var t,n,i,o=this[0],a=o&&o.attributes;if(void 0!==r)return"object"==typeof r?this.each(function(){Q.set(this,r)}):H(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,r))?t:void 0!==(t=$(o,r))?t:void 0;this.each(function(){Q.set(this,r,e)})},null,e,1<arguments.length,null,!0);if(this.length&&(i=Q.get(o),1===o.nodeType&&!X.get(o,"hasDataAttrs"))){for(t=a.length;t--;)a[t]&&0===(n=a[t].name).indexOf("data-")&&(n=q(n.slice(5)),$(o,n,i[n]));X.set(o,"hasDataAttrs",!0)}return i},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,r){var n;if(e)return t=(t||"fx")+"queue",n=X.get(e,t),r&&(!n||Array.isArray(r)?n=X.access(e,t,S.makeArray(r)):n.push(r)),n||[]},dequeue:function(e,t){t=t||"fx";var r=S.queue(e,t),n=r.length,i=r.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=r.shift(),n--),i&&("fx"===t&&r.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return X.get(e,r)||X.access(e,r,{empty:S.Callbacks("once memory").add(function(){X.remove(e,[t+"queue",r])})})}}),S.fn.extend({queue:function(t,r){var e=2;return"string"!=typeof t&&(r=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===r?this:this.each(function(){var e=S.queue(this,t,r);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function r(){--i||o.resolveWith(a,[a])}var n,i=1,o=S.Deferred(),a=this,s=this.length;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(n=X.get(a[s],e+"queueHooks"))&&n.empty&&(i++,n.empty.add(r));return r(),o.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),re=["Top","Right","Bottom","Left"],ne=T.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};ne.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});function ae(e,t,r,n){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=r.apply(e,n||[]),t)e.style[o]=a[o];return i}var se=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function ue(e,t,r,n){var i,o,a=20,s=n?function(){return n.cur()}:function(){return S.css(e,t,"")},u=s(),l=r&&r[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){for(u/=2,l=l||c[3],c=+u||1;a--;)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),r=r||[]}return r&&(c=+c||+u||0,i=r[1]?c+(r[1]+1)*r[2]:+r[2],n&&(n.unit=l,n.start=c,n.end=i)),i}var le={};function ce(e,t){for(var r,n,i,o,a,s,u,l=[],c=0,d=e.length;c<d;c++)(n=e[c]).style&&(r=n.style.display,t?("none"===r&&(l[c]=X.get(n,"display")||null,l[c]||(n.style.display="")),""===n.style.display&&se(n)&&(l[c]=(u=a=o=void 0,a=(i=n).ownerDocument,s=i.nodeName,(u=le[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),le[s]=u)))):"none"!==r&&(l[c]="none",X.set(n,"display",r)));for(c=0;c<d;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return ce(this,!0)},hide:function(){return ce(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){se(this)?S(this).show():S(this).hide()})}});var de=/^(?:checkbox|radio)$/i,fe=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i,pe={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function me(e,t){var r;return r=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&M(e,t)?S.merge([e],r):r}function ge(e,t){for(var r=0,n=e.length;r<n;r++)X.set(e[r],"globalEval",!t||X.get(t[r],"globalEval"))}pe.optgroup=pe.option,pe.tbody=pe.tfoot=pe.colgroup=pe.caption=pe.thead,pe.th=pe.td;var ve,ye,_e=/<|&#?\w+;/;function be(e,t,r,n,i){for(var o,a,s,u,l,c,d=t.createDocumentFragment(),f=[],h=0,p=e.length;h<p;h++)if((o=e[h])||0===o)if("object"===E(o))S.merge(f,o.nodeType?[o]:o);else if(_e.test(o)){for(a=a||d.appendChild(t.createElement("div")),s=(fe.exec(o)||["",""])[1].toLowerCase(),u=pe[s]||pe._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;S.merge(f,a.childNodes),(a=d.firstChild).textContent=""}else f.push(t.createTextNode(o));for(d.textContent="",h=0;o=f[h++];)if(n&&-1<S.inArray(o,n))i&&i.push(o);else if(l=ie(o),a=me(d.appendChild(o),"script"),l&&ge(a),r)for(c=0;o=a[c++];)he.test(o.type||"")&&r.push(o);return d}ve=T.createDocumentFragment().appendChild(T.createElement("div")),(ye=T.createElement("input")).setAttribute("type","radio"),ye.setAttribute("checked","checked"),ye.setAttribute("name","t"),ve.appendChild(ye),y.checkClone=ve.cloneNode(!0).cloneNode(!0).lastChild.checked,ve.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ve.cloneNode(!0).lastChild.defaultValue;var Ee=/^key/,we=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ae=/^([^.]*)(?:\.(.+)|)/;function Te(){return!0}function Se(){return!1}function xe(e,t){return e===function(){try{return T.activeElement}catch(e){}}()==("focus"===t)}function Me(e,t,r,n,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof r&&(n=n||r,r=void 0),t)Me(e,s,r,n,t[s],o);return e}if(null==n&&null==i?(i=r,n=r=void 0):null==i&&("string"==typeof r?(i=n,n=void 0):(i=n,n=r,r=void 0)),!1===i)i=Se;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,n,r)})}function Re(e,i,o){o?(X.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,r,n=X.get(this,i);if(1&e.isTrigger&&this[i]){if(n.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(n=s.call(arguments),X.set(this,i,n),t=o(this,i),this[i](),n!==(r=X.get(this,i))||t?X.set(this,i,!1):r={},n!==r)return e.stopImmediatePropagation(),e.preventDefault(),r.value}else n.length&&(X.set(this,i,{value:S.event.trigger(S.extend(n[0],S.Event.prototype),n.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===X.get(e,i)&&S.event.add(e,i,Te)}S.event={global:{},add:function(t,e,r,n,i){var o,a,s,u,l,c,d,f,h,p,m,g=X.get(t);if(g)for(r.handler&&(r=(o=r).handler,i=o.selector),i&&S.find.matchesSelector(ne,i),r.guid||(r.guid=S.guid++),(u=g.events)||(u=g.events={}),(a=g.handle)||(a=g.handle=function(e){return void 0!==S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(N)||[""]).length;l--;)h=m=(s=Ae.exec(e[l])||[])[1],p=(s[2]||"").split(".").sort(),h&&(d=S.event.special[h]||{},h=(i?d.delegateType:d.bindType)||h,d=S.event.special[h]||{},c=S.extend({type:h,origType:m,data:n,handler:r,guid:r.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:p.join(".")},o),(f=u[h])||((f=u[h]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(t,n,p,a)||t.addEventListener&&t.addEventListener(h,a)),d.add&&(d.add.call(t,c),c.handler.guid||(c.handler.guid=r.guid)),i?f.splice(f.delegateCount++,0,c):f.push(c),S.event.global[h]=!0)},remove:function(e,t,r,n,i){var o,a,s,u,l,c,d,f,h,p,m,g=X.hasData(e)&&X.get(e);if(g&&(u=g.events)){for(l=(t=(t||"").match(N)||[""]).length;l--;)if(h=m=(s=Ae.exec(t[l])||[])[1],p=(s[2]||"").split(".").sort(),h){for(d=S.event.special[h]||{},f=u[h=(n?d.delegateType:d.bindType)||h]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=f.length;o--;)c=f[o],!i&&m!==c.origType||r&&r.guid!==c.guid||s&&!s.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(f.splice(o,1),c.selector&&f.delegateCount--,d.remove&&d.remove.call(e,c));a&&!f.length&&(d.teardown&&!1!==d.teardown.call(e,p,g.handle)||S.removeEvent(e,h,g.handle),delete u[h])}else for(h in u)S.event.remove(e,h+t[l],r,n,!0);S.isEmptyObject(u)&&X.remove(e,"handle events")}},dispatch:function(e){var t,r,n,i,o,a,s=S.event.fix(e),u=new Array(arguments.length),l=(X.get(this,"events")||{})[s.type]||[],c=S.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,s)){for(a=S.event.handlers.call(this,s,l),t=0;(i=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,r=0;(o=i.handlers[r++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!1!==o.namespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,void 0!==(n=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u))&&!1===(s.result=n)&&(s.preventDefault(),s.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var r,n,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},r=0;r<u;r++)void 0===a[i=(n=t[r]).selector+" "]&&(a[i]=n.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(n);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:_(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return de.test(t.type)&&t.click&&M(t,"input")&&Re(t,"click",Te),!1},trigger:function(e){var t=this||e;return de.test(t.type)&&t.click&&M(t,"input")&&Re(t,"click"),!0},_default:function(e){var t=e.target;return de.test(t.type)&&t.click&&M(t,"input")&&X.get(t,"click")||M(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Te:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Te,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Te,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Te,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Ee.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&we.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Re(this,e,xe),!1},trigger:function(){return Re(this,e),!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,r=e.relatedTarget,n=e.handleObj;return r&&(r===this||S.contains(this,r))||(e.type=n.origType,t=n.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,r,n){return Me(this,e,t,r,n)},one:function(e,t,r,n){return Me(this,e,t,r,n,1)},off:function(e,t,r){var n,i;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,S(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(r=t,t=void 0),!1===r&&(r=Se),this.each(function(){S.event.remove(this,e,r,t)});for(i in e)this.off(i,t,e[i]);return this}});var Oe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Pe=/<script|<style|<link/i,Ce=/checked\s*(?:[^=]|=\s*.checked.)/i,De=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ie(e,t){return M(e,"table")&&M(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function Le(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ne(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function ke(e,t){var r,n,i,o,a,s,u,l;if(1===t.nodeType){if(X.hasData(e)&&(o=X.access(e),a=X.set(t,o),l=o.events))for(i in delete a.handle,a.events={},l)for(r=0,n=l[i].length;r<n;r++)S.event.add(t,i,l[i][r]);Q.hasData(e)&&(s=Q.access(e),u=S.extend({},s),Q.set(t,u))}}function Fe(r,n,i,o){n=g.apply([],n);var e,t,a,s,u,l,c=0,d=r.length,f=d-1,h=n[0],p=_(h);if(p||1<d&&"string"==typeof h&&!y.checkClone&&Ce.test(h))return r.each(function(e){var t=r.eq(e);p&&(n[0]=h.call(this,e,t.html())),Fe(t,n,i,o)});if(d&&(t=(e=be(n,r[0].ownerDocument,!1,r,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(me(e,"script"),Le)).length;c<d;c++)u=e,c!==f&&(u=S.clone(u,!0,!0),s&&S.merge(a,me(u,"script"))),i.call(r[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,Ne),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!X.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")}):b(u.textContent.replace(De,""),u,l))}return r}function je(e,t,r){for(var n,i=t?S.filter(t,e):e,o=0;null!=(n=i[o]);o++)r||1!==n.nodeType||S.cleanData(me(n)),n.parentNode&&(r&&ie(n)&&ge(me(n,"script")),n.parentNode.removeChild(n));return e}S.extend({htmlPrefilter:function(e){return e.replace(Oe,"<$1></$2>")},clone:function(e,t,r){var n,i,o,a,s,u,l,c=e.cloneNode(!0),d=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=me(c),n=0,i=(o=me(e)).length;n<i;n++)s=o[n],u=a[n],void 0,"input"===(l=u.nodeName.toLowerCase())&&de.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(r)for(o=o||me(e),a=a||me(c),n=0,i=o.length;n<i;n++)ke(o[n],a[n]);else ke(e,c);return 0<(a=me(c,"script")).length&&ge(a,!d&&me(e,"script")),c},cleanData:function(e){for(var t,r,n,i=S.event.special,o=0;void 0!==(r=e[o]);o++)if(Y(r)){if(t=r[X.expando]){if(t.events)for(n in t.events)i[n]?S.event.remove(r,n):S.removeEvent(r,n,t.handle);r[X.expando]=void 0}r[Q.expando]&&(r[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return je(this,e,!0)},remove:function(e){return je(this,e)},text:function(e){return H(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Fe(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ie(this,e).appendChild(e)})},prepend:function(){return Fe(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ie(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Fe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Fe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(me(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return H(this,function(e){var t=this[0]||{},r=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Pe.test(e)&&!pe[(fe.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;r<n;r++)1===(t=this[r]||{}).nodeType&&(S.cleanData(me(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var r=[];return Fe(this,arguments,function(e){var t=this.parentNode;S.inArray(this,r)<0&&(S.cleanData(me(this)),t&&t.replaceChild(e,this))},r)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,r=[],n=S(e),i=n.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(n[o])[a](t),u.apply(r,t.get());return this.pushStack(r)}});var Be,Ue,Ge,He,Ve,ze,We,qe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Ye=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=A),t.getComputedStyle(e)},Ke=new RegExp(re.join("|"),"i");function Xe(){if(We){ze.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",We.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ne.appendChild(ze).appendChild(We);var e=A.getComputedStyle(We);Be="1%"!==e.top,Ve=12===Qe(e.marginLeft),We.style.right="60%",He=36===Qe(e.right),Ue=36===Qe(e.width),We.style.position="absolute",Ge=12===Qe(We.offsetWidth/3),ne.removeChild(ze),We=null}}function Qe(e){return Math.round(parseFloat(e))}function Je(e,t,r){var n,i,o,a,s=e.style;return(r=r||Ye(e))&&(""!==(a=r.getPropertyValue(t)||r[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&qe.test(a)&&Ke.test(t)&&(n=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=r.width,s.width=n,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}ze=T.createElement("div"),(We=T.createElement("div")).style&&(We.style.backgroundClip="content-box",We.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===We.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return Xe(),Ue},pixelBoxStyles:function(){return Xe(),He},pixelPosition:function(){return Xe(),Be},reliableMarginLeft:function(){return Xe(),Ve},scrollboxSize:function(){return Xe(),Ge}}));var $e=["Webkit","Moz","ms"],et=T.createElement("div").style,tt={};function rt(e){var t=S.cssProps[e]||tt[e];return t||(e in et?e:tt[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),r=$e.length;r--;)if((e=$e[r]+t)in et)return e}(e)||e)}var nt=/^(none|table(?!-c[ea]).+)/,it=/^--/,ot={position:"absolute",visibility:"hidden",display:"block"},at={letterSpacing:"0",fontWeight:"400"};function st(e,t,r){var n=te.exec(t);return n?Math.max(0,n[2]-(r||0))+(n[3]||"px"):t}function ut(e,t,r,n,i,o){var a="width"===t?1:0,s=0,u=0;if(r===(n?"border":"content"))return 0;for(;a<4;a+=2)"margin"===r&&(u+=S.css(e,r+re[a],!0,i)),n?("content"===r&&(u-=S.css(e,"padding"+re[a],!0,i)),"margin"!==r&&(u-=S.css(e,"border"+re[a]+"Width",!0,i))):(u+=S.css(e,"padding"+re[a],!0,i),"padding"!==r?u+=S.css(e,"border"+re[a]+"Width",!0,i):s+=S.css(e,"border"+re[a]+"Width",!0,i));return!n&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function lt(e,t,r){var n=Ye(e),i=(!y.boxSizingReliable()||r)&&"border-box"===S.css(e,"boxSizing",!1,n),o=i,a=Je(e,t,n),s="offset"+t[0].toUpperCase()+t.slice(1);if(qe.test(a)){if(!r)return a;a="auto"}return(!y.boxSizingReliable()&&i||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,n))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,n),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+ut(e,t,r||(i?"border":"content"),o,n,a)+"px"}function ct(e,t,r,n,i){return new ct.prototype.init(e,t,r,n,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=Je(e,"opacity");return""===r?"1":r}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,r,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=q(t),u=it.test(t),l=e.style;if(u||(t=rt(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===r)return a&&"get"in a&&void 0!==(i=a.get(e,!1,n))?i:l[t];"string"===(o=typeof r)&&(i=te.exec(r))&&i[1]&&(r=ue(e,t,i),o="number"),null!=r&&r==r&&("number"!==o||u||(r+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==r||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(r=a.set(e,r,n))||(u?l.setProperty(t,r):l[t]=r))}},css:function(e,t,r,n){var i,o,a,s=q(t);return it.test(t)||(t=rt(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,r)),void 0===i&&(i=Je(e,t,n)),"normal"===i&&t in at&&(i=at[t]),""===r||r?(o=parseFloat(i),!0===r||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,r){if(t)return!nt.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?lt(e,u,r):ae(e,ot,function(){return lt(e,u,r)})},set:function(e,t,r){var n,i=Ye(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||r)&&"border-box"===S.css(e,"boxSizing",!1,i),s=r?ut(e,u,r,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-ut(e,u,"border",!1,i)-.5)),s&&(n=te.exec(t))&&"px"!==(n[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),st(0,t,s)}}}),S.cssHooks.marginLeft=Ze(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Je(e,"marginLeft"))||e.getBoundingClientRect().left-ae(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,r={},n="string"==typeof e?e.split(" "):[e];t<4;t++)r[i+re[t]+o]=n[t]||n[t-2]||n[0];return r}},"margin"!==i&&(S.cssHooks[i+o].set=st)}),S.fn.extend({css:function(e,t){return H(this,function(e,t,r){var n,i,o={},a=0;if(Array.isArray(t)){for(n=Ye(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,n);return o}return void 0!==r?S.style(e,t,r):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=ct).prototype={constructor:ct,init:function(e,t,r,n,i,o){this.elem=e,this.prop=r,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(S.cssNumber[r]?"":"px")},cur:function(){var e=ct.propHooks[this.prop];return e&&e.get?e.get(this):ct.propHooks._default.get(this)},run:function(e){var t,r=ct.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):ct.propHooks._default.set(this),this}}).init.prototype=ct.prototype,(ct.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[rt(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=ct.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=ct.prototype.init,S.fx.step={};var dt,ft,ht,pt,mt=/^(?:toggle|show|hide)$/,gt=/queueHooks$/;function vt(){ft&&(!1===T.hidden&&A.requestAnimationFrame?A.requestAnimationFrame(vt):A.setTimeout(vt,S.fx.interval),S.fx.tick())}function yt(){return A.setTimeout(function(){dt=void 0}),dt=Date.now()}function _t(e,t){var r,n=0,i={height:e};for(t=t?1:0;n<4;n+=2-t)i["margin"+(r=re[n])]=i["padding"+r]=e;return t&&(i.opacity=i.width=e),i}function bt(e,t,r){for(var n,i=(Et.tweeners[t]||[]).concat(Et.tweeners["*"]),o=0,a=i.length;o<a;o++)if(n=i[o].call(r,t,e))return n}function Et(o,e,t){var r,a,n=0,i=Et.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=dt||yt(),t=Math.max(0,l.startTime+l.duration-e),r=1-(t/l.duration||0),n=0,i=l.tweens.length;n<i;n++)l.tweens[n].run(r);return s.notifyWith(o,[l,r,t]),r<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:dt||yt(),duration:t.duration,tweens:[],createTween:function(e,t){var r=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(r),r},stop:function(e){var t=0,r=e?l.tweens.length:0;if(a)return this;for(a=!0;t<r;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var r,n,i,o,a;for(r in e)if(i=t[n=q(r)],o=e[r],Array.isArray(o)&&(i=o[1],o=e[r]=o[0]),r!==n&&(e[n]=o,delete e[r]),(a=S.cssHooks[n])&&"expand"in a)for(r in o=a.expand(o),delete e[n],o)r in e||(e[r]=o[r],t[r]=i);else t[n]=i}(c,l.opts.specialEasing);n<i;n++)if(r=Et.prefilters[n].call(l,o,c,l.opts))return _(r.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return S.map(c,bt,l),_(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(Et,{tweeners:{"*":[function(e,t){var r=this.createTween(e,t);return ue(r.elem,e,te.exec(t),r),r}]},tweener:function(e,t){for(var r,n=0,i=(e=_(e)?(t=e,["*"]):e.match(N)).length;n<i;n++)r=e[n],Et.tweeners[r]=Et.tweeners[r]||[],Et.tweeners[r].unshift(t)},prefilters:[function(e,t,r){var n,i,o,a,s,u,l,c,d="width"in t||"height"in t,f=this,h={},p=e.style,m=e.nodeType&&se(e),g=X.get(e,"fxshow");for(n in r.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,f.always(function(){f.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[n],mt.test(i)){if(delete t[n],o=o||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!g||void 0===g[n])continue;m=!0}h[n]=g&&g[n]||S.style(e,n)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(h))for(n in d&&1===e.nodeType&&(r.overflow=[p.overflow,p.overflowX,p.overflowY],null==(l=g&&g.display)&&(l=X.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(ce([e],!0),l=e.style.display||l,c=S.css(e,"display"),ce([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(f.done(function(){p.display=l}),null==l&&(c=p.display,l="none"===c?"":c)),p.display="inline-block")),r.overflow&&(p.overflow="hidden",f.always(function(){p.overflow=r.overflow[0],p.overflowX=r.overflow[1],p.overflowY=r.overflow[2]})),u=!1,h)u||(g?"hidden"in g&&(m=g.hidden):g=X.access(e,"fxshow",{display:l}),o&&(g.hidden=!m),m&&ce([e],!0),f.done(function(){for(n in m||ce([e]),X.remove(e,"fxshow"),h)S.style(e,n,h[n])})),u=bt(m?g[n]:0,n,f),n in g||(g[n]=u.start,m&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?Et.prefilters.unshift(e):Et.prefilters.push(e)}}),S.speed=function(e,t,r){var n=e&&"object"==typeof e?S.extend({},e):{complete:r||!r&&t||_(e)&&e,duration:e,easing:r&&t||t&&!_(t)&&t};return S.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in S.fx.speeds?n.duration=S.fx.speeds[n.duration]:n.duration=S.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){_(n.old)&&n.old.call(this),n.queue&&S.dequeue(this,n.queue)},n},S.fn.extend({fadeTo:function(e,t,r,n){return this.filter(se).css("opacity",0).show().end().animate({opacity:t},e,r,n)},animate:function(t,e,r,n){function i(){var e=Et(this,S.extend({},t),a);(o||X.get(this,"finish"))&&e.stop(!0)}var o=S.isEmptyObject(t),a=S.speed(e,r,n);return i.finish=i,o||!1===a.queue?this.each(i):this.queue(a.queue,i)},stop:function(i,e,o){function a(e){var t=e.stop;delete e.stop,t(o)}return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&!1!==i&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",r=S.timers,n=X.get(this);if(t)n[t]&&n[t].stop&&a(n[t]);else for(t in n)n[t]&&n[t].stop&&gt.test(t)&&a(n[t]);for(t=r.length;t--;)r[t].elem!==this||null!=i&&r[t].queue!==i||(r[t].anim.stop(o),e=!1,r.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=X.get(this),r=t[a+"queue"],n=t[a+"queueHooks"],i=S.timers,o=r?r.length:0;for(t.finish=!0,S.queue(this,a,[]),n&&n.stop&&n.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,n){var i=S.fn[n];S.fn[n]=function(e,t,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(_t(n,!0),e,t,r)}}),S.each({slideDown:_t("show"),slideUp:_t("hide"),slideToggle:_t("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,n){S.fn[e]=function(e,t,r){return this.animate(n,e,t,r)}}),S.timers=[],S.fx.tick=function(){var e,t=0,r=S.timers;for(dt=Date.now();t<r.length;t++)(e=r[t])()||r[t]!==e||r.splice(t--,1);r.length||S.fx.stop(),dt=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){ft||(ft=!0,vt())},S.fx.stop=function(){ft=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(n,e){return n=S.fx&&S.fx.speeds[n]||n,e=e||"fx",this.queue(e,function(e,t){var r=A.setTimeout(e,n);t.stop=function(){A.clearTimeout(r)}})},ht=T.createElement("input"),pt=T.createElement("select").appendChild(T.createElement("option")),ht.type="checkbox",y.checkOn=""!==ht.value,y.optSelected=pt.selected,(ht=T.createElement("input")).value="t",ht.type="radio",y.radioValue="t"===ht.value;var wt,At=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return H(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,r){var n,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?S.prop(e,t,r):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?wt:void 0)),void 0!==r?null===r?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(n=i.set(e,r,t))?n:(e.setAttribute(t,r+""),r):i&&"get"in i&&null!==(n=i.get(e,t))?n:null==(n=S.find.attr(e,t))?void 0:n)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&M(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}},removeAttr:function(e,t){var r,n=0,i=t&&t.match(N);if(i&&1===e.nodeType)for(;r=i[n++];)e.removeAttribute(r)}}),wt={set:function(e,t,r){return!1===t?S.removeAttr(e,r):e.setAttribute(r,r),r}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=At[t]||S.find.attr;At[t]=function(e,t,r){var n,i,o=t.toLowerCase();return r||(i=At[o],At[o]=n,n=null!=a(e,t,r)?o:null,At[o]=i),n}});var Tt=/^(?:input|select|textarea|button)$/i,St=/^(?:a|area)$/i;function xt(e){return(e.match(N)||[]).join(" ")}function Mt(e){return e.getAttribute&&e.getAttribute("class")||""}function Rt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(N)||[]}S.fn.extend({prop:function(e,t){return H(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,r){var n,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==r?i&&"set"in i&&void 0!==(n=i.set(e,r,t))?n:e[t]=r:i&&"get"in i&&null!==(n=i.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):Tt.test(e.nodeName)||St.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,r,n,i,o,a,s,u=0;if(_(t))return this.each(function(e){S(this).addClass(t.call(this,e,Mt(this)))});if((e=Rt(t)).length)for(;r=this[u++];)if(i=Mt(r),n=1===r.nodeType&&" "+xt(i)+" "){for(a=0;o=e[a++];)n.indexOf(" "+o+" ")<0&&(n+=o+" ");i!==(s=xt(n))&&r.setAttribute("class",s)}return this},removeClass:function(t){var e,r,n,i,o,a,s,u=0;if(_(t))return this.each(function(e){S(this).removeClass(t.call(this,e,Mt(this)))});if(!arguments.length)return this.attr("class","");if((e=Rt(t)).length)for(;r=this[u++];)if(i=Mt(r),n=1===r.nodeType&&" "+xt(i)+" "){for(a=0;o=e[a++];)for(;-1<n.indexOf(" "+o+" ");)n=n.replace(" "+o+" "," ");i!==(s=xt(n))&&r.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"==o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):_(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,Mt(this),t),t)}):this.each(function(){var e,t,r,n;if(a)for(t=0,r=S(this),n=Rt(i);e=n[t++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else void 0!==i&&"boolean"!=o||((e=Mt(this))&&X.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":X.get(this,"__className__")||""))})},hasClass:function(e){var t,r,n=0;for(t=" "+e+" ";r=this[n++];)if(1===r.nodeType&&-1<(" "+xt(Mt(r))+" ").indexOf(t))return!0;return!1}});var Ot=/\r/g;S.fn.extend({val:function(r){var n,e,i,t=this[0];return arguments.length?(i=_(r),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?r.call(this,e,S(this).val()):r)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(n=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&void 0!==n.set(this,t,"value")||(this.value=t))})):t?(n=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in n&&void 0!==(e=n.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(Ot,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:xt(S.text(e))}},select:{get:function(e){var t,r,n,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(n=o<0?u:a?o:0;n<u;n++)if(((r=i[n]).selected||n===o)&&!r.disabled&&(!r.parentNode.disabled||!M(r.parentNode,"optgroup"))){if(t=S(r).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var r,n,i=e.options,o=S.makeArray(t),a=i.length;a--;)((n=i[a]).selected=-1<S.inArray(S.valHooks.option.get(n),o))&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in A;function Pt(e){e.stopPropagation()}var Ct=/^(?:focusinfocus|focusoutblur)$/;S.extend(S.event,{trigger:function(e,t,r,n){var i,o,a,s,u,l,c,d,f=[r||T],h=v.call(e,"type")?e.type:e,p=v.call(e,"namespace")?e.namespace.split("."):[];if(o=d=a=r=r||T,3!==r.nodeType&&8!==r.nodeType&&!Ct.test(h+S.event.triggered)&&(-1<h.indexOf(".")&&(h=(p=h.split(".")).shift(),p.sort()),u=h.indexOf(":")<0&&"on"+h,(e=e[S.expando]?e:new S.Event(h,"object"==typeof e&&e)).isTrigger=n?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[h]||{},n||!c.trigger||!1!==c.trigger.apply(r,t))){if(!n&&!c.noBubble&&!m(r)){for(s=c.delegateType||h,Ct.test(s+h)||(o=o.parentNode);o;o=o.parentNode)f.push(o),a=o;a===(r.ownerDocument||T)&&f.push(a.defaultView||a.parentWindow||A)}for(i=0;(o=f[i++])&&!e.isPropagationStopped();)d=o,e.type=1<i?s:c.bindType||h,(l=(X.get(o,"events")||{})[e.type]&&X.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&Y(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=h,n||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(f.pop(),t)||!Y(r)||u&&_(r[h])&&!m(r)&&((a=r[u])&&(r[u]=null),S.event.triggered=h,e.isPropagationStopped()&&d.addEventListener(h,Pt),r[h](),e.isPropagationStopped()&&d.removeEventListener(h,Pt),S.event.triggered=void 0,a&&(r[u]=a)),e.result}},simulate:function(e,t,r){var n=S.extend(new S.Event,r,{type:e,isSimulated:!0});S.event.trigger(n,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];if(r)return S.event.trigger(e,t,r,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(r,n){function i(e){S.event.simulate(n,e.target,S.event.fix(e))}S.event.special[n]={setup:function(){var e=this.ownerDocument||this,t=X.access(e,n);t||e.addEventListener(r,i,!0),X.access(e,n,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this,t=X.access(e,n)-1;t?X.access(e,n,t):(e.removeEventListener(r,i,!0),X.remove(e,n))}}});var Dt=A.location,It=Date.now(),Lt=/\?/;S.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new A.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||S.error("Invalid XML: "+e),t};var Nt=/\[\]$/,kt=/\r?\n/g,Ft=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;function Bt(r,e,n,i){var t;if(Array.isArray(e))S.each(e,function(e,t){n||Nt.test(r)?i(r,t):Bt(r+"["+("object"==typeof t&&null!=t?e:"")+"]",t,n,i)});else if(n||"object"!==E(e))i(r,e);else for(t in e)Bt(r+"["+t+"]",e[t],n,i)}S.param=function(e,t){function r(e,t){var r=_(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==r?"":r)}var n,i=[];if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){r(this.name,this.value)});else for(n in e)Bt(n,e[n],t,r);return i.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&jt.test(this.nodeName)&&!Ft.test(e)&&(this.checked||!de.test(e))}).map(function(e,t){var r=S(this).val();return null==r?null:Array.isArray(r)?S.map(r,function(e){return{name:t.name,value:e.replace(kt,"\r\n")}}):{name:t.name,value:r.replace(kt,"\r\n")}}).get()}});var Ut=/%20/g,Gt=/#.*$/,Ht=/([?&])_=[^&]*/,Vt=/^(.*?):[ \t]*([^\r\n]*)$/gm,zt=/^(?:GET|HEAD)$/,Wt=/^\/\//,qt={},Yt={},Kt="*/".concat("*"),Xt=T.createElement("a");function Qt(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var r,n=0,i=e.toLowerCase().match(N)||[];if(_(t))for(;r=i[n++];)"+"===r[0]?(r=r.slice(1)||"*",(o[r]=o[r]||[]).unshift(t)):(o[r]=o[r]||[]).push(t)}}function Jt(t,i,o,a){var s={},u=t===Yt;function l(e){var n;return s[e]=!0,S.each(t[e]||[],function(e,t){var r=t(i,o,a);return"string"!=typeof r||u||s[r]?u?!(n=r):void 0:(i.dataTypes.unshift(r),l(r),!1)}),n}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Zt(e,t){var r,n,i=S.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((i[r]?e:n=n||{})[r]=t[r]);return n&&S.extend(!0,e,n),e}Xt.href=Dt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Dt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Dt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Kt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Zt(Zt(e,S.ajaxSettings),t):Zt(S.ajaxSettings,e)},ajaxPrefilter:Qt(qt),ajaxTransport:Qt(Yt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,d,f,r,h,n,p,m,i,o,g=S.ajaxSetup({},t),v=g.context||g,y=g.context&&(v.nodeType||v.jquery)?S(v):S.event,_=S.Deferred(),b=S.Callbacks("once memory"),E=g.statusCode||{},a={},s={},u="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(p){if(!r)for(r={};t=Vt.exec(f);)r[t[1].toLowerCase()+" "]=(r[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=r[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return p?f:null},setRequestHeader:function(e,t){return null==p&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==p&&(g.mimeType=e),this},statusCode:function(e){var t;if(e)if(p)w.always(e[w.status]);else for(t in e)E[t]=[E[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(_.promise(w),g.url=((e||g.url||Dt.href)+"").replace(Wt,Dt.protocol+"//"),g.type=t.method||t.type||g.method||g.type,g.dataTypes=(g.dataType||"*").toLowerCase().match(N)||[""],null==g.crossDomain){n=T.createElement("a");try{n.href=g.url,n.href=n.href,g.crossDomain=Xt.protocol+"//"+Xt.host!=n.protocol+"//"+n.host}catch(e){g.crossDomain=!0}}if(g.data&&g.processData&&"string"!=typeof g.data&&(g.data=S.param(g.data,g.traditional)),Jt(qt,g,t,w),p)return w;for(i in(m=S.event&&g.global)&&0==S.active++&&S.event.trigger("ajaxStart"),g.type=g.type.toUpperCase(),g.hasContent=!zt.test(g.type),d=g.url.replace(Gt,""),g.hasContent?g.data&&g.processData&&0===(g.contentType||"").indexOf("application/x-www-form-urlencoded")&&(g.data=g.data.replace(Ut,"+")):(o=g.url.slice(d.length),g.data&&(g.processData||"string"==typeof g.data)&&(d+=(Lt.test(d)?"&":"?")+g.data,delete g.data),!1===g.cache&&(d=d.replace(Ht,"$1"),o=(Lt.test(d)?"&":"?")+"_="+It+++o),g.url=d+o),g.ifModified&&(S.lastModified[d]&&w.setRequestHeader("If-Modified-Since",S.lastModified[d]),S.etag[d]&&w.setRequestHeader("If-None-Match",S.etag[d])),(g.data&&g.hasContent&&!1!==g.contentType||t.contentType)&&w.setRequestHeader("Content-Type",g.contentType),w.setRequestHeader("Accept",g.dataTypes[0]&&g.accepts[g.dataTypes[0]]?g.accepts[g.dataTypes[0]]+("*"!==g.dataTypes[0]?", "+Kt+"; q=0.01":""):g.accepts["*"]),g.headers)w.setRequestHeader(i,g.headers[i]);if(g.beforeSend&&(!1===g.beforeSend.call(v,w,g)||p))return w.abort();if(u="abort",b.add(g.complete),w.done(g.success),w.fail(g.error),c=Jt(Yt,g,t,w)){if(w.readyState=1,m&&y.trigger("ajaxSend",[w,g]),p)return w;g.async&&0<g.timeout&&(h=A.setTimeout(function(){w.abort("timeout")},g.timeout));try{p=!1,c.send(a,l)}catch(e){if(p)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,r,n){var i,o,a,s,u,l=t;p||(p=!0,h&&A.clearTimeout(h),c=void 0,f=n||"",w.readyState=0<e?4:0,i=200<=e&&e<300||304===e,r&&(s=function(e,t,r){for(var n,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(i in s)if(s[i]&&s[i].test(n)){u.unshift(i);break}if(u[0]in r)o=u[0];else{for(i in r){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a=a||i}o=o||a}if(o)return o!==u[0]&&u.unshift(o),r[o]}(g,w,r)),s=function(e,t,r,n){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(r[e.responseFields[o]]=t),!u&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(g,s,w,i),i?(g.ifModified&&((u=w.getResponseHeader("Last-Modified"))&&(S.lastModified[d]=u),(u=w.getResponseHeader("etag"))&&(S.etag[d]=u)),204===e||"HEAD"===g.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),w.status=e,w.statusText=(t||l)+"",i?_.resolveWith(v,[o,l,w]):_.rejectWith(v,[w,l,a]),w.statusCode(E),E=void 0,m&&y.trigger(i?"ajaxSuccess":"ajaxError",[w,g,i?o:a]),b.fireWith(v,[w,l]),m&&(y.trigger("ajaxComplete",[w,g]),--S.active||S.event.trigger("ajaxStop")))}return w},getJSON:function(e,t,r){return S.get(e,t,r,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,r,n){return _(t)&&(n=n||r,r=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:n,data:t,success:r},S.isPlainObject(e)&&e))}}),S._evalUrl=function(e,t){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(_(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(r){return _(r)?this.each(function(e){S(this).wrapInner(r.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(r):e.append(r)})},wrap:function(t){var r=_(t);return this.each(function(e){S(this).wrapAll(r?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new A.XMLHttpRequest}catch(e){}};var $t={0:200,1223:204},er=S.ajaxSettings.xhr();y.cors=!!er&&"withCredentials"in er,y.ajax=er=!!er,S.ajaxTransport(function(i){var o,a;if(y.cors||er&&!i.crossDomain)return{send:function(e,t){var r,n=i.xhr();if(n.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(r in i.xhrFields)n[r]=i.xhrFields[r];for(r in i.mimeType&&n.overrideMimeType&&n.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)n.setRequestHeader(r,e[r]);o=function(e){return function(){o&&(o=a=n.onload=n.onerror=n.onabort=n.ontimeout=n.onreadystatechange=null,"abort"===e?n.abort():"error"===e?"number"!=typeof n.status?t(0,"error"):t(n.status,n.statusText):t($t[n.status]||n.status,n.statusText,"text"!==(n.responseType||"text")||"string"!=typeof n.responseText?{binary:n.response}:{text:n.responseText},n.getAllResponseHeaders()))}},n.onload=o(),a=n.onerror=n.ontimeout=o("error"),void 0!==n.onabort?n.onabort=a:n.onreadystatechange=function(){4===n.readyState&&A.setTimeout(function(){o&&a()})},o=o("abort");try{n.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(r){var n,i;if(r.crossDomain||r.scriptAttrs)return{send:function(e,t){n=S("<script>").attr(r.scriptAttrs||{}).prop({charset:r.scriptCharset,src:r.url}).on("load error",i=function(e){n.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),T.head.appendChild(n[0])},abort:function(){i&&i()}}});var tr,rr=[],nr=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=rr.pop()||S.expando+"_"+It++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,r){var n,i,o,a=!1!==e.jsonp&&(nr.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&nr.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=_(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(nr,"$1"+n):!1!==e.jsonp&&(e.url+=(Lt.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return o||S.error(n+" was not called"),o[0]},e.dataTypes[0]="json",i=A[n],A[n]=function(){o=arguments},r.always(function(){void 0===i?S(A).removeProp(n):A[n]=i,e[n]&&(e.jsonpCallback=t.jsonpCallback,rr.push(n)),o&&_(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((tr=T.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===tr.childNodes.length),S.parseHTML=function(e,t,r){return"string"!=typeof e?[]:("boolean"==typeof t&&(r=t,t=!1),t||(y.createHTMLDocument?((n=(t=T.implementation.createHTMLDocument("")).createElement("base")).href=T.location.href,t.head.appendChild(n)):t=T),o=!r&&[],(i=R.exec(e))?[t.createElement(i[1])]:(i=be([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var n,i,o},S.fn.load=function(e,t,r){var n,i,o,a=this,s=e.indexOf(" ");return-1<s&&(n=xt(e.slice(s)),e=e.slice(0,s)),_(t)?(r=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(n?S("<div>").append(S.parseHTML(e)).find(n):e)}).always(r&&function(e,t){a.each(function(){r.apply(this,o||[e.responseText,t,e])})}),this},S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,r){var n,i,o,a,s,u,l=S.css(e,"position"),c=S(e),d={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),i=("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(n=c.position()).top,n.left):(a=parseFloat(o)||0,parseFloat(u)||0),_(t)&&(t=t.call(e,r,S.extend({},s))),null!=t.top&&(d.top=t.top-s.top+a),null!=t.left&&(d.left=t.left-s.left+i),"using"in t?t.using.call(e,d):c.css(d)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,r,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),r=n.ownerDocument.defaultView,{top:e.top+r.pageYOffset,left:e.left+r.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,r,n=this[0],i={top:0,left:0};if("fixed"===S.css(n,"position"))t=n.getBoundingClientRect();else{for(t=this.offset(),r=n.ownerDocument,e=n.offsetParent||r.documentElement;e&&(e===r.body||e===r.documentElement)&&"static"===S.css(e,"position");)e=e.parentNode;e&&e!==n&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(n,"marginTop",!0),left:t.left-i.left-S.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===S.css(e,"position");)e=e.offsetParent;return e||ne})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return H(this,function(e,t,r){var n;if(m(e)?n=e:9===e.nodeType&&(n=e.defaultView),void 0===r)return n?n[i]:e[t];n?n.scrollTo(o?n.pageXOffset:r,o?r:n.pageYOffset):e[t]=r},t,e,arguments.length)}}),S.each(["top","left"],function(e,r){S.cssHooks[r]=Ze(y.pixelPosition,function(e,t){if(t)return t=Je(e,r),qe.test(t)?S(e).position()[r]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(n,o){S.fn[o]=function(e,t){var r=arguments.length&&(n||"boolean"!=typeof e),i=n||(!0===e||!0===t?"margin":"border");return H(this,function(e,t,r){var n;return m(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(n=e.documentElement,Math.max(e.body["scroll"+a],n["scroll"+a],e.body["offset"+a],n["offset"+a],n["client"+a])):void 0===r?S.css(e,t,i):S.style(e,t,r,i)},s,r?e:void 0,r)}})}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,r){S.fn[r]=function(e,t){return 0<arguments.length?this.on(r,null,e,t):this.trigger(r)}}),S.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.fn.extend({bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,r,n){return this.on(t,e,r,n)},undelegate:function(e,t,r){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)}}),S.proxy=function(e,t){var r,n,i;if("string"==typeof t&&(r=e[t],t=e,e=r),_(e))return n=s.call(arguments,2),(i=function(){return e.apply(t||this,n.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=M,S.isFunction=_,S.isWindow=m,S.camelCase=q,S.type=E,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var ir=A.jQuery,or=A.$;return S.noConflict=function(e){return A.$===S&&(A.$=or),e&&A.jQuery===S&&(A.jQuery=ir),S},e||(A.jQuery=A.$=S),S})},{}],583:[function(e,t,r){var a=e("word-wrapper"),s=e("xtend"),u=e("as-number"),l=["x","e","a","o","n","s","r","c","u","m","v","w","z"],i=["m","w"],b=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],n="\t".charCodeAt(0),o=" ".charCodeAt(0);function c(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function d(e,t){if(!e.chars||0===e.chars.length)return null;var r=w(e.chars,t);return 0<=r?e.chars[r]:null}function E(e,t,r){if(!e.kernings||0===e.kernings.length)return 0;for(var n=e.kernings,i=0;i<n.length;i++){var o=n[i];if(o.first===t&&o.second===r)return o.amount}return 0}function w(e,t,r){for(var n=r=r||0;n<e.length;n++)if(e[n].id===t)return n;return-1}t.exports=function(e){return new c(e)},c.prototype.update=function(e){if(e=s({measure:this._measure},e),this._opt=e,this._opt.tabSize=u(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var c=this.glyphs,d=e.text||"",f=e.font;this._setupSpaceGlyphs(f);var t=a.lines(d,e),r=e.width||0;c.length=0;var h=t.reduce(function(e,t){return Math.max(e,t.width,r)},0),p=0,m=0,g=u(e.lineHeight,f.common.lineHeight),n=f.common.base,i=g-n,v=e.letterSpacing||0,o=g*t.length-i,y=function(e){{if("center"===e)return 1;if("right"===e)return 2}return 0}(this._opt.align);m-=o,this._width=h,this._height=o,this._descender=g-n,this._baseline=n,this._xHeight=function(e){for(var t=0;t<l.length;t++){var r=l[t].charCodeAt(0),n=w(e.chars,r);if(0<=n)return e.chars[n].height}return 0}(f),this._capHeight=function(e){for(var t=0;t<b.length;t++){var r=b[t].charCodeAt(0),n=w(e.chars,r);if(0<=n)return e.chars[n].height}return 0}(f),this._lineHeight=g,this._ascender=g-i-this._xHeight;var _=this;t.forEach(function(e,t){for(var r,n=e.start,i=e.end,o=e.width,a=n;a<i;a++){var s=d.charCodeAt(a),u=_.getGlyph(f,s);if(u){r&&(p+=E(f,r.id,u.id));var l=p;1===y?l+=(h-o)/2:2===y&&(l+=h-o),c.push({position:[l,m],data:u,index:a,line:t}),p+=u.xadvance+v,r=u}}m+=g,p=0}),this._linesTotal=t.length},c.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=d(e,o)||function(e){for(var t=0;t<i.length;t++){var r=i[t].charCodeAt(0),n=w(e.chars,r);if(0<=n)return e.chars[n]}return 0}(e)||e.chars[0],r=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=s(t,{x:0,y:0,xadvance:r,id:n,xoffset:0,yoffset:0,width:0,height:0})}},c.prototype.getGlyph=function(e,t){var r=d(e,t);return r||(t===n?this._fallbackTabGlyph:t===o?this._fallbackSpaceGlyph:null)},c.prototype.computeMetrics=function(e,t,r,n){var i,o=this._opt.letterSpacing||0,a=this._opt.font,s=0,u=0,l=0;if(!a.chars||0===a.chars.length)return{start:t,end:t,width:0};r=Math.min(e.length,r);for(var c=t;c<r;c++){var d,f=e.charCodeAt(c);if(d=this.getGlyph(a,f)){d.xoffset;var h=(s+=i?E(a,i.id,d.id):0)+d.xadvance+o,p=s+d.width;if(n<=p||n<=h)break;s=h,u=p,i=d}l++}return i&&(u+=i.xoffset),{start:t,end:t+l,width:u}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(e){Object.defineProperty(c.prototype,e,{get:function(e){return new Function(["return function "+e+"() {","  return this._"+e,"}"].join("\n"))()}(e),configurable:!0})})},{"as-number":2,"word-wrapper":620,xtend:621}],584:[function(e,t,r){"use strict";var n;if(!Object.keys){var f=Object.prototype.hasOwnProperty,h=Object.prototype.toString,p=e("./isArguments"),i=Object.prototype.propertyIsEnumerable,m=!i.call({toString:null},"toString"),g=i.call(function(){},"prototype"),v=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],y=function(e){var t=e.constructor;return t&&t.prototype===e},o={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},_=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!o["$"+e]&&f.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{y(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();n=function(e){var t=null!==e&&"object"==typeof e,r="[object Function]"===h.call(e),n=p(e),i=t&&"[object String]"===h.call(e),o=[];if(!t&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var a=g&&r;if(i&&0<e.length&&!f.call(e,0))for(var s=0;s<e.length;++s)o.push(String(s));if(n&&0<e.length)for(var u=0;u<e.length;++u)o.push(String(u));else for(var l in e)a&&"prototype"===l||!f.call(e,l)||o.push(String(l));if(m)for(var c=function(e){if("undefined"==typeof window||!_)return y(e);try{return y(e)}catch(e){return!1}}(e),d=0;d<v.length;++d)c&&"constructor"===v[d]||!f.call(e,v[d])||o.push(v[d]);return o}}t.exports=n},{"./isArguments":586}],585:[function(e,t,r){"use strict";var n=Array.prototype.slice,i=e("./isArguments"),o=Object.keys,a=o?function(e){return o(e)}:e("./implementation"),s=Object.keys;a.shim=function(){Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return i(e)?s(n.call(e)):s(e)}):Object.keys=a;return Object.keys||a},t.exports=a},{"./implementation":584,"./isArguments":586}],586:[function(e,t,r){"use strict";var n=Object.prototype.toString;t.exports=function(e){var t=n.call(e),r="[object Arguments]"===t;return r=r||"[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&0<=e.length&&"[object Function]"===n.call(e.callee)}},{}],587:[function(e,t,r){r.endianness=function(){return"LE"},r.hostname=function(){return"undefined"!=typeof location?location.hostname:""},r.loadavg=function(){return[]},r.uptime=function(){return 0},r.freemem=function(){return Number.MAX_VALUE},r.totalmem=function(){return Number.MAX_VALUE},r.cpus=function(){return[]},r.type=function(){return"Browser"},r.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},r.networkInterfaces=r.getNetworkInterfaces=function(){return{}},r.arch=function(){return"javascript"},r.platform=function(){return"browser"},r.tmpdir=r.tmpDir=function(){return"/tmp"},r.EOL="\n",r.homedir=function(){return"/"}},{}],588:[function(e,t,r){(function(s){"use strict";void 0===s||!s.version||0===s.version.indexOf("v0.")||0===s.version.indexOf("v1.")&&0!==s.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,a=arguments.length;switch(a){case 0:case 1:return s.nextTick(e);case 2:return s.nextTick(function(){e.call(null,t)});case 3:return s.nextTick(function(){e.call(null,t,r)});case 4:return s.nextTick(function(){e.call(null,t,r,n)});default:for(i=new Array(a-1),o=0;o<i.length;)i[o++]=arguments[o];return s.nextTick(function(){e.apply(null,i)})}}}:t.exports=s}).call(this,e("_process"))},{_process:589}],589:[function(e,t,r){var n,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,c=[],d=!1,f=-1;function h(){d&&l&&(d=!1,l.length?c=l.concat(c):f=-1,c.length&&p())}function p(){if(!d){var e=u(h);d=!0;for(var t=c.length;t;){for(l=c,c=[];++f<t;)l&&l[f].run();f=-1,t=c.length}l=null,d=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||d||u(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],590:[function(e,t,r){"use strict";e("./requirePromise")();var n=e("es-abstract/es2018"),i=e("es-abstract/GetIntrinsic"),o=e("function-bind"),a=o.call(Function.call,i("%Promise_all%")),s=o.call(Function.call,i("%Promise_reject%"));t.exports=function(e){var r=this;if("Object"!==n.Type(r))throw new TypeError("`this` value must be an object");return a(r,Array.from(e,function(e){var t=n.PromiseResolve(r,e);try{return t.then(function(e){return{status:"fulfilled",value:e}},function(e){return{status:"rejected",reason:e}})}catch(e){return s(r,e)}}))}},{"./requirePromise":593,"es-abstract/GetIntrinsic":541,"es-abstract/es2018":545,"function-bind":561}],591:[function(e,t,r){"use strict";var n=e("function-bind"),i=e("define-properties"),o=e("./requirePromise"),a=e("./implementation"),s=e("./polyfill"),u=e("./shim");o();function l(e){return c(void 0===this?Promise:this,e)}var c=n.call(Function.call,s());i(l,{getPolyfill:s,implementation:a,shim:u}),t.exports=l},{"./implementation":590,"./polyfill":592,"./requirePromise":593,"./shim":594,"define-properties":540,"function-bind":561}],592:[function(e,t,r){"use strict";var n=e("./requirePromise"),i=e("./implementation");t.exports=function(){return n(),"function"==typeof Promise.allSettled?Promise.allSettled:i}},{"./implementation":590,"./requirePromise":593}],593:[function(e,t,r){"use strict";t.exports=function(){if("function"!=typeof Promise)throw new TypeError("`Promise.allSettled` requires a global `Promise` be available.");if("function"!=typeof Array.from)throw new TypeError("`Promise.allSettled` requires `Array.from` be available.")}},{}],594:[function(e,t,r){"use strict";var n=e("./requirePromise"),i=e("./polyfill"),o=e("define-properties");t.exports=function(){n();var e=i();return o(Promise,{allSettled:e},{allSettled:function(){return Promise.allSettled!==e}}),e}},{"./polyfill":592,"./requirePromise":593,"define-properties":540}],595:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":596}],596:[function(e,t,r){"use strict";var n=e("process-nextick-args"),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=d;var o=e("core-util-is");o.inherits=e("inherits");var a=e("./_stream_readable"),s=e("./_stream_writable");o.inherits(d,a);for(var u=i(s.prototype),l=0;l<u.length;l++){var c=u[l];d.prototype[c]||(d.prototype[c]=s.prototype[c])}function d(e){if(!(this instanceof d))return new d(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||n.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},{"./_stream_readable":598,"./_stream_writable":600,"core-util-is":339,inherits:574,"process-nextick-args":588}],597:[function(e,t,r){"use strict";t.exports=o;var n=e("./_stream_transform"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}i.inherits=e("inherits"),i.inherits(o,n),o.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":599,"core-util-is":339,inherits:574}],598:[function(I,L,e){(function(m,e){"use strict";var g=I("process-nextick-args");L.exports=f;var a,v=I("isarray");f.ReadableState=o;function y(e,t){return e.listeners(t).length}I("events").EventEmitter;var i=I("./internal/streams/stream"),s=I("safe-buffer").Buffer,u=e.Uint8Array||function(){};var t=I("core-util-is");t.inherits=I("inherits");var r=I("util"),_=void 0;_=r&&r.debuglog?r.debuglog("stream"):function(){};var l,c=I("./internal/streams/BufferList"),n=I("./internal/streams/destroy");t.inherits(f,i);var d=["error","close","destroy","pause","resume"];function o(e,t){e=e||{};var r=t instanceof(a=a||I("./_stream_duplex"));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,i=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(i||0===i)?i:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new c,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(l=l||I("string_decoder/").StringDecoder,this.decoder=new l(e.encoding),this.encoding=e.encoding)}function f(e){if(a=a||I("./_stream_duplex"),!(this instanceof f))return new f(e);this._readableState=new o(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),i.call(this)}function h(e,t,r,n,i){var o,a=e._readableState;null===t?(a.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,w(e)}(e,a)):(i||(o=function(e,t){var r;(function(e){return s.isBuffer(e)||e instanceof u})(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(a,t)),o?e.emit("error",o):a.objectMode||t&&0<t.length?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),n?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):p(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?p(e,a,t,!1):T(e,a)):p(e,a,t,!1))):n||(a.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(a)}function p(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&w(e)),T(e,t)}Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),f.prototype.destroy=n.destroy,f.prototype._undestroy=n.undestroy,f.prototype._destroy=function(e,t){this.push(null),t(e)},f.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=s.from(e,t),t=""),r=!0),h(this,e,t,!1,r)},f.prototype.unshift=function(e){return h(this,e,null,!0,!1)},f.prototype.isPaused=function(){return!1===this._readableState.flowing},f.prototype.setEncoding=function(e){return l=l||I("string_decoder/").StringDecoder,this._readableState.decoder=new l(e),this._readableState.encoding=e,this};var b=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return b<=e?e=b:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function w(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(_("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?g.nextTick(A,e):A(e))}function A(e){_("emit readable"),e.emit("readable"),R(e)}function T(e,t){t.readingMore||(t.readingMore=!0,g.nextTick(S,e,t))}function S(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(_("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function x(e){_("readable nexttick read 0"),e.read(0)}function M(e,t){t.reading||(_("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),R(e),t.flowing&&!t.reading&&e.read(0)}function R(e){var t=e._readableState;for(_("flow",t.flowing);t.flowing&&null!==e.read(););}function O(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(a===o.length?i+=o:i+=o.slice(0,e),0===(e-=a)){a===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=o.slice(a);break}++n}return t.length-=n,i}(e,t):function(e,t){var r=s.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,a),0===(e-=a)){a===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=o.slice(a);break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function P(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,g.nextTick(C,t,e))}function C(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function D(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}f.prototype.read=function(e){_("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return _("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?P(this):w(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&P(this),null;var n,i=t.needReadable;return _("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&_("length less than watermark",i=!0),t.ended||t.reading?_("reading or ended",i=!1):i&&(_("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(r,t))),null===(n=0<e?O(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&P(this)),null!==n&&this.emit("data",n),n},f.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},f.prototype.pipe=function(r,e){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=r;break;case 1:i.pipes=[i.pipes,r];break;default:i.pipes.push(r)}i.pipesCount+=1,_("pipe count=%d opts=%j",i.pipesCount,e);var t=(!e||!1!==e.end)&&r!==m.stdout&&r!==m.stderr?a:p;function o(e,t){_("onunpipe"),e===n&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,_("cleanup"),r.removeListener("close",f),r.removeListener("finish",h),r.removeListener("drain",s),r.removeListener("error",d),r.removeListener("unpipe",o),n.removeListener("end",a),n.removeListener("end",p),n.removeListener("data",c),u=!0,!i.awaitDrain||r._writableState&&!r._writableState.needDrain||s())}function a(){_("onend"),r.end()}i.endEmitted?g.nextTick(t):n.once("end",t),r.on("unpipe",o);var s=function(t){return function(){var e=t._readableState;_("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&y(t,"data")&&(e.flowing=!0,R(t))}}(n);r.on("drain",s);var u=!1;var l=!1;function c(e){_("ondata"),(l=!1)!==r.write(e)||l||((1===i.pipesCount&&i.pipes===r||1<i.pipesCount&&-1!==D(i.pipes,r))&&!u&&(_("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,l=!0),n.pause())}function d(e){_("onerror",e),p(),r.removeListener("error",d),0===y(r,"error")&&r.emit("error",e)}function f(){r.removeListener("finish",h),p()}function h(){_("onfinish"),r.removeListener("close",f),p()}function p(){_("unpipe"),n.unpipe(r)}return n.on("data",c),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?v(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(r,"error",d),r.once("close",f),r.once("finish",h),r.emit("pipe",n),i.flowing||(_("pipe resume"),n.resume()),r},f.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var a=D(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},f.prototype.addListener=f.prototype.on=function(e,t){var r=i.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&w(this):g.nextTick(x,this))}return r},f.prototype.resume=function(){var e=this._readableState;return e.flowing||(_("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,g.nextTick(M,e,t))}(this,e)),this},f.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this},f.prototype.wrap=function(t){var r=this,n=this._readableState,i=!1;for(var e in t.on("end",function(){if(_("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),t.on("data",function(e){_("wrapped data"),n.decoder&&(e=n.decoder.write(e)),n.objectMode&&null==e||(n.objectMode||e&&e.length)&&(r.push(e)||(i=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var o=0;o<d.length;o++)t.on(d[o],this.emit.bind(this,d[o]));return this._read=function(e){_("wrapped _read",e),i&&(i=!1,t.resume())},this},Object.defineProperty(f.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),f._fromList=O}).call(this,I("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":596,"./internal/streams/BufferList":601,"./internal/streams/destroy":602,"./internal/streams/stream":603,_process:589,"core-util-is":339,events:7,inherits:574,isarray:581,"process-nextick-args":588,"safe-buffer":610,"string_decoder/":614,util:5}],599:[function(e,t,r){"use strict";t.exports=o;var n=e("./_stream_duplex"),i=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,(r.writecb=null)!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var r=this;"function"==typeof this._flush?this._flush(function(e,t){s(r,e,t)}):s(this,null,null)}function s(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=e("inherits"),i.inherits(o,n),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},{"./_stream_duplex":596,"core-util-is":339,inherits:574}],600:[function(A,T,e){(function(e,t,r){"use strict";var s=A("process-nextick-args");function d(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}T.exports=g;var u,l=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?r:s.nextTick;g.WritableState=m;var n=A("core-util-is");n.inherits=A("inherits");var i={deprecate:A("util-deprecate")},o=A("./internal/streams/stream"),c=A("safe-buffer").Buffer,a=t.Uint8Array||function(){};var f,h=A("./internal/streams/destroy");function p(){}function m(e,t){u=u||A("./_stream_duplex"),e=e||{};var r=t instanceof u;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,i=e.writableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(i||0===i)?i:o,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(s.nextTick(i,n),s.nextTick(w,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),w(e,t))}(e,r,n,t,i);else{var o=b(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||_(e,r),n?l(y,e,r,o,i):y(e,r,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new d(this)}function g(e){if(u=u||A("./_stream_duplex"),!(f.call(g,this)||this instanceof u))return new g(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),o.call(this)}function v(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function y(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),w(e,t)}function _(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0,s=!0;r;)(i[a]=r).isBuf||(s=!1),r=r.next,a+=1;i.allBuffers=s,v(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new d(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,l=r.encoding,c=r.callback;if(v(e,t,!1,t.objectMode?1:u.length,u,l,c),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function b(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function E(t,r){t._final(function(e){r.pendingcb--,e&&t.emit("error",e),r.prefinished=!0,t.emit("prefinish"),w(t,r)})}function w(e,t){var r=b(t);return r&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,s.nextTick(E,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}n.inherits(g,o),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===g&&(e&&e._writableState instanceof m)}})):f=function(e){return e instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(e,t,r){var n=this._writableState,i=!1,o=!n.objectMode&&function(e){return c.isBuffer(e)||e instanceof a}(e);return o&&!c.isBuffer(e)&&(e=function(e){return c.from(e)}(e)),"function"==typeof t&&(r=t,t=null),t=o?"buffer":t||n.defaultEncoding,"function"!=typeof r&&(r=p),n.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),s.nextTick(t,r)}(this,r):(o||function(e,t,r,n){var i=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),s.nextTick(n,o),i=!1),i}(this,n,e,r))&&(n.pendingcb++,i=function(e,t,r,n,i,o){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,r));return t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,s,n,i,o);return u}(this,n,o,e,t,r)),i},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},g.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,t=e=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,w(e,t),r&&(t.finished?s.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(g.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),g.prototype.destroy=h.destroy,g.prototype._undestroy=h.undestroy,g.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,A("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},A("timers").setImmediate)},{"./_stream_duplex":596,"./internal/streams/destroy":602,"./internal/streams/stream":603,_process:589,"core-util-is":339,inherits:574,"process-nextick-args":588,"safe-buffer":610,timers:616,"util-deprecate":618}],601:[function(e,t,r){"use strict";var s=e("safe-buffer").Buffer,n=e("util");function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.head=null,this.tail=null,this.length=0}t.exports=(i.prototype.push=function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length},i.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},i.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},i.prototype.clear=function(){this.head=this.tail=null,this.length=0},i.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},i.prototype.concat=function(e){if(0===this.length)return s.alloc(0);if(1===this.length)return this.head.data;for(var t,r,n,i=s.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,r=i,n=a,t.copy(r,n),a+=o.data.length,o=o.next;return i},i),n&&n.inspect&&n.inspect.custom&&(t.exports.prototype[n.inspect.custom]=function(){var e=n.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":610,util:5}],602:[function(e,t,r){"use strict";var o=e("process-nextick-args");function a(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||o.nextTick(a,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(o.nextTick(a,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":588}],603:[function(e,t,r){t.exports=e("events").EventEmitter},{events:7}],604:[function(e,t,r){t.exports=e("./readable").PassThrough},{"./readable":605}],605:[function(e,t,r){(((r=t.exports=e("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":596,"./lib/_stream_passthrough.js":597,"./lib/_stream_readable.js":598,"./lib/_stream_transform.js":599,"./lib/_stream_writable.js":600}],606:[function(e,t,r){t.exports=e("./readable").Transform},{"./readable":605}],607:[function(e,t,r){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":600}],608:[function(e,D,t){(function(e){!function(e){"use strict";var u,t=Object.prototype,l=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag",a="object"==typeof D,s=e.regeneratorRuntime;if(s)a&&(D.exports=s);else{(s=e.regeneratorRuntime=a?D.exports:{}).wrap=_;var c="suspendedStart",d="suspendedYield",f="executing",h="completed",p={},m={};m[i]=function(){return this};var g=Object.getPrototypeOf,v=g&&g(g(P([])));v&&v!==t&&l.call(v,i)&&(m=v);var y=A.prototype=E.prototype=Object.create(m);w.prototype=y.constructor=A,A.constructor=w,A[o]=w.displayName="GeneratorFunction",s.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,A):(e.__proto__=A,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(y),e},s.awrap=function(e){return{__await:e}},T(S.prototype),S.prototype[n]=function(){return this},s.AsyncIterator=S,s.async=function(e,t,r,n){var i=new S(_(e,t,r,n));return s.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},T(y),y[o]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},s.keys=function(r){var n=[];for(var e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},s.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&l.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=l.call(i,"catchLoc"),s=l.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&l.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;R(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=u),p}}}function _(e,t,r,n){var i=t&&t.prototype instanceof E?t:E,o=Object.create(i.prototype),a=new O(n||[]);return o._invoke=function(o,a,s){var u=c;return function(e,t){if(u===f)throw new Error("Generator is already running");if(u===h){if("throw"===e)throw t;return C()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var n=x(r,s);if(n){if(n===p)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(u===c)throw u=h,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);u=f;var i=b(o,a,s);if("normal"===i.type){if(u=s.done?h:d,i.arg===p)continue;return{value:i.arg,done:s.done}}"throw"===i.type&&(u=h,s.method="throw",s.arg=i.arg)}}}(e,r,a),o}function b(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function E(){}function w(){}function A(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(s){function u(e,t,r,n){var i=b(s[e],s,t);if("throw"!==i.type){var o=i.arg,a=o.value;return a&&"object"==typeof a&&l.call(a,"__await")?Promise.resolve(a.__await).then(function(e){u("next",e,r,n)},function(e){u("throw",e,r,n)}):Promise.resolve(a).then(function(e){o.value=e,r(o)},n)}n(i.arg)}var t;"object"==typeof e.process&&e.process.domain&&(u=e.process.domain.bind(u)),this._invoke=function(r,n){function e(){return new Promise(function(e,t){u(r,n,e,t)})}return t=t?t.then(e,e):e()}}function x(e,t){var r=e.iterator[t.method];if(r===u){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=u,x(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=b(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=u),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(l.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=u,e.done=!0,e};return n.next=n}}return{next:C}}function C(){return{value:u,done:!0}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],609:[function(require,module,exports){var Yfg,Zfg;Yfg=this,Zfg=function(){var context=this,XHR2;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else try{XHR2=require("xhr2")}catch(e){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(!0!==e.crossOrigin)return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP");var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")},globalSetupOptions={dataFilter:function(e){return e}};function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,r){return function(){return e._aborted?r(e.request):e._timedOut?r(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):r(e.request)))}}function setHeaders(e,t){var r,n=t.headers||{};n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var i="undefined"!=typeof FormData&&t.data instanceof FormData;for(r in t.crossOrigin||n[requestedWith]||(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||i||(n[contentType]=t.contentType||defaultHeaders.contentType),n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){void 0!==t.withCredentials&&void 0!==e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,r,n){var i=uniqid++,o=e.jsonpCallback||"callback",a=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),s=new RegExp("((^|\\?|&)"+o+")=([^&]+)"),u=n.match(s),l=doc.createElement("script"),c=0,d=-1!==navigator.userAgent.indexOf("MSIE 10.0");return u?"?"===u[3]?n=n.replace(s,"$1="+a):a=u[3]:n=urlappend(n,o+"="+a),context[a]=generalCallback,l.type="text/javascript",l.src=n,l.async=!0,void 0===l.onreadystatechange||d||(l.htmlFor=l.id="_reqwest_"+i),l.onload=l.onreadystatechange=function(){if(l[readyState]&&"complete"!==l[readyState]&&"loaded"!==l[readyState]||c)return!1;l.onload=l.onreadystatechange=null,l.onclick&&l.onclick(),t(lastValue),lastValue=void 0,head.removeChild(l),c=1},head.appendChild(l),{abort:function(){l.onload=l.onreadystatechange=null,r({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(l),c=1}}}function getRequest(e,t){var r,n=this.o,i=(n.method||"GET").toUpperCase(),o="string"==typeof n?n:n.url,a=!1!==n.processData&&n.data&&"string"!=typeof n.data?reqwest.toQueryString(n.data):n.data||null,s=!1;return"jsonp"!=n.type&&"GET"!=i||!a||(o=urlappend(o,a),a=null),"jsonp"==n.type?handleJsonp(n,e,t,o):((r=n.xhr&&n.xhr(n)||xhr(n)).open(i,o,!1!==n.async),setHeaders(r,n),setCredentials(r,n),context[xDomainRequest]&&r instanceof context[xDomainRequest]?(r.onload=e,r.onerror=t,r.onprogress=function(){},s=!0):r.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(r),s?setTimeout(function(){r.send(a)},200):r.send(a),r)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(null!==e)return e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0}function init(o,fn){this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;0<self._completeHandlers.length;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(e){return error(resp,"Could not parse JSON in response",e)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);0<self._fulfillmentHandlers.length;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,r){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=r,self._erred=!0;0<self._errorHandlers.length;)self._errorHandlers.shift()(e,t,r);complete(e)}fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){function r(e){e&&!e.disabled&&t(s,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))}var n,i,o,a,s=e.name,u=e.tagName.toLowerCase();if(!e.disabled&&s)switch(u){case"input":/reset|button|image|file/i.test(e.type)||(n=/checkbox/i.test(e.type),i=/radio/i.test(e.type),o=e.value,(n||i)&&!e.checked||t(s,normalize(n&&""===o?"on":o)));break;case"textarea":t(s,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())r(0<=e.selectedIndex?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&r(e.options[a])}}function eachFormElement(){function e(e,t){var r,n,i;for(r=0;r<t.length;r++)for(i=e[byTag](t[r]),n=0;n<i.length;n++)serial(i[n],o)}var t,r,o=this;for(r=0;r<arguments.length;r++)/input|select|textarea/i.test((t=arguments[r]).tagName)&&serial(t,o),e(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var r={};return eachFormElement.apply(function(e,t){e in r?(r[e]&&!isArray(r[e])&&(r[e]=[r[e]]),r[e].push(t)):r[e]=t},arguments),r}function buildParams(e,t,r,n){var i,o,a,s=/\[\]$/;if(isArray(t))for(o=0;t&&o<t.length;o++)a=t[o],r||s.test(e)?n(e,a):buildParams(e+"["+("object"==typeof a?o:"")+"]",a,r,n);else if(t&&"[object Object]"===t.toString())for(i in t)buildParams(e+"["+i+"]",t[i],r,n);else n(e,t)}return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},catch:function(e){return this.fail(e)}},reqwest.serializeArray=function(){var r=[];return eachFormElement.apply(function(e,t){r.push({name:e,value:t})},arguments),r},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t=Array.prototype.slice.call(arguments,0);return(e=t.pop())&&e.nodeType&&t.push(e)&&(e=null),("map"==(e=e&&e.type)?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString).apply(null,t)},reqwest.toQueryString=function(e,t){function r(e,t){t="function"==typeof t?t():null==t?"":t,a[a.length]=s(e)+"="+s(t)}var n,i,o=t||!1,a=[],s=encodeURIComponent;if(isArray(e))for(i=0;e&&i<e.length;i++)r(e[i].name,e[i].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],o,r);return a.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){for(var t in e=e||{})globalSetupOptions[t]=e[t]},reqwest},void 0!==module&&module.exports?module.exports=Zfg():"function"==typeof define&&define.amd?define(Zfg):Yfg.reqwest=Zfg()},{xhr2:5}],610:[function(e,t,r){var n=e("buffer"),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(o(n,r),r.Buffer=a),o(i,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:6}],611:[function(z,e,t){(function(V){!function(u){u.parser=function(e,t){return new i(e,t)},u.SAXParser=i,u.SAXStream=a,u.createStream=function(e,t){return new a(e,t)},u.MAX_BUFFER_LENGTH=65536;var n,l=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(e,t){if(!(this instanceof i))return new i(e,t);var r=this;!function(e){for(var t=0,r=l.length;t<r;t++)e[l[t]]=""}(r),r.q=r.c="",r.bufferCheckPosition=u.MAX_BUFFER_LENGTH,r.opt=t||{},r.opt.lowercase=r.opt.lowercase||r.opt.lowercasetags,r.looseCase=r.opt.lowercase?"toLowerCase":"toUpperCase",r.tags=[],r.closed=r.closedRoot=r.sawRoot=!1,r.tag=r.error=null,r.strict=!!e,r.noscript=!(!e&&!r.opt.noscript),r.state=S.BEGIN,r.strictEntities=r.opt.strictEntities,r.ENTITIES=r.strictEntities?Object.create(u.XML_ENTITIES):Object.create(u.ENTITIES),r.attribList=[],r.opt.xmlns&&(r.ns=Object.create(g)),r.trackPosition=!1!==r.opt.position,r.trackPosition&&(r.position=r.line=r.column=0),M(r,"onready")}u.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),i.prototype={end:function(){D(this)},write:function(e){var t=this;if(this.error)throw this.error;if(t.closed)return C(t,"Cannot write after close. Assign an onready handler.");if(null===e)return D(t);"object"==typeof e&&(e=e.toString());var r=0,n="";for(;n=G(e,r++),t.c=n;)switch(t.trackPosition&&(t.position++,"\n"===n?(t.line++,t.column=0):t.column++),t.state){case S.BEGIN:if(t.state=S.BEGIN_WHITESPACE,"\ufeff"===n)continue;U(t,n);continue;case S.BEGIN_WHITESPACE:U(t,n);continue;case S.TEXT:if(t.sawRoot&&!t.closedRoot){for(var i=r-1;n&&"<"!==n&&"&"!==n;)(n=G(e,r++))&&t.trackPosition&&(t.position++,"\n"===n?(t.line++,t.column=0):t.column++);t.textNode+=e.substring(i,r-1)}"<"!==n||t.sawRoot&&t.closedRoot&&!t.strict?(!w(c,n)||t.sawRoot&&!t.closedRoot||I(t,"Text data outside of root node."),"&"===n?t.state=S.TEXT_ENTITY:t.textNode+=n):(t.state=S.OPEN_WAKA,t.startTagPosition=t.position);continue;case S.SCRIPT:"<"===n?t.state=S.SCRIPT_ENDING:t.script+=n;continue;case S.SCRIPT_ENDING:"/"===n?t.state=S.CLOSE_TAG:(t.script+="<"+n,t.state=S.SCRIPT);continue;case S.OPEN_WAKA:if("!"===n)t.state=S.SGML_DECL,t.sgmlDecl="";else if(E(c,n));else if(E(v,n))t.state=S.OPEN_TAG,t.tagName=n;else if("/"===n)t.state=S.CLOSE_TAG,t.tagName="";else if("?"===n)t.state=S.PROC_INST,t.procInstName=t.procInstBody="";else{if(I(t,"Unencoded <"),t.startTagPosition+1<t.position){var o=t.position-t.startTagPosition;n=new Array(o).join(" ")+n}t.textNode+="<"+n,t.state=S.TEXT}continue;case S.SGML_DECL:(t.sgmlDecl+n).toUpperCase()===h?(R(t,"onopencdata"),t.state=S.CDATA,t.sgmlDecl="",t.cdata=""):t.sgmlDecl+n==="--"?(t.state=S.COMMENT,t.comment="",t.sgmlDecl=""):(t.sgmlDecl+n).toUpperCase()===p?(t.state=S.DOCTYPE,(t.doctype||t.sawRoot)&&I(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):">"===n?(R(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=S.TEXT):(E(d,n)&&(t.state=S.SGML_DECL_QUOTED),t.sgmlDecl+=n);continue;case S.SGML_DECL_QUOTED:n===t.q&&(t.state=S.SGML_DECL,t.q=""),t.sgmlDecl+=n;continue;case S.DOCTYPE:">"===n?(t.state=S.TEXT,R(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=n,"["===n?t.state=S.DOCTYPE_DTD:E(d,n)&&(t.state=S.DOCTYPE_QUOTED,t.q=n));continue;case S.DOCTYPE_QUOTED:t.doctype+=n,n===t.q&&(t.q="",t.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:t.doctype+=n,"]"===n?t.state=S.DOCTYPE:E(d,n)&&(t.state=S.DOCTYPE_DTD_QUOTED,t.q=n);continue;case S.DOCTYPE_DTD_QUOTED:t.doctype+=n,n===t.q&&(t.state=S.DOCTYPE_DTD,t.q="");continue;case S.COMMENT:"-"===n?t.state=S.COMMENT_ENDING:t.comment+=n;continue;case S.COMMENT_ENDING:"-"===n?(t.state=S.COMMENT_ENDED,t.comment=P(t.opt,t.comment),t.comment&&R(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+n,t.state=S.COMMENT);continue;case S.COMMENT_ENDED:">"!==n?(I(t,"Malformed comment"),t.comment+="--"+n,t.state=S.COMMENT):t.state=S.TEXT;continue;case S.CDATA:"]"===n?t.state=S.CDATA_ENDING:t.cdata+=n;continue;case S.CDATA_ENDING:"]"===n?t.state=S.CDATA_ENDING_2:(t.cdata+="]"+n,t.state=S.CDATA);continue;case S.CDATA_ENDING_2:">"===n?(t.cdata&&R(t,"oncdata",t.cdata),R(t,"onclosecdata"),t.cdata="",t.state=S.TEXT):"]"===n?t.cdata+="]":(t.cdata+="]]"+n,t.state=S.CDATA);continue;case S.PROC_INST:"?"===n?t.state=S.PROC_INST_ENDING:E(c,n)?t.state=S.PROC_INST_BODY:t.procInstName+=n;continue;case S.PROC_INST_BODY:if(!t.procInstBody&&E(c,n))continue;"?"===n?t.state=S.PROC_INST_ENDING:t.procInstBody+=n;continue;case S.PROC_INST_ENDING:">"===n?(R(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=S.TEXT):(t.procInstBody+="?"+n,t.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:E(y,n)?t.tagName+=n:(L(t),">"===n?F(t):"/"===n?t.state=S.OPEN_TAG_SLASH:(w(c,n)&&I(t,"Invalid character in tag name"),t.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:">"===n?(F(t,!0),j(t)):(I(t,"Forward-slash in opening tag not followed by >"),t.state=S.ATTRIB);continue;case S.ATTRIB:if(E(c,n))continue;">"===n?F(t):"/"===n?t.state=S.OPEN_TAG_SLASH:E(v,n)?(t.attribName=n,t.attribValue="",t.state=S.ATTRIB_NAME):I(t,"Invalid attribute name");continue;case S.ATTRIB_NAME:"="===n?t.state=S.ATTRIB_VALUE:">"===n?(I(t,"Attribute without value"),t.attribValue=t.attribName,k(t),F(t)):E(c,n)?t.state=S.ATTRIB_NAME_SAW_WHITE:E(y,n)?t.attribName+=n:I(t,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if("="===n)t.state=S.ATTRIB_VALUE;else{if(E(c,n))continue;I(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",R(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",">"===n?F(t):E(v,n)?(t.attribName=n,t.state=S.ATTRIB_NAME):(I(t,"Invalid attribute name"),t.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(E(c,n))continue;E(d,n)?(t.q=n,t.state=S.ATTRIB_VALUE_QUOTED):(I(t,"Unquoted attribute value"),t.state=S.ATTRIB_VALUE_UNQUOTED,t.attribValue=n);continue;case S.ATTRIB_VALUE_QUOTED:if(n!==t.q){"&"===n?t.state=S.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=n;continue}k(t),t.q="",t.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:E(c,n)?t.state=S.ATTRIB:">"===n?F(t):"/"===n?t.state=S.OPEN_TAG_SLASH:E(v,n)?(I(t,"No whitespace between attributes"),t.attribName=n,t.attribValue="",t.state=S.ATTRIB_NAME):I(t,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(w(f,n)){"&"===n?t.state=S.ATTRIB_VALUE_ENTITY_U:t.attribValue+=n;continue}k(t),">"===n?F(t):t.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(t.tagName)">"===n?j(t):E(y,n)?t.tagName+=n:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=S.SCRIPT):(w(c,n)&&I(t,"Invalid tagname in closing tag"),t.state=S.CLOSE_TAG_SAW_WHITE);else{if(E(c,n))continue;w(v,n)?t.script?(t.script+="</"+n,t.state=S.SCRIPT):I(t,"Invalid tagname in closing tag."):t.tagName=n}continue;case S.CLOSE_TAG_SAW_WHITE:if(E(c,n))continue;">"===n?j(t):I(t,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:var a,s;switch(t.state){case S.TEXT_ENTITY:a=S.TEXT,s="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:a=S.ATTRIB_VALUE_QUOTED,s="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:a=S.ATTRIB_VALUE_UNQUOTED,s="attribValue"}";"===n?(t[s]+=B(t),t.entity="",t.state=a):E(t.entity.length?b:_,n)?t.entity+=n:(I(t,"Invalid character in entity name"),t[s]+="&"+t.entity+n,t.entity="",t.state=a);continue;default:throw new Error(t,"Unknown state: "+t.state)}t.position>=t.bufferCheckPosition&&function(e){for(var t=Math.max(u.MAX_BUFFER_LENGTH,10),r=0,n=0,i=l.length;n<i;n++){var o=e[l[n]].length;if(t<o)switch(l[n]){case"textNode":O(e);break;case"cdata":R(e,"oncdata",e.cdata),e.cdata="";break;case"script":R(e,"onscript",e.script),e.script="";break;default:C(e,"Max buffer length exceeded: "+l[n])}r=Math.max(r,o)}var a=u.MAX_BUFFER_LENGTH-r;e.bufferCheckPosition=a+e.position}(t);return t},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){!function(e){O(e),""!==e.cdata&&(R(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(R(e,"onscript",e.script),e.script="")}(this)}};try{n=z("stream").Stream}catch(e){n=function(){}}var o=u.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});function a(e,t){if(!(this instanceof a))return new a(e,t);n.apply(this),this._parser=new i(e,t),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},this._decoder=null,o.forEach(function(t){Object.defineProperty(r,"on"+t,{get:function(){return r._parser["on"+t]},set:function(e){if(!e)return r.removeAllListeners(t),r._parser["on"+t]=e;r.on(t,e)},enumerable:!0,configurable:!1})})}(a.prototype=Object.create(n.prototype,{constructor:{value:a}})).write=function(e){if("function"==typeof V&&"function"==typeof V.isBuffer&&V.isBuffer(e)){if(!this._decoder){var t=z("string_decoder").StringDecoder;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},a.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},a.prototype.on=function(t,e){var r=this;return r._parser["on"+t]||-1===o.indexOf(t)||(r._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),r.emit.apply(r,e)}),n.prototype.on.call(r,t,e)};var c="\r\n\t ",e="0124356789",t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",d="'\"",f=c+">",h="[CDATA[",p="DOCTYPE",s="http://www.w3.org/XML/1998/namespace",m="http://www.w3.org/2000/xmlns/",g={xml:s,xmlns:m};c=r(c),e=r(e),t=r(t);var v=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,_=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function r(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}function E(e,t){return function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e)?!!t.match(e):e[t]}function w(e,t){return!E(e,t)}d=r(d),f=r(f);var A,T,S=0;for(var x in u.STATE={BEGIN:S++,BEGIN_WHITESPACE:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},u.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},u.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(u.ENTITIES).forEach(function(e){var t=u.ENTITIES[e],r="number"==typeof t?String.fromCharCode(t):t;u.ENTITIES[e]=r}),u.STATE)u.STATE[u.STATE[x]]=x;function M(e,t,r){e[t]&&e[t](r)}function R(e,t,r){e.textNode&&O(e),M(e,t,r)}function O(e){e.textNode=P(e.opt,e.textNode),e.textNode&&M(e,"ontext",e.textNode),e.textNode=""}function P(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function C(e,t){return O(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,M(e,"onerror",t),e}function D(e){return e.sawRoot&&!e.closedRoot&&I(e,"Unclosed root tag"),e.state!==S.BEGIN&&e.state!==S.BEGIN_WHITESPACE&&e.state!==S.TEXT&&C(e,"Unexpected end"),O(e),e.c="",e.closed=!0,M(e,"onend"),i.call(e,e.strict,e.opt),e}function I(e,t){if("object"!=typeof e||!(e instanceof i))throw new Error("bad call to strictFail");e.strict&&C(e,t)}function L(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,R(e,"onopentagstart",r)}function N(e,t){var r=e.indexOf(":")<0?["",e]:e.split(":"),n=r[0],i=r[1];return t&&"xmlns"===e&&(n="xmlns",i=""),{prefix:n,local:i}}function k(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=N(e.attribName,!0),r=t.prefix,n=t.local;if("xmlns"===r)if("xml"===n&&e.attribValue!==s)I(e,"xml: prefix must be bound to "+s+"\nActual: "+e.attribValue);else if("xmlns"===n&&e.attribValue!==m)I(e,"xmlns: prefix must be bound to "+m+"\nActual: "+e.attribValue);else{var i=e.tag,o=e.tags[e.tags.length-1]||e;i.ns===o.ns&&(i.ns=Object.create(o.ns)),i.ns[n]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,R(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function F(t,e){if(t.opt.xmlns){var r=t.tag,n=N(t.tagName);r.prefix=n.prefix,r.local=n.local,r.uri=r.ns[n.prefix]||"",r.prefix&&!r.uri&&(I(t,"Unbound namespace prefix: "+JSON.stringify(t.tagName)),r.uri=n.prefix);var i=t.tags[t.tags.length-1]||t;r.ns&&i.ns!==r.ns&&Object.keys(r.ns).forEach(function(e){R(t,"onopennamespace",{prefix:e,uri:r.ns[e]})});for(var o=0,a=t.attribList.length;o<a;o++){var s=t.attribList[o],u=s[0],l=s[1],c=N(u,!0),d=c.prefix,f=c.local,h=""===d?"":r.ns[d]||"",p={name:u,value:l,prefix:d,local:f,uri:h};d&&"xmlns"!==d&&!h&&(I(t,"Unbound namespace prefix: "+JSON.stringify(d)),p.uri=d),t.tag.attributes[u]=p,R(t,"onattribute",p)}t.attribList.length=0}t.tag.isSelfClosing=!!e,t.sawRoot=!0,t.tags.push(t.tag),R(t,"onopentag",t.tag),e||(t.noscript||"script"!==t.tagName.toLowerCase()?t.state=S.TEXT:t.state=S.SCRIPT,t.tag=null,t.tagName=""),t.attribName=t.attribValue="",t.attribList.length=0}function j(r){if(!r.tagName)return I(r,"Weird empty close tag."),r.textNode+="</>",void(r.state=S.TEXT);if(r.script){if("script"!==r.tagName)return r.script+="</"+r.tagName+">",r.tagName="",void(r.state=S.SCRIPT);R(r,"onscript",r.script),r.script=""}var e=r.tags.length,t=r.tagName;r.strict||(t=t[r.looseCase]());for(var n=t;e--;){if(r.tags[e].name===n)break;I(r,"Unexpected close tag")}if(e<0)return I(r,"Unmatched closing tag: "+r.tagName),r.textNode+="</"+r.tagName+">",void(r.state=S.TEXT);r.tagName=t;for(var i=r.tags.length;i-- >e;){var o=r.tag=r.tags.pop();r.tagName=r.tag.name,R(r,"onclosetag",r.tagName);var a={};for(var s in o.ns)a[s]=o.ns[s];var u=r.tags[r.tags.length-1]||r;r.opt.xmlns&&o.ns!==u.ns&&Object.keys(o.ns).forEach(function(e){var t=o.ns[e];R(r,"onclosenamespace",{prefix:e,uri:t})})}0===e&&(r.closedRoot=!0),r.tagName=r.attribValue=r.attribName="",r.attribList.length=0,r.state=S.TEXT}function B(e){var t,r=e.entity,n=r.toLowerCase(),i="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[n]?e.ENTITIES[n]:("#"===(r=n).charAt(0)&&(i="x"===r.charAt(1)?(r=r.slice(2),(t=parseInt(r,16)).toString(16)):(r=r.slice(1),(t=parseInt(r,10)).toString(10))),r=r.replace(/^0+/,""),i.toLowerCase()!==r?(I(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function U(e,t){"<"===t?(e.state=S.OPEN_WAKA,e.startTagPosition=e.position):w(c,t)&&(I(e,"Non-whitespace before first tag."),e.textNode=t,e.state=S.TEXT)}function G(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}function H(){var e,t,r=[],n=-1,i=arguments.length;if(!i)return"";for(var o="";++n<i;){var a=Number(arguments[n]);if(!isFinite(a)||a<0||1114111<a||T(a)!==a)throw RangeError("Invalid code point: "+a);a<=65535?r.push(a):(e=55296+((a-=65536)>>10),t=a%1024+56320,r.push(e,t)),(n+1===i||16384<r.length)&&(o+=A.apply(null,r),r.length=0)}return o}S=u.STATE,String.fromCodePoint||(A=String.fromCharCode,T=Math.floor,Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:H,configurable:!0,writable:!0}):String.fromCodePoint=H)}(void 0===t?this.sax={}:t)}).call(this,z("buffer").Buffer)},{buffer:6,stream:613,string_decoder:614}],612:[function(e,i,t){!function(e){function a(e,t,r,n,i){this._listener=t,this._isOnce=r,this.context=n,this._signal=e,this._priority=i||0}function n(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function t(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){t.prototype.dispatch.apply(e,arguments)}}t.prototype={VERSION:"1.0.0",memorize:!(a.prototype={active:!0,params:null,execute:function(e){var t,r;return this.active&&this._listener&&(r=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,r),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}}),_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,n){var i,o=this._indexOfListener(e,r);if(-1!==o){if((i=this._bindings[o]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else i=new a(this,e,t,r,n),this._addBinding(i);return this.memorize&&this._prevParams&&i.execute(this._prevParams),i},_addBinding:function(e){for(var t=this._bindings.length;--t,this._bindings[t]&&e._priority<=this._bindings[t]._priority;);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if((r=this._bindings[n])._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,r=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=r),n)for(t=this._bindings.slice(),this._shouldPropagate=!0;t[--n]&&this._shouldPropagate&&!1!==t[n].execute(r););}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var r=t;r.Signal=t,"function"==typeof define&&define.amd?define(function(){return r}):void 0!==i&&i.exports?i.exports=r:e.signals=r}(this)},{}],613:[function(e,t,r){t.exports=n;var c=e("events").EventEmitter;function n(){c.call(this)}e("inherits")(n,c),n.Readable=e("readable-stream/readable.js"),n.Writable=e("readable-stream/writable.js"),n.Duplex=e("readable-stream/duplex.js"),n.Transform=e("readable-stream/transform.js"),n.PassThrough=e("readable-stream/passthrough.js"),(n.Stream=n).prototype.pipe=function(t,e){var r=this;function n(e){t.writable&&!1===t.write(e)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),t.on("drain",i),t._isStdio||e&&!1===e.end||(r.on("end",a),r.on("close",s));var o=!1;function a(){o||(o=!0,t.end())}function s(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function u(e){if(l(),0===c.listenerCount(this,"error"))throw e}function l(){r.removeListener("data",n),t.removeListener("drain",i),r.removeListener("end",a),r.removeListener("close",s),r.removeListener("error",u),t.removeListener("error",u),r.removeListener("end",l),r.removeListener("close",l),t.removeListener("close",l)}return r.on("error",u),t.on("error",u),r.on("end",l),r.on("close",l),t.on("close",l),t.emit("pipe",r),t}},{events:7,inherits:574,"readable-stream/duplex.js":595,"readable-stream/passthrough.js":604,"readable-stream/readable.js":605,"readable-stream/transform.js":606,"readable-stream/writable.js":607}],614:[function(e,t,r){"use strict";var n=e("safe-buffer").Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=l,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=d,t=3;break;default:return this.write=f,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(55296<=n&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0==r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1==r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}(r.StringDecoder=o).prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=a(t[n]);if(0<=i)return 0<i&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if(0<=(i=a(t[n])))return 0<i&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if(0<=(i=a(t[n])))return 0<i&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":610}],615:[function(e,t,r){var n,i;n=this,i=function(e){"use strict";function t(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}}}});for(var q=0,Y=1,K=2,N=1,k=2,F=3,I=0,Ee=1,X=2,a=0,v=2,Q=0,J=1,Z=2,$=3,ee=4,te=5,re=100,i=101,o=102,s=103,u=104,l=200,c=201,d=202,f=203,h=204,p=205,m=206,g=207,y=208,_=209,b=210,ne=0,ie=1,oe=2,ae=3,se=4,ue=5,le=6,ce=7,j=0,B=1,U=2,G=0,we=1,H=2,V=3,z=4,W=5,de=301,fe=302,he=303,pe=304,me=305,ge=306,ve=307,E=1e3,L=1001,w=1002,ye=1003,_e=1004,be=1005,Ae=1006,A=1007,T=1008,Te=1009,S=1010,x=1011,Se=1012,M=1013,xe=1014,Me=1015,Re=1016,R=1017,O=1018,P=1019,Oe=1020,C=1021,Pe=1022,Ce=1023,D=1024,De=1025,r=Ce,Ie=1026,Le=1027,Ne=1028,ke=33776,Fe=33777,je=33778,Be=33779,Ue=35840,Ge=35841,He=35842,Ve=35843,ze=36196,We=37808,qe=37809,Ye=37810,Ke=37811,Xe=37812,Qe=37813,Je=37814,Ze=37815,$e=37816,et=37817,tt=37818,rt=37819,nt=37820,it=37821,ot=0,at=3e3,n=3001,st=3007,ut=3002,lt=3003,ct=3004,dt=3005,ft=3006,ht=3200,pt=3201,mt=0,gt=1,vt=7680,yt=519,_t=[],bt=0;bt<256;bt++)_t[bt]=(bt<16?"0":"")+bt.toString(16);var Et={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(_t[255&e]+_t[e>>8&255]+_t[e>>16&255]+_t[e>>24&255]+"-"+_t[255&t]+_t[t>>8&255]+"-"+_t[t>>16&15|64]+_t[t>>24&255]+"-"+_t[63&r|128]+_t[r>>8&255]+"-"+_t[r>>16&255]+_t[r>>24&255]+_t[255&n]+_t[n>>8&255]+_t[n>>16&255]+_t[n>>24&255]).toUpperCase()},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Et.DEG2RAD},radToDeg:function(e){return e*Et.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function wt(e,t){this.x=e||0,this.y=t||0}function At(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}Object.defineProperties(wt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(wt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*r-o*n+e.x,this.y=i*n+o*r+e.y,this}}),Object.assign(At,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,o,a){var s=r[n+0],u=r[n+1],l=r[n+2],c=r[n+3],d=i[o+0],f=i[o+1],h=i[o+2],p=i[o+3];if(c!==p||s!==d||u!==f||l!==h){var m=1-a,g=s*d+u*f+l*h+c*p,v=0<=g?1:-1,y=1-g*g;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,g*v);m=Math.sin(m*b)/_,a=Math.sin(a*b)/_}var E=a*v;if(s=s*m+d*E,u=u*m+f*E,l=l*m+h*E,c=c*m+p*E,m===1-a){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}}),Object.defineProperties(At.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(At.prototype,{isQuaternion:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,o=e.order,a=Math.cos,s=Math.sin,u=a(r/2),l=a(n/2),c=a(i/2),d=s(r/2),f=s(n/2),h=s(i/2);return"XYZ"===o?(this._x=d*l*c+u*f*h,this._y=u*f*c-d*l*h,this._z=u*l*h+d*f*c,this._w=u*l*c-d*f*h):"YXZ"===o?(this._x=d*l*c+u*f*h,this._y=u*f*c-d*l*h,this._z=u*l*h-d*f*c,this._w=u*l*c+d*f*h):"ZXY"===o?(this._x=d*l*c-u*f*h,this._y=u*f*c+d*l*h,this._z=u*l*h+d*f*c,this._w=u*l*c-d*f*h):"ZYX"===o?(this._x=d*l*c-u*f*h,this._y=u*f*c+d*l*h,this._z=u*l*h-d*f*c,this._w=u*l*c+d*f*h):"YZX"===o?(this._x=d*l*c+u*f*h,this._y=u*f*c+d*l*h,this._z=u*l*h-d*f*c,this._w=u*l*c-d*f*h):"XZY"===o&&(this._x=d*l*c-u*f*h,this._y=u*f*c-d*l*h,this._z=u*l*h+d*f*c,this._w=u*l*c+d*f*h),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],u=r[9],l=r[2],c=r[6],d=r[10],f=n+s+d;return 0<f?(t=.5/Math.sqrt(f+1),this._w=.25/t,this._x=(c-u)*t,this._y=(o-l)*t,this._z=(a-i)*t):s<n&&d<n?(t=2*Math.sqrt(1+n-s-d),this._w=(c-u)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+l)/t):d<s?(t=2*Math.sqrt(1+s-n-d),this._w=(o-l)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(u+c)/t):(t=2*Math.sqrt(1+d-n-s),this._w=(a-i)/t,this._x=(o+l)/t,this._y=(u+c)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return r<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Et.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var n=Math.min(1,t/r);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,a=t._x,s=t._y,u=t._z,l=t._w;return this._x=r*l+o*a+n*u-i*s,this._y=n*l+o*s+i*a-r*u,this._z=i*l+o*u+r*s-n*a,this._w=o*l-r*a-n*s-i*u,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*e._w+r*e._x+n*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),1<=a)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var u=1-t;return this._w=u*o+t*this._w,this._x=u*r+t*this._x,this._y=u*n+t*this._y,this._z=u*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,a),d=Math.sin((1-t)*c)/l,f=Math.sin(t*c)/l;return this._w=o*d+this._w*f,this._x=r*d+this._x*f,this._y=n*d+this._y*f,this._z=i*d+this._z*f,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var Tt=new xt,St=new At;function xt(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}Object.assign(xt.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(St.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(St.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,u=s*t+o*n-a*r,l=s*r+a*t-i*n,c=s*n+i*r-o*t,d=-i*t-o*r-a*n;return this.x=u*s+d*-i+l*-a-c*-o,this.y=l*s+d*-o+c*-i-u*-a,this.z=c*s+d*-a+u*-o-l*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(e){return Tt.copy(this).projectOnVector(e),this.sub(Tt)},reflect:function(e){return this.sub(Tt.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Et.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Mt,Rt=new xt;function Ot(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Ot.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,o,a,s,u){var l=this.elements;return l[0]=e,l[1]=n,l[2]=a,l[3]=t,l[4]=i,l[5]=s,l[6]=r,l[7]=o,l[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(e){for(var t=0,r=e.count;t<r;t++)Rt.x=e.getX(t),Rt.y=e.getY(t),Rt.z=e.getZ(t),Rt.applyMatrix3(this),e.setXYZ(t,Rt.x,Rt.y,Rt.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],a=r[3],s=r[6],u=r[1],l=r[4],c=r[7],d=r[2],f=r[5],h=r[8],p=n[0],m=n[3],g=n[6],v=n[1],y=n[4],_=n[7],b=n[2],E=n[5],w=n[8];return i[0]=o*p+a*v+s*b,i[3]=o*m+a*y+s*E,i[6]=o*g+a*_+s*w,i[1]=u*p+l*v+c*b,i[4]=u*m+l*y+c*E,i[7]=u*g+l*_+c*w,i[2]=d*p+f*v+h*b,i[5]=d*m+f*y+h*E,i[8]=d*g+f*_+h*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8];return t*o*l-t*a*u-r*i*l+r*a*s+n*i*u-n*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],o=r[1],a=r[2],s=r[3],u=r[4],l=r[5],c=r[6],d=r[7],f=r[8],h=f*u-l*d,p=l*c-f*s,m=d*s-u*c,g=i*h+o*p+a*m;if(0==g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return n[0]=h*y,n[1]=(a*d-f*o)*y,n[2]=(l*o-a*u)*y,n[3]=p*y,n[4]=(f*i-a*c)*y,n[5]=(a*s-l*i)*y,n[6]=m*y,n[7]=(o*c-d*i)*y,n[8]=(u*i-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,i,o,a){var s=Math.cos(i),u=Math.sin(i);this.set(r*s,r*u,-r*(s*o+u*a)+o+e,-n*u,n*s,-n*(-u*o+s*a)+a+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],o=n[3],a=n[6],s=n[1],u=n[4],l=n[7];return n[0]=t*i+r*s,n[3]=t*o+r*u,n[6]=t*a+r*l,n[1]=-r*i+t*s,n[4]=-r*o+t*u,n[7]=-r*a+t*l,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var Pt={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Mt&&(Mt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Mt.width=e.width,Mt.height=e.height;var r=Mt.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Mt}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Ct=0;function Dt(e,t,r,n,i,o,a,s,u,l){Object.defineProperty(this,"id",{value:Ct++}),this.uuid=Et.generateUUID(),this.name="",this.image=void 0!==e?e:Dt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Dt.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:L,this.wrapT=void 0!==n?n:L,this.magFilter=void 0!==i?i:Ae,this.minFilter=void 0!==o?o:T,this.anisotropy=void 0!==u?u:1,this.format=void 0!==a?a:Ce,this.type=void 0!==s?s:Te,this.offset=new wt(0,0),this.repeat=new wt(1,1),this.center=new wt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ot,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:at,this.version=0,this.onUpdate=null}function It(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function Lt(e,t,r){this.width=e,this.height=t,this.scissor=new It(0,0,e,t),this.scissorTest=!1,this.viewport=new It(0,0,e,t),r=r||{},this.texture=new Dt(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:Ae,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function Nt(e,t,r){Lt.call(this,e,t,r),this.samples=4}Dt.DEFAULT_IMAGE=void 0,Dt.DEFAULT_MAPPING=300,Dt.prototype=Object.assign(Object.create(t.prototype),{constructor:Dt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=Et.generateUUID()),!t&&void 0===e.images[n.uuid]){var i;if(Array.isArray(n)){i=[];for(var o=0,a=n.length;o<a;o++)i.push(Pt.getDataURL(n[o]))}else i=Pt.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case E:e.x=e.x-Math.floor(e.x);break;case L:e.x=e.x<0?0:1;break;case w:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case E:e.y=e.y-Math.floor(e.y);break;case L:e.y=e.y<0?0:1;break;case w:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Dt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(It.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(It.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*t+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*t+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*t+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,o=e.elements,a=o[0],s=o[4],u=o[8],l=o[1],c=o[5],d=o[9],f=o[2],h=o[6],p=o[10];if(Math.abs(s-l)<.01&&Math.abs(u-f)<.01&&Math.abs(d-h)<.01){if(Math.abs(s+l)<.1&&Math.abs(u+f)<.1&&Math.abs(d+h)<.1&&Math.abs(a+c+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(c+1)/2,v=(p+1)/2,y=(s+l)/4,_=(u+f)/4,b=(d+h)/4;return g<m&&v<m?i=m<.01?(r=0,n=.707106781):(n=y/(r=Math.sqrt(m)),_/r):v<g?i=g<.01?(n=0,r=.707106781):(r=y/(n=Math.sqrt(g)),b/n):v<.01?(n=r=.707106781,i=0):(r=_/(i=Math.sqrt(v)),n=b/i),this.set(r,n,i,t),this}var E=Math.sqrt((h-d)*(h-d)+(u-f)*(u-f)+(l-s)*(l-s));return Math.abs(E)<.001&&(E=1),this.x=(h-d)/E,this.y=(u-f)/E,this.z=(l-s)/E,this.w=Math.acos((a+c+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Lt.prototype=Object.assign(Object.create(t.prototype),{constructor:Lt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Nt.prototype=Object.assign(Object.create(Lt.prototype),{constructor:Nt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Lt.prototype.copy.call(this,e),this.samples=e.samples,this}});var kt=new xt,Ft=new Vt,jt=new xt(0,0,0),Bt=new xt(1,1,1),Ut=new xt,Gt=new xt,Ht=new xt;function Vt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Vt.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,o,a,s,u,l,c,d,f,h,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=u,g[6]=l,g[10]=c,g[14]=d,g[3]=f,g[7]=h,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Vt).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,r=e.elements,n=1/kt.setFromMatrixColumn(e,0).length(),i=1/kt.setFromMatrixColumn(e,1).length(),o=1/kt.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(n),u=Math.sin(n),l=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var d=o*l,f=o*c,h=a*l,p=a*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=f+h*u,t[5]=d-p*u,t[9]=-a*s,t[2]=p-d*u,t[6]=h+f*u,t[10]=o*s}else if("YXZ"===e.order){var m=s*l,g=s*c,v=u*l,y=u*c;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*u,t[1]=o*c,t[5]=o*l,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*l,g=s*c,v=u*l,y=u*c;t[0]=m-y*a,t[4]=-o*c,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*l,t[9]=y-m*a,t[2]=-o*u,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){d=o*l,f=o*c,h=a*l,p=a*c;t[0]=s*l,t[4]=h*u-f,t[8]=d*u+p,t[1]=s*c,t[5]=p*u+d,t[9]=f*u-h,t[2]=-u,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var _=o*s,b=o*u,E=a*s,w=a*u;t[0]=s*l,t[4]=w-_*c,t[8]=E*c+b,t[1]=c,t[5]=o*l,t[9]=-a*l,t[2]=-u*l,t[6]=b*c+E,t[10]=_-w*c}else if("XZY"===e.order){_=o*s,b=o*u,E=a*s,w=a*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=_*c+w,t[5]=o*l,t[9]=b*c-E,t[2]=E*c-b,t[6]=a*l,t[10]=w*c+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(jt,e,Bt)},lookAt:function(e,t,r){var n=this.elements;return Ht.subVectors(e,t),0===Ht.lengthSq()&&(Ht.z=1),Ht.normalize(),Ut.crossVectors(r,Ht),0===Ut.lengthSq()&&(1===Math.abs(r.z)?Ht.x+=1e-4:Ht.z+=1e-4,Ht.normalize(),Ut.crossVectors(r,Ht)),Ut.normalize(),Gt.crossVectors(Ht,Ut),n[0]=Ut.x,n[4]=Gt.x,n[8]=Ht.x,n[1]=Ut.y,n[5]=Gt.y,n[9]=Ht.y,n[2]=Ut.z,n[6]=Gt.z,n[10]=Ht.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,o=r[0],a=r[4],s=r[8],u=r[12],l=r[1],c=r[5],d=r[9],f=r[13],h=r[2],p=r[6],m=r[10],g=r[14],v=r[3],y=r[7],_=r[11],b=r[15],E=n[0],w=n[4],A=n[8],T=n[12],S=n[1],x=n[5],M=n[9],R=n[13],O=n[2],P=n[6],C=n[10],D=n[14],I=n[3],L=n[7],N=n[11],k=n[15];return i[0]=o*E+a*S+s*O+u*I,i[4]=o*w+a*x+s*P+u*L,i[8]=o*A+a*M+s*C+u*N,i[12]=o*T+a*R+s*D+u*k,i[1]=l*E+c*S+d*O+f*I,i[5]=l*w+c*x+d*P+f*L,i[9]=l*A+c*M+d*C+f*N,i[13]=l*T+c*R+d*D+f*k,i[2]=h*E+p*S+m*O+g*I,i[6]=h*w+p*x+m*P+g*L,i[10]=h*A+p*M+m*C+g*N,i[14]=h*T+p*R+m*D+g*k,i[3]=v*E+y*S+_*O+b*I,i[7]=v*w+y*x+_*P+b*L,i[11]=v*A+y*M+_*C+b*N,i[15]=v*T+y*R+_*D+b*k,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=0,r=e.count;t<r;t++)kt.x=e.getX(t),kt.y=e.getY(t),kt.z=e.getZ(t),kt.applyMatrix4(this),e.setXYZ(t,kt.x,kt.y,kt.z);return e},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],a=e[5],s=e[9],u=e[13],l=e[2],c=e[6],d=e[10],f=e[14];return e[3]*(+i*s*c-n*u*c-i*a*d+r*u*d+n*a*f-r*s*f)+e[7]*(+t*s*f-t*u*d+i*o*d-n*o*f+n*u*l-i*s*l)+e[11]*(+t*u*c-t*a*f-i*o*c+r*o*f+i*a*l-r*u*l)+e[15]*(-n*a*l-t*s*c+t*a*d+n*o*c-r*o*d+r*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,r){var n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],o=n[1],a=n[2],s=n[3],u=n[4],l=n[5],c=n[6],d=n[7],f=n[8],h=n[9],p=n[10],m=n[11],g=n[12],v=n[13],y=n[14],_=n[15],b=h*y*d-v*p*d+v*c*m-l*y*m-h*c*_+l*p*_,E=g*p*d-f*y*d-g*c*m+u*y*m+f*c*_-u*p*_,w=f*v*d-g*h*d+g*l*m-u*v*m-f*l*_+u*h*_,A=g*h*c-f*v*c-g*l*p+u*v*p+f*l*y-u*h*y,T=i*b+o*E+a*w+s*A;if(0==T){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(S);return console.warn(S),this.identity()}var x=1/T;return r[0]=b*x,r[1]=(v*p*s-h*y*s-v*a*m+o*y*m+h*a*_-o*p*_)*x,r[2]=(l*y*s-v*c*s+v*a*d-o*y*d-l*a*_+o*c*_)*x,r[3]=(h*c*s-l*p*s-h*a*d+o*p*d+l*a*m-o*c*m)*x,r[4]=E*x,r[5]=(f*y*s-g*p*s+g*a*m-i*y*m-f*a*_+i*p*_)*x,r[6]=(g*c*s-u*y*s-g*a*d+i*y*d+u*a*_-i*c*_)*x,r[7]=(u*p*s-f*c*s+f*a*d-i*p*d-u*a*m+i*c*m)*x,r[8]=w*x,r[9]=(g*h*s-f*v*s-g*o*m+i*v*m+f*o*_-i*h*_)*x,r[10]=(u*v*s-g*l*s+g*o*d-i*v*d-u*o*_+i*l*_)*x,r[11]=(f*l*s-u*h*s-f*o*d+i*h*d+u*o*m-i*l*m)*x,r[12]=A*x,r[13]=(f*v*a-g*h*a+g*o*p-i*v*p-f*o*y+i*h*y)*x,r[14]=(g*l*a-u*v*a-g*o*c+i*v*c+u*o*y-i*l*y)*x,r[15]=(u*h*a-f*l*a+f*o*c-i*h*c-u*o*p+i*l*p)*x,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,a=e.y,s=e.z,u=i*o,l=i*a;return this.set(u*o+r,u*a-n*s,u*s+n*a,0,u*a+n*s,l*a+r,l*s-n*o,0,u*s-n*a,l*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var n=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,u=i+i,l=o+o,c=a+a,d=i*u,f=i*l,h=i*c,p=o*l,m=o*c,g=a*c,v=s*u,y=s*l,_=s*c,b=r.x,E=r.y,w=r.z;return n[0]=(1-(p+g))*b,n[1]=(f+_)*b,n[2]=(h-y)*b,n[3]=0,n[4]=(f-_)*E,n[5]=(1-(d+g))*E,n[6]=(m+v)*E,n[7]=0,n[8]=(h+y)*w,n[9]=(m-v)*w,n[10]=(1-(d+p))*w,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:function(e,t,r){var n=this.elements,i=kt.set(n[0],n[1],n[2]).length(),o=kt.set(n[4],n[5],n[6]).length(),a=kt.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],Ft.copy(this);var s=1/i,u=1/o,l=1/a;return Ft.elements[0]*=s,Ft.elements[1]*=s,Ft.elements[2]*=s,Ft.elements[4]*=u,Ft.elements[5]*=u,Ft.elements[6]*=u,Ft.elements[8]*=l,Ft.elements[9]*=l,Ft.elements[10]*=l,t.setFromRotationMatrix(Ft),r.x=i,r.y=o,r.z=a,this},makePerspective:function(e,t,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(t-e),u=2*i/(r-n),l=(t+e)/(t-e),c=(r+n)/(r-n),d=-(o+i)/(o-i),f=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=u,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,r,n,i,o){var a=this.elements,s=1/(t-e),u=1/(r-n),l=1/(o-i),c=(t+e)*s,d=(r+n)*u,f=(o+i)*l;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});var zt=new Vt,Wt=new At;function qt(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||qt.DefaultOrder}function Yt(){this.mask=1}qt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],qt.DefaultOrder="XYZ",Object.defineProperties(qt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(qt.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=Et.clamp,i=e.elements,o=i[0],a=i[4],s=i[8],u=i[1],l=i[5],c=i[9],d=i[2],f=i[6],h=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-d,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,h),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(u,o))):"ZYX"===t?(this._y=Math.asin(-n(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,h),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===t?(this._z=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(s,h))):"XZY"===t?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,h),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,r){return zt.makeRotationFromQuaternion(e),this.setFromRotationMatrix(zt,t,r)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return Wt.setFromEuler(this),this.setFromQuaternion(Wt,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new xt(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Yt.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var Kt=0,Xt=new xt,Qt=new At,Jt=new Vt,Zt=new xt,$t=new xt,er=new xt,tr=new At,rr=new xt(1,0,0),nr=new xt(0,1,0),ir=new xt(0,0,1),or={type:"added"},ar={type:"removed"};function sr(){Object.defineProperty(this,"id",{value:Kt++}),this.uuid=Et.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=sr.DefaultUp.clone();var e=new xt,t=new qt,r=new At,n=new xt(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Vt},normalMatrix:{value:new Ot}}),this.matrix=new Vt,this.matrixWorld=new Vt,this.matrixAutoUpdate=sr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Yt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ur(){sr.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}sr.DefaultUp=new xt(0,1,0),sr.DefaultMatrixAutoUpdate=!0,sr.prototype=Object.assign(Object.create(t.prototype),{constructor:sr,isObject3D:!0,onFrameEnter:function(){},onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Qt.setFromAxisAngle(e,t),this.quaternion.multiply(Qt),this},rotateOnWorldAxis:function(e,t){return Qt.setFromAxisAngle(e,t),this.quaternion.premultiply(Qt),this},rotateX:function(e){return this.rotateOnAxis(rr,e)},rotateY:function(e){return this.rotateOnAxis(nr,e)},rotateZ:function(e){return this.rotateOnAxis(ir,e)},translateOnAxis:function(e,t){return Xt.copy(e).applyQuaternion(this.quaternion),this.position.add(Xt.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(rr,e)},translateY:function(e){return this.translateOnAxis(nr,e)},translateZ:function(e){return this.translateOnAxis(ir,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Jt.getInverse(this.matrixWorld))},lookAt:function(e,t,r){e.isVector3?Zt.copy(e):Zt.set(e,t,r);var n=this.parent;this.updateWorldMatrix(!0,!1),$t.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jt.lookAt($t,Zt,this.up):Jt.lookAt(Zt,$t,this.up),this.quaternion.setFromRotationMatrix(Jt),n&&(Jt.extractRotation(n.matrixWorld),Qt.setFromRotationMatrix(Jt),this.quaternion.premultiply(Qt.inverse()))},add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(or)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent(ar)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),Jt.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Jt.multiply(e.parent.matrixWorld)),e.applyMatrix(Jt),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new xt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new At),this.updateMatrixWorld(!0),this.matrixWorld.decompose($t,e,er),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new xt),this.updateMatrixWorld(!0),this.matrixWorld.decompose($t,tr,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new xt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var n=this.children,i=0,o=n.length;i<o;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(r){var e=void 0===r||"string"==typeof r,t={};e&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{}},t.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(r)),t.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==ot&&(n.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){n.geometry=i(r.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,u=a.length;s<u;s++){var l=a[s];i(r.shapes,l)}else i(r.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,u=this.material.length;s<u;s++)c.push(i(r.materials,this.material[s]));n.material=c}else n.material=i(r.materials,this.material);if(0<this.children.length){n.children=[];for(s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(r).object)}if(e){var d=m(r.geometries),f=m(r.materials),h=m(r.textures),p=m(r.images);a=m(r.shapes);0<d.length&&(t.geometries=d),0<f.length&&(t.materials=f),0<h.length&&(t.textures=h),0<p.length&&(t.images=p),0<a.length&&(t.shapes=a)}return t.object=n,t;function m(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}}),ur.prototype=Object.assign(Object.create(sr.prototype),{constructor:ur,isScene:!0,copy:function(e,t){return sr.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=sr.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var lr=[new xt,new xt,new xt,new xt,new xt,new xt,new xt,new xt],cr=new xt,dr=new xt,fr=new xt,hr=new xt,pr=new xt,mr=new xt,gr=new xt,vr=new xt,yr=new xt,_r=new xt,br=new xt;function Er(e,t){this.min=void 0!==e?e:new xt(1/0,1/0,1/0),this.max=void 0!==t?t:new xt(-1/0,-1/0,-1/0)}function wr(e,t,r,n,i){var o,a;for(o=0,a=e.length-3;o<=a;o+=3){br.fromArray(e,o);var s=i.x*Math.abs(br.x)+i.y*Math.abs(br.y)+i.z*Math.abs(br.z),u=t.dot(br),l=r.dot(br),c=n.dot(br);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}Object.assign(Er.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=e.length;s<u;s+=3){var l=e[s],c=e[s+1],d=e[s+2];l<t&&(t=l),c<r&&(r=c),d<n&&(n=d),i<l&&(i=l),o<c&&(o=c),a<d&&(a=d)}return this.min.set(t,r,n),this.max.set(i,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=e.count;s<u;s++){var l=e.getX(s),c=e.getY(s),d=e.getZ(s);l<t&&(t=l),c<r&&(r=c),d<n&&(n=d),i<l&&(i=l),o<c&&(o=c),a<d&&(a=d)}return this.min.set(t,r,n),this.max.set(i,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=cr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new xt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new xt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){var t,r;e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n)if(n.isGeometry){var i=n.vertices;for(t=0,r=i.length;t<r;t++)cr.copy(i[t]),cr.applyMatrix4(e.matrixWorld),this.expandByPoint(cr)}else if(n.isBufferGeometry){var o=n.attributes.position;if(void 0!==o)for(t=0,r=o.count;t<r;t++)cr.fromBufferAttribute(o,t).applyMatrix4(e.matrixWorld),this.expandByPoint(cr)}var a=e.children;for(t=0,r=a.length;t<r;t++)this.expandByObject(a[t]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new xt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,cr),cr.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,r;return r=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(vr),yr.subVectors(this.max,vr),dr.subVectors(e.a,vr),fr.subVectors(e.b,vr),hr.subVectors(e.c,vr),pr.subVectors(fr,dr),mr.subVectors(hr,fr),gr.subVectors(dr,hr);var t=[0,-pr.z,pr.y,0,-mr.z,mr.y,0,-gr.z,gr.y,pr.z,0,-pr.x,mr.z,0,-mr.x,gr.z,0,-gr.x,-pr.y,pr.x,0,-mr.y,mr.x,0,-gr.y,gr.x,0];return!!wr(t,dr,fr,hr,yr)&&(!!wr(t=[1,0,0,0,1,0,0,0,1],dr,fr,hr,yr)&&(_r.crossVectors(pr,mr),wr(t=[_r.x,_r.y,_r.z],dr,fr,hr,yr)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new xt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return cr.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(cr).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(lr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),lr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),lr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),lr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),lr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),lr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),lr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),lr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(lr)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Ar=new Er;function Tr(e,t){this.center=void 0!==e?e:new xt,this.radius=void 0!==t?t:0}Object.assign(Tr.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var r=this.center;void 0!==t?r.copy(t):Ar.setFromPoints(e).getCenter(r);for(var n=0,i=0,o=e.length;i<o;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new xt),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Er),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Sr=new xt,xr=new xt,Mr=new xt,Rr=new xt,Or=new xt,Pr=new xt,Cr=new xt;function Dr(e,t){this.origin=void 0!==e?e:new xt,this.direction=void 0!==t?t:new xt}Object.assign(Dr.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new xt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Sr)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new xt),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Sr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Sr.copy(this.direction).multiplyScalar(t).add(this.origin),Sr.distanceToSquared(e))},distanceSqToSegment:function(e,t,r,n){xr.copy(e).add(t).multiplyScalar(.5),Mr.copy(t).sub(e).normalize(),Rr.copy(this.origin).sub(xr);var i,o,a,s,u=.5*e.distanceTo(t),l=-this.direction.dot(Mr),c=Rr.dot(this.direction),d=-Rr.dot(Mr),f=Rr.lengthSq(),h=Math.abs(1-l*l);if(0<h)if(o=l*c-d,s=u*h,0<=(i=l*d-c))if(-s<=o)if(o<=s){var p=1/h;a=(i*=p)*(i+l*(o*=p)+2*c)+o*(l*i+o+2*d)+f}else o=u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*d)+f;else o=-u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*d)+f;else a=o<=-s?-(i=Math.max(0,-(-l*u+c)))*i+(o=0<i?-u:Math.min(Math.max(-u,-d),u))*(o+2*d)+f:o<=s?(i=0,(o=Math.min(Math.max(-u,-d),u))*(o+2*d)+f):-(i=Math.max(0,-(l*u+c)))*i+(o=0<i?u:Math.min(Math.max(-u,-d),u))*(o+2*d)+f;else o=0<l?-u:u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*d)+f;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(Mr).multiplyScalar(o).add(xr),a},intersectSphere:function(e,t){Sr.subVectors(e.center,this.origin);var r=Sr.dot(this.direction),n=Sr.dot(Sr)-r*r,i=e.radius*e.radius;if(i<n)return null;var o=Math.sqrt(i-n),a=r-o,s=r+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,n,i,o,a,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,d=this.origin;return n=0<=u?(r=(e.min.x-d.x)*u,(e.max.x-d.x)*u):(r=(e.max.x-d.x)*u,(e.min.x-d.x)*u),(o=0<=l?(i=(e.min.y-d.y)*l,(e.max.y-d.y)*l):(i=(e.max.y-d.y)*l,(e.min.y-d.y)*l))<r||n<i?null:((r<i||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),(s=0<=c?(a=(e.min.z-d.z)*c,(e.max.z-d.z)*c):(a=(e.max.z-d.z)*c,(e.min.z-d.z)*c))<r||n<a?null:((r<a||r!=r)&&(r=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(0<=r?r:n,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,Sr)},intersectTriangle:function(e,t,r,n,i){Or.subVectors(t,e),Pr.subVectors(r,e),Cr.crossVectors(Or,Pr);var o,a=this.direction.dot(Cr);if(0<a){if(n)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Rr.subVectors(this.origin,e);var s=o*this.direction.dot(Pr.crossVectors(Rr,Pr));if(s<0)return null;var u=o*this.direction.dot(Or.cross(Rr));if(u<0)return null;if(a<s+u)return null;var l=-o*Rr.dot(Cr);return l<0?null:this.at(l/a,i)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var Ir=new xt,Lr=new xt,Nr=new xt,kr=new xt,Fr=new xt,jr=new xt,Br=new xt,Ur=new xt,Gr=new xt,Hr=new xt;function Vr(e,t,r){this.a=void 0!==e?e:new xt,this.b=void 0!==t?t:new xt,this.c=void 0!==r?r:new xt}Object.assign(Vr,{getNormal:function(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new xt),n.subVectors(r,t),Ir.subVectors(e,t),n.cross(Ir);var i=n.lengthSq();return 0<i?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)},getBarycoord:function(e,t,r,n,i){Ir.subVectors(n,t),Lr.subVectors(r,t),Nr.subVectors(e,t);var o=Ir.dot(Ir),a=Ir.dot(Lr),s=Ir.dot(Nr),u=Lr.dot(Lr),l=Lr.dot(Nr),c=o*u-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new xt),0==c)return i.set(-2,-1,-1);var d=1/c,f=(u*s-a*l)*d,h=(o*l-a*s)*d;return i.set(1-f-h,h,f)},containsPoint:function(e,t,r,n){return Vr.getBarycoord(e,t,r,n,kr),0<=kr.x&&0<=kr.y&&kr.x+kr.y<=1},getUV:function(e,t,r,n,i,o,a,s){return this.getBarycoord(e,t,r,n,kr),s.set(0,0),s.addScaledVector(i,kr.x),s.addScaledVector(o,kr.y),s.addScaledVector(a,kr.z),s},isFrontFacing:function(e,t,r,n){return Ir.subVectors(r,t),Lr.subVectors(e,t),Ir.cross(Lr).dot(n)<0}}),Object.assign(Vr.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Ir.subVectors(this.c,this.b),Lr.subVectors(this.a,this.b),.5*Ir.cross(Lr).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new xt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Vr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new xt),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Vr.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,n,i){return Vr.getUV(e,this.a,this.b,this.c,t,r,n,i)},containsPoint:function(e){return Vr.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Vr.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new xt);var r,n,i=this.a,o=this.b,a=this.c;Fr.subVectors(o,i),jr.subVectors(a,i),Ur.subVectors(e,i);var s=Fr.dot(Ur),u=jr.dot(Ur);if(s<=0&&u<=0)return t.copy(i);Gr.subVectors(e,o);var l=Fr.dot(Gr),c=jr.dot(Gr);if(0<=l&&c<=l)return t.copy(o);var d=s*c-l*u;if(d<=0&&0<=s&&l<=0)return r=s/(s-l),t.copy(i).addScaledVector(Fr,r);Hr.subVectors(e,a);var f=Fr.dot(Hr),h=jr.dot(Hr);if(0<=h&&f<=h)return t.copy(a);var p=f*u-s*h;if(p<=0&&0<=u&&h<=0)return n=u/(u-h),t.copy(i).addScaledVector(jr,n);var m=l*h-f*c;if(m<=0&&0<=c-l&&0<=f-h)return Br.subVectors(a,o),n=(c-l)/(c-l+(f-h)),t.copy(o).addScaledVector(Br,n);var g=1/(m+p+d);return r=p*g,n=d*g,t.copy(i).addScaledVector(Fr,r).addScaledVector(jr,n)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var zr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wr={h:0,s:0,l:0},qr={h:0,s:0,l:0};function Yr(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function Kr(e,t,r){return r<0&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function Xr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Qr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function Jr(e,t,r,n,i,o){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new xt,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Yr,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Object.assign(Yr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(e=Et.euclideanModulo(e,1),t=Et.clamp(t,0,1),r=Et.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=Kr(i,n,e+1/3),this.g=Kr(i,n,e),this.b=Kr(i,n,e-1/3)}return this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[1],o=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,u=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(a,s,u)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,c=(l=r[1]).length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}t&&0<t.length&&(void 0!==(l=zr[t])?this.setHex(l):console.warn("THREE.Color: Unknown color "+t));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=0<t?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=Xr(e.r),this.g=Xr(e.g),this.b=Xr(e.b),this},copyLinearToSRGB:function(e){return this.r=Qr(e.r),this.g=Qr(e.g),this.b=Qr(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,o=this.b,a=Math.max(n,i,o),s=Math.min(n,i,o),u=(s+a)/2;if(s===a)r=t=0;else{var l=a-s;switch(r=u<=.5?l/(a+s):l/(2-a-s),a){case n:t=(i-o)/l+(i<o?6:0);break;case i:t=(o-n)/l+2;break;case o:t=(n-i)/l+4}t/=6}return e.h=t,e.s=r,e.l=u,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){return this.getHSL(Wr),Wr.h+=e,Wr.s+=t,Wr.l+=r,this.setHSL(Wr.h,Wr.s,Wr.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Wr),e.getHSL(qr);var r=Et.lerp(Wr.h,qr.h,t),n=Et.lerp(Wr.s,qr.s,t),i=Et.lerp(Wr.l,qr.l,t);return this.setHSL(r,n,i),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(Jr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Zr=0;function $r(){Object.defineProperty(this,"id",{value:Zr++}),this.uuid=Et.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=J,this.side=I,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=a,this.opacity=1,this.transparent=!1,this.blendSrc=h,this.blendDst=p,this.blendEquation=re,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ae,this.depthTest=!0,this.depthWrite=!0,this.stencilFunc=yt,this.stencilRef=0,this.stencilMask=255,this.stencilFail=vt,this.stencilZFail=vt,this.stencilZPass=vt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.needsUpdate=!0}function en(e){$r.call(this),this.type="MeshBasicMaterial",this.color=new Yr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=j,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function tn(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function rn(e,t,r){tn.call(this,new Int8Array(e),t,r)}function nn(e,t,r){tn.call(this,new Uint8Array(e),t,r)}function on(e,t,r){tn.call(this,new Uint8ClampedArray(e),t,r)}function an(e,t,r){tn.call(this,new Int16Array(e),t,r)}function sn(e,t,r){tn.call(this,new Uint16Array(e),t,r)}function un(e,t,r){tn.call(this,new Int32Array(e),t,r)}function ln(e,t,r){tn.call(this,new Uint32Array(e),t,r)}function cn(e,t,r){tn.call(this,new Float32Array(e),t,r)}function dn(e,t,r){tn.call(this,new Float64Array(e),t,r)}function fn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function hn(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}$r.prototype=Object.assign(Object.create(t.prototype),{constructor:$r,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==J&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==I&&(r.side=this.side),this.vertexColors!==a&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilMask=this.stencilMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=n(e.textures),o=n(e.images);0<i.length&&(r.textures=i),0<o.length&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWrite=e.stencilWrite,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilMask=e.stencilMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),((en.prototype=Object.create($r.prototype)).constructor=en).prototype.isMeshBasicMaterial=!0,en.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(tn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(tn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new Yr),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new wt),t[r++]=o.x,t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new xt),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new It),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(rn.prototype=Object.create(tn.prototype)).constructor=rn,(nn.prototype=Object.create(tn.prototype)).constructor=nn,(on.prototype=Object.create(tn.prototype)).constructor=on,(an.prototype=Object.create(tn.prototype)).constructor=an,(sn.prototype=Object.create(tn.prototype)).constructor=sn,(un.prototype=Object.create(tn.prototype)).constructor=un,(ln.prototype=Object.create(tn.prototype)).constructor=ln,(cn.prototype=Object.create(tn.prototype)).constructor=cn,(dn.prototype=Object.create(tn.prototype)).constructor=dn,Object.assign(fn.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,i=e.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,r.push(t)),t={start:3*o,materialIndex:n})}void 0!==t&&(t.count=3*o-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,o=i[0]&&0<i[0].length,a=i[1]&&0<i[1].length,s=e.morphTargets,u=s.length;if(0<u){t=[];for(var l=0;l<u;l++)t[l]={name:s[l].name,data:[]};this.morphTargets.position=t}var c,d=e.morphNormals,f=d.length;if(0<f){c=[];for(l=0;l<f;l++)c[l]={name:d[l].name,data:[]};this.morphTargets.normal=c}var h=e.skinIndices,p=e.skinWeights,m=h.length===n.length,g=p.length===n.length;0<n.length&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(l=0;l<r.length;l++){var v=r[l];this.vertices.push(n[v.a],n[v.b],n[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=v.normal;this.normals.push(_,_,_)}var b,E=v.vertexColors;if(3===E.length)this.colors.push(E[0],E[1],E[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===o)void 0!==(b=i[0][l])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new wt,new wt,new wt));if(!0===a)void 0!==(b=i[1][l])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new wt,new wt,new wt));for(var A=0;A<u;A++){var T=s[A].vertices;t[A].data.push(T[v.a],T[v.b],T[v.c])}for(A=0;A<f;A++){var S=d[A].vertexNormals[l];c[A].data.push(S.a,S.b,S.c)}m&&this.skinIndices.push(h[v.a],h[v.b],h[v.c]),g&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var pn=1,mn=new Vt,gn=new sr,vn=new xt,yn=new Er,_n=new Er,bn=new xt;function En(){Object.defineProperty(this,"id",{value:pn+=2}),this.uuid=Et.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}En.prototype=Object.assign(Object.create(t.prototype),{constructor:En,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<hn(e)?ln:sn)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?("index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t)):this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new tn(t,arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new Ot).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);var n=this.attributes.tangent;void 0!==n&&((new Ot).getNormalMatrix(e).applyToBufferAttribute(n),n.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return mn.makeRotationX(e),this.applyMatrix(mn),this},rotateY:function(e){return mn.makeRotationY(e),this.applyMatrix(mn),this},rotateZ:function(e){return mn.makeRotationZ(e),this.applyMatrix(mn),this},translate:function(e,t,r){return mn.makeTranslation(e,t,r),this.applyMatrix(mn),this},scale:function(e,t,r){return mn.makeScale(e,t,r),this.applyMatrix(mn),this},lookAt:function(e){return gn.lookAt(e),gn.updateMatrix(),this.applyMatrix(gn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(vn).negate(),this.translate(vn.x,vn.y,vn.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new cn(3*t.vertices.length,3),n=new cn(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new cn(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new cn(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new fn).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new tn(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new tn(r,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new tn(n,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new tn(i,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new tn(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],u=e.morphTargets[a],l=0,c=u.length;l<c;l++){var d=u[l],f=new cn(3*d.data.length,3);f.name=d.name,s.push(f.copyVector3sArray(d.data))}this.morphAttributes[a]=s}if(0<e.skinIndices.length){var h=new cn(4*e.skinIndices.length,4);this.addAttribute("skinIndex",h.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var p=new cn(4*e.skinWeights.length,4);this.addAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Er);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var r=0,n=t.length;r<n;r++){var i=t[r];yn.setFromBufferAttribute(i),this.boundingBox.expandByPoint(yn.min),this.boundingBox.expandByPoint(yn.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Tr);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var r=this.boundingSphere.center;if(yn.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var o=t[n];_n.setFromBufferAttribute(o),yn.expandByPoint(_n.min),yn.expandByPoint(_n.max)}yn.getCenter(r);var a=0;for(n=0,i=e.count;n<i;n++)bn.fromBufferAttribute(e,n),a=Math.max(a,r.distanceToSquared(bn));if(t)for(n=0,i=t.length;n<i;n++)for(var s=0,u=(o=t[n]).count;s<u;s++)bn.fromBufferAttribute(o,s),a=Math.max(a,r.distanceToSquared(bn));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new tn(new Float32Array(r.length),3));else for(var n=t.normal.array,i=0,o=n.length;i<o;i++)n[i]=0;var a,s,u,l=t.normal.array,c=new xt,d=new xt,f=new xt,h=new xt,p=new xt;if(e){var m=e.array;for(i=0,o=e.count;i<o;i+=3)a=3*m[i+0],s=3*m[i+1],u=3*m[i+2],c.fromArray(r,a),d.fromArray(r,s),f.fromArray(r,u),h.subVectors(f,d),p.subVectors(c,d),h.cross(p),l[a]+=h.x,l[1+a]+=h.y,l[2+a]+=h.z,l[s]+=h.x,l[1+s]+=h.y,l[2+s]+=h.z,l[u]+=h.x,l[1+u]+=h.y,l[2+u]+=h.z}else for(i=0,o=r.length;i<o;i+=9)c.fromArray(r,i),d.fromArray(r,i+3),f.fromArray(r,i+6),h.subVectors(f,d),p.subVectors(c,d),h.cross(p),l[i]=h.x,l[i+1]=h.y,l[i+2]=h.z,l[i+3]=h.x,l[i+4]=h.y,l[i+5]=h.z,l[i+6]=h.x,l[i+7]=h.y,l[i+8]=h.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n].array,o=e.attributes[n],a=o.array,s=o.itemSize*t,u=Math.min(a.length,i.length-s),l=0,c=s;l<u;l++,c++)i[c]=a[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,r=e.count;t<r;t++)bn.x=e.getX(t),bn.y=e.getY(t),bn.z=e.getZ(t),bn.normalize(),e.setXYZ(t,bn.x,bn.y,bn.z)},toNonIndexed:function(){function e(e,t){for(var r=e.array,n=e.itemSize,i=new r.constructor(t.length*n),o=0,a=0,s=0,u=t.length;s<u;s++){o=t[s]*n;for(var l=0;l<n;l++)i[a++]=r[o++]}return new tn(i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new En,r=this.index.array,n=this.attributes;for(var i in n){var o=e(n[i],r);t.addAttribute(i,o)}var a=this.morphAttributes;for(i in a){for(var s=[],u=a[i],l=0,c=u.length;l<c;l++){o=e(u[l],r);s.push(o)}t.morphAttributes[i]=s}for(var d=this.groups,f=(l=0,d.length);l<f;l++){var h=d[l];t.addGroup(h.start,h.count,h.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;null!==n&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var o=(f=i[r]).toJSON();""!==f.name&&(o.name=f.name),e.data.attributes[r]=o}var a={},s=!1;for(var r in this.morphAttributes){for(var u=this.morphAttributes[r],l=[],c=0,d=u.length;c<d;c++){var f;o=(f=u[c]).toJSON();""!==f.name&&(o.name=f.name),l.push(o)}0<l.length&&(a[r]=l,s=!0)}s&&(e.data.morphAttributes=a);var h=this.groups;0<h.length&&(e.data.groups=JSON.parse(JSON.stringify(h)));var p=this.boundingSphere;return null!==p&&(e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),e},clone:function(){return(new En).copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var a=o[t];this.addAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var u=[],l=s[t];for(r=0,n=l.length;r<n;r++)u.push(l[r].clone());this.morphAttributes[t]=u}var c=e.groups;for(r=0,n=c.length;r<n;r++){var d=c[r];this.addGroup(d.start,d.count,d.materialIndex)}var f=e.boundingBox;null!==f&&(this.boundingBox=f.clone());var h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var wn=new Vt,An=new Dr,Tn=new Tr,Sn=new xt,xn=new xt,Mn=new xt,Rn=new xt,On=new xt,Pn=new xt,Cn=new xt,Dn=new xt,In=new xt,Ln=new wt,Nn=new wt,kn=new wt,Fn=new xt,jn=new xt;function Bn(e,t){sr.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new En,this.material=void 0!==t?t:new en({color:16777215*Math.random()}),this.drawMode=ot,this.updateMorphTargets()}function Un(e,t,r,n,i,o,a,s){if(null===(t.side===Ee?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,t.side!==X,s)))return null;jn.copy(s),jn.applyMatrix4(e.matrixWorld);var u=r.ray.origin.distanceTo(jn);return u<r.near||u>r.far?null:{distance:u,point:jn.clone(),object:e}}function Gn(e,t,r,n,i,o,a,s,u,l,c){Sn.fromBufferAttribute(i,u),xn.fromBufferAttribute(i,l),Mn.fromBufferAttribute(i,c);var d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){Cn.set(0,0,0),Dn.set(0,0,0),In.set(0,0,0);for(var f=0,h=o.length;f<h;f++){var p=d[f],m=o[f];0!==p&&(Rn.fromBufferAttribute(m,u),On.fromBufferAttribute(m,l),Pn.fromBufferAttribute(m,c),Cn.addScaledVector(Rn.sub(Sn),p),Dn.addScaledVector(On.sub(xn),p),In.addScaledVector(Pn.sub(Mn),p))}Sn.add(Cn),xn.add(Dn),Mn.add(In)}var g=Un(e,t,r,n,Sn,xn,Mn,Fn);if(g){a&&(Ln.fromBufferAttribute(a,u),Nn.fromBufferAttribute(a,l),kn.fromBufferAttribute(a,c),g.uv=Vr.getUV(Fn,Sn,xn,Mn,Ln,Nn,kn,new wt)),s&&(Ln.fromBufferAttribute(s,u),Nn.fromBufferAttribute(s,l),kn.fromBufferAttribute(s,c),g.uv2=Vr.getUV(Fn,Sn,xn,Mn,Ln,Nn,kn,new wt));var v=new Jr(u,l,c);Vr.getNormal(Sn,xn,Mn,v.normal),g.face=v}return g}Bn.prototype=Object.assign(Object.create(sr.prototype),{constructor:Bn,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return sr.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(0<o.length){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;void 0!==s&&0<s.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var r,n=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),Tn.copy(n.boundingSphere),Tn.applyMatrix4(o),!1!==e.ray.intersectsSphere(Tn)&&(wn.getInverse(o),An.copy(e.ray).applyMatrix4(wn),null===n.boundingBox||!1!==An.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var a,s,u,l,c,d,f,h,p,m=n.index,g=n.attributes.position,v=n.morphAttributes.position,y=n.attributes.uv,_=n.attributes.uv2,b=n.groups,E=n.drawRange;if(null!==m)if(Array.isArray(i))for(l=0,d=b.length;l<d;l++)for(p=i[(h=b[l]).materialIndex],c=Math.max(h.start,E.start),f=Math.min(h.start+h.count,E.start+E.count);c<f;c+=3)a=m.getX(c),s=m.getX(c+1),u=m.getX(c+2),(r=Gn(this,p,e,An,g,v,y,_,a,s,u))&&(r.faceIndex=Math.floor(c/3),r.face.materialIndex=h.materialIndex,t.push(r));else for(l=Math.max(0,E.start),d=Math.min(m.count,E.start+E.count);l<d;l+=3)a=m.getX(l),s=m.getX(l+1),u=m.getX(l+2),(r=Gn(this,i,e,An,g,v,y,_,a,s,u))&&(r.faceIndex=Math.floor(l/3),t.push(r));else if(void 0!==g)if(Array.isArray(i))for(l=0,d=b.length;l<d;l++)for(p=i[(h=b[l]).materialIndex],c=Math.max(h.start,E.start),f=Math.min(h.start+h.count,E.start+E.count);c<f;c+=3)(r=Gn(this,p,e,An,g,v,y,_,a=c,s=c+1,u=c+2))&&(r.faceIndex=Math.floor(c/3),r.face.materialIndex=h.materialIndex,t.push(r));else for(l=Math.max(0,E.start),d=Math.min(g.count,E.start+E.count);l<d;l+=3)(r=Gn(this,i,e,An,g,v,y,_,a=l,s=l+1,u=l+2))&&(r.faceIndex=Math.floor(l/3),t.push(r))}else if(n.isGeometry){var w,A,T,S,x=Array.isArray(i),M=n.vertices,R=n.faces,O=n.faceVertexUvs[0];0<O.length&&(S=O);for(var P=0,C=R.length;P<C;P++){var D=R[P],I=x?i[D.materialIndex]:i;if(void 0!==I&&(w=M[D.a],A=M[D.b],T=M[D.c],r=Un(this,I,e,An,w,A,T,Fn))){if(S&&S[P]){var L=S[P];Ln.copy(L[0]),Nn.copy(L[1]),kn.copy(L[2]),r.uv=Vr.getUV(Fn,w,A,T,Ln,Nn,kn,new wt)}r.face=D,r.faceIndex=P,t.push(r)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Hn=0,Vn=new Vt,zn=new sr,Wn=new xt;function qn(){Object.defineProperty(this,"id",{value:Hn+=2}),this.uuid=Et.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Yn(e,t,r,n,i,o){qn.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new Kn(e,t,r,n,i,o)),this.mergeVertices()}function Kn(e,t,r,n,i,o){En.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var O=this;e=e||1,t=t||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1,o=Math.floor(o)||1;var P=[],C=[],D=[],I=[],L=0,N=0;function a(e,t,r,n,i,o,a,s,u,l,c){var d,f,h=o/u,p=a/l,m=o/2,g=a/2,v=s/2,y=u+1,_=l+1,b=0,E=0,w=new xt;for(f=0;f<_;f++){var A=f*p-g;for(d=0;d<y;d++){var T=d*h-m;w[e]=T*n,w[t]=A*i,w[r]=v,C.push(w.x,w.y,w.z),w[e]=0,w[t]=0,w[r]=0<s?1:-1,D.push(w.x,w.y,w.z),I.push(d/u),I.push(1-f/l),b+=1}}for(f=0;f<l;f++)for(d=0;d<u;d++){var S=L+d+y*f,x=L+d+y*(f+1),M=L+(d+1)+y*(f+1),R=L+(d+1)+y*f;P.push(S,x,R),P.push(x,M,R),E+=6}O.addGroup(N,E,c),N+=E,L+=b}a("z","y","x",-1,-1,r,t,e,o,i,0),a("z","y","x",1,-1,r,t,-e,o,i,1),a("x","z","y",1,1,e,r,t,n,o,2),a("x","z","y",1,-1,e,r,-t,n,o,3),a("x","y","z",1,-1,e,t,r,n,i,4),a("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(P),this.addAttribute("position",new cn(C,3)),this.addAttribute("normal",new cn(D,3)),this.addAttribute("uv",new cn(I,2))}function Xn(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}function Qn(e){for(var t={},r=0;r<e.length;r++){var n=Xn(e[r]);for(var i in n)t[i]=n[i]}return t}qn.prototype=Object.assign(Object.create(t.prototype),{constructor:qn,isGeometry:!0,applyMatrix:function(e){for(var t=(new Ot).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++){this.vertices[r].applyMatrix4(e)}for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(t).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Vn.makeRotationX(e),this.applyMatrix(Vn),this},rotateY:function(e){return Vn.makeRotationY(e),this.applyMatrix(Vn),this},rotateZ:function(e){return Vn.makeRotationZ(e),this.applyMatrix(Vn),this},translate:function(e,t,r){return Vn.makeTranslation(e,t,r),this.applyMatrix(Vn),this},scale:function(e,t,r){return Vn.makeScale(e,t,r),this.applyMatrix(Vn),this},lookAt:function(e){return zn.lookAt(e),zn.updateMatrix(),this.applyMatrix(zn.matrix),this},fromBufferGeometry:function(e){var a=this,t=null!==e.index?e.index.array:void 0,r=e.attributes,n=r.position.array,s=void 0!==r.normal?r.normal.array:void 0,u=void 0!==r.color?r.color.array:void 0,l=void 0!==r.uv?r.uv.array:void 0,c=void 0!==r.uv2?r.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var i=0;i<n.length;i+=3)a.vertices.push((new xt).fromArray(n,i)),void 0!==u&&a.colors.push((new Yr).fromArray(u,i));function o(e,t,r,n){var i=void 0===u?[]:[a.colors[e].clone(),a.colors[t].clone(),a.colors[r].clone()],o=new Jr(e,t,r,void 0===s?[]:[(new xt).fromArray(s,3*e),(new xt).fromArray(s,3*t),(new xt).fromArray(s,3*r)],i,n);a.faces.push(o),void 0!==l&&a.faceVertexUvs[0].push([(new wt).fromArray(l,2*e),(new wt).fromArray(l,2*t),(new wt).fromArray(l,2*r)]),void 0!==c&&a.faceVertexUvs[1].push([(new wt).fromArray(c,2*e),(new wt).fromArray(c,2*t),(new wt).fromArray(c,2*r)])}var d=e.groups;if(0<d.length)for(i=0;i<d.length;i++)for(var f=d[i],h=f.start,p=h,m=h+f.count;p<m;p+=3)void 0!==t?o(t[p],t[p+1],t[p+2],f.materialIndex):o(p,p+1,p+2,f.materialIndex);else if(void 0!==t)for(i=0;i<t.length;i+=3)o(t[i],t[i+1],t[i+2]);else for(i=0;i<n.length/3;i+=3)o(i,i+1,i+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wn).negate(),this.translate(Wn.x,Wn.y,Wn.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new Vt;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new xt,t=new xt,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)a[t]=new xt;if(e){var s,u,l,c=new xt,d=new xt;for(n=0,i=this.faces.length;n<i;n++)o=this.faces[n],s=this.vertices[o.a],u=this.vertices[o.b],l=this.vertices[o.c],c.subVectors(l,u),d.subVectors(s,u),c.cross(d),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,r=this.vertices.length;t<r;t++)a[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var f=(o=this.faces[n]).vertexNormals;3===f.length?(f[0].copy(a[o.a]),f[1].copy(a[o.b]),f[2].copy(a[o.c])):(f[0]=a[o.a].clone(),f[1]=a[o.b].clone(),f[2]=a[o.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new qn;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)u=new xt,l={a:new xt,b:new xt,c:new xt},a.push(u),s.push(l)}var u,l,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],u=c.faceNormals[r],l=c.vertexNormals[r],u.copy(i.normal),l.a.copy(i.vertexNormals[0]),l.b.copy(i.vertexNormals[1]),l.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Er),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Tr),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,u=e.faces,l=this.colors,c=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new Ot).getNormalMatrix(t));for(var d=0,f=a.length;d<f;d++){var h=a[d].clone();void 0!==t&&h.applyMatrix4(t),o.push(h)}for(d=0,f=c.length;d<f;d++)l.push(c[d].clone());for(d=0,f=u.length;d<f;d++){var p,m,g,v=u[d],y=v.vertexNormals,_=v.vertexColors;(p=new Jr(v.a+i,v.b+i,v.c+i)).normal.copy(v.normal),void 0!==n&&p.normal.applyMatrix3(n).normalize();for(var b=0,E=y.length;b<E;b++)m=y[b].clone(),void 0!==n&&m.applyMatrix3(n).normalize(),p.vertexNormals.push(m);p.color.copy(v.color);for(b=0,E=_.length;b<E;b++)g=_[b],p.vertexColors.push(g.clone());p.materialIndex=v.materialIndex+r,s.push(p)}for(d=0,f=e.faceVertexUvs.length;d<f;d++){var w=e.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]);for(b=0,E=w.length;b<E;b++){for(var A=w[b],T=[],S=0,x=A.length;S<x;S++)T.push(A[S].clone());this.faceVertexUvs[d].push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,n,i,o,a,s,u={},l=[],c=[],d=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],void 0===u[t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d)]?(u[t]=r,l.push(this.vertices[r]),c[r]=l.length-1):c[r]=c[u[t]];var f=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],o=[i.a,i.b,i.c];for(var h=0;h<3;h++)if(o[h]===o[(h+1)%3]){f.push(r);break}}for(r=f.length-1;0<=r;r--){var p=f[r];for(this.faces.splice(p,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(p,1)}var m=this.vertices.length-l.length;return this.vertices=l,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new xt(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(n=[]),a&&a.length===t&&(i=[]);for(r=0;r<t;r++){var s=e[r]._id;n&&n.push(o[s]),i&&i.push(a[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var a=[],s=[],u={},l=[],c={},d=[],f={};for(i=0;i<this.faces.length;i++){var h=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=0<h.normal.length(),g=0<h.vertexNormals.length,v=1!==h.color.r||1!==h.color.g||1!==h.color.b,y=0<h.vertexColors.length,_=0;if(_=A(_=A(_=A(_=A(_=A(_=A(_=A(_=A(_,0,0),1,!0),2,!1),3,p),4,m),5,g),6,v),7,y),a.push(_),a.push(h.a,h.b,h.c),a.push(h.materialIndex),p){var b=this.faceVertexUvs[0][i];a.push(x(b[0]),x(b[1]),x(b[2]))}if(m&&a.push(T(h.normal)),g){var E=h.vertexNormals;a.push(T(E[0]),T(E[1]),T(E[2]))}if(v&&a.push(S(h.color)),y){var w=h.vertexColors;a.push(S(w[0]),S(w[1]),S(w[2]))}}function A(e,t,r){return r?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==u[t]||(u[t]=s.length/3,s.push(e.x,e.y,e.z)),u[t]}function S(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=l.length,l.push(e.getHex())),c[t]}function x(e){var t=e.x.toString()+e.y.toString();return void 0!==f[t]||(f[t]=d.length/2,d.push(e.x,e.y)),f[t]}return e.data={},e.data.vertices=n,e.data.normals=s,0<l.length&&(e.data.colors=l),0<d.length&&(e.data.uvs=[d]),e.data.faces=a,e},clone:function(){return(new qn).copy(this)},copy:function(e){var t,r,n,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var u=e.colors;for(t=0,r=u.length;t<r;t++)this.colors.push(u[t].clone());var l=e.faces;for(t=0,r=l.length;t<r;t++)this.faces.push(l[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=c.length;n<i;n++){var d=c[n],f=[];for(o=0,a=d.length;o<a;o++){var h=d[o];f.push(h.clone())}this.faceVertexUvs[t].push(f)}}var p=e.morphTargets;for(t=0,r=p.length;t<r;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],n=0,i=p[t].vertices.length;n<i;n++)m.vertices.push(p[t].vertices[n].clone());if(void 0!==p[t].normals)for(m.normals=[],n=0,i=p[t].normals.length;n<i;n++)m.normals.push(p[t].normals[n].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,r=g.length;t<r;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],n=0,i=g[t].vertexNormals.length;n<i;n++){var y=g[t].vertexNormals[n],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),v.vertexNormals.push(_)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],n=0,i=g[t].faceNormals.length;n<i;n++)v.faceNormals.push(g[t].faceNormals[n].clone());this.morphNormals.push(v)}var b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());var E=e.skinIndices;for(t=0,r=E.length;t<r;t++)this.skinIndices.push(E[t].clone());var w=e.lineDistances;for(t=0,r=w.length;t<r;t++)this.lineDistances.push(w[t]);var A=e.boundingBox;null!==A&&(this.boundingBox=A.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Yn.prototype=Object.create(qn.prototype)).constructor=Yn,(Kn.prototype=Object.create(En.prototype)).constructor=Kn;var Jn={clone:Xn,merge:Qn},Zn="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",$n="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ei(e){$r.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Zn,this.fragmentShader=$n,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function ti(){sr.call(this),this.type="Camera",this.matrixWorldInverse=new Vt,this.projectionMatrix=new Vt,this.projectionMatrixInverse=new Vt}function ri(e,t,r,n){ti.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}((ei.prototype=Object.create($r.prototype)).constructor=ei).prototype.isShaderMaterial=!0,ei.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Xn(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ei.prototype.toJSON=function(e){var t=$r.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return 0<Object.keys(i).length&&(t.extensions=i),t},ti.prototype=Object.assign(Object.create(sr.prototype),{constructor:ti,isCamera:!0,copy:function(e,t){return sr.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new xt),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){sr.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ri.prototype=Object.assign(Object.create(ti.prototype),{constructor:ri,isPerspectiveCamera:!0,copy:function(e,t){return ti.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Et.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Et.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Et.RAD2DEG*Math.atan(Math.tan(.5*Et.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Et.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/a,t-=o.offsetY*r/s,n*=o.width/a,r*=o.height/s}var u=this.filmOffset;0!==u&&(i+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=sr.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});function ni(e,t,r,n){sr.call(this),this.type="CubeCamera";var o=new ri(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new xt(1,0,0)),this.add(o);var a=new ri(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new xt(-1,0,0)),this.add(a);var s=new ri(90,1,e,t);s.up.set(0,0,1),s.lookAt(new xt(0,1,0)),this.add(s);var u=new ri(90,1,e,t);u.up.set(0,0,-1),u.lookAt(new xt(0,-1,0)),this.add(u);var l=new ri(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new xt(0,0,1)),this.add(l);var c=new ri(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new xt(0,0,-1)),this.add(c),n=n||{format:Pe,magFilter:Ae,minFilter:Ae},this.renderTarget=new ii(r,r,n),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=e.getRenderTarget(),n=this.renderTarget,i=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,o),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,u),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=i,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(r)},this.clear=function(e,t,r,n){for(var i=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,r,n);e.setRenderTarget(i)}}function ii(e,t,r){Lt.call(this,e,t,r)}function oi(e,t,r,n,i,o,a,s,u,l,c,d){Dt.call(this,null,o,a,s,u,l,n,i,c,d),this.image={data:e,width:t,height:r},this.magFilter=void 0!==u?u:ye,this.minFilter=void 0!==l?l:ye,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}(ni.prototype=Object.create(sr.prototype)).constructor=ni,((ii.prototype=Object.create(Lt.prototype)).constructor=ii).prototype.isWebGLRenderTargetCube=!0,ii.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new ur,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new ei({type:"CubemapFromEquirect",uniforms:Xn(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ee,blending:Q});i.uniforms.tEquirect.value=t;var o=new Bn(new Kn(5,5,5),i);r.add(o);var a=new ni(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,r),o.geometry.dispose(),o.material.dispose(),this},((oi.prototype=Object.create(Dt.prototype)).constructor=oi).prototype.isDataTexture=!0;var ai=new xt,si=new xt,ui=new Ot;function li(e,t){this.normal=void 0!==e?e:new xt(1,0,0),this.constant=void 0!==t?t:0}Object.assign(li.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,r){var n=ai.subVectors(r,t).cross(si.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new xt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new xt);var r=e.delta(ai),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/n;return i<0||1<i?void 0:t.copy(r).multiplyScalar(i).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&0<r||r<0&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new xt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var r=t||ui.getNormalMatrix(e),n=this.coplanarPoint(ai).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var ci=new Tr,di=new xt;function fi(e,t,r,n,i,o){this.planes=[void 0!==e?e:new li,void 0!==t?t:new li,void 0!==r?r:new li,void 0!==n?n:new li,void 0!==i?i:new li,void 0!==o?o:new li]}Object.assign(fi.prototype,{set:function(e,t,r,n,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],u=r[5],l=r[6],c=r[7],d=r[8],f=r[9],h=r[10],p=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-n,c-s,p-d,y-m).normalize(),t[1].setComponents(a+n,c+s,p+d,y+m).normalize(),t[2].setComponents(a+i,c+u,p+f,y+g).normalize(),t[3].setComponents(a-i,c-u,p-f,y-g).normalize(),t[4].setComponents(a-o,c-l,p-h,y-v).normalize(),t[5].setComponents(a+o,c+l,p+h,y+v).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ci.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ci)},intersectsSprite:function(e){return ci.center.set(0,0,0),ci.radius=.7071067811865476,ci.applyMatrix4(e.matrixWorld),this.intersectsSphere(ci)},intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(r)<n)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];if(di.x=0<n.normal.x?e.max.x:e.min.x,di.y=0<n.normal.y?e.max.y:e.min.y,di.z=0<n.normal.z?e.max.z:e.min.z,n.distanceToPoint(di)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var hi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\t#ifdef USE_TANGENT\n\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, normalScale, normalMap );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 normalScale, in sampler2D normalMap ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy *= normalScale;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvec3 NfromST = cross( S, T );\n\t\t\tif( dot( NfromST, N ) > 0.0 ) {\n\t\t\t\tS *= -1.0;\n\t\t\t\tT *= -1.0;\n\t\t\t}\n\t\t#else\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 vTBN = mat3( tangent, bitangent, clearcoatNormal );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = clearcoatNormalScale * mapN.xy;\n\t\tclearcoatNormal = normalize( vTBN * mapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatNormalScale, clearcoatNormalMap );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 encodeHalfRGBA ( vec2 v ) {\n\tvec4 encoded = vec4( 0.0 );\n\tconst vec2 offset = vec2( 1.0 / 255.0, 0.0 );\n\tencoded.xy = vec2( v.x, fract( v.x * 255.0 ) );\n\tencoded.xy = encoded.xy - ( encoded.yy * offset );\n\tencoded.zw = vec2( v.y, fract( v.y * 255.0 ) );\n\tencoded.zw = encoded.zw - ( encoded.ww * offset );\n\treturn encoded;\n}\nvec2 decodeHalfRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn decodeHalfRGBA( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#ifdef USE_UV\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},pi={common:{diffuse:{value:new Yr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ot},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new wt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Yr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Yr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Ot}},sprite:{diffuse:{value:new Yr(15658734)},opacity:{value:1},center:{value:new wt(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Ot}}},mi={basic:{uniforms:Qn([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.fog]),vertexShader:hi.meshbasic_vert,fragmentShader:hi.meshbasic_frag},lambert:{uniforms:Qn([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.fog,pi.lights,{emissive:{value:new Yr(0)}}]),vertexShader:hi.meshlambert_vert,fragmentShader:hi.meshlambert_frag},phong:{uniforms:Qn([pi.common,pi.specularmap,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.gradientmap,pi.fog,pi.lights,{emissive:{value:new Yr(0)},specular:{value:new Yr(1118481)},shininess:{value:30}}]),vertexShader:hi.meshphong_vert,fragmentShader:hi.meshphong_frag},standard:{uniforms:Qn([pi.common,pi.envmap,pi.aomap,pi.lightmap,pi.emissivemap,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.roughnessmap,pi.metalnessmap,pi.fog,pi.lights,{emissive:{value:new Yr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:hi.meshphysical_vert,fragmentShader:hi.meshphysical_frag},matcap:{uniforms:Qn([pi.common,pi.bumpmap,pi.normalmap,pi.displacementmap,pi.fog,{matcap:{value:null}}]),vertexShader:hi.meshmatcap_vert,fragmentShader:hi.meshmatcap_frag},points:{uniforms:Qn([pi.points,pi.fog]),vertexShader:hi.points_vert,fragmentShader:hi.points_frag},dashed:{uniforms:Qn([pi.common,pi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:hi.linedashed_vert,fragmentShader:hi.linedashed_frag},depth:{uniforms:Qn([pi.common,pi.displacementmap]),vertexShader:hi.depth_vert,fragmentShader:hi.depth_frag},normal:{uniforms:Qn([pi.common,pi.bumpmap,pi.normalmap,pi.displacementmap,{opacity:{value:1}}]),vertexShader:hi.normal_vert,fragmentShader:hi.normal_frag},sprite:{uniforms:Qn([pi.sprite,pi.fog]),vertexShader:hi.sprite_vert,fragmentShader:hi.sprite_frag},background:{uniforms:{uvTransform:{value:new Ot},t2D:{value:null}},vertexShader:hi.background_vert,fragmentShader:hi.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:hi.cube_vert,fragmentShader:hi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:hi.equirect_vert,fragmentShader:hi.equirect_frag},distanceRGBA:{uniforms:Qn([pi.common,pi.displacementmap,{referencePosition:{value:new xt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:hi.distanceRGBA_vert,fragmentShader:hi.distanceRGBA_frag},shadow:{uniforms:Qn([pi.lights,pi.fog,{color:{value:new Yr(0)},opacity:{value:1}}]),vertexShader:hi.shadow_vert,fragmentShader:hi.shadow_frag}};function gi(){var r=null,n=!1,i=null;function o(e,t){!1!==n&&(i(e,t),r.requestAnimationFrame(o))}return{start:function(){!0!==n&&null!==i&&(r.requestAnimationFrame(o),n=!0)},stop:function(){n=!1},setAnimationLoop:function(e){i=e},setContext:function(e){r=e}}}function vi(a){var n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=n.get(e);t&&(a.deleteBuffer(t.buffer),n.delete(e))},update:function(e,t){e.isInterleavedBufferAttribute&&(e=e.data);var r=n.get(e);void 0===r?n.set(e,function(e,t){var r=e.array,n=e.dynamic?35048:35044,i=a.createBuffer();a.bindBuffer(t,i),a.bufferData(t,r,n),e.onUploadCallback();var o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:r instanceof Uint8Array&&(o=5121),{buffer:i,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,t)):r.version<e.version&&(function(e,t,r){var n=t.array,i=t.updateRange;a.bindBuffer(r,e),!1===t.dynamic?a.bufferData(r,n,35044):-1===i.count?a.bufferSubData(r,0,n):0===i.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(a.bufferSubData(r,i.offset*n.BYTES_PER_ELEMENT,n.subarray(i.offset,i.offset+i.count)),i.count=-1)}(r.buffer,e,t),r.version=e.version)}}}function yi(e,t,r,n){qn.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new _i(e,t,r,n)),this.mergeVertices()}function _i(e,t,r,n){En.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,o,a=(e=e||1)/2,s=(t=t||1)/2,u=Math.floor(r)||1,l=Math.floor(n)||1,c=u+1,d=l+1,f=e/u,h=t/l,p=[],m=[],g=[],v=[];for(o=0;o<d;o++){var y=o*h-s;for(i=0;i<c;i++){var _=i*f-a;m.push(_,-y,0),g.push(0,0,1),v.push(i/u),v.push(1-o/l)}}for(o=0;o<l;o++)for(i=0;i<u;i++){var b=i+c*o,E=i+c*(o+1),w=i+1+c*(o+1),A=i+1+c*o;p.push(b,E,A),p.push(E,w,A)}this.setIndex(p),this.addAttribute("position",new cn(m,3)),this.addAttribute("normal",new cn(g,3)),this.addAttribute("uv",new cn(v,2))}function bi(u,r,l,n){var c,d,f=new Yr(0),h=0,p=null,m=0;function g(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,n)}return{getClearColor:function(){return f},setClearColor:function(e,t){f.set(e),g(f,h=void 0!==t?t:1)},getClearAlpha:function(){return h},setClearAlpha:function(e){g(f,h=e)},render:function(e,t,r,n){var i=t.background,o=u.vr,a=o.getSession&&o.getSession();if(a&&"additive"===a.environmentBlendMode&&(i=null),null===i?(g(f,h),p=null,m=0):i&&i.isColor&&(g(i,1),n=!0,p=null,m=0),(u.autoClear||n)&&u.clear(u.autoClearColor,u.autoClearDepth,u.autoClearStencil),i&&(i.isCubeTexture||i.isWebGLRenderTargetCube)){void 0===d&&((d=new Bn(new Kn(1,1,1),new ei({type:"BackgroundCubeMaterial",uniforms:Xn(mi.cube.uniforms),vertexShader:mi.cube.vertexShader,fragmentShader:mi.cube.fragmentShader,side:Ee,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),d.geometry.removeAttribute("uv"),d.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.tCube.value}}),l.update(d));var s=i.isWebGLRenderTargetCube?i.texture:i;d.material.uniforms.tCube.value=s,d.material.uniforms.tFlip.value=i.isWebGLRenderTargetCube?1:-1,p===i&&m===s.version||(d.material.needsUpdate=!0,p=i,m=s.version),e.unshift(d,d.geometry,d.material,0,0,null)}else i&&i.isTexture&&(void 0===c&&((c=new Bn(new _i(2,2),new ei({type:"BackgroundMaterial",uniforms:Xn(mi.background.uniforms),vertexShader:mi.background.vertexShader,fragmentShader:mi.background.fragmentShader,side:I,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),l.update(c)),!0===(c.material.uniforms.t2D.value=i).matrixAutoUpdate&&i.updateMatrix(),c.material.uniforms.uvTransform.value.copy(i.matrix),p===i&&m===i.version||(c.material.needsUpdate=!0,m=(p=i).version),e.unshift(c,c.geometry,c.material,0,0,null))}}}function Ei(o,a,s,u){var l;this.setMode=function(e){l=e},this.render=function(e,t){o.drawArrays(l,e,t),s.update(t,l)},this.renderInstances=function(e,t,r){var n,i;if(u.isWebGL2)n=o,i="drawArraysInstanced";else if(i="drawArraysInstancedANGLE",null===(n=a.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");n[i](l,t,r,e.maxInstancedCount),s.update(r,l,e.maxInstancedCount)}}function wi(t,r,e){var n;function i(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,a=void 0!==e.precision?e.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var u=!0===e.logarithmicDepthBuffer,l=t.getParameter(34930),c=t.getParameter(35660),d=t.getParameter(3379),f=t.getParameter(34076),h=t.getParameter(34921),p=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=0<c,y=o||!!r.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==n)return n;var e=r.get("EXT_texture_filter_anisotropic");return n=null!==e?t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:c,maxTextureSize:d,maxCubemapSize:f,maxAttributes:h,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function Ai(){var c=this,d=null,f=0,h=!1,p=!1,m=new li,g=new Ot,v={value:null,needsUpdate:!1};function y(){v.value!==d&&(v.value=d,v.needsUpdate=0<f),c.numPlanes=f,c.numIntersection=0}function _(e,t,r,n){var i=null!==e?e.length:0,o=null;if(0!==i){if(o=v.value,!0!==n||null===o){var a=r+4*i,s=t.matrixWorldInverse;g.getNormalMatrix(s),(null===o||o.length<a)&&(o=new Float32Array(a));for(var u=0,l=r;u!==i;++u,l+=4)m.copy(e[u]).applyMatrix4(s,g),m.normal.toArray(o,l),o[l+3]=m.constant}v.value=o,v.needsUpdate=!0}return c.numPlanes=i,o}this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){var n=0!==e.length||t||0!==f||h;return h=t,d=_(e,r,0),f=e.length,n},this.beginShadows=function(){p=!0,_(null)},this.endShadows=function(){p=!1,y()},this.setState=function(e,t,r,n,i,o){if(!h||null===e||0===e.length||p&&!r)p?_(null):y();else{var a=p?0:f,s=4*a,u=i.clippingState||null;v.value=u,u=_(e,n,s,o);for(var l=0;l!==s;++l)u[l]=d[l];i.clippingState=u,this.numIntersection=t?this.numPlanes:0,this.numPlanes+=a}}}function Ti(r){var n={};return{get:function(e){if(void 0!==n[e])return n[e];var t;switch(e){case"WEBGL_depth_texture":t=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=r.getExtension(e)}return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),n[e]=t}}}function Si(e,h,o){var a=new WeakMap,p=new WeakMap;function s(e){var t=e.target,r=a.get(t);for(var n in null!==r.index&&h.remove(r.index),r.attributes)h.remove(r.attributes[n]);t.removeEventListener("dispose",s),a.delete(t);var i=p.get(r);i&&(h.remove(i),p.delete(r)),o.memory.geometries--}function n(e){var t=[],r=e.index,n=e.attributes.position,i=0;if(null!==r){var o=r.array;i=r.version;for(var a=0,s=o.length;a<s;a+=3){var u=o[a+0],l=o[a+1],c=o[a+2];t.push(u,l,l,c,c,u)}}else{o=n.array;i=n.version;for(a=0,s=o.length/3-1;a<s;a+=3){u=a+0,l=a+1,c=a+2;t.push(u,l,l,c,c,u)}}var d=new(65535<hn(t)?ln:sn)(t,1);d.version=i,h.update(d,34963);var f=p.get(e);f&&h.remove(f),p.set(e,d)}return{get:function(e,t){var r=a.get(t);return r||(t.addEventListener("dispose",s),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new En).setFromObject(e)),r=t._bufferGeometry),a.set(t,r),o.memory.geometries++,r)},update:function(e){var t=e.index,r=e.attributes;for(var n in null!==t&&h.update(t,34963),r)h.update(r[n],34962);var i=e.morphAttributes;for(var n in i)for(var o=i[n],a=0,s=o.length;a<s;a++)h.update(o[a],34962)},getWireframeAttribute:function(e){var t=p.get(e);if(t){var r=e.index;null!==r&&t.version<r.version&&n(e)}else n(e);return p.get(e)}}}function xi(o,a,s,u){var l,c,d;this.setMode=function(e){l=e},this.setIndex=function(e){c=e.type,d=e.bytesPerElement},this.render=function(e,t){o.drawElements(l,t,c,e*d),s.update(t,l)},this.renderInstances=function(e,t,r){var n,i;if(u.isWebGL2)n=o,i="drawElementsInstanced";else if(i="drawElementsInstancedANGLE",null===(n=a.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");n[i](l,r,c,t*d,e.maxInstancedCount),s.update(r,l,e.maxInstancedCount)}}function Mi(e){var n={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:n,programs:null,autoReset:!0,reset:function(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0},update:function(e,t,r){switch(r=r||1,n.calls++,t){case 4:n.triangles+=r*(e/3);break;case 5:case 6:n.triangles+=r*(e-2);break;case 1:n.lines+=r*(e/2);break;case 3:n.lines+=r*(e-1);break;case 2:n.lines+=r*e;break;case 0:n.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function Ri(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Oi(h){var p={},m=new Float32Array(8);return{update:function(e,t,r,n){var i=e.morphTargetInfluences,o=i.length,a=p[t.id];if(void 0===a){a=[];for(var s=0;s<o;s++)a[s]=[s,0];p[t.id]=a}var u=r.morphTargets&&t.morphAttributes.position,l=r.morphNormals&&t.morphAttributes.normal;for(s=0;s<o;s++){0!==(c=a[s])[1]&&(u&&t.removeAttribute("morphTarget"+s),l&&t.removeAttribute("morphNormal"+s))}for(s=0;s<o;s++){(c=a[s])[0]=s,c[1]=i[s]}for(a.sort(Ri),s=0;s<8;s++){var c;if(c=a[s]){var d=c[0],f=c[1];if(f){u&&t.addAttribute("morphTarget"+s,u[d]),l&&t.addAttribute("morphNormal"+s,l[d]),m[s]=f;continue}}m[s]=0}n.getUniforms().setValue(h,"morphTargetInfluences",m)}}}function Pi(i,o){var a={};return{update:function(e){var t=o.render.frame,r=e.geometry,n=i.get(e,r);return a[n.id]!==t&&(r.isGeometry&&n.updateFromObject(e),i.update(n),a[n.id]=t),n},dispose:function(){a={}}}}function Ci(e,t,r,n,i,o,a,s,u,l){Dt.call(this,e=void 0!==e?e:[],t=void 0!==t?t:de,r,n,i,o,a=void 0!==a?a:Pe,s,u,l),this.flipY=!1}function Di(e,t,r,n){Dt.call(this,null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=ye,this.minFilter=ye,this.wrapR=L,this.generateMipmaps=!1,this.flipY=!1}function Ii(e,t,r,n){Dt.call(this,null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=ye,this.minFilter=ye,this.wrapR=L,this.generateMipmaps=!1,this.flipY=!1}mi.physical={uniforms:Qn([mi.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new Yr(0)},clearcoatNormalScale:{value:new wt(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:hi.meshphysical_vert,fragmentShader:hi.meshphysical_frag},(yi.prototype=Object.create(qn.prototype)).constructor=yi,(_i.prototype=Object.create(En.prototype)).constructor=_i,((Ci.prototype=Object.create(Dt.prototype)).constructor=Ci).prototype.isCubeTexture=!0,Object.defineProperty(Ci.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),((Di.prototype=Object.create(Dt.prototype)).constructor=Di).prototype.isDataTexture2DArray=!0,((Ii.prototype=Object.create(Dt.prototype)).constructor=Ii).prototype.isDataTexture3D=!0;var Li=new Dt,Ni=new Di,ki=new Ii,Fi=new Ci,ji=[],Bi=[],Ui=new Float32Array(16),Gi=new Float32Array(9),Hi=new Float32Array(4);function Vi(e,t,r){var n=e[0];if(n<=0||0<n)return e;var i=t*r,o=ji[i];if(void 0===o&&(o=new Float32Array(i),ji[i]=o),0!==t){n.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=r,e[a].toArray(o,s)}return o}function zi(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Wi(e,t){for(var r=0,n=t.length;r<n;r++)e[r]=t[r]}function qi(e,t){var r=Bi[t];void 0===r&&(r=new Int32Array(t),Bi[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function Yi(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function Ki(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(zi(r,t))return;e.uniform2fv(this.addr,t),Wi(r,t)}}function Xi(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(zi(r,t))return;e.uniform3fv(this.addr,t),Wi(r,t)}}function Qi(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(zi(r,t))return;e.uniform4fv(this.addr,t),Wi(r,t)}}function Ji(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(zi(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Wi(r,t)}else{if(zi(r,n))return;Hi.set(n),e.uniformMatrix2fv(this.addr,!1,Hi),Wi(r,n)}}function Zi(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(zi(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Wi(r,t)}else{if(zi(r,n))return;Gi.set(n),e.uniformMatrix3fv(this.addr,!1,Gi),Wi(r,n)}}function $i(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(zi(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Wi(r,t)}else{if(zi(r,n))return;Ui.set(n),e.uniformMatrix4fv(this.addr,!1,Ui),Wi(r,n)}}function eo(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(t||Li,i)}function to(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||Ni,i)}function ro(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||ki,i)}function no(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(t||Fi,i)}function io(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function oo(e,t){var r=this.cache;zi(r,t)||(e.uniform2iv(this.addr,t),Wi(r,t))}function ao(e,t){var r=this.cache;zi(r,t)||(e.uniform3iv(this.addr,t),Wi(r,t))}function so(e,t){var r=this.cache;zi(r,t)||(e.uniform4iv(this.addr,t),Wi(r,t))}function uo(e,t){e.uniform1fv(this.addr,t)}function lo(e,t){e.uniform1iv(this.addr,t)}function co(e,t){e.uniform2iv(this.addr,t)}function fo(e,t){e.uniform3iv(this.addr,t)}function ho(e,t){e.uniform4iv(this.addr,t)}function po(e,t){var r=Vi(t,this.size,2);e.uniform2fv(this.addr,r)}function mo(e,t){var r=Vi(t,this.size,3);e.uniform3fv(this.addr,r)}function go(e,t){var r=Vi(t,this.size,4);e.uniform4fv(this.addr,r)}function vo(e,t){var r=Vi(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function yo(e,t){var r=Vi(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function _o(e,t){var r=Vi(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function bo(e,t,r){var n=t.length,i=qi(r,n);e.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.safeSetTexture2D(t[o]||Li,i[o])}function Eo(e,t,r){var n=t.length,i=qi(r,n);e.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.safeSetTextureCube(t[o]||Fi,i[o])}function wo(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Yi;case 35664:return Ki;case 35665:return Xi;case 35666:return Qi;case 35674:return Ji;case 35675:return Zi;case 35676:return $i;case 35678:case 36198:return eo;case 35679:return ro;case 35680:return no;case 36289:return to;case 5124:case 35670:return io;case 35667:case 35671:return oo;case 35668:case 35672:return ao;case 35669:case 35673:return so}}(t.type)}function Ao(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return uo;case 35664:return po;case 35665:return mo;case 35666:return go;case 35674:return vo;case 35675:return yo;case 35676:return _o;case 35678:return bo;case 35680:return Eo;case 5124:case 35670:return lo;case 35667:case 35671:return co;case 35668:case 35672:return fo;case 35669:case 35673:return ho}}(t.type)}function To(e){this.id=e,this.seq=[],this.map={}}Ao.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Wi(t,e)},To.prototype.setValue=function(e,t,r){for(var n=this.seq,i=0,o=n.length;i!==o;++i){var a=n[i];a.setValue(e,t[a.id],r)}};var So=/([\w\d_]+)(\])?(\[|\.)?/g;function xo(e,t){e.seq.push(t),e.map[t.id]=t}function Mo(e,t,r){var n=e.name,i=n.length;for(So.lastIndex=0;;){var o=So.exec(n),a=So.lastIndex,s=o[1],u="]"===o[2],l=o[3];if(u&&(s|=0),void 0===l||"["===l&&a+2===i){xo(r,void 0===l?new wo(s,e,t):new Ao(s,e,t));break}var c=r.map[s];void 0===c&&xo(r,c=new To(s)),r=c}}function Ro(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,35718),n=0;n<r;++n){var i=e.getActiveUniform(t,n);Mo(i,e.getUniformLocation(t,i.name),this)}}function Oo(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}Ro.prototype.setValue=function(e,t,r,n){var i=this.map[t];void 0!==i&&i.setValue(e,r,n)},Ro.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},Ro.upload=function(e,t,r,n){for(var i=0,o=t.length;i!==o;++i){var a=t[i],s=r[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}},Ro.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var o=e[n];o.id in t&&r.push(o)}return r};var Po=0;function Co(e){switch(e){case at:return["Linear","( value )"];case n:return["sRGB","( value )"];case ut:return["RGBE","( value )"];case ct:return["RGBM","( value, 7.0 )"];case dt:return["RGBM","( value, 16.0 )"];case ft:return["RGBD","( value, 256.0 )"];case st:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case lt:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Do(e,t,r){var n=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return n&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(e.getShaderSource(t))}function Io(e,t){var r=Co(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Lo(e){return""!==e}function No(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ko(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function Fo(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){var r=hi[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return Fo(r)})}function jo(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,r,n){for(var i="",o=parseInt(t);o<parseInt(r);o++)i+=n.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i})}function Bo(e,t,r,n,i,o,a){var s=e.getContext(),u=n.defines,l=i.vertexShader,c=i.fragmentShader,d="SHADOWMAP_TYPE_BASIC";o.shadowMapType===N?d="SHADOWMAP_TYPE_PCF":o.shadowMapType===k?d="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===F&&(d="SHADOWMAP_TYPE_VSM");var f="ENVMAP_TYPE_CUBE",h="ENVMAP_MODE_REFLECTION",p="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case de:case fe:f="ENVMAP_TYPE_CUBE";break;case ge:case ve:f="ENVMAP_TYPE_CUBE_UV";break;case he:case pe:f="ENVMAP_TYPE_EQUIREC";break;case me:f="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case fe:case pe:h="ENVMAP_MODE_REFRACTION"}switch(n.combine){case j:p="ENVMAP_BLENDING_MULTIPLY";break;case B:p="ENVMAP_BLENDING_MIX";break;case U:p="ENVMAP_BLENDING_ADD"}}var m,g,v=0<e.gammaFactor?e.gammaFactor:1,y=a.isWebGL2?"":function(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Lo).join("\n")}(n.extensions,o,t),_=function(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(u),b=s.createProgram();if(n.isRawShaderMaterial?(0<(m=[_].filter(Lo).join("\n")).length&&(m+="\n"),0<(g=[y,_].filter(Lo).join("\n")).length&&(g+="\n")):(m=["precision "+o.precision+" float;","precision "+o.precision+" int;","highp"===o.precision?"#define HIGH_PRECISION":"","#define SHADER_NAME "+i.name,_,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+h:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+d:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Lo).join("\n"),g=[y,"precision "+o.precision+" float;","precision "+o.precision+" int;","highp"===o.precision?"#define HIGH_PRECISION":"","#define SHADER_NAME "+i.name,_,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+f:"",o.envMap?"#define "+h:"",o.envMap?"#define "+p:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.sheen?"#define USE_SHEEN":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+d:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensions&&n.extensions.shaderTextureLOD||o.envMap)&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==G?"#define TONE_MAPPING":"",o.toneMapping!==G?hi.tonemapping_pars_fragment:"",o.toneMapping!==G?function(e,t){var r;switch(t){case we:r="Linear";break;case H:r="Reinhard";break;case V:r="Uncharted2";break;case z:r="OptimizedCineon";break;case W:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?hi.encodings_pars_fragment:"",o.mapEncoding?Io("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?Io("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?Io("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Io("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?function(e,t){var r=Co(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Lo).join("\n")),l=ko(l=No(l=Fo(l),o),o),c=ko(c=No(c=Fo(c),o),o),l=jo(l),c=jo(c),a.isWebGL2&&!n.isRawShaderMaterial){var E=!1,w=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==l.match(w)&&null!==c.match(w)&&(E=!0,l=l.replace(w,""),c=c.replace(w,"")),m=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#version 300 es\n","#define varying in",E?"":"out highp vec4 pc_fragColor;",E?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g}var A,T,S=g+c,x=Oo(s,35633,m+l),M=Oo(s,35632,S);if(s.attachShader(b,x),s.attachShader(b,M),void 0!==n.index0AttributeName?s.bindAttribLocation(b,0,n.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b),e.debug.checkShaderErrors){var R=s.getProgramInfoLog(b).trim(),O=s.getShaderInfoLog(x).trim(),P=s.getShaderInfoLog(M).trim(),C=!0,D=!0;if(!1===s.getProgramParameter(b,35714)){C=!1;var I=Do(s,x,"vertex"),L=Do(s,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(b,35715),"gl.getProgramInfoLog",R,I,L)}else""!==R?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",R):""!==O&&""!==P||(D=!1);D&&(this.diagnostics={runnable:C,material:n,programLog:R,vertexShader:{log:O,prefix:m},fragmentShader:{log:P,prefix:g}})}return s.deleteShader(x),s.deleteShader(M),this.getUniforms=function(){return void 0===A&&(A=new Ro(s,b)),A},this.getAttributes=function(){return void 0===T&&(T=function(e,t){for(var r={},n=e.getProgramParameter(t,35721),i=0;i<n;i++){var o=e.getActiveAttrib(t,i).name;r[o]=e.getAttribLocation(t,o)}return r}(s,b)),T},this.destroy=function(){s.deleteProgram(b),this.program=void 0},this.name=i.name,this.id=Po++,this.code=r,this.usedTimes=1,this.program=b,this.vertexShader=x,this.fragmentShader=M,this}function Uo(d,u,f){var l=[],h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},o=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function p(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=at,r===at&&t&&(r=st),r}this.getParameters=function(e,t,r,n,i,o,a){var s=h[e.type],u=a.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(f.floatVertexTextures)return 1024;var r=f.maxVertexUniforms,n=Math.floor((r-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(a):0,l=f.precision;null!==e.precision&&(l=f.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",l,"instead.");var c=d.getRenderTarget();return{shaderID:s,precision:l,supportsVertexTextures:f.vertexTextures,outputEncoding:p(c?c.texture:null,d.gammaOutput),map:!!e.map,mapEncoding:p(e.map,d.gammaInput),matcap:!!e.matcap,matcapEncoding:p(e.matcap,d.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:p(e.envMap,d.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===ge||e.envMap.mapping===ve),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:p(e.emissiveMap,d.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===gt,tangentSpaceNormalMap:e.normalMapType===mt,clearcoatNormalMap:!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,sheen:!!e.sheen,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap),fog:!!n,useFog:e.fog,fogExp2:n&&n.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:f.logarithmicDepthBuffer,skinning:e.skinning&&0<u,maxBones:u,useVertexTexture:f.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:d.maxMorphTargets,maxMorphNormals:d.maxMorphNormals,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numClippingPlanes:i,numClipIntersection:o,dithering:e.dithering,shadowMapEnabled:d.shadowMap.enabled&&a.receiveShadow&&0<r.length,shadowMapType:d.shadowMap.type,toneMapping:e.toneMapped?d.toneMapping:G,physicallyCorrectLights:d.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===X,flipSided:e.side===Ee,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)r.push(n),r.push(e.defines[n]);for(var i=0;i<o.length;i++)r.push(t[o[i]]);return r.push(e.onBeforeCompile.toString()),r.push(d.gammaOutput),r.push(d.gammaFactor),r.join()},this.acquireProgram=function(e,t,r,n){for(var i,o=0,a=l.length;o<a;o++){var s=l[o];if(s.code===n){++(i=s).usedTimes;break}}return void 0===i&&(i=new Bo(d,u,n,e,t,r,f),l.push(i)),i},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},this.programs=l}function Go(){var n=new WeakMap;return{get:function(e){var t=n.get(e);return void 0===t&&(t={},n.set(e,t)),t},remove:function(e){n.delete(e)},update:function(e,t,r){n.get(e)[t]=r},dispose:function(){n=new WeakMap}}}function Ho(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Vo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function zo(){var s=[],u=0,l=[],c=[],d={id:-1};function f(e,t,r,n,i,o){var a=s[u];return void 0===a?(a={id:e.id,object:e,geometry:t,material:r,program:r.program||d,groupOrder:n,renderOrder:e.renderOrder,z:i,group:o},s[u]=a):(a.id=e.id,a.object=e,a.geometry=t,a.material=r,a.program=r.program||d,a.groupOrder=n,a.renderOrder=e.renderOrder,a.z=i,a.group=o),u++,a}return{opaque:l,transparent:c,init:function(){u=0,l.length=0,c.length=0},push:function(e,t,r,n,i,o){var a=f(e,t,r,n,i,o);(!0===r.transparent?c:l).push(a)},unshift:function(e,t,r,n,i,o){var a=f(e,t,r,n,i,o);(!0===r.transparent?c:l).unshift(a)},sort:function(){1<l.length&&l.sort(Ho),1<c.length&&c.sort(Vo)}}}function Wo(){var i=new WeakMap;function o(e){var t=e.target;t.removeEventListener("dispose",o),i.delete(t)}return{get:function(e,t){var r,n=i.get(e);return void 0===n?(r=new zo,i.set(e,new WeakMap),i.get(e).set(t,r),e.addEventListener("dispose",o)):void 0===(r=n.get(t))&&(r=new zo,n.set(t,r)),r},dispose:function(){i=new WeakMap}}}function qo(){var r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];var t;switch(e.type){case"DirectionalLight":t={direction:new xt,color:new Yr,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new wt};break;case"SpotLight":t={position:new xt,direction:new xt,color:new Yr,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new wt};break;case"PointLight":t={position:new xt,color:new Yr,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new wt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":t={direction:new xt,skyColor:new Yr,groundColor:new Yr};break;case"RectAreaLight":t={color:new Yr,position:new xt,halfWidth:new xt,halfHeight:new xt}}return r[e.id]=t}}}var Yo=0;function Ko(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Xo(){for(var x=new qo,M={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},e=0;e<9;e++)M.probe.push(new xt);var R=new xt,O=new Vt,P=new Vt;return{setup:function(e,t,r){for(var n=0,i=0,o=0,a=0;a<9;a++)M.probe[a].set(0,0,0);var s=0,u=0,l=0,c=0,d=0,f=0,h=0,p=0,m=r.matrixWorldInverse;e.sort(Ko),a=0;for(var g=e.length;a<g;a++){var v=e[a],y=v.color,_=v.intensity,b=v.distance,E=v.shadow&&v.shadow.map?v.shadow.map.texture:null;if(v.isAmbientLight)n+=y.r*_,i+=y.g*_,o+=y.b*_;else if(v.isLightProbe)for(var w=0;w<9;w++)M.probe[w].addScaledVector(v.sh.coefficients[w],_);else if(v.isDirectionalLight){if((T=x.get(v)).color.copy(v.color).multiplyScalar(v.intensity),T.direction.setFromMatrixPosition(v.matrixWorld),R.setFromMatrixPosition(v.target.matrixWorld),T.direction.sub(R),T.direction.transformDirection(m),T.shadow=v.castShadow,v.castShadow){var A=v.shadow;T.shadowBias=A.bias,T.shadowRadius=A.radius,T.shadowMapSize=A.mapSize,M.directionalShadowMap[s]=E,M.directionalShadowMatrix[s]=v.shadow.matrix,f++}M.directional[s]=T,s++}else if(v.isSpotLight){if((T=x.get(v)).position.setFromMatrixPosition(v.matrixWorld),T.position.applyMatrix4(m),T.color.copy(y).multiplyScalar(_),T.distance=b,T.direction.setFromMatrixPosition(v.matrixWorld),R.setFromMatrixPosition(v.target.matrixWorld),T.direction.sub(R),T.direction.transformDirection(m),T.coneCos=Math.cos(v.angle),T.penumbraCos=Math.cos(v.angle*(1-v.penumbra)),T.decay=v.decay,T.shadow=v.castShadow,v.castShadow){A=v.shadow;T.shadowBias=A.bias,T.shadowRadius=A.radius,T.shadowMapSize=A.mapSize,M.spotShadowMap[l]=E,M.spotShadowMatrix[l]=v.shadow.matrix,p++}M.spot[l]=T,l++}else if(v.isRectAreaLight){(T=x.get(v)).color.copy(y).multiplyScalar(_),T.position.setFromMatrixPosition(v.matrixWorld),T.position.applyMatrix4(m),P.identity(),O.copy(v.matrixWorld),O.premultiply(m),P.extractRotation(O),T.halfWidth.set(.5*v.width,0,0),T.halfHeight.set(0,.5*v.height,0),T.halfWidth.applyMatrix4(P),T.halfHeight.applyMatrix4(P),M.rectArea[c]=T,c++}else if(v.isPointLight){if((T=x.get(v)).position.setFromMatrixPosition(v.matrixWorld),T.position.applyMatrix4(m),T.color.copy(v.color).multiplyScalar(v.intensity),T.distance=v.distance,T.decay=v.decay,T.shadow=v.castShadow,v.castShadow){A=v.shadow;T.shadowBias=A.bias,T.shadowRadius=A.radius,T.shadowMapSize=A.mapSize,T.shadowCameraNear=A.camera.near,T.shadowCameraFar=A.camera.far,M.pointShadowMap[u]=E,M.pointShadowMatrix[u]=v.shadow.matrix,h++}M.point[u]=T,u++}else if(v.isHemisphereLight){var T;(T=x.get(v)).direction.setFromMatrixPosition(v.matrixWorld),T.direction.transformDirection(m),T.direction.normalize(),T.skyColor.copy(v.color).multiplyScalar(_),T.groundColor.copy(v.groundColor).multiplyScalar(_),M.hemi[d]=T,d++}}M.ambient[0]=n,M.ambient[1]=i,M.ambient[2]=o;var S=M.hash;S.directionalLength===s&&S.pointLength===u&&S.spotLength===l&&S.rectAreaLength===c&&S.hemiLength===d&&S.numDirectionalShadows===f&&S.numPointShadows===h&&S.numSpotShadows===p||(M.directional.length=s,M.spot.length=l,M.rectArea.length=c,M.point.length=u,M.hemi.length=d,M.directionalShadowMap.length=f,M.pointShadowMap.length=h,M.spotShadowMap.length=p,M.directionalShadowMatrix.length=f,M.pointShadowMatrix.length=h,M.spotShadowMatrix.length=p,S.directionalLength=s,S.pointLength=u,S.spotLength=l,S.rectAreaLength=c,S.hemiLength=d,S.numDirectionalShadows=f,S.numPointShadows=h,S.numSpotShadows=p,M.version=Yo++)},state:M}}function Qo(){var t=new Xo,r=[],n=[];return{init:function(){r.length=0,n.length=0},state:{lightsArray:r,shadowsArray:n,lights:t},setupLights:function(e){t.setup(r,n,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){n.push(e)}}}function Jo(){var n=new WeakMap;function i(e){var t=e.target;t.removeEventListener("dispose",i),n.delete(t)}return{get:function(e,t){var r;return!1===n.has(e)?(r=new Qo,n.set(e,new WeakMap),n.get(e).set(t,r),e.addEventListener("dispose",i)):!1===n.get(e).has(t)?(r=new Qo,n.get(e).set(t,r)):r=n.get(e).get(t),r},dispose:function(){n=new WeakMap}}}function Zo(e){$r.call(this),this.type="MeshDepthMaterial",this.depthPacking=ht,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function $o(e){$r.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new xt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}((Zo.prototype=Object.create($r.prototype)).constructor=Zo).prototype.isMeshDepthMaterial=!0,Zo.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},(($o.prototype=Object.create($r.prototype)).constructor=$o).prototype.isMeshDistanceMaterial=!0,$o.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var ea="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n  \n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = decodeHalfRGBA ( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = pow( squared_mean - mean * mean, 0.5 );\n  gl_FragColor = encodeHalfRGBA( vec2( mean, std_dev ) );\n}",ta="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function ra(v,g,y){var _=new fi,b=new wt,E=new wt,w=new It,A=1,T=2,e=1+(A|T),S=new Array(e),x=new Array(e),M={},R={0:Ee,1:I,2:X},n=new ei({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new wt},radius:{value:4}},vertexShader:ta,fragmentShader:ea}),i=n.clone();i.defines.HORIZONAL_PASS=1;var t=new En;t.addAttribute("position",new tn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));for(var o=new Bn(t,n),r=0;r!==e;++r){var a=0!=(r&A),s=0!=(r&T),u=new Zo({depthPacking:pt,morphTargets:a,skinning:s});S[r]=u;var l=new $o({morphTargets:a,skinning:s});x[r]=l}var O=this;function P(e,t){var r=g.update(o);n.uniforms.shadow_pass.value=e.map.texture,n.uniforms.resolution.value=e.mapSize,n.uniforms.radius.value=e.radius,v.setRenderTarget(e.mapPass),v.clear(),v.renderBufferDirect(t,null,r,n,o,null),i.uniforms.shadow_pass.value=e.mapPass.texture,i.uniforms.resolution.value=e.mapSize,i.uniforms.radius.value=e.radius,v.setRenderTarget(e.map),v.clear(),v.renderBufferDirect(t,null,r,i,o,null)}function C(e,t,r,n,i,o){var a=e.geometry,s=null,u=S,l=e.customDepthMaterial;if(r.isPointLight&&(u=x,l=e.customDistanceMaterial),l)s=l;else{var c=!1;t.morphTargets&&(a&&a.isBufferGeometry?c=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:a&&a.isGeometry&&(c=a.morphTargets&&0<a.morphTargets.length)),e.isSkinnedMesh&&!1===t.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var d=e.isSkinnedMesh&&t.skinning,f=0;c&&(f|=A),d&&(f|=T),s=u[f]}if(v.localClippingEnabled&&!0===t.clipShadows&&0!==t.clippingPlanes.length){var h=s.uuid,p=t.uuid,m=M[h];void 0===m&&(m={},M[h]=m);var g=m[p];void 0===g&&(g=s.clone(),m[p]=g),s=g}return s.visible=t.visible,s.wireframe=t.wireframe,s.side=o===F?null!=t.shadowSide?t.shadowSide:t.side:null!=t.shadowSide?t.shadowSide:R[t.side],s.clipShadows=t.clipShadows,s.clippingPlanes=t.clippingPlanes,s.clipIntersection=t.clipIntersection,s.wireframeLinewidth=t.wireframeLinewidth,s.linewidth=t.linewidth,r.isPointLight&&s.isMeshDistanceMaterial&&(s.referencePosition.setFromMatrixPosition(r.matrixWorld),s.nearDistance=n,s.farDistance=i),s}function D(e,t,r,n,i){if(!1!==e.visible){if(e.layers.test(t.layers)&&(e.isMesh||e.isLine||e.isPoints)&&(e.castShadow||e.receiveShadow&&i===F)&&(!e.frustumCulled||_.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld);var o=g.update(e),a=e.material;if(Array.isArray(a))for(var s=o.groups,u=0,l=s.length;u<l;u++){var c=s[u],d=a[c.materialIndex];if(d&&d.visible){var f=C(e,d,n,r.near,r.far,i);v.renderBufferDirect(r,null,o,f,e,c)}}else if(a.visible){f=C(e,a,n,r.near,r.far,i);v.renderBufferDirect(r,null,o,f,e,null)}}for(var h=e.children,p=0,m=h.length;p<m;p++)D(h[p],t,r,n,i)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=N,this.render=function(e,t,r){if(!1!==O.enabled&&(!1!==O.autoUpdate||!1!==O.needsUpdate)&&0!==e.length){var n=v.getRenderTarget(),i=v.getActiveCubeFace(),o=v.getActiveMipmapLevel(),a=v.state;a.setBlending(Q),a.buffers.color.setClear(1,1,1,1),a.buffers.depth.setTest(!0),a.setScissorTest(!1);for(var s=0,u=e.length;s<u;s++){var l=e[s],c=l.shadow;if(void 0!==c){b.copy(c.mapSize);var d=c.getFrameExtents();if(b.multiply(d),E.copy(c.mapSize),(b.x>y||b.y>y)&&(console.warn("THREE.WebGLShadowMap:",l,"has shadow exceeding max texture size, reducing"),b.x>y&&(E.x=Math.floor(y/d.x),b.x=E.x*d.x,c.mapSize.x=E.x),b.y>y&&(E.y=Math.floor(y/d.y),b.y=E.y*d.y,c.mapSize.y=E.y)),null===c.map&&!c.isPointLightShadow&&this.type===F){var f={minFilter:Ae,magFilter:Ae,format:Ce};c.map=new Lt(b.x,b.y,f),c.map.texture.name=l.name+".shadowMap",c.mapPass=new Lt(b.x,b.y,f),c.camera.updateProjectionMatrix()}if(null===c.map){f={minFilter:ye,magFilter:ye,format:Ce};c.map=new Lt(b.x,b.y,f),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}v.setRenderTarget(c.map),v.clear();for(var h=c.getViewportCount(),p=0;p<h;p++){var m=c.getViewport(p);w.set(E.x*m.x,E.y*m.y,E.x*m.z,E.y*m.w),a.viewport(w),c.updateMatrices(l,r,p),_=c.getFrustum(),D(t,r,c.camera,l,this.type)}c.isPointLightShadow||this.type!==F||P(c,r)}else console.warn("THREE.WebGLShadowMap:",l,"has no shadow.")}O.needsUpdate=!1,v.setRenderTarget(n,i,o)}}}function na(c,r,u,n){var i=new function(){var t=!1,o=new It,r=null,a=new It(0,0,0,0);return{setMask:function(e){r===e||t||(c.colorMask(e,e,e,e),r=e)},setLocked:function(e){t=e},setClear:function(e,t,r,n,i){!0===i&&(e*=n,t*=n,r*=n),o.set(e,t,r,n),!1===a.equals(o)&&(c.clearColor(e,t,r,n),a.copy(o))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},o=new function(){var t=!1,r=null,n=null,i=null;return{overrideDepthFunc:null,overrideDepthTest:null,overrideDepthMask:null,setTest:function(e){null!==this.overrideDepthTest&&(e=this.overrideDepthTest),e?B(2929):U(2929)},setMask:function(e){null!==this.overrideDepthMask&&(e=this.overrideDepthMask),r===e||t||(c.depthMask(e),r=e)},setFunc:function(e){if(null!==this.overrideDepthFunc&&(e=this.overrideDepthFunc),n!==e){if(e)switch(e){case ne:c.depthFunc(512);break;case ie:c.depthFunc(519);break;case oe:c.depthFunc(513);break;case ae:c.depthFunc(515);break;case se:c.depthFunc(514);break;case ue:c.depthFunc(518);break;case le:c.depthFunc(516);break;case ce:c.depthFunc(517);break;default:c.depthFunc(515)}else c.depthFunc(515);n=e}},setLocked:function(e){t=e},setClear:function(e){i!==e&&(c.clearDepth(e),i=e)},reset:function(){t=!1,i=n=r=null}}},a=new function(){var t=!1,r=null,n=null,i=null,o=null,a=null,s=null,u=null,l=null;return{setTest:function(e){t||(e?B(2960):U(2960))},setMask:function(e){r===e||t||(c.stencilMask(e),r=e)},setFunc:function(e,t,r){n===e&&i===t&&o===r||(c.stencilFunc(e,t,r),n=e,i=t,o=r)},setOp:function(e,t,r){a===e&&s===t&&u===r||(c.stencilOp(e,t,r),a=e,s=t,u=r)},setLocked:function(e){t=e},setClear:function(e){l!==e&&(c.clearStencil(e),l=e)},reset:function(){t=!1,l=u=s=a=o=i=n=r=null}}},e=c.getParameter(34921),s=new Uint8Array(e),l=new Uint8Array(e),d=new Uint8Array(e),t={},f=null,h=null,p=null,m=null,g=null,v=null,y=null,_=null,b=null,E=null,w=!1,A=null,T=null,S=null,x=null,M=null,R=c.getParameter(35661),O=!1,P=0,C=c.getParameter(7938);-1!==C.indexOf("WebGL")?(P=parseFloat(/^WebGL\ ([0-9])/.exec(C)[1]),O=1<=P):-1!==C.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(C)[1]),O=2<=P);var D=null,I={},L=new It,N=new It;function k(e,t,r){var n=new Uint8Array(4),i=c.createTexture();c.bindTexture(e,i),c.texParameteri(e,10241,9728),c.texParameteri(e,10240,9728);for(var o=0;o<r;o++)c.texImage2D(t+o,0,6408,1,1,0,6408,5121,n);return i}var F={};function j(e,t){s[e]=1,0===l[e]&&(c.enableVertexAttribArray(e),l[e]=1),d[e]!==t&&((n.isWebGL2?c:r.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),d[e]=t)}function B(e){!0!==t[e]&&(c.enable(e),t[e]=!0)}function U(e){!1!==t[e]&&(c.disable(e),t[e]=!1)}function G(e,t,r,n,i,o,a,s){if(e!==Q){if(p||(B(3042),p=!0),e===te)i=i||t,o=o||r,a=a||n,t===g&&i===_||(c.blendEquationSeparate(u.convert(t),u.convert(i)),g=t,_=i),r===v&&n===y&&o===b&&a===E||(c.blendFuncSeparate(u.convert(r),u.convert(n),u.convert(o),u.convert(a)),v=r,y=n,b=o,E=a),m=e,w=null;else if(e!==m||s!==w){if(g===re&&_===re||(c.blendEquation(32774),_=g=re),s)switch(e){case J:c.blendFuncSeparate(1,771,1,771);break;case Z:c.blendFunc(1,1);break;case $:c.blendFuncSeparate(0,0,769,771);break;case ee:c.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case J:c.blendFuncSeparate(770,771,1,771);break;case Z:c.blendFunc(770,1);break;case $:c.blendFunc(0,769);break;case ee:c.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}E=b=y=v=null,m=e,w=s}}else p&&(U(3042),p=!1)}function H(e){A!==e&&(e?c.frontFace(2304):c.frontFace(2305),A=e)}function V(e){e!==q?(B(2884),e!==T&&(e===Y?c.cullFace(1029):e===K?c.cullFace(1028):c.cullFace(1032))):U(2884),T=e}function z(e,t,r){e?(B(32823),x===t&&M===r||(c.polygonOffset(t,r),x=t,M=r)):U(32823)}function W(e){void 0===e&&(e=33984+R-1),D!==e&&(c.activeTexture(e),D=e)}return F[3553]=k(3553,3553,1),F[34067]=k(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),a.setClear(0),B(2929),o.setFunc(ae),H(!1),V(Y),B(2884),G(Q),{buffers:{color:i,depth:o,stencil:a},initAttributes:function(){for(var e=0,t=s.length;e<t;e++)s[e]=0},enableAttribute:function(e){j(e,0)},enableAttributeAndDivisor:j,disableUnusedAttributes:function(){for(var e=0,t=l.length;e!==t;++e)l[e]!==s[e]&&(c.disableVertexAttribArray(e),l[e]=0)},enable:B,disable:U,getCompressedTextureFormats:function(){if(null===f&&(f=[],r.get("WEBGL_compressed_texture_pvrtc")||r.get("WEBGL_compressed_texture_s3tc")||r.get("WEBGL_compressed_texture_etc1")||r.get("WEBGL_compressed_texture_astc")))for(var e=c.getParameter(34467),t=0;t<e.length;t++)f.push(e[t]);return f},useProgram:function(e){return h!==e&&(c.useProgram(e),h=e,!0)},setBlending:G,setMaterial:function(e,t){e.side===X?U(2884):B(2884);var r=e.side===Ee;t&&(r=!r),H(r),e.blending===J&&!1===e.transparent?G(Q):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);var n=e.stencilWrite;a.setTest(n),n&&(a.setFunc(e.stencilFunc,e.stencilRef,e.stencilMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:H,setCullFace:V,setLineWidth:function(e){e!==S&&(O&&c.lineWidth(e),S=e)},setPolygonOffset:z,setScissorTest:function(e){e?B(3089):U(3089)},activeTexture:W,bindTexture:function(e,t){null===D&&W();var r=I[D];void 0===r&&(r={type:void 0,texture:void 0},I[D]=r),r.type===e&&r.texture===t||(c.bindTexture(e,t||F[e]),r.type=e,r.texture=t)},compressedTexImage2D:function(){try{c.compressedTexImage2D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{c.texImage2D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{c.texImage3D.apply(c,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===L.equals(e)&&(c.scissor(e.x,e.y,e.z,e.w),L.copy(e))},viewport:function(e){!1===N.equals(e)&&(c.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){for(var e=0;e<l.length;e++)1===l[e]&&(c.disableVertexAttribArray(e),l[e]=0);t={},I={},T=A=m=h=D=f=null,i.reset(),o.reset(),a.reset()}}}function ia(g,i,v,y,_,b,l){var c,o=new WeakMap,r="undefined"!=typeof OffscreenCanvas;function d(e,t){return r?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function E(e,t,r,n){var i=1;if((e.width>n||e.height>n)&&(i=n/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?Et.floorPowerOfTwo:Math.floor,a=o(i*e.width),s=o(i*e.height);void 0===c&&(c=d(a,s));var u=r?d(a,s):c;return u.width=a,u.height=s,u.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function w(e){return Et.isPowerOfTwo(e.width)&&Et.isPowerOfTwo(e.height)}function A(e,t){return e.generateMipmaps&&t&&e.minFilter!==ye&&e.minFilter!==Ae}function T(e,t,r,n){g.generateMipmap(e),y.get(t).__maxMipLevel=Math.log(Math.max(r,n))*Math.LOG2E}function S(e,t){if(!_.isWebGL2)return e;var r=e;return 6403===e&&(5126===t&&(r=33326),5131===t&&(r=33325),5121===t&&(r=33321)),6407===e&&(5126===t&&(r=34837),5131===t&&(r=34843),5121===t&&(r=32849)),6408===e&&(5126===t&&(r=34836),5131===t&&(r=34842),5121===t&&(r=32856)),33325===r||33326===r||34842===r||34836===r?i.get("EXT_color_buffer_float"):34843!==r&&34837!==r||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),r}function a(e){return e===ye||e===_e||e===be?9728:9729}function n(e){var t=e.target;t.removeEventListener("dispose",n),function(e){var t=y.get(e);if(void 0===t.__webglInit)return;g.deleteTexture(t.__webglTexture),y.remove(e)}(t),t.isVideoTexture&&o.delete(t),l.memory.textures--}function f(e){var t=e.target;t.removeEventListener("dispose",f),function(e){var t=y.get(e),r=y.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&g.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var n=0;n<6;n++)g.deleteFramebuffer(t.__webglFramebuffer[n]),t.__webglDepthbuffer&&g.deleteRenderbuffer(t.__webglDepthbuffer[n]);else g.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&g.deleteRenderbuffer(t.__webglDepthbuffer);y.remove(e.texture),y.remove(e)}(t),l.memory.textures--}var t=0;function s(e,t){var r=y.get(e);if(e.isVideoTexture&&function(e){var t=l.render.frame;o.get(e)!==t&&(o.set(e,t),e.update())}(e),0<e.version&&r.__version!==e.version){var n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void p(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}v.activeTexture(33984+t),v.bindTexture(3553,r.__webglTexture)}function u(e,t){if(6===e.image.length){var r=y.get(e);if(0<e.version&&r.__version!==e.version){M(r,e),v.activeTexture(33984+t),v.bindTexture(34067,r.__webglTexture),g.pixelStorei(37440,e.flipY);for(var n=e&&e.isCompressedTexture,i=e.image[0]&&e.image[0].isDataTexture,o=[],a=0;a<6;a++)o[a]=n||i?i?e.image[a].image:e.image[a]:E(e.image[a],!1,!0,_.maxCubemapSize);var s,u=o[0],l=w(u)||_.isWebGL2,c=b.convert(e.format),d=b.convert(e.type),f=S(c,d);if(x(34067,e,l),n){for(a=0;a<6;a++){s=o[a].mipmaps;for(var h=0;h<s.length;h++){var p=s[h];e.format!==Ce&&e.format!==Pe?-1<v.getCompressedTextureFormats().indexOf(c)?v.compressedTexImage2D(34069+a,h,f,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v.texImage2D(34069+a,h,f,p.width,p.height,0,c,d,p.data)}}r.__maxMipLevel=s.length-1}else{s=e.mipmaps;for(a=0;a<6;a++)if(i){v.texImage2D(34069+a,0,f,o[a].width,o[a].height,0,c,d,o[a].data);for(h=0;h<s.length;h++){var m=(p=s[h]).image[a].image;v.texImage2D(34069+a,h+1,f,m.width,m.height,0,c,d,m.data)}}else{v.texImage2D(34069+a,0,f,c,d,o[a]);for(h=0;h<s.length;h++){p=s[h];v.texImage2D(34069+a,h+1,f,c,d,p.image[a])}}r.__maxMipLevel=s.length}A(e,l)&&T(34067,e,u.width,u.height),r.__version=e.version,e.onUpdate&&e.onUpdate(e)}else v.activeTexture(33984+t),v.bindTexture(34067,r.__webglTexture)}}function h(e,t){v.activeTexture(33984+t),v.bindTexture(34067,y.get(e).__webglTexture)}function x(e,t,r){var n;if(r?(g.texParameteri(e,10242,b.convert(t.wrapS)),g.texParameteri(e,10243,b.convert(t.wrapT)),32879!==e&&35866!==e||g.texParameteri(e,32882,b.convert(t.wrapR)),g.texParameteri(e,10240,b.convert(t.magFilter)),g.texParameteri(e,10241,b.convert(t.minFilter))):(g.texParameteri(e,10242,33071),g.texParameteri(e,10243,33071),32879!==e&&35866!==e||g.texParameteri(e,32882,33071),t.wrapS===L&&t.wrapT===L||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),g.texParameteri(e,10240,a(t.magFilter)),g.texParameteri(e,10241,a(t.minFilter)),t.minFilter!==ye&&t.minFilter!==Ae&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),n=i.get("EXT_texture_filter_anisotropic")){if(t.type===Me&&null===i.get("OES_texture_float_linear"))return;if(t.type===Re&&null===(_.isWebGL2||i.get("OES_texture_half_float_linear")))return;(1<t.anisotropy||y.get(t).__currentAnisotropy)&&(g.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,_.getMaxAnisotropy())),y.get(t).__currentAnisotropy=t.anisotropy)}}function M(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",n),e.__webglTexture=g.createTexture(),l.memory.textures++)}function p(e,t,r){var n=3553;t.isDataTexture2DArray&&(n=35866),t.isDataTexture3D&&(n=32879),M(e,t),v.activeTexture(33984+r),v.bindTexture(n,e.__webglTexture),g.pixelStorei(37440,t.flipY),g.pixelStorei(37441,t.premultiplyAlpha),g.pixelStorei(3317,t.unpackAlignment);var i=function(e){return!_.isWebGL2&&(e.wrapS!==L||e.wrapT!==L||e.minFilter!==ye&&e.minFilter!==Ae)}(t)&&!1===w(t.image),o=E(t.image,i,!1,_.maxTextureSize),a=w(o)||_.isWebGL2,s=b.convert(t.format),u=b.convert(t.type),l=S(s,u);x(n,t,a);var c,d=t.mipmaps;if(t.isDepthTexture){if(l=6402,t.type===Me){if(!_.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");l=36012}else _.isWebGL2&&(l=33189);t.format===Ie&&6402===l&&t.type!==Se&&t.type!==xe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),t.type=Se,u=b.convert(t.type)),t.format===Le&&(l=34041,t.type!==Oe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),t.type=Oe,u=b.convert(t.type))),v.texImage2D(3553,0,l,o.width,o.height,0,s,u,null)}else if(t.isDataTexture)if(0<d.length&&a){for(var f=0,h=d.length;f<h;f++)c=d[f],v.texImage2D(3553,f,l,c.width,c.height,0,s,u,c.data);t.generateMipmaps=!1,e.__maxMipLevel=d.length-1}else v.texImage2D(3553,0,l,o.width,o.height,0,s,u,o.data),e.__maxMipLevel=0;else if(t.isCompressedTexture){for(f=0,h=d.length;f<h;f++)c=d[f],t.format!==Ce&&t.format!==Pe?-1<v.getCompressedTextureFormats().indexOf(s)?v.compressedTexImage2D(3553,f,l,c.width,c.height,0,c.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):v.texImage2D(3553,f,l,c.width,c.height,0,s,u,c.data);e.__maxMipLevel=d.length-1}else if(t.isDataTexture2DArray)v.texImage3D(35866,0,l,o.width,o.height,o.depth,0,s,u,o.data),e.__maxMipLevel=0;else if(t.isDataTexture3D)v.texImage3D(32879,0,l,o.width,o.height,o.depth,0,s,u,o.data),e.__maxMipLevel=0;else if(0<d.length&&a){for(f=0,h=d.length;f<h;f++)c=d[f],v.texImage2D(3553,f,l,s,u,c);t.generateMipmaps=!1,e.__maxMipLevel=d.length-1}else v.texImage2D(3553,0,l,s,u,o),e.__maxMipLevel=0;A(t,a)&&T(3553,t,o.width,o.height),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function m(e,t,r,n){var i=b.convert(t.texture.format),o=b.convert(t.texture.type),a=S(i,o);v.texImage2D(n,0,a,t.width,t.height,0,i,o,null),g.bindFramebuffer(36160,e),g.framebufferTexture2D(36160,r,n,y.get(t.texture).__webglTexture,0),g.bindFramebuffer(36160,null)}function R(e,t,r){if(g.bindRenderbuffer(36161,e),t.depthBuffer&&!t.stencilBuffer){if(r){var n=P(t);g.renderbufferStorageMultisample(36161,n,33189,t.width,t.height)}else g.renderbufferStorage(36161,33189,t.width,t.height);g.framebufferRenderbuffer(36160,36096,36161,e)}else if(t.depthBuffer&&t.stencilBuffer){if(r){n=P(t);g.renderbufferStorageMultisample(36161,n,35056,t.width,t.height)}else g.renderbufferStorage(36161,34041,t.width,t.height);g.framebufferRenderbuffer(36160,33306,36161,e)}else{var i=S(b.convert(t.texture.format),b.convert(t.texture.type));if(r){n=P(t);g.renderbufferStorageMultisample(36161,n,i,t.width,t.height)}else g.renderbufferStorage(36161,i,t.width,t.height)}g.bindRenderbuffer(36161,null)}function O(e){var t=y.get(e),r=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,t){if(t&&t.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,e),!t.depthTexture||!t.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");y.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),s(t.depthTexture,0);var r=y.get(t.depthTexture).__webglTexture;if(t.depthTexture.format===Ie)g.framebufferTexture2D(36160,36096,3553,r,0);else{if(t.depthTexture.format!==Le)throw new Error("Unknown depthTexture format");g.framebufferTexture2D(36160,33306,3553,r,0)}}(t.__webglFramebuffer,e)}else if(r){t.__webglDepthbuffer=[];for(var n=0;n<6;n++)g.bindFramebuffer(36160,t.__webglFramebuffer[n]),t.__webglDepthbuffer[n]=g.createRenderbuffer(),R(t.__webglDepthbuffer[n],e)}else g.bindFramebuffer(36160,t.__webglFramebuffer),t.__webglDepthbuffer=g.createRenderbuffer(),R(t.__webglDepthbuffer,e);g.bindFramebuffer(36160,null)}function P(e){return _.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(_.maxSamples,e.samples):0}var C=!1,D=!1;this.allocateTextureUnit=function(){var e=t;return e>=_.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+_.maxTextures),t+=1,e},this.resetTextureUnits=function(){t=0},this.setTexture2D=s,this.setTexture2DArray=function(e,t){var r=y.get(e);0<e.version&&r.__version!==e.version?p(r,e,t):(v.activeTexture(33984+t),v.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=y.get(e);0<e.version&&r.__version!==e.version?p(r,e,t):(v.activeTexture(33984+t),v.bindTexture(32879,r.__webglTexture))},this.setTextureCube=u,this.setTextureCubeDynamic=h,this.setupRenderTarget=function(e){var t=y.get(e),r=y.get(e.texture);e.addEventListener("dispose",f),r.__webglTexture=g.createTexture(),l.memory.textures++;var n=!0===e.isWebGLRenderTargetCube,i=!0===e.isWebGLMultisampleRenderTarget,o=w(e)||_.isWebGL2;if(n){t.__webglFramebuffer=[];for(var a=0;a<6;a++)t.__webglFramebuffer[a]=g.createFramebuffer()}else if(t.__webglFramebuffer=g.createFramebuffer(),i)if(_.isWebGL2){t.__webglMultisampledFramebuffer=g.createFramebuffer(),t.__webglColorRenderbuffer=g.createRenderbuffer(),g.bindRenderbuffer(36161,t.__webglColorRenderbuffer);var s=S(b.convert(e.texture.format),b.convert(e.texture.type)),u=P(e);g.renderbufferStorageMultisample(36161,u,s,e.width,e.height),g.bindFramebuffer(36160,t.__webglMultisampledFramebuffer),g.framebufferRenderbuffer(36160,36064,36161,t.__webglColorRenderbuffer),g.bindRenderbuffer(36161,null),e.depthBuffer&&(t.__webglDepthRenderbuffer=g.createRenderbuffer(),R(t.__webglDepthRenderbuffer,e,!0)),g.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(n){v.bindTexture(34067,r.__webglTexture),x(34067,e.texture,o);for(a=0;a<6;a++)m(t.__webglFramebuffer[a],e,36064,34069+a);A(e.texture,o)&&T(34067,e.texture,e.width,e.height),v.bindTexture(34067,null)}else v.bindTexture(3553,r.__webglTexture),x(3553,e.texture,o),m(t.__webglFramebuffer,e,36064,3553),A(e.texture,o)&&T(3553,e.texture,e.width,e.height),v.bindTexture(3553,null);e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(A(t,w(e)||_.isWebGL2)){var r=e.isWebGLRenderTargetCube?34067:3553,n=y.get(t).__webglTexture;v.bindTexture(r,n),T(r,t,e.width,e.height),v.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(_.isWebGL2){var t=y.get(e);g.bindFramebuffer(36008,t.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,t.__webglFramebuffer);var r=e.width,n=e.height,i=16384;e.depthBuffer&&(i|=256),e.stencilBuffer&&(i|=1024),g.blitFramebuffer(0,0,r,n,0,0,r,n,i,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===C&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),C=!0),e=e.texture),s(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?u(e,t):h(e,t)}}function oa(e,r,n){return{convert:function(e){var t;if(e===E)return 10497;if(e===L)return 33071;if(e===w)return 33648;if(e===ye)return 9728;if(e===_e)return 9984;if(e===be)return 9986;if(e===Ae)return 9729;if(e===A)return 9985;if(e===T)return 9987;if(e===Te)return 5121;if(e===R)return 32819;if(e===O)return 32820;if(e===P)return 33635;if(e===S)return 5120;if(e===x)return 5122;if(e===Se)return 5123;if(e===M)return 5124;if(e===xe)return 5125;if(e===Me)return 5126;if(e===Re){if(n.isWebGL2)return 5131;if(null!==(t=r.get("OES_texture_half_float")))return t.HALF_FLOAT_OES}if(e===C)return 6406;if(e===Pe)return 6407;if(e===Ce)return 6408;if(e===D)return 6409;if(e===De)return 6410;if(e===Ie)return 6402;if(e===Le)return 34041;if(e===Ne)return 6403;if(e===re)return 32774;if(e===i)return 32778;if(e===o)return 32779;if(e===l)return 0;if(e===c)return 1;if(e===d)return 768;if(e===f)return 769;if(e===h)return 770;if(e===p)return 771;if(e===m)return 772;if(e===g)return 773;if(e===y)return 774;if(e===_)return 775;if(e===b)return 776;if((e===ke||e===Fe||e===je||e===Be)&&null!==(t=r.get("WEBGL_compressed_texture_s3tc"))){if(e===ke)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Fe)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===je)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Be)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===Ue||e===Ge||e===He||e===Ve)&&null!==(t=r.get("WEBGL_compressed_texture_pvrtc"))){if(e===Ue)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ge)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===He)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Ve)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===ze&&null!==(t=r.get("WEBGL_compressed_texture_etc1")))return t.COMPRESSED_RGB_ETC1_WEBGL;if((e===We||e===qe||e===Ye||e===Ke||e===Xe||e===Qe||e===Je||e===Ze||e===$e||e===et||e===tt||e===rt||e===nt||e===it)&&null!==(t=r.get("WEBGL_compressed_texture_astc")))return e;if(e===s||e===u){if(n.isWebGL2){if(e===s)return 32775;if(e===u)return 32776}if(null!==(t=r.get("EXT_blend_minmax"))){if(e===s)return t.MIN_EXT;if(e===u)return t.MAX_EXT}}if(e===Oe){if(n.isWebGL2)return 34042;if(null!==(t=r.get("WEBGL_depth_texture")))return t.UNSIGNED_INT_24_8_WEBGL}return 0}}}function aa(){sr.call(this),this.type="Group"}function sa(e){ri.call(this),this.cameras=e||[]}aa.prototype=Object.assign(Object.create(sr.prototype),{constructor:aa,isGroup:!0}),sa.prototype=Object.assign(Object.create(ri.prototype),{constructor:sa,isArrayCamera:!0});var ua,la=new xt,ca=new xt;function da(e,t,r){la.setFromMatrixPosition(t.matrixWorld),ca.setFromMatrixPosition(r.matrixWorld);var n=la.distanceTo(ca),i=t.projectionMatrix.elements,o=r.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],d=(o[8]+1)/o[0],f=a*c,h=a*d,p=n/(d-c),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=a+p,v=s+p,y=f-m,_=n-m+h,b=u*s/v*g,E=l*s/v*g;e.projectionMatrix.makePerspective(y,_,b,E,g,v)}function fa(n){var i,o,a=this,u=null,l=null,c=null,d=[],f=new Vt,h=new Vt,s=1,p="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(l=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",e,!1));var m=new Vt,g=new At,v=new xt,y=new ri;y.viewport=new It,y.layers.enable(1);var _=new ri;_.viewport=new It,_.layers.enable(2);var b=new sa([y,_]);function E(){return null!==u&&!0===u.isPresenting}b.layers.enable(1),b.layers.enable(2);var w,A=new wt;function e(){if(E()){var e=u.getEyeParameters("left");i=2*e.renderWidth*s,o=e.renderHeight*s;var t=a.minRenderWidth;if(console.log("Forced render width is: "+t),console.log("Default Render Buffer Size: "+i+","+o),i<2*t){var r=2*t/i;i=2*t,o=Math.round(o*r)}console.log("Forced Render Buffer Size: "+i+","+o),w=n.getPixelRatio(),n.getSize(A),n.setDrawingBufferSize(i,o,1),y.viewport.set(0,0,i/2,o),_.viewport.set(i/2,0,i/2,o),M.start(),a.dispatchEvent({type:"sessionstart"})}else a.enabled&&n.setDrawingBufferSize(A.width,A.height,w),M.stop(),a.dispatchEvent({type:"sessionend"})}this.minRenderWidth=1024;var T=[];function S(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,n=0,i=t.length;r<i;r++){var o=t[r];if(o&&("Daydream Controller"===o.id||"Gear VR Controller"===o.id||"Oculus Go Controller"===o.id||"OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("HTC Vive Focus")||o.id.startsWith("Spatial Controller"))){if(n===e)return o;n++}}}function x(e,t){null!==t&&4===t.length&&e.set(t[0]*i,t[1]*o,t[2]*i,t[3]*o)}this.enabled=!1,this.getController=function(e){var t=d[e];return void 0===t&&((t=new aa).matrixAutoUpdate=!1,t.visible=!1,d[e]=t),t},this.getDevice=function(){return u},this.setDevice=function(e){void 0!==e&&(u=e),M.setContext(e)},this.setFramebufferScaleFactor=function(e){s=e},this.setReferenceSpaceType=function(e){p=e},this.setPoseTarget=function(e){void 0!==e&&(c=e)},this.getCamera=function(e){var t="local-floor"===p?1.6:0;if(!1===E())return e.position.set(0,t,0),e.rotation.set(0,0,0),e;if(u.depthNear=e.near,u.depthFar=e.far,u.getFrameData(l),"local-floor"===p){var r=u.stageParameters;r?f.fromArray(r.sittingToStandingTransform):f.makeTranslation(0,t,0)}var n=l.pose,i=null!==c?c:e;i.matrix.copy(f),i.matrix.decompose(i.position,i.quaternion,i.scale),null!==n.orientation&&(g.fromArray(n.orientation),i.quaternion.multiply(g)),null!==n.position&&(g.setFromRotationMatrix(f),v.fromArray(n.position),v.applyQuaternion(g),i.position.add(v)),i.updateMatrixWorld(),y.near=e.near,_.near=e.near,y.far=e.far,_.far=e.far,y.matrixWorldInverse.fromArray(l.leftViewMatrix),_.matrixWorldInverse.fromArray(l.rightViewMatrix),h.getInverse(f),"local-floor"===p&&(y.matrixWorldInverse.multiply(h),_.matrixWorldInverse.multiply(h));var o=i.parent;null!==o&&(m.getInverse(o.matrixWorld),y.matrixWorldInverse.multiply(m),_.matrixWorldInverse.multiply(m)),y.matrixWorld.getInverse(y.matrixWorldInverse),_.matrixWorld.getInverse(_.matrixWorldInverse),y.projectionMatrix.fromArray(l.leftProjectionMatrix),_.projectionMatrix.fromArray(l.rightProjectionMatrix),da(b,y,_);var a=u.getLayers();if(a.length){var s=a[0];x(y.viewport,s.leftBounds),x(_.viewport,s.rightBounds)}return function(){for(var e=0;e<d.length;e++){var t=d[e],r=S(e);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var n=r.pose;!1===n.hasPosition&&t.position.set(.2,-.6,-.05),null!==n.position&&t.position.fromArray(n.position),null!==n.orientation&&t.quaternion.fromArray(n.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(f),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var i="Daydream Controller"===r.id?0:1;void 0===T[e]&&(T[e]=!1),T[e]!==r.buttons[i].pressed&&(T[e]=r.buttons[i].pressed,!0===T[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),b},this.getStandingMatrix=function(){return f},this.isPresenting=E;var M=new gi;this.setAnimationLoop=function(e){M.setAnimationLoop(e),E()&&M.start()},this.submitFrame=function(){E()&&u.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",e)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function ha(f,t){var r=this,h=null,p=null,n="local-floor",m=null,g=[],v=[];function a(){return null!==h&&null!==p}var s=new ri;s.layers.enable(1),s.viewport=new It;var u=new ri;u.layers.enable(2),u.viewport=new It;var y=new sa([s,u]);function i(e){for(var t=0;t<g.length;t++)v[t]===e.inputSource&&g[t].dispatchEvent({type:e.type})}function o(){f.setFramebuffer(null),f.setRenderTarget(f.getRenderTarget()),d.stop(),r.dispatchEvent({type:"sessionend"})}function l(e){p=e,d.setContext(h),d.start(),r.dispatchEvent({type:"sessionstart"})}function c(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}y.layers.enable(1),y.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=g[e];return void 0===t&&((t=new aa).matrixAutoUpdate=!1,t.visible=!1,g[e]=t),t},this.setFramebufferScaleFactor=function(e){},this.setReferenceSpaceType=function(e){n=e},this.getSession=function(){return h},this.setSession=function(e){null!==(h=e)&&(h.addEventListener("select",i),h.addEventListener("selectstart",i),h.addEventListener("selectend",i),h.addEventListener("end",o),h.updateRenderState({baseLayer:new XRWebGLLayer(h,t)}),h.requestReferenceSpace(n).then(l),v=h.inputSources,h.addEventListener("inputsourceschange",function(){v=h.inputSources,console.log(v);for(var e=0;e<g.length;e++){g[e].userData.inputSource=v[e]}}))},this.getCamera=function(e){if(a()){var t=e.parent,r=y.cameras;c(y,t);for(var n=0;n<r.length;n++)c(r[n],t);e.matrixWorld.copy(y.matrixWorld);for(var i=e.children,o=(n=0,i.length);n<o;n++)i[n].updateMatrixWorld(!0);return da(y,s,u),y}return e},this.isPresenting=a;var _=null;var d=new gi;d.setAnimationLoop(function(e,t){if(null!==(m=t.getViewerPose(p))){var r=m.views,n=h.renderState.baseLayer;f.setFramebuffer(n.framebuffer);for(var i=0;i<r.length;i++){var o=r[i],a=n.getViewport(o),s=o.transform.inverse.matrix,u=y.cameras[i];u.matrix.fromArray(s).getInverse(u.matrix),u.projectionMatrix.fromArray(o.projectionMatrix),u.viewport.set(a.x,a.y,a.width,a.height),0===i&&y.matrix.copy(u.matrix)}}for(i=0;i<g.length;i++){var l=g[i],c=v[i];if(c){var d=t.getPose(c.targetRaySpace,p);if(null!==d){l.matrix.fromArray(d.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.visible=!0;continue}}l.visible=!1}_&&_(e)}),this.setAnimationLoop=function(e){_=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new Vt},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function pa(e){var n=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,p=null,_=null;this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=we,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var A,T,S,x,d,b,E,M,R,m,v,f,h,g,O,P,C,y,w=this,D=!1,I=null,L=0,N=0,k=null,F=null,j=-1,B={geometry:null,program:null,wireframe:!1},U=null,G=null,H=new It,V=new It,z=null,W=n.width,q=n.height,Y=1,K=new It(0,0,W,q),X=new It(0,0,W,q),Q=!1,J=new fi,Z=new Ai,$=!1,ee=!1,te=new Vt,re=new xt;function ne(){return null===k?Y:1}try{var ie={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c,xrCompatible:!0};if(n.addEventListener("webglcontextlost",ue,!1),n.addEventListener("webglcontextrestored",le,!1),null===(A=t||n.getContext("webgl",ie)||n.getContext("experimental-webgl",ie)))throw null!==n.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===A.getShaderPrecisionFormat&&(A.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function oe(){T=new Ti(A),(S=new wi(A,T,e)).isWebGL2||(T.get("WEBGL_depth_texture"),T.get("OES_texture_float"),T.get("OES_texture_half_float"),T.get("OES_texture_half_float_linear"),T.get("OES_standard_derivatives"),T.get("OES_element_index_uint"),T.get("ANGLE_instanced_arrays")),T.get("OES_texture_float_linear"),y=new oa(A,T,S),(x=new na(A,T,y,S)).scissor(V.copy(X).multiplyScalar(Y).floor()),x.viewport(H.copy(K).multiplyScalar(Y).floor()),d=new Mi(A),b=new Go,E=new ia(A,T,x,b,S,y,d),M=new vi(A),R=new Si(A,M,d),m=new Pi(R,d),O=new Oi(A),v=new Uo(w,T,S),f=new Wo,h=new Jo,g=new bi(w,x,m,s),P=new Ei(A,T,d,S),C=new xi(A,T,d,S),d.programs=v.programs,w.capabilities=S,w.extensions=T,w.properties=b,w.renderLists=f,w.renderStates=h,w.state=x,w.info=d}oe();var ae="undefined"!=typeof navigator&&"xr"in navigator&&"supportsSession"in navigator.xr?new ha(w,A):new fa(w);this.vr=ae;var se=new ra(w,m,S.maxTextureSize);function ue(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),D=!0}function le(){console.log("THREE.WebGLRenderer: Context Restored."),D=!1,oe()}function ce(e){var t=e.target;t.removeEventListener("dispose",ce),function(e){de(e),b.remove(e)}(t)}function de(e){var t=b.get(e).program;(e.program=void 0)!==t&&v.releaseProgram(t)}this.shadowMap=se,this.getContext=function(){return A},this.getContextAttributes=function(){return A.getContextAttributes()},this.forceContextLoss=function(){var e=T.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=T.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(e){void 0!==e&&(Y=e,this.setSize(W,q,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new wt),e.set(W,q)},this.setSize=function(e,t,r){ae.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(W=e,q=t,n.width=Math.floor(e*Y),n.height=Math.floor(t*Y),!1!==r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new wt),e.set(W*Y,q*Y).floor()},this.setDrawingBufferSize=function(e,t,r){W=e,q=t,Y=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new It),e.copy(H)},this.getViewport=function(e){return e.copy(K)},this.setViewport=function(e,t,r,n){e.isVector4?K.set(e.x,e.y,e.z,e.w):K.set(e,t,r,n),x.viewport(H.copy(K).multiplyScalar(Y).floor())},this.getScissor=function(e){return e.copy(X)},this.setScissor=function(e,t,r,n){e.isVector4?X.set(e.x,e.y,e.z,e.w):X.set(e,t,r,n),x.scissor(V.copy(X).multiplyScalar(Y).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(e){x.setScissorTest(Q=e)},this.getClearColor=function(){return g.getClearColor()},this.setClearColor=function(){g.setClearColor.apply(g,arguments)},this.getClearAlpha=function(){return g.getClearAlpha()},this.setClearAlpha=function(){g.setClearAlpha.apply(g,arguments)},this.clear=function(e,t,r){var n=0;void 0!==e&&!e||(n|=16384),void 0!==t&&!t||(n|=256),void 0!==r&&!r||(n|=1024),A.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",ue,!1),n.removeEventListener("webglcontextrestored",le,!1),f.dispose(),h.dispose(),b.dispose(),m.dispose(),ae.dispose(),he.stop()},this.renderBufferImmediate=function(e,t){x.initAttributes();var r=b.get(e);e.hasPositions&&!r.position&&(r.position=A.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=A.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=A.createBuffer()),e.hasColors&&!r.color&&(r.color=A.createBuffer());var n=t.getAttributes();e.hasPositions&&(A.bindBuffer(34962,r.position),A.bufferData(34962,e.positionArray,35048),x.enableAttribute(n.position),A.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(A.bindBuffer(34962,r.normal),A.bufferData(34962,e.normalArray,35048),x.enableAttribute(n.normal),A.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(A.bindBuffer(34962,r.uv),A.bufferData(34962,e.uvArray,35048),x.enableAttribute(n.uv),A.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(A.bindBuffer(34962,r.color),A.bufferData(34962,e.colorArray,35048),x.enableAttribute(n.color),A.vertexAttribPointer(n.color,3,5126,!1,0,0)),x.disableUnusedAttributes(),A.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,o){var a=i.isMesh&&i.matrixWorld.determinant()<0;x.setMaterial(n,a);var s=ve(e,t,n,i),u=!1;B.geometry===r.id&&B.program===s.id&&B.wireframe===(!0===n.wireframe)||(B.geometry=r.id,B.program=s.id,B.wireframe=!0===n.wireframe,u=!0),i.morphTargetInfluences&&(O.update(i,r,n,s),u=!0);var l,c=r.index,d=r.attributes.position,f=1;!0===n.wireframe&&(c=R.getWireframeAttribute(r),f=2);var h=P;null!==c&&(l=M.get(c),(h=C).setIndex(l)),u&&(function(e,t,r){if(r&&r.isInstancedBufferGeometry&&!S.isWebGL2&&null===T.get("ANGLE_instanced_arrays"))return console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");x.initAttributes();var n=r.attributes,i=t.getAttributes(),o=e.defaultAttributeValues;for(var a in i){var s=i[a];if(0<=s){var u=n[a];if(void 0!==u){var l=u.normalized,c=u.itemSize,d=M.get(u);if(void 0===d)continue;var f=d.buffer,h=d.type,p=d.bytesPerElement;if(u.isInterleavedBufferAttribute){var m=u.data,g=m.stride,v=u.offset;m&&m.isInstancedInterleavedBuffer?(x.enableAttributeAndDivisor(s,m.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=m.meshPerAttribute*m.count)):x.enableAttribute(s),A.bindBuffer(34962,f),A.vertexAttribPointer(s,c,h,l,g*p,v*p)}else u.isInstancedBufferAttribute?(x.enableAttributeAndDivisor(s,u.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=u.meshPerAttribute*u.count)):x.enableAttribute(s),A.bindBuffer(34962,f),A.vertexAttribPointer(s,c,h,l,0,0)}else if(void 0!==o){var y=o[a];if(void 0!==y)switch(y.length){case 2:A.vertexAttrib2fv(s,y);break;case 3:A.vertexAttrib3fv(s,y);break;case 4:A.vertexAttrib4fv(s,y);break;default:A.vertexAttrib1fv(s,y)}}}}x.disableUnusedAttributes()}(n,s,r),null!==c&&A.bindBuffer(34963,l.buffer));var p=1/0;null!==c?p=c.count:void 0!==d&&(p=d.count);var m=r.drawRange.start*f,g=r.drawRange.count*f,v=null!==o?o.start*f:0,y=null!==o?o.count*f:1/0,_=Math.max(m,v),b=Math.min(p,m+g,v+y)-1,E=Math.max(0,b-_+1);if(0!==E){if(i.isMesh)if(!0===n.wireframe)x.setLineWidth(n.wireframeLinewidth*ne()),h.setMode(1);else switch(i.drawMode){case ot:h.setMode(4);break;case 1:h.setMode(5);break;case 2:h.setMode(6)}else if(i.isLine){var w=n.linewidth;void 0===w&&(w=1),x.setLineWidth(w*ne()),i.isLineSegments?h.setMode(1):i.isLineLoop?h.setMode(2):h.setMode(3)}else i.isPoints?h.setMode(0):i.isSprite&&h.setMode(4);r&&r.isInstancedBufferGeometry?0<r.maxInstancedCount&&h.renderInstances(r,_,E):h.render(_,E)}},this.compile=function(r,e){(_=h.get(r,e)).init(),r.traverse(function(e){e.isLight&&(_.pushLight(e),e.castShadow&&_.pushShadow(e))}),_.setupLights(e),r.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var t=0;t<e.material.length;t++)ge(e.material[t],r.fog,e);else ge(e.material,r.fog,e)})};var fe=null;var he=new gi;function pe(e,t,r,n){for(var i=0,o=e.length;i<o;i++){var a=e[i],s=a.object,u=a.geometry,l=void 0===n?a.material:n,c=a.group;if(r.isArrayCamera)for(var d=(G=r).cameras,f=0,h=d.length;f<h;f++){var p=d[f];s.layers.test(p.layers)&&(x.viewport(H.copy(p.viewport)),_.setupLights(p),me(s,t,p,u,l,c))}else G=null,me(s,t,r,u,l,c)}}function me(e,t,r,n,i,o){if(e.onBeforeRender(w,t,r,n,i,o),_=h.get(t,G||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){x.setMaterial(i);var a=ve(r,t.fog,i,e);B.geometry=null,B.program=null,B.wireframe=!1,function(e,t){e.render(function(e){w.renderBufferImmediate(e,t)})}(e,a)}else w.renderBufferDirect(r,t.fog,n,i,e,o);e.onAfterRender(w,t,r,n,i,o),_=h.get(t,G||r)}function ge(e,t,r){var n=b.get(e),i=_.state.lights,o=_.state.shadowsArray,a=i.state.version,s=v.getParameters(e,i.state,o,t,Z.numPlanes,Z.numIntersection,r),u=v.getProgramCode(e,s),l=n.program,c=!0;if(void 0===l)e.addEventListener("dispose",ce);else if(l.code!==u)de(e);else if(n.lightsStateVersion!==a)n.lightsStateVersion=a,c=!1;else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var d=mi[s.shaderID];n.shader={name:e.type,uniforms:Xn(d.uniforms),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}}else n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(n.shader,w),u=v.getProgramCode(e,s),l=v.acquireProgram(e,n.shader,s,u),n.program=l,e.program=l}var f=l.getAttributes();if(e.morphTargets)for(var h=e.numSupportedMorphTargets=0;h<w.maxMorphTargets;h++)0<=f["morphTarget"+h]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(h=e.numSupportedMorphNormals=0;h<w.maxMorphNormals;h++)0<=f["morphNormal"+h]&&e.numSupportedMorphNormals++;var p=n.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=Z.numPlanes,n.numIntersection=Z.numIntersection,p.clippingPlanes=Z.uniform),n.fog=t,n.lightsStateVersion=a,e.lights&&(p.ambientLightColor.value=i.state.ambient,p.lightProbe.value=i.state.probe,p.directionalLights.value=i.state.directional,p.spotLights.value=i.state.spot,p.rectAreaLights.value=i.state.rectArea,p.pointLights.value=i.state.point,p.hemisphereLights.value=i.state.hemi,p.directionalShadowMap.value=i.state.directionalShadowMap,p.directionalShadowMatrix.value=i.state.directionalShadowMatrix,p.spotShadowMap.value=i.state.spotShadowMap,p.spotShadowMatrix.value=i.state.spotShadowMatrix,p.pointShadowMap.value=i.state.pointShadowMap,p.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=n.program.getUniforms(),g=Ro.seqWithValue(m.seq,p);n.uniformsList=g}function ve(e,t,r,n){E.resetTextureUnits();var i=b.get(r),o=_.state.lights;if($&&(ee||e!==U)){var a=e===U&&r.id===j;Z.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,i,a)}!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==t?r.needsUpdate=!0:r.lights&&i.lightsStateVersion!==o.state.version?r.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===Z.numPlanes&&i.numIntersection===Z.numIntersection||(r.needsUpdate=!0)),r.needsUpdate&&(ge(r,t,n),r.needsUpdate=!1);var s=!1,u=!1,l=!1,c=i.program,d=c.getUniforms(),f=i.shader.uniforms;if(x.useProgram(c.program)&&(l=u=s=!0),r.id!==j&&(j=r.id,u=!0),s||U!==e){if(d.setValue(A,"projectionMatrix",e.projectionMatrix),S.logarithmicDepthBuffer&&d.setValue(A,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),U!==e&&(U=e,l=u=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var h=d.map.cameraPosition;void 0!==h&&h.setValue(A,re.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&d.setValue(A,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){d.setOptional(A,n,"bindMatrix"),d.setOptional(A,n,"bindMatrixInverse");var p=n.skeleton;if(p){var m=p.bones;if(S.floatVertexTextures){if(void 0===p.boneTexture){var g=Math.sqrt(4*m.length);g=Et.ceilPowerOfTwo(g),g=Math.max(g,4);var v=new Float32Array(g*g*4);v.set(p.boneMatrices);var y=new oi(v,g,g,Ce,Me);y.needsUpdate=!0,p.boneMatrices=v,p.boneTexture=y,p.boneTextureSize=g}d.setValue(A,"boneTexture",p.boneTexture,E),d.setValue(A,"boneTextureSize",p.boneTextureSize)}else d.setOptional(A,p,"boneMatrices")}}return u&&(d.setValue(A,"toneMappingExposure",w.toneMappingExposure),d.setValue(A,"toneMappingWhitePoint",w.toneMappingWhitePoint),r.lights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(f,l),t&&r.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(f,t),r.isMeshBasicMaterial?ye(f,r):r.isMeshLambertMaterial?(ye(f,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(f,r)):r.isMeshPhongMaterial?(ye(f,r),r.isMeshToonMaterial?function(e,t){_e(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(f,r):_e(f,r)):r.isMeshStandardMaterial?(ye(f,r),r.isMeshPhysicalMaterial?function(e,t){be(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===Ee&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(f,r):be(f,r)):r.isMeshMatcapMaterial?(ye(f,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Ee&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Ee&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(f,r)):r.isMeshDepthMaterial?(ye(f,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(f,r)):r.isMeshDistanceMaterial?(ye(f,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(f,r)):r.isMeshNormalMaterial?(ye(f,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Ee&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Ee&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(f,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(f,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(f,r)):r.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*Y,e.scale.value=.5*q,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(f,r):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(f,r):r.isShadowMaterial&&(f.color.value.copy(r.color),f.opacity.value=r.opacity),void 0!==f.ltc_1&&(f.ltc_1.value=pi.LTC_1),void 0!==f.ltc_2&&(f.ltc_2.value=pi.LTC_2),Ro.upload(A,i.uniformsList,f,E)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ro.upload(A,i.uniformsList,f,E),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&d.setValue(A,"center",n.center),d.setValue(A,"modelViewMatrix",n.modelViewMatrix),d.setValue(A,"normalMatrix",n.normalMatrix),d.setValue(A,"modelMatrix",n.matrixWorld),c}function ye(e,t){var r;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=b.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function _e(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Ee&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Ee&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function be(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Ee&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Ee&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}he.setAnimationLoop(function(e){ae.isPresenting()||fe&&fe(e)}),"undefined"!=typeof window&&he.setContext(window),this.setAnimationLoop=function(e){fe=e,ae.setAnimationLoop(e),he.start()},this.render=function(e,t){var r,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),t&&t.isCamera){if(!D){B.geometry=null,B.program=null,B.wireframe=!1,j=-1,!(U=null)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ae.enabled&&(t=ae.getCamera(t)),(_=h.get(e,t)).init(),e.onBeforeRender(w,e,t,r||k),te.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),J.setFromMatrix(te),ee=this.localClippingEnabled,$=Z.init(this.clippingPlanes,ee,t),(p=f.get(e,t)).init(),function e(t,r,n,i){if(!1===t.visible)return;var o=t.layers.test(r.layers);if(o)if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(r);else if(t.isLight)_.pushLight(t),t.castShadow&&_.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||J.intersectsSprite(t)){i&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te);var a=m.update(t),s=t.material;s.visible&&p.push(t,a,s,n,re.z,null)}}else if(t.isImmediateRenderObject)i&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te),p.push(t,null,t.material,n,re.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||J.intersectsObject(t))){i&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te);var a=m.update(t),s=t.material;if(Array.isArray(s))for(var u=a.groups,l=0,c=u.length;l<c;l++){var d=u[l],f=s[d.materialIndex];f&&f.visible&&p.push(t,a,f,n,re.z,d)}else s.visible&&p.push(t,a,s,n,re.z,null)}var h=t.children;for(var l=0,c=h.length;l<c;l++)e(h[l],r,n,i)}(e,t,0,w.sortObjects),!0===w.sortObjects&&p.sort(),$&&Z.beginShadows();var i=_.state.shadowsArray;se.render(i,e,t),_.setupLights(t),$&&Z.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),g.render(p,e,t,n);var o=p.opaque,a=p.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&pe(o,e,t,s),a.length&&pe(a,e,t,s)}else o.length&&pe(o,e,t),a.length&&pe(a,e,t);e.onAfterRender(w,e,t),null!==k&&(E.updateRenderTargetMipmap(k),E.updateMultisampleRenderTarget(k)),x.buffers.depth.setTest(!0),x.buffers.depth.setMask(!0),x.buffers.color.setMask(!0),x.setPolygonOffset(!1),_=p=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){I!==e&&A.bindFramebuffer(36160,e),I=e},this.getActiveCubeFace=function(){return L},this.getActiveMipmapLevel=function(){return N},this.getRenderTarget=function(){return k},this.setRenderTarget=function(e,t,r){L=t,N=r,(k=e)&&void 0===b.get(e).__webglFramebuffer&&E.setupRenderTarget(e);var n=I,i=!1;if(e){var o=b.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(n=o[t||0],i=!0):n=e.isWebGLMultisampleRenderTarget?b.get(e).__webglMultisampledFramebuffer:o,H.copy(e.viewport),V.copy(e.scissor),z=e.scissorTest}else H.copy(K).multiplyScalar(Y).floor(),V.copy(X).multiplyScalar(Y).floor(),z=Q;if(F!==n&&(A.bindFramebuffer(36160,n),F=n),x.viewport(H),x.scissor(V),x.setScissorTest(z),i){var a=b.get(e.texture);A.framebufferTexture2D(36160,36064,34069+(t||0),a.__webglTexture,r||0)}},this.readRenderTargetPixels=function(e,t,r,n,i,o,a){if(e&&e.isWebGLRenderTarget){var s=b.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==a&&(s=s[a]),s){var u=!1;s!==F&&(A.bindFramebuffer(36160,s),u=!0);try{var l=e.texture,c=l.format,d=l.type;if(c!==Ce&&y.convert(c)!==A.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(d===Te||y.convert(d)===A.getParameter(35738)||d===Me&&(S.isWebGL2||T.get("OES_texture_float")||T.get("WEBGL_color_buffer_float"))||d===Re&&(S.isWebGL2?T.get("EXT_color_buffer_float"):T.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===A.checkFramebufferStatus(36160)?0<=t&&t<=e.width-n&&0<=r&&r<=e.height-i&&A.readPixels(t,r,n,i,y.convert(c),y.convert(d),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{u&&A.bindFramebuffer(36160,F)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var n=t.image.width,i=t.image.height,o=y.convert(t.format);E.setTexture2D(t,0),A.copyTexImage2D(3553,r||0,o,e.x,e.y,n,i,0)},this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,o=t.image.height,a=y.convert(r.format),s=y.convert(r.type);E.setTexture2D(r,0),t.isDataTexture?A.texSubImage2D(3553,n||0,e.x,e.y,i,o,a,s,t.image.data):A.texSubImage2D(3553,n||0,e.x,e.y,a,s,t.image)},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ma(e,t){this.name="",this.color=new Yr(e),this.density=void 0!==t?t:25e-5}function ga(e,t,r){this.name="",this.color=new Yr(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function va(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function ya(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function _a(e){$r.call(this),this.type="SpriteMaterial",this.color=new Yr(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}Object.assign(fa.prototype,t.prototype),Object.assign(ha.prototype,t.prototype),Object.assign(ma.prototype,{isFogExp2:!0,clone:function(){return new ma(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(ga.prototype,{isFog:!0,clone:function(){return new ga(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(va.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(va.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(ya.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(ya.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),((_a.prototype=Object.create($r.prototype)).constructor=_a).prototype.isSpriteMaterial=!0,_a.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var ba=new xt,Ea=new xt,wa=new xt,Aa=new wt,Ta=new wt,Sa=new Vt,xa=new xt,Ma=new xt,Ra=new xt,Oa=new wt,Pa=new wt,Ca=new wt;function Da(e){if(sr.call(this),this.type="Sprite",void 0===ua){ua=new En;var t=new va(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);ua.setIndex([0,1,2,0,2,3]),ua.addAttribute("position",new ya(t,3,0,!1)),ua.addAttribute("uv",new ya(t,2,3,!1))}this.geometry=ua,this.material=void 0!==e?e:new _a,this.center=new wt(.5,.5)}function Ia(e,t,r,n,i,o){Aa.subVectors(e,r).addScalar(.5).multiply(n),void 0!==i?(Ta.x=o*Aa.x-i*Aa.y,Ta.y=i*Aa.x+o*Aa.y):Ta.copy(Aa),e.copy(t),e.x+=Ta.x,e.y+=Ta.y,e.applyMatrix4(Sa)}Da.prototype=Object.assign(Object.create(sr.prototype),{constructor:Da,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ea.setFromMatrixScale(this.matrixWorld),Sa.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),wa.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ea.multiplyScalar(-wa.z);var r,n,i=this.material.rotation;0!==i&&(n=Math.cos(i),r=Math.sin(i));var o=this.center;Ia(xa.set(-.5,-.5,0),wa,o,Ea,r,n),Ia(Ma.set(.5,-.5,0),wa,o,Ea,r,n),Ia(Ra.set(.5,.5,0),wa,o,Ea,r,n),Oa.set(0,0),Pa.set(1,0),Ca.set(1,1);var a=e.ray.intersectTriangle(xa,Ma,Ra,!1,ba);if(null!==a||(Ia(Ma.set(-.5,.5,0),wa,o,Ea,r,n),Pa.set(0,1),null!==(a=e.ray.intersectTriangle(xa,Ra,Ma,!1,ba)))){var s=e.ray.origin.distanceTo(ba);s<e.near||s>e.far||t.push({distance:s,point:ba.clone(),uv:Vr.getUV(ba,xa,Ma,Ra,Oa,Pa,Ca,new wt),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return sr.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var La=new xt,Na=new xt;function ka(){sr.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Fa(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Bn.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Vt,this.bindMatrixInverse=new Vt}ka.prototype=Object.assign(Object.create(sr.prototype),{constructor:ka,isLOD:!0,copy:function(e){sr.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){for(var t=this.levels,r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(e,t){La.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(La);this.getObjectForDistance(r).raycast(e,t)},update:function(e){var t=this.levels;if(1<t.length){La.setFromMatrixPosition(e.matrixWorld),Na.setFromMatrixPosition(this.matrixWorld);var r=La.distanceTo(Na);t[0].object.visible=!0;for(var n=1,i=t.length;n<i&&r>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(;n<i;n++)t[n].object.visible=!1}},toJSON:function(e){var t=sr.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Fa.prototype=Object.assign(Object.create(Bn.prototype),{constructor:Fa,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new It,t=this.geometry.attributes.skinWeight,r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var i=1/e.manhattanLength();i!=1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Bn.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ja=new Vt,Ba=new Vt;function Ua(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Vt)}}function Ga(){sr.call(this),this.type="Bone"}function Ha(e){$r.call(this),this.type="LineBasicMaterial",this.color=new Yr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}Object.assign(Ua.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Vt;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,o=e.length;i<o;i++){var a=e[i]?e[i].matrixWorld:Ba;ja.multiplyMatrices(a,t[i]),ja.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new Ua(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),Ga.prototype=Object.assign(Object.create(sr.prototype),{constructor:Ga,isBone:!0}),((Ha.prototype=Object.create($r.prototype)).constructor=Ha).prototype.isLineBasicMaterial=!0,Ha.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var Va=new xt,za=new xt,Wa=new Vt,qa=new Dr,Ya=new Tr;function Ka(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),sr.call(this),this.type="Line",this.geometry=void 0!==e?e:new En,this.material=void 0!==t?t:new Ha({color:16777215*Math.random()})}Ka.prototype=Object.assign(Object.create(sr.prototype),{constructor:Ka,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],n=1,i=t.count;n<i;n++)Va.fromBufferAttribute(t,n-1),za.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=Va.distanceTo(za);e.addAttribute("lineDistance",new cn(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;(r=e.lineDistances)[0]=0;for(n=1,i=o.length;n<i;n++)r[n]=r[n-1],r[n]+=o[n-1].distanceTo(o[n])}return this},raycast:function(e,t){var r=e.linePrecision,n=this.geometry,i=this.matrixWorld;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ya.copy(n.boundingSphere),Ya.applyMatrix4(i),Ya.radius+=r,!1!==e.ray.intersectsSphere(Ya)){Wa.getInverse(i),qa.copy(e.ray).applyMatrix4(Wa);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new xt,u=new xt,l=new xt,c=new xt,d=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var f=n.index,h=n.attributes.position.array;if(null!==f)for(var p=f.array,m=0,g=p.length-1;m<g;m+=d){var v=p[m],y=p[m+1];if(s.fromArray(h,3*v),u.fromArray(h,3*y),!(a<qa.distanceSqToSegment(s,u,c,l)))c.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(c))<e.near||E>e.far||t.push({distance:E,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}else for(m=0,g=h.length/3-1;m<g;m+=d){if(s.fromArray(h,3*m),u.fromArray(h,3*m+3),!(a<qa.distanceSqToSegment(s,u,c,l)))c.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(c))<e.near||E>e.far||t.push({distance:E,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){var _=n.vertices,b=_.length;for(m=0;m<b-1;m+=d){var E;if(!(a<qa.distanceSqToSegment(_[m],_[m+1],c,l)))c.applyMatrix4(this.matrixWorld),(E=e.ray.origin.distanceTo(c))<e.near||E>e.far||t.push({distance:E,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Xa=new xt,Qa=new xt;function Ja(e,t){Ka.call(this,e,t),this.type="LineSegments"}function Za(e,t){Ka.call(this,e,t),this.type="LineLoop"}function $a(e){$r.call(this),this.type="PointsMaterial",this.color=new Yr(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}Ja.prototype=Object.assign(Object.create(Ka.prototype),{constructor:Ja,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[],n=0,i=t.count;n<i;n+=2)Xa.fromBufferAttribute(t,n),Qa.fromBufferAttribute(t,n+1),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Xa.distanceTo(Qa);e.addAttribute("lineDistance",new cn(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for(r=e.lineDistances,n=0,i=o.length;n<i;n+=2)Xa.copy(o[n]),Qa.copy(o[n+1]),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Xa.distanceTo(Qa)}return this}}),Za.prototype=Object.assign(Object.create(Ka.prototype),{constructor:Za,isLineLoop:!0}),(($a.prototype=Object.create($r.prototype)).constructor=$a).prototype.isPointsMaterial=!0,$a.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var es=new Vt,ts=new Dr,rs=new Tr,ns=new xt;function is(e,t){sr.call(this),this.type="Points",this.geometry=void 0!==e?e:new En,this.material=void 0!==t?t:new $a({color:16777215*Math.random()}),this.updateMorphTargets()}function os(e,t,r,n,i,o,a){var s=ts.distanceSqToPoint(e);if(s<r){var u=new xt;ts.closestPointToPoint(e,u),u.applyMatrix4(n);var l=i.ray.origin.distanceTo(u);if(l<i.near||l>i.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:a})}}function as(e,t,r,n,i,o,a,s,u){Dt.call(this,e,t,r,n,i,o,a,s,u),this.format=void 0!==a?a:Pe,this.minFilter=void 0!==o?o:Ae,this.magFilter=void 0!==i?i:Ae,this.generateMipmaps=!1}function ss(e,t,r,n,i,o,a,s,u,l,c,d){Dt.call(this,null,o,a,s,u,l,n,i,c,d),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function us(e,t,r,n,i,o,a,s,u){Dt.call(this,e,t,r,n,i,o,a,s,u),this.needsUpdate=!0}function ls(e,t,r,n,i,o,a,s,u,l){if((l=void 0!==l?l:Ie)!==Ie&&l!==Le)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&l===Ie&&(r=Se),void 0===r&&l===Le&&(r=Oe),Dt.call(this,null,n,i,o,a,s,l,r,u),this.image={width:e,height:t},this.magFilter=void 0!==a?a:ye,this.minFilter=void 0!==s?s:ye,this.flipY=!1,this.generateMipmaps=!1}function cs(e){En.call(this),this.type="WireframeGeometry";var t,r,n,i,o,a,s,u,l,c,d=[],f=[0,0],h={},p=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var g=m[t];for(r=0;r<3;r++)s=g[p[r]],u=g[p[(r+1)%3]],f[0]=Math.min(s,u),f[1]=Math.max(s,u),void 0===h[l=f[0]+","+f[1]]&&(h[l]={index1:f[0],index2:f[1]})}for(l in h)a=h[l],c=e.vertices[a.index1],d.push(c.x,c.y,c.z),c=e.vertices[a.index2],d.push(c.x,c.y,c.z)}else if(e&&e.isBufferGeometry){var v,y,_,b,E,w;if(c=new xt,null!==e.index){for(v=e.attributes.position,y=e.index,0===(_=e.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),i=0,o=_.length;i<o;++i)for(n=(t=(b=_[i]).start)+b.count;t<n;t+=3)for(r=0;r<3;r++)s=y.getX(t+r),u=y.getX(t+(r+1)%3),f[0]=Math.min(s,u),f[1]=Math.max(s,u),void 0===h[l=f[0]+","+f[1]]&&(h[l]={index1:f[0],index2:f[1]});for(l in h)a=h[l],c.fromBufferAttribute(v,a.index1),d.push(c.x,c.y,c.z),c.fromBufferAttribute(v,a.index2),d.push(c.x,c.y,c.z)}else for(t=0,n=(v=e.attributes.position).count/3;t<n;t++)for(r=0;r<3;r++)E=3*t+r,c.fromBufferAttribute(v,E),d.push(c.x,c.y,c.z),w=3*t+(r+1)%3,c.fromBufferAttribute(v,w),d.push(c.x,c.y,c.z)}this.addAttribute("position",new cn(d,3))}function ds(e,t,r){qn.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new fs(e,t,r)),this.mergeVertices()}function fs(e,t,r){En.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,o=[],a=[],s=[],u=[],l=new xt,c=new xt,d=new xt,f=new xt,h=new xt;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var p=t+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=t;i++){var g=i/t;e(g,m,c),a.push(c.x,c.y,c.z),0<=g-1e-5?(e(g-1e-5,m,d),f.subVectors(c,d)):(e(1e-5+g,m,d),f.subVectors(d,c)),0<=m-1e-5?(e(g,m-1e-5,d),h.subVectors(c,d)):(e(g,1e-5+m,d),h.subVectors(d,c)),l.crossVectors(f,h).normalize(),s.push(l.x,l.y,l.z),u.push(g,m)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var v=n*p+i,y=n*p+i+1,_=(n+1)*p+i+1,b=(n+1)*p+i;o.push(v,y,b),o.push(y,_,b)}this.setIndex(o),this.addAttribute("position",new cn(a,3)),this.addAttribute("normal",new cn(s,3)),this.addAttribute("uv",new cn(u,2))}function hs(e,t,r,n){qn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new ps(e,t,r,n)),this.mergeVertices()}function ps(n,o,e,t){En.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:n,indices:o,radius:e,detail:t},e=e||1;var c=[],d=[];function a(e,t,r,n){var i,o,a=Math.pow(2,n),s=[];for(i=0;i<=a;i++){s[i]=[];var u=e.clone().lerp(r,i/a),l=t.clone().lerp(r,i/a),c=a-i;for(o=0;o<=c;o++)s[i][o]=0===o&&i===a?u:u.clone().lerp(l,o/c)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var d=Math.floor(o/2);o%2==0?(f(s[i][d+1]),f(s[i+1][d]),f(s[i][d])):(f(s[i][d+1]),f(s[i+1][d+1]),f(s[i+1][d]))}}function f(e){c.push(e.x,e.y,e.z)}function s(e,t){var r=3*e;t.x=n[0+r],t.y=n[1+r],t.z=n[2+r]}function h(e,t,r,n){n<0&&1===e.x&&(d[t]=e.x-1),0===r.x&&0===r.z&&(d[t]=n/2/Math.PI+.5)}function p(e){return Math.atan2(e.z,-e.x)}!function(e){for(var t=new xt,r=new xt,n=new xt,i=0;i<o.length;i+=3)s(o[i+0],t),s(o[i+1],r),s(o[i+2],n),a(t,r,n,e)}(t=t||0),function(e){for(var t=new xt,r=0;r<c.length;r+=3)t.x=c[r+0],t.y=c[r+1],t.z=c[r+2],t.normalize().multiplyScalar(e),c[r+0]=t.x,c[r+1]=t.y,c[r+2]=t.z}(e),function(){for(var e=new xt,t=0;t<c.length;t+=3){e.x=c[t+0],e.y=c[t+1],e.z=c[t+2];var r=p(e)/2/Math.PI+.5,n=(i=e,Math.atan2(-i.y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5);d.push(r,1-n)}var i;(function(){for(var e=new xt,t=new xt,r=new xt,n=new xt,i=new wt,o=new wt,a=new wt,s=0,u=0;s<c.length;s+=9,u+=6){e.set(c[s+0],c[s+1],c[s+2]),t.set(c[s+3],c[s+4],c[s+5]),r.set(c[s+6],c[s+7],c[s+8]),i.set(d[u+0],d[u+1]),o.set(d[u+2],d[u+3]),a.set(d[u+4],d[u+5]),n.copy(e).add(t).add(r).divideScalar(3);var l=p(n);h(i,u+0,e,l),h(o,u+2,t,l),h(a,u+4,r,l)}})(),function(){for(var e=0;e<d.length;e+=6){var t=d[e+0],r=d[e+2],n=d[e+4],i=Math.max(t,r,n),o=Math.min(t,r,n);.9<i&&o<.1&&(t<.2&&(d[e+0]+=1),r<.2&&(d[e+2]+=1),n<.2&&(d[e+4]+=1))}}()}(),this.addAttribute("position",new cn(c,3)),this.addAttribute("normal",new cn(c.slice(),3)),this.addAttribute("uv",new cn(d,2)),0===t?this.computeVertexNormals():this.normalizeNormals()}function ms(e,t){qn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new gs(e,t)),this.mergeVertices()}function gs(e,t){ps.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function vs(e,t){qn.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ys(e,t)),this.mergeVertices()}function ys(e,t){ps.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function _s(e,t){qn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new bs(e,t)),this.mergeVertices()}function bs(e,t){var r=(1+Math.sqrt(5))/2;ps.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Es(e,t){qn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ws(e,t)),this.mergeVertices()}function ws(e,t){var r=(1+Math.sqrt(5))/2,n=1/r;ps.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function As(e,t,r,n,i,o){qn.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Ts(e,t,r,n,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Ts(a,s,u,l,e){En.call(this),this.type="TubeBufferGeometry",this.parameters={path:a,tubularSegments:s,radius:u,radialSegments:l,closed:e},s=s||64,u=u||1,l=l||8,e=e||!1;var c=a.computeFrenetFrames(s,e);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;var i,d,f=new xt,h=new xt,t=new wt,p=new xt,m=[],g=[],r=[],o=[];function n(e){p=a.getPointAt(e/s,p);var t=c.normals[e],r=c.binormals[e];for(d=0;d<=l;d++){var n=d/l*Math.PI*2,i=Math.sin(n),o=-Math.cos(n);h.x=o*t.x+i*r.x,h.y=o*t.y+i*r.y,h.z=o*t.z+i*r.z,h.normalize(),g.push(h.x,h.y,h.z),f.x=p.x+u*h.x,f.y=p.y+u*h.y,f.z=p.z+u*h.z,m.push(f.x,f.y,f.z)}}!function(){for(i=0;i<s;i++)n(i);n(!1===e?s:0),function(){for(i=0;i<=s;i++)for(d=0;d<=l;d++)t.x=i/s,t.y=d/l,r.push(t.x,t.y)}(),function(){for(d=1;d<=s;d++)for(i=1;i<=l;i++){var e=(l+1)*(d-1)+(i-1),t=(l+1)*d+(i-1),r=(l+1)*d+i,n=(l+1)*(d-1)+i;o.push(e,t,n),o.push(t,r,n)}}()}(),this.setIndex(o),this.addAttribute("position",new cn(m,3)),this.addAttribute("normal",new cn(g,3)),this.addAttribute("uv",new cn(r,2))}function Ss(e,t,r,n,i,o,a){qn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new xs(e,t,r,n,i,o)),this.mergeVertices()}function xs(e,t,r,n,i,o){En.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var a,s,u=[],l=[],c=[],d=[],f=new xt,h=new xt,p=new xt,m=new xt,g=new xt,v=new xt,y=new xt;for(a=0;a<=r;++a){var _=a/r*i*Math.PI*2;for(M(_,i,o,e,p),M(.01+_,i,o,e,m),v.subVectors(m,p),y.addVectors(m,p),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,E=-t*Math.cos(b),w=t*Math.sin(b);f.x=p.x+(E*y.x+w*g.x),f.y=p.y+(E*y.y+w*g.y),f.z=p.z+(E*y.z+w*g.z),l.push(f.x,f.y,f.z),h.subVectors(f,p).normalize(),c.push(h.x,h.y,h.z),d.push(a/r),d.push(s/n)}}for(s=1;s<=r;s++)for(a=1;a<=n;a++){var A=(n+1)*(s-1)+(a-1),T=(n+1)*s+(a-1),S=(n+1)*s+a,x=(n+1)*(s-1)+a;u.push(A,T,x),u.push(T,S,x)}function M(e,t,r,n,i){var o=Math.cos(e),a=Math.sin(e),s=r/t*e,u=Math.cos(s);i.x=n*(2+u)*.5*o,i.y=n*(2+u)*a*.5,i.z=n*Math.sin(s)*.5}this.setIndex(u),this.addAttribute("position",new cn(l,3)),this.addAttribute("normal",new cn(c,3)),this.addAttribute("uv",new cn(d,2))}function Ms(e,t,r,n,i){qn.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new Rs(e,t,r,n,i)),this.mergeVertices()}function Rs(e,t,r,n,i){En.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,a,s=[],u=[],l=[],c=[],d=new xt,f=new xt,h=new xt;for(o=0;o<=r;o++)for(a=0;a<=n;a++){var p=a/n*i,m=o/r*Math.PI*2;f.x=(e+t*Math.cos(m))*Math.cos(p),f.y=(e+t*Math.cos(m))*Math.sin(p),f.z=t*Math.sin(m),u.push(f.x,f.y,f.z),d.x=e*Math.cos(p),d.y=e*Math.sin(p),h.subVectors(f,d).normalize(),l.push(h.x,h.y,h.z),c.push(a/n),c.push(o/r)}for(o=1;o<=r;o++)for(a=1;a<=n;a++){var g=(n+1)*o+a-1,v=(n+1)*(o-1)+a-1,y=(n+1)*(o-1)+a,_=(n+1)*o+a;s.push(g,v,_),s.push(v,y,_)}this.setIndex(s),this.addAttribute("position",new cn(u,3)),this.addAttribute("normal",new cn(l,3)),this.addAttribute("uv",new cn(c,2))}is.prototype=Object.assign(Object.create(sr.prototype),{constructor:is,isPoints:!0,raycast:function(e,t){var r=this.geometry,n=this.matrixWorld,i=e.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),rs.copy(r.boundingSphere),rs.applyMatrix4(n),rs.radius+=i,!1!==e.ray.intersectsSphere(rs)){es.getInverse(n),ts.copy(e.ray).applyMatrix4(es);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(r.isBufferGeometry){var s=r.index,u=r.attributes.position.array;if(null!==s)for(var l=s.array,c=0,d=l.length;c<d;c++){var f=l[c];ns.fromArray(u,3*f),os(ns,f,a,n,e,t,this)}else{c=0;for(var h=u.length/3;c<h;c++)ns.fromArray(u,3*c),os(ns,c,a,n,e,t,this)}}else{var p=r.vertices;for(c=0,h=p.length;c<h;c++)os(p[c],c,a,n,e,t,this)}}},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(0<o.length){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;void 0!==s&&0<s.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),as.prototype=Object.assign(Object.create(Dt.prototype),{constructor:as,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),((ss.prototype=Object.create(Dt.prototype)).constructor=ss).prototype.isCompressedTexture=!0,((us.prototype=Object.create(Dt.prototype)).constructor=us).prototype.isCanvasTexture=!0,((ls.prototype=Object.create(Dt.prototype)).constructor=ls).prototype.isDepthTexture=!0,(cs.prototype=Object.create(En.prototype)).constructor=cs,(ds.prototype=Object.create(qn.prototype)).constructor=ds,(fs.prototype=Object.create(En.prototype)).constructor=fs,(hs.prototype=Object.create(qn.prototype)).constructor=hs,(ps.prototype=Object.create(En.prototype)).constructor=ps,(ms.prototype=Object.create(qn.prototype)).constructor=ms,(gs.prototype=Object.create(ps.prototype)).constructor=gs,(vs.prototype=Object.create(qn.prototype)).constructor=vs,(ys.prototype=Object.create(ps.prototype)).constructor=ys,(_s.prototype=Object.create(qn.prototype)).constructor=_s,(bs.prototype=Object.create(ps.prototype)).constructor=bs,(Es.prototype=Object.create(qn.prototype)).constructor=Es,(ws.prototype=Object.create(ps.prototype)).constructor=ws,(As.prototype=Object.create(qn.prototype)).constructor=As,((Ts.prototype=Object.create(En.prototype)).constructor=Ts).prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},(Ss.prototype=Object.create(qn.prototype)).constructor=Ss,(xs.prototype=Object.create(En.prototype)).constructor=xs,(Ms.prototype=Object.create(qn.prototype)).constructor=Ms,(Rs.prototype=Object.create(En.prototype)).constructor=Rs;var Os=function(e,t,r){r=r||2;var n,i,o,a,s,u,l,c=t&&t.length,d=c?t[0]*r:e.length,f=Ps(e,0,d,r,!0),h=[];if(!f||f.next===f.prev)return h;if(c&&(f=function(e,t,r,n){var i,o,a,s,u,l=[];for(i=0,o=t.length;i<o;i++)a=t[i]*n,s=i<o-1?t[i+1]*n:e.length,(u=Ps(e,a,s,n,!1))===u.next&&(u.steiner=!0),l.push(Us(u));for(l.sort(Fs),i=0;i<l.length;i++)js(l[i],r),r=Cs(r,r.next);return r}(e,t,f,r)),e.length>80*r){n=o=e[0],i=a=e[1];for(var p=r;p<d;p+=r)(s=e[p])<n&&(n=s),(u=e[p+1])<i&&(i=u),o<s&&(o=s),a<u&&(a=u);l=0!==(l=Math.max(o-n,a-i))?1/l:0}return Ds(f,h,r,n,i,l),h};function Ps(e,t,r,n,i){var o,a;if(i===0<function(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,r,n))for(o=t;o<r;o+=n)a=Ys(o,e[o],e[o+1],a);else for(o=r-n;t<=o;o-=n)a=Ys(o,e[o],e[o+1],a);return a&&Vs(a,a.next)&&(Ks(a),a=a.next),a}function Cs(e,t){if(!e)return e;t=t||e;var r,n=e;do{if(r=!1,n.steiner||!Vs(n,n.next)&&0!==Hs(n.prev,n,n.next))n=n.next;else{if(Ks(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function Ds(e,t,r,n,i,o,a){if(e){!a&&o&&function(e,t,r,n){var i=e;for(;null===i.z&&(i.z=Bs(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,a,s,u,l=1;do{for(r=e,o=e=null,a=0;r;){for(a++,n=r,t=s=0;t<l&&(s++,n=n.nextZ);t++);for(u=l;0<s||0<u&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(r=(i=r).nextZ,s--):(n=(i=n).nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(1<a)}(i)}(e,n,i,o);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?Ls(e,n,i,o):Is(e))t.push(s.i/r),t.push(e.i/r),t.push(u.i/r),Ks(e),e=u.next,l=u.next;else if((e=u)===l){a?1===a?Ds(e=Ns(e,t,r),t,r,n,i,o,2):2===a&&ks(e,t,r,n,i,o):Ds(Cs(e),t,r,n,i,o,1);break}}}function Is(e){var t=e.prev,r=e,n=e.next;if(0<=Hs(t,r,n))return!1;for(var i=e.next.next;i!==e.prev;){if(Gs(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=Hs(i.prev,i,i.next))return!1;i=i.next}return!0}function Ls(e,t,r,n){var i=e.prev,o=e,a=e.next;if(0<=Hs(i,o,a))return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,d=Bs(s,u,t,r,n),f=Bs(l,c,t,r,n),h=e.prevZ,p=e.nextZ;h&&h.z>=d&&p&&p.z<=f;){if(h!==e.prev&&h!==e.next&&Gs(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&0<=Hs(h.prev,h,h.next))return!1;if(h=h.prevZ,p!==e.prev&&p!==e.next&&Gs(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=Hs(p.prev,p,p.next))return!1;p=p.nextZ}for(;h&&h.z>=d;){if(h!==e.prev&&h!==e.next&&Gs(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&0<=Hs(h.prev,h,h.next))return!1;h=h.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&Gs(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=Hs(p.prev,p,p.next))return!1;p=p.nextZ}return!0}function Ns(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!Vs(i,o)&&zs(i,n,n.next,o)&&Ws(i,o)&&Ws(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),Ks(n),Ks(n.next),n=e=o),n=n.next}while(n!==e);return n}function ks(e,t,r,n,i,o){var a,s,u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&(s=l,(a=u).next.i!==s.i&&a.prev.i!==s.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&zs(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(a,s)&&Ws(a,s)&&Ws(s,a)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next,r!==e;);return n}(a,s))){var c=qs(u,l);return u=Cs(u,u.next),c=Cs(c,c.next),Ds(u,t,r,n,i,o),void Ds(c,t,r,n,i,o)}l=l.next}u=u.next}while(u!==e)}function Fs(e,t){return e.x-t.x}function js(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&a<s){if((a=s)===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r.prev;var u,l=r,c=r.x,d=r.y,f=1/0;n=r.next;for(;n!==l;)i>=n.x&&n.x>=c&&i!==n.x&&Gs(o<d?i:a,o,c,d,o<d?a:i,o,n.x,n.y)&&((u=Math.abs(o-n.y)/(i-n.x))<f||u===f&&n.x>r.x)&&Ws(n,e)&&(r=n,f=u),n=n.next;return r}(e,t)){var r=qs(t,e);Cs(r,r.next)}}function Bs(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Us(e){for(var t=e,r=e;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),(t=t.next)!==e;);return r}function Gs(e,t,r,n,i,o,a,s){return 0<=(i-a)*(t-s)-(e-a)*(o-s)&&0<=(e-a)*(n-s)-(r-a)*(t-s)&&0<=(r-a)*(o-s)-(i-a)*(n-s)}function Hs(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Vs(e,t){return e.x===t.x&&e.y===t.y}function zs(e,t,r,n){return!!(Vs(e,r)&&Vs(t,n)||Vs(e,n)&&Vs(r,t))||0<Hs(e,t,r)!=0<Hs(e,t,n)&&0<Hs(r,n,e)!=0<Hs(r,n,t)}function Ws(e,t){return Hs(e.prev,e,e.next)<0?0<=Hs(e,t,e.next)&&0<=Hs(e,e.prev,t):Hs(e,t,e.prev)<0||Hs(e,e.next,t)<0}function qs(e,t){var r=new Xs(e.i,e.x,e.y),n=new Xs(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function Ys(e,t,r,n){var i=new Xs(e,t,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function Ks(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Xs(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Qs={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return Qs.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],i=[];Js(e),Zs(r,e);var o=e.length;t.forEach(Js);for(var a=0;a<t.length;a++)n.push(o),o+=t[a].length,Zs(r,t[a]);var s=Os(r,n);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function Js(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Zs(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function $s(e,t){qn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new eu(e,t)),this.mergeVertices()}function eu(e,J){En.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:J},e=Array.isArray(e)?e:[e];for(var Z=this,$=[],ee=[],t=0,r=e.length;t<r;t++){n(e[t])}function n(e){var n=[],t=void 0!==J.curveSegments?J.curveSegments:12,u=void 0!==J.steps?J.steps:1,r=void 0!==J.depth?J.depth:100,i=void 0===J.bevelEnabled||J.bevelEnabled,o=void 0!==J.bevelThickness?J.bevelThickness:6,a=void 0!==J.bevelSize?J.bevelSize:o-2,s=void 0!==J.bevelOffset?J.bevelOffset:0,l=void 0!==J.bevelSegments?J.bevelSegments:3,c=J.extrudePath,d=void 0!==J.UVGenerator?J.UVGenerator:tu;void 0!==J.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),r=J.amount);var f,h,p,m,g,v,y,_,b=!1;c&&(f=c.getSpacedPoints(u),i=!(b=!0),h=c.computeFrenetFrames(u,!1),p=new xt,m=new xt,g=new xt),i||(s=a=o=l=0);var E=e.extractPoints(t),w=E.shape,A=E.holes;if(!Qs.isClockWise(w))for(w=w.reverse(),y=0,_=A.length;y<_;y++)v=A[y],Qs.isClockWise(v)&&(A[y]=v.reverse());var T=Qs.triangulateShape(w,A),S=w;for(y=0,_=A.length;y<_;y++)v=A[y],w=w.concat(v);function x(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var M,R,O,P,C,D,I=w.length,L=T.length;function N(e,t,r){var n,i,o,a=e.x-t.x,s=e.y-t.y,u=r.x-e.x,l=r.y-e.y,c=a*a+s*s,d=a*l-s*u;if(Math.abs(d)>Number.EPSILON){var f=Math.sqrt(c),h=Math.sqrt(u*u+l*l),p=t.x-s/f,m=t.y+a/f,g=((r.x-l/h-p)*l-(r.y+u/h-m)*u)/(a*l-s*u),v=(n=p+a*g-e.x)*n+(i=m+s*g-e.y)*i;if(v<=2)return new wt(n,i);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?u>Number.EPSILON&&(y=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(l)&&(y=!0),o=y?(n=-s,i=a,Math.sqrt(c)):(n=a,i=s,Math.sqrt(c/2))}return new wt(n/o,i/o)}for(var k=[],F=0,j=S.length,B=j-1,U=F+1;F<j;F++,B++,U++)B===j&&(B=0),U===j&&(U=0),k[F]=N(S[F],S[B],S[U]);var G,H,V=[],z=k.concat();for(y=0,_=A.length;y<_;y++){for(v=A[y],G=[],F=0,B=(j=v.length)-1,U=F+1;F<j;F++,B++,U++)B===j&&(B=0),U===j&&(U=0),G[F]=N(v[F],v[B],v[U]);V.push(G),z=z.concat(G)}for(M=0;M<l;M++){for(O=M/l,P=o*Math.cos(O*Math.PI/2),R=a*Math.sin(O*Math.PI/2)+s,F=0,j=S.length;F<j;F++)q((C=x(S[F],k[F],R)).x,C.y,-P);for(y=0,_=A.length;y<_;y++)for(v=A[y],G=V[y],F=0,j=v.length;F<j;F++)q((C=x(v[F],G[F],R)).x,C.y,-P)}for(R=a+s,F=0;F<I;F++)C=i?x(w[F],z[F],R):w[F],b?(m.copy(h.normals[0]).multiplyScalar(C.x),p.copy(h.binormals[0]).multiplyScalar(C.y),g.copy(f[0]).add(m).add(p),q(g.x,g.y,g.z)):q(C.x,C.y,0);for(H=1;H<=u;H++)for(F=0;F<I;F++)C=i?x(w[F],z[F],R):w[F],b?(m.copy(h.normals[H]).multiplyScalar(C.x),p.copy(h.binormals[H]).multiplyScalar(C.y),g.copy(f[H]).add(m).add(p),q(g.x,g.y,g.z)):q(C.x,C.y,r/u*H);for(M=l-1;0<=M;M--){for(O=M/l,P=o*Math.cos(O*Math.PI/2),R=a*Math.sin(O*Math.PI/2)+s,F=0,j=S.length;F<j;F++)q((C=x(S[F],k[F],R)).x,C.y,r+P);for(y=0,_=A.length;y<_;y++)for(v=A[y],G=V[y],F=0,j=v.length;F<j;F++)C=x(v[F],G[F],R),b?q(C.x,C.y+f[u-1].y,f[u-1].x+P):q(C.x,C.y,r+P)}function W(e,t){var r,n;for(F=e.length;0<=--F;){(n=(r=F)-1)<0&&(n=e.length-1);var i=0,o=u+2*l;for(i=0;i<o;i++){var a=I*i,s=I*(i+1);K(t+r+a,t+n+a,t+n+s,t+r+s)}}}function q(e,t,r){n.push(e),n.push(t),n.push(r)}function Y(e,t,r){X(e),X(t),X(r);var n=$.length/3,i=d.generateTopUV(Z,$,n-3,n-2,n-1);Q(i[0]),Q(i[1]),Q(i[2])}function K(e,t,r,n){X(e),X(t),X(n),X(t),X(r),X(n);var i=$.length/3,o=d.generateSideWallUV(Z,$,i-6,i-3,i-2,i-1);Q(o[0]),Q(o[1]),Q(o[3]),Q(o[1]),Q(o[2]),Q(o[3])}function X(e){$.push(n[3*e+0]),$.push(n[3*e+1]),$.push(n[3*e+2])}function Q(e){ee.push(e.x),ee.push(e.y)}!function(){var e=$.length/3;if(i){var t=0,r=I*t;for(F=0;F<L;F++)Y((D=T[F])[2]+r,D[1]+r,D[0]+r);for(r=I*(t=u+2*l),F=0;F<L;F++)Y((D=T[F])[0]+r,D[1]+r,D[2]+r)}else{for(F=0;F<L;F++)Y((D=T[F])[2],D[1],D[0]);for(F=0;F<L;F++)Y((D=T[F])[0]+I*u,D[1]+I*u,D[2]+I*u)}Z.addGroup(e,$.length/3-e,0)}(),function(){var e=$.length/3,t=0;for(W(S,t),t+=S.length,y=0,_=A.length;y<_;y++)W(v=A[y],t),t+=v.length;Z.addGroup(e,$.length/3-e,1)}()}this.addAttribute("position",new cn($,3)),this.addAttribute("uv",new cn(ee,2)),this.computeVertexNormals()}(($s.prototype=Object.create(qn.prototype)).constructor=$s).prototype.toJSON=function(){var e=qn.prototype.toJSON.call(this);return ru(this.parameters.shapes,this.parameters.options,e)},((eu.prototype=Object.create(En.prototype)).constructor=eu).prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return ru(this.parameters.shapes,this.parameters.options,e)};var tu={generateTopUV:function(e,t,r,n,i){var o=t[3*r],a=t[3*r+1],s=t[3*n],u=t[3*n+1],l=t[3*i],c=t[3*i+1];return[new wt(o,a),new wt(s,u),new wt(l,c)]},generateSideWallUV:function(e,t,r,n,i,o){var a=t[3*r],s=t[3*r+1],u=t[3*r+2],l=t[3*n],c=t[3*n+1],d=t[3*n+2],f=t[3*i],h=t[3*i+1],p=t[3*i+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(s-c)<.01?[new wt(a,1-u),new wt(l,1-d),new wt(f,1-p),new wt(m,1-v)]:[new wt(s,1-u),new wt(c,1-d),new wt(h,1-p),new wt(g,1-v)]}};function ru(e,t,r){if(r.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var o=e[n];r.shapes.push(o.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function nu(e,t){qn.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new iu(e,t)),this.mergeVertices()}function iu(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new qn;var n=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),eu.call(this,n,t),this.type="TextBufferGeometry"}function ou(e,t,r,n,i,o,a){qn.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new au(e,t,r,n,i,o,a)),this.mergeVertices()}function au(e,t,r,n,i,o,a){En.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,u,l=Math.min(o+a,Math.PI),c=0,d=[],f=new xt,h=new xt,p=[],m=[],g=[],v=[];for(u=0;u<=r;u++){var y=[],_=u/r,b=0;for(0==u&&0==o?b=.5/t:u==r&&l==Math.PI&&(b=-.5/t),s=0;s<=t;s++){var E=s/t;f.x=-e*Math.cos(n+E*i)*Math.sin(o+_*a),f.y=e*Math.cos(o+_*a),f.z=e*Math.sin(n+E*i)*Math.sin(o+_*a),m.push(f.x,f.y,f.z),h.copy(f).normalize(),g.push(h.x,h.y,h.z),v.push(E+b,1-_),y.push(c++)}d.push(y)}for(u=0;u<r;u++)for(s=0;s<t;s++){var w=d[u][s+1],A=d[u][s],T=d[u+1][s],S=d[u+1][s+1];(0!==u||0<o)&&p.push(w,A,S),(u!==r-1||l<Math.PI)&&p.push(A,T,S)}this.setIndex(p),this.addAttribute("position",new cn(m,3)),this.addAttribute("normal",new cn(g,3)),this.addAttribute("uv",new cn(v,2))}function su(e,t,r,n,i,o){qn.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new uu(e,t,r,n,i,o)),this.mergeVertices()}function uu(e,t,r,n,i,o){En.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},e=e||.5,t=t||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,u,l=[],c=[],d=[],f=[],h=e,p=(t-e)/(n=void 0!==n?Math.max(1,n):1),m=new xt,g=new wt;for(s=0;s<=n;s++){for(u=0;u<=r;u++)a=i+u/r*o,m.x=h*Math.cos(a),m.y=h*Math.sin(a),c.push(m.x,m.y,m.z),d.push(0,0,1),g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,f.push(g.x,g.y);h+=p}for(s=0;s<n;s++){var v=s*(r+1);for(u=0;u<r;u++){var y=a=u+v,_=a+r+1,b=a+r+2,E=a+1;l.push(y,_,E),l.push(_,b,E)}}this.setIndex(l),this.addAttribute("position",new cn(c,3)),this.addAttribute("normal",new cn(d,3)),this.addAttribute("uv",new cn(f,2))}function lu(e,t,r,n){qn.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new cu(e,t,r,n)),this.mergeVertices()}function cu(e,t,r,n){En.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=Et.clamp(n,0,2*Math.PI);var i,o,a,s=[],u=[],l=[],c=1/t,d=new xt,f=new wt;for(o=0;o<=t;o++){var h=r+o*c*n,p=Math.sin(h),m=Math.cos(h);for(a=0;a<=e.length-1;a++)d.x=e[a].x*p,d.y=e[a].y,d.z=e[a].x*m,u.push(d.x,d.y,d.z),f.x=o/t,f.y=a/(e.length-1),l.push(f.x,f.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var g=i=a+o*e.length,v=i+e.length,y=i+e.length+1,_=i+1;s.push(g,v,_),s.push(v,y,_)}if(this.setIndex(s),this.addAttribute("position",new cn(u,3)),this.addAttribute("uv",new cn(l,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,E=new xt,w=new xt,A=new xt;for(i=t*e.length*3,a=o=0;o<e.length;o++,a+=3)E.x=b[a+0],E.y=b[a+1],E.z=b[a+2],w.x=b[i+a+0],w.y=b[i+a+1],w.z=b[i+a+2],A.addVectors(E,w).normalize(),b[a+0]=b[i+a+0]=A.x,b[a+1]=b[i+a+1]=A.y,b[a+2]=b[i+a+2]=A.z}}function du(e,t){qn.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new fu(e,t)),this.mergeVertices()}function fu(e,p){En.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:p},p=p||12;var m=[],g=[],v=[],y=[],t=0,_=0;if(!1===Array.isArray(e))n(e);else for(var r=0;r<e.length;r++)n(e[r]),this.addGroup(t,_,r),t+=_,_=0;function n(e){var t,r,n,i=g.length/3,o=e.extractPoints(p),a=o.shape,s=o.holes;for(!1===Qs.isClockWise(a)&&(a=a.reverse()),t=0,r=s.length;t<r;t++)n=s[t],!0===Qs.isClockWise(n)&&(s[t]=n.reverse());var u=Qs.triangulateShape(a,s);for(t=0,r=s.length;t<r;t++)n=s[t],a=a.concat(n);for(t=0,r=a.length;t<r;t++){var l=a[t];g.push(l.x,l.y,0),v.push(0,0,1),y.push(l.x,l.y)}for(t=0,r=u.length;t<r;t++){var c=u[t],d=c[0]+i,f=c[1]+i,h=c[2]+i;m.push(d,f,h),_+=3}}this.setIndex(m),this.addAttribute("position",new cn(g,3)),this.addAttribute("normal",new cn(v,3)),this.addAttribute("uv",new cn(y,2))}function hu(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function pu(e,t){En.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,o,a=[],s=Math.cos(Et.DEG2RAD*t),u=[0,0],l={},c=["a","b","c"];e.isBufferGeometry?(o=new qn).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var d=o.vertices,f=o.faces,h=0,p=f.length;h<p;h++)for(var m=f[h],g=0;g<3;g++)r=m[c[g]],n=m[c[(g+1)%3]],u[0]=Math.min(r,n),u[1]=Math.max(r,n),void 0===l[i=u[0]+","+u[1]]?l[i]={index1:u[0],index2:u[1],face1:h,face2:void 0}:l[i].face2=h;for(i in l){var v=l[i];if(void 0===v.face2||f[v.face1].normal.dot(f[v.face2].normal)<=s){var y=d[v.index1];a.push(y.x,y.y,y.z),y=d[v.index2],a.push(y.x,y.y,y.z)}}this.addAttribute("position",new cn(a,3))}function mu(e,t,r,n,i,o,a,s){qn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new gu(e,t,r,n,i,o,a,s)),this.mergeVertices()}function gu(v,y,_,b,E,e,w,A){En.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:v,radiusBottom:y,height:_,radialSegments:b,heightSegments:E,openEnded:e,thetaStart:w,thetaLength:A};var T=this;v=void 0!==v?v:1,y=void 0!==y?y:1,_=_||1,b=Math.floor(b)||8,E=Math.floor(E)||1,e=void 0!==e&&e,w=void 0!==w?w:0,A=void 0!==A?A:2*Math.PI;var S=[],x=[],M=[],R=[],O=0,P=[],C=_/2,D=0;function t(e){var t,r,n,i=new wt,o=new xt,a=0,s=!0===e?v:y,u=!0===e?1:-1;for(r=O,t=1;t<=b;t++)x.push(0,C*u,0),M.push(0,u,0),R.push(.5,.5),O++;for(n=O,t=0;t<=b;t++){var l=t/b*A+w,c=Math.cos(l),d=Math.sin(l);o.x=s*d,o.y=C*u,o.z=s*c,x.push(o.x,o.y,o.z),M.push(0,u,0),i.x=.5*c+.5,i.y=.5*d*u+.5,R.push(i.x,i.y),O++}for(t=0;t<b;t++){var f=r+t,h=n+t;!0===e?S.push(h,h+1,f):S.push(h+1,h,f),a+=3}T.addGroup(D,a,!0===e?1:2),D+=a}!function(){var e,t,r=new xt,n=new xt,i=0,o=(y-v)/_;for(t=0;t<=E;t++){var a=[],s=t/E,u=s*(y-v)+v;for(e=0;e<=b;e++){var l=e/b,c=l*A+w,d=Math.sin(c),f=Math.cos(c);n.x=u*d,n.y=-s*_+C,n.z=u*f,x.push(n.x,n.y,n.z),r.set(d,o,f).normalize(),M.push(r.x,r.y,r.z),R.push(l,1-s),a.push(O++)}P.push(a)}for(e=0;e<b;e++)for(t=0;t<E;t++){var h=P[t][e],p=P[t+1][e],m=P[t+1][e+1],g=P[t][e+1];S.push(h,p,g),S.push(p,m,g),i+=6}T.addGroup(D,i,0),D+=i}(),!1===e&&(0<v&&t(!0),0<y&&t(!1)),this.setIndex(S),this.addAttribute("position",new cn(x,3)),this.addAttribute("normal",new cn(M,3)),this.addAttribute("uv",new cn(R,2))}function vu(e,t,r,n,i,o,a){mu.call(this,0,e,t,r,n,i,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function yu(e,t,r,n,i,o,a){gu.call(this,0,e,t,r,n,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function _u(e,t,r,n){qn.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new bu(e,t,r,n)),this.mergeVertices()}function bu(e,t,r,n){En.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,a=[],s=[],u=[],l=[],c=new xt,d=new wt;for(s.push(0,0,0),u.push(0,0,1),l.push(.5,.5),o=0,i=3;o<=t;o++,i+=3){var f=r+o/t*n;c.x=e*Math.cos(f),c.y=e*Math.sin(f),s.push(c.x,c.y,c.z),u.push(0,0,1),d.x=(s[i]/e+1)/2,d.y=(s[i+1]/e+1)/2,l.push(d.x,d.y)}for(i=1;i<=t;i++)a.push(i,i+1,0);this.setIndex(a),this.addAttribute("position",new cn(s,3)),this.addAttribute("normal",new cn(u,3)),this.addAttribute("uv",new cn(l,2))}(nu.prototype=Object.create(qn.prototype)).constructor=nu,(iu.prototype=Object.create(eu.prototype)).constructor=iu,(ou.prototype=Object.create(qn.prototype)).constructor=ou,(au.prototype=Object.create(En.prototype)).constructor=au,(su.prototype=Object.create(qn.prototype)).constructor=su,(uu.prototype=Object.create(En.prototype)).constructor=uu,(lu.prototype=Object.create(qn.prototype)).constructor=lu,(cu.prototype=Object.create(En.prototype)).constructor=cu,((du.prototype=Object.create(qn.prototype)).constructor=du).prototype.toJSON=function(){var e=qn.prototype.toJSON.call(this);return hu(this.parameters.shapes,e)},((fu.prototype=Object.create(En.prototype)).constructor=fu).prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return hu(this.parameters.shapes,e)},(pu.prototype=Object.create(En.prototype)).constructor=pu,(mu.prototype=Object.create(qn.prototype)).constructor=mu,(gu.prototype=Object.create(En.prototype)).constructor=gu,(vu.prototype=Object.create(mu.prototype)).constructor=vu,(yu.prototype=Object.create(gu.prototype)).constructor=yu,(_u.prototype=Object.create(qn.prototype)).constructor=_u,(bu.prototype=Object.create(En.prototype)).constructor=bu;var Eu=Object.freeze({WireframeGeometry:cs,ParametricGeometry:ds,ParametricBufferGeometry:fs,TetrahedronGeometry:ms,TetrahedronBufferGeometry:gs,OctahedronGeometry:vs,OctahedronBufferGeometry:ys,IcosahedronGeometry:_s,IcosahedronBufferGeometry:bs,DodecahedronGeometry:Es,DodecahedronBufferGeometry:ws,PolyhedronGeometry:hs,PolyhedronBufferGeometry:ps,TubeGeometry:As,TubeBufferGeometry:Ts,TorusKnotGeometry:Ss,TorusKnotBufferGeometry:xs,TorusGeometry:Ms,TorusBufferGeometry:Rs,TextGeometry:nu,TextBufferGeometry:iu,SphereGeometry:ou,SphereBufferGeometry:au,RingGeometry:su,RingBufferGeometry:uu,PlaneGeometry:yi,PlaneBufferGeometry:_i,LatheGeometry:lu,LatheBufferGeometry:cu,ShapeGeometry:du,ShapeBufferGeometry:fu,ExtrudeGeometry:$s,ExtrudeBufferGeometry:eu,EdgesGeometry:pu,ConeGeometry:vu,ConeBufferGeometry:yu,CylinderGeometry:mu,CylinderBufferGeometry:gu,CircleGeometry:_u,CircleBufferGeometry:bu,BoxGeometry:Yn,BoxBufferGeometry:Kn});function wu(e){$r.call(this),this.type="ShadowMaterial",this.color=new Yr(0),this.transparent=!0,this.setValues(e)}function Au(e){ei.call(this,e),this.type="RawShaderMaterial"}function Tu(e){$r.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Yr(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mt,this.normalScale=new wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Su(e){Tu.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new wt(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function xu(e){$r.call(this),this.type="MeshPhongMaterial",this.color=new Yr(16777215),this.specular=new Yr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mt,this.normalScale=new wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=j,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Mu(e){xu.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Ru(e){$r.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mt,this.normalScale=new wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ou(e){$r.call(this),this.type="MeshLambertMaterial",this.color=new Yr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=j,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Pu(e){$r.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Yr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mt,this.normalScale=new wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function Cu(e){Ha.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}((wu.prototype=Object.create($r.prototype)).constructor=wu).prototype.isShadowMaterial=!0,wu.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.color.copy(e.color),this},((Au.prototype=Object.create(ei.prototype)).constructor=Au).prototype.isRawShaderMaterial=!0,((Tu.prototype=Object.create($r.prototype)).constructor=Tu).prototype.isMeshStandardMaterial=!0,Tu.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Su.prototype=Object.create(Tu.prototype)).constructor=Su).prototype.isMeshPhysicalMaterial=!0,Su.prototype.copy=function(e){return Tu.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new Yr).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},((xu.prototype=Object.create($r.prototype)).constructor=xu).prototype.isMeshPhongMaterial=!0,xu.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Mu.prototype=Object.create(xu.prototype)).constructor=Mu).prototype.isMeshToonMaterial=!0,Mu.prototype.copy=function(e){return xu.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},((Ru.prototype=Object.create($r.prototype)).constructor=Ru).prototype.isMeshNormalMaterial=!0,Ru.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Ou.prototype=Object.create($r.prototype)).constructor=Ou).prototype.isMeshLambertMaterial=!0,Ou.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Pu.prototype=Object.create($r.prototype)).constructor=Pu).prototype.isMeshMatcapMaterial=!0,Pu.prototype.copy=function(e){return $r.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Cu.prototype=Object.create(Ha.prototype)).constructor=Cu).prototype.isLineDashedMaterial=!0,Cu.prototype.copy=function(e){return Ha.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Du=Object.freeze({ShadowMaterial:wu,SpriteMaterial:_a,RawShaderMaterial:Au,ShaderMaterial:ei,PointsMaterial:$a,MeshPhysicalMaterial:Su,MeshStandardMaterial:Tu,MeshPhongMaterial:xu,MeshToonMaterial:Mu,MeshNormalMaterial:Ru,MeshLambertMaterial:Ou,MeshDepthMaterial:Zo,MeshDistanceMaterial:$o,MeshBasicMaterial:en,MeshMatcapMaterial:Pu,LineDashedMaterial:Cu,LineBasicMaterial:Ha,Material:$r}),Iu={arraySlice:function(e,t,r){return Iu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(r){for(var e=r.length,t=new Array(e),n=0;n!==e;++n)t[n]=n;return t.sort(function(e,t){return r[e]-r[t]}),t},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),o=0,a=0;a!==n;++o)for(var s=r[o]*t,u=0;u!==t;++u)i[a++]=e[s+u];return i},flattenJSON:function(e,t,r,n){for(var i=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[i++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))for(;void 0!==(a=o[n])&&(t.push(o.time),r.push.apply(r,a)),void 0!==(o=e[i++]););else if(void 0!==a.toArray)for(;void 0!==(a=o[n])&&(t.push(o.time),a.toArray(r,r.length)),void 0!==(o=e[i++]););else for(;void 0!==(a=o[n])&&(t.push(o.time),r.push(a)),void 0!==(o=e[i++]););}}};function Lu(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function Nu(e,t,r,n){Lu.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function ku(e,t,r,n){Lu.call(this,e,t,r,n)}function Fu(e,t,r,n){Lu.call(this,e,t,r,n)}function ju(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Iu.convertArray(t,this.TimeBufferType),this.values=Iu.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function Bu(e,t,r){ju.call(this,e,t,r)}function Uu(e,t,r,n){ju.call(this,e,t,r,n)}function Gu(e,t,r,n){ju.call(this,e,t,r,n)}function Hu(e,t,r,n){Lu.call(this,e,t,r,n)}function Vu(e,t,r,n){ju.call(this,e,t,r,n)}function zu(e,t,r,n){ju.call(this,e,t,r,n)}function Wu(e,t,r,n){ju.call(this,e,t,r,n)}function qu(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=Et.generateUUID(),this.duration<0&&this.resetDuration()}function Yu(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Gu;case"vector":case"vector2":case"vector3":case"vector4":return Wu;case"color":return Uu;case"quaternion":return Vu;case"bool":case"boolean":return Bu;case"string":return zu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],n=[];Iu.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Lu.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var o;r:{n:if(!(e<n)){for(var a=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===a)break;if(i=n,e<(n=t[++r]))break t}o=t.length;break r}if(i<=e)break e;var s=t[1];e<s&&(r=2,i=s);for(a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===a)break;if(n=i,(i=t[--r-1])<=e)break t}o=r,r=0}for(;r<o;){var u=r+o>>>1;e<t[u]?o=u:r=1+u}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,o=0;o!==n;++o)t[o]=r[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Lu.prototype,{beforeStart_:Lu.prototype.copySampleValue_,afterEnd_:Lu.prototype.copySampleValue_}),Nu.prototype=Object.assign(Object.create(Lu.prototype),{constructor:Nu,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,o=e+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-r;break;case 2402:a=t+n[i=n.length-2]-n[i+1];break;default:i=e,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*r-t;break;case 2402:s=r+n[o=1]-n[0];break;default:o=e-1,s=t}var u=.5*(r-t),l=this.valueSize;this._weightPrev=u/(t-a),this._weightNext=u/(s-r),this._offsetPrev=i*l,this._offsetNext=o*l},interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=s-a,l=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,f=this._weightNext,h=(r-t)/(n-t),p=h*h,m=p*h,g=-d*m+2*d*p-d*h,v=(1+d)*m+(-1.5-2*d)*p+(-.5+d)*h+1,y=(-1-f)*m+(1.5+f)*p+.5*h,_=f*m-f*p,b=0;b!==a;++b)i[b]=g*o[l+b]+v*o[u+b]+y*o[s+b]+_*o[c+b];return i}}),ku.prototype=Object.assign(Object.create(Lu.prototype),{constructor:ku,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=s-a,l=(r-t)/(n-t),c=1-l,d=0;d!==a;++d)i[d]=o[u+d]*c+o[s+d]*l;return i}}),Fu.prototype=Object.assign(Object.create(Lu.prototype),{constructor:Fu,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(ju,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:Iu.convertArray(e.times,Array),values:Iu.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}}),Object.assign(ju.prototype,{constructor:ju,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Fu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new ku(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Nu(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)return this.createInterpolant=t,this;var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<e;)++i;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==i||o!==n){o<=i&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=Iu.arraySlice(r,i,o),this.values=Iu.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==i;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&s<o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==n&&Iu.isTypedArray(n)){a=0;for(var u=n.length;a!==u;++a){var l=n[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,o=e.length-1,a=1;a<o;++a){var s=!1,u=e[a];if(u!==e[a+1]&&(1!==a||u!==u[0]))if(n)s=!0;else for(var l=a*r,c=l-r,d=l+r,f=0;f!==r;++f){var h=t[l+f];if(h!==t[c+f]||h!==t[d+f]){s=!0;break}}if(s){if(a!==i){e[i]=e[a];var p=a*r,m=i*r;for(f=0;f!==r;++f)t[m+f]=t[p+f]}++i}}if(0<o){e[i]=e[o];for(p=o*r,m=i*r,f=0;f!==r;++f)t[m+f]=t[p+f];++i}return i!==e.length&&(this.times=Iu.arraySlice(e,0,i),this.values=Iu.arraySlice(t,0,i*r)),this},clone:function(){var e=Iu.arraySlice(this.times,0),t=Iu.arraySlice(this.values,0),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}),Bu.prototype=Object.assign(Object.create(ju.prototype),{constructor:Bu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Uu.prototype=Object.assign(Object.create(ju.prototype),{constructor:Uu,ValueTypeName:"color"}),Gu.prototype=Object.assign(Object.create(ju.prototype),{constructor:Gu,ValueTypeName:"number"}),Hu.prototype=Object.assign(Object.create(Lu.prototype),{constructor:Hu,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,u=(r-t)/(n-t),l=s+a;s!==l;s+=4)At.slerpFlat(i,0,o,s-a,o,s,u);return i}}),Vu.prototype=Object.assign(Object.create(ju.prototype),{constructor:Vu,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Hu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),zu.prototype=Object.assign(Object.create(ju.prototype),{constructor:zu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Wu.prototype=Object.assign(Object.create(ju.prototype),{constructor:Wu,ValueTypeName:"vector"}),Object.assign(qu,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,o=r.length;i!==o;++i)t.push(Yu(r[i]).scale(n));return new qu(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,o=r.length;i!==o;++i)t.push(ju.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,o=[],a=0;a<i;a++){var s=[],u=[];s.push((a+i-1)%i,a,(a+1)%i),u.push(0,1,0);var l=Iu.getKeyframeOrder(s);s=Iu.sortedArray(s,1,l),u=Iu.sortedArray(u,1,l),n||0!==s[0]||(s.push(i),u.push(u[0])),o.push(new Gu(".morphTargetInfluences["+t[a].name+"]",s,u).scale(1/r))}return new qu(e,-1,o)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],u=s.name.match(i);if(u&&1<u.length){var l=n[d=u[1]];l||(n[d]=l=[]),l.push(s)}}var c=[];for(var d in n)c.push(qu.CreateFromMorphTargetSequence(d,n[d],t,r));return c},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,i){if(0!==r.length){var o=[],a=[];Iu.flattenJSON(r,o,a,n),0!==o.length&&i.push(new e(t,o,a))}},n=[],i=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],u=0;u<s.length;u++){var l=s[u].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var c={},d=0;d<l.length;d++)if(l[d].morphTargets)for(var f=0;f<l[d].morphTargets.length;f++)c[l[d].morphTargets[f]]=-1;for(var h in c){var p=[],m=[];for(f=0;f!==l[d].morphTargets.length;++f){var g=l[d];p.push(g.time),m.push(g.morphTarget===h?1:0)}n.push(new Gu(".morphTargetInfluence["+h+"]",p,m))}o=c.length*(a||1)}else{var v=".bones["+t[u].name+"]";r(Wu,v+".position",l,"pos",n),r(Vu,v+".quaternion",l,"rot",n),r(Wu,v+".scale",l,"scl",n)}}return 0===n.length?null:new qu(i,o,n)}}),Object.assign(qu.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new qu(this.name,this.duration,e)}});var Ku={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Xu(e,t,r){var n=this,i=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===i&&void 0!==n.onStart&&n.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var Qu=new Xu;function Ju(e){this.manager=void 0!==e?e:Qu,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Ju.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}}),Ju.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,n=t.length;r<n;r+=2){var i=t[r],o=t[r+1];if(i.test(e))return o}return null}};var Zu={};function $u(e){Ju.call(this,e)}function el(e){Ju.call(this,e)}function tl(e){Ju.call(this,e),this._parser=null}function rl(e){Ju.call(this,e),this._parser=null}function nl(e){Ju.call(this,e)}function il(e){Ju.call(this,e)}function ol(e){Ju.call(this,e)}function al(){this.type="Curve",this.arcLengthDivisions=200}function sl(e,t,r,n,i,o,a,s){al.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function ul(e,t,r,n,i,o){sl.call(this,e,t,r,r,n,i,o),this.type="ArcCurve"}function ll(){var i=0,o=0,a=0,s=0;function l(e,t,r,n){a=-3*(i=e)+3*t-2*(o=r)-n,s=2*e-2*t+r+n}return{initCatmullRom:function(e,t,r,n,i){l(t,r,i*(r-e),i*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,i,o,a){var s=(t-e)/i-(r-e)/(i+o)+(r-t)/o,u=(r-t)/o-(n-t)/(o+a)+(n-r)/a;l(t,r,s*=o,u*=o)},calc:function(e){var t=e*e;return i+o*e+a*t+s*(t*e)}}}$u.prototype=Object.assign(Object.create(Ju.prototype),{constructor:$u,load:function(a,e,t,r){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);var s=this,n=Ku.get(a);if(void 0!==n)return s.manager.itemStart(a),setTimeout(function(){e&&e(n),s.manager.itemEnd(a)},0),n;if(void 0===Zu[a]){var i=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var o=i[1],u=!!i[2],l=i[3];l=decodeURIComponent(l),u&&(l=atob(l));try{var c,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var f=new Uint8Array(l.length),h=0;h<l.length;h++)f[h]=l.charCodeAt(h);c="blob"===d?new Blob([f.buffer],{type:o}):f.buffer;break;case"document":var p=new DOMParser;c=p.parseFromString(l,o);break;case"json":c=JSON.parse(l);break;default:c=l}setTimeout(function(){e&&e(c),s.manager.itemEnd(a)},0)}catch(e){setTimeout(function(){r&&r(e),s.manager.itemError(a),s.manager.itemEnd(a)},0)}}else{Zu[a]=[],Zu[a].push({onLoad:e,onProgress:t,onError:r});var m=new XMLHttpRequest;for(var g in m.open("GET",a,!0),m.addEventListener("load",function(e){var t=this.response;Ku.add(a,t);var r=Zu[a];if(delete Zu[a],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var n=0,i=r.length;n<i;n++){(o=r[n]).onLoad&&o.onLoad(t)}s.manager.itemEnd(a)}else{for(n=0,i=r.length;n<i;n++){var o;(o=r[n]).onError&&o.onError(e)}s.manager.itemError(a),s.manager.itemEnd(a)}},!1),m.addEventListener("progress",function(e){for(var t=Zu[a],r=0,n=t.length;r<n;r++){var i=t[r];i.onProgress&&i.onProgress(e)}},!1),m.addEventListener("error",function(e){var t=Zu[a];delete Zu[a];for(var r=0,n=t.length;r<n;r++){var i=t[r];i.onError&&i.onError(e)}s.manager.itemError(a),s.manager.itemEnd(a)},!1),m.addEventListener("abort",function(e){var t=Zu[a];delete Zu[a];for(var r=0,n=t.length;r<n;r++){var i=t[r];i.onError&&i.onError(e)}s.manager.itemError(a),s.manager.itemEnd(a)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return s.manager.itemStart(a),m}Zu[a].push({onLoad:e,onProgress:t,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),el.prototype=Object.assign(Object.create(Ju.prototype),{constructor:el,load:function(e,t,r,n){var i=this,o=new $u(i.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){for(var t=[],r=0;r<e.length;r++){var n=qu.parse(e[r]);t.push(n)}return t}}),tl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:tl,load:function(e,o,t,n){var a=this,s=[],u=new ss;u.image=s;var i=new $u(this.manager);function r(r){i.load(e[r],function(e){var t=a._parser(e,!0);s[r]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},6===(l+=1)&&(1===t.mipmapCount&&(u.minFilter=Ae),u.format=t.format,u.needsUpdate=!0,o&&o(u))},t,n)}if(i.setPath(this.path),i.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,c=0,d=e.length;c<d;++c)r(c);else i.load(e,function(e){var t=a._parser(e,!0);if(t.isCubemap)for(var r=t.mipmaps.length/t.mipmapCount,n=0;n<r;n++){s[n]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)s[n].mipmaps.push(t.mipmaps[n*t.mipmapCount+i]),s[n].format=t.format,s[n].width=t.width,s[n].height=t.height}else u.image.width=t.width,u.image.height=t.height,u.mipmaps=t.mipmaps;1===t.mipmapCount&&(u.minFilter=Ae),u.format=t.format,u.needsUpdate=!0,o&&o(u)},t,n);return u}}),rl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:rl,load:function(e,r,t,n){var i=this,o=new oi,a=new $u(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,function(e){var t=i._parser(e);t&&(void 0!==t.image?o.image=t.image:void 0!==t.data&&(o.image.width=t.width,o.image.height=t.height,o.image.data=t.data),o.wrapS=void 0!==t.wrapS?t.wrapS:L,o.wrapT=void 0!==t.wrapT?t.wrapT:L,o.magFilter=void 0!==t.magFilter?t.magFilter:Ae,o.minFilter=void 0!==t.minFilter?t.minFilter:T,o.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(o.format=t.format),void 0!==t.type&&(o.type=t.type),void 0!==t.mipmaps&&(o.mipmaps=t.mipmaps),1===t.mipmapCount&&(o.minFilter=Ae),o.needsUpdate=!0,r&&r(o,t))},t,n),o}}),nl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:nl,load:function(t,e,r,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Ku.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1),Ku.add(t,this),e&&e(this),i.manager.itemEnd(t)}function u(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1),n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",u,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a}}),il.prototype=Object.assign(Object.create(Ju.prototype),{constructor:il,load:function(e,r,t,n){var i=new Ci,o=new nl(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(t){o.load(e[t],function(e){i.images[t]=e,6===++a&&(i.needsUpdate=!0,r&&r(i))},void 0,n)}for(var u=0;u<e.length;++u)s(u);return i}}),ol.prototype=Object.assign(Object.create(Ju.prototype),{constructor:ol,load:function(r,n,e,t){var i=new Dt,o=new nl(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(r,function(e){i.image=e;var t=0<r.search(/\.jpe?g($|\?)/i)||0===r.search(/^data\:image\/jpeg/);i.format=t?Pe:Ce,i.needsUpdate=!0,void 0!==n&&n(i)},e,t),i}}),Object.assign(al.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(i),n.push(o),i=t;return this.cacheArcLengths=n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,o=n.length;r=t||e*n[o-1];for(var a,s=0,u=o-1;s<=u;)if((a=n[i=Math.floor(s+(u-s)/2)]-r)<0)s=i+1;else{if(!(0<a)){u=i;break}u=i-1}if(n[i=u]===r)return i/(o-1);var l=n[i];return(i+(r-l)/(n[i+1]-l))/(o-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),1<r&&(r=1);var n=this.getPoint(t);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,i,o=new xt,a=[],s=[],u=[],l=new xt,c=new Vt;for(r=0;r<=e;r++)n=r/e,a[r]=this.getTangentAt(n),a[r].normalize();s[0]=new xt,u[0]=new xt;var d=Number.MAX_VALUE,f=Math.abs(a[0].x),h=Math.abs(a[0].y),p=Math.abs(a[0].z);for(f<=d&&(d=f,o.set(1,0,0)),h<=d&&(d=h,o.set(0,1,0)),p<=d&&o.set(0,0,1),l.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],l),u[0].crossVectors(a[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),u[r]=u[r-1].clone(),l.crossVectors(a[r-1],a[r]),l.length()>Number.EPSILON&&(l.normalize(),i=Math.acos(Et.clamp(a[r-1].dot(a[r]),-1,1)),s[r].applyMatrix4(c.makeRotationAxis(l,i))),u[r].crossVectors(a[r],s[r]);if(!0===t)for(i=Math.acos(Et.clamp(s[0].dot(s[e]),-1,1)),i/=e,0<a[0].dot(l.crossVectors(s[0],s[e]))&&(i=-i),r=1;r<=e;r++)s[r].applyMatrix4(c.makeRotationAxis(a[r],i*r)),u[r].crossVectors(a[r],s[r]);return{tangents:a,normals:s,binormals:u}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),((sl.prototype=Object.create(al.prototype)).constructor=sl).prototype.isEllipseCurve=!0,sl.prototype.getPoint=function(e,t){for(var r=t||new wt,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;n<i;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var a=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),d=s-this.aX,f=u-this.aY;s=d*l-f*c+this.aX,u=d*c+f*l+this.aY}return r.set(s,u)},sl.prototype.copy=function(e){return al.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},sl.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},sl.prototype.fromJSON=function(e){return al.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},((ul.prototype=Object.create(sl.prototype)).constructor=ul).prototype.isArcCurve=!0;var cl=new xt,dl=new ll,fl=new ll,hl=new ll;function pl(e,t,r,n){al.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function ml(e,t,r,n,i){var o=.5*(n-t),a=.5*(i-r),s=e*e;return(2*r-2*n+o+a)*(e*s)+(-3*r+3*n-2*o-a)*s+o*e+r}function gl(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function vl(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}function yl(e,t,r,n){al.call(this),this.type="CubicBezierCurve",this.v0=e||new wt,this.v1=t||new wt,this.v2=r||new wt,this.v3=n||new wt}function _l(e,t,r,n){al.call(this),this.type="CubicBezierCurve3",this.v0=e||new xt,this.v1=t||new xt,this.v2=r||new xt,this.v3=n||new xt}function bl(e,t){al.call(this),this.type="LineCurve",this.v1=e||new wt,this.v2=t||new wt}function El(e,t){al.call(this),this.type="LineCurve3",this.v1=e||new xt,this.v2=t||new xt}function wl(e,t,r){al.call(this),this.type="QuadraticBezierCurve",this.v0=e||new wt,this.v1=t||new wt,this.v2=r||new wt}function Al(e,t,r){al.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new xt,this.v1=t||new xt,this.v2=r||new xt}function Tl(e){al.call(this),this.type="SplineCurve",this.points=e||[]}((pl.prototype=Object.create(al.prototype)).constructor=pl).prototype.isCatmullRomCurve3=!0,pl.prototype.getPoint=function(e,t){var r,n,i,o,a=t||new xt,s=this.points,u=s.length,l=(u-(this.closed?0:1))*e,c=Math.floor(l),d=l-c;if(this.closed?c+=0<c?0:(Math.floor(Math.abs(c)/u)+1)*u:0===d&&c===u-1&&(c=u-2,d=1),r=this.closed||0<c?s[(c-1)%u]:(cl.subVectors(s[0],s[1]).add(s[0]),cl),n=s[c%u],i=s[(c+1)%u],o=this.closed||c+2<u?s[(c+2)%u]:(cl.subVectors(s[u-1],s[u-2]).add(s[u-1]),cl),"centripetal"===this.curveType||"chordal"===this.curveType){var f="chordal"===this.curveType?.5:.25,h=Math.pow(r.distanceToSquared(n),f),p=Math.pow(n.distanceToSquared(i),f),m=Math.pow(i.distanceToSquared(o),f);p<1e-4&&(p=1),h<1e-4&&(h=p),m<1e-4&&(m=p),dl.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,h,p,m),fl.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,h,p,m),hl.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,h,p,m)}else"catmullrom"===this.curveType&&(dl.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),fl.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),hl.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return a.set(dl.calc(d),fl.calc(d),hl.calc(d)),a},pl.prototype.copy=function(e){al.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},pl.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},pl.prototype.fromJSON=function(e){al.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new xt).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},((yl.prototype=Object.create(al.prototype)).constructor=yl).prototype.isCubicBezierCurve=!0,yl.prototype.getPoint=function(e,t){var r=t||new wt,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(vl(e,n.x,i.x,o.x,a.x),vl(e,n.y,i.y,o.y,a.y)),r},yl.prototype.copy=function(e){return al.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},yl.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},yl.prototype.fromJSON=function(e){return al.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((_l.prototype=Object.create(al.prototype)).constructor=_l).prototype.isCubicBezierCurve3=!0,_l.prototype.getPoint=function(e,t){var r=t||new xt,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(vl(e,n.x,i.x,o.x,a.x),vl(e,n.y,i.y,o.y,a.y),vl(e,n.z,i.z,o.z,a.z)),r},_l.prototype.copy=function(e){return al.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},_l.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},_l.prototype.fromJSON=function(e){return al.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((bl.prototype=Object.create(al.prototype)).constructor=bl).prototype.isLineCurve=!0,bl.prototype.getPoint=function(e,t){var r=t||new wt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},bl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},bl.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},bl.prototype.copy=function(e){return al.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},bl.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},bl.prototype.fromJSON=function(e){return al.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((El.prototype=Object.create(al.prototype)).constructor=El).prototype.isLineCurve3=!0,El.prototype.getPoint=function(e,t){var r=t||new xt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},El.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},El.prototype.copy=function(e){return al.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},El.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},El.prototype.fromJSON=function(e){return al.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((wl.prototype=Object.create(al.prototype)).constructor=wl).prototype.isQuadraticBezierCurve=!0,wl.prototype.getPoint=function(e,t){var r=t||new wt,n=this.v0,i=this.v1,o=this.v2;return r.set(gl(e,n.x,i.x,o.x),gl(e,n.y,i.y,o.y)),r},wl.prototype.copy=function(e){return al.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},wl.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},wl.prototype.fromJSON=function(e){return al.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Al.prototype=Object.create(al.prototype)).constructor=Al).prototype.isQuadraticBezierCurve3=!0,Al.prototype.getPoint=function(e,t){var r=t||new xt,n=this.v0,i=this.v1,o=this.v2;return r.set(gl(e,n.x,i.x,o.x),gl(e,n.y,i.y,o.y),gl(e,n.z,i.z,o.z)),r},Al.prototype.copy=function(e){return al.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Al.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Al.prototype.fromJSON=function(e){return al.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Tl.prototype=Object.create(al.prototype)).constructor=Tl).prototype.isSplineCurve=!0,Tl.prototype.getPoint=function(e,t){var r=t||new wt,n=this.points,i=(n.length-1)*e,o=Math.floor(i),a=i-o,s=n[0===o?o:o-1],u=n[o],l=n[o>n.length-2?n.length-1:o+1],c=n[o>n.length-3?n.length-1:o+2];return r.set(ml(a,s.x,u.x,l.x,c.x),ml(a,s.y,u.y,l.y,c.y)),r},Tl.prototype.copy=function(e){al.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},Tl.prototype.toJSON=function(){var e=al.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},Tl.prototype.fromJSON=function(e){al.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new wt).fromArray(n))}return this};var Sl=Object.freeze({ArcCurve:ul,CatmullRomCurve3:pl,CubicBezierCurve:yl,CubicBezierCurve3:_l,EllipseCurve:sl,LineCurve:bl,LineCurve3:El,QuadraticBezierCurve:wl,QuadraticBezierCurve3:Al,SplineCurve:Tl});function xl(){al.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ml(e){xl.call(this),this.type="Path",this.currentPoint=new wt,e&&this.setFromPoints(e)}function Rl(e){Ml.call(this,e),this.uuid=Et.generateUUID(),this.type="Shape",this.holes=[]}function Ol(e,t){sr.call(this),this.type="Light",this.color=new Yr(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Pl(e,t,r){Ol.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(sr.DefaultUp),this.updateMatrix(),this.groundColor=new Yr(t)}function Cl(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new wt(512,512),this.map=null,this.mapPass=null,this.matrix=new Vt,this._frustum=new fi,this._frameExtents=new wt(1,1),this._viewportCount=1,this._viewports=[new It(0,0,1,1)]}function Dl(){Cl.call(this,new ri(50,1,.5,500))}function Il(e,t,r,n,i,o){Ol.call(this,e,t),this.type="SpotLight",this.position.copy(sr.DefaultUp),this.updateMatrix(),this.target=new sr,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Dl}function Ll(){Cl.call(this,new ri(90,1,.5,500)),this._frameExtents=new wt(4,2),this._viewportCount=6,this._viewports=[new It(2,1,1,1),new It(0,1,1,1),new It(3,1,1,1),new It(1,1,1,1),new It(3,0,1,1),new It(1,0,1,1)],this._cubeDirections=[new xt(1,0,0),new xt(-1,0,0),new xt(0,0,1),new xt(0,0,-1),new xt(0,1,0),new xt(0,-1,0)],this._cubeUps=[new xt(0,1,0),new xt(0,1,0),new xt(0,1,0),new xt(0,1,0),new xt(0,0,1),new xt(0,0,-1)]}function Nl(e,t,r,n){Ol.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new Ll}function kl(e,t,r,n,i,o){ti.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Fl(){Cl.call(this,new kl(-5,5,5,-5,.5,500))}function jl(e,t){Ol.call(this,e,t),this.type="DirectionalLight",this.position.copy(sr.DefaultUp),this.updateMatrix(),this.target=new sr,this.shadow=new Fl}function Bl(e,t){Ol.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Ul(e,t,r,n){Ol.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function Gl(e){Ju.call(this,e),this.textures={}}xl.prototype=Object.assign(Object.create(al.prototype),{constructor:xl,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new bl(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,o=this.curves[n],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),u=0;u<s.length;u++){var l=s[u];t&&t.equals(l)||(r.push(l),t=l)}return this.autoClose&&1<r.length&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){al.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=al.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){al.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new Sl[n.type]).fromJSON(n))}return this}}),Ml.prototype=Object.assign(Object.create(xl.prototype),{constructor:Ml,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new bl(this.currentPoint.clone(),new wt(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,n){var i=new wl(this.currentPoint.clone(),new wt(e,t),new wt(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(e,t,r,n,i,o){var a=new yl(this.currentPoint.clone(),new wt(e,t),new wt(r,n),new wt(i,o));this.curves.push(a),this.currentPoint.set(i,o)},splineThru:function(e){var t=new Tl([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,n,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,r,n,i,o)},absarc:function(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},ellipse:function(e,t,r,n,i,o,a,s){var u=this.currentPoint.x,l=this.currentPoint.y;this.absellipse(e+u,t+l,r,n,i,o,a,s)},absellipse:function(e,t,r,n,i,o,a,s){var u=new sl(e,t,r,n,i,o,a,s);if(0<this.curves.length){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);this.currentPoint.copy(c)},copy:function(e){return xl.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=xl.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return xl.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Rl.prototype=Object.assign(Object.create(Ml.prototype),{constructor:Rl,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ml.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=Ml.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){Ml.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new Ml).fromJSON(n))}return this}}),Ol.prototype=Object.assign(Object.create(sr.prototype),{constructor:Ol,isLight:!0,copy:function(e){return sr.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=sr.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Pl.prototype=Object.assign(Object.create(Ol.prototype),{constructor:Pl,isHemisphereLight:!0,copy:function(e){return Ol.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Cl.prototype,{_projScreenMatrix:new Vt,_lightPositionWorld:new xt,_lookTarget:new xt,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,r=this.matrix,n=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Dl.prototype=Object.assign(Object.create(Cl.prototype),{constructor:Dl,isSpotLightShadow:!0,updateMatrices:function(e,t,r){var n=this.camera,i=2*Et.RAD2DEG*e.angle,o=this.mapSize.width/this.mapSize.height,a=e.distance||n.far;i===n.fov&&o===n.aspect&&a===n.far||(n.fov=i,n.aspect=o,n.far=a,n.updateProjectionMatrix()),Cl.prototype.updateMatrices.call(this,e,t,r)}}),Il.prototype=Object.assign(Object.create(Ol.prototype),{constructor:Il,isSpotLight:!0,copy:function(e){return Ol.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ll.prototype=Object.assign(Object.create(Cl.prototype),{constructor:Ll,isPointLightShadow:!0,updateMatrices:function(e,t,r){var n=this.camera,i=this.matrix,o=this._lightPositionWorld,a=this._lookTarget,s=this._projScreenMatrix;o.setFromMatrixPosition(e.matrixWorld),n.position.copy(o),a.copy(n.position),a.add(this._cubeDirections[r]),n.up.copy(this._cubeUps[r]),n.lookAt(a),n.updateMatrixWorld(),i.makeTranslation(-o.x,-o.y,-o.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromMatrix(s)}}),Nl.prototype=Object.assign(Object.create(Ol.prototype),{constructor:Nl,isPointLight:!0,copy:function(e){return Ol.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),kl.prototype=Object.assign(Object.create(ti.prototype),{constructor:kl,isOrthographicCamera:!0,copy:function(e,t){return ti.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,o=r+e,a=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var u=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height;o=(i+=c*(this.view.offsetX/u))+c*(this.view.width/u),s=(a-=d*(this.view.offsetY/l))-d*(this.view.height/l)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=sr.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Fl.prototype=Object.assign(Object.create(Cl.prototype),{constructor:Fl,isDirectionalLightShadow:!0,updateMatrices:function(e,t,r){Cl.prototype.updateMatrices.call(this,e,t,r)}}),jl.prototype=Object.assign(Object.create(Ol.prototype),{constructor:jl,isDirectionalLight:!0,copy:function(e){return Ol.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Bl.prototype=Object.assign(Object.create(Ol.prototype),{constructor:Bl,isAmbientLight:!0}),Ul.prototype=Object.assign(Object.create(Ol.prototype),{constructor:Ul,isRectAreaLight:!0,copy:function(e){return Ol.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Ol.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Gl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:Gl,load:function(e,t,r,n){var i=this,o=new $u(i.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new Du[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var o=e.uniforms[i];switch(n.uniforms[i]={},o.type){case"t":n.uniforms[i].value=r(o.value);break;case"c":n.uniforms[i].value=(new Yr).setHex(o.value);break;case"v2":n.uniforms[i].value=(new wt).fromArray(o.value);break;case"v3":n.uniforms[i].value=(new xt).fromArray(o.value);break;case"v4":n.uniforms[i].value=(new It).fromArray(o.value);break;case"m3":n.uniforms[i].value=(new Ot).fromArray(o.value);case"m4":n.uniforms[i].value=(new Vt).fromArray(o.value);break;default:n.uniforms[i].value=o.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)n.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.matcap&&(n.matcap=r(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),n.normalScale=(new wt).fromArray(s)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new wt).fromArray(e.clearcoatNormalScale)),n},setTextures:function(e){return this.textures=e,this}});var Hl={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function Vl(){En.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function zl(e,t,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),tn.call(this,e,t,r),this.meshPerAttribute=n||1}function Wl(e){Ju.call(this,e)}Vl.prototype=Object.assign(Object.create(En.prototype),{constructor:Vl,isInstancedBufferGeometry:!0,copy:function(e){return En.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=En.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),zl.prototype=Object.assign(Object.create(tn.prototype),{constructor:zl,isInstancedBufferAttribute:!0,copy:function(e){return tn.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=tn.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Wl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:Wl,load:function(e,t,r,n){var i=this,o=new $u(i.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=e.isInstancedBufferGeometry?new Vl:new En,r=e.data.index;if(void 0!==r){var n=new ql[r.type](r.array);t.setIndex(new tn(n,1))}var i=e.data.attributes;for(var o in i){var a=i[o],s=(n=new ql[a.type](a.array),new(a.isInstancedBufferAttribute?zl:tn)(n,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),t.addAttribute(o,s)}var u=e.data.morphAttributes;if(u)for(var o in u){for(var l=u[o],c=[],d=0,f=l.length;d<f;d++){a=l[d],s=new tn(n=new ql[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),c.push(s)}t.morphAttributes[o]=c}var h=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==h){d=0;for(var p=h.length;d!==p;++d){var m=h[d];t.addGroup(m.start,m.count,m.materialIndex)}}var g=e.data.boundingSphere;if(void 0!==g){var v=new xt;void 0!==g.center&&v.fromArray(g.center),t.boundingSphere=new Tr(v,g.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var ql={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Yl(e){Ju.call(this,e)}Yl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:Yl,load:function(n,i,e,o){var a=this,t=""===this.path?Hl.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||t;var r=new $u(a.manager);r.setPath(this.path),r.load(n,function(e){var t=null;try{t=JSON.parse(e)}catch(e){return void 0!==o&&o(e),void console.error("THREE:ObjectLoader: Can't parse "+n+".",e.message)}var r=t.metadata;void 0!==r&&void 0!==r.type&&"geometry"!==r.type.toLowerCase()?a.parse(t,i):console.error("THREE.ObjectLoader: Can't load "+n)},e,o)},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(s)}),o=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,n,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new Rl).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new Wl,i=0,o=e.length;i<o;i++){var a,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Eu[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Eu[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Eu[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Eu[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Eu[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Eu[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Eu[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Eu[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Eu[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Eu[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Eu[s.type]((new Sl[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Eu[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Eu[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var u=[],l=0,c=s.shapes.length;l<c;l++){var d=t[s.shapes[l]];u.push(d)}a=new Eu[s.type](u,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(u=[],l=0,c=s.shapes.length;l<c;l++){d=t[s.shapes[l]];u.push(d)}var f=s.options.extrudePath;void 0!==f&&(s.options.extrudePath=(new Sl[f.type]).fromJSON(f)),a=new Eu[s.type](u,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),r[s.uuid]=a}return r},parseMaterials:function(e,t){var r={},n={};if(void 0!==e){var i=new Gl;i.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var u=[],l=0;l<s.materials.length;l++){var c=s.materials[l];void 0===r[c.uuid]&&(r[c.uuid]=i.parse(c)),u.push(r[c.uuid])}n[s.uuid]=u}else void 0===r[s.uuid]&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=qu.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),t.push(i)}return t},parseImages:function(e,t){var r=this,n={};function i(e){return r.manager.itemStart(e),o.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}if(void 0!==e&&0<e.length){var o=new nl(new Xu(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var u=e[a],l=u.url;if(Array.isArray(l)){n[u.uuid]=[];for(var c=0,d=l.length;c<d;c++){var f=l[c],h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(f)?f:r.resourcePath+f;n[u.uuid].push(i(h))}}else{h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:r.resourcePath+u.url;n[u.uuid]=i(h)}}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var a,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new Ci(t[s.image]):new Dt(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,Xl)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],Ql),a.wrapT=r(s.wrap[1],Ql)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,Jl)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,Jl)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),n[s.uuid]=a}return n},parseObject:function(e,t,o){var r;function n(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function i(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];void 0===o[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(o[i])}return t}return void 0===o[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),o[e]}}switch(e.type){case"Scene":r=new ur,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new Yr(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new ga(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new ma(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new ri(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new kl(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Bl(e.color,e.intensity);break;case"DirectionalLight":r=new jl(e.color,e.intensity);break;case"PointLight":r=new Nl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Ul(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Il(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Pl(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=n(e.geometry),s=i(e.material);r=a.bones&&0<a.bones.length?new Fa(a,s):new Bn(a,s),void 0!==e.drawMode&&r.setDrawMode(e.drawMode);break;case"LOD":r=new ka;break;case"Line":r=new Ka(n(e.geometry),i(e.material),e.mode);break;case"LineLoop":r=new Za(n(e.geometry),i(e.material));break;case"LineSegments":r=new Ja(n(e.geometry),i(e.material));break;case"PointCloud":case"Points":r=new is(n(e.geometry),i(e.material));break;case"Sprite":r=new Da(i(e.material));break;case"Group":r=new aa;break;default:r=new sr}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var u=e.children,l=0;l<u.length;l++)r.add(this.parseObject(u[l],t,o));if("LOD"===e.type)for(var c=e.levels,d=0;d<c.length;d++){var f=c[d],h=r.getObjectByProperty("uuid",f.object);void 0!==h&&r.addLevel(h,f.distance)}return r}});var Kl,Xl={UVMapping:300,CubeReflectionMapping:de,CubeRefractionMapping:fe,EquirectangularReflectionMapping:he,EquirectangularRefractionMapping:pe,SphericalReflectionMapping:me,CubeUVReflectionMapping:ge,CubeUVRefractionMapping:ve},Ql={RepeatWrapping:E,ClampToEdgeWrapping:L,MirroredRepeatWrapping:w},Jl={NearestFilter:ye,NearestMipmapNearestFilter:_e,NearestMipmapLinearFilter:be,LinearFilter:Ae,LinearMipmapNearestFilter:A,LinearMipmapLinearFilter:T};function Zl(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Ju.call(this,e),this.options=void 0}function $l(){this.type="ShapePath",this.color=new Yr,this.subPaths=[],this.currentPath=null}function ec(e){this.type="Font",this.data=e}function tc(e,t,r,n,i){var o=i.glyphs[e]||i.glyphs["?"];if(o){var a,s,u,l,c,d,f,h,p=new $l;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":a=m[g++]*t+r,s=m[g++]*t+n,p.moveTo(a,s);break;case"l":a=m[g++]*t+r,s=m[g++]*t+n,p.lineTo(a,s);break;case"q":u=m[g++]*t+r,l=m[g++]*t+n,c=m[g++]*t+r,d=m[g++]*t+n,p.quadraticCurveTo(c,d,u,l);break;case"b":u=m[g++]*t+r,l=m[g++]*t+n,c=m[g++]*t+r,d=m[g++]*t+n,f=m[g++]*t+r,h=m[g++]*t+n,p.bezierCurveTo(c,d,f,h,u,l)}}return{offsetX:o.ha*t,path:p}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function rc(e){Ju.call(this,e)}Zl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:Zl,setOptions:function(e){return this.options=e,this},load:function(t,r,e,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Ku.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){r&&r(o),i.manager.itemEnd(t)},0),o;fetch(t).then(function(e){return e.blob()}).then(function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)}).then(function(e){Ku.add(t,e),r&&r(e),i.manager.itemEnd(t)}).catch(function(e){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}),i.manager.itemStart(t)}}),Object.assign($l.prototype,{moveTo:function(e,t){this.currentPath=new Ml,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,n){this.currentPath.quadraticCurveTo(e,t,r,n)},bezierCurveTo:function(e,t,r,n,i,o){this.currentPath.bezierCurveTo(e,t,r,n,i,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],o=new Rl;o.curves=i.curves,t.push(o)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=t[i],s=t[o],u=s.x-a.x,l=s.y-a.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(a=t[o],u=-u,s=t[i],l=-l),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var c=l*(e.x-a.x)-u*(e.y-a.y);if(0==c)return!0;if(c<0)continue;n=!n}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return n}var i=Qs.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return r(o);var a,s,u,l=[];if(1===o.length)return s=o[0],(u=new Rl).curves=s.curves,l.push(u),l;var c=!i(o[0].getPoints());c=e?!c:c;var d,f,h=[],p=[],m=[],g=0;p[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=i(d=(s=o[v]).getPoints()),(a=e?!a:a)?(!c&&p[g]&&g++,p[g]={s:new Rl,p:d},p[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:d[0]});if(!p[0])return r(o);if(1<p.length){for(var _=!1,b=[],E=0,w=p.length;E<w;E++)h[E]=[];for(E=0,w=p.length;E<w;E++)for(var A=m[E],T=0;T<A.length;T++){for(var S=A[T],x=!0,M=0;M<p.length;M++)n(S.p,p[M].p)&&(E!==M&&b.push({froms:E,tos:M,hole:T}),x?(x=!1,h[M].push(S)):_=!0);x&&h[E].push(S)}0<b.length&&(_||(m=h))}v=0;for(var R=p.length;v<R;v++){u=p[v].s,l.push(u);for(var O=0,P=(f=m[v]).length;O<P;O++)u.holes.push(f[O].h)}return l}}),Object.assign(ec.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],n=function(e,t,r){for(var n=Array.from?Array.from(e):String(e).split(""),i=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,a=[],s=0,u=0,l=0;l<n.length;l++){var c=n[l];if("\n"===c)s=0,u-=o;else{var d=tc(c,i,s,u,r);s+=d.offsetX,a.push(d.path)}}return a}(e,t,this.data),i=0,o=n.length;i<o;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),rc.prototype=Object.assign(Object.create(Ju.prototype),{constructor:rc,load:function(e,n,t,r){var i=this,o=new $u(this.manager);o.setPath(this.path),o.load(e,function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var e=i.parse(r);n&&n(e)},t,r)},parse:function(e){return new ec(e)}});var nc={getContext:function(){return void 0===Kl&&(Kl=new(window.AudioContext||window.webkitAudioContext)),Kl},setContext:function(e){Kl=e}};function ic(e){Ju.call(this,e)}function oc(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new xt)}function ac(e,t){Ol.call(this,void 0,t),this.sh=void 0!==e?e:new oc}function sc(e,t,r){ac.call(this,void 0,r);var n=(new Yr).set(e),i=(new Yr).set(t),o=new xt(n.r,n.g,n.b),a=new xt(i.r,i.g,i.b),s=Math.sqrt(Math.PI),u=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(u)}function uc(e,t){ac.call(this,void 0,t);var r=(new Yr).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}ic.prototype=Object.assign(Object.create(Ju.prototype),{constructor:ic,load:function(e,r,t,n){var i=new $u(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,function(e){var t=e.slice(0);nc.getContext().decodeAudioData(t,function(e){r(e)})},t,n)}}),Object.assign(oc.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var r=e.x,n=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScale(o[1],.488603*n),t.addScale(o[2],.488603*i),t.addScale(o[3],.488603*r),t.addScale(o[4],r*n*1.092548),t.addScale(o[5],n*i*1.092548),t.addScale(o[6],.315392*(3*i*i-1)),t.addScale(o[7],r*i*1.092548),t.addScale(o[8],.546274*(r*r-n*n)),t},getIrradianceAt:function(e,t){var r=e.x,n=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScale(o[1],1.023328*n),t.addScale(o[2],1.023328*i),t.addScale(o[3],1.023328*r),t.addScale(o[4],.858086*r*n),t.addScale(o[5],.858086*n*i),t.addScale(o[6],.743125*i*i-.247708),t.addScale(o[7],.858086*r*i),t.addScale(o[8],.429043*(r*r-n*n)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].fromArray(e,t+3*n);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].toArray(e,t+3*n);return e}}),Object.assign(oc,{getBasisAt:function(e,t){var r=e.x,n=e.y,i=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-n*n)}}),ac.prototype=Object.assign(Object.create(Ol.prototype),{constructor:ac,isLightProbe:!0,copy:function(e){return Ol.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return Ol.prototype.toJSON.call(this,e)}}),sc.prototype=Object.assign(Object.create(ac.prototype),{constructor:sc,isHemisphereLightProbe:!0,copy:function(e){return ac.prototype.copy.call(this,e),this},toJSON:function(e){return ac.prototype.toJSON.call(this,e)}}),uc.prototype=Object.assign(Object.create(ac.prototype),{constructor:uc,isAmbientLightProbe:!0,copy:function(e){return ac.prototype.copy.call(this,e),this},toJSON:function(e){return ac.prototype.toJSON.call(this,e)}});var lc=new Vt,cc=new Vt;function dc(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ri,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ri,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function fc(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(dc.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var r,n,i=e.projectionMatrix.clone(),o=t.eyeSep/2,a=o*t.near/t.focus,s=t.near*Math.tan(Et.DEG2RAD*t.fov*.5)/t.zoom;cc.elements[12]=-o,lc.elements[12]=o,r=-s*t.aspect+a,n=s*t.aspect+a,i.elements[0]=2*t.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraL.projectionMatrix.copy(i),r=-s*t.aspect-a,n=s*t.aspect-a,i.elements[0]=2*t.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(cc),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(lc)}}),Object.assign(fc.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var hc=new xt,pc=new At,mc=new xt,gc=new xt;function vc(){sr.call(this),this.type="AudioListener",this.context=nc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new fc}function yc(e){sr.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}vc.prototype=Object.assign(Object.create(sr.prototype),{constructor:vc,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){sr.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(hc,pc,mc),gc.set(0,0,-1).applyQuaternion(pc),t.positionX){var n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(hc.x,n),t.positionY.linearRampToValueAtTime(hc.y,n),t.positionZ.linearRampToValueAtTime(hc.z,n),t.forwardX.linearRampToValueAtTime(gc.x,n),t.forwardY.linearRampToValueAtTime(gc.y,n),t.forwardZ.linearRampToValueAtTime(gc.z,n),t.upX.linearRampToValueAtTime(r.x,n),t.upY.linearRampToValueAtTime(r.y,n),t.upZ.linearRampToValueAtTime(r.z,n)}else t.setPosition(hc.x,hc.y,hc.z),t.setOrientation(gc.x,gc.y,gc.z,r.x,r.y,r.z)}}),yc.prototype=Object.assign(Object.create(sr.prototype),{constructor:yc,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e=e||[],!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var _c=new xt,bc=new At,Ec=new xt,wc=new xt;function Ac(e){yc.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Tc(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Sc(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Ac.prototype=Object.assign(Object.create(yc.prototype),{constructor:Ac,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(e){if(sr.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(_c,bc,Ec),wc.set(0,0,1).applyQuaternion(bc);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(_c.x,r),t.positionY.linearRampToValueAtTime(_c.y,r),t.positionZ.linearRampToValueAtTime(_c.z,r),t.orientationX.linearRampToValueAtTime(wc.x,r),t.orientationY.linearRampToValueAtTime(wc.y,r),t.orientationZ.linearRampToValueAtTime(wc.z,r)}else t.setPosition(_c.x,_c.y,_c.z),t.setOrientation(wc.x,wc.y,wc.z)}}}),Object.assign(Tc.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(Sc.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)r[i+a]=r[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var a=3*t;this._mixBufferRegion(r,n,a,1-i,t)}for(var s=t,u=t+t;s!==u;++s)if(r[s]!==r[s+t]){o.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,o=n;i!==o;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,i){if(.5<=n)for(var o=0;o!==i;++o)e[t+o]=e[r+o]},_slerp:function(e,t,r,n){At.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var o=1-n,a=0;a!==i;++a){var s=t+a;e[s]=e[s]*o+e[r+a]*n}}});var xc="\\[\\]\\.:\\/",Mc=new RegExp("["+xc+"]","g"),Rc="[^"+xc+"]",Oc="[^"+xc.replace("\\.","")+"]",Pc=/((?:WC+[\/:])*)/.source.replace("WC",Rc),Cc=/(WCOD+)?/.source.replace("WCOD",Oc),Dc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Rc),Ic=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Rc),Lc=new RegExp("^"+Pc+Cc+Dc+Ic+"$"),Nc=["material","materials","bones"];function kc(e,t,r){var n=r||Fc.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function Fc(e,t,r){this.path=t,this.parsedPath=r||Fc.parseTrackName(t),this.node=Fc.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function jc(){this.uuid=Et.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function Bc(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,o=new Array(i),a={endingStart:2400,endingEnd:2400},s=0;s!==i;++s){var u=n[s].createInterpolant(null);(o[s]=u).settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Uc(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Gc(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Hc(e,t,r){va.call(this,e,t),this.meshPerAttribute=r||1}function Vc(e,t,r,n){this.ray=new Dr(e,t),this.near=r||0,this.far=n||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function zc(e,t){return e.distance-t.distance}function Wc(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n))for(var i=e.children,o=0,a=i.length;o<a;o++)Wc(i[o],t,r,!0)}function qc(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function Yc(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}Object.assign(kc.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(Fc,{Composite:kc,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new Fc.Composite(e,t,r):new Fc(e,t,r)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Mc,"")},parseTrackName:function(e){var t=Lc.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==Nc.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},findNode:function(e,i){if(!i||""===i||"root"===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(i);if(void 0!==t)return t}if(e.children){var o=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.name===i||r.uuid===i)return r;var n=o(r.children);if(n)return n}return null},r=o(e.children);if(r)return r}return null}}),Object.assign(Fc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=Fc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var o=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[n];if(void 0!==s){var u=this.Versioning.None;void 0!==(this.targetObject=e).needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===i){i=a;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][u]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Fc.prototype,{_getValue_unbound:Fc.prototype.getValue,_setValue_unbound:Fc.prototype.setValue}),Object.assign(jc.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,u=void 0,l=0,c=arguments.length;l!==c;++l){var d=arguments[l],f=d.uuid,h=n[f];if(void 0===h){h=t++,n[f]=h,e.push(d);for(var p=0,m=s;p!==m;++p)a[p].push(new Fc(d,i[p],o[p]))}else if(h<r){u=e[h];var g=--r,v=e[g];e[n[v.uuid]=h]=v,e[n[f]=g]=d;for(p=0,m=s;p!==m;++p){var y=a[p],_=y[g],b=y[h];y[h]=_,void 0===b&&(b=new Fc(d,i[p],o[p])),y[g]=b}}else e[h]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],u=s.uuid,l=r[u];if(void 0!==l&&t<=l){var c=t++,d=e[c];e[r[d.uuid]=l]=d,e[r[u]=c]=s;for(var f=0,h=i;f!==h;++f){var p=n[f],m=p[c],g=p[l];p[l]=m,p[c]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var u=arguments[a].uuid,l=n[u];if(void 0!==l)if(delete n[u],l<r){var c=--r,d=e[c],f=e[v=--t];e[n[d.uuid]=l]=d,e[n[f.uuid]=c]=f,e.pop();for(var h=0,p=o;h!==p;++h){var m=(y=i[h])[c],g=y[v];y[l]=m,y[c]=g,y.pop()}}else{var v;e[n[(f=e[v=--t]).uuid]=l]=f,e.pop();for(h=0,p=o;h!==p;++h){var y;(y=i[h])[l]=y[v],y.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,a=this._parsedPaths,s=this._objects,u=s.length,l=this.nCachedObjects_,c=new Array(u);n=i.length,r[e]=n,o.push(e),a.push(t),i.push(c);for(var d=l,f=s.length;d!==f;++d){var h=s[d];c[d]=new Fc(h,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];o[t[e[a]]=r]=s,o.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}),Object.assign(Bc.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,o=i/n,a=n/i;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=i,s[1]=i+r,u[0]=e/a,u[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*r;if(o<0||0===r)return;this._startTime=null,t=r*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(0<s)for(var u=this._interpolants,l=this._propertyBindings,c=0,d=u.length;c!==d;++c)u[c].evaluate(a),l[c].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,n=this.loop,i=this._loopCount,o=2202===n;if(0===e)return-1===i?t:o&&1==(1&i)?r-t:t;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r<=t)t=r;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(0<=e?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r<=t||t<0){var a=Math.floor(t/r);t-=r*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?r:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1});else{if(1==s){var u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=t;if(o&&1==(1&i))return r-t}return t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=r,this}}),Uc.prototype=Object.assign(Object.create(t.prototype),{constructor:Uc,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,o=e._propertyBindings,a=e._interpolants,s=r.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==i;++c){var d=n[c],f=d.name,h=l[f];if(void 0!==h)o[c]=h;else{if(void 0!==(h=o[c])){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,s,f));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(h=new Sc(Fc.create(r,f,p),d.ValueTypeName,d.getValueSize())).referenceCount,this._addInactiveBinding(h,s,f),o[c]=h}a[c].resultBuffer=h.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;t[r._cacheIndex=n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,u=s[s.length-1],l=e._byClipCacheIndex;s[u._byClipCacheIndex=l]=u,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];t[e._cacheIndex=n]=e,t[i._cacheIndex=r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];t[e._cacheIndex=n]=e,t[i._cacheIndex=r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],o=this._bindings;void 0===i&&(i={},n[t]=i),(i[r]=e)._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,a=o[n],s=t[t.length-1],u=e._cacheIndex;t[s._cacheIndex=u]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[n]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];t[e._cacheIndex=n]=e,t[i._cacheIndex=r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];t[e._cacheIndex=n]=e,t[i._cacheIndex=r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&(e[(r=new ku(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];t[e.__cacheIndex=n]=e,t[i.__cacheIndex=r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?qu.findByName(r,e):e,o=null!==i?i.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var u=a.actionByRoot[n];if(void 0!==u)return u;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var l=new Bc(this,i,t);return this._bindAction(l,s),this._addInactiveAction(l,o,n),l},existingAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?qu.findByName(r,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0;for(var i=this._nActiveBindings=0;i!==t;++i)e[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,a=0;a!==r;++a){t[a]._update(n,e,i,o)}var s=this._bindings,u=this._nActiveBindings;for(a=0;a!==u;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var u=o[a];this._deactivateAction(u);var l=u._cacheIndex,c=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,t[c._cacheIndex=l]=c,t.pop(),this._removeInactiveBindingsForAction(u)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Gc.prototype.clone=function(){return new Gc(void 0===this.value.clone?this.value:this.value.clone())},Hc.prototype=Object.assign(Object.create(va.prototype),{constructor:Hc,isInstancedInterleavedBuffer:!0,copy:function(e){return va.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Vc.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return Wc(e,this,n,t),n.sort(zc),n},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=e.length;i<o;i++)Wc(e[i],this,n,t);return n.sort(zc),n}}),Object.assign(qc.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Et.clamp(t/this.radius,-1,1))),this}}),Object.assign(Yc.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}});var Kc=new wt;function Xc(e,t){this.min=void 0!==e?e:new wt(1/0,1/0),this.max=void 0!==t?t:new wt(-1/0,-1/0)}Object.assign(Xc.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=Kc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new wt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new wt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new wt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new wt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Kc.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Qc=new xt,Jc=new xt;function Zc(e,t){this.start=void 0!==e?e:new xt,this.end=void 0!==t?t:new xt}function $c(e){sr.call(this),this.material=e,this.render=function(){}}Object.assign(Zc.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new xt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new xt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new xt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Qc.subVectors(e,this.start),Jc.subVectors(this.end,this.start);var r=Jc.dot(Jc),n=Jc.dot(Qc)/r;return t&&(n=Et.clamp(n,0,1)),n},closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new xt),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),(($c.prototype=Object.create(sr.prototype)).constructor=$c).prototype.isImmediateRenderObject=!0;var ed=new xt,td=new xt,rd=new Ot,nd=["a","b","c"];function id(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var u=new En,l=new cn(2*a*3,3);u.addAttribute("position",l),Ja.call(this,u,new Ha({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}((id.prototype=Object.create(Ja.prototype)).constructor=id).prototype.update=function(){this.object.updateMatrixWorld(!0),rd.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry;if(r&&r.isGeometry)for(var n=r.vertices,i=r.faces,o=0,a=0,s=i.length;a<s;a++)for(var u=i[a],l=0,c=u.vertexNormals.length;l<c;l++){var d=n[u[nd[l]]],f=u.vertexNormals[l];ed.copy(d).applyMatrix4(e),td.copy(f).applyMatrix3(rd).normalize().multiplyScalar(this.size).add(ed),t.setXYZ(o,ed.x,ed.y,ed.z),o+=1,t.setXYZ(o,td.x,td.y,td.z),o+=1}else if(r&&r.isBufferGeometry){var h=r.attributes.position,p=r.attributes.normal;for(o=0,l=0,c=h.count;l<c;l++)ed.set(h.getX(l),h.getY(l),h.getZ(l)).applyMatrix4(e),td.set(p.getX(l),p.getY(l),p.getZ(l)),td.applyMatrix3(rd).normalize().multiplyScalar(this.size).add(ed),t.setXYZ(o,ed.x,ed.y,ed.z),o+=1,t.setXYZ(o,td.x,td.y,td.z),o+=1}t.needsUpdate=!0};var od=new xt;function ad(e,t){sr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new En,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new cn(n,3));var u=new Ha({fog:!1});this.cone=new Ja(r,u),this.add(this.cone),this.update()}((ad.prototype=Object.create(sr.prototype)).constructor=ad).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},ad.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),od.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(od),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var sd=new xt,ud=new Vt,ld=new Vt;function cd(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new En,n=[],i=[],o=new Yr(0,0,1),a=new Yr(0,1,0),s=0;s<t.length;s++){var u=t[s];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.addAttribute("position",new cn(n,3)),r.addAttribute("color",new cn(i,3));var l=new Ha({vertexColors:v,depthTest:!1,depthWrite:!1,transparent:!0});Ja.call(this,r,l),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function dd(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new au(t,4,2),i=new en({wireframe:!0,fog:!1});Bn.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function fd(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var r=new En;r.addAttribute("position",new cn([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var n=new Ha({fog:!1});Ka.call(this,r,n);var i=new En;i.addAttribute("position",new cn([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new Bn(i,new en({side:Ee,fog:!1}))),this.update()}((cd.prototype=Object.create(Ja.prototype)).constructor=cd).prototype.updateMatrixWorld=function(e){var t=this.bones,r=this.geometry,n=r.getAttribute("position");ld.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<t.length;i++){var a=t[i];a.parent&&a.parent.isBone&&(ud.multiplyMatrices(ld,a.matrixWorld),sd.setFromMatrixPosition(ud),n.setXYZ(o,sd.x,sd.y,sd.z),ud.multiplyMatrices(ld,a.parent.matrixWorld),sd.setFromMatrixPosition(ud),n.setXYZ(o+1,sd.x,sd.y,sd.z),o+=2)}r.getAttribute("position").needsUpdate=!0,sr.prototype.updateMatrixWorld.call(this,e)},((dd.prototype=Object.create(Bn.prototype)).constructor=dd).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},dd.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},((fd.prototype=Object.create(Ka.prototype)).constructor=fd).prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);1<t&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},fd.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var hd=new xt,pd=new Yr,md=new Yr;function gd(e,t,r){sr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new ys(t);n.rotateY(.5*Math.PI),this.material=new en({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=v);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.addAttribute("color",new tn(o,3)),this.add(new Bn(n,this.material)),this.update()}function vd(e,t){this.lightProbe=e,this.size=t;var r={GAMMA_OUTPUT:""},n=new ei({defines:r,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),i=new au(1,32,16);Bn.call(this,i,n),this.onBeforeRender()}function yd(e,t,r,n){e=e||10,t=t||10,r=new Yr(void 0!==r?r:4473924),n=new Yr(void 0!==n?n:8947848);for(var i=t/2,o=e/t,a=e/2,s=[],u=[],l=0,c=0,d=-a;l<=t;l++,d+=o){s.push(-a,0,d,a,0,d),s.push(d,0,-a,d,0,a);var f=l===i?r:n;f.toArray(u,c),c+=3,f.toArray(u,c),c+=3,f.toArray(u,c),c+=3,f.toArray(u,c),c+=3}var h=new En;h.addAttribute("position",new cn(s,3)),h.addAttribute("color",new cn(u,3));var p=new Ha({vertexColors:v});Ja.call(this,h,p)}function _d(e,t,r,n,i,o){e=e||10,t=t||16,r=r||8,n=n||64,i=new Yr(void 0!==i?i:4473924),o=new Yr(void 0!==o?o:8947848);var a,s,u,l,c,d,f,h=[],p=[];for(l=0;l<=t;l++)u=l/t*(2*Math.PI),a=Math.sin(u)*e,s=Math.cos(u)*e,h.push(0,0,0),h.push(a,0,s),f=1&l?i:o,p.push(f.r,f.g,f.b),p.push(f.r,f.g,f.b);for(l=0;l<=r;l++)for(f=1&l?i:o,d=e-e/r*l,c=0;c<n;c++)u=c/n*(2*Math.PI),a=Math.sin(u)*d,s=Math.cos(u)*d,h.push(a,0,s),p.push(f.r,f.g,f.b),u=(c+1)/n*(2*Math.PI),a=Math.sin(u)*d,s=Math.cos(u)*d,h.push(a,0,s),p.push(f.r,f.g,f.b);var m=new En;m.addAttribute("position",new cn(h,3)),m.addAttribute("color",new cn(p,3));var g=new Ha({vertexColors:v});Ja.call(this,m,g)}function bd(e,t,r,n){this.audio=e,this.range=t||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=n||2;var i=new En,o=this.divisionsInnerAngle+2*this.divisionsOuterAngle,a=new Float32Array(3*(3*o+3));i.addAttribute("position",new tn(a,3));var s=new Ha({color:65280}),u=new Ha({color:16776960});Ka.call(this,i,[u,s]),this.update()}((gd.prototype=Object.create(sr.prototype)).constructor=gd).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},gd.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");pd.copy(this.light.color),md.copy(this.light.groundColor);for(var r=0,n=t.count;r<n;r++){var i=r<n/2?pd:md;t.setXYZ(r,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(hd.setFromMatrixPosition(this.light.matrixWorld).negate())},((vd.prototype=Object.create(Bn.prototype)).constructor=vd).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},vd.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},yd.prototype=Object.assign(Object.create(Ja.prototype),{constructor:yd,copy:function(e){return Ja.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),(_d.prototype=Object.create(Ja.prototype)).constructor=_d,((bd.prototype=Object.create(Ka.prototype)).constructor=bd).prototype.update=function(){var o,a,e=this.audio,s=this.range,t=this.divisionsInnerAngle,r=this.divisionsOuterAngle,n=Et.degToRad(e.panner.coneInnerAngle),i=Et.degToRad(e.panner.coneOuterAngle),u=n/2,l=i/2,c=0,d=0,f=this.geometry,h=f.attributes.position;function p(e,t,r,n){var i=(t-e)/r;for(h.setXYZ(c,0,0,0),d++,o=e;o<t;o+=i)a=c+d,h.setXYZ(a,Math.sin(o)*s,0,Math.cos(o)*s),h.setXYZ(a+1,Math.sin(Math.min(o+i,t))*s,0,Math.cos(Math.min(o+i,t))*s),h.setXYZ(a+2,0,0,0),d+=3;f.addGroup(c,d,n),c+=d,d=0}f.clearGroups(),p(-l,-u,r,0),p(-u,u,t,1),p(u,l,r,0),h.needsUpdate=!0,n===i&&(this.material[0].visible=!1)},bd.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};var Ed=new xt,wd=new xt,Ad=new Ot;function Td(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var u=new En,l=new cn(2*a*3,3);u.addAttribute("position",l),Ja.call(this,u,new Ha({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}((Td.prototype=Object.create(Ja.prototype)).constructor=Td).prototype.update=function(){this.object.updateMatrixWorld(!0),Ad.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,n=r.vertices,i=r.faces,o=0,a=0,s=i.length;a<s;a++){var u=i[a],l=u.normal;Ed.copy(n[u.a]).add(n[u.b]).add(n[u.c]).divideScalar(3).applyMatrix4(e),wd.copy(l).applyMatrix3(Ad).normalize().multiplyScalar(this.size).add(Ed),t.setXYZ(o,Ed.x,Ed.y,Ed.z),o+=1,t.setXYZ(o,wd.x,wd.y,wd.z),o+=1}t.needsUpdate=!0};var Sd=new xt,xd=new xt,Md=new xt;function Rd(e,t,r){sr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new En;n.addAttribute("position",new cn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new Ha({fog:!1});this.lightPlane=new Ka(n,i),this.add(this.lightPlane),(n=new En).addAttribute("position",new cn([0,0,0,0,0,1],3)),this.targetLine=new Ka(n,i),this.add(this.targetLine),this.update()}((Rd.prototype=Object.create(sr.prototype)).constructor=Rd).prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Rd.prototype.update=function(){Sd.setFromMatrixPosition(this.light.matrixWorld),xd.setFromMatrixPosition(this.light.target.matrixWorld),Md.subVectors(xd,Sd),this.lightPlane.lookAt(xd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(xd),this.targetLine.scale.z=Md.length()};var Od=new xt,Pd=new ti;function Cd(e){var t=new En,r=new Ha({color:16777215,vertexColors:1}),n=[],i=[],o={},a=new Yr(16755200),s=new Yr(16711680),u=new Yr(43775),l=new Yr(16777215),c=new Yr(3355443);function d(e,t,r){f(e,r),f(t,r)}function f(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}d("n1","n2",a),d("n2","n4",a),d("n4","n3",a),d("n3","n1",a),d("f1","f2",a),d("f2","f4",a),d("f4","f3",a),d("f3","f1",a),d("n1","f1",a),d("n2","f2",a),d("n3","f3",a),d("n4","f4",a),d("p","n1",s),d("p","n2",s),d("p","n3",s),d("p","n4",s),d("u1","u2",u),d("u2","u3",u),d("u3","u1",u),d("c","t",l),d("p","c",c),d("cn1","cn2",c),d("cn3","cn4",c),d("cf1","cf2",c),d("cf3","cf4",c),t.addAttribute("position",new cn(n,3)),t.addAttribute("color",new cn(i,3)),Ja.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Dd(e,t,r,n,i,o,a){Od.set(i,o,a).unproject(n);var s=t[e];if(void 0!==s)for(var u=r.getAttribute("position"),l=0,c=s.length;l<c;l++)u.setXYZ(s[l],Od.x,Od.y,Od.z)}((Cd.prototype=Object.create(Ja.prototype)).constructor=Cd).prototype.update=function(){var e=this.geometry,t=this.pointMap;Pd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Dd("c",t,e,Pd,0,0,-1),Dd("t",t,e,Pd,0,0,1),Dd("n1",t,e,Pd,-1,-1,-1),Dd("n2",t,e,Pd,1,-1,-1),Dd("n3",t,e,Pd,-1,1,-1),Dd("n4",t,e,Pd,1,1,-1),Dd("f1",t,e,Pd,-1,-1,1),Dd("f2",t,e,Pd,1,-1,1),Dd("f3",t,e,Pd,-1,1,1),Dd("f4",t,e,Pd,1,1,1),Dd("u1",t,e,Pd,.7,1.1,-1),Dd("u2",t,e,Pd,-.7,1.1,-1),Dd("u3",t,e,Pd,0,2,-1),Dd("cf1",t,e,Pd,-1,0,1),Dd("cf2",t,e,Pd,1,0,1),Dd("cf3",t,e,Pd,0,-1,1),Dd("cf4",t,e,Pd,0,1,1),Dd("cn1",t,e,Pd,-1,0,-1),Dd("cn2",t,e,Pd,1,0,-1),Dd("cn3",t,e,Pd,0,-1,-1),Dd("cn4",t,e,Pd,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Id=new Er;function Ld(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new En;i.setIndex(new tn(r,1)),i.addAttribute("position",new tn(n,3)),Ja.call(this,i,new Ha({color:t})),this.matrixAutoUpdate=!1,this.update()}function Nd(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new En;n.setIndex(new tn(r,1)),n.addAttribute("position",new cn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Ja.call(this,n,new Ha({color:t})),this.geometry.computeBoundingSphere()}function kd(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new En;i.addAttribute("position",new cn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Ka.call(this,i,new Ha({color:n}));var o=new En;o.addAttribute("position",new cn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Bn(o,new en({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}((Ld.prototype=Object.create(Ja.prototype)).constructor=Ld).prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Id.setFromObject(this.object),!Id.isEmpty()){var t=Id.min,r=Id.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=t.x,i[4]=r.y,i[5]=r.z,i[6]=t.x,i[7]=t.y,i[8]=r.z,i[9]=r.x,i[10]=t.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=t.z,i[15]=t.x,i[16]=r.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=r.x,i[22]=t.y,i[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Ld.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Ld.prototype.copy=function(e){return Ja.prototype.copy.call(this,e),this.object=e.object,this},Ld.prototype.clone=function(){return(new this.constructor).copy(this)},((Nd.prototype=Object.create(Ja.prototype)).constructor=Nd).prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),sr.prototype.updateMatrixWorld.call(this,e))},((kd.prototype=Object.create(Ka.prototype)).constructor=kd).prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Ee:I,this.lookAt(this.plane.normal),sr.prototype.updateMatrixWorld.call(this,e)};var Fd,jd,Bd=new xt;function Ud(e,t,r,n,i,o){sr.call(this),void 0===e&&(e=new xt(0,0,1)),void 0===t&&(t=new xt(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===Fd&&((Fd=new En).addAttribute("position",new cn([0,0,0,0,1,0],3)),(jd=new gu(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Ka(Fd,new Ha({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Bn(jd,new en({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,o)}function Gd(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new En;r.addAttribute("position",new cn(t,3)),r.addAttribute("color",new cn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new Ha({vertexColors:v});Ja.call(this,r,n)}((Ud.prototype=Object.create(sr.prototype)).constructor=Ud).prototype.setDirection=function(e){if(.99999<e.y)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Bd.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Bd,t)}},Ud.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Ud.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Ud.prototype.copy=function(e){return sr.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Ud.prototype.clone=function(){return(new this.constructor).copy(this)},(Gd.prototype=Object.create(Ja.prototype)).constructor=Gd;function Hd(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),pl.call(this,e),this.type="catmullrom",this.closed=!0}function Vd(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),pl.call(this,e),this.type="catmullrom"}function zd(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),pl.call(this,e),this.type="catmullrom"}al.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(al.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Object.assign(xl.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new qn,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new xt(i.x,i.y,i.z||0))}return t}}),Object.assign(Ml.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Hd.prototype=Object.create(pl.prototype),Vd.prototype=Object.create(pl.prototype),zd.prototype=Object.create(pl.prototype),Object.assign(zd.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),yd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},cd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Ju.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Hl.extractUrlBase(e)}}),Object.assign(Yl.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Xc.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Er.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Zc.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Et,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Et.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Et.ceilPowerOfTwo(e)}}),Object.assign(Ot.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Vt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new xt).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,o)}}),li.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},At.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Dr.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Vr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Vr,{barycoordFromPoint:function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Vr.getBarycoord(e,t,r,n,i)},normal:function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Vr.getNormal(e,t,r,n)}}),Object.assign(Rl.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new $s(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new du(this,e)}}),Object.assign(wt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(xt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(It.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(qn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(sr.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(sr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(ka.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ua.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Fa.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(al.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),ri.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Ol.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(tn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(En.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(En.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(eu.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Gc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties($r.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Yr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(xu.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ei.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(pa.prototype,{clearTarget:function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(pa.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}}}),Object.defineProperties(ra.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ii.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(Lt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(fa.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),yc.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new ic).load(e,function(e){t.setBuffer(e)}),this},Tc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ni.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Wd={merge:function(e,t,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Pt.crossOrigin=void 0,Pt.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new ol;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,r,void 0,n);return t&&(o.mapping=t),o},Pt.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new il;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,r,void 0,n);return t&&(o.mapping=t),o},Pt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Pt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var qd={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.WebGLMultisampleRenderTarget=Nt,e.WebGLRenderTargetCube=ii,e.WebGLRenderTarget=Lt,e.WebGLRenderer=pa,e.ShaderLib=mi,e.UniformsLib=pi,e.UniformsUtils=Jn,e.ShaderChunk=hi,e.FogExp2=ma,e.Fog=ga,e.Scene=ur,e.Sprite=Da,e.LOD=ka,e.SkinnedMesh=Fa,e.Skeleton=Ua,e.Bone=Ga,e.Mesh=Bn,e.LineSegments=Ja,e.LineLoop=Za,e.Line=Ka,e.Points=is,e.Group=aa,e.VideoTexture=as,e.DataTexture=oi,e.DataTexture2DArray=Di,e.DataTexture3D=Ii,e.CompressedTexture=ss,e.CubeTexture=Ci,e.CanvasTexture=us,e.DepthTexture=ls,e.Texture=Dt,e.AnimationLoader=el,e.CompressedTextureLoader=tl,e.DataTextureLoader=rl,e.CubeTextureLoader=il,e.TextureLoader=ol,e.ObjectLoader=Yl,e.MaterialLoader=Gl,e.BufferGeometryLoader=Wl,e.DefaultLoadingManager=Qu,e.LoadingManager=Xu,e.ImageLoader=nl,e.ImageBitmapLoader=Zl,e.FontLoader=rc,e.FileLoader=$u,e.Loader=Ju,e.LoaderUtils=Hl,e.Cache=Ku,e.AudioLoader=ic,e.SpotLightShadow=Dl,e.SpotLight=Il,e.PointLight=Nl,e.RectAreaLight=Ul,e.HemisphereLight=Pl,e.HemisphereLightProbe=sc,e.DirectionalLightShadow=Fl,e.DirectionalLight=jl,e.AmbientLight=Bl,e.AmbientLightProbe=uc,e.LightShadow=Cl,e.Light=Ol,e.LightProbe=ac,e.StereoCamera=dc,e.PerspectiveCamera=ri,e.OrthographicCamera=kl,e.CubeCamera=ni,e.ArrayCamera=sa,e.Camera=ti,e.AudioListener=vc,e.PositionalAudio=Ac,e.AudioContext=nc,e.AudioAnalyser=Tc,e.Audio=yc,e.VectorKeyframeTrack=Wu,e.StringKeyframeTrack=zu,e.QuaternionKeyframeTrack=Vu,e.NumberKeyframeTrack=Gu,e.ColorKeyframeTrack=Uu,e.BooleanKeyframeTrack=Bu,e.PropertyMixer=Sc,e.PropertyBinding=Fc,e.KeyframeTrack=ju,e.AnimationUtils=Iu,e.AnimationObjectGroup=jc,e.AnimationMixer=Uc,e.AnimationClip=qu,e.Uniform=Gc,e.InstancedBufferGeometry=Vl,e.BufferGeometry=En,e.Geometry=qn,e.InterleavedBufferAttribute=ya,e.InstancedInterleavedBuffer=Hc,e.InterleavedBuffer=va,e.InstancedBufferAttribute=zl,e.Face3=Jr,e.Object3D=sr,e.Raycaster=Vc,e.Layers=Yt,e.EventDispatcher=t,e.Clock=fc,e.QuaternionLinearInterpolant=Hu,e.LinearInterpolant=ku,e.DiscreteInterpolant=Fu,e.CubicInterpolant=Nu,e.Interpolant=Lu,e.Triangle=Vr,e.Math=Et,e.Spherical=qc,e.Cylindrical=Yc,e.Plane=li,e.Frustum=fi,e.Sphere=Tr,e.Ray=Dr,e.Matrix4=Vt,e.Matrix3=Ot,e.Box3=Er,e.Box2=Xc,e.Line3=Zc,e.Euler=qt,e.Vector4=It,e.Vector3=xt,e.Vector2=wt,e.Quaternion=At,e.Color=Yr,e.SphericalHarmonics3=oc,e.ImmediateRenderObject=$c,e.VertexNormalsHelper=id,e.SpotLightHelper=ad,e.SkeletonHelper=cd,e.PointLightHelper=dd,e.RectAreaLightHelper=fd,e.HemisphereLightHelper=gd,e.LightProbeHelper=vd,e.GridHelper=yd,e.PolarGridHelper=_d,e.PositionalAudioHelper=bd,e.FaceNormalsHelper=Td,e.DirectionalLightHelper=Rd,e.CameraHelper=Cd,e.BoxHelper=Ld,e.Box3Helper=Nd,e.PlaneHelper=kd,e.ArrowHelper=Ud,e.AxesHelper=Gd,e.Shape=Rl,e.Path=Ml,e.ShapePath=$l,e.Font=ec,e.CurvePath=xl,e.Curve=al,e.ImageUtils=Pt,e.ShapeUtils=Qs,e.WebGLUtils=oa,e.WireframeGeometry=cs,e.ParametricGeometry=ds,e.ParametricBufferGeometry=fs,e.TetrahedronGeometry=ms,e.TetrahedronBufferGeometry=gs,e.OctahedronGeometry=vs,e.OctahedronBufferGeometry=ys,e.IcosahedronGeometry=_s,e.IcosahedronBufferGeometry=bs,e.DodecahedronGeometry=Es,e.DodecahedronBufferGeometry=ws,e.PolyhedronGeometry=hs,e.PolyhedronBufferGeometry=ps,e.TubeGeometry=As,e.TubeBufferGeometry=Ts,e.TorusKnotGeometry=Ss,e.TorusKnotBufferGeometry=xs,e.TorusGeometry=Ms,e.TorusBufferGeometry=Rs,e.TextGeometry=nu,e.TextBufferGeometry=iu,e.SphereGeometry=ou,e.SphereBufferGeometry=au,e.RingGeometry=su,e.RingBufferGeometry=uu,e.PlaneGeometry=yi,e.PlaneBufferGeometry=_i,e.LatheGeometry=lu,e.LatheBufferGeometry=cu,e.ShapeGeometry=du,e.ShapeBufferGeometry=fu,e.ExtrudeGeometry=$s,e.ExtrudeBufferGeometry=eu,e.EdgesGeometry=pu,e.ConeGeometry=vu,e.ConeBufferGeometry=yu,e.CylinderGeometry=mu,e.CylinderBufferGeometry=gu,e.CircleGeometry=_u,e.CircleBufferGeometry=bu,e.BoxGeometry=Yn,e.BoxBufferGeometry=Kn,e.ShadowMaterial=wu,e.SpriteMaterial=_a,e.RawShaderMaterial=Au,e.ShaderMaterial=ei,e.PointsMaterial=$a,e.MeshPhysicalMaterial=Su,e.MeshStandardMaterial=Tu,e.MeshPhongMaterial=xu,e.MeshToonMaterial=Mu,e.MeshNormalMaterial=Ru,e.MeshLambertMaterial=Ou,e.MeshDepthMaterial=Zo,e.MeshDistanceMaterial=$o,e.MeshBasicMaterial=en,e.MeshMatcapMaterial=Pu,e.LineDashedMaterial=Cu,e.LineBasicMaterial=Ha,e.Material=$r,e.Float64BufferAttribute=dn,e.Float32BufferAttribute=cn,e.Uint32BufferAttribute=ln,e.Int32BufferAttribute=un,e.Uint16BufferAttribute=sn,e.Int16BufferAttribute=an,e.Uint8ClampedBufferAttribute=on,e.Uint8BufferAttribute=nn,e.Int8BufferAttribute=rn,e.BufferAttribute=tn,e.ArcCurve=ul,e.CatmullRomCurve3=pl,e.CubicBezierCurve=yl,e.CubicBezierCurve3=_l,e.EllipseCurve=sl,e.LineCurve=bl,e.LineCurve3=El,e.QuadraticBezierCurve=wl,e.QuadraticBezierCurve3=Al,e.SplineCurve=Tl,e.REVISION="108",e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.CullFaceNone=q,e.CullFaceBack=Y,e.CullFaceFront=K,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=N,e.PCFSoftShadowMap=k,e.VSMShadowMap=F,e.FrontSide=I,e.BackSide=Ee,e.DoubleSide=X,e.FlatShading=1,e.SmoothShading=2,e.NoColors=a,e.FaceColors=1,e.VertexColors=v,e.NoBlending=Q,e.NormalBlending=J,e.AdditiveBlending=Z,e.SubtractiveBlending=$,e.MultiplyBlending=ee,e.CustomBlending=te,e.AddEquation=re,e.SubtractEquation=i,e.ReverseSubtractEquation=o,e.MinEquation=s,e.MaxEquation=u,e.ZeroFactor=l,e.OneFactor=c,e.SrcColorFactor=d,e.OneMinusSrcColorFactor=f,e.SrcAlphaFactor=h,e.OneMinusSrcAlphaFactor=p,e.DstAlphaFactor=m,e.OneMinusDstAlphaFactor=g,e.DstColorFactor=y,e.OneMinusDstColorFactor=_,e.SrcAlphaSaturateFactor=b,e.NeverDepth=ne,e.AlwaysDepth=ie,e.LessDepth=oe,e.LessEqualDepth=ae,e.EqualDepth=se,e.GreaterEqualDepth=ue,e.GreaterDepth=le,e.NotEqualDepth=ce,e.MultiplyOperation=j,e.MixOperation=B,e.AddOperation=U,e.NoToneMapping=G,e.LinearToneMapping=we,e.ReinhardToneMapping=H,e.Uncharted2ToneMapping=V,e.CineonToneMapping=z,e.ACESFilmicToneMapping=W,e.UVMapping=300,e.CubeReflectionMapping=de,e.CubeRefractionMapping=fe,e.EquirectangularReflectionMapping=he,e.EquirectangularRefractionMapping=pe,e.SphericalReflectionMapping=me,e.CubeUVReflectionMapping=ge,e.CubeUVRefractionMapping=ve,e.RepeatWrapping=E,e.ClampToEdgeWrapping=L,e.MirroredRepeatWrapping=w,e.NearestFilter=ye,e.NearestMipmapNearestFilter=_e,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=be,e.NearestMipMapLinearFilter=1005,e.LinearFilter=Ae,e.LinearMipmapNearestFilter=A,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=T,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=Te,e.ByteType=S,e.ShortType=x,e.UnsignedShortType=Se,e.IntType=M,e.UnsignedIntType=xe,e.FloatType=Me,e.HalfFloatType=Re,e.UnsignedShort4444Type=R,e.UnsignedShort5551Type=O,e.UnsignedShort565Type=P,e.UnsignedInt248Type=Oe,e.AlphaFormat=C,e.RGBFormat=Pe,e.RGBAFormat=Ce,e.LuminanceFormat=D,e.LuminanceAlphaFormat=De,e.RGBEFormat=r,e.DepthFormat=Ie,e.DepthStencilFormat=Le,e.RedFormat=Ne,e.RGB_S3TC_DXT1_Format=ke,e.RGBA_S3TC_DXT1_Format=Fe,e.RGBA_S3TC_DXT3_Format=je,e.RGBA_S3TC_DXT5_Format=Be,e.RGB_PVRTC_4BPPV1_Format=Ue,e.RGB_PVRTC_2BPPV1_Format=Ge,e.RGBA_PVRTC_4BPPV1_Format=He,e.RGBA_PVRTC_2BPPV1_Format=Ve,e.RGB_ETC1_Format=ze,e.RGBA_ASTC_4x4_Format=We,e.RGBA_ASTC_5x4_Format=qe,e.RGBA_ASTC_5x5_Format=Ye,e.RGBA_ASTC_6x5_Format=Ke,e.RGBA_ASTC_6x6_Format=Xe,e.RGBA_ASTC_8x5_Format=Qe,e.RGBA_ASTC_8x6_Format=Je,e.RGBA_ASTC_8x8_Format=Ze,e.RGBA_ASTC_10x5_Format=$e,e.RGBA_ASTC_10x6_Format=et,e.RGBA_ASTC_10x8_Format=tt,e.RGBA_ASTC_10x10_Format=rt,e.RGBA_ASTC_12x10_Format=nt,e.RGBA_ASTC_12x12_Format=it,e.LoopOnce=2200,e.LoopRepeat=2201,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=2400,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=ot,e.TriangleStripDrawMode=1,e.TriangleFanDrawMode=2,e.LinearEncoding=at,e.sRGBEncoding=n,e.GammaEncoding=st,e.RGBEEncoding=ut,e.LogLuvEncoding=lt,e.RGBM7Encoding=ct,e.RGBM16Encoding=dt,e.RGBDEncoding=ft,e.BasicDepthPacking=ht,e.RGBADepthPacking=pt,e.TangentSpaceNormalMap=mt,e.ObjectSpaceNormalMap=gt,e.ZeroStencilOp=0,e.KeepStencilOp=vt,e.ReplaceStencilOp=7681,e.IncrementStencilOp=7682,e.DecrementStencilOp=7683,e.IncrementWrapStencilOp=34055,e.DecrementWrapStencilOp=34056,e.InvertStencilOp=5386,e.NeverStencilFunc=512,e.LessStencilFunc=513,e.EqualStencilFunc=514,e.LessEqualStencilFunc=515,e.GreaterStencilFunc=516,e.NotEqualStencilFunc=517,e.GreaterEqualStencilFunc=518,e.AlwaysStencilFunc=yt,e.CubeGeometry=Yn,e.Face4=function(e,t,r,n,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Jr(e,t,r,i,o,a)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new is(e,t)},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Da(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new is(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new $a(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new $a(e)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new $a(e)},e.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new xt(e,t,r)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new tn(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new rn(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new nn(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new on(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new an(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new sn(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new un(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new ln(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new cn(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new dn(e,t)},e.ClosedSplineCurve3=Hd,e.SplineCurve3=Vd,e.Spline=zd,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Gd(e)},e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ld(e,t)},e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ja(new pu(e.geometry),new Ha({color:void 0!==t?t:16777215}))},e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ja(new cs(e.geometry),new Ha({color:void 0!==t?t:16777215}))},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new $u(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new rl(e)},e.GeometryUtils=Wd,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.SceneUtils=qd,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof r&&void 0!==t?i(r):"function"==typeof define&&define.amd?define(["exports"],i):i(n.THREE={})},{}],616:[function(u,e,l){(function(e,t){var n=u("process/browser.js").nextTick,r=Function.prototype.apply,i=Array.prototype.slice,o={},a=0;function s(e,t){this._id=e,this._clearFn=t}l.setTimeout=function(){return new s(r.call(setTimeout,window,arguments),clearTimeout)},l.setInterval=function(){return new s(r.call(setInterval,window,arguments),clearInterval)},l.clearTimeout=l.clearInterval=function(e){e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(window,this._id)},l.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},l.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},l._unrefActive=l.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},l.setImmediate="function"==typeof e?e:function(e){var t=a++,r=!(arguments.length<2)&&i.call(arguments,1);return o[t]=!0,n(function(){o[t]&&(r?e.apply(null,r):e.call(null),l.clearImmediate(t))}),t},l.clearImmediate="function"==typeof t?t:function(e){delete o[e]}}).call(this,u("timers").setImmediate,u("timers").clearImmediate)},{"process/browser.js":589,timers:616}],617:[function(e,t,r){t.exports=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,r=[],n=0;n<t.rangeCount;n++)r.push(t.getRangeAt(n));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null}return t.removeAllRanges(),function(){"Caret"===t.type&&t.removeAllRanges(),t.rangeCount||r.forEach(function(e){t.addRange(e)}),e&&e.focus()}}},{}],618:[function(e,t,r){(function(r){function n(e){try{if(!r.localStorage)return!1}catch(e){return!1}var t=r.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}t.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],619:[function(e,r,n){(function(d){var e,t;e=this,t=function(){"use strict";var ge="undefined"!=typeof window?window:void 0!==d?d:"undefined"!=typeof self?self:{};function t(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)}function i(e,t){for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}function r(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}var e,n,o=(function(e,t){e.exports=function(){var e=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=.001,i=1,w=function(e,t,r){return e+(t-e)*r},d=function(){var e=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return e}}(),f=function(){var e=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return e}}(),o=(function(){var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}(),function(){var e=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return e}}()),s=function(){var e=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),t=e?parseInt(e[1],10):null;return function(){return t}}(),u=function(){var e=!1;if(65===s()){var t=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(t){var r=t[1].split("."),n=a(r,4),i=(n[0],n[1],n[2]),o=n[3];e=3325===parseInt(i,10)&&parseInt(o,10)<148}}return function(){return e}}(),l=function(){var e=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return e}}(),c=function(){var e=90==window.orientation||-90==window.orientation;return l()?!e:e},h=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},p=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},m=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},g=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},v=function(e,t,r,n){var i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t),e.compileShader(i);var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,r),e.compileShader(o);var a=e.createProgram();for(var s in e.attachShader(a,i),e.attachShader(a,o),n)e.bindAttribLocation(a,n[s],s);return e.linkProgram(a),e.deleteShader(i),e.deleteShader(o),a},y=function(e,t){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i="",o=0;o<n;o++){var a=e.getActiveUniform(t,o);i=a.name.replace("[0]",""),r[i]=e.getUniformLocation(t,i)}return r},r=function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t},_=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},b=function(e){if(d()){var t=e.style.width,r=e.style.height;e.style.width=parseInt(t)+1+"px",e.style.height=parseInt(r)+"px",setTimeout(function(){e.style.width=t,e.style.height=r},100)}window.canvas=e},t=function(){var c=Math.PI/180,d=.25*Math.PI;var u=new Float32Array([0,0,0,1]),l=new Float32Array([0,0,0]);function n(e,t,r,n,i,o){!function(e,t,r,n){var i=Math.tan(t?t.upDegrees*c:d),o=Math.tan(t?t.downDegrees*c:d),a=Math.tan(t?t.leftDegrees*c:d),s=Math.tan(t?t.rightDegrees*c:d),u=2/(a+s),l=2/(i+o);e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*l*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0}(e,n||null,o.depthNear,o.depthFar);var a=r.orientation||u,s=r.position||l;!function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=n+n,u=i+i,l=o+o,c=n*s,d=n*u,f=n*l,h=i*u,p=i*l,m=o*l,g=a*s,v=a*u,y=a*l;e[0]=1-(h+m),e[1]=d+y,e[2]=f-v,e[3]=0,e[4]=d-y,e[5]=1-(c+m),e[6]=p+g,e[7]=0,e[8]=f+v,e[9]=p-g,e[10]=1-(c+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1}(t,a,s),i&&function(e,t,r){var n,i,o,a,s,u,l,c,d,f,h,p,m=r[0],g=r[1],v=r[2];t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],d=t[8],f=t[9],h=t[10],p=t[11],e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=d,e[9]=f,e[10]=h,e[11]=p,e[12]=n*m+s*g+d*v+t[12],e[13]=i*m+u*g+f*v+t[13],e[14]=o*m+l*g+h*v+t[14],e[15]=a*m+c*g+p*v+t[15])}(t,t,i),function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],g=t[14],v=t[15],y=r*s-n*a,_=r*u-i*a,b=r*l-o*a,E=n*u-i*s,w=n*l-o*s,A=i*l-o*u,T=c*m-d*p,S=c*g-f*p,x=c*v-h*p,M=d*g-f*m,R=d*v-h*m,O=f*v-h*g,P=y*O-_*R+b*M+E*x-w*S+A*T;P&&(P=1/P,e[0]=(s*O-u*R+l*M)*P,e[1]=(i*R-n*O-o*M)*P,e[2]=(m*A-g*w+v*E)*P,e[3]=(f*w-d*A-h*E)*P,e[4]=(u*x-a*O-l*S)*P,e[5]=(r*O-i*x+o*S)*P,e[6]=(g*b-p*A-v*_)*P,e[7]=(c*A-f*b+h*_)*P,e[8]=(a*R-s*x+l*T)*P,e[9]=(n*x-r*R-o*T)*P,e[10]=(p*w-m*b+v*y)*P,e[11]=(d*b-c*w-h*y)*P,e[12]=(s*S-a*M-u*T)*P,e[13]=(r*M-n*S+i*T)*P,e[14]=(m*_-p*E-g*y)*P,e[15]=(c*E-d*_+f*y)*P)}(t,t)}return function(e,t,r){return!(!e||!t)&&(e.pose=t,e.timestamp=t.timestamp,n(e.leftProjectionMatrix,e.leftViewMatrix,t,r._getFieldOfView("left"),r._getEyeOffset("left"),r),n(e.rightProjectionMatrix,e.rightViewMatrix,t,r._getFieldOfView("right"),r._getEyeOffset("right"),r),!0)}}(),E=function(e){var t,r=e.indexOf("://");t=-1!==r?r+3:0;var n=e.indexOf("/",t);return-1===n&&(n=e.length),e.substring(0,n)},A=function(){var r={};return function(e,t){void 0===r[e]&&(console.warn("webvr-polyfill: "+t),r[e]=!0)}}(),T=function(e,t){var r=t?"Please use "+t+" instead.":"";A(e,e+" has been deprecated. This may not work on native WebVR displays. "+r)};var S=function(e,t,r){if(!t)return void r(e);for(var n=[],i=null,o=0;o<t.length;++o){switch(a=t[o]){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:if((u=t[++o])<e.TEXTURE0||u>e.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),n.push(null,null);break}i=i||e.getParameter(e.ACTIVE_TEXTURE),e.activeTexture(u),n.push(e.getParameter(a),null);break;case e.ACTIVE_TEXTURE:i=e.getParameter(e.ACTIVE_TEXTURE),n.push(null);break;default:n.push(e.getParameter(a))}}r(e);for(o=0;o<t.length;++o){var a=t[o],s=n[o];switch(a){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,s);break;case e.COLOR_CLEAR_VALUE:e.clearColor(s[0],s[1],s[2],s[3]);break;case e.COLOR_WRITEMASK:e.colorMask(s[0],s[1],s[2],s[3]);break;case e.CURRENT_PROGRAM:e.useProgram(s);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,s);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,s);break;case e.TEXTURE_BINDING_2D:if((u=t[++o])<e.TEXTURE0||u>e.TEXTURE31)break;e.activeTexture(u),e.bindTexture(e.TEXTURE_2D,s);break;case e.TEXTURE_BINDING_CUBE_MAP:var u;if((u=t[++o])<e.TEXTURE0||u>e.TEXTURE31)break;e.activeTexture(u),e.bindTexture(e.TEXTURE_CUBE_MAP,s);break;case e.VIEWPORT:e.viewport(s[0],s[1],s[2],s[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:s?e.enable(a):e.disable(a);break;default:console.log("No GL restore behavior for 0x"+a.toString(16))}i&&e.activeTexture(i)}},x=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),M=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function R(e,t,r,n){this.gl=e,this.cardboardUI=t,this.bufferScale=r,this.dirtySubmitFrameBindings=n,this.ctxAttribs=e.getContextAttributes(),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,d()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=v(e,x,M,this.attribs),this.uniforms=y(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize()}R.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},R.prototype.onResize=function(){var e=this.gl,t=this,r=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];S(e,r,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.framebuffer),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.texImage2D(e.TEXTURE_2D,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,t.bufferWidth,t.bufferHeight,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.renderTarget,0),t.ctxAttribs.depth&&t.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t.depthStencilBuffer)):t.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)):t.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,t.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t.stencilBuffer)),!e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),t.realClearColor.apply(e,t.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},R.prototype.patch=function(){if(!this.isPatched){var i=this,t=this.gl.canvas,o=this.gl;d()||(t.width=h()*this.bufferScale,t.height=p()*this.bufferScale,Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:function(){return i.bufferWidth},set:function(e){i.bufferWidth=e,i.realCanvasWidth.set.call(t,e),i.onResize()}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:function(){return i.bufferHeight},set:function(e){i.bufferHeight=e,i.realCanvasHeight.set.call(t,e),i.onResize()}})),this.lastBoundFramebuffer=o.getParameter(o.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(o.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(e,t){i.lastBoundFramebuffer=t||i.framebuffer,i.realBindFramebuffer.call(o,e,i.lastBoundFramebuffer)},this.cullFace=o.getParameter(o.CULL_FACE),this.depthTest=o.getParameter(o.DEPTH_TEST),this.blend=o.getParameter(o.BLEND),this.scissorTest=o.getParameter(o.SCISSOR_TEST),this.stencilTest=o.getParameter(o.STENCIL_TEST),o.enable=function(e){switch(e){case o.CULL_FACE:i.cullFace=!0;break;case o.DEPTH_TEST:i.depthTest=!0;break;case o.BLEND:i.blend=!0;break;case o.SCISSOR_TEST:i.scissorTest=!0;break;case o.STENCIL_TEST:i.stencilTest=!0}i.realEnable.call(o,e)},o.disable=function(e){switch(e){case o.CULL_FACE:i.cullFace=!1;break;case o.DEPTH_TEST:i.depthTest=!1;break;case o.BLEND:i.blend=!1;break;case o.SCISSOR_TEST:i.scissorTest=!1;break;case o.STENCIL_TEST:i.stencilTest=!1}i.realDisable.call(o,e)},this.colorMask=o.getParameter(o.COLOR_WRITEMASK),o.colorMask=function(e,t,r,n){i.colorMask[0]=e,i.colorMask[1]=t,i.colorMask[2]=r,i.colorMask[3]=n,i.realColorMask.call(o,e,t,r,n)},this.clearColor=o.getParameter(o.COLOR_CLEAR_VALUE),o.clearColor=function(e,t,r,n){i.clearColor[0]=e,i.clearColor[1]=t,i.clearColor[2]=r,i.clearColor[3]=n,i.realClearColor.call(o,e,t,r,n)},this.viewport=o.getParameter(o.VIEWPORT),o.viewport=function(e,t,r,n){i.viewport[0]=e,i.viewport[1]=t,i.viewport[2]=r,i.viewport[3]=n,i.realViewport.call(o,e,t,r,n)},this.isPatched=!0,b(t)}},R.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,t=this.gl.canvas;d()||(Object.defineProperty(t,"width",this.realCanvasWidth),Object.defineProperty(t,"height",this.realCanvasHeight)),t.width=this.bufferWidth,t.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){b(t)},1)}},R.prototype.setTextureBounds=function(e,t){e=e||[0,0,.5,1],t=t||[.5,0,.5,1],this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=t[0],this.viewportOffsetScale[5]=t[1],this.viewportOffsetScale[6]=t[2],this.viewportOffsetScale[7]=t[3]},R.prototype.submitFrame=function(){var e=this.gl,t=this,r=[];if(this.dirtySubmitFrameBindings||r.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),S(e,r,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.cullFace&&t.realDisable.call(e,e.CULL_FACE),t.depthTest&&t.realDisable.call(e,e.DEPTH_TEST),t.blend&&t.realDisable.call(e,e.BLEND),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realDisable.call(e,e.STENCIL_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(t.ctxAttribs.alpha||d())&&(t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(t.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(t.attribs.position),e.enableVertexAttribArray(t.attribs.texCoord),e.vertexAttribPointer(t.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(t.attribs.texCoord,3,e.FLOAT,!1,20,8),e.activeTexture(e.TEXTURE0),e.uniform1i(t.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.uniform4fv(t.uniforms.viewportOffsetScale,t.viewportOffsetScale),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_SHORT,0),t.cardboardUI&&t.cardboardUI.renderNoState(),t.realBindFramebuffer.call(t.gl,e.FRAMEBUFFER,t.framebuffer),t.ctxAttribs.preserveDrawingBuffer||(t.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),t.dirtySubmitFrameBindings||t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.cullFace&&t.realEnable.call(e,e.CULL_FACE),t.depthTest&&t.realEnable.call(e,e.DEPTH_TEST),t.blend&&t.realEnable.call(e,e.BLEND),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realEnable.call(e,e.STENCIL_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),!t.ctxAttribs.alpha&&t.ctxAttribs.preserveDrawingBuffer||t.realClearColor.apply(e,t.clearColor)}),d()){var n=e.canvas;n.width==t.bufferWidth&&n.height==t.bufferHeight||(t.bufferWidth=n.width,t.bufferHeight=n.height,t.onResize())}},R.prototype.updateDeviceInfo=function(n){var e=this.gl,i=this,t=[e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING];S(e,t,function(e){var t=i.computeMeshVertices_(i.meshWidth,i.meshHeight,n);if(e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),!i.indexCount){var r=i.computeMeshIndices_(i.meshWidth,i.meshHeight);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,e.STATIC_DRAW),i.indexCount=r.length}})},R.prototype.computeMeshVertices_=function(e,t,r){for(var n=new Float32Array(2*e*t*5),i=r.getLeftEyeVisibleTanAngles(),o=r.getLeftEyeNoLensTanAngles(),a=r.getLeftEyeVisibleScreenRect(o),s=0,u=0;u<2;u++){for(var l=0;l<t;l++)for(var c=0;c<e;c++,s++){var d=c/(e-1),f=l/(t-1),h=d,p=f,m=w(i[0],i[2],d),g=w(i[3],i[1],f),v=Math.sqrt(m*m+g*g),y=r.distortion.distortInverse(v),_=m*y/v,b=g*y/v;d=(_-o[0])/(o[2]-o[0]),f=(b-o[3])/(o[1]-o[3]),d=2*(a.x+d*a.width-.5),f=2*(a.y+f*a.height-.5),n[5*s+0]=d,n[5*s+1]=f,n[5*s+2]=h,n[5*s+3]=p,n[5*s+4]=u}var E=i[2]-i[0];i[0]=-(E+i[0]),i[2]=E-i[2],E=o[2]-o[0],o[0]=-(E+o[0]),o[2]=E-o[2],a.x=1-(a.x+a.width)}return n},R.prototype.computeMeshIndices_=function(e,t){for(var r=new Uint16Array(2*(e-1)*(t-1)*6),n=e/2,i=t/2,o=0,a=0,s=0;s<2;s++)for(var u=0;u<t;u++)for(var l=0;l<e;l++,o++)0!=l&&0!=u&&(l<=n==u<=i?(r[a++]=o,r[a++]=o-e-1,r[a++]=o-e,r[a++]=o-e-1,r[a++]=o,r[a++]=o-1):(r[a++]=o-1,r[a++]=o-e,r[a++]=o,r[a++]=o-e,r[a++]=o-1,r[a++]=o-e-1));return r},R.prototype.getOwnPropertyDescriptor_=function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return void 0!==r.get&&void 0!==r.set||(r.configurable=!0,r.enumerable=!0,r.get=function(){return this.getAttribute(t)},r.set=function(e){this.setAttribute(t,e)}),r};var O=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),P=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),C=Math.PI/180;function D(e){this.gl=e,this.attribs={position:0},this.program=v(e,O,P,this.attribs),this.uniforms=y(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function I(e){this.coefficients=e}D.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener("click",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},D.prototype.listen=function(r,n){var i=this.gl.canvas;this.listener=function(e){var t=i.clientWidth/2;e.clientX>t-42&&e.clientX<42+t&&e.clientY>i.clientHeight-42?r(e):e.clientX<42&&e.clientY<42&&n(e)},i.addEventListener("click",this.listener,!1)},D.prototype.onResize=function(){var e=this.gl,m=this,t=[e.ARRAY_BUFFER_BINDING];S(e,t,function(r){var o=[],a=r.drawingBufferWidth/2,e=Math.max(screen.width,screen.height)*window.devicePixelRatio,t=r.drawingBufferWidth/e,n=t*window.devicePixelRatio,i=4*n/2,s=42*n,u=28*n/2,l=14*n;function c(e,t){var r=(90-e)*C,n=Math.cos(r),i=Math.sin(r);o.push(.3125*n*u+a,.3125*i*u+u),o.push(t*n*u+a,t*i*u+u)}o.push(a-i,s),o.push(a-i,r.drawingBufferHeight),o.push(a+i,s),o.push(a+i,r.drawingBufferHeight),m.gearOffset=o.length/2;for(var d=0;d<=6;d++){var f=60*d;c(f,1),c(12+f,1),c(20+f,.75),c(40+f,.75),c(48+f,1)}function h(e,t){o.push(l+e,r.drawingBufferHeight-l-t)}m.gearVertexCount=o.length/2-m.gearOffset,m.arrowOffset=o.length/2;var p=i/Math.sin(45*C);h(0,u),h(u,0),h(u+p,p),h(p,u+p),h(p,u-p),h(0,u),h(u,2*u),h(u+p,2*u-p),h(p,u-p),h(0,u),h(p,u-i),h(28*n,u-i),h(p,u+i),h(28*n,u+i),m.arrowVertexCount=o.length/2-m.arrowOffset,r.bindBuffer(r.ARRAY_BUFFER,m.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(o),r.STATIC_DRAW)})},D.prototype.render=function(){var e=this.gl,t=this,r=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];S(e,r,function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.renderNoState()})},D.prototype.renderNoState=function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(this.attribs.position),e.vertexAttribPointer(this.attribs.position,2,e.FLOAT,!1,8,0),e.uniform4f(this.uniforms.color,1,1,1,1),function(e,t,r,n,i,o,a){var s=1/(t-r),u=1/(n-i),l=1/(o-a);e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*u,e[14]=(a+o)*l,e[15]=1}(this.projMat,0,e.drawingBufferWidth,0,e.drawingBufferHeight,.1,1024),e.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.drawArrays(e.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),e.drawArrays(e.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},I.prototype.distortInverse=function(e){for(var t=0,r=1,n=e-this.distort(t);1e-4<Math.abs(r-t);){var i=e-this.distort(r),o=r-(r-t)/(i-n)*i;t=r,r=o,n=i}return r},I.prototype.distort=function(e){for(var t=e*e,r=0,n=0;n<this.coefficients.length;n++)r=t*(r+this.coefficients[n]);return(r+1)*e};var L=Math.PI/180,N=180/Math.PI,k=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0};k.prototype={constructor:k,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();if(0!==e){var t=1/e;this.multiplyScalar(t)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,u=s*t+o*n-a*r,l=s*r+a*t-i*n,c=s*n+i*r-o*t,d=-i*t-o*r-a*n;return this.x=u*s+d*-i+l*-a-c*-o,this.y=l*s+d*-o+c*-i-u*-a,this.z=c*s+d*-a+u*-o-l*-i,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this}};var F=function(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1};function j(e){this.width=e.width||h(),this.height=e.height||p(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}F.prototype={constructor:F,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,t,r){var n=Math.cos(e/2),i=Math.cos(t/2),o=Math.cos(r/2),a=Math.sin(e/2),s=Math.sin(t/2),u=Math.sin(r/2);return this.x=a*i*o+n*s*u,this.y=n*s*o-a*i*u,this.z=n*i*u+a*s*o,this.w=n*i*o-a*s*u,this},setFromEulerYXZ:function(e,t,r){var n=Math.cos(e/2),i=Math.cos(t/2),o=Math.cos(r/2),a=Math.sin(e/2),s=Math.sin(t/2),u=Math.sin(r/2);return this.x=a*i*o+n*s*u,this.y=n*s*o-a*i*u,this.z=n*i*u-a*s*o,this.w=n*i*o+a*s*u,this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(r),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e.x,n=e.y,i=e.z,o=e.w,a=t.x,s=t.y,u=t.z,l=t.w;return this.x=r*l+o*a+n*u-i*s,this.y=n*l+o*s+i*a-r*u,this.z=i*l+o*u+r*s-n*a,this.w=o*l-r*a-n*s-i*u,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this.x,n=this.y,i=this.z,o=this.w,a=o*e.w+r*e.x+n*e.y+i*e.z;if(a<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),1<=a)return this.w=o,this.x=r,this.y=n,this.z=i,this;var s=Math.acos(a),u=Math.sqrt(1-a*a);if(Math.abs(u)<.001)return this.w=.5*(o+this.w),this.x=.5*(r+this.x),this.y=.5*(n+this.y),this.z=.5*(i+this.z),this;var l=Math.sin((1-t)*s)/u,c=Math.sin(t*s)/u;return this.w=o*l+this.w*c,this.x=r*l+this.x*c,this.y=n*l+this.y*c,this.z=i*l+this.z*c,this},setFromUnitVectors:function(){var r,n;return function(e,t){return void 0===r&&(r=new k),(n=e.dot(t)+1)<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this.x=r.x,this.y=r.y,this.z=r.z,this.w=n,this.normalize(),this}}()};var B=new j({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),U=new j({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),G={CardboardV1:new V({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new V({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function H(e,t){this.viewer=G.CardboardV2,this.updateDeviceParams(e),this.distortion=new I(this.viewer.distortionCoefficients);for(var r=0;r<t.length;r++){var n=t[r];G[n.id]=new V(n)}}function V(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}H.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},H.prototype.getDevice=function(){return this.device},H.prototype.setViewer=function(e){this.viewer=e,this.distortion=new I(this.viewer.distortionCoefficients)},H.prototype.determineDevice_=function(e){if(!e)return d()?(console.warn("Using fallback iOS device measurements."),U):(console.warn("Using fallback Android device measurements."),B);var t=.0254/e.xdpi,r=.0254/e.ydpi,n=h(),i=p();return new j({widthMeters:t*n,heightMeters:r*i,bevelMeters:.001*e.bevelMm})},H.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,r=this.distortion,n=e.screenLensDistance,i=(t.widthMeters-e.interLensDistance)/2,o=e.interLensDistance/2,a=e.baselineLensDistance-t.bevelMeters,s=t.heightMeters-a,u=N*Math.atan(r.distort(i/n)),l=N*Math.atan(r.distort(o/n)),c=N*Math.atan(r.distort(a/n)),d=N*Math.atan(r.distort(s/n));return{leftDegrees:Math.min(u,e.fov),rightDegrees:Math.min(l,e.fov),downDegrees:Math.min(c,e.fov),upDegrees:Math.min(d,e.fov)}},H.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,t=this.device,r=this.distortion,n=Math.tan(-L*e.fov),i=Math.tan(L*e.fov),o=Math.tan(L*e.fov),a=Math.tan(-L*e.fov),s=t.widthMeters/4,u=t.heightMeters/2,l=e.baselineLensDistance-t.bevelMeters-u,c=e.interLensDistance/2-s,d=-l,f=e.screenLensDistance,h=r.distort((c-s)/f),p=r.distort((d+u)/f),m=r.distort((c+s)/f),g=r.distort((d-u)/f),v=new Float32Array(4);return v[0]=Math.max(n,h),v[1]=Math.min(i,p),v[2]=Math.min(o,m),v[3]=Math.max(a,g),v},H.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,t=this.device,r=this.distortion,n=new Float32Array(4),i=r.distortInverse(Math.tan(-L*e.fov)),o=r.distortInverse(Math.tan(L*e.fov)),a=r.distortInverse(Math.tan(L*e.fov)),s=r.distortInverse(Math.tan(-L*e.fov)),u=t.widthMeters/4,l=t.heightMeters/2,c=e.baselineLensDistance-t.bevelMeters-l,d=e.interLensDistance/2-u,f=-c,h=e.screenLensDistance,p=(d-u)/h,m=(f+l)/h,g=(d+u)/h,v=(f-l)/h;return n[0]=Math.max(i,p),n[1]=Math.min(o,m),n[2]=Math.min(a,g),n[3]=Math.max(s,v),n},H.prototype.getLeftEyeVisibleScreenRect=function(e){var t=this.viewer,r=this.device,n=t.screenLensDistance,i=(r.widthMeters-t.interLensDistance)/2,o=t.baselineLensDistance-r.bevelMeters,a=(e[0]*n+i)/r.widthMeters,s=(e[1]*n+o)/r.heightMeters,u=(e[2]*n+i)/r.widthMeters,l=(e[3]*n+o)/r.heightMeters;return{x:a,y:l,width:u-a,height:s-l}},H.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},H.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},H.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:N*Math.atan(e.outerDist),rightDegrees:N*Math.atan(e.innerDist),downDegrees:N*Math.atan(e.bottomDist),upDegrees:N*Math.atan(e.topDist)}},H.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,r=this.device,n=t.screenLensDistance,i=r.widthMeters/n,o=r.heightMeters/n,a=r.width/i,s=r.height/o,u=Math.round((e.eyePosX-e.outerDist)*a),l=Math.round((e.eyePosY-e.bottomDist)*s);return{x:u,y:l,width:Math.round((e.eyePosX+e.innerDist)*a)-u,height:Math.round((e.eyePosY+e.topDist)*s)-l}},H.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,r=this.distortion,n=e.screenLensDistance,i=e.interLensDistance/2/n,o=t.widthMeters/n,a=t.heightMeters/n,s=o/2-i,u=(e.baselineLensDistance-t.bevelMeters)/n,l=e.fov,c=r.distortInverse(Math.tan(L*l)),d=Math.min(s,c),f=Math.min(i,c),h=Math.min(u,c),p=Math.min(a-u,c);return{outerDist:d,innerDist:f,topDist:p,bottomDist:h,eyePosX:s,eyePosY:u}},H.Viewers=G;var z={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function W(e,t){if(this.dpdb=z,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t;var r=new XMLHttpRequest,n=this;r.open("GET",e,!0),r.addEventListener("load",function(){n.loading=!1,200<=r.status&&r.status<=299?(n.dpdb=JSON.parse(r.response),n.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),r.send()}}function q(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}function Y(e,t){this.set(e,t)}function K(e,t){this.kFilter=e,this.isDebug=t,this.currentAccelMeasurement=new Y,this.currentGyroMeasurement=new Y,this.previousGyroMeasurement=new Y,d()?this.filterQ=new F(-1,0,0,1):this.filterQ=new F(1,0,0,1),this.previousFilterQ=new F,this.previousFilterQ.copy(this.filterQ),this.accelQ=new F,this.isOrientationInitialized=!1,this.estimatedGravity=new k,this.measuredGravity=new k,this.gyroIntegralQ=new F}function X(e,t){this.predictionTimeS=e,this.isDebug=t,this.previousQ=new F,this.previousTimestampS=null,this.deltaQ=new F,this.outQ=new F}function Q(e,t,r,n){this.yawOnly=r,this.accelerometer=new k,this.gyroscope=new k,this.filter=new K(e,n),this.posePredictor=new X(t,n),this.isFirefoxAndroid=o(),this.isIOS=d();var i=s();this.isDeviceMotionInRadians=!this.isIOS&&i&&i<66,this.isWithoutDeviceMotion=u(),this.filterToWorldQ=new F,d()?this.filterToWorldQ.setFromAxisAngle(new k(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new k(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new F,this.worldToScreenQ=new F,this.originalPoseAdjustQ=new F,this.originalPoseAdjustQ.setFromAxisAngle(new k(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),c()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new F,this.orientationOut_=new Float32Array(4),this.start()}W.prototype.getDeviceParams=function(){return this.deviceParams},W.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},W.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return console.error("DPDB not available."),null;if(1!=e.format)return console.error("DPDB has unexpected format version."),null;if(!e.devices||!e.devices.length)return console.error("DPDB does not have a devices section."),null;var t=navigator.userAgent||navigator.vendor||window.opera,r=h(),n=p();if(!e.devices)return console.error("DPDB has no devices section."),null;for(var i=0;i<e.devices.length;i++){var o=e.devices[i];if(o.rules)if("ios"==o.type||"android"==o.type){if(d()==("ios"==o.type)){for(var a=!1,s=0;s<o.rules.length;s++){var u=o.rules[s];if(this.ruleMatches_(u,t,r,n)){a=!0;break}}if(a){var l=o.dpi[0]||o.dpi,c=o.dpi[1]||o.dpi;return new q({xdpi:l,ydpi:c,bevelMm:o.bw})}}}else console.warn("Device["+i+"] has invalid type.");else console.warn("Device["+i+"] has no rules section.")}return console.warn("No DPDB device match."),null},W.prototype.ruleMatches_=function(e,t,r,n){if(!e.ua&&!e.res)return!1;if(e.ua&&"SM"===e.ua.substring(0,2)&&(e.ua=e.ua.substring(0,7)),e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var i=e.res[0],o=e.res[1];if(Math.min(r,n)!=Math.min(i,o)||Math.max(r,n)!=Math.max(i,o))return!1}return!0},Y.prototype.set=function(e,t){this.sample=e,this.timestampS=t},Y.prototype.copy=function(e){this.set(e.sample,e.timestampS)},K.prototype.addAccelMeasurement=function(e,t){this.currentAccelMeasurement.set(e,t)},K.prototype.addGyroMeasurement=function(e,t){this.currentGyroMeasurement.set(e,t);var r=t-this.previousGyroMeasurement.timestampS;!function(e){if(isNaN(e)){return false}if(e<=n){return false}if(e>i){return false}return true}(r)||this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},K.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(t),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(t);var r=new F;r.copy(this.filterQ),r.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(r),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n=new F;n.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),n.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",N*function(e){if(e.w>1){console.warn("getQuaternionAngle: w > 1");return 0}var t;return 2*Math.acos(e.w)}(n),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var i=new F;i.copy(this.filterQ),i.multiply(n),this.filterQ.slerp(i,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},K.prototype.getOrientation=function(){return this.filterQ},K.prototype.accelToQuaternion_=function(e){var t=new k;t.copy(e),t.normalize();var r=new F;return r.setFromUnitVectors(new k(0,0,-1),t),r.inverse(),r},K.prototype.gyroToQuaternionDelta_=function(e,t){var r=new F,n=new k;return n.copy(e),n.normalize(),r.setFromAxisAngle(n,e.length()*t),r},X.prototype.getPrediction=function(e,t,r){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=r,e;var n=new k;n.copy(t),n.normalize();var i=t.length();if(i<20*L)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(N*i).toFixed(1)),this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var o=i*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(n,o),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.previousTimestampS=r,this.outQ},Q.prototype.getPosition=function(){return null},Q.prototype.getOrientation=function(){var e=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var e=(new F).setFromAxisAngle(new k(0,0,-1),0),t=new F;return-90===window.orientation?t.setFromAxisAngle(new k(0,1,0),Math.PI/-2):t.setFromAxisAngle(new k(0,1,0),Math.PI/2),e.multiply(t)}(),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var e=new F;return e.setFromAxisAngle(new k(1,0,0),-Math.PI/2),e}(),e=this._deviceOrientationQ;var t=new F;return t.copy(e),t.multiply(this.deviceOrientationFilterToWorldQ),t.multiply(this.resetQ),t.multiply(this.worldToScreenQ),t.multiplyQuaternions(this.deviceOrientationFixQ,t),this.yawOnly&&(t.x=0,t.z=0,t.normalize()),this.orientationOut_[0]=t.x,this.orientationOut_[1]=t.y,this.orientationOut_[2]=t.z,this.orientationOut_[3]=t.w,this.orientationOut_}var r=this.filter.getOrientation();e=this.posePredictor.getPrediction(r,this.gyroscope,this.previousTimestampS);var t=new F;return t.copy(this.filterToWorldQ),t.multiply(this.resetQ),t.multiply(e),t.multiply(this.worldToScreenQ),this.yawOnly&&(t.x=0,t.z=0,t.normalize()),this.orientationOut_[0]=t.x,this.orientationOut_[1]=t.y,this.orientationOut_[2]=t.z,this.orientationOut_[3]=t.w,this.orientationOut_},Q.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),c()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},Q.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new F;var t=e.alpha,r=e.beta,n=e.gamma;t=(t||0)*Math.PI/180,r=(r||0)*Math.PI/180,n=(n||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(r,t,-n)},Q.prototype.onDeviceMotion_=function(e){this.updateDeviceMotion_(e)},Q.prototype.updateDeviceMotion_=function(e){var t=e.accelerationIncludingGravity,r=e.rotationRate,n=e.timeStamp/1e3,i=n-this.previousTimestampS;return i<0?A("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"):i<=.001||1<i?A("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-t.x,-t.y,-t.z),l()?this.gyroscope.set(-r.beta,r.alpha,r.gamma):this.gyroscope.set(r.alpha,r.beta,r.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,n),this.filter.addGyroMeasurement(this.gyroscope,n)),void(this.previousTimestampS=n)},Q.prototype.onOrientationChange_=function(e){this.setScreenTransform_()},Q.prototype.onMessage_=function(e){var t=e.data;if(t&&t.type){var r=t.type.toLowerCase();"devicemotion"===r&&this.updateDeviceMotion_(t.deviceMotionEvent)}},Q.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new k(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new k(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},Q.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),d()&&function(){var e=window.self!==window.top,t=E(document.referrer),r=E(window.location.href);return e&&t!==r}()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},Q.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var J=new k(1,0,0),Z=new k(0,0,1),$=new F;$.setFromAxisAngle(J,-Math.PI/2),$.multiply((new F).setFromAxisAngle(Z,Math.PI/2));var ee=function(){function t(e){!function(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}(this,t),this.config=e,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new F,this._outQ=new F,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return e(t,[{key:"init",value:function(){var e=null;try{(e=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(e){this.errors.push(e),"SecurityError"===e.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===e.name?this.useDeviceMotion():console.error(e)}e&&(this.api="sensor",this.sensor=e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new Q(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var e=this.sensor.quaternion;this._sensorQ.set(e[0],e[1],e[2],e[3]);var t=this._outQ;return t.copy($),t.multiply(this._sensorQ),this.config.YAW_ONLY&&(t.x=t.z=0,t.normalize()),this._out[0]=t.x,this._out[1]=t.y,this._out[2]=t.z,this._out[3]=t.w,this._out}},{key:"_onSensorError",value:function(e){this.errors.push(e.error),"NotAllowedError"===e.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===e.error.name?console.error("Sensor could not be read"):console.error(e.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),t}();function te(){this.loadIcon_();var e=document.createElement("div"),t=e.style;t.position="fixed",t.top=0,t.right=0,t.bottom=0,t.left=0,t.backgroundColor="gray",t.fontFamily="sans-serif",t.zIndex=1e6;var r=document.createElement("img");r.src=this.icon;var t=r.style;t.marginLeft="25%",t.marginTop="25%",t.width="50%",e.appendChild(r);var n=document.createElement("div"),t=n.style;t.textAlign="center",t.fontSize="16px",t.lineHeight="24px",t.margin="24px 25%",t.width="50%",n.innerHTML="Place your phone into your Cardboard viewer.",e.appendChild(n);var i=document.createElement("div"),t=i.style;t.backgroundColor="#CFD8DC",t.position="fixed",t.bottom=0,t.width="100%",t.height="48px",t.padding="14px 24px",t.boxSizing="border-box",t.color="#656A6B",e.appendChild(i);var o=document.createElement("div");o.style.float="left",o.innerHTML="No Cardboard viewer?";var a=document.createElement("a");a.href="https://www.google.com/get/cardboard/get-cardboard/",a.innerHTML="get one",a.target="_blank";var t=a.style;t.float="right",t.fontWeight=600,t.textTransform="uppercase",t.borderLeft="1px solid gray",t.paddingLeft="24px",t.textDecoration="none",t.color="#656A6B",i.appendChild(o),i.appendChild(a),this.overlay=e,this.text=n,this.hide()}te.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var t=this.overlay.querySelector("img"),r=t.style;c()?(r.width="20%",r.marginLeft="40%",r.marginTop="3%"):(r.width="50%",r.marginLeft="25%",r.marginTop="25%")},te.prototype.hide=function(){this.overlay.style.display="none"},te.prototype.showTemporarily=function(e,t){this.show(t),this.timer=setTimeout(this.hide.bind(this),e)},te.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},te.prototype.update=function(){this.disableShowTemporarily(),!c()&&r()?this.show():this.hide()},te.prototype.loadIcon_=function(){this.icon=function(e,t){return"data:"+e+","+encodeURIComponent(t)}("image/svg+xml","<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};var re="CardboardV1",ne="WEBVR_CARDBOARD_VIEWER";function ie(e){try{this.selectedKey=localStorage.getItem(ne)}catch(e){console.error("Failed to load viewer profile: %s",e)}this.selectedKey||(this.selectedKey=e||re),this.dialog=this.createDialog_(H.Viewers),this.root=null,this.onChangeCallbacks_=[]}ie.prototype.show=function(e){(this.root=e).appendChild(this.dialog);var t=this.dialog.querySelector("#"+this.selectedKey);t.checked=!0,this.dialog.style.display="block"},ie.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},ie.prototype.getCurrentViewer=function(){return H.Viewers[this.selectedKey]},ie.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector("input[name=field]:checked");return e?e.id:null},ie.prototype.onChange=function(e){this.onChangeCallbacks_.push(e)},ie.prototype.fireOnChange_=function(e){for(var t=0;t<this.onChangeCallbacks_.length;t++)this.onChangeCallbacks_[t](e)},ie.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&H.Viewers[this.selectedKey]){this.fireOnChange_(H.Viewers[this.selectedKey]);try{localStorage.setItem(ne,this.selectedKey)}catch(e){console.error("Failed to save viewer profile: %s",e)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},ie.prototype.createDialog_=function(e){var t=document.createElement("div");t.classList.add("webvr-polyfill-viewer-selector"),t.style.display="none";var r=document.createElement("div"),n=r.style;n.position="fixed",n.left=0,n.top=0,n.width="100%",n.height="100%",n.background="rgba(0, 0, 0, 0.3)",r.addEventListener("click",this.hide.bind(this));var i=document.createElement("div"),n=i.style;for(var o in n.boxSizing="border-box",n.position="fixed",n.top="24px",n.left="50%",n.marginLeft="-140px",n.width="280px",n.padding="24px",n.overflow="hidden",n.background="#fafafa",n.fontFamily="'Roboto', sans-serif",n.boxShadow="0px 5px 20px #666",i.appendChild(this.createH1_("Select your viewer")),e)i.appendChild(this.createChoice_(o,e[o].label));return i.appendChild(this.createButton_("Save",this.onSave_.bind(this))),t.appendChild(r),t.appendChild(i),t},ie.prototype.createH1_=function(e){var t=document.createElement("h1"),r=t.style;return r.color="black",r.fontSize="20px",r.fontWeight="bold",r.marginTop=0,r.marginBottom="24px",t.innerHTML=e,t},ie.prototype.createChoice_=function(e,t){var r=document.createElement("div");r.style.marginTop="8px",r.style.color="black";var n=document.createElement("input");n.style.fontSize="30px",n.setAttribute("id",e),n.setAttribute("type","radio"),n.setAttribute("value",e),n.setAttribute("name","field");var i=document.createElement("label");return i.style.marginLeft="4px",i.setAttribute("for",e),i.innerHTML=t,r.appendChild(n),r.appendChild(i),r},ie.prototype.createButton_=function(e,t){var r=document.createElement("button");r.innerHTML=e;var n=r.style;return n.float="right",n.textTransform="uppercase",n.color="#1094f7",n.fontSize="14px",n.letterSpacing=0,n.border=0,n.background="none",n.marginTop="16px",r.addEventListener("click",t),r};"undefined"!=typeof window?window:void 0!==ge||"undefined"!=typeof self&&self;var oe=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(r,e){!function(e,t){r.exports=t()}(0,function(){return function(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=r,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,r){var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();var i=r(1),o="undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",i),this.noSleepVideo.addEventListener("timeupdate",function(e){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return n(e,[{key:"enable",value:function(){o?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){o?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),e}();e.exports=a},function(e,t,r){e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),ae=1e3,se=[0,0,.5,1],ue=[.5,0,.5,1],le=window.requestAnimationFrame,ce=window.cancelAnimationFrame;function de(e){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:e.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:e.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:e.canPresent},maxLayers:{writable:!1,enumerable:!0,value:e.maxLayers},hasOrientation:{enumerable:!0,get:function(){return T("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),e.hasOrientation}}})}function fe(e){var t=!("wakelock"in(e=e||{}))||e.wakelock;this.isPolyfilled=!0,this.displayId=ae++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return T("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new de({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,t&&r()&&(this.wakelock_=new oe)}fe.prototype.getFrameData=function(e){return t(e,this._getPose(),this)},fe.prototype.getPose=function(){return T("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},fe.prototype.resetPose=function(){return T("VRDisplay.prototype.resetPose"),this._resetPose()},fe.prototype.getImmediatePose=function(){return T("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},fe.prototype.requestAnimationFrame=function(e){return le(e)},fe.prototype.cancelAnimationFrame=function(e){return ce(e)},fe.prototype.wrapForFullscreen=function(e){if(d())return e;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var t=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",t.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==e)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=e,this.originalParent_=e.parentElement,this.originalParent_||document.body.appendChild(e),!this.fullscreenWrapper_.parentElement){var r=this.fullscreenElement_.parentElement;r.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),r.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var n=this;return function(){if(!n.fullscreenElement_)return;var e=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];n.fullscreenElement_.setAttribute("style",e.join("; ")+";")}(),this.fullscreenWrapper_},fe.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElementCachedStyle_?e.setAttribute("style",this.fullscreenElementCachedStyle_):e.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var t=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),this.originalParent_===t?t.insertBefore(e,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(e),t.removeChild(this.fullscreenWrapper_),e}},fe.prototype.requestPresent=function(u){var l=this.isPresenting,c=this;return u instanceof Array||(T("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),u=[u]),new Promise(function(t,e){if(c.capabilities.canPresent)if(0==u.length||u.length>c.capabilities.maxLayers)e(new Error("Invalid number of layers."));else{var r=u[0];if(r.source){var n=r.leftBounds||se,i=r.rightBounds||ue;if(l){var o=c.layer_;o.source!==r.source&&(o.source=r.source);for(var a=0;a<4;a++)o.leftBounds[a]=n[a],o.rightBounds[a]=i[a];return c.wrapForFullscreen(c.layer_.source),c.updatePresent_(),void t()}if(c.layer_={predistorted:r.predistorted,source:r.source,leftBounds:n.slice(0),rightBounds:i.slice(0)},c.waitingForPresent_=!1,c.layer_&&c.layer_.source){var s=c.wrapForFullscreen(c.layer_.source);c.addFullscreenListeners_(s,function(){var e=g();if(c.isPresenting=s===e,c.isPresenting){if(screen.orientation&&screen.orientation.lock){screen.orientation.lock("landscape-primary").catch(function(e){console.error("screen.orientation.lock() failed due to",e.message)})}c.waitingForPresent_=false;c.beginPresent_();t()}else{if(screen.orientation&&screen.orientation.unlock){screen.orientation.unlock()}c.removeFullscreenWrapper();c.disableWakeLock();c.endPresent_();c.removeFullscreenListeners_()}c.fireVRDisplayPresentChange_()},function(){if(!c.waitingForPresent_){return}c.removeFullscreenWrapper(),c.removeFullscreenListeners_(),c.disableWakeLock(),c.waitingForPresent_=false,c.isPresenting=false,e(new Error("Unable to present."))}),!function(e){if(f()){return false}if(e.requestFullscreen){e.requestFullscreen()}else if(e.webkitRequestFullscreen){e.webkitRequestFullscreen()}else if(e.mozRequestFullScreen){e.mozRequestFullScreen()}else if(e.msRequestFullscreen){e.msRequestFullscreen()}else{return false}return true}(s)?(d()||f())&&(c.enableWakeLock(),c.isPresenting=!0,c.beginPresent_(),c.fireVRDisplayPresentChange_(),t()):(c.enableWakeLock(),c.waitingForPresent_=!0)}c.waitingForPresent_||d()||(m(),e(new Error("Unable to present.")))}else t()}else e(new Error("VRDisplay is not capable of presenting."))})},fe.prototype.exitPresent=function(){var r=this.isPresenting,n=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(e,t){r?(!m()&&d()&&(n.endPresent_(),n.fireVRDisplayPresentChange_()),f()&&(n.removeFullscreenWrapper(),n.removeFullscreenListeners_(),n.endPresent_(),n.fireVRDisplayPresentChange_()),e()):t(new Error("Was not presenting to VRDisplay."))})},fe.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},fe.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(e)},fe.prototype.fireVRDisplayConnect_=function(){var e=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(e)},fe.prototype.addFullscreenListeners_=function(e,t,r){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=t,this.fullscreenErrorHandler_=r,t&&(document.fullscreenEnabled?e.addEventListener("fullscreenchange",t,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenchange",t,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",t,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenchange",t,!1)),r&&(document.fullscreenEnabled?e.addEventListener("fullscreenerror",r,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenerror",r,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",r,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenerror",r,!1))},fe.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var t=this.fullscreenChangeHandler_;e.removeEventListener("fullscreenchange",t,!1),e.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),e.removeEventListener("msfullscreenchange",t,!1)}if(this.fullscreenErrorHandler_){var r=this.fullscreenErrorHandler_;e.removeEventListener("fullscreenerror",r,!1),e.removeEventListener("webkitfullscreenerror",r,!1),document.removeEventListener("mozfullscreenerror",r,!1),e.removeEventListener("msfullscreenerror",r,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},fe.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},fe.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},fe.prototype.beginPresent_=function(){},fe.prototype.endPresent_=function(){},fe.prototype.submitFrame=function(e){};var he={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!(fe.prototype.getEyeParameters=function(e){return null}),DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},pe={LEFT:"left",RIGHT:"right"};function me(e){var t=_({},he);e=_(t,e||{}),fe.call(this,{wakelock:e.MOBILE_WAKE_LOCK}),this.config=e,this.displayName="Cardboard VRDisplay",this.capabilities=new de({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new ee(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new W(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new H(this.dpdb_.getDeviceParams(),e.ADDITIONAL_VIEWERS),this.viewerSelector_=new ie(e.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new te),d()&&window.addEventListener("resize",this.onResize_.bind(this))}return(me.prototype=Object.create(fe.prototype))._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},me.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},me.prototype._getFieldOfView=function(e){var t;if(e==pe.LEFT)t=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=pe.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=this.deviceInfo_.getFieldOfViewRightEye()}return t},me.prototype._getEyeOffset=function(e){var t;if(e==pe.LEFT)t=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(e!=pe.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return t},me.prototype.getEyeParameters=function(e){var t=this._getEyeOffset(e),r=this._getFieldOfView(e),n={offset:t,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(n,"fieldOfView",{enumerable:!0,get:function(){return T("VRFieldOfView","VRFrameData's projection matrices"),r}}),n},me.prototype.onDeviceParamsUpdated_=function(e){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},me.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},me.prototype.beginPresent_=function(){var e=this.layer_.source.getContext("webgl");(e=(e=e||this.layer_.source.getContext("experimental-webgl"))||this.layer_.source.getContext("webgl2"))&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(e.canvas.width=h()*this.bufferScale_,e.canvas.height=p()*this.bufferScale_,this.cardboardUI_=new D(e)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new D(e)),this.distorter_=new R(e,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(e){this.viewerSelector_.show(this.layer_.source.parentElement),e.stopPropagation(),e.preventDefault()}.bind(this),function(e){this.exitPresent(),e.stopPropagation(),e.preventDefault()}.bind(this)),this.rotateInstructions_&&(c()&&r()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},me.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},me.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},me.prototype.submitFrame=function(e){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var t=this.layer_.source.getContext("webgl"),r=(t=(t=t||this.layer_.source.getContext("experimental-webgl"))||this.layer_.source.getContext("webgl2")).canvas;r.width==this.lastWidth&&r.height==this.lastHeight||this.cardboardUI_.onResize(),this.lastWidth=r.width,this.lastHeight=r.height,this.cardboardUI_.render()}},me.prototype.onOrientationChange_=function(e){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},me.prototype.onResize_=function(e){if(this.layer_){var t=this.layer_.source.getContext("webgl");(t=(t=t||this.layer_.source.getContext("experimental-webgl"))||this.layer_.source.getContext("webgl2")).canvas.setAttribute("style",["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"].join("; ")+";"),b(t.canvas)}},me.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},me.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},me.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},me.VRDisplay=fe,me}()}(e={exports:{}},e.exports),e.exports),a=(n=o)&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,s={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function u(e){this.config=r(r({},s),e),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&t())&&(this.enable(),this.getVRDisplays().then(function(e){e&&e[0]&&e[0].fireVRDisplayConnect_&&e[0].fireVRDisplayConnect_()}))}u.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(t()){var e=new a({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(e)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},u.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var t=this.native.VRFrameData,r=new this.native.VRFrameData,n=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(e){e instanceof t?n.call(this,e):(n.call(this,r),e.pose=r.pose,i(r.leftProjectionMatrix,e.leftProjectionMatrix),i(r.rightProjectionMatrix,e.rightProjectionMatrix),i(r.leftViewMatrix,e.leftViewMatrix),i(r.rightViewMatrix,e.rightViewMatrix))}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=a.VRDisplay,window.VRFrameData=a.VRFrameData},u.prototype.getVRDisplays=function(){var t=this;this.config;return this.hasNative?this.native.getVRDisplays.call(navigator).then(function(e){return 0<e.length?e:t.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},u.version="0.10.10",u.VRFrameData=a.VRFrameData,u.VRDisplay=a.VRDisplay;var l=Object.freeze({default:u}),c=l&&u||l;return void 0!==ge&&ge.window&&(ge.document||(ge.document=ge.window.document),ge.navigator||(ge.navigator=ge.window.navigator)),c},"object"==typeof n&&void 0!==r?r.exports=t():"function"==typeof define&&define.amd?define(t):e.WebVRPolyfill=t()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],620:[function(e,r,t){var d=/\n/,n=/\s/;function h(e,t,r,n){var i=e.indexOf(t,r);return-1===i||n<i?n:i}function p(e){return n.test(e)}function s(e,t,r,n){return{start:t,end:t+Math.min(n,r-t)}}r.exports=function(t,e){return r.exports.lines(t,e).map(function(e){return t.substring(e.start,e.end)}).join("\n")},r.exports.lines=function(e,t){if(0===(t=t||{}).width&&"nowrap"!==t.mode)return[];e=e||"";var r="number"==typeof t.width?t.width:Number.MAX_VALUE,n=Math.max(0,t.start||0),i="number"==typeof t.end?t.end:e.length,o=t.mode,a=t.measure||s;return"pre"===o?function(e,t,r,n,i){for(var o=[],a=r,s=r;s<n&&s<t.length;s++){var u=t.charAt(s),l=d.test(u);if(l||s===n-1){var c=e(t,a,l?s:s+1,i);o.push(c),a=s+1}}return o}(a,e,n,i,r):function(e,t,r,n,i,o){var a=[],s=i;"nowrap"===o&&(s=Number.MAX_VALUE);for(;r<n&&r<t.length;){for(var u=h(t,"\n",r,n);r<u&&p(t.charAt(r));)r++;var l=e(t,r,u,s),c=r+(l.end-l.start),d=c+"\n".length;if(c<u){for(;r<c&&!p(t.charAt(c));)c--;if(c===r)r+"\n".length<d&&d--,c=d;else for(d=c;r<c&&p(t.charAt(c-"\n".length));)c--}if(r<=c){var f=e(t,r,c,s);a.push(f)}r=d}return a}(a,e,n,i,r,o)}},{}],621:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)i.call(r,n)&&(e[n]=r[n])}return e};var i=Object.prototype.hasOwnProperty},{}],622:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=function(){function r(e,t){i(this,r),this.__onError=t,this.__target=e,this.__attrs={}}return o(r,[{key:"extract",value:function(e){var t=this,r=new s(e,this.__target,this.__onError);return this.__attrs[e]=r,Object.defineProperty(this,e,{get:function(){return t.get(e)}}),r}},{key:"get",value:function(e){return this.__attrs[e].get(e)}},{key:"toObject",value:function(){var e={};for(var t in this.__attrs)e[t]=this.__attrs[t].get();return e}}]),r}();r.default=a;var s=function(){function n(e,t,r){i(this,n),this.__onError=r,this.__name=e,this.__checks=[],this.__default=void 0,this.__value=null,this.__mandatory=!1,this.__bool=!1,this.__target=t}return o(n,[{key:"boolean",value:function(){return this.__bool=!0,this}},{key:"from",value:function(e){return this.__target=e,this}},{key:"default",value:function(e){return this.__default=e,this}},{key:"mandatory",value:function(){return this.__mandatory=!0,this}},{key:"stringLongerThan",value:function(e){var t=0<arguments.length&&void 0!==e?e:0;return this.__checks.push({fn:function(e){return"string"==typeof e&&e.length>t},msg:"".concat(this.__name," should be a string of length > ").concat(t)}),this}},{key:"number",value:function(){return this.__checks.push({fn:function(e){return"number"==typeof Number(e)&&!isNaN(Number(e))},msg:"".concat(this.__name," should be a number")}),this}},{key:"belongsToSet",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.__checks.push({fn:function(e){return-1<t.indexOf(e)},msg:"".concat(this.__name," allowed values: ")+t.join(", ")}),this}},{key:"positive",value:function(e){var t=0<arguments.length&&void 0!==e&&e;return this.greaterThan(0,t)}},{key:"negative",value:function(e){var t=0<arguments.length&&void 0!==e&&e;return this.lessThan(0,t)}},{key:"greaterThan",value:function(t,e){var r=1<arguments.length&&void 0!==e&&e;return this.__checks.push({fn:function(e){return r?t<e:t<=e},msg:"".concat(this.__name," should be ").concat(r?"strictly":""," greater than ").concat(t)}),this}},{key:"lessThan",value:function(t,e){var r=1<arguments.length&&void 0!==e&&e;return this.__checks.push({fn:function(e){return r?e<t:e<=t},msg:"".concat(this.__name," should be ").concat(r?"strictly":""," less than ").concat(t)}),this}},{key:"validCSS",value:function(){return this.__checks.push({fn:function(e){return(e=String(e).toLowerCase()).match(/\d+(px|em|%|vw|vh|in|pt|pc|mm|cm)/gi)||"inherit"===e||"auto"===e},msg:"".concat(this.__name," should be a valid CSS string")}),this}},{key:"aspect",value:function(){return this.__checks.push({fn:function(e){return String(e).match(/\d+[:\/]{1}\d+/gi)},msg:"".concat(this.__name," should be aspect value (x:y or x/y)")}),this}},{key:"__extract",value:function(){return{has:this.__target.hasAttribute(this.__name),val:this.__target.getAttribute(this.__name)}}},{key:"get",value:function(){var t=this,e=this.__extract(),r=e.has,n=e.val;return this.__bool?r:(!r&this.__mandatory&&this.__onError("".concat(this.__name," is mandatory attribute")),r&&null!=n&&""!==n?(this.__checks.forEach(function(e){e.fn.call(t,n)||t.__onError(e.msg)}),n):this.__default)}}]),n}()},{}],623:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractAds=function(e,n){var t=(0,o.default)(e).find("deo-ads"),i=[];return(0,o.default)(t).find("deo-banner").each(function(e,t){var r=new a.default(t,n);r.extract("url").stringLongerThan(0).mandatory(),r.extract("title").stringLongerThan(0).mandatory(),r.extract("text").stringLongerThan(0).mandatory(),r.extract("thumb").stringLongerThan(0).mandatory(),i.push({type:"banner",url:r.get("url"),title:r.get("title"),text:r.get("text"),thumb:r.get("thumb")})}),0<i.length?new s.default(i):null};var o=n(e("jquery")),a=n(e("./attr-extractor")),s=n(e("../core/assets/ads-pack"));function n(e){return e&&e.__esModule?e:{default:e}}},{"../core/assets/ads-pack":633,"./attr-extractor":622,jquery:582}],624:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Bootstrapper=void 0;var n=e("../core/utils/listeners-manager");e("three");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.app=e,this.currentListenersManager=new n.ListenersManager,this._stateEnterCallbacks={},e&&(this.initializeListeners(),this.onAppStart())}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"initializeListeners",value:function(){var t=this;this._binding=this.app.getService("state-manager").onStateChange.add(function(e){return t.onStateChange(e)})}},{key:"onStateChange",value:function(e){null!==this.currentListenersManager&&this.currentListenersManager.dispose(),this.currentListenersManager=new n.ListenersManager;var t=this._stateEnterCallbacks[e];t&&t.call(this)}},{key:"onAppStart",value:function(){}},{key:"onMarkupLoad",value:function(){}},{key:"start",value:function(){this.app.start()}},{key:"dispose",value:function(){this.currentListenersManager&&this.currentListenersManager.dispose(),this._binding&&this._binding.detach()}},{key:"addStateEnterCallback",value:function(e,t){this._stateEnterCallbacks[e]=t}}]),t}();r.Bootstrapper=o},{"../core/utils/listeners-manager":691,three:615}],625:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoBootstrapperStates=r.DeoBasicBootstrapper=void 0;var n=e("./bootstrapper"),o=e("../core/utils/common-tools"),i=e("../core/utils/listeners-manager"),a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),s=e("./state-adapters/deo-common-callback"),l=e("../defines"),c=e("../options"),d=(e("../core/app"),u(e("jquery"))),f=u(e("./attr-extractor")),h=(e("three"),e("../misc/open-deeplink"));function u(e){return e&&e.__esModule?e:{default:e}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function v(e,t,r){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=o.CommonTools.isMobile(),E=function(){function u(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(r=g(this,y(u).call(this))).commonListenersManager=new i.ListenersManager,r.root=e,r.disposed=!1,r.app=null,r.params=t||{},r.state=r.params.initialState||w.EMPTY,r.htmlURL=r.params.htmlURL||"",r.onStartup=new a.Signal,r.onDispose=new a.Signal,r.onReady=new a.Signal,r.extractAttributes(),r.setupPreplay(),r.runStartupSequence(),r.setupSizing(),r.commonListenersManager.binding(r.onStartup,function(){return r.root.dispatchEvent(new Event("start"))}),r.commonListenersManager.binding(r.onDispose,function(){return r.root.dispatchEvent(new Event("stop"))}),t.dispatchInitializeEvent&&setTimeout(function(){return r.root.dispatchEvent(new Event("initialize"))},0),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(u,n.Bootstrapper),function(e,t,r){t&&m(e.prototype,t),r&&m(e,r)}(u,[{key:"dispose",value:function(){v(y(u.prototype),"dispose",this).call(this),(0,d.default)(this.root).find(".deo-container").remove(),(0,d.default)("body").removeClass("no-scroll"),(0,d.default)(this.root).removeClass("deo--running"),(0,d.default)(this.root).removeClass("deo--maximized"),this.app&&this.app.dispose(),this.disposed=!0,this.state=w.DISPOSED,this.onDispose.dispatch()}},{key:"extractAttributes",value:function(){this.attrs=new f.default(this.root,this.showError),this.attrs.extract("cover-image").default(""),this.attrs.extract("width").validCSS(),this.attrs.extract("height").validCSS(),this.attrs.extract("aspect").aspect(),this.attrs.extract("duration").number().positive()}},{key:"createContainer",value:function(){var r=this;if(!this.disposed){if(this.state>=w.IDLE)return Promise.resolve("Container already exists");var e='\n            <div class="deo-container">\n                <div class="deo-cover" style="background-image: url('.concat(this.attrs["cover-image"],')">\n                    <div class="deo-deeplink open slr-style" is-deeplink deeplink-type="static">\n                        <img src="https://s3.deovr.com/version/1.7.1/assets/deo/deo.svg"/>\n                        OPEN IN DEOVR\n                    </div>\n                    <div class="deo-cover-button">\n                        <div class="deo-cover-play-icon">\n                        </div>\n                    </div>\n                </div>\n                <div class="deo-loading">\n                    <div class="deo-loading-icon">\n                    </div>\n                </div>\n                <div class="deo-message deo-error">\n                    <div class="deo-message-content-flex-v">\n                    <div class="deo-error-text">\n                        Some error text\n                    </div>\n                    </div>\n                </div>\n            </div>\n        ').replace(/<\$DEO_BASE_PATH\$>/gi,l.DEFINES.DEO_BASE_PATH);return(0,d.default)(this.root).append(e),(0,d.default)(this.root).find(".deo-cover .deo-deeplink").click(function(e){(0,h.openStaticDeeplink)(r.root).catch(function(e){console.log("Failed to open deepliink: "+e),(0,d.default)(r.root).find(".deo-cover-button").trigger("click"),r.onReady.addOnce(function(){(0,d.default)(r.root).find(".deo-get-app").addClass("deo-message--visible")})}),e.stopImmediatePropagation()}),new Promise(function(t,e){(0,d.default)(r.root).find(".deo-cover").click(function(e){(0,d.default)(r.root).find(".deo-cover").addClass("deo-cover--hidden"),(0,d.default)(r.root).addClass("deo--running"),b&&((0,d.default)("body").addClass("no-scroll"),(0,d.default)(r.root).addClass("deo--maximized")),t()})})}}},{key:"setupPreplay",value:function(){var e=(0,d.default)(this.root).find("> deo-preplay");if(0<e.length&&!e.get(0).hasAttribute("custom")){var t=e.attr("title")||this.attrs.title||"",r=e.attr("subtitle")||"",n=e.attr("duration")||this.attrs.duration||"";e.html('\n                    <div class="deo-default-preplay">\n                        <div class="deo-default-preplay-title">\n                            <div class="deo-default-preplay-title-left">\n                                '.concat(t,'\n                            </div>\n                            <div class="deo-default-preplay-title-right">\n                                ').concat(""!=n?o.CommonTools.formatTime(n):"",'\n                            </div>\n                        </div>\n                        <div class="deo-default-preplay-subtitle">\n                            ').concat(r,"\n                        </div>\n                    </div>\n                "))}}},{key:"showError",value:function(e){throw(0,d.default)(this.root).find(".deo-error").addClass("deo-message--visible").find(".deo-error-text").text(e),console.error(e),new Error(e)}},{key:"runStartupSequence",value:function(){var t=this;return this.createContainer().then(function(){return t.onStartup.dispatch()}).then(this.loadHTML.bind(this)).then(this.onHTMLLoad.bind(this)).then(this.initializeApp.bind(this)).then(this.afterInitializeApp.bind(this)).then(this.startApp.bind(this)).then(this.afterStartApp.bind(this)).catch(function(e){return t.showError(e)})}},{key:"loadHTML",value:function(e){var n=this;if(!this.disposed)return this.state>=w.LOADING_HTML?Promise.resolve("HTML is already loading"):(this.state=w.LOADING_HTML,new Promise(function(t,r){d.default.get({url:n.htmlURL,success:function(e){t(e)},error:function(e){r("Error when loading DeoVR HTML")}})}))}},{key:"onHTMLLoad",value:function(e){if(!this.disposed)return this.state>=w.HAS_HTML?Promise.resolve("HTML already exist"):(this.state=w.HAS_HTML,e=e.replace(/<\$DEO_BASE_PATH\$>/gi,l.DEFINES.DEO_BASE_PATH),(0,d.default)(this.root).find(".deo-container").append(e),this.setupPages(),this.setupMessages(),Promise.resolve())}},{key:"setupPages",value:function(){var l=this;this.statePageMap={},(0,d.default)(this.root).find(".deo-page").each(function(e,t){var r=(0,d.default)(t).attr("visible-when");if("string"==typeof r){r=r.split(",").map(function(e){return e.trim().toLowerCase()});var n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;l.statePageMap[u]||(l.statePageMap[u]=[]),l.statePageMap[u].push(t)}}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}})}},{key:"setupMessages",value:function(){(0,d.default)(this.root).find(".deo-message-close-button").click(function(e){(0,d.default)(e.currentTarget).parent().removeClass("deo-message--visible")})}},{key:"setupSizing",value:function(){var e=this,t=this.attrs.width,r=this.attrs.height,n=o.CommonTools.parseAspect(this.attrs.aspect);t||r||!n||(t="100%"),!t||r||n||(n=16/9),t||!r||n||(n=16/9),t||r||n||(t="100%",n=16/9);function i(){t&&r?((0,d.default)(e.root).css("width",t),(0,d.default)(e.root).css("height",r)):t&&n?((0,d.default)(e.root).css("width",t),(0,d.default)(e.root).css("height",(0,d.default)(e.root).width()/n+"px")):r&&n&&((0,d.default)(e.root).css("height",r),(0,d.default)(e.root).css("width",(0,d.default)(e.root).height()*n+"px"))}this.commonListenersManager.add(window,"resize",function(){i(),setTimeout(function(){i()},300)}),this.commonListenersManager.add(window,"orientationchange",function(){i(),setTimeout(function(){i()},300)}),this.commonListenersManager.vendors(document,"fullscreenchange",function(e){i(),setTimeout(function(){i()},300)}),i()}},{key:"initializeApp",value:function(){return Promise.resolve()}},{key:"afterInitializeApp",value:function(){var t=this;if(!(this.state>=w.RUNNING)){this.app||this.showError("App is still not initialized! Did you forget to do this.app = new App()?");var e=this.app;s.deoCommonCallback.call(this),this.commonListenersManager.add(this.app.bus.internal,c.options.internalEvents.DEO_ERROR,function(e){t.showError(e.message)}),e.getService("state-manager").onStateChange.add(this.onStateChange.bind(this));var r=e.getValue("dom-element");(0,d.default)(this.root).find(".deo-container").append(r),this.commonListenersManager.add(e.bus.internal,c.options.internalEvents.HIDE_GLOBAL_SPINNER,function(){(0,d.default)(t.root).find(".deo-loading").addClass("deo-loading--hidden")})}}},{key:"startApp",value:function(){}},{key:"afterStartApp",value:function(){this.state>=w.RUNNING||(this.state=w.RUNNING,this.drainEvents())}},{key:"drainEvents",value:function(){function e(t){return function(e){return r.root.dispatchEvent(new CustomEvent(t,{detail:e}))}}var r=this,t=this.app;this.commonListenersManager.add(t.bus.internal,c.options.internalEvents.PLAYING,e("play")),this.commonListenersManager.add(t.bus.internal,c.options.internalEvents.TIME_UPDATED,e("timeupdate")),this.commonListenersManager.add(t.bus.internal,c.options.internalEvents.PAUSE,e("pause")),this.commonListenersManager.add(t.bus.internal,c.options.internalEvents.VIDEO_ENDED,e("end"))}},{key:"onStateChange",value:function(e){v(y(u.prototype),"onStateChange",this).call(this,e);var t=this.statePageMap[e];if((0,d.default)(this.root).find(".deo-page").removeClass("deo-page--active"),t){var r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;(0,d.default)(s).addClass("deo-page--active")}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}}},{key:"replaceBrandColor",value:function(e,t){var r=0<arguments.length&&void 0!==e?e:"red",n=1<arguments.length&&void 0!==t?t:"39BAE5",i=Object.values(window.getComputedStyle((0,d.default)(this.root).get(0))).filter(function(e){return-1<e.indexOf("color")}),o="rgb("+/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n).splice(1,3).map(function(e){return parseInt(e,16)}).join(", ")+")";(0,d.default)(this.root).find("*").each(function(e,t){i.forEach(function(e){(0,d.default)(t).css(e)==o&&(0,d.default)(t).css(e,r)})})}}]),u}();r.DeoBasicBootstrapper=E;var w={EMPTY:0,IDLE:1,LOADING_HTML:2,HAS_HTML:3,RUNNING:4,DISPOSED:5};r.DeoBootstrapperStates=w},{"../core/app":632,"../core/utils/common-tools":688,"../core/utils/listeners-manager":691,"../defines":710,"../misc/open-deeplink":715,"../options":717,"./attr-extractor":622,"./bootstrapper":624,"./state-adapters/deo-common-callback":628,jquery:582,signals:612,three:615}],626:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoHubBootstrapper=void 0;var n,s=e("./deo-basic-bootstrapper"),i=e("../core/app"),o=(e("../core/utils/listeners-manager"),e("../options"),e("../states/cinema/cinema-deo")),a=e("./state-adapters/deo-video-callback"),u=e("./state-adapters/deo-hub-callback"),l=e("../defines"),c=(n=e("jquery"))&&n.__esModule?n:{default:n},d=e("../states/hub/deo-hub"),f=e("../states/hub/deo-hub-widget-collection"),h=e("./deo-video-bootstrapper"),p=e("./bootstrap-helpers");function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function y(e,t,r){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=v(this,_(n).call(this,e,t))).htmlURL=l.DEFINES.DEO_BASE_PATH+"assets/html/deo-full.html",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(n,s.DeoBasicBootstrapper),function(e,t,r){t&&g(e.prototype,t),r&&g(e,r)}(n,[{key:"dispose",value:function(){y(_(n.prototype),"dispose",this).call(this),(0,c.default)(this.root).find(".deo-container").remove()}},{key:"extractAttributes",value:function(){y(_(n.prototype),"extractAttributes",this).call(this),this.attrs.extract("spacing").number().positive(!1).lessThan(.2).default(.05),this.attrs.extract("content-height").number().greaterThan(1).lessThan(3).default(2),this.attrs.extract("content-offset")}},{key:"createContainer",value:function(){if(!this.disposed){var e=y(_(n.prototype),"createContainer",this).call(this);return(0,c.default)(this.root).find(".deo-cover .deo-deeplink").css("display","none"),e}}},{key:"initializeApp",value:function(){if(!(this.state>=s.DeoBootstrapperStates.RUNNING)){var e=(new f.DeoHubWidgetCollection).setErrorCallback(this.showError.bind(this));e.fromHTML(this.root);var t=(0,p.extractAds)(this.root,this.showError),r=this.app=new i.App(Object.assign(this.params,{hubOptions:{disable:!1},hubWidgets:e,contentHeight:this.attrs["content-height"],contentSpacing:this.attrs.spacing,contentOffset:this.attrs["content-offset"],ads:t}));this.addStateEnterCallback("cinema",a.deoVideoCallback),this.addStateEnterCallback("hub",u.deoHubCallback);var n=r.getService("state-manager");n.add("cinema",o.CinemaDEO),n.add("hub",d.DeoHub)}}},{key:"startApp",value:function(){if(!(this.state>=s.DeoBootstrapperStates.RUNNING)){var e=this.app.getService("state-manager"),t=(0,c.default)(this.root).find("deo-video");if(0<t.length){var r={root:t[0],showError:this.showError.bind(this)};h.DeoVideoBootstrapper.prototype.extractAttributes.call(r);var n=r.attrs,i=h.DeoVideoBootstrapper.prototype.getSources.call(r),o=h.DeoVideoBootstrapper.prototype.getPreviewConfiguration.call(r),a=Object.assign(n.toObject(),{autoplay:!0,src:i,"preview-configuration":o});e.show("cinema",a)}else e.show("hub");this.app.start(),this.onReady.dispatch()}}}]),n}();r.DeoHubBootstrapper=E},{"../core/app":632,"../core/utils/listeners-manager":691,"../defines":710,"../options":717,"../states/cinema/cinema-deo":718,"../states/hub/deo-hub":765,"../states/hub/deo-hub-widget-collection":762,"./bootstrap-helpers":623,"./deo-basic-bootstrapper":625,"./deo-video-bootstrapper":627,"./state-adapters/deo-hub-callback":629,"./state-adapters/deo-video-callback":630,jquery:582}],627:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoVideoBootstrapper=void 0;var i=e("./deo-basic-bootstrapper"),o=e("../core/app"),a=(e("../core/utils/listeners-manager"),e("../options"),e("../states/cinema/cinema-deo")),s=e("./state-adapters/deo-video-callback"),u=e("../defines"),l=n(e("jquery")),c=e("../core/utils/common-tools"),d=n(e("./attr-extractor")),f=e("./bootstrap-helpers");function n(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function g(e,t,r){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=m(this,v(n).call(this,e,t))).htmlURL=u.DEFINES.DEO_BASE_PATH+"assets/html/deo-full.html",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(n,i.DeoBasicBootstrapper),function(e,t,r){t&&p(e.prototype,t),r&&p(e,r)}(n,[{key:"extractAttributes",value:function(){g(v(n.prototype),"extractAttributes",this).call(this),this.attrs.extract("angle").number().greaterThan(90).lessThan(360).default(180),this.attrs.extract("loop").boolean(),this.attrs.extract("muted").boolean(),this.attrs.extract("flat").boolean(),this.attrs.extract("flat-aspect").aspect(),this.attrs.extract("format").default("LR").belongsToSet("mono","LR","TB"),this.attrs.extract("title").default(""),this.attrs.extract("camera-controls").belongsToSet("drag","magic window")}},{key:"getSources",value:function(){var r=[],n=1;return(0,l.default)(this.root).find("source").each(function(e,t){r.push({url:(0,l.default)(t).attr("src"),mimeType:(0,l.default)(t).attr("mimeType")||"",quality:(0,l.default)(t).attr("quality")||"HD"+n++})}),0===r.length&&this.showError("No sources provided for DeoVR player"),r}},{key:"getPreviewConfiguration",value:function(){var n=this,e=(0,l.default)(this.root).find("deo-video-preview")[0];if(!e)return null;var i=[];if((0,l.default)(e).find("deo-spritesheet").each(function(e,t){var r=new d.default(t,n.showError.bind(n));r.extract("columns").number().greaterThan(0,!0).mandatory(),r.extract("rows").number().greaterThan(0,!0).mandatory(),r.extract("frames").number().greaterThan(0,!0),r.extract("frameWidth").number().greaterThan(0,!0),r.extract("frameHeight").number().greaterThan(0,!0),r.extract("src").stringLongerThan(0).mandatory(),i.push({columns:parseInt(r.get("columns")),rows:parseInt(r.get("rows")),frames:parseInt(r.get("frames")),src:r.get("src"),frameWidth:parseInt(r.get("frameWidth")),frameHeight:parseInt(r.get("frameHeight"))})}),0===i.length)return null;var t=new d.default(e,this.showError.bind(this));return t.extract("aspect").aspect().default("16:9"),{sheets:i,aspect:c.CommonTools.parseAspect(t.get("aspect"))}}},{key:"initializeApp",value:function(){if(!(this.state>=i.DeoBootstrapperStates.RUNNING)){var e=(0,f.extractAds)(this.root,this.showError),t=this.app=new o.App(Object.assign(this.params,{ads:e,hubOptions:{disable:!0}}));this.addStateEnterCallback("cinema",s.deoVideoCallback),t.getService("state-manager").add("cinema",a.CinemaDEO)}}},{key:"startApp",value:function(){if(!(this.state>=i.DeoBootstrapperStates.RUNNING)){var e=this.app.getService("state-manager"),t=this.getPreviewConfiguration();e.show("cinema",Object.assign(this.attrs.toObject(),{"preview-configuration":t,autoplay:!0,src:this.getSources()})),this.app.start(),this.onReady.dispatch()}}}]),n}();r.DeoVideoBootstrapper=_},{"../core/app":632,"../core/utils/common-tools":688,"../core/utils/listeners-manager":691,"../defines":710,"../options":717,"../states/cinema/cinema-deo":718,"./attr-extractor":622,"./bootstrap-helpers":623,"./deo-basic-bootstrapper":625,"./state-adapters/deo-video-callback":630,jquery:582}],628:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deoCommonCallback=void 0;var f=e("../../options"),h=(e("../../core/utils/math-tools"),e("../../core/utils/vendor-tools")),p=i(e("is_js")),m=(n(e("signals")),e("../../core/utils/value"),e("os"),n(e("jquery"))),g=i(e("../../misc/open-deeplink")),v=(e("../deo-video-bootstrapper"),n(e("copy-to-clipboard"))),y=n(e("../../core/utils/request-device-orientation-permission"));function n(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}r.deoCommonCallback=function(){var e,t,a,s,r,n,i=this,o=this.commonListenersManager,u=this.root,l=this.app,c=!l.polyfilled;function d(e){return'<div class="deo-learn-more-flag-item">\n                <div class="copied-message">Copied!</div>\n                <span>'.concat(e,"</span>\n            </div><br/>")}e=(0,m.default)(u).find(".deo-close-button").get(0),o.add(e,["click","tap"],function(){i.dispose()}),t=(0,m.default)(u).find(".deo-vr-button").get(0),o.add(t,["click","tap"],function(){(0,y.default)().then(function(){!c&&p.chrome()&&(p.desktop()||p.mobile())?(0,m.default)(u).find(".deo-learn-more").addClass("deo-message--visible"):l.getService("vr-manager").vrAvailable?l.toggleVRMode():(0,m.default)(u).find(".deo-learn-more").addClass("deo-message--visible").addClass("deo-learn-more--no-chrome")})}),(0,m.default)(u).find(".deo-learn-more-continue").click(function(){(0,m.default)(u).find(".deo-learn-more").removeClass("deo-message--visible"),l.toggleVRMode()}),o.add(l.bus.internal,f.options.internalEvents.REQUEST_GET_DEO_MESSAGE,function(){(0,m.default)(u).find(".deo-get-app").addClass("deo-message--visible")}),(0,m.default)(u).find("[is-deeplink]").each(function(e,t){var r=(0,m.default)(t),n=r.attr("deeplink-type");r.click(function(e){switch(n){case"static":(0,g.openStaticDeeplink)(u);break;case"dynamic":default:l.bus.external.dispatchEvent({type:f.options.externalEvents.DEEPLINK_CLICKED})}})}),a="deo-message-tab-page--hidden",s="deo-message-tab-header--selected",(0,m.default)("[tab-pages-container-id]").each(function(e,t){var r=(0,m.default)(t),n=r.find(".deo-message-tab-header"),i=r.attr("tab-pages-container-id"),o=(0,m.default)("#"+i).find(".deo-message-tab-page");o.addClass(a).first().removeClass(a),n.each(function(e,t){var r=(0,m.default)(t).attr("tab-page-id");if(!r)throw new Error("No tab-page-id provided in header");(0,m.default)(t).click(function(){!function(e){o.addClass(a).filter('[tab-page-id="'.concat(e,'"]')).removeClass(a)}(r),function(e){n.removeClass(s).filter('[tab-page-id="'.concat(e,'"]')).addClass(s)}(r)})})}),r=["chrome://flags/#enable-webvr","chrome://flags/#oculus-vr","chrome://flags/#openvr"].map(d).join(""),n=["chrome://flags/#enable-webvr"].map(d).join(""),(0,m.default)(u).find(".deo-learn-more .deo-learn-more-flags-list").html(p.mobile()?n:r),(0,m.default)(".deo-learn-more-flag-item div").click(function(e){var t=(0,m.default)(e.target).parent().find("span").text();(0,v.default)(t,{debug:!1})&&((0,m.default)(e.target).parent().addClass("copied"),h.VendorTools.resetCSSAnimation((0,m.default)(e.target).parent().get(0)))})}},{"../../core/utils/math-tools":692,"../../core/utils/request-device-orientation-permission":695,"../../core/utils/value":697,"../../core/utils/vendor-tools":698,"../../misc/open-deeplink":715,"../../options":717,"../deo-video-bootstrapper":627,"copy-to-clipboard":9,is_js:580,jquery:582,os:587,signals:612}],629:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deoHubCallback=void 0;e("../../options"),e("../../core/utils/math-tools");var i=e("../../core/utils/vendor-tools"),o=(function(e){{if(e&&e.__esModule)return;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}t.default=e}}(e("is_js")),n(e("signals")),e("../../core/utils/value"),e("os"),n(e("jquery"))),a=e("../../defines");function n(e){return e&&e.__esModule?e:{default:e}}r.deoHubCallback=function(){var e,r,t=this.currentListenersManager,n=this.root;this.app.polyfilled;(0,o.default)(n).addClass("deo-player-ads-hidden"),e=(0,o.default)(n).find(".deo-hub-fullscreen").get(0),r=n,t.add(e,["click","tap"],function(){if(i.VendorTools.loadFirstExtension(["isFullscreen","isFullScreen","fullscreen","fullScreen"],document).value){var e=i.VendorTools.loadFirstExtension(["cancelFullscreen","cancelFullScreen"],document).value;e&&e.call(document)}else{var t=i.VendorTools.loadFirstExtension(["requestFullscreen","requestFullScreen"],r).value;t&&t.call(r)}}),t.vendors(document,"fullscreenchange",function(e){!function(e){(0,o.default)(n).find(".deo-hub-fullscreen img").attr("src",e?a.DEFINES.DEO_BASE_PATH+"assets/deo/fullscreen-off.svg":a.DEFINES.DEO_BASE_PATH+"assets/deo/fullscreen.svg")}(i.VendorTools.loadFirstExtension(["isFullscreen","isFullScreen","fullscreen","fullScreen"],document).value)})}},{"../../core/utils/math-tools":692,"../../core/utils/value":697,"../../core/utils/vendor-tools":698,"../../defines":710,"../../options":717,is_js:580,jquery:582,os:587,signals:612}],630:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deoVideoCallback=void 0;var P=e("../../options"),C=e("../../core/utils/math-tools"),D=e("../../core/utils/vendor-tools"),I=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("is_js")),L=(n(e("signals")),e("../../core/utils/value")),N=e("../../defines"),k=n(e("jquery"));n(e("../../core/assets/preview-texture-pack")),e("../../core/utils/listeners-manager");function n(e){return e&&e.__esModule?e:{default:e}}r.deoVideoCallback=function(){var e,r,n,t=this,u=this.currentListenersManager,l=this.root,h=this.app,i=(h.polyfilled,function(){var i=null;u.add(h.bus.internal,P.options.internalEvents.ADS_PACK_UPDATED,function(e){var t=e.pack;i=t});function e(){return(0,k.default)(l).addClass("deo-player-ads-hidden")}return e(),{showAds:function(){i&&i.bannerCycle.exists()&&((0,k.default)(l).find('div[ad-container-type="banner"]').each(function(e,t){var r=i.bannerCycle.next(),n=function(e,t,r,n){return'<div class="deo-player-controls-ad" onclick="window.open(\''.concat(n,'\')">\n                    <img class="deo-player-controls-ad-img" src="').concat(r,'"/>\n                    <div class="deo-player-controls-ad-textbox">\n                        <h2>').concat(e,"</h2>\n                        ").concat(t,"\n                    </div>\n                </div>")}(r.title,r.text,r.thumb,r.url);(0,k.default)(t).html(n)}),(0,k.default)(l).removeClass("deo-player-ads-hidden"))},hideAds:e}}()),o=i.showAds,a=i.hideAds;e=h.getValue("dom-element"),r=!1,n=0,u.add(e,["mousedown"],function(e){return O()?R():E._?b():void(h.isPresentingToDevice()||(r=!0,n=Date.now()))},!0),u.add(e,["mouseup"],function(e){if(r){var t=Date.now()-n;r=!1,t<P.options.clickMaxTimeMS&&h.bus.external.dispatchEvent({type:"play_pause_press",sourceEvent:e})}}),u.add(e,"mouseout",function(e){r=!1});var s,c,d,f,p,m,g,v,y,_=(s=0,c=new L.Value(!0),t.onDispose.addOnce(function(){0!==s&&clearTimeout(s)}),A(),u.add(l,["mousemove","mousedown","touchmove"],A,!1),{showControls:A,hideControls:w,controlsHidden:c}),b=_.showControls,E=_.controlsHidden;function w(){c._=!0,(0,k.default)(l).find(".deo-container").addClass("deo-controls--hidden")}function A(){setTimeout(function(){c._=!1,(0,k.default)(l).find(".deo-container").removeClass("deo-controls--hidden")},0),0!==s&&clearTimeout(s),s=setTimeout(w,3e3)}function T(e){e=e||0;var t=new Date(1e3*e);function r(e){return e<10?"0"+e:e}return(3600<e?r(t.getUTCHours())+":":"")+r(t.getUTCMinutes())+":"+r(t.getUTCSeconds())}function S(e){var t="translateX(".concat(100*-(1-e),"%)");(0,k.default)(l).find(".deo-player-seekbar-filler").css("transform",t),(0,k.default)(l).find(".deo-player-seekbar-handle-container").css("overflow","visible").css("transform",t)}function x(e){e=C.MathTools.clamp01(e),S(e),h.bus.external.dispatchEvent({relativeTime:e,type:P.options.externalEvents.SET_CURRENT_TIME})}d=(0,k.default)(l).find(".deo-player-seekbar").get(0),f=(0,k.default)(l).find(".deo-player-seekbar-progress").get(0),p=!1,m=0,u.add(h.bus.internal,P.options.internalEvents.TIME_UPDATED,function(e){if(!h.isPresentingToDevice()){var t=e.currentTime/e.duration;S(t);var r=Date.now();1e3<r-m&&((0,k.default)(".deo-player-timecode").text(T(e.currentTime)+" | "+T(e.duration)),m=r)}}),u.add(d,["mousedown","touchstart"],function(e){p=!0;var t=(0,k.default)(f).offset();e.touches?x((e.touches[0].pageX-t.left)/f.offsetWidth):x((e.pageX-t.left)/f.offsetWidth)}),u.add(document,["touchmove","mousemove"],function(e){if(p){var t=(0,k.default)(f).offset();e.touches?x((e.touches[0].pageX-t.left)/f.offsetWidth):x((e.pageX-t.left)/f.offsetWidth)}}),u.add(document,["touchend","touchcancel","mouseup"],function(){p=!1}),function(){function r(e){(0,k.default)(l).find(".deo-player-vol-filler").css("transform","translateY(".concat(100*(1-e),"%)"))}function n(e){var t=0==e?N.DEFINES.DEO_BASE_PATH+"assets/deo/sound-0.svg":.5<e?N.DEFINES.DEO_BASE_PATH+"assets/deo/sound-100.svg":N.DEFINES.DEO_BASE_PATH+"assets/deo/sound-50.svg";(0,k.default)(l).find(".deo-player-volume .deo-player-button-icon").attr("src",t)}function i(e){if("number"!=typeof e||!isNaN(e)){var t=0==(e=C.MathTools.clamp01(e));s=e,h.bus.external.dispatchEvent({volume:e,muted:t,type:P.options.externalEvents.VOLUME_UPDATED}),r(e),n(e)}}var e=(0,k.default)(l).find(".deo-player-vol-slider-outer").get(0),o=(0,k.default)(l).find(".deo-player-vol-slider-inner").get(0),a=!1,s=1;u.add(e,["mousedown","touchstart"],function(e){a=!0;var t=(0,k.default)(o).offset();e.touches?i(1-(e.touches[0].pageY-t.top)/o.offsetHeight):i(1-(e.pageY-t.top)/o.offsetHeight)}),u.add(document,["touchmove","mousemove"],function(e){if(a){var t=(0,k.default)(o).offset();e.touches?i(1-(e.touches[0].pageY-t.top)/o.offsetHeight):i(1-(e.pageY-t.top)/o.offsetHeight)}}),u.add(document,["touchend","touchcancel","mouseup"],function(){a=!1});var t=(0,k.default)(l).find(".deo-player-mute").get(0);u.add(t,["click","tap"],function(e){0<s?(h.storage.set("prevVolume",s),i(0)):i(h.storage.get("prevVolume",1))}),u.add(h.bus.internal,P.options.internalEvents.VOLUME_UPDATED,function(e){r(e.volume),n(e.volume),s=e.volume})}(),g=(0,k.default)(l).find(".deo-player-play").get(0),u.add(g,["click","tap"],function(e){h.bus.external.dispatchEvent({type:P.options.externalEvents.PLAY_PAUSE_PRESS,sourceEvent:e})}),u.add(h.bus.internal,P.options.internalEvents.PLAYING,function(){(0,k.default)(g).find(".deo-player-button-icon").attr("src",N.DEFINES.DEO_BASE_PATH+"assets/deo/pause.svg"),a()}),u.add(h.bus.internal,P.options.internalEvents.PAUSE,function(){(0,k.default)(g).find(".deo-player-button-icon").attr("src",N.DEFINES.DEO_BASE_PATH+"assets/deo/play.svg"),o()}),v=(0,k.default)(l).find(".deo-player-fullscreen").get(0),y=l,u.add(v,["click","tap"],function(){if(D.VendorTools.loadFirstExtension(["isFullscreen","isFullScreen","fullscreen","fullScreen"],document).value){var e=D.VendorTools.loadFirstExtension(["cancelFullscreen","cancelFullScreen"],document).value;e&&e.call(document)}else{var t=D.VendorTools.loadFirstExtension(["requestFullscreen","requestFullScreen"],y).value;t&&t.call(y)}}),u.vendors(document,"fullscreenchange",function(e){!function(e){(0,k.default)(l).find(".deo-player-fullscreen img").attr("src",e?N.DEFINES.DEO_BASE_PATH+"assets/deo/fullscreen-off.svg":N.DEFINES.DEO_BASE_PATH+"assets/deo/fullscreen.svg")}(D.VendorTools.loadFirstExtension(["isFullscreen","isFullScreen","fullscreen","fullScreen"],document).value)});var M=function(){function o(){(0,k.default)(l).find(".deo-player-options").removeClass("deo-player-options--visible")}E.onChange.add(function(e){!0===e&&o()}),(0,k.default)(l).find(".deo-player-opts-button").on("click",function(){(0,k.default)(l).find(".deo-player-options").toggleClass("deo-player-options--visible")}),u.add(h.bus.internal,P.options.internalEvents.QUALITE_GRADES_UPDATED,function(e){var t="";if(!e||!Array.isArray(e.quality))throw new Error("Wrong QUALITE_GRADES_UPDATED event data passed");for(var r=e.quality.length-1;0<=r;r--){var n=e.quality[r];t+='<input type="button" value="'.concat(n,'"/>')}var i=(0,k.default)(l).find(".deo-player-quality .deo-player-options-selector-2-col");i.html(t),i.find("input").on("click",function(e){var t=(0,k.default)(e.currentTarget).attr("value");h.bus.external.dispatchEvent({type:P.options.externalEvents.SET_CURRENT_QUALITY,quality:t}),o()})}),u.add(h.bus.internal,P.options.internalEvents.CURRENT_QUALITY_UPDATED,function(e){var t=e.quality;(0,k.default)(l).find(".deo-player-quality input").removeClass("selected"),(0,k.default)(l).find(".deo-player-quality input[value=".concat(t,"]")).addClass("selected")});var e=h.getValue("dom-element");return u.add(e,["click","tap"],function(e){o()},!1),{hideOptions:o,isOptionsBarVisible:function(){return(0,k.default)(l).find(".deo-player-options").hasClass("deo-player-options--visible")}}}(),R=M.hideOptions,O=M.isOptionsBarVisible;(0,k.default)(l).find(".deo-player-options-selector-y, .deo-player-options-selector-x").each(function(e,o){var n=(0,k.default)(o).attr("sends"),t=(0,k.default)(o).attr("listens");if(n&&t){var a=(0,k.default)(o).find("input").toArray().map(function(e){return(0,k.default)(e).attr("disables")}).filter(function(e){return"string"==typeof e&&0<e.length}).map(function(e){return e.split(",")}).reduce(function(e,t){return e.concat(t)},[]).map(function(e){return e.trim()});u.add(h.bus.internal,t,function(e){var t=e.state;a.forEach(function(e){return(0,k.default)(l).find(e).removeClass("deo-player-options-block--disabled")});var r=(0,k.default)(o).find("input").removeClass("selected");if("string"==typeof t){t=t.toLowerCase();var n=r.filter(function(){var e=(0,k.default)(this).attr("custom-value")||this.value;return(e=e.toLowerCase())===t})[0];if(n){(0,k.default)(n).addClass("selected");var i=(0,k.default)(n).attr("disables");"string"==typeof i&&0<i.length&&i.split(",").filter(function(e){return"string"==typeof e&&0<e.length}).map(function(e){return e.trim()}).forEach(function(e){return(0,k.default)(l).find(e).addClass("deo-player-options-block--disabled")})}}}),(0,k.default)(o).find("input").on("click",function(e){var t=(0,k.default)(e.currentTarget).attr("value").toLowerCase(),r=(0,k.default)(e.currentTarget).attr("custom-value")||t;"true"===(r=r.toLowerCase())&&(r=!0),"false"===r&&(r=!1),h.bus.external.dispatchEvent({type:n,state:r})})}});D.VendorTools.getDeviceOrientationSupported().then(function(e){e?(0,k.default)(l).find(".deo-player-options-camera").removeClass("deo-player-options-block--hidden"):(0,k.default)(l).find(".deo-player-options-camera").addClass("deo-player-options-block--hidden")}),u.add(h.bus.internal,P.options.internalEvents.VIDEO_ENDED,function(e){b();var t=(0,k.default)(l).find(".deo-player-play").get(0);(0,k.default)(t).find(".deo-player-button-icon").attr("src",N.DEFINES.DEO_BASE_PATH+"assets/deo/replay.svg")}),function(){var e=(0,k.default)(l).find(".deo-player-seekbar")[0],c=(0,k.default)(l).find(".deo-player-seekbar-progress")[0],d=(0,k.default)(l).find(".deo-player-preview")[0];if(I.mobile())(0,k.default)(d).css("display","none");else{(0,k.default)(d).removeClass("deo-player-preview--visible");var f=null;u.add(h.bus.internal,P.options.internalEvents.PREVIEW_TEXTURE_PACK_UPDATED,function(e){var t=e.pack;(f=t)&&(0,k.default)(d).addClass("deo-player-preview--visible")}),u.add(e,"mousemove",function(e){if(f){var t=(0,k.default)(d).outerWidth(),r=(0,k.default)(c).offset(),n=e.pageX-r.left,i=n/(0,k.default)(c).outerWidth();(0,k.default)(d).css("transform","translateX(".concat(n-t/2,"px)"));var o=f.getParams(i);if(o){(0,k.default)(d).removeClass("deo-player-preview--loading"),(0,k.default)(d).css("background","url(".concat(o.image.src,")"));var a=o.frameW/o.frameH||16/9,s=(0,k.default)(d).width()/a;(0,k.default)(d).css("height",s);C.MathTools.lerp(.5,o.u0,o.u1),C.MathTools.lerp(.5,o.v0,o.v1),Math.round(100*o.u0),Math.round(100*o.v0);var u=t/o.frameW,l=o.image.naturalWidth*u/t;(0,k.default)(d).css("background-size",100*l+"%"),(0,k.default)(d).css("background-position","".concat(-o.x0*l,"px ").concat(-o.y0*l,"px"))}else(0,k.default)(d).addClass("deo-player-preview--loading")}}),(0,k.default)(e).on("mouseover mouseout",function(e){})}}()}},{"../../core/assets/preview-texture-pack":640,"../../core/utils/listeners-manager":691,"../../core/utils/math-tools":692,"../../core/utils/value":697,"../../core/utils/vendor-tools":698,"../../defines":710,"../../options":717,is_js:580,jquery:582,signals:612}],631:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AppMessages=void 0;var n=e("../misc/prefix-properties"),i={STATE_CHANGE:"state-change",GAZE_INPUT:"gaze-input",GAMEPAD_ACTION:"gamepad-action",CANVAS_SIZE_CHANGE:"canvas-size-change",PRESENTING_STATE_CHANGE:"presenting-state-change",PRESENTING_START:"presenting-start",PRESENTING_EXIT:"presenting-exit"};r.AppMessages=i,(0,n.prefixProperties)("app:",i)},{"../misc/prefix-properties":716}],632:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.App=void 0;var n=e("./state/state-manager"),i=e("./input/input-manager"),o=S(e("webvr-polyfill")),a=S(e("@tweenjs/tween.js")),s=e("./utils/data-storage"),u=e("./utils/clock"),l=e("./utils/task-runner"),c=e("./utils/event-bus"),d=e("./utils/messenger"),f=e("./scene-tree-manager"),h=e("./render-manager"),p=e("./layout-manager"),m=e("./gamepad/gamepad-manager"),g=e("./gamepad/gamepad-layout-manager"),v=e("./input/gaze-input-manager"),y=e("./input/raycast-manager"),_=e("./input/ray-source-manager"),b=e("./loop-manager"),E=e("./input/input-filter"),w=e("../misc/global-parameters"),A=(e("../options"),S(e("./vr/vr-manager"))),T=S(e("./gamepad/xr-input-source-manager"));function S(e){return e&&e.__esModule?e:{default:e}}function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t,r){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var D=null,I=null,L=function(){function r(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=function(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?R(e):t}(this,P(r).call(this))).globalParameters=e;return t.polyfilled=!1,null!==I?t.polyfilled=I:"xr"in navigator||"getVRDisplays"in navigator||(t.polyfilled=I=!0),null===D&&(D=new o.default({PROVIDE_MOBILE_VRDISPLAY:!1,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,BUFFER_SCALE:.5})),t.storage=new s.DataStorage("slr_webvr_player_data").load(),t.bus=new c.EventBus,t.registerValue("app",R(t)),t.registerValue("bus",t.bus),t.registerValue("is-presenting-to-device",t.isPresentingToDevice.bind(R(t))),t.registerValue("global-params",(0,w.getGlobalParamFrom)(e)),t.registerService("vr-manager",A.default),t.registerService("state-manager",n.StateManager),t.registerService("input-manager",i.InputManager),t.registerService("input-filter",E.InputFilter),t.registerService("gamepad-manager",m.GamepadManager),t.registerService("gamepad-layout-manager",g.GamepadLayoutManager),t.registerService("render-manager",h.RenderManager),t.registerService("layout-manager",p.LayoutManager),t.registerService("scene-tree-manager",f.SceneTreeManager),t.registerService("gaze-input-manager",v.GazeInputManager),t.registerService("raycast-manager",y.RaycastManager),t.registerService("ray-source-manager",_.RaySourceManager),t.registerService("loop-manager",b.LoopManager),t.registerService("xr-input-source-manager",T.default),t.getService("render-manager"),t.getService("loop-manager").onRAF.add(t.update.bind(R(t))),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(r,d.Messenger),function(e,t,r){t&&M(e.prototype,t),r&&M(e,r)}(r,[{key:"isPresentingToDevice",value:function(){return this.getService("vr-manager").enabled}},{key:"start",value:function(){this.getService("layout-manager").update(),this.getService("loop-manager").setRAFSource(window).start()}},{key:"stop",value:function(){this.getService("loop-manager").stop()}},{key:"dispose",value:function(){this.stop(),O(P(r.prototype),"dispose",this).call(this),this.bus.dispose(),this.storage.dispose(),this.globalParameters.ads&&this.globalParameters.ads.dispose(),this.bus=this.storage=null}},{key:"update",value:function(){u.Time.update(),l.TaskRunner.update(),a.default.update(),this.getService("input-manager").update(),this.getService("state-manager").update(),this.getService("scene-tree-manager").update(),this.getService("render-manager").render()}},{key:"toggleVRMode",value:function(){return this.getService("vr-manager").toggleVRMode()}}]),r}();r.App=L},{"../misc/global-parameters":714,"../options":717,"./gamepad/gamepad-layout-manager":652,"./gamepad/gamepad-manager":654,"./gamepad/xr-input-source-manager":661,"./input/gaze-input-manager":662,"./input/input-filter":664,"./input/input-manager":665,"./input/ray-source-manager":666,"./input/raycast-manager":667,"./layout-manager":668,"./loop-manager":670,"./render-manager":672,"./scene-tree-manager":673,"./state/state-manager":675,"./utils/clock":687,"./utils/data-storage":689,"./utils/event-bus":690,"./utils/messenger":693,"./utils/task-runner":696,"./vr/vr-manager":707,"@tweenjs/tween.js":1,"webvr-polyfill":619}],633:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=e("three");function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.ads=e,this.bannerCycle=a("banner",e),this._textures={},this._images={},this._promises={}}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(t,[{key:"loadTexture",value:function(n){var i=this;return this._textures[n]?Promise.resolve(this._textures[n]):this._promises[n]?this._promises[n]:this._promises[n]=new Promise(function(e,t){var r=i._images[n]=document.createElement("img");r.src=n,r.onload=function(){return e(r)},r.onerror=function(){return t("Error")}}).then(function(e){var t=new o.Texture(e);return t.magFilter=t.minFilter=o.LinearFilter,t.generateMipmaps=!1,t.needsUpdate=!0,i._promises[n]=void 0,t})}},{key:"dispose",value:function(){for(var e in this._images=null,this.textures)this._textures[e]&&this._textures[e].dispose();this._textures=null,this.bannerCycle=null}}]),t}();r.default=i;var a=function(t,e){var r=e.filter(function(e){return e.type.toLowerCase()==t.toLowerCase()}),n=0;return{next:function(){return 0===r.length?null:(n>=r.length&&(n=0),r[n++])},exists:function(){return 0<r.length},count:function(){return r.length}}}},{three:615}],634:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TextureDef=r.AssetPack=void 0;var q=e("three"),Y=e("./font-loader"),K=e("./atlas-loader"),X=e("./obj-loader"),l=e("./font");function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var a=function(){function r(e,t){i(this,r),this.manager=new q.LoadingManager(this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this)),this.disposed=!1,this.textures={},this.texturesToLoad=[],this.geometries={},this.geometriesToLoad=[],this.bufferGeometries={},this.bufferGeometriesToLoad=[],this.objects={},this.objectsToLoad=[],this.fonts={},this.fontsToLoad=[],this.atlases={},this.atlasesToLoad=[],this.files={},this.filesToLoad=[],this.isReady=!1,this.defaultTextureAnisotropy=1,this.onCompleteCallback=e,this.onProgressCallback=t}return o(r,[{key:"onLoad",value:function(){this.isReady=!0,null!=this.onCompleteCallback&&this.onCompleteCallback()}},{key:"onProgress",value:function(e,t,r){null!=this.onProgressCallback&&this.onProgressCallback(e,t,r)}},{key:"onError",value:function(){console.log("AssetPack:Error")}},{key:"loadTexture",value:function(e,t,r){return this.texturesToLoad.push({url:e,name:t,disallowNonPOT:r}),this}},{key:"loadGeometry",value:function(e,t){return this.geometriesToLoad.push({url:e,name:t}),this}},{key:"loadBufferGeometry",value:function(e,t){return this.bufferGeometries.push({url:e,name:t}),this}},{key:"loadObject",value:function(e,t){return this.objectsToLoad.push({url:e,name:t}),this}},{key:"loadFont",value:function(e,t){return this.fontsToLoad.push({url:e,name:t}),this}},{key:"loadAtlas",value:function(e,t,r){if(2==arguments.length)this.atlasesToLoad.push({descriptorUrl:(arguments.length<=0?void 0:e)+".descriptor",imageUrl:(arguments.length<=0?void 0:e)+".png",name:arguments.length<=1?void 0:t});else{if(3!=arguments.length)throw"Wrong use of AssetPack.loadAtlas";this.atlasesToLoad.push({descriptorUrl:arguments.length<=0?void 0:e,imageUrl:arguments.length<=1?void 0:t,name:arguments.length<=2?void 0:r})}}},{key:"loadFile",value:function(e,t){return this.filesToLoad.push({url:e,name:t}),this}},{key:"start",value:function(){var r=this;if(this.disposed)throw"This assetpack is disposed";var e=new q.TextureLoader(this.manager),t=!0,n=!1,i=void 0;try{for(var o,a=function(){var t=o.value;e.load(t.url,function(e){r.textures[t.name]=new Q(e),e.anisotropy=r.defaultTextureAnisotropy,!0!==t.disallowNonPOT&&(e.wrapS=e.wrapT=q.ClampToEdgeWrapping,e.minFilter=e.magFilter=q.LinearFilter)})},s=this.texturesToLoad[Symbol.iterator]();!(t=(o=s.next()).done);t=!0)a()}catch(e){n=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}var u=!0,l=!1,c=void 0;try{for(var d,f=function(){d.value;throw new Error("Geometries does not work now")},h=this.geometriesToLoad[Symbol.iterator]();!(u=(d=h.next()).done);u=!0)f()}catch(e){l=!0,c=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw c}}var p=new q.BufferGeometryLoader(this.manager),m=!0,g=!1,v=void 0;try{for(var y,_=function(){var t=y.value;p.load(t.url,function(e){r.bufferGeometries[t.name]=e})},b=this.bufferGeometriesToLoad[Symbol.iterator]();!(m=(y=b.next()).done);m=!0)_()}catch(e){g=!0,v=e}finally{try{m||null==b.return||b.return()}finally{if(g)throw v}}var E=new X.OBJLoader(this.manager),w=!0,A=!1,T=void 0;try{for(var S,x=function(){var t=S.value,e=null;switch(t.url.substring(t.url.lastIndexOf(".")).toLowerCase()){case".obj":e=E;break;default:throw new Error("JSONLoader doesn't work => ObjectLoader too => this doesnt work")}e.load(t.url,function(e){r.objects[t.name]=e})},M=this.objectsToLoad[Symbol.iterator]();!(w=(S=M.next()).done);w=!0)x()}catch(e){A=!0,T=e}finally{try{w||null==M.return||M.return()}finally{if(A)throw T}}var R=!0,O=!1,P=void 0;try{for(var C,D=function(){var t=C.value;new Y.FontLoader(r.manager).load(t.url,function(e){r.fonts[t.name]=e})},I=this.fontsToLoad[Symbol.iterator]();!(R=(C=I.next()).done);R=!0)D()}catch(e){O=!0,P=e}finally{try{R||null==I.return||I.return()}finally{if(O)throw P}}var L=!0,N=!1,k=void 0;try{for(var F,j=function(){var t=F.value;new K.AtlasLoader(r.manager).load(t.descriptorUrl,t.imageUrl,function(e){r.atlases[t.name]=e})},B=this.atlasesToLoad[Symbol.iterator]();!(L=(F=B.next()).done);L=!0)j()}catch(e){N=!0,k=e}finally{try{L||null==B.return||B.return()}finally{if(N)throw k}}var U=!0,G=!1,H=void 0;try{for(var V,z=function(){var t=V.value;new q.FileLoader(r.manager).load(t.url,function(e){r.files[t.name]=e})},W=this.filesToLoad[Symbol.iterator]();!(U=(V=W.next()).done);U=!0)z()}catch(e){G=!0,H=e}finally{try{U||null==W.return||W.return()}finally{if(G)throw H}}}},{key:"getTextureDef",value:function(e,t){if(this.disposed)throw"This assetpack is disposed";if(!1!==t)for(var r in this.atlases){var n=this.atlases[r];if(n.exists(e))return n.get(e)}if(!this.textures[e])throw"No texture with name="+e;return this.textures[e]}},{key:"getTexture",value:function(e,t,r){var n=this.getTextureDef(e,r);return!0===t?n.base:n}},{key:"getGeometry",value:function(e){if(this.disposed)throw"This assetpack is disposed";if(!this.geometries[e])throw"No geometry with name="+e;return this.geometries[e]}},{key:"getBufferGeometry",value:function(e){if(this.disposed)throw"This assetpack is disposed";if(!this.bufferGeometries[e])throw"No bufferGeometry with name="+e;return this.bufferGeometries[e]}},{key:"getObject",value:function(e){if(this.disposed)throw"This assetpack is disposed";if(!this.objects[e])throw"No object with name="+e;return this.objects[e]}},{key:"getFont",value:function(e){if(this.disposed)throw"This assetpack is disposed";if(!this.fonts[e])throw"No font with name="+e;return this.fonts[e]}},{key:"getFile",value:function(e){if(this.disposed)throw"This assetpack is disposed";if(!this.files[e])throw"No file with name="+e;return this.files[e]}},{key:"getAtlas",value:function(e){if(this.disposed)throw"This assetpack is disposed";if(!this.atlases[e])throw"No atlas with name="+e;return this.atlases[e]}},{key:"createFont",value:function(e,t,r,n){if(!n){var i=this.filesToLoad.find(function(e){return e.name===t});n=Y.FontLoader.getFontTypeByURL(i.url)}var o=this.getFile(t),a=Y.FontLoader.parseBMFontAscii(o);if(0===a.pages.length)throw"Font descriptor without pages";var s={};s[a.pages[0]]=r;var u=new l.Font(a,s,n);return this.fonts[e]=u}},{key:"dispose",value:function(){for(var e in this.disposed=!0,this.textures)this.textures[e].dispose();for(var t in this.geometries)this.geometries[t].dispose();for(var r in this.bufferGeometries)this.bufferGeometries[r].dispose();function n(e){"mesh"==e.type.toLowerString()&&(e.geometry&&e.geometry.dispose(),e.material&&(e.material.map&&e.material.map.dispose(),e.material.dispose()))}for(var i in this.objects)this.objects[i].traverse(n);for(var o in this.fonts)this.fonts[o].dispose();for(var a in this.atlases)this.atlases[a].dispose()}}]),r}();r.AssetPack=a;var Q=function(){function n(e,t,r){i(this,n),this.base=e,this.uv=t||{umin:0,vmin:0,umax:1,vmax:1},this.size=r||{width:e.image.width,height:e.image.height}}return o(n,[{key:"dispose",value:function(){this.base.dispose(),this.uv=this.size=null}}]),n}();r.TextureDef=Q},{"./atlas-loader":635,"./font":638,"./font-loader":637,"./obj-loader":639,three:615}],635:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AtlasLoader=void 0;var a=e("three"),n=e("./atlas");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function t(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!((e=e||a.DefaultLoadingManager)instanceof a.LoadingManager))throw"LoadingManager expected";this.manager=e}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"load",value:function(e,t,r,n,i){var o=this;this.atlasId="ATLAS:"+e+"|"+t,this.manager.itemStart(this.atlasId),this.descriptorUrl=e,(new a.FileLoader).load(e,function(e){o.descriptorData=e,o.descriptorLoaded=!0,o._tryFinish()},null,i),this.imageUrl=t,(new a.TextureLoader).load(t,function(e){e.minFilter=a.LinearMipMapLinearFilter,e.anisotropy=16,e.needsUpdate=!0,o.imageData=e,o.imageLoaded=!0,o._tryFinish()},null,i),this.onLoad=r,this.onProgress=n,this.onError=i}},{key:"_tryFinish",value:function(){if(!0===this.imageLoaded&&!0===this.descriptorLoaded){var e=null;try{e=JSON.parse(this.descriptorData)}catch(e){throw"Cant parse atlas descriptor: "+this.descriptorUrl}if(this.onLoad){var t=new n.Atlas(this.imageData,e);this.onLoad(t)}this.manager.itemEnd(this.atlasId)}}}]),t}();r.AtlasLoader=o},{"./atlas":636,three:615}],636:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Atlas=void 0;var s=e("./asset-pack");function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function a(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.texture=e,this.desciption=t,this.texDefs={};var r=e.image.width,n=e.image.height;if(t)for(var i in t.rects){var o=t.rects[i];this.texDefs[i]=new s.TextureDef(e,{umin:o.x/r,umax:(o.x+o.width)/r,vmin:1-(o.y+o.height)/n,vmax:1-o.y/n},{width:o.width,height:o.height})}}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(a,[{key:"exists",value:function(e){return!!this.texDefs[e]}},{key:"get",value:function(e){return this.texDefs[e]}},{key:"getUv",value:function(e){return this.texDefs[e].uv}},{key:"getSize",value:function(e){return this.texDefs[e].size}},{key:"getTexture",value:function(){return this.texture}},{key:"dispose",value:function(){this.texture.dispose(),this.texDefs=this.description=null}}]),a}();r.Atlas=i},{"./asset-pack":634}],637:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.FontLoader=void 0;var c=e("three"),d=e("./font"),f=e("./asset-pack");function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function l(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),!((e=e||c.DefaultLoadingManager)instanceof c.LoadingManager))throw"LoadingManager expected";this.manager=e,this.textures={}}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(l,[{key:"load",value:function(e,t,r,n){this.url=e,this.manager.itemStart(e),this.onLoad=t,this.onProgress=r,this.onError=n,(new c.FileLoader).load(e,this.onDescriptorLoad.bind(this),null,n)}},{key:"onDescriptorLoad",value:function(e){var r=this;this.parsed=l.parseBMFontAscii(e);var n=this.parsed.pages.length,t=!0,i=!1,o=void 0;try{for(var a,s=function(){var t=a.value,e=r.url.substring(0,r.url.lastIndexOf("/"))+"/"+t;(new c.TextureLoader).load(e,function(e){r.textures[t]=new f.TextureDef(e),0==--n&&(r.onLoad&&r.onLoad(new d.Font(r.parsed,r.textures,l.getFontTypeByURL(r.url))),r.manager.itemEnd(r.url))})},u=this.parsed.pages[Symbol.iterator]();!(t=(a=u.next()).done);t=!0)s()}catch(e){i=!0,o=e}finally{try{t||null==u.return||u.return()}finally{if(i)throw o}}}}],[{key:"getFontTypeByURL",value:function(e){var t=e;switch(0<=t.lastIndexOf("?")&&(t=t.substr(0,t.lastIndexOf("?"))),t.substr(t.lastIndexOf(".")+1)){case"fnt":return d.FontType.BITMAP;case"sdf":return d.FontType.SDF;case"msdf":throw new Error("MSDF fonts are not supported right now");default:throw new Error("Unknown font type")}}},{key:"parseBMFontAscii",value:function(e){var t=h(e),r=m(t);if(r)return r;function n(e,t){if(!(e=e.replace(/\t+/g," ").trim()))return null;var r=e.indexOf(" ");if(-1===r)throw new Error("no named row at line "+t);var n=e.substring(0,r);e=(e=(e=(e=e.substring(r+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map(function(e){return e.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var i=[],o=0;o<e.length;o++){var a=e[o];0===o?i.push({key:a[0],data:""}):o===e.length-1?i[i.length-1].data=u(a[0]):(i[i.length-1].data=u(a[0]),i.push({key:a[1],data:""}))}var s={key:n,data:{}};return i.forEach(function(e){s.data[e.key]=e.data}),s}function u(e){return e&&0!==e.length?0===e.indexOf('"')||0===e.indexOf("'")?e.substring(1,e.length-1):-1!==e.indexOf(",")?function(e){return e.split(",").map(function(e){return parseInt(e,10)})}(e):parseInt(e,10):""}if(!e)throw new Error("no data provided");var i={pages:[],chars:[],kernings:[]},o=(e=e.toString().trim()).split(/\r\n?|\n/g);if(0===o.length)throw new Error("no data in BMFont file");for(var a=0;a<o.length;a++){var s=n(o[a],a);if(s)if("page"===s.key){if("number"!=typeof s.data.id)throw new Error("malformed file at line "+a+" -- needs page id=N");if("string"!=typeof s.data.file)throw new Error("malformed file at line "+a+' -- needs page file="path"');i.pages[s.data.id]=s.data.file}else"chars"===s.key||"kernings"===s.key||("char"===s.key?i.chars.push(s.data):"kerning"===s.key?i.kernings.push(s.data):i[s.key]=s.data)}return p(t,i),i}}]),l}();r.FontLoader=i;var o=null,h=function(e){var t,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r},p=function(e,t){o.push({hash:e,output:t}),window.localStorage.setItem("webvr-font-cache",JSON.stringify(o))},m=function(t){if(null===o){var e=window.localStorage.getItem("webvr-font-cache");try{o=JSON.parse(e)||[]}catch(e){o=[]}}var r=o.find(function(e){return e.hash==t});return r?r.output:null}},{"./asset-pack":634,"./font":638,three:615}],638:[function(e,t,r){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.FontType=r.Font=void 0;var n=function(){function n(e,t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.data=e,this.pages=t,this.type=r}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(n,[{key:"dispose",value:function(){}}]),n}();r.Font=n;r.FontType={BITMAP:"bitmap",SDF:"sdf",MSDF:"msdf"}},{}],639:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OBJLoader=void 0;function n(e){this.manager=void 0!==e?e:D.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}}var D=e("three");(r.OBJLoader=n).prototype={constructor:n,load:function(e,t,r,n){var i=this,o=new D.XHRLoader(i.manager);o.setPath(this.path),o.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);this.object&&"function"==typeof this.object._finalize&&this.object._finalize();var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&0<t.length?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){return{index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:this.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1}}};return this.materials.push(n),n},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();return t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),!1!==e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize()},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(0<=r?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(0<=r?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(0<=r?r-1:r+t/2)},addVertex:function(e,t,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0]),i.push(n[e+1]),i.push(n[e+2]),i.push(n[t+0]),i.push(n[t+1]),i.push(n[t+2]),i.push(n[r+0]),i.push(n[r+1]),i.push(n[r+2])},addVertexLine:function(e){var t=this.vertices,r=this.object.geometry.vertices;r.push(t[e+0]),r.push(t[e+1]),r.push(t[e+2])},addNormal:function(e,t,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[e+0]),i.push(n[e+1]),i.push(n[e+2]),i.push(n[t+0]),i.push(n[t+1]),i.push(n[t+2]),i.push(n[r+0]),i.push(n[r+1]),i.push(n[r+2])},addUV:function(e,t,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0]),i.push(n[e+1]),i.push(n[t+0]),i.push(n[t+1]),i.push(n[r+0]),i.push(n[r+1])},addUVLine:function(e){var t=this.uvs,r=this.object.geometry.uvs;r.push(t[e+0]),r.push(t[e+1])},addFace:function(e,t,r,n,i,o,a,s,u,l,c,d){var f,h=this.vertices.length,p=this.parseVertexIndex(e,h),m=this.parseVertexIndex(t,h),g=this.parseVertexIndex(r,h);if(void 0===n?this.addVertex(p,m,g):(f=this.parseVertexIndex(n,h),this.addVertex(p,m,f),this.addVertex(m,g,f)),void 0!==i){var v=this.uvs.length;p=this.parseUVIndex(i,v),m=this.parseUVIndex(o,v),g=this.parseUVIndex(a,v),void 0===n?this.addUV(p,m,g):(f=this.parseUVIndex(s,v),this.addUV(p,m,f),this.addUV(m,g,f))}if(void 0!==u){var y=this.normals.length;p=this.parseNormalIndex(u,y),m=u===l?p:this.parseNormalIndex(l,y),g=u===c?p:this.parseNormalIndex(c,y),void 0===n?this.addNormal(p,m,g):(f=this.parseNormalIndex(d,y),this.addNormal(p,m,f),this.addNormal(m,g,f))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,o=e.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],n))}};return e.startObject("",!1),e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();-1!==e.indexOf("\r\n")&&(e=e.replace("\r\n","\n"));for(var r=e.split("\n"),n="",i="",o="",a=[],s="function"==typeof"".trimLeft,u=0,l=r.length;u<l;u++)if(n=r[u],0!==(n=s?n.trimLeft():n.trim()).length&&"#"!==(i=n.charAt(0)))if("v"===i)if(" "===(o=n.charAt(1))&&null!==(a=this.regexp.vertex_pattern.exec(n)))t.vertices.push(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));else if("n"===o&&null!==(a=this.regexp.normal_pattern.exec(n)))t.normals.push(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));else{if("t"!==o||null===(a=this.regexp.uv_pattern.exec(n)))throw new Error("Unexpected vertex/normal/uv line: '"+n+"'");t.uvs.push(parseFloat(a[1]),parseFloat(a[2]))}else if("f"===i)if(null!==(a=this.regexp.face_vertex_uv_normal.exec(n)))t.addFace(a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],a[3],a[6],a[9],a[12]);else if(null!==(a=this.regexp.face_vertex_uv.exec(n)))t.addFace(a[1],a[3],a[5],a[7],a[2],a[4],a[6],a[8]);else if(null!==(a=this.regexp.face_vertex_normal.exec(n)))t.addFace(a[1],a[3],a[5],a[7],void 0,void 0,void 0,void 0,a[2],a[4],a[6],a[8]);else{if(null===(a=this.regexp.face_vertex.exec(n)))throw new Error("Unexpected face line: '"+n+"'");t.addFace(a[1],a[2],a[3],a[4])}else if("l"===i){var c=n.substring(1).trim().split(" "),d=[],f=[];if(-1===n.indexOf("/"))d=c;else for(var h=0,p=c.length;h<p;h++){var m=c[h].split("/");""!==m[0]&&d.push(m[0]),""!==m[1]&&f.push(m[1])}t.addLineGeometry(d,f)}else if(null!==(a=this.regexp.object_pattern.exec(n))){var g=a[0].substr(1).trim();t.startObject(g)}else if(this.regexp.material_use_pattern.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(n))t.materialLibraries.push(n.substring(7).trim());else{if(null===(a=this.regexp.smoothing_pattern.exec(n))){if("\0"===n)continue;throw new Error("Unexpected line: '"+n+"'")}var v=a[1].trim().toLowerCase();t.object.smooth="1"===v||"on"===v,(O=t.object.currentMaterial())&&(O.smooth=t.object.smooth)}t.finalize();var y=new D.Group;y.materialLibraries=[].concat(t.materialLibraries);for(u=0,l=t.objects.length;u<l;u++){var _=t.objects[u],b=_.geometry,E=_.materials,w="Line"===b.type;if(0!==b.vertices.length){var A=new D.BufferGeometry;A.addAttribute("position",new D.BufferAttribute(new Float32Array(b.vertices),3)),0<b.normals.length?A.addAttribute("normal",new D.BufferAttribute(new Float32Array(b.normals),3)):A.computeVertexNormals(),0<b.uvs.length&&A.addAttribute("uv",new D.BufferAttribute(new Float32Array(b.uvs),2));for(var T,S=[],x=0,M=E.length;x<M;x++){var R=E[x],O=void 0;if(null!==this.materials&&(O=this.materials.create(R.name),w&&O&&!(O instanceof D.LineBasicMaterial))){var P=new D.LineBasicMaterial;P.copy(O),O=P}O||((O=w?new D.LineBasicMaterial:new D.MeshPhongMaterial).name=R.name),O.shading=R.smooth?D.SmoothShading:D.FlatShading,S.push(O)}if(1<S.length){for(x=0,M=E.length;x<M;x++){R=E[x];A.addGroup(R.groupStart,R.groupCount,x)}var C=new D.MultiMaterial(S);T=w?new D.Line(A,C):new D.Mesh(A,C)}else T=w?new D.Line(A,S[0]):new D.Mesh(A,S[0]);T.name=_.name,y.add(T)}}return console.timeEnd("OBJLoader"),y}}},{three:615}],640:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var f=e("../utils/math-tools"),i=e("three");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function n(e,t){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),!Array.isArray(e))throw new Error("Expected array of preview configs");return r=a(this,s(n).call(this)),e.forEach(function(e){e.frames||(e.frames=e.rows*e.columns)}),r.aspect=t,r.configs=e,r.totalFrames=e.reduce(function(e,t){return e+t.frames},0),r.sets=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,i.EventDispatcher),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(n,[{key:"getParams",value:function(e){e=f.MathTools.clamp01(e);for(var t=f.MathTools.clamp(Math.round(e*this.totalFrames),0,this.totalFrames-1),r=null,n=0,i=0,o=0;o<this.configs.length;o++){var a=this.configs[o];if(i<=t&&i+a.frames>t){r=o,n=t-i;break}i+=a.frames}var s=this.sets[r];return s&&!0===s.ready?Object.assign({image:s.image,texture:s.texture},this._getUVFromSet(s,n)):(this._loadByIndex(r),null)}},{key:"_getUVFromSet",value:function(e,t){var r=e.rows,n=e.columns,i=e.image.naturalWidth,o=e.image.naturalHeight,a=e.frameWidth||i/n,s=e.frameHeight||o/r,u=a*t%i,l=Math.floor(t/Math.floor(i/a))*s,c=u+a,d=l+s;return{x0:u,y0:l,x1:c,y1:d,xc:f.MathTools.lerp(.5,u,c),yc:f.MathTools.lerp(.5,l,d),u0:u/i,v0:l/o,u1:(u+a)/i,v1:(l+s)/o,frameW:a,frameH:s}}},{key:"_loadByIndex",value:function(e){var t=this.configs[e];if(t){var r=document.createElement("img");r.src=t.src;var n={image:r,texture:null,ready:!1,frames:t.frames,columns:t.columns,rows:t.rows,frameWidth:t.frameWidth,frameHeight:t.frameHeight};r.onload=function(){n.texture=new i.Texture(r),n.texture.minFilter=n.texture.magFilter=i.LinearFilter,n.ready=!0},this.sets[e]=n}}}]),n}();r.default=l},{"../utils/math-tools":692,three:615}],641:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AlphaButtonComponent=void 0;var i=e("./basic-button-component");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function n(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.6;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=a(this,s(n).call(this,e))).alpha=r,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,i.BasicButtonComponent),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(n,[{key:"_applyHoverEffect",value:function(){this._owner&&this._owner.setAlpha(1)}},{key:"_applyActiveEffect",value:function(){this._owner&&this._owner.setAlpha(1)}},{key:"_resetEffect",value:function(){this._owner&&this._owner.setAlpha(this.alpha)}}]),n}();r.AlphaButtonComponent=l},{"./basic-button-component":642}],642:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BasicButtonComponent=void 0;var n=e("./component");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a(this,s(r).call(this))).callback=e,t._isDown=!1,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(r,n.Component),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(r,[{key:"added",value:function(){var e=this._owner;if(!e.isUIElement)throw"Button components only usable on UIElement and its children";e.pointerSignals.in.add(this._onIn,this),e.pointerSignals.out.add(this._onOut,this),e.pointerSignals.down.add(this._onDown,this),e.pointerSignals.up.add(this._onUp,this),this._resetEffect()}},{key:"_onIn",value:function(e){this._applyHoverEffect()}},{key:"_onOut",value:function(e){this._isDown&&(this._isDown=!1),this._resetEffect()}},{key:"_onDown",value:function(e){this._isDown=!0,this._applyActiveEffect()}},{key:"_onUp",value:function(e){this._isDown&&(this._isDown=!1,null!=this.callback&&this.callback(e),this._applyHoverEffect())}},{key:"setCallback",value:function(e){return this.callback=e,this}},{key:"_applyHoverEffect",value:function(){}},{key:"_applyActiveEffect",value:function(){}},{key:"_resetEffect",value:function(){}}]),r}();r.BasicButtonComponent=l},{"./component":644}],643:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ComponentMesh=void 0;var i=e("three"),n=e("../utils/common-tools");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=a(this,s(n).call(this,e,t)))._components=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,i.Mesh),n}();r.ComponentMesh=l,n.CommonTools.defineComponentMethods(l)},{"../utils/common-tools":688,three:615}],644:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.Component=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._started=!1,this._owner=null}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"added",value:function(){}},{key:"removed",value:function(){}},{key:"start",value:function(){}},{key:"update",value:function(){}},{key:"dispose",value:function(){}}]),e}();r.Component=i},{}],645:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TestComponent=void 0;var n=e("./component");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,s(e).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(e,n.Component),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(e,[{key:"added",value:function(){}},{key:"start",value:function(){}},{key:"update",value:function(){this._owner.rotation.y+=.1}}]),e}();r.TestComponent=l},{"./component":644}],646:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TextOverUIComponent=void 0;var i=e("./component"),o=e("../ui/text-element");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=s(this,u(n).call(this))).textField=new o.TextElement(t),r.textField.setRelativeAnchor(!0,!0),r.textField.setText(e),r.textField.markAsNonInput(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,i.Component),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(n,[{key:"added",value:function(){this._owner.add(this.textField)}},{key:"setSize",value:function(e){return this.textField.setSize(e),this}},{key:"setText",value:function(e){return this.textField.setText(e),this}},{key:"setPos",value:function(e,t){return this.textField.setPos(e,t),this}},{key:"setColor",value:function(e){return this.textField.setColor(e),this}}]),n}();r.TextOverUIComponent=c},{"../ui/text-element":683,"./component":644}],647:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TintButtonComponent=void 0;var n=e("./basic-button-component");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a(this,s(r).call(this,e))).defaultColor=14540253,t.hoverColor=15658734,t.activeColor=16777215,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(r,n.BasicButtonComponent),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(r,[{key:"_applyHoverEffect",value:function(){this._owner&&this._owner.setColor(this.hoverColor)}},{key:"_applyActiveEffect",value:function(){this._owner&&this._owner.setColor(this.activeColor)}},{key:"_resetEffect",value:function(){this._owner&&this._owner.setColor(this.defaultColor)}},{key:"setColors",value:function(e,t,r){return this.defaultColor=e,this.hoverColor=t||e,this.activeColor=r||t||e,this._resetEffect(),this}}]),r}();r.TintButtonComponent=l},{"./basic-button-component":642}],648:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CameraControllerMessages=r.CameraController=void 0;var i=e("../../states/cinema/cinema-messages"),o=e("../app-messages"),a=e("./camera-drag-controls"),s=e("./camera-magic-window-controls"),u=e("../utils/vendor-tools"),l=e("../../options"),c=e("../utils/listeners-manager"),d=(function(e){{if(e&&e.__esModule)return;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}t.default=e}}(e("signals")),e("three")),n=e("../../misc/prefix-properties"),f=e("../../states/cinema/video-surface");function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=m(this,g(n).call(this))).camera=t,r.app=e,r._dirty=!0,r._isPresenting=!1,r._isCurrentProjectionFlat=!1,r._recenterAngle=0,r.listenersManager=new c.ListenersManager,r.listenersManager.subscribe(r.app,f.VideoSurfaceMessages.PROJECTION_MODE_UPDATE,function(e){var t=e.isFlat;r._isCurrentProjectionFlat=t,r._dirty=!0}),r.listenersManager.subscribe(r.app,o.AppMessages.PRESENTING_STATE_CHANGE,function(e){r._isPresenting=e.presenting,r._dirty=!0}),r.listenersManager.subscribe(r.app,i.CinemaMessages.PERFORM_RECENTER,function(e){var t=e.angle;r._recenterAngle=t||0,r._dirty=!0}),r.listenersManager.subscribe(r.app,i.CinemaMessages.REQUEST_DRAG_CAMERA_MODE,function(){r.forcedMode="drag",r._dirty=!0}),r.listenersManager.subscribe(r.app,i.CinemaMessages.REQUEST_MAGIC_WINDOW_CAMERA_MODE,function(){r.forcedMode="magic window",r._dirty=!0}),r.listenersManager.subscribe(r.app,i.CinemaMessages.REQUEST_AUTO_CAMERA_MODE,function(){r.forcedMode=null,r._dirty=!0}),r.dragControls=new a.CameraDragControls(e,t),r.magicWindow=new s.CameraMagicWindowControls(e,t),r.forcedMode=null,r.currentMode=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(n,d.EventDispatcher),function(e,t,r){t&&p(e.prototype,t),r&&p(e,r)}(n,[{key:"update",value:function(){this._dirty&&this.reconfigure(),this.dragControls.update(),this.magicWindow.update()}},{key:"reconfigure",value:function(){var t=this;if(this._isPresenting)this.dragControls.active=this.magicWindow.active=!1,this.currentMode=null;else if(this._isCurrentProjectionFlat)this.dragControls.active=this.magicWindow.active=!1,this.camera.rotation.set(0,this._recenterAngle||0,0),this.camera.position.set(0,0,0),this.currentMode=null,this.app.post(_.CAMERA_MODE_CHANGE);else if(this.dragControls.active=!0,this.magicWindow.active=!1,null!==this.forcedMode){switch(this.forcedMode){case"drag":this.magicWindow.active=!1,this.dragControls.active=!0;break;case"magic window":this.magicWindow.active=!0,this.dragControls.active=!1}this.currentMode=this.forcedMode,this.app.post(_.CAMERA_MODE_CHANGE)}else l.options.enableMagicWindowWhenSupported&&u.VendorTools.getDeviceOrientationSupported().then(function(e){t.dragControls.active=!e,t.magicWindow.active=e,t.currentMode=e?"magic window":"drag",t.app.post(_.CAMERA_MODE_CHANGE)});this._dirty=!1}},{key:"dispose",value:function(){this.dragControls.dispose(),this.magicWindow.dispose(),this.dragControls=this.magicWindow=null,this.app=this.camera=null,this.listenersManager.dispose()}}]),n}();r.CameraController=y;var _={CAMERA_MODE_CHANGE:"camera-mode-change"};r.CameraControllerMessages=_,(0,n.prefixProperties)("camera-controller:",_)},{"../../misc/prefix-properties":716,"../../options":717,"../../states/cinema/cinema-messages":719,"../../states/cinema/video-surface":748,"../app-messages":631,"../utils/listeners-manager":691,"../utils/vendor-tools":698,"./camera-drag-controls":649,"./camera-magic-window-controls":650,signals:612,three:615}],649:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CameraDragControls=void 0;var n,i=e("three"),o=e("../utils/math-tools"),a=e("../utils/clock"),s=e("../utils/listeners-manager"),u=(n=e("../vr/vr-manager-messages"))&&n.__esModule?n:{default:n};function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function t(e,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._active=!0,this.app=e,this.camera=r,this.sensitivity=.002,this.vx=0,this.vy=0,this.prevPointerEventTime=0,this.threshold=.02,this.damping=.93,this.defaultVRPosition=new i.Vector3,this.defaultNonVRPosition=new i.Vector3,this.resetPositionOnDisplayPresentChange=!0,this.listenersManager=new s.ListenersManager,this.listenersManager.subscribe(e,u.default.VR_MODE_CHANGE,function(e){var t=e.presenting;n.resetPositionOnDisplayPresentChange&&r.position.copy(t?n.defaultVRPosition:n.defaultNonVRPosition),r.rotation.set(0,0,0)}),this.connections=[e.getService("input-manager").onPointerDown.add(this.onPointerDown.bind(this)),e.getService("input-manager").onPointerMove.add(this.onPointerMove.bind(this)),e.getService("input-manager").onPointerUp.add(this.onPointerUp.bind(this))],this.dragging=!1,this.prevPointerPos=new i.Vector3,this.curPointerPos=new i.Vector3,this.clampYRotation=!0,this.limitYRotation=.95}return function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(t,[{key:"setDefaultVRPosition",value:function(e,t,r){return this.defaultVRPosition.set(e,t,r),this.camera.position.copy(this.app.isPresentingToDevice()?this.defaultVRPosition:this.defaultNonVRPosition),this}},{key:"setDefaultNonVRPosition",value:function(e,t,r){return this.defaultNonVRPosition.set(e,t,r),this.camera.position.copy(this.app.isPresentingToDevice()?this.defaultVRPosition:this.defaultNonVRPosition),this}},{key:"onPointerDown",value:function(){this._active&&(this.prevPointerPos.copy(this.app.getService("input-manager").pointerPosition),this.dragging=!0,this.prevPointerEventTime=Date.now())}},{key:"onPointerMove",value:function(e){if(this.dragging){this.curPointerPos.copy(this.app.getService("input-manager").pointerPosition);var t=this.prevPointerPos.x-this.curPointerPos.x,r=this.prevPointerPos.y-this.curPointerPos.y;this.rotateByDxy(t,r),this.prevPointerPos.copy(this.curPointerPos);var n=Date.now(),i=(n-this.prevPointerEventTime)/1e3;0<i?(this.vx=t/i,this.vy=r/i):this.vx=this.vy=0,this.prevPointerEventTime=n}}},{key:"onPointerUp",value:function(e){this.dragging&&(this.dragging=!1,20<Date.now()-this.prevPointerEventTime&&(this.vx=this.vy=0))}},{key:"rotateByDxy",value:function(e,t){if(this.camera.rotateX(-t*this.sensitivity),this.camera.rotateOnWorldAxis(new i.Vector3(0,1,0),-e*this.sensitivity),this.clampYRotation){this.camera.rotation.x=Math.abs(this.camera.rotation.z)<Math.PI/2?o.MathTools.clamp(this.camera.rotation.x,-Math.PI/2*this.limitYRotation,Math.PI/2*this.limitYRotation):0<this.camera.rotation.x?o.MathTools.clamp(this.camera.rotation.x,Math.PI/2*this.limitYRotation,Math.PI):o.MathTools.clamp(this.camera.rotation.x,-Math.PI,-Math.PI/2*this.limitYRotation);var r=new i.Vector3(0,0,-1).applyQuaternion(this.camera.quaternion).add(this.camera.position);this.camera.lookAt(r)}}},{key:"update",value:function(){if(!this.dragging&&this._active){var e=a.Time.dt;this.rotateByDxy(this.vx*e,this.vy*e),this.vx*=this.damping,this.vy*=this.damping,Math.abs(this.vx)<this.threshold&&(this.vx=0),Math.abs(this.vy)<this.threshold&&(this.vy=0)}}},{key:"dispose",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.connections[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){n.value.detach()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.active=!1,this.app=null,this.camera=null,this.listenersManager.dispose(),this.listenersManager=null}},{key:"active",set:function(e){return!1===e&&this.dragging&&(this.dragging=!1),this._active=e},get:function(){return this._active}}]),t}();r.CameraDragControls=c},{"../utils/clock":687,"../utils/listeners-manager":691,"../utils/math-tools":692,"../vr/vr-manager-messages":706,three:615}],650:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CameraMagicWindowControls=void 0;var c=e("three"),n=e("../utils/listeners-manager");e("../utils/math-tools");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.app=e,this.camera=t,this._active=!0,this._lm=new n.ListenersManager,this._lm.add(window,"orientationchange",this._onOrientationChangeEvent.bind(this)),this._lm.add(window,"deviceorientation",this._onDeviceOrientationEvent.bind(this)),this._deviceOrienation=null,this._screenOrientation=window.orientation||0,this._quat0=new c.Quaternion,this._quat1=new c.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._euler=new c.Euler,this._zee=new c.Vector3(0,0,1)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(r,[{key:"update",value:function(){if(this._active&&this._deviceOrienation){var e=this._deviceOrienation,t=e.alpha?c.Math.degToRad(e.alpha):0,r=e.beta?c.Math.degToRad(e.beta):0,n=e.alpha?c.Math.degToRad(e.gamma):0,i=this._screenOrientation?c.Math.degToRad(this._screenOrientation):0,o=this.camera.quaternion,a=this._euler,s=this._quat0,u=this._quat1,l=this._zee;a.set(r,t,-n,"YXZ"),o.setFromEuler(a),o.multiply(u),o.multiply(s.setFromAxisAngle(l,-i))}}},{key:"dispose",value:function(){this._lm.dispose(),this.active=!1,this.camera=null,this.app=null}},{key:"_onOrientationChangeEvent",value:function(e){this._screenOrientation=window.orientation||0}},{key:"_onDeviceOrientationEvent",value:function(e){this._deviceOrienation=e}},{key:"active",set:function(e){return this._active=e},get:function(){return this._active}}]),r}();r.CameraMagicWindowControls=o},{"../utils/listeners-manager":691,"../utils/math-tools":692,three:615}],651:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DaydreamLayout=void 0;var n=e("./gamepad-layout"),i=e("./gamepad-layout-manager");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=s(this,u(r).call(this,e)))._testRegex=/daydream/gi,t._isDown=!1,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(r,n.GamepadLayout),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"update",value:function(e,t){var r=e.axes[0],n=e.axes[1];t.buttons[0].isJustPressed&&(.7<r?this._dispatchAction(i.GamepadAction.FORWARD):r<-.7?this._dispatchAction(i.GamepadAction.BACKWARD):.7<n?this._dispatchAction(i.GamepadAction.MUTE):n<-.7?this._dispatchAction(i.GamepadAction.PLAY_PAUSE):(this._isDown=!0,this._dispatchAction(i.GamepadAction.PRIMARY_DOWN))),t.buttons[0].isJustReleased&&this._isDown&&this._dispatchAction(i.GamepadAction.PRIMARY_UP)}}]),r}();r.DaydreamLayout=c},{"./gamepad-layout":653,"./gamepad-layout-manager":652}],652:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GamepadAction=r.GamepadLayoutManager=void 0;var n=e("three"),i=e("./x-input-layout"),o=e("./generic-layout"),a=e("./gearvr-layout"),s=e("./daydream-layout"),u=e("./oculus-touch-layout"),l=e("./vive-layout"),c=e("./oculus-go-layout"),d=e("../utils/listeners-manager"),f=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(){function e(){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(t=m(this,g(e).call(this)))._onAction=new f.Signal,t._genericLayout=new o.GenericLayout(t._onAction),t._layouts=[new i.XInputLayout(t._onAction),new a.GearVRLayout(t._onAction),new s.DaydreamLayout(t._onAction),new u.OculusTouchLayout(t._onAction),new l.ViveLayout(t._onAction),new c.OculusGoLayout(t._onAction)],t._lastGamepadIndex=null,t._currentLayout=null,t._listenersManager=new d.ListenersManager,t._listenersManager.binding(t._onAction,function(e){t.dispatchEvent({type:e})}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(e,n.EventDispatcher),function(e,t,r){t&&p(e.prototype,t),r&&p(e,r)}(e,[{key:"dispose",value:function(){this._layouts=null,this._onAction=null,this._genericLayout=null,this._currentLayout=null,this._listenersManager.dispose(),this._listenersManager=null}},{key:"update",value:function(e,t){e.index!==this._lastGamepadIndex&&(this._selectLayout(e),this._lastGamepadIndex=e.index),this._currentLayout?this._currentLayout.update(e,t):this._genericLayout.update(e,t)}},{key:"_selectLayout",value:function(e){for(var t=!(this._currentLayout=null),r=0,n=this._layouts.length;r<n;r++){var i=this._layouts[r];t&&i.test(e)?(t=!1,(this._currentLayout=i).activate()):i.deactivate()}}}]),e}();r.GamepadLayoutManager=y;r.GamepadAction={PRIMARY:"primary",PRIMARY_DOWN:"primary_down",PRIMARY_UP:"primary_up",MUTE:"mute",FORWARD:"forward",BACKWARD:"backward",PLAY_PAUSE:"play_pause"}},{"../utils/listeners-manager":691,"./daydream-layout":651,"./gearvr-layout":655,"./generic-layout":656,"./oculus-go-layout":657,"./oculus-touch-layout":658,"./vive-layout":659,"./x-input-layout":660,signals:612,three:615}],653:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.GamepadLayout=void 0;var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._onAction=e,this._active=!1,this._testRegex=/something/gi}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(t,[{key:"test",value:function(e){if(this._testRegex instanceof RegExp)return!!e.id.match(this._testRegex);var t=!0,r=!1,n=void 0;try{for(var i,o=this._testRegex[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(e.id.match(a))return!0}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return!1}},{key:"update",value:function(e,t){}},{key:"activate",value:function(){this._active=!0}},{key:"deactivate",value:function(){this._active=!1}},{key:"_dispatchAction",value:function(e,t){!this._active&&!0!==t||this._onAction.dispatch(e)}}]),t}();r.GamepadLayout=i},{}],654:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GamepadManager=void 0;var n=e("three"),i=(e("./gamepad-layout-manager"),e("../utils/vendor-tools"),e("../utils/listeners-manager")),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.messenger=e,this.layout=this.messenger.getService("gamepad-layout-manager"),this.xrManager=this.messenger.getService("xr-input-source-manager"),this._listeners=new i.ListenersManager,this._current=null,this._states=[],this._quat=new n.Quaternion,this.forceGamepadIndex=null,this.defaultRightHandPosition=new n.Vector3(.5,-1/1.3,-1/3).multiplyScalar(.5),this.defaultLeftHandPosition=this.defaultRightHandPosition.clone().setX(-this.defaultRightHandPosition.x),this.onGamepadConnected=new o.Signal,this.onGamepadDisconnected=new o.Signal,this.onCurrentGamepadChanged=new o.Signal,this.onGamepadButtonPress=new o.Signal,this.onGamepadButtonRelease=new o.Signal,this._listeners.add(window,"gamepadconnected",this._onGamepadConnected.bind(this),!1),this._listeners.add(window,"gamepaddisconnected",this._onGamepadDisconnected.bind(this),!1)}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"dispose",value:function(){this._listeners.dispose(),this._listeners=null,this.onGamepadButtonPress=null,this.onGamepadButtonRelease=null,this.onGamepadConnected=null,this.onGamepadDisconnected=null,this.onCurrentGamepadChanged=null,this.defaultLeftHandPosition=this.defaultRightHandPosition=null,this._quat=null,this._states=null,this._current=null,this.messenger=null,this.layout=null}},{key:"update",value:function(){if(navigator.getGamepads){var e=this._getGamepads(),t=this._states;if(e){for(var r=null,n=0,i=e.length;n<i;n++){var o=e[n];if(null!=o){t[o.index]||this._createState(o);for(var a=this._states[o.index],s=!1,u=0,l=o.buttons.length;u<l;u++){var c=o.buttons[u],d=a.buttons[u],f=c.pressed&&.7<c.value,h=c.touched;d.isJustPressed=!d.isPressed&&!0===f,d.isJustReleased=d.isPressed&&!1===f,d.isJustTouched=!d.isTouched&&!0===h,d.isJustUntouched=d.isTouched&&!1===h,d.isPressed=f,d.isTouched=h,d.value=c.value,s=s||d.isPressed}a.isJustPressed=!a.isPressed&&!0===s,a.isJustReleased=a.isPressed&&!1===s,a.isPressed=s,a.isJustPressed&&(this.onGamepadButtonPress.dispatch({gamepad:o}),r=o),a.isJustReleased&&this.onGamepadButtonRelease.dispatch({gamepad:o})}}null!==r?(this.forceGamepadIndex=r.index,this.current=r):this.current=this._selectBestGamepad(e),this.current&&this.layout.update(this.current,this._states[this.current.index])}}}},{key:"isLaserPointer",value:function(){return this.hasOrientation()}},{key:"hasOrientation",value:function(){return!!(this.current&&this.current.pose&&this.current.pose.hasOrientation)}},{key:"hasPosition",value:function(){return!!(this.current&&this.current.pose&&this.current.pose.hasPosition)}},{key:"isCurrentTransformed",value:function(){return!(!this.current||!this.current.pose||!this.current.pose.hasOrientation&&!this.current.pose.hasPosition)}},{key:"transformObject",value:function(e){if(this.isCurrentTransformed()){var t=this.current.pose.orientation;t&&e.quaternion.fromArray(t);var r=this.current.pose.position;r?e.position.fromArray(r):e.position.copy(this.defaultRightHandPosition),e.matrix.compose(e.position,e.quaternion,e.scale)}}},{key:"setRay",value:function(e){if(!this.isCurrentTransformed())return console.warn("Cannon set ray from current gamepad");if(this.current.pose.hasPosition){var t=this.current.pose.position;e.origin.set(t[0],t[1],t[2])}else e.origin.copy(this.defaultRightHandPosition);this.current.pose.hasOrientation?(this._quat.fromArray(this.current.pose.orientation),e.direction.set(0,0,-1).applyQuaternion(this._quat)):e.direction.set(0,0,-1)}},{key:"_selectBestGamepad",value:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];null!=i&&t.push(i)}if(null!==this.forceGamepadIndex)for(var o=0,a=t.length;o<a;o++){var s=t[o];if(s.index===this.forceGamepadIndex)return s}function u(e){if(null===e)return-10;var t=0;return e.pose&&e.pose.hasOrientation&&(t+=10,e.pose.hasPosition&&(t+=10)),t}return t.sort(function(e,t){return u(e)<u(t)}),t[0]}},{key:"_getGamepads",value:function(){var e=Array.from(navigator.getGamepads()),t=this.xrManager.getGamepads();return e.concat(t)}},{key:"_createState",value:function(e){for(var t={isPressed:!1,isJustPressed:!1,isJustReleased:!1,id:e.id,matrix:new n.Matrix4,buttons:[]},r=0;r<e.buttons.length;r++)t.buttons[r]={isTouched:!1,isJustTouched:!1,isJustUntouched:!1,isPressed:!1,isJustPressed:!1,isJustReleased:!1,value:0};t.hasOrientation=e.pose&&e.pose.hasOrientation,t.hasPosition=t.hasOrientation&&e.pose.hasPosition,this._states[e.index]=t}},{key:"_onGamepadConnected",value:function(e){var t=e.gamepad;this._createState(t),this.onGamepadConnected.dispatch(e.gamepad)}},{key:"_onGamepadDisconnected",value:function(e){var t=e.gamepad;delete this._states[t.index],this.onGamepadDisconnected.dispatch(e.gamepad)}},{key:"_notSameGamepadValue",value:function(e,t){return(e?e.index:-1)!==(t?t.index:-1)}},{key:"current",get:function(){return this._current},set:function(e){var t=this._current;return this._current=e,this._notSameGamepadValue(t,e)&&this.onCurrentGamepadChanged.dispatch(this._current),this._current}}]),t}();r.GamepadManager=s},{"../utils/listeners-manager":691,"../utils/vendor-tools":698,"./gamepad-layout-manager":652,signals:612,three:615}],655:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GearVRLayout=void 0;var n=e("./gamepad-layout"),i=e("./gamepad-layout-manager");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=s(this,u(r).call(this,e)))._testRegex=/gear vr controller/gi,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(r,n.GamepadLayout),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"update",value:function(e,t){t.buttons[1].isJustPressed&&this._dispatchAction(i.GamepadAction.PRIMARY_DOWN),t.buttons[1].isJustReleased&&this._dispatchAction(i.GamepadAction.PRIMARY_UP);var r=e.axes[0],n=e.axes[1];t.buttons[0].isJustPressed&&(.7<r?this._dispatchAction(i.GamepadAction.FORWARD):r<-.7?this._dispatchAction(i.GamepadAction.BACKWARD):.7<n?this._dispatchAction(i.GamepadAction.MUTE):n<-.7&&this._dispatchAction(i.GamepadAction.PLAY_PAUSE))}}]),r}();r.GearVRLayout=c},{"./gamepad-layout":653,"./gamepad-layout-manager":652}],656:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GenericLayout=void 0;var n=e("./gamepad-layout"),u=e("./gamepad-layout-manager");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,n.GamepadLayout),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(t,[{key:"test",value:function(e){return!1}},{key:"update",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=t.buttons[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(s.isJustPressed)return void this._dispatchAction(u.GamepadAction.PRIMARY_DOWN,!0);if(s.isJustReleased)return void this._dispatchAction(u.GamepadAction.PRIMARY_UP,!0)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}}]),t}();r.GenericLayout=c},{"./gamepad-layout":653,"./gamepad-layout-manager":652}],657:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OculusGoLayout=void 0;var n=e("./gamepad-layout"),i=e("./gamepad-layout-manager");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=s(this,u(r).call(this,e)))._testRegex=/Oculus Go Controller/gi,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(r,n.GamepadLayout),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"update",value:function(e,t){var r=e.axes[0],n=e.axes[1];t.buttons[0].isJustPressed&&(.7<r?this._dispatchAction(i.GamepadAction.FORWARD):r<-.7?this._dispatchAction(i.GamepadAction.BACKWARD):.7<n?this._dispatchAction(i.GamepadAction.MUTE):n<-.7&&this._dispatchAction(i.GamepadAction.PLAY_PAUSE)),t.buttons[1].isJustPressed&&this._dispatchAction(i.GamepadAction.PRIMARY_DOWN),t.buttons[1].isJustReleased&&this._dispatchAction(i.GamepadAction.PRIMARY_UP)}}]),r}();r.OculusGoLayout=c},{"./gamepad-layout":653,"./gamepad-layout-manager":652}],658:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OculusTouchLayout=void 0;var n=e("./gamepad-layout"),i=e("./gamepad-layout-manager");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=s(this,u(r).call(this,e)))._testRegex=/oculus touch/gi,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(r,n.GamepadLayout),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"update",value:function(e,t){e.axes[0],e.axes[1];(t.buttons[1].isJustPressed||t.buttons[2].isJustPressed)&&this._dispatchAction(i.GamepadAction.PRIMARY_DOWN),(t.buttons[1].isJustReleased||t.buttons[2].isJustReleased)&&this._dispatchAction(i.GamepadAction.PRIMARY_UP),t.buttons[5].isJustTouched&&this._dispatchAction(i.GamepadAction.MUTE),t.buttons[0].isJustPressed&&this._dispatchAction(i.GamepadAction.PLAY_PAUSE),t.buttons[3].isJustPressed&&this._dispatchAction(i.GamepadAction.FORWARD),t.buttons[4].isJustPressed&&this._dispatchAction(i.GamepadAction.BACKWARD)}}]),r}();r.OculusTouchLayout=c},{"./gamepad-layout":653,"./gamepad-layout-manager":652}],659:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ViveLayout=void 0;var n=e("./gamepad-layout"),i=e("./gamepad-layout-manager");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=s(this,u(r).call(this,e)))._testRegex=/openvr gamepad/gi,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(r,n.GamepadLayout),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"update",value:function(e,t){var r=e.axes[0],n=e.axes[1];t.buttons[0].isJustPressed&&(.7<r?this._dispatchAction(i.GamepadAction.FORWARD):r<-.7?this._dispatchAction(i.GamepadAction.BACKWARD):.7<n?this._dispatchAction(i.GamepadAction.MUTE):n<-.7?this._dispatchAction(i.GamepadAction.PLAY_PAUSE):this._dispatchAction(i.GamepadAction.PRIMARY)),t.buttons[1].isJustPressed&&this._dispatchAction(i.GamepadAction.PRIMARY_DOWN),t.buttons[1].isJustReleased&&this._dispatchAction(i.GamepadAction.PRIMARY_UP)}}]),r}();r.ViveLayout=c},{"./gamepad-layout":653,"./gamepad-layout-manager":652}],660:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.XInputLayout=void 0;var n=e("./gamepad-layout"),i=e("./gamepad-layout-manager");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=s(this,l(r).call(this,e)))._testRegex=[/xinput/gi,/SteelSeries Stratus XL/gi],t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,n.GamepadLayout),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"test",value:function(e){return u(l(r.prototype),"test",this).call(this,e)&&17===e.buttons.length}},{key:"update",value:function(e,t){(t.buttons[0].isJustPressed||t.buttons[7].isJustPressed||t.buttons[5].isJustPressed||t.buttons[6].isJustPressed||t.buttons[4].isJustPressed)&&this._dispatchAction(i.GamepadAction.PRIMARY_DOWN),(t.buttons[0].isJustReleased||t.buttons[7].isJustReleased||t.buttons[5].isJustReleased||t.buttons[6].isJustReleased||t.buttons[4].isJustReleased)&&this._dispatchAction(i.GamepadAction.PRIMARY_UP),t.buttons[2].isJustPressed&&this._dispatchAction(i.GamepadAction.MUTE),(t.buttons[1].isJustPressed||t.buttons[10].isJustPressed||t.buttons[11].isJustPressed)&&this._dispatchAction(i.GamepadAction.PLAY_PAUSE),t.buttons[14].isJustPressed&&this._dispatchAction(i.GamepadAction.BACKWARD),t.buttons[15].isJustPressed&&this._dispatchAction(i.GamepadAction.FORWARD)}}]),r}();r.XInputLayout=d},{"./gamepad-layout":653,"./gamepad-layout-manager":652}],661:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../utils/listeners-manager"),i=s(e("../vr/vr-manager-messages")),o=(e("../loop-manager"),s(e("../loop-manager-messages"))),a=e("three");function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}var d=function(){function t(e){var r=this;u(this,t),this.messenger=e,this.listeners=new n.ListenersManager,this.session=null,this.facades=null,this.referenceSpace=null,this.listeners.subscribe(e,i.default.SET_XR_SESSION,function(e){var t=e.session;t?t.requestReferenceSpace("local-floor").then(function(e){r.referenceSpace=e,t.addEventListener("selectstart",r.onSessionEvent.bind(r)),t.addEventListener("selectend",r.onSessionEvent.bind(r)),t.addEventListener("inputsourceschange",r.onInputSourceChange.bind(r)),r.session=t,r.onInputSourceChange()}):(r.facades=null,r.session=null)}),this.listeners.subscribe(e,o.default.ON_RAF,function(e){var t=e.frame;t&&r.session&&r.onFrame(t)})}return c(t,[{key:"onInputSourceChange",value:function(){this.facades=Array.from(this.session.inputSources).filter(function(e){return!!e}).map(function(e){return new h(e)})}},{key:"onFrame",value:function(t){var r=this;this.facades&&this.facades.forEach(function(e){e.onFrame(t,r.referenceSpace)})}},{key:"onSessionEvent",value:function(e){var t=e.inputSource;window.lastsrc=t;var r=this.facades.find(function(e){return e.source===t});r&&r.onEvent(e)}},{key:"getGamepads",value:function(){return this.facades||[]}}]),t}();r.default=d;var f=1e3,h=function(){function t(e){u(this,t),this.source=e,this.index="webxr-input-source-facade-"+f++,this.id="fake webxr input source",this.profiles=e.profiles,this.hand=e.handedness,this.pose={hasOrientation:!1,hasPosition:!1,position:null,orientation:null},this.buttons=[{pressed:!1,touched:!1,value:0}],this.axes=[0,0],this.matrix=new a.Matrix4,this.position=new a.Vector3,this.scale=new a.Vector3,this.orientation=new a.Euler,this.quat=new a.Quaternion}return c(t,[{key:"onEvent",value:function(e){this.buttons[0]="selectstart"===e.type?{pressed:!0,touched:!1,value:1}:{pressed:!1,touched:!1,value:0}}},{key:"onFrame",value:function(e,t){var r=e.getPose(this.source.targetRaySpace,t);r?(this.matrix.fromArray(r.transform.matrix),this.matrix.decompose(this.position,this.orientation,this.scale),this.pose.position=this.position.toArray(),this.pose.orientation=this.quat.setFromEuler(this.orientation).toArray(),this.pose.hasPosition=!0,this.pose.hasOrientation=!0):this.pose.hasPosition=this.pose.hasOrientation=!1}}]),t}()},{"../loop-manager":670,"../loop-manager-messages":669,"../utils/listeners-manager":691,"../vr/vr-manager-messages":706,three:615}],662:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GazeInputManager=void 0;var n=e("../../options"),i=e("../utils/clock"),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.prevTarget=null,this.timeout=n.options.defaultGazeInputTimeout,this.timer=0,this.progress=0,this._enabled=!1,this.onInput=new o.Signal,this.onStateChange=new o.Signal}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(e,[{key:"dispose",value:function(){this.prevTarget=null,this.onInput=null,this.onStateChange=null}},{key:"updateCurrentTarget",value:function(e){return this._enabled&&this.prevTarget===e&&null!=e?(this.timer+=i.Time.dt,this.progress=this.timer/this.timeout,this.timer>this.timeout&&(this.onInput.dispatch(),this.timer=this.progress=0,!(this.prevTarget=null))):(this.prevTarget=e,this.timer=0,this.progress=0,!1)}},{key:"enabled",set:function(e){return this._enabled=e,this.timer=this.progress=0,this.onStateChange.dispatch(e),e},get:function(){return this._enabled}}]),e}();r.GazeInputManager=s},{"../../options":717,"../utils/clock":687,signals:612}],663:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InputEventSource=void 0;var n=0,i={GAZE:1<<n++,MOUSE:1<<n++,TOUCH:1<<n++,GAMEPAD:1<<n++,LASER_GAMEPAD:1<<n++},o=(r.InputEventSource=i).GAMEPAD|i.LASER_GAMEPAD,a=i.MOUSE|i.TOUCH;i.isGamepad=function(e){return 0<(e&o)},i.isTouchOrMouse=function(e){return 0<(e&a)},i.toString=function(e){for(var t in i)if(i[t]===e)return t}},{}],664:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InputFilter=void 0;var n=e("../utils/clock"),i=e("./input-event-source"),o=e("../utils/vendor-tools");function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.messenger=e,this.actions=[],this.lastActionsByType={},this.lastActionsBySource={},this.HISTORY_LENGTH=20,this._isSamsungInternet=o.VendorTools.isSamsungInternet()}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"dispose",value:function(){this.actions=null,this.messenger=null,this.lastActionsBySource=null,this.lastActionsByType=null}},{key:"pass",value:function(e,t){if(this.filter_samsungInternetTouchBar(e,t))return!1;var r={type:e,source:t,timestamp:n.Time.now()};for(this.actions.push(r),this.cacheAction(r);this.actions.length>this.HISTORY_LENGTH;)this.actions.shift();return!0}},{key:"cacheAction",value:function(e){this.lastActionsByType[e.type]=e,this.lastActionsBySource[e.source]=e}},{key:"getLastActionByType",value:function(e){return this.lastActionsByType[e]}},{key:"getLastActionBySource",value:function(e){return this.lastActionsBySource[e]}},{key:"getPrevAction",value:function(e,t){for(var r=this.actions.length-1;0<=r;r--){var n=this.actions[r];if(!(e&&n.type!==e||t&&n.source!==t))return n}return null}},{key:"getPrevActionByPredicate",value:function(e){for(var t=this.actions.length-1;0<=t;t--){var r=this.actions[t];if(e(r))return r}return null}},{key:"filter_samsungInternetTouchBar",value:function(e,t){if(!this._isSamsungInternet)return!1;if(!0!==this._cancelAllMouseEvents)if("down"===e&&t===i.InputEventSource.LASER_GAMEPAD)this._cancelAllMouseEvents=!0;else{var r=this.getLastActionBySource(i.InputEventSource.LASER_GAMEPAD);if(r&&i.InputEventSource.isTouchOrMouse(t)&&"up"===r.type&&n.Time.now()-r.timestamp<1e3)return!0}else{if(t===i.InputEventSource.MOUSE||t===i.InputEventSource.TOUCH)return!0;t===i.InputEventSource.LASER_GAMEPAD&&"up"===e&&(this._cancelAllMouseEvents=!1)}return!1}}]),t}();r.InputFilter=s},{"../utils/clock":687,"../utils/vendor-tools":698,"./input-event-source":663}],665:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InputManager=void 0;var a=e("three"),f=e("../utils/clock"),n=e("../gamepad/gamepad-layout-manager"),h=e("./input-event-source"),i=e("../utils/listeners-manager"),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.messenger=e,this._setup(),this.meshes=[]}return function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(t,[{key:"_setup",value:function(){var t=this;this._listeners=new i.ListenersManager,this.gaze=this.messenger.getService("gaze-input-manager"),this._listeners.binding(this.gaze.onInput,function(){t._submitDown(h.InputEventSource.GAZE),t._submitUp(h.InputEventSource.GAZE)}),this._listeners.binding(this.gaze.onStateChange,function(e){!0===e&&(t.lastInputEventSource=h.InputEventSource.GAZE)});var r=!1;this.gamepad=this.messenger.getService("gamepad-manager"),this._listeners.add(this.gamepad.layout,n.GamepadAction.PRIMARY_DOWN,function(){if(!t.gaze.enabled&&!r){r=!0;var e=t.gamepad.isLaserPointer()?h.InputEventSource.LASER_GAMEPAD:h.InputEventSource.GAMEPAD;t._submitDown(e)}}),this._listeners.add(this.gamepad.layout,n.GamepadAction.PRIMARY_UP,function(){if(!t.gaze.enabled&&r){r=!1;var e=t.gamepad.isLaserPointer()?h.InputEventSource.LASER_GAMEPAD:h.InputEventSource.GAMEPAD;t._submitUp(e)}}),this.hasTarget=!1,this.currentTouchIdentifier=null,this.camera=null,this.raycaster=new a.Raycaster,this._raySourceManager=this.messenger.getService("ray-source-manager").setRaycaster(this.raycaster),this._raycastManager=this.messenger.getService("raycast-manager").setRaycaster(this.raycaster),this._stateManager=this.messenger.getService("state-manager"),this._inputFilter=this.messenger.getService("input-filter"),this.pointerDown=!1,this.pointerPosition=new a.Vector2,this.normPointerPosition=new a.Vector2,this._canvas=this.messenger.getValue("dom-element"),this._lastTouchDownTimestamp=0,this._mouseDown=!1,this._lastInputDownTimestamp=0,this._lastInputEventSource=null,this.messenger.getService("state-manager").onStateChange.add(this.reset,this),this.onPointerDown=new o.Signal,this.onPointerMove=new o.Signal,this.onPointerUp=new o.Signal,this.onBackButtonPress=new o.Signal,this.onLastInputEventSourceChange=new o.Signal;t._listeners.add(t._canvas,"mousedown",t._onMouseEvent.bind(t),!1),t._listeners.add(window,"mouseup",t._onMouseEvent.bind(t),!1),t._listeners.add(window,"mousemove",t._onMouseEvent.bind(t),!1),t._listeners.add(t._canvas,"touchstart",t._onTouchEvent.bind(t),!1),t._listeners.add(window,"touchmove",t._onTouchEvent.bind(t),!1),t._listeners.add(window,"touchend",t._onTouchEvent.bind(t),!1),t._listeners.add(window,"touchcancel",t._onTouchEvent.bind(t),!1)}},{key:"dispose",value:function(){this.onPointerDown=null,this.onPointerMove=null,this.onPointerUp=null,this.onBackButtonPress=null,this.onLastInputEventSourceChange=null,this._canvas=null,this.pointerPosition=this.normPointerPosition=null,this.raycaster=null,this._raySourceManager=null,this._raycastManager=null,this._stateManager=null,this._inputFilter=null,this.gaze=null,this.gamepad=null,this._listeners.dispose(),this._listeners=null}},{key:"_onTouchEvent",value:function(e){var t=e.target.getBoundingClientRect();if(0!==e.changedTouches.length){for(var r=null,n=0,i=e.changedTouches.length;n<i;n++){var o=e.changedTouches[n];if(null===this.currentTouchIdentifier||o.identifier===this.currentTouchIdentifier){r=o;break}}if(null!==r){var a=r.clientX,s=r.clientY,u=(a-t.left)*window.innerWidth/t.width,l=(s-t.top)*window.innerHeight/t.height,c=u/window.innerWidth*2-1,d=l/window.innerHeight*2-1;switch(d*=-1,this.pointerPosition.set(u,l),this.normPointerPosition.set(c,d),e.type){case"touchstart":this._lastTouchDownTimestamp=f.Time.now(),this._submitDown(h.InputEventSource.TOUCH),this.currentTouchIdentifier=r.identifier;break;case"touchmove":this._submitMove(h.InputEventSource.TOUCH);break;case"touchend":case"touchcancel":this._submitUp(h.InputEventSource.TOUCH),this.currentTouchIdentifier=null}return e}}}},{key:"_onMouseEvent",value:function(e){var t=this._canvas.getBoundingClientRect(),r=(e.clientX-t.left)*window.innerWidth/t.width,n=(e.clientY-t.top)*window.innerHeight/t.height,i=r/window.innerWidth*2-1,o=n/window.innerHeight*2-1;switch(o*=-1,this.pointerPosition.set(r,n),this.normPointerPosition.set(i,o),e.type){case"mousedown":200<f.Time.now()-this._lastTouchDownTimestamp&&(this._mouseDown=!0,this._submitDown(h.InputEventSource.MOUSE));break;case"mousemove":this.messenger.getValue("is-presenting-to-device")||this._submitMove(h.InputEventSource.MOUSE);break;case"mouseup":this._mouseDown&&(this._mouseDown=!1,this._submitUp(h.InputEventSource.MOUSE))}return e}},{key:"_submitDown",value:function(e){if(f.Time.now()-this._lastInputDownTimestamp<20)console.log("Prevented double input from source: "+e);else if(this._lastInputDownTimestamp=f.Time.now(),this._inputFilter.pass("down",e)){this.lastInputEventSource=e,this._raySourceManager.updateRaycaster(this.camera,this.normPointerPosition,e);for(var t=this._raycastManager.raycast(this._getCurrentLayers()),r=t.chain,n={viewX:this.pointerPosition.x,viewY:this.pointerPosition.y,target:r[0],stopped:!1,worldPoint:null!=t.result?this._raycastManager.ray.at(t.result.distance,new a.Vector3):null,source:e,ray:this._raycastManager.ray},i=0,o=r.length;i<o&&(r[i].pointerSignals.down.dispatch(n),!n.stopped);i++);return this.onPointerDown.dispatch(n),n}}},{key:"_submitMove",value:function(e){this._raySourceManager.updateRaycaster(this.camera,this.normPointerPosition,e);var t=this._raycastManager.raycast(this._getCurrentLayers()),r=t.chain,n={viewX:this.pointerPosition.x,viewY:this.pointerPosition.y,target:r[0],stopped:!1,worldPoint:null!=t.result?this._raycastManager.ray.at(t.result.distance,new a.Vector3):null,source:e,ray:this._raycastManager.ray};this.hasTarget=0<r.length&&r.some(function(e){return!e.isInputBlocker}),this.hasTarget?this._canvas.classList.add("pointing"):this._canvas.classList.remove("pointing");for(var i=0,o=r.length;i<o&&(r[i].pointerSignals.move.dispatch(n),!n.stopped);i++);return this.onPointerMove.dispatch(n),n}},{key:"_submitUp",value:function(e){if(this._inputFilter.pass("up",e)){this.lastInputEventSource=e,this._raySourceManager.updateRaycaster(this.camera,this.normPointerPosition,e);for(var t=this._raycastManager.raycast(this._getCurrentLayers()),r=t.chain,n={viewX:this.pointerPosition.x,viewY:this.pointerPosition.y,target:r[0],stopped:!1,worldPoint:null!=t.result?this._raycastManager.ray.at(t.result.distance,new a.Vector3):null,source:e,ray:this._raycastManager.ray},i=0,o=r.length;i<o&&(r[i].pointerSignals.up.dispatch(n),!n.stopped);i++);this.onPointerUp.dispatch(n)}}},{key:"_getCurrentLayers",value:function(){return this._stateManager.current?this._stateManager.current.layers:null}},{key:"update",value:function(){if(this.messenger.getValue("is-presenting-to-device")){var e=this.lastInputEventSource,t=this._submitMove(e);this.gaze.updateCurrentTarget(t.target),this.gamepad.update()}else this.gamepad.update()}},{key:"setCamera",value:function(e){this.camera=e}},{key:"getCamera",value:function(){return this.camera}},{key:"reset",value:function(){this.camera=null}},{key:"lastInputEventSource",set:function(e){return e!==this._lastInputEventSource&&(this._lastInputEventSource=e,this.onLastInputEventSourceChange.dispatch(e)),this._lastInputEventSource},get:function(){return this._lastInputEventSource}}]),t}();r.InputManager=u},{"../gamepad/gamepad-layout-manager":652,"../utils/clock":687,"../utils/listeners-manager":691,"./input-event-source":663,signals:612,three:615}],666:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RaySource=r.RaySourceManager=void 0;var n=e("three"),i=e("./input-event-source"),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.messenger=e,this._gamepad=e.getService("gamepad-manager"),this._renderer=e.getService("render-manager")._renderer,this._gaze=e.getService("gaze-input-manager"),this._dummyVec=new n.Vector3,this._lastRaySource=null,this.lastRaySourceChange=new o.Signal}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"dispose",value:function(){this._gamepad=null,this._renderer=null,this._gaze=null,this.messenger=null,this._lastRaySourceChange=null}},{key:"setRaycaster",value:function(e){return this.raycaster=e,this}},{key:"updateRaycaster",value:function(e,t,r){var n=null,i=this.messenger.getValue("is-presenting-to-device");if(null!==(n=r?this.getRaySourceByInputSource(r,i):this.guessRaySource(e))){if(!this.raycaster)throw new Error("No raycaster is set. Use setRaycaster before use.");var o=this.raycaster;o.ray;switch(o.far=1e5,o.near=0,n){case u.LASER_GAMEPAD:this.setFromLaserGamepad();break;case u.GAZE:e&&this.setFromGaze(e);break;case u.POINTER:e&&this.setFromCamera(t,e)}this.lastRaySource=n}}},{key:"guessRaySource",value:function(e){return this.messenger.getValue("is-presenting-to-device")?this._gamepad.isLaserPointer()&&!this._gaze.enabled?u.LASER_GAMEPAD:e?u.GAZE:null:e?u.POINTER:null}},{key:"getRaySourceByInputSource",value:function(e,t){switch(e){case i.InputEventSource.LASER_GAMEPAD:return u.LASER_GAMEPAD;case i.InputEventSource.MOUSE:case i.InputEventSource.TOUCH:return t?u.GAZE:u.POINTER;case i.InputEventSource.GAZE:case i.InputEventSource.GAMEPAD:return u.GAZE;default:return null}}},{key:"setFromCamera",value:function(e,t){this.raycaster.setFromCamera(e,t)}},{key:"setFromGaze",value:function(e){var t=this.raycaster.ray,r=this._renderer.vr.getCamera(e),n=this._dummyVec.set(0,0,-1);n.applyQuaternion(r.quaternion),n.normalize(),t.origin.copy(r.position),t.direction.copy(n)}},{key:"setFromLaserGamepad",value:function(){this._gamepad.setRay(this.raycaster.ray)}},{key:"lastRaySource",set:function(e){return this._lastRaySource!==e&&(this._lastRaySource=e,this.lastRaySourceChange.dispatch(e)),this._lastRaySource},get:function(){return this._lastRaySource}}]),t}();r.RaySourceManager=s;var u={GAZE:"gaze",LASER_GAMEPAD:"laser_gamepad",POINTER:"pointer"};r.RaySource=u},{"./input-event-source":663,signals:612,three:615}],667:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RaycastManager=void 0;e("three");function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.threshold=.1,this.messenger=e,this.raycaster=null}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(t,[{key:"dispose",value:function(){this.raycaster=null,this.messenger=null}},{key:"setRaycaster",value:function(e){return this.raycaster=e,this}},{key:"raycastFilter",value:function(e){for(var t=e.object;;){if(!t.visible)return!1;if(!1===t.inputEnabled)return!1;if(!t.parent)return"Scene"===t.type&&!!t.userData&&!!t.userData.layer&&!!t.userData.layer.enabled;t=t.parent}}},{key:"raycastSelectResult",value:function(e){for(var t=null,r=1e11,n=0,i=e.length;n<i;n++){var o=e[n],a=Math.abs(o.distance-r);(null===t||a<=this.threshold&&o.object.inputPriority>t.object.inputPriority||a>this.threshold&&o.distance<r)&&(r=o.distance,t=o)}return t}},{key:"raycast",value:function(e){if(!this.raycaster)throw new Error("No raycaster set. Use setRaycaster(raycaster) before using");return window.numOfRaycasts=0,window.numOfRealRaycasts=0,this.raycastLayerByLayer(e)}},{key:"raycastLayerByLayer",value:function(e){for(var t=e.length-1;0<=t;t--){var r=e[t];if(r.enabled){var n=r.inputMeshes,i=this.raycastMeshes(n);if(null!==i)return i}}return{chain:[],result:null}}},{key:"raycastMeshes",value:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];window.numOfRaycasts++,!0===i.visible&&(window.numOfRealRaycasts++,this.raycaster.intersectObject(i,!1,t))}if(0==(t=t.filter(this.raycastFilter)).length)return null;for(var o=this.raycastSelectResult(t),a=[],s=o.object;!0===s.isUIElement&&a.push(s),null!=(s=s.parent););return{chain:a,result:o}}},{key:"ray",get:function(){return this.raycaster.ray}}]),t}();r.RaycastManager=i},{three:615}],668:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LayoutManager=void 0;e("./utils/vendor-tools");var n=e("./utils/listeners-manager"),i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),o=e("./app-messages");function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function r(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this._listeners=new n.ListenersManager,this.messenger=e,this.onUpdateLayout=new i.Signal,this._renderer=this.messenger.getService("render-manager")._renderer,this._listeners.add(window,"resize",function(){setTimeout(function(){t.update()},300)}),this._listeners.add(window,"orientationchange",function(){setTimeout(function(){t.update()},300)}),this._listeners.vendors(document,"fullscreenchange",function(e){setTimeout(function(){t.update()},300)})}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"dispose",value:function(){this._listeners.dispose(),this._listeners=null,this.messenger=null,this.onUpdateLayout=null,this._renderer=null}},{key:"update",value:function(){var e=this._renderer;if(!this.messenger.getValue("is-presenting-to-device")){var t=this.messenger.getValue("dom-element").parentElement;if(!t)return;var r=t==window?window.innerWidth:t.clientWidth,n=t==window?window.innerHeight:t.clientHeight;e.setSize(r,n,!0),e.setPixelRatio(window.devicePixelRatio||1),this.onUpdateLayout.dispatch({width:r,height:n}),this.messenger.post(o.AppMessages.CANVAS_SIZE_CHANGE)}}}]),r}();r.LayoutManager=s},{"./app-messages":631,"./utils/listeners-manager":691,"./utils/vendor-tools":698,signals:612}],669:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n={ON_RAF:"on-raf"},i=n=(0,e("../misc/prefix-properties").prefixProperties)("loop-manager:",n);r.default=i},{"../misc/prefix-properties":716}],670:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LoopManager=void 0;var n,a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),s=e("./utils/clock"),u=e("./utils/listeners-manager"),i=e("./utils/math-tools"),l=(n=e("./loop-manager-messages"))&&n.__esModule?n:{default:n};function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.messenger=i,this.running=!1,this._lastRAF=0,this._bindedLoop=this.loop.bind(this),this.rafSource=null,this.onRAF=new a.Signal,this.onStep=new a.Signal,this.fps=0,this._lastTimeStamp=0,this._lastAccumulatorTimestamp=s.Time.now(),this._accumulator=0,this._limit=0,this._frame=0,this.listeners=new u.ListenersManager,this.listeners.binding(this.onRAF,function(e,t){if(o._frame++,window.performance){var r=window.performance.now(),n=r-o._lastTimeStamp;0<n&&(o.fps=1e3/n),o._lastTimeStamp=r}i.post(l.default.ON_RAF,{timestamp:e,frame:t})})}return function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(e,[{key:"dispose",value:function(){this.cancelCurrentRAF(),this.running=!1,this.messenger=null,this._bindedLoop=null,this.rafSource=null,this.onRAF=null,this.listeners.dispose(),this.listeners=null}},{key:"start",value:function(){return this.running=!0,this.requestLoop(),this}},{key:"stop",value:function(){return this.running=!1,this}},{key:"requestLoop",value:function(){this._lastRAF=this.rafSource.requestAnimationFrame(this._bindedLoop)}},{key:"loop",value:function(){var e;if(this.running){if(0<this._limit){var t=s.Time.now();this._accumulator+=(t-this._lastAccumulatorTimestamp)/1e3,this._lastAccumulatorTimestamp=t;for(var r=1;this._accumulator>=1/this._limit&&0<r;)this._accumulator-=1/this._limit,r--,this.onStep.dispatch()}else this.onStep.dispatch();(e=this.onRAF).dispatch.apply(e,arguments),this.requestLoop()}}},{key:"setRAFSource",value:function(e){return this.cancelCurrentRAF(),this.rafSource=e,this}},{key:"cancelCurrentRAF",value:function(){return this.rafSource&&0!==this._lastRAF&&(this.rafSource.cancelAnimationFrame(this._lastRAF),this._lastRAF=0),this}},{key:"setFPSLimit",value:function(e){return this._lastAccumulatorTimestamp=s.Time.now(),e=(this._accumulator=0)<e?i.MathTools.clamp(e,10,60):e,this._limit=e,this}}]),e}();r.LoopManager=c},{"./loop-manager-messages":669,"./utils/clock":687,"./utils/listeners-manager":691,"./utils/math-tools":692,signals:612}],671:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n={REQUEST_SUBMIT_FRAME:"request-submit-frame"};(0,e("../misc/prefix-properties").prefixProperties)("render-manager:",n);var i=n;r.default=i},{"../misc/prefix-properties":716}],672:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RenderManager=void 0;var a=e("three"),s=e("./utils/listeners-manager"),u=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),l=e("./utils/common-tools"),c=(e("./app-messages"),e("./utils/vendor-tools"),n(e("./vr/vr-manager-messages")));n(e("./render-manager-messages"));function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function o(e){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.messenger=e,this._state=e.getService("state-manager"),this._listeners=new s.ListenersManager;var t=document.createElement("canvas");this.messenger.registerValue("dom-element",t);var n={alpha:!1,depth:!0,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"high-performance"},i=null;this.isWebGL2=!1,(i=t.getContext("webgl",n)||t.getContext("experimental-webgl",n))?i.getExtension("GL_OES_standard_derivatives"):console.error("Browser doesn't support WebGL"),i.makeXRCompatible&&i.makeXRCompatible(),this.renderingDisabled=!1,this.bus=this.messenger.getValue("bus"),this._renderer=new a.WebGLRenderer({canvas:t,context:i}),this._renderer.setClearColor(8623021),this.setClearColor=this._renderer.setClearColor.bind(this._renderer),this._renderer.vr.minRenderWidth=l.CommonTools.selectRenderWidth(),this._renderer.vr.setReferenceSpaceType("zero-point"),this._renderer.autoClear=!1,this.onPreRender=new u.Signal,this.onPostRender=new u.Signal,this._listeners.binding(this._state.onStateChange,function(){r._renderer.renderLists.dispose(),r._renderer.renderStates.dispose()}),this._listeners.subscribe(e,c.default.VR_MODE_ENABLED,function(){r._renderer.vr.enabled=!0}),this._listeners.subscribe(e,c.default.VR_MODE_DISABLED,function(){r._renderer.vr.enabled=!1}),this._listeners.subscribe(e,c.default.SET_VR_DISPLAY,function(e){var t=e.display;r._renderer.vr.setDevice(t)}),this._listeners.subscribe(e,c.default.SET_XR_SESSION,function(e){var t=e.session;r._renderer.vr.setSession(t)})}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(o,[{key:"dispose",value:function(){this.messenger=null,this._listeners.dispose(),this._listeners=null,this.onPreRender=null,this.onPostRender=null,this._renderer=null,this.bus=null,this.canvas=null,this._state=null,this._renderer&&this._renderer.dispose()}},{key:"render",value:function(){var e=this._state;if(!0!==this.renderingDisabled){var t=this._renderer.getContext();if(this.onPreRender.dispatch(),e.current)for(var r=e.current.layers,n=0,i=r.length;n<i;n++){var o=r[n];o.enabled&&(0!==o.clearBeforeRender&&t.clear(o.clearBeforeRender),this._renderer.state.buffers.depth.overrideDepthFunc=o.overrideDepthFunc,this._renderer.state.buffers.depth.overrideDepthTest=o.overrideDepthTest,this._renderer.state.buffers.depth.overrideDepthMask=o.overrideDepthMask,this._renderer.sortObjects=o.sortObjects,o.onBeforeRender.dispatch(),this._renderer.render(o.scene,o.camera),o.onAfterRender.dispatch())}this._renderer.vr.enabled&&this._renderer.vr.submitFrame(),this.onPostRender.dispatch()}}}]),o}();r.RenderManager=o},{"./app-messages":631,"./render-manager-messages":671,"./utils/common-tools":688,"./utils/listeners-manager":691,"./utils/vendor-tools":698,"./vr/vr-manager-messages":706,signals:612,three:615}],673:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.SceneTreeManager=void 0;var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.messenger=e}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(t,[{key:"dispose",value:function(){this.messenger=null}},{key:"update",value:function(){var e=this.messenger.getService("state-manager");if(e.current)for(var t=e.current.layers,r=0,n=t.length;r<n;r++){var i=t[r];i.enabled&&this.updateObject(i.scene)}}},{key:"updateObject",value:function(e){e.onFrameEnter();for(var t=0,r=e.children.length;t<r;t++)this.updateObject(e.children[t])}}]),t}();r.SceneTreeManager=i},{}],674:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RenderLayer=void 0;var i=e("three"),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function n(e,t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),r=r||{},this.enabled=!0,this.app=e,this.scene=new i.Scene,(this.scene.userData.layer=this).camera=r.camera||new i.PerspectiveCamera(70,1,.05,3e4),this.name=t,this.clearBeforeRender="number"==typeof r.clearBeforeRender?r.clearBeforeRender:0,this.sortObjects=!0===r.sortObjects,this.overrideDepthFunc="number"==typeof r.overrideDepthFunc?r.overrideDepthFunc:null,this.overrideDepthTest="boolean"==typeof r.overrideDepthTest?r.overrideDepthTest:null,this.overrideDepthMask="boolean"==typeof r.overrideDepthMask?r.overrideDepthMask:null,this.inputMeshes=[],this.onBeforeUpdate=new o.Signal,this.onAfterUpdate=new o.Signal,this.onBeforeRender=new o.Signal,this.onAfterRender=new o.Signal,this.updateCamera(),this._binding=this.app.getService("layout-manager").onUpdateLayout.add(this.updateCamera,this)}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(n,[{key:"updateCamera",value:function(){if(this.camera){if("PerspectiveCamera"==this.camera.type){var e=this.app.getValue("dom-element");this.camera.aspect=e.width/e.height}this.camera.updateProjectionMatrix()}}},{key:"dispose",value:function(){this._binding&&this._binding.detach(),this.enabled=!1,this.inputMeshes=null,this.scene.traverse(function(e){"function"==typeof e.dispose&&e.dispose()}),this.scene=null,this.camera=null,this.onAfterRender=this.onAfterUpdate=this.onBeforeRender=this.onBeforeUpdate=null}},{key:"addInputMesh",value:function(e){if(!(e instanceof i.Mesh))throw"Mesh expected";return this.inputMeshes.push(e),this}},{key:"removeInputMesh",value:function(e){var t=this.inputMeshes.indexOf(e);return-1<t&&(this.inputMeshes.splice(t,1),!0)}}]),n}();r.RenderLayer=n},{signals:612,three:615}],675:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StateManager=void 0;var n=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.messenger=e,this.states={},this.current=null,this._currentName="",this.onStateChange=new n.Signal}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"dispose",value:function(){this.current&&this.current._dispose(),this.states=null,this.current=null,this.messenger=null,this.onStateChange=null}},{key:"add",value:function(e,t){this.states[e]=t}},{key:"show",value:function(e,t){var r=this.states[e];if(!r)throw"No state named ".concat(e);var n=new r(this.messenger.getValue("app"));null!=this.current&&(this.current.hide(),this.current._dispose()),this._currentName=e,this.onStateChange.dispatch(e),this.current=n,this.current.create(),this.current.show(t)}},{key:"getCurrentStateName",value:function(){return this._currentName}},{key:"update",value:function(){this.current&&this.current.update()}}]),t}();r.StateManager=o},{signals:612}],676:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.State=void 0;var n=e("./layer");e("../app");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.app=e,this.layers=[],this._disposed=!1}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"update",value:function(){}},{key:"createLayer",value:function(e,t){var r=new n.RenderLayer(this.app,e,t);return this.layers.push(r),r}},{key:"getLayer",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this.layers[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(a.name==e)return a}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return null}},{key:"bringLayerToFront",value:function(e){var t=null;if(null===(t=e instanceof n.RenderLayer?e:this.getLayer(e)))throw"name should be either instance of RenderLayer or a string (name of existing layer)";var r=this.layers.indexOf(t);if(r<0)throw"given layer is not in this state";this.layers.splice(r,1),this.layers.push(t)}},{key:"create",value:function(){}},{key:"show",value:function(){}},{key:"hide",value:function(){}},{key:"dispose",value:function(){}},{key:"_dispose",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.layers[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){n.value.dispose()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.dispose(),this._disposed=!0}}]),t}();r.State=o},{"../app":632,"./layer":674}],677:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ButtonElement=void 0;var i=e("./image-element");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var n=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?u(e):t}(this,s(n).call(this,e))).callback=t,r.alpha=.7,r.pointerSignals.in.add(r._onIn,u(r)),r.pointerSignals.out.add(r._onOut,u(r)),r.pointerSignals.down.add(r._onDown,u(r)),r.pointerSignals.up.add(r._onUp,u(r)),r._isDown=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,i.ImageElement),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(n,[{key:"setCallback",value:function(e){return this.callback=e,this}},{key:"_onIn",value:function(e){this.alpha=1}},{key:"_onOut",value:function(e){this.alpha=.7,this._isDown&&(this._isDown=!1)}},{key:"_onDown",value:function(e){this._isDown=!0}},{key:"_onUp",value:function(e){this._isDown&&(this._isDown=!1,null!=this.callback&&this.callback(e))}}]),n}();r.ButtonElement=n},{"./image-element":678}],678:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ImageElement=void 0;var d=e("three"),n=e("./rect-element"),f=e("../utils/math-tools"),i=e("../assets/asset-pack");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function h(e,t,r){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=s(this,p(c).call(this,100,100,16777215))).texture=null,t.setTexture(e),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(c,n.RectElement),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(c,[{key:"setTexture",value:function(e,t){e instanceof d.Texture?this.texture=new i.TextureDef(e):e instanceof i.TextureDef?this.texture=e:this.texture=null,this.material.map=this.texture?this.texture.base:null,(this.material.needsUpdate=!0)!==t&&this.texture&&(this.width=this.texture.size.width,this.height=this.texture.size.height),this._dirty=!0}},{key:"setNaturalSize",value:function(){this.setSize(this.texture.size.width,this.texture.size.height)}},{key:"updateUIGeometry",value:function(){if(h(p(c.prototype),"updateUIGeometry",this).call(this),null!==this.texture){var e=this.width,t=this.height,r=this.anchor.x,n=this.anchor.y,i=this.texture.uv;for(var o in this.geometry.faceVertexUvs[0]=new Array(this.geometry.faces.length),this.geometry.faces){var a=this.geometry.faces[o],s=this.geometry.vertices[a.a],u=this.geometry.vertices[a.b],l=this.geometry.vertices[a.c];this.geometry.faceVertexUvs[0][o]=[new d.Vector2(f.MathTools.map((s.x+r)/e,0,1,i.umin,i.umax),f.MathTools.map((s.y+n)/t,0,1,i.vmin,i.vmax),0),new d.Vector2(f.MathTools.map((u.x+r)/e,0,1,i.umin,i.umax),f.MathTools.map((u.y+n)/t,0,1,i.vmin,i.vmax),0),new d.Vector2(f.MathTools.map((l.x+r)/e,0,1,i.umin,i.umax),f.MathTools.map((l.y+n)/t,0,1,i.vmin,i.vmax),0)]}this.geometry.uvsNeedUpdate=!0}}},{key:"dispose",value:function(){h(p(c.prototype),"dispose",this).call(this),this.texture=null}}]),c}();r.ImageElement=l},{"../assets/asset-pack":634,"../utils/math-tools":692,"./rect-element":682,three:615}],679:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Mask360=void 0;var n,i=e("three"),o=(n=e("@tweenjs/tween.js"))&&n.__esModule?n:{default:n};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=u(this,l(r).call(this,new i.SphereGeometry(10).scale(-1,-1,-1),new i.MeshBasicMaterial({color:e,transparent:!0,opacity:1,depthTest:!1})))).color=e,t.tweenGroup=new o.default.Group,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,i.Mesh),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(r,[{key:"fadeIn",value:function(e){this.tweenGroup.removeAll(),this.visible=!0;var t=new o.default.Tween(this.material,this.tweenGroup).to({opacity:1},600).easing(o.default.Easing.Quintic.Out).start();return e&&t.onComplete(e),this}},{key:"fadeOut",value:function(e){var t=this;return this.tweenGroup.removeAll(),new o.default.Tween(this.material,this.tweenGroup).to({opacity:0},600).easing(o.default.Easing.Quintic.Out).start().onComplete(function(){e&&e(),t.visible=!1}),this}},{key:"onFrameEnter",value:function(){this.tweenGroup.update()}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),r}();r.Mask360=d},{"@tweenjs/tween.js":1,three:615}],680:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NineSliceElement=void 0;var _=e("three"),n=e("./image-element"),b=e("../utils/math-tools");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(){function u(e,t,r,n,i){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var a=(o=l(this,c(u).call(this,e))).width,s=o.height;return o.left=void 0===t?.3*a:t,o.right=void 0===n?.3*a:n,o.top=void 0===r?.3*s:r,o.bottom=void 0===i?.3*s:i,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(u,n.ImageElement),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(u,[{key:"updateUIGeometry",value:function(){var e=this.width,t=this.height,r=-this.anchor.x,n=-this.anchor.y,i=this.left,o=this.right,a=this.top,s=this.bottom;this.geometry.vertices=[new _.Vector3(0,0,0),new _.Vector3(i,0,0),new _.Vector3(e-o,0,0),new _.Vector3(e,0,0),new _.Vector3(0,a,0),new _.Vector3(i,a,0),new _.Vector3(e-o,a,0),new _.Vector3(e,a,0),new _.Vector3(0,t-s,0),new _.Vector3(i,t-s,0),new _.Vector3(e-o,t-s,0),new _.Vector3(e,t-s,0),new _.Vector3(0,t,0),new _.Vector3(i,t,0),new _.Vector3(e-o,t,0),new _.Vector3(e,t,0)];for(var u=0;u<this.geometry.vertices.length;u++){var l=this.geometry.vertices[u];l.x+=r,l.y+=n}for(var c=[],d=0;d<11;d++)(d+1)/4%1!=0&&(c.push(new _.Face3(d,d+1,d+4)),c.push(new _.Face3(d+4,d+1,d+5)));this.geometry.faces=c,this.texture&&(e=this.texture.size.width,t=this.texture.size.height);for(var f=[[new _.Vector2(0,0),new _.Vector2(i/e,0),new _.Vector2(0,a/t)],[new _.Vector2(0,a/t),new _.Vector2(i/e,0),new _.Vector2(i/e,a/t)],[new _.Vector2(i/e,0),new _.Vector2((e-o)/e,0),new _.Vector2(i/e,a/t)],[new _.Vector2(i/e,a/t),new _.Vector2((e-o)/e,0),new _.Vector2((e-o)/e,a/t)],[new _.Vector2((e-o)/e,0),new _.Vector2(1,0),new _.Vector2((e-o)/e,a/t)],[new _.Vector2((e-o)/e,a/t),new _.Vector2(1,0),new _.Vector2(1,a/t)],[new _.Vector2(0,a/t),new _.Vector2(i/e,a/t),new _.Vector2(0,(t-s)/t)],[new _.Vector2(0,(t-s)/t),new _.Vector2(i/e,a/t),new _.Vector2(i/e,(t-s)/t)],[new _.Vector2(i/e,a/t),new _.Vector2((e-o)/e,a/t),new _.Vector2(i/e,(t-s)/t)],[new _.Vector2(i/e,(t-s)/t),new _.Vector2((e-o)/e,a/t),new _.Vector2((e-o)/e,(t-s)/t)],[new _.Vector2((e-o)/e,a/t),new _.Vector2(1,a/t),new _.Vector2((e-o)/e,(t-s)/t)],[new _.Vector2((e-o)/e,(t-s)/t),new _.Vector2(1,a/t),new _.Vector2(1,(t-s)/t)],[new _.Vector2(0,(t-s)/t),new _.Vector2(i/e,(t-s)/t),new _.Vector2(0,1)],[new _.Vector2(0,1),new _.Vector2(i/e,(t-s)/t),new _.Vector2(i/e,1)],[new _.Vector2(i/e,(t-s)/t),new _.Vector2((e-o)/e,(t-s)/t),new _.Vector2(i/e,1)],[new _.Vector2(i/e,1),new _.Vector2((e-o)/e,(t-s)/t),new _.Vector2((e-o)/e,1)],[new _.Vector2((e-o)/e,(t-s)/t),new _.Vector2(1,(t-s)/t),new _.Vector2((e-o)/e,1)],[new _.Vector2((e-o)/e,1),new _.Vector2(1,(t-s)/t),new _.Vector2(1,1)]],h=0,p=f.length;h<p;h++)for(var m=f[h],g=0,v=m.length;g<v;g++){var y=m[g];y.x=b.MathTools.map(y.x,0,1,this.texture.uv.umin,this.texture.uv.umax),y.y=b.MathTools.map(y.y,0,1,this.texture.uv.vmin,this.texture.uv.vmax)}this.geometry.faceVertexUvs[0]=f,this.geometry.uvsNeedUpdate=!0,this.geometry.verticesNeedUpdate=!0,this.geometry.elementsNeedUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()}},{key:"setBorders",value:function(e,t,r,n){return this.left=e,this.right=t,this.top=r,this.bottom=n,this.verifyValues(),this._dirty=!0,this}},{key:"setSize",value:function(e,t){return a(c(u.prototype),"setSize",this).call(this,e,t),this.verifyValues(),this}},{key:"verifyValues",value:function(){this.width=Math.max(this.width,this.left+this.right),this.height=Math.max(this.height,this.top+this.bottom)}}]),u}();r.NineSliceElement=u},{"../utils/math-tools":692,"./image-element":678,three:615}],681:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProgressBar=void 0;var d=e("three"),n=e("./image-element"),f=e("../utils/math-tools");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=a(this,s(r).call(this,e))).setProgress(1),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(r,n.ImageElement),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(r,[{key:"setProgress",value:function(e){return this.progress=e,this._dirty=!0,this}},{key:"updateUIGeometry",value:function(){var e=this.width,t=this.height,r=-this.anchor.x,n=-this.anchor.y,i=this.progress;this.geometry.vertices=[new d.Vector3(r,n,0),new d.Vector3(i*e+r,n,0),new d.Vector3(i*e+r,t+n,0),new d.Vector3(r,t+n,0)],this.geometry.faces=[new d.Face3(0,1,3),new d.Face3(3,1,2)],this.geometry.faceVertexUvs[0]=[[new d.Vector2(0,0),new d.Vector2(i,0),new d.Vector2(0,1)],[new d.Vector2(0,1),new d.Vector2(i,0),new d.Vector2(i,1)]];for(var o=0,a=this.geometry.faceVertexUvs[0].length;o<a;o++)for(var s=this.geometry.faceVertexUvs[0][o],u=0,l=s.length;u<l;u++){var c=s[u];c.x=f.MathTools.map(c.x,0,1,this.texture.uv.umin,this.texture.uv.umax),c.y=f.MathTools.map(c.y,0,1,this.texture.uv.vmin,this.texture.uv.vmax)}this.geometry.verticesNeedUpdate=!0,this.geometry.elementsNeedUpdate=!0,this.geometry.uvsNeedUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()}}]),r}();r.ProgressBar=l},{"../utils/math-tools":692,"./image-element":678,three:615}],682:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RectElement=void 0;var E=e("three"),n=e("./ui-element");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function i(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=a(this,u(i).call(this))).color="number"!=typeof r||isNaN(r)?16711680:r,n.width=e,n.height=t,n._dirty=!0,n.cornerRadius=0,n.cornerQuality=5,n.material=new E.MeshBasicMaterial({color:n.color,transparent:!0,depthTest:!1}),n.anchor=new E.Vector2,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(i,n.UIElement),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(i,[{key:"onFrameEnter",value:function(){s(u(i.prototype),"onFrameEnter",this).call(this),this._dirty&&(this._dirty=!1,this.updateUIGeometry())}},{key:"updateUIGeometry",value:function(){var e=this.width,t=this.height,r=-this.anchor.x,n=-this.anchor.y;if(this.cornerRadius<=0)this.geometry.vertices=[new E.Vector3(r,n,0),new E.Vector3(e+r,n,0),new E.Vector3(e+r,t+n,0),new E.Vector3(r,t+n,0)],this.geometry.faces=[new E.Face3(0,1,3),new E.Face3(3,1,2)];else{var i=function(e,t){return t+4*e},o=Math.min(this.cornerRadius,this.width/2,this.height/2),a=this.cornerQuality,s=4*a;this.geometry.vertices=[];for(var u=0;u<a;u++)for(var l=0;l<2;l++)for(var c=0;c<2;c++){var d=0==c?0==l?o:e-o:0==l?e-o:o,f=0==l?o:t-o,h=.5*Math.PI*u/(this.cornerQuality-1)+Math.PI;h+=Math.PI/2*(c+2*l);var p=d+r+Math.cos(h)*o,m=f+n+Math.sin(h)*o;this.geometry.vertices.push(new E.Vector3(p,m,0))}this.geometry.faces=[];for(var g=0,v=s-1,y=1;y<a;y++){var _=4*y,b=s-4*y-1;this.geometry.faces.push(new E.Face3(g,_,v)),this.geometry.faces.push(new E.Face3(_,b,v)),this.geometry.faces.push(new E.Face3(g+1,1+_,v-1)),this.geometry.faces.push(new E.Face3(1+_,b-1,v-1)),g=_,v=b}this.geometry.faces.push(new E.Face3(i(a-1,0),1,3)),this.geometry.faces.push(new E.Face3(1,i(a-1,2),3))}this.geometry.verticesNeedUpdate=!0,this.geometry.elementsNeedUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()}},{key:"setSize",value:function(e,t){return this.width=e,this.height=t,this._dirty=!0,this}},{key:"setColor",value:function(e){return this.color=e,this.material.color.setHex(e),this.material.needsUpdate=!0,this}},{key:"setAnchor",value:function(e,t){return this.anchor.set(e,t),this._dirty=!0,this}},{key:"setAnchorRelative",value:function(e,t){return this.anchor.set(e*this.width,t*this.height),this._dirty=!0,this}},{key:"setCornerRadius",value:function(e,t){return this._dirty=!0,this.cornerRadius=e,this.cornerQuality=t||this.cornerQuality||5,this}},{key:"centerAnchor",value:function(){return this.setAnchor(this.width/2,this.height/2),this}},{key:"_setPremultipliedAlpha",value:function(e){s(u(i.prototype),"_setPremultipliedAlpha",this).call(this,e),this.material.opacity=e}},{key:"dispose",value:function(){s(u(i.prototype),"dispose",this).call(this),this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose()}}]),i}();r.RectElement=c},{"./ui-element":685,three:615}],683:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TextElement=void 0;var R=e("three"),n=e("./ui-element"),i=e("../assets/font"),O=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("layout-bmfont-text")),P=e("../utils/math-tools");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(){function r(e){var t;switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),t=s(this,l(r).call(this)),e.type){case i.FontType.BITMAP:t.material=new R.MeshBasicMaterial({transparent:!0,wireframe:!1,depthTest:!1});break;case i.FontType.SDF:t.material=f(e);break;default:throw new Error("Unknown font type given to TextElement")}return t.setFont(e),t._color=16777215,t._text="",t._align="left",t._width=null,t._mode="",t._letterSpacing=0,t._lineHeight=void 0,t._size=t.font.data.info.size,t._dirty=!0,t._relativeAnchorX=0,t._relativeAnchorY=0,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(r,n.UIElement),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(r,[{key:"_setPremultipliedAlpha",value:function(e){u(l(r.prototype),"_setPremultipliedAlpha",this).call(this,e),this.material.opacity=e}},{key:"setRelativeAnchor",value:function(e,t){return this.relativeAnchorX=e,this.relativeAnchorY=t,this}},{key:"setText",value:function(e){return this.text=e,this}},{key:"setAlign",value:function(e){return this.align=e,this}},{key:"setLineHeight",value:function(e){return this.lineHeight=e,this}},{key:"setLetterSpacing",value:function(e){return this.letterSpacing=e,this}},{key:"setMode",value:function(e){return this._dirty=!0,this._mode=e,this}},{key:"setSize",value:function(e){return this.size=e,this}},{key:"setColor",value:function(e){return this._color=e,this.material.color.setHex(e),this.material.needsUpdate=!0,this}},{key:"setWidth",value:function(e){return this._width=e,this._dirty=!0,this}},{key:"onFrameEnter",value:function(){u(l(r.prototype),"onFrameEnter",this).call(this),this._dirty&&(this.updateLayout(),this._dirty=!1)}},{key:"updateLayout",value:function(){var e={font:this.font.data,text:this._text,lineHeight:void 0!==this._lineHeight?this._lineHeight/this.scalingRatio:this.font.data.common.lineHeight,letterSpacing:this._letterSpacing?this._letterSpacing/this.scalingRatio:0,align:this._align,mode:this._mode};null!=this._width&&0!==this._width&&(e.width=this._width*this.getOriginalFontSize()/this.size),this.layout?this.layout.update(e):this.layout=O.default(e);for(var t=[],r=[],n=[],i=this.font.pages[this.font.data.pages[0]],o=i.uv,a=i.size,s=a.width,u=a.height,l=0,c=(this._lineHeight,this.font.data.common.base),d=0,f=this.layout.glyphs.length;d<f;d++){var h=this.layout.glyphs[d],p=h.data.width,m=h.data.height,g=h.data.x,v=h.data.y,y=h.position[0],_=-h.position[1]-this.layout._height-c,b=g/s,E=(u-v)/u,w=(g+p)/s,A=(u-v-m)/u;b=P.MathTools.map(b,0,1,o.umin,o.umax),w=P.MathTools.map(w,0,1,o.umin,o.umax),E=P.MathTools.map(E,0,1,o.vmin,o.vmax),A=P.MathTools.map(A,0,1,o.vmin,o.vmax);var T=h.data.xoffset,S=h.data.yoffset;t.push(new R.Vector3(y+T,_+m+S)),t.push(new R.Vector3(y+p+T,_+m+S)),t.push(new R.Vector3(y+p+T,_+S)),t.push(new R.Vector3(y+T,_+S)),n.push(new R.Face3(l+3,l+1,l+0)),n.push(new R.Face3(l+2,l+1,l+3)),r.push([new R.Vector2(b,A),new R.Vector2(w,E),new R.Vector2(b,E)]),r.push([new R.Vector2(w,A),new R.Vector2(w,E),new R.Vector2(b,A)]),l+=4}this.geometry||(this.geometry=new R.Geometry),this.geometry.vertices=t,this.geometry.faces=n,this.geometry.faceVertexUvs=[r],this.geometry.elementsNeedUpdate=!0,this.geometry.verticesNeedUpdate=!0,this.geometry.uvsNeedUpdate=!0;var x=this._size/this.font.data.info.size;this.geometry.scale(x,x,x),this.geometry.computeBoundingBox();var M=new R.Vector3;return this.geometry.boundingBox.getSize(M),this.geometry.translate(-this.layout._width*x*this._relativeAnchorX,0,0),this.geometry.translate(0,M.y*x*this.relativeAnchorY,0),this.geometry.computeBoundingBox(),this}},{key:"getOriginalFontSize",value:function(){return this.font.data.info.size}},{key:"setFont",value:function(e){if(!(e instanceof i.Font))throw"Font expected as first parameter";if(1<e.data.pages.length)throw"Multipage fonts currently unsupported";return this.material.map=e.pages[e.data.pages[0]].base,this.font=e,this}},{key:"dispose",value:function(){this.geometry&&this.geometry.dispose()}},{key:"relativeAnchorX",set:function(e){return"boolean"==typeof e&&(e=e?.5:0),this._dirty=!0,this._relativeAnchorX=e},get:function(){return this._relativeAnchorX}},{key:"relativeAnchorY",set:function(e){return"boolean"==typeof e&&(e=e?.5:0),this._dirty=!0,this._relativeAnchorY=e},get:function(){return this._relativeAnchorY}},{key:"text",set:function(e){return this._dirty=!0,this._text=e},get:function(){return this._text}},{key:"align",set:function(e){if("left"!==e&&"right"!==e&&"center"!==e)throw"Wrong align";return this._dirty=!0,this._align=e},get:function(){return this._align}},{key:"lineHeight",set:function(e){return this._dirty=!0,this._lineHeight=e},get:function(){return this._lineHeight}},{key:"letterSpacing",set:function(e){return this._dirty=!0,this._letterSpacing=e},get:function(){return this._letterSpacing}},{key:"size",set:function(e){return this._dirty=!0,this._size=e},get:function(){return this._size}},{key:"scalingRatio",get:function(){return this.size/this.getOriginalFontSize()}},{key:"realWidth",get:function(){return this.layout._width*this.scalingRatio}},{key:"realHeight",get:function(){return this.layout._height*this.scalingRatio}}]),r}();r.TextElement=d;var f=function(e){var t=h;return new R.RawShaderMaterial({transparent:!0,depthTest:!1,uniforms:{opacity:{type:"f",value:1},map:{type:"t",value:e.pages[e.data.pages[0]].base},color:{type:"c",value:new R.Color(16777215)}},vertexShader:t.vertex,fragmentShader:t.fragment})},h={vertex:"attribute vec2 uv;\n        attribute vec4 position;\n        uniform mat4 projectionMatrix;\n        uniform mat4 modelViewMatrix;\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * position;\n        }",fragment:"#ifdef GL_OES_standard_derivatives\n        #extension GL_OES_standard_derivatives : enable\n        #endif\n\n        precision highp float;\n        uniform float opacity;\n        uniform vec3 color;\n        uniform sampler2D map;\n        varying vec2 vUv;\n\n        float aastep(float value) {\n            #ifdef GL_OES_standard_derivatives\n                float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;\n            #else\n                float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));\n            #endif\n            return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);\n        }\n\n        void main() {\n            vec4 texColor = texture2D(map, vUv);\n            float alpha = aastep(texColor.a);\n            gl_FragColor = vec4(color, opacity * alpha);            \n        }"}},{"../assets/font":638,"../utils/math-tools":692,"./ui-element":685,"layout-bmfont-text":583,three:615}],684:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UIDummy=void 0;var n=e("three"),i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function e(){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(t=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?u(e):t}(this,s(e).call(this))).uiGroup=null,t.alpha=1,t._premultipliedAlpha=1,t.noInput=!1,t.isInputBlocker=!1,t.overrideRenderOrder=null,t.pointerSignals={},t.pointerSignals.down=new i.Signal,t.pointerSignals.move=new i.Signal,t.pointerSignals.up=new i.Signal,t.pointerSignals.in=new i.Signal,t.pointerSignals.out=new i.Signal,t.isUIElement=!0,t.inputEnabled=!0,t.inputPriority=0,t.pointerSignals.move.add(t._onHover,u(t)),t.hovering=!1,t.addEventListener("removed",function(e){t.uiGroup=null,t._hoverBinding&&t._hoverBinding.detach()}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(e,n.Group),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(e,[{key:"onFrameEnter",value:function(){null==this.uiGroup&&this._tryFindUIGroup();var e=this._getParentUIElement();null!=e?this._setPremultipliedAlpha(e._premultipliedAlpha*this.alpha):this._setPremultipliedAlpha(this.uiGroup.alpha*this.alpha)}},{key:"setAlpha",value:function(e){return this.alpha=e,this}},{key:"setPos",value:function(e,t,r){return this.position.set(e||0,t||0,r||0),this}},{key:"_setPremultipliedAlpha",value:function(e){this._premultipliedAlpha=e}},{key:"_onHover",value:function(e){this.hovering||(this.hovering=!0,this._hoverBinding=this.uiGroup.app.getService("input-manager").onPointerMove.add(this._onPointerMove,this),this.pointerSignals.in.dispatch(e))}},{key:"_onPointerMove",value:function(e){for(var t=e.target;null!=t;){if(t==this)return;t=t._getParentUIElement()}this._hoverBinding.detach(),this.hovering=!1,this.pointerSignals.out.dispatch(e)}},{key:"_tryFindUIGroup",value:function(){for(var e=this.parent;e;){if(e.isUIGroup)return this.uiGroup=e,void this.uiGroup.uiElementAdded(this);e=e.parent}console.error("Can't find UIGroup")}},{key:"_getParentUIElement",value:function(){for(var e=this.parent;e;){if(e.isUIElement)return e;e=e.parent}return null}},{key:"markAsNonInput",value:function(){return this.noInput=!0,this}},{key:"markAsInputBlocker",value:function(){return this.isInputBlocker=!0,this}}]),e}();r.UIDummy=c},{signals:612,three:615}],685:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UIElement=void 0;var n=e("three"),i=e("../components/component-mesh"),o=(e("../components/test-component"),function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")));function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(){function r(){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}(this,c(r).call(this,new n.Geometry))).uiGroup=null,t.alpha=1,t._premultipliedAlpha=1,t.noInput=!1,t.isInputBlocker=!1,t.overrideRenderOrder=null,t.pointerSignals={},t.pointerSignals.down=new o.Signal,t.pointerSignals.move=new o.Signal,t.pointerSignals.up=new o.Signal,t.pointerSignals.in=new o.Signal,t.pointerSignals.out=new o.Signal,t.isUIElement=!0,t.inputEnabled=!0,t.inputPriority=0,t.pointerSignals.move.add(t._onHover,u(t)),t.hovering=!1,t.addEventListener("removed",function(e){t.uiGroup=null,t._hoverBinding&&t._hoverBinding.detach()}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(r,i.ComponentMesh),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(r,[{key:"onFrameEnter",value:function(){l(c(r.prototype),"onFrameEnter",this).call(this),null==this.uiGroup&&this._tryFindUIGroup();var e=this._getParentUIElement();null!=e?this._setPremultipliedAlpha(e._premultipliedAlpha*this.alpha):this._setPremultipliedAlpha(this.uiGroup.alpha*this.alpha)}},{key:"setAlpha",value:function(e){return this.alpha=e,this}},{key:"setPos",value:function(e,t,r){return this.position.set(e||0,t||0,r||0),this}},{key:"setScale",value:function(e,t,r){return this.scale.set(e||1,t||e||1,r||t||1),this}},{key:"_setPremultipliedAlpha",value:function(e){this._premultipliedAlpha=e}},{key:"_onHover",value:function(e){this.hovering||(this.hovering=!0,this._hoverBinding=this.uiGroup.app.getService("input-manager").onPointerMove.add(this._onPointerMove,this),this.pointerSignals.in.dispatch(e))}},{key:"_onPointerMove",value:function(e){for(var t=e.target;null!=t;){if(t==this)return;t=t._getParentUIElement()}this._hoverBinding.detach(),this._hoverBinding=null,this.hovering=!1,this.pointerSignals.out.dispatch(e)}},{key:"_tryFindUIGroup",value:function(){for(var e=this.parent;e;){if(e.isUIGroup)return this.uiGroup=e,void this.uiGroup.uiElementAdded(this);e=e.parent}console.error("Can't find UIGroup")}},{key:"_getParentUIElement",value:function(){for(var e=this.parent;e;){if(e.isUIElement)return e;e=e.parent}return null}},{key:"markAsNonInput",value:function(){return this.noInput=!0,this}},{key:"markAsInputBlocker",value:function(){return this.isInputBlocker=!0,this}},{key:"dispose",value:function(){l(c(r.prototype),"dispose",this).call(this),this.pointerSignals=null,this._hoverBinding&&this._hoverBinding.detach()}},{key:"addTo",value:function(e){return e.add(this),this}}]),r}();r.UIElement=f},{"../components/component-mesh":643,"../components/test-component":645,signals:612,three:615}],686:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UIGroup=void 0;var n=e("three"),i=e("../app");e("../utils/pool");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(){function r(e){var t;if(a(this,r),t=l(this,c(r).call(this)),!(e instanceof i.App))throw"app should be instance of App";return t.app=e,t.isUIGroup=!0,t._alpha=1,t._premultipliedAlpha=1,t.layer=null,t.setRenderOrder=!1,t._batchingEnabled=!1,t.inputEnabled=!0,t.addEventListener("removed",function(e){return t.layer=null}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(r,n.Group),u(r,[{key:"onFrameEnter",value:function(){this._internalUpdate()}},{key:"_internalUpdate",value:function(){if(null===this.layer)for(var e=this.parent;e;){if("Scene"==e.type){if(!e.userData||!e.userData.layer)throw"No layer reference in this Scene. Use scenes, created internally by Layer only.";this.layer=e.userData.layer;break}e=e.parent}}},{key:"updateLevels",value:function(){this._level=0,this._iterateChildrenRecursive(this.children,this.setRenderOrder)}},{key:"_iterateChildrenRecursive",value:function(e,t){for(var r=0,n=e.length;r<n;r++){var i=e[r];i.isUIElement&&(i.inputPriority=this._level,t&&(i.renderOrder=i.overrideRenderOrder||this._level),this._level++),this._iterateChildrenRecursive(i.children,t)}}},{key:"uiElementAdded",value:function(e){if(null===this.layer)throw"No layer reference in group";!e.noInput&&e instanceof n.Mesh&&this.layer.addInputMesh(e),this.updateLevels()}},{key:"alpha",set:function(e){return this._alpha=this._premultipliedAlpha=e},get:function(){return this._alpha}}]),r}();r.UIGroup=f},{"../app":632,"../utils/pool":694,three:615}],687:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.Time=void 0;var i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dt=0,this.dtMS=0,this.clampValue=.05,this._prevTimeStamp=0}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"update",value:function(){var e=Date.now();this.dtMS=e-this._prevTimeStamp,this.dt=this.dtMS/1e3,"number"==typeof this.dt&&isNaN(this.dt)&&(this.dt=0),void 0!==this.dt&&null!==this.dt||(this.dt=0),this.dt!==1/0&&this.dt!==-1/0||(this.dt=0),this.dt<0&&(this.dt=0),this.dt>this.clampValue&&(this.dt=this.clampValue),this._prevTimeStamp=e}},{key:"now",value:function(){return Date.now()}}]),e}());r.Time=i},{}],688:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CommonTools=void 0;var o=e("three"),I=e("./math-tools"),h=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("is_js")),n=e("./vendor-tools");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,null,[{key:"selectRenderWidth",value:function(){return n.VendorTools.isGearVR()&&n.VendorTools.greaterOrEqualsToGalaxySX(8)?1480:n.VendorTools.isOculusGo()?1280:h.desktop()?1280:n.VendorTools.isOculusQuest()?1800:1280}},{key:"drawTextureDefToCanvas",value:function(e,t,r,n,i,o){r=r||0,n=n||0,i=i||t.size.width,o=o||t.size.height;var a=t.uv.umin*t.base.image.width,s=t.base.image.height-t.uv.vmax*t.base.image.height,u=t.size.width,l=t.size.height;e.getContext("2d").drawImage(t.base.image,a,s,u,l,r,n,i,o)}},{key:"drawTextElementToCanvas",value:function(e,t,r,n){var i=e.getContext("2d"),o=t.size/t.getOriginalFontSize(),a=t.font,s=a.pages[a.data.pages[0]],u=a.data.common.base,l=s.size.width,c=s.size.height,d=s.uv;e.width,e.height;0===t.relativeAnchorX&&0===t.relativeAnchorY||console.warn("Relative anchor not supported for now"),"left"!==t.align&&console.warn("Align not supported for now");for(var f=0,h=t.layout.glyphs.length;f<h;f++){var p=t.layout.glyphs[f],m=p.data.width,g=p.data.height,v=p.data.x,y=p.data.y,_=p.position[0],b=(p.position[1],t.layout._height);b=p.position[1];var E=v/l,w=(c-y)/c,A=(v+m)/l,T=(c-y-g)/c;E=I.MathTools.map(E,0,1,d.umin,d.umax),A=I.MathTools.map(A,0,1,d.umin,d.umax),w=I.MathTools.map(w,0,1,d.vmin,d.vmax),T=I.MathTools.map(T,0,1,d.vmin,d.vmax);var S=E*s.base.image.width,x=(1-w)*s.base.image.height,M=Math.abs(A-E)*s.base.image.width,R=Math.abs(T-w)*s.base.image.height,O=M,P=R,C=p.data.xoffset,D=p.data.yoffset;32<p.data.id&&i.drawImage(s.base.image,S,x,M,R,r+(_+C)*o,n+(b+D)*o,O*o,P*o)}}},{key:"setRenderOrderRecursive",value:function(e,t){if(!(e instanceof o.Object3D))throw"obj should be instance of Object3D";e.renderOrder=t;for(var r=0,n=e.children.length;r<n;r++){var i=e.children[r];this.setRenderOrderRecursive(i,++t)}}},{key:"tryGetLayerFromScene",value:function(e){for(;e.parent;)e=e.parent;return"Scene"!==e.type?null:e.userData&&e.userData.layer?e.userData.layer:null}},{key:"filterQualityArray",value:function(e,t,r){var n=1920;h.iphone()&&(n=1440),h.desktop()&&(n=2160);var i=1e3;r&&(n=r),t&&(i=t);var o=[],a=!0,s=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value,f=parseInt(d);"number"==typeof f&&(n<f||f<i)||o.push(d)}}catch(e){s=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}return o}},{key:"K2PQualityNotation",value:function(e,t){var r=!(1<arguments.length&&void 0!==t)||t,n=this.parseKQuality(e);if(null==n)throw new Error("Expected quality in format: Xk (4k, 5k, 6k)");var i=540*parseInt(n[1]);return r?i+"p":i}},{key:"parseKQuality",value:function(e){return"string"!=typeof e?null:e.match(/([\d]+)k/i)}},{key:"parsePQuality",value:function(e){return"string"!=typeof e?null:e.match(/([\d]+)p/i)}},{key:"qualityToNumber",value:function(e){var t=this.parsePQuality(e);return null!==t?parseInt(t[1]):null===(t=this.parseKQuality(e))?null:this.K2PQualityNotation(e,!1)}},{key:"selectQuality",value:function(e,t,r){var n=2<arguments.length&&void 0!==r?r:"1440p";if(""===t||1==e.length){if(-1<e.indexOf(n))return n;e[e.length-1]}if(isNaN(parseInt(t)))return e[e.length-1];if(-1<e.indexOf(t))return t;for(var i=parseInt(t),o=1;o<e.length;o++){var a=parseInt(e[o-1]),s=parseInt(e[o]);if(a<i&&i<s)return Math.abs(i-a)<Math.abs(i-s)?e[o-1]:e[o]}return e[e.length-1]}},{key:"parseAspect",value:function(e){if(e){var t=e.match(/([0-9]+)[/:]{1}([0-9]+)/i);if(t){var r=parseFloat(t[1]),n=parseFloat(t[2]);if(isNaN(r)||r<=0||isNaN(n)||n<=0)return;return r/n}}}},{key:"defineComponentMethods",value:function(e){e.prototype.onFrameEnter=function(){for(var e=0,t=this._components.length;e<t;e++){var r=this._components[e];r._started||(r.start(),r._started=!0),r.update()}},e.prototype.addComponent=function(e){return this._components.push(e),e._owner=this,e.added(),this},e.prototype.removeComponent=function(e){var t=this._components.indexOf(e);return-1!=t&&(this._components.splice(t,1),e._owner=null,e.removed(),!0)},e.prototype.hasComponent=function(e){return this._components.includes(e)},e.prototype.getComponentByType=function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=this._components[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(a instanceof e)return a}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}return null},e.prototype.dispose=function(){for(var e=0;e<this._components.length;e++)this._components[e].dispose()}}},{key:"isMobile",value:function(){return h.mobile()}},{key:"formatTime",value:function(e){e=e||0;var t=new Date(1e3*e);function r(e){return e<10?"0"+e:e}return(3600<e?r(t.getUTCHours())+":":"")+r(t.getUTCMinutes())+":"+r(t.getUTCSeconds())}},{key:"getURLExt",value:function(e,t){var r=!(1<arguments.length&&void 0!==t)||t,n=e.split(".").pop().trim().split(/\#|\?/g)[0];return r?n.toLowerCase():n}}]),e}();r.CommonTools=a},{"./math-tools":692,"./vendor-tools":698,is_js:580,three:615}],689:[function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.DataStorage=void 0;var o=function(){function t(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),"string"!=typeof e)throw"name should be string";this.name=e,this.data={}}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"set",value:function(e,t){if("string"!=typeof e)throw"name should be string";return this.data[e]=t,this}},{key:"get",value:function(e,t){var r=this.data[e];return(null==r||"number"==typeof r&&isNaN(r))&&(r=t),r}},{key:"remove",value:function(e){delete this.data[e]}},{key:"save",value:function(e,t){var r=window.localStorage;if(r)if(e&&Array.isArray(e)){var n={},i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;void 0!==this.data[l]&&(n[l]=this.data[l])}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}r.setItem("string"==typeof t&&0<t.length?t:this.name,JSON.stringify(n))}else r.setItem("string"==typeof t&&0<t.length?t:this.name,JSON.stringify(this.data));else console.warn("DataStorage cant save data -- no window.localStorage object");return this}},{key:"load",value:function(){var e=window.localStorage;if(e){var t=e.getItem(this.name);if(!t)return this;var r=null;try{r=JSON.parse(t)}catch(e){return console.warn("DataStorage cant load data -- saved data is not a JSON"),this}"object"===n(r)&&(this.data=r)}else console.warn("DataStorage cant load data -- no window.localStorage object");return this}},{key:"dispose",value:function(){this.data=null}}]),t}();r.DataStorage=o},{}],690:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EventBus=void 0;var n=e("three");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.internal=new n.EventDispatcher,this.external=new n.EventDispatcher}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"dispatchInternal",value:function(e){this.internal.dispatchEvent(e)}},{key:"dispatchExternal",value:function(e){this.external.dispatchEvent(e)}},{key:"dispose",value:function(){this.internal=this.external=null}}]),e}();r.EventBus=o},{three:615}],691:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ListenersManager=void 0;var i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),n=e("./messenger");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=["webkit","moz","ms","o","khtml"],a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pairs=[],this.bindings=[],this.subscriptions=[]}return function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(e,[{key:"add",value:function(e,t,r,n){if("string"==typeof t&&(t=[t]),!Array.isArray(t))throw"Wrong listener type given";if("function"!=typeof e.addEventListener)throw"Given object is not dispatcher";if("function"!=typeof r)throw"Callback is not a function";var i=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;e.addEventListener(l,r,n),this.pairs.push({dispatcher:e,type:l,callback:r,useCapture:n})}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return r}},{key:"remove",value:function(e,t,r,n){"string"==typeof t&&(t=[t]);var i=!0,o=!1,a=void 0;try{for(var s,u=this.pairs[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;0<t.indexOf(l.type)&&r===l.callback&&l.dispatcher.removeEventListener(l.type,l.callback,l.useCapture)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}},{key:"vendors",value:function(e,t,r,n){"string"==typeof t&&(t=[t]);var i=!0,o=!1,a=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){for(var l=s.value,c=0,d=h;c<d.length;c++){var f=d[c];this.add(e,f+l,r,n)}this.add(e,l,r,n)}}catch(e){o=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}},{key:"binding",value:function(e,t,r,n){if(e instanceof i.Signal||console.log("Expected signals.Signal"),"function"!=typeof t)throw"Callback is not a function";return(n=n||!1)?this.binding.push(e.addOnce(t,r)):this.bindings.push(e.add(t,r)),t}},{key:"subscribe",value:function(e,t,r){if(!(e instanceof n.Messenger))throw new Error("Expected Messenger instance");e.subscribe(t,r),this.subscriptions.push({messenger:e,event:t,callback:r})}},{key:"dispose",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.pairs[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;o.dispatcher.removeEventListener(o.type,o.callback,o.useCapture)}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}var a=!0,s=!1,u=void 0;try{for(var l,c=this.bindings[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){l.value.detach()}}catch(e){s=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}var d=!0,f=!1,h=void 0;try{for(var p,m=this.subscriptions[Symbol.iterator]();!(d=(p=m.next()).done);d=!0){var g=p.value;g.messenger.unsubscribe(g.event,g.callback)}}catch(e){f=!0,h=e}finally{try{d||null==m.return||m.return()}finally{if(f)throw h}}this.pairs=null,this.binding=null,this.subscriptions=null}}]),e}();r.ListenersManager=a},{"./messenger":693,signals:612}],692:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.MathTools=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,null,[{key:"lerp",value:function(e,t,r){return e*(r-t)+t}},{key:"lerpClamped",value:function(e,t,r){return this.lerp(this.clamp(e,0,1),t,r)}},{key:"clamp01",value:function(e){return this.clamp(e,0,1)}},{key:"clamp",value:function(e,t,r){if(r<t){var n=t;t=r,r=n}return Math.min(r,Math.max(e,t))}},{key:"map",value:function(e,t,r,n,i){var o=this.clamp01((e-t)/(r-t));return this.lerp(o,n,i)}},{key:"formatTime",value:function(e){e=e||0;var t=new Date(1e3*e);function r(e){return e<10?"0"+e:e}return(3600<e?r(t.getUTCHours())+":":"")+r(t.getUTCMinutes())+":"+r(t.getUTCSeconds())}},{key:"isPoT",value:function(e){return 0!==e&&e&e-1==0}},{key:"toNextPoT",value:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))}},{key:"toPrevPoT",value:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.log(2)))}},{key:"angleToChord",value:function(e,t){return 2*e*Math.sin(t/2)}},{key:"chordToAngle",value:function(e,t){return 2*Math.asin(t/(2*e))}},{key:"centerOfChordByChord",value:function(e,t){var r=this.chordToAngle(e);return t*Math.cos(r/2)}},{key:"centerOfChordByAngle",value:function(e,t){return t*Math.cos(e/2)}}]),e}();r.MathTools=i},{}],693:[function(e,t,r){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.Messenger=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"post",value:function(e,t){if(this._pairs){var r=this._pairs[e];if(r){var n={message:e};t&&("object"===a(t)?Object.assign(n,t):n.value=t);for(var i=0,o=r.length;i<o;i++)r[i].listener.call(this,n),!0===r[i]._once&&(r.splice(i,1),i--,o--)}return this}}},{key:"subscribe",value:function(e,t){this._pairs||(this._pairs={},this._onceFunc=function(){this._once=!0});var r=null,n=this._pairs;return n[e]||(n[e]=[]),n[e].some(function(e){return e.listener===t})||(r={listener:t,once:this._onceFunc,_once:!1},n[e].push(r)),r}},{key:"unsubscribe",value:function(e,t){if(void 0!==this._pairs){var r=this._pairs[e];if(r){var n=r.findIndex(function(e){return e.listener===t});-1!==n&&r.splice(n,1)}}}},{key:"dispose",value:function(){for(var e in this._services){var t=this._services[e];"function"==typeof t.dispose&&t.dispose()}this._pairs=null,this._onceFunc=null,this._values=null,this._services=null,this._serviceFactories=null}},{key:"registerValue",value:function(e,t){return this._values||(this._values={}),this._values[e]="function"==typeof t?t:function(){return t},this}},{key:"getValue",value:function(e,t){if("string"!=typeof e)throw new Error("string expected");if(this._values&&this._values[e])return this._values[e]();if(void 0!==t)return t;throw new Error("No value with name = "+e)}},{key:"registerService",value:function(e,t){return this._serviceFactories||(this._serviceFactories={}),this._serviceFactories[e]=t,this}},{key:"getService",value:function(e){if(this._services&&this._services[e])return this._services[e];if(this._serviceFactories){if(this._serviceFactories[e]){var t=new this._serviceFactories[e](this);return this._services||(this._services=[]),this._services[e]=t}throw new Error("No service with name ".concat(e))}throw new Error("No service with name ".concat(e))}}]),e}();r.Messenger=i},{}],694:[function(e,t,r){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.Pool=void 0;var n=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.instances=[],this.creator=e;for(var r=0;r<t;r++)this.instances.push(e())}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(n,[{key:"push",value:function(e){this.instances.push(e)}},{key:"pop",value:function(){return 0<this.instances.length?this.instances.pop():this.creator()}},{key:"dispose",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this.instances[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;o.dispose&&"function"==typeof o.dispose&&o.dispose()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.instances=null,this.creator=null}}]),n}();r.Pool=n},{}],695:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){if(n&&i)return Promise.resolve();return(!n&&window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission():Promise.resolve(!0)).then(function(e){return n=n||e,!i&&window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission?window.DeviceMotionEvent.requestPermission():Promise.resolve(!0)}).then(function(e){i=i||e})},r.isDOEGranted=o,r.isDMEGranted=a,r.areDeviceOrientationPermissionsGranted=function(){return o()&&a()};!function(e){{if(e&&e.__esModule)return;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}t.default=e}}(e("is_js"));var n=!1,i=!1;function o(){return n}function a(){return i}},{is_js:580}],696:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.TaskRunner=void 0;var i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tasks=[],this.msPerFrame=3,this._getTime=window.performance?window.performance.now.bind(window.performance):Date.now.bind(Date)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"update",value:function(){for(var e=this._getTime();;){var t=this.tasks[0];if(!t)return;var r=t.executors.shift();if(t.result=r(t.result),0===t.executors.length&&(this.tasks.shift(),t.resolve(t.result)),this._getTime()-e>this.msPerFrame)break}}},{key:"run",value:function(r,n){var i=this;return new Promise(function(e,t){i.tasks.push({id:r,resolve:e,reject:t,executors:"function"==typeof n?[n]:n,result:null})})}},{key:"remove",value:function(e){for(var t=this.tasks.length-1;0<=t;t--)if(this.tasks[t].id===e)return void this.tasks.splice(t,1)}}]),e}());r.TaskRunner=i},{}],697:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Value=void 0;var n=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function r(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.__=e,this.onChange=new n.Signal,this.forceDispatch=t}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(r,[{key:"_",get:function(){return this.__},set:function(e){var t=this.__;return this.__=e,this.__===t&&!0!==this.forceDispatch||this.onChange.dispatch(this.__,t),this.__}}]),r}();r.Value=o},{signals:612}],698:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.VendorTools=void 0;var l=["webkit","moz","ms","o","khtml"],o=null,i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,null,[{key:"loadExtension",value:function(e,t){var r=(t=t||window)[e];if(r)return{prefix:"",field:e,value:r};for(var n=e.charAt(0).toUpperCase()+e.substr(1),i=0,o=l;i<o.length;i++){var a=o[i],s=a+n,u=t[s];if(u)return{prefix:a,field:s,value:u}}return{prefix:null,field:null,value:null}}},{key:"loadFirstExtension",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=this.loadExtension(s,t);if(null!=u.field)return u}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return{prefix:null,field:null,value:null}}},{key:"addVendorListener",value:function(e,t,r,n){n="boolean"==typeof n&&n;for(var i=0,o=l;i<o.length;i++){var a=o[i];e.addEventListener(a+t,r,n)}e.addEventListener(t,r,n)}},{key:"resetCSSAnimation",value:function(e){return e.style.animation=e.style.webkitAnimation="none",e.offsetHeight,e.style.animation=e.style.webkitAnimation=null,this}},{key:"isGearVR",value:function(){return/SAMSUNG (?!Pacific).+Mobile.?VR/i.test(window.navigator.userAgent)||/OculusBrowser.+Mobile.?VR/i.test(window.navigator.userAgent)&&window.navigator.userAgent.toLowerCase().indexOf("pacific")<0&&window.navigator.userAgent.toLowerCase().indexOf("quest")<0}},{key:"greaterOrEqualsToGalaxySX",value:function(e){var t=0;switch(e){case 9:t=960;break;case 8:t=950;break;case 7:t=930;break;default:throw new Error("Detecting Galaxy S".concat(e," is not supported"))}var r=window.navigator.userAgent.match(/SM-G(\d+)/i);return!!r&&parseInt(r[1])>=t}},{key:"isOculusGo",value:function(){return/Pacific.+OculusBrowser.+Mobile.?VR/i.test(window.navigator.userAgent)||/SAMSUNG.?Pacific.+Mobile.?VR/i.test(window.navigator.userAgent)}},{key:"isOculusQuest",value:function(){return/Quest.+OculusBrowser.+Mobile.?VR/i.test(window.navigator.userAgent)}},{key:"isStandaloneHmd",value:function(){return this.isOculusGo()||this.isGearVR()||this.isOculusQuest()}},{key:"isSamsungInternet",value:function(){return/Samsung.+Build.+VR/i.test(window.navigator.userAgent)}},{key:"isOculusBrowser",value:function(){return/OculusBrowser.+Mobile.?VR/i.test(window.navigator.userAgent)}},{key:"getDeviceOrientationSupported",value:function(i){return i=i||200,new Promise(function(t,e){if(null!==o)return t(o);if(!window.DeviceMotionEvent)return t(o=!1);function r(e){e&&"number"==typeof e.alpha&&"number"==typeof e.beta&&"number"==typeof e.gamma?(window.removeEventListener("deviceorientation",r),clearTimeout(n),t(o=!0)):t(o=!1)}var n=setTimeout(function(){window.removeEventListener("deviceorientation",r),t(o=!1)},i);window.addEventListener("deviceorientation",r)})}}]),e}();r.VendorTools=i},{}],699:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("./video-controller-strategy")),o=n(e("dashjs")),a=e("./common-tools");function n(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=l(this,c(n).call(this,e,t))).player=o.default.MediaPlayer().create(),r.player.initialize(e.element,t[0].url,!0),r.qualityGrades=["DASH"],r.currentQuality="DASH",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(n,i.default),function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(n,[{key:"dispose",value:function(){this.player.reset()}}],[{key:"isDashSource",value:function(e){if("object"!==s(e)||!e.url)throw new Error("Wrong src object given");return e.mimeType&&"application/dash+xml"==e.mimeType.toLowerCase()||"mpd"===a.CommonTools.getURLExt(e.url)}}]),n}();r.default=f},{"./common-tools":688,"./video-controller-strategy":703,dashjs:343}],700:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("./video-controller-strategy")),l=e("./common-tools"),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("is_js")),d=i(e("./video-controller-hls-strategy")),f=i(e("./video-controller-dash-strategy"));function i(e){return e&&e.__esModule?e:{default:e}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(){function u(e,t,r,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),i=h(this,p(u).call(this,e,t));var o=c.ios(),a=t.find(function(e){return d.default.isHLSSource(e)}),s=null;if(s=a&&o?[a.quality="HLS"]:t.filter(function(e){return!d.default.isHLSSource(e)&&!f.default.isDashSource(e)}).map(function(e){return e.quality}),i.qualityGrades=l.CommonTools.filterQualityArray(s,l.CommonTools.qualityToNumber(r),l.CommonTools.qualityToNumber(n)),0==i.qualityGrades.length)throw new Error("No provided sources can be played on this device");return i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(u,n.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(u,[{key:"setCurrentQuality",value:function(t){var e=this.sources.find(function(e){return e.quality==t}),r=this.controller.video;if(!e)throw new Error("No quality grade: ".concat(t));var n={paused:r.paused,currentTime:r.currentTime};this.currentQuality=t,r.src=e.url,r.currentTime=n.currentTime,n.paused||this.controller.play(),this.controller.onQualityChange.dispatch(t)}},{key:"setClosestQuality",value:function(e){var t=l.CommonTools.qualityToNumber(e);if(null!=t){var i=t,r=this.qualityGrades.reduce(function(e,t){var r=l.CommonTools.qualityToNumber(t),n=l.CommonTools.qualityToNumber(e);return null!==r&&Math.abs(r-i)<Math.abs(n-i)?t:e});this.setCurrentQuality(r)}else this.setCurrentQuality(this.qualityGrades[this.qualityGrades.length-1])}}]),u}();r.default=u},{"./common-tools":688,"./video-controller-dash-strategy":699,"./video-controller-hls-strategy":702,"./video-controller-strategy":703,is_js:580}],701:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("./video-controller-strategy"));e("./common-tools"),function(e){{if(e&&e.__esModule)return;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}t.default=e}}(e("is_js")),n(e("./video-controller-hls-strategy")),n(e("./video-controller-dash-strategy"));function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?u(e):t}(this,s(n).call(this,e,t))).mediaSource=new MediaSource,r.sourceBuffer=null,r.bufferQueue=new Uint8Array(0),r.ws=new WebSocket(t[0].url),r.mediaSource.addEventListener("sourceopen",r.onSourceOpen.bind(u(r))),r.mediaSource.addEventListener("error",console.warn),r.qualityGrades=["Test"],e.video.src=URL.createObjectURL(r.mediaSource),r.startStreaming(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,i.default),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(n,[{key:"onSourceOpen",value:function(){this.sourceBuffer=this.mediaSource.addSourceBuffer('video/mp4; codecs="avc1.424020, mp4a.40.2"'),this.sourceBuffer.addEventListener("updateend",this.sourceBufferUpdateEnd.bind(this)),this.sourceBuffer.addEventListener("error",function(e){console.log(e)})}},{key:"startStreaming",value:function(){var e=this,t=this.ws;t.binaryType="arraybuffer",t.onopen=function(){e.wsSend("hello")},t.onmessage=this.onWsHelloMessage.bind(this)}},{key:"onWsHelloMessage",value:function(){var e=this.ws;this.controller;this.wsSend("play",{quality:"test"}),e.onmessage=this.onWsMessage.bind(this)}},{key:"onWsMessage",value:function(e){var t=this.controller.video,r=this.sourceBuffer,n=this.bufferQueue;if("string"!=typeof e.data){var i=new Uint8Array(e.data);n=0===n.byteLength?i:this.appendBuffer(n,i),r&&!r.updating&&(r.appendBuffer(n),this.bufferQueue=new Uint8Array(0)),t.paused&&t.play(),t.buffered.length}else this.parseResponse(e.data)}},{key:"parseResponse",value:function(e){var t=JSON.parse(e);console.log(t),"Stream not found"==t.error&&console.log(t.error),"Stream ended"==t.error&&console.log(t.error)}},{key:"wsSend",value:function(e,t){var r=this.ws,n=t||{};n.url="stream/"+e,n.version="0.0.1",r.send(JSON.stringify(n))}},{key:"appendBuffer",value:function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r}},{key:"sourceBufferUpdateEnd",value:function(){var e=this.controller.video;if(e.buffered.length&&0===e.currentTime){var t=e.buffered.end(e.buffered.length-1);e.currentTime=t}}},{key:"dispose",value:function(){}}],[{key:"isDreamcamFmp4",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},r=t.url,n=t.dreamcam;return r&&-1<r.toLowerCase().indexOf("fmp4s")||!0===n}}]),n}();r.default=c},{"./common-tools":688,"./video-controller-dash-strategy":699,"./video-controller-hls-strategy":702,"./video-controller-strategy":703,is_js:580}],702:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("./video-controller-strategy")),o=n(e("hls.js")),a=e("./common-tools");function n(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=l(this,c(n).call(this,e,t))).qualityGrades=["HLS"],r.currentQuality="HLS",r.hls=new o.default,r.hls.attachMedia(e.video),r.hls.on(o.default.Events.MEDIA_ATTACHED,function(e){r.hls.loadSource(t[0].url),r.hls.on(o.default.Events.MANIFEST_PARSED,function(e){}),r.hls.on(o.default.Events.MANIFEST_LOADED,function(e){}),r.hls.on(o.default.Events.ERROR,function(e,t){if(t.fatal)switch(t.type){case o.default.ErrorTypes.MEDIA_ERROR:console.warn("HLS media error, trying to recover..."),console.warn("Additional info",e,t),r.hls.recoverMediaError();break;case o.default.ErrorTypes.NETWORK_ERROR:console.warn("HLS network error, trying to recover..."),console.warn("Additional info",e,t),r.hls.startLoad()}})}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(n,i.default),function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(n,[{key:"setCurrentQuality",value:function(e){}},{key:"setClosestQuality",value:function(e){}},{key:"dispose",value:function(){this.hls.destroy()}}],[{key:"isHLSSource",value:function(e){if("object"!==s(e)||!e.url)throw new Error("Wrong src object given");return e.mimeType&&"application/x-mpegurl"==e.mimeType.toLowerCase()||"m3u8"===a.CommonTools.getURLExt(e.url)}}]),n}();r.default=f},{"./common-tools":688,"./video-controller-strategy":703,"hls.js":565}],703:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=function(){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.controller=e,this.sources=t,this.qualityGrades=null,this.currentQuality=null}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(r,[{key:"setCurrentQuality",value:function(e){}},{key:"setClosestQuality",value:function(e){}},{key:"dispose",value:function(){}}]),r}();r.default=i},{}],704:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.VideoController=void 0;var c=e("three"),d=i(e("is_js")),f=i(e("signals")),h=(e("./common-tools"),e("../../states/cinema/cinema-messages")),p=e("./listeners-manager"),m=n(e("./video-controller-default-strategy")),g=n(e("./video-controller-hls-strategy")),v=i(e("hls.js")),y=n(e("./video-controller-dash-strategy"));n(e("./video-controller-dreamcam-strategy"));function n(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function l(e,t){var r=this,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length?arguments[3]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.app=e,this.strategySelector=i,this.listenersManager=new p.ListenersManager;var o=this.element=document.createElement("video");o.volume=n,o.muted=0===o.volume,o.autoplay=t,o.preload=d.mobile()?"metadata":"auto",o.controls=!1;var a=this.texture=new c.VideoTexture(o);a.format=c.RGBFormat,a.generateMipmaps=!1,a.matrixAutoUpdate=!1,a.minFilter=a.magFilter=c.LinearFilter,a.wrapS=a.wrapT=c.ClampToEdgeWrapping;this.material=new c.MeshBasicMaterial({map:a});o.loop=!1,o.setAttribute("playsinline","playsinline"),o.setAttribute("webkit-playsinline","webkit-playsinline"),o.setAttribute("crossorigin","anonymous"),this.strategy=null,this.video=o,this.sourcesRaw=null,this.locked=!1,this.isWaiting=!0,this.onStartWaiting=new f.Signal,this.onReady=new f.Signal,this.onError=new f.Signal,this.onQualityChange=new f.Signal,this.onMetadataLoad=new f.Signal,this.listenersManager.add(o,"abort",this.waiting.bind(this)),this.listenersManager.add(o,"seeking",this.waiting.bind(this)),this.listenersManager.add(o,"canplay",this.ready.bind(this)),this.listenersManager.add(o,"timeupdate",function(e){r.isWaiting&&r.ready(e)}),window.v=o;function s(e){u||("number"==typeof o.videoWidth&&0<o.videoWidth||1<=o.readyState)&&(u=!0,r.onMetadataLoad.dispatch())}var u=!1;this.listenersManager.add(o,"loadedmetadata",s),this.listenersManager.add(o,"loadeddata",s),this.listenersManager.subscribe(this.app,h.CinemaMessages.SET_LOOP,function(e){return r.setLoop(e.value)}),this.listenersManager.subscribe(this.app,h.CinemaMessages.SET_AB,function(e){return r.setAB(e.start,e.end)}),this.listenersManager.subscribe(this.app,h.CinemaMessages.CANCEL_AB,function(){return r.cancelAB()}),this._ab=null}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(l,[{key:"setAB",value:function(e,t){e<0&&(e=0),t>this.element.duration&&(t=this.element.duration),this._ab={start:e,end:t}}},{key:"cancelAB",value:function(){this._ab=null}},{key:"setLoop",value:function(e){this.element.loop=!!e}},{key:"setQualities",value:function(e,t,r,n){var i=1<arguments.length&&void 0!==t?t:"1920p",o=2<arguments.length?r:void 0,a=3<arguments.length?n:void 0;if(!Array.isArray(e))throw new Error("Wrong qualities argument given");this.sourcesRaw=e,this.strategy&&this.strategy.dispose();var s=d.ios(),u=e.find(function(e){return y.default.isDashSource(e)}),l=e.find(function(e){return g.default.isHLSSource(e)});return"function"==typeof this.strategySelector?this.strategy=this.strategySelector(e,this):u&&!s?this.strategy=new y.default(this,[u]):l&&v.isSupported()?this.strategy=new g.default(this,[l]):this.strategy=new m.default(this,e,o,a),this.strategy.setClosestQuality(i),this}},{key:"setCurrentQuality",value:function(e){return this.strategy.setCurrentQuality(e),this}},{key:"setClosestQuality",value:function(e){return this.strategy.setClosestQuality(e),this}},{key:"waiting",value:function(e){this.isWaiting=!0,this.locked=!0,this.onStartWaiting.dispatch()}},{key:"ready",value:function(e){this.isWaiting=!1,this.locked=!1,this.onReady.dispatch()}},{key:"play",value:function(){var t=this;if(!this.locked){this.locked=!0;var e=this.video.play();return e.then(function(e){t.locked=!1}).catch(function(e){console.warn("Failed to call video.play(). Reason: "+e),t.locked=!1,t.onError.dispatch(e),(!t.video.muted||0<t.video.volume)&&(console.log("Muting video..."),t.video.muted=!0,t.video.volume=0,t.play())}),e}}},{key:"onFrameEnter",value:function(){if(null!==this._ab&&"object"===o(this._ab)){var e=this._ab,t=this.element.currentTime;(t<e.start-2||t>e.end)&&!this.isWaiting&&(this.element.currentTime=e.start)}}},{key:"pause",value:function(){this.locked||(this.video.pause(),this.locked=!1)}},{key:"load",value:function(){this.video.load()}},{key:"addEventListener",value:function(e,t){return this.video.addEventListener(e,t),this}},{key:"removeEventListener",value:function(e,t){return this.video.removeEventListener(e,t),this}},{key:"dispose",value:function(){this.listenersManager.dispose(),this.listenersManager=null,this.element.src="",this.element.load(),this.element=null,this.app=null,this.texture.dispose(),this.material.dispose(),this.strategy&&this.strategy.dispose()}},{key:"videoAspect",get:function(){return this.element.readyState>=this.element.HAVE_METADATA?this.element.videoWidth/this.element.videoHeight:2}},{key:"paused",get:function(){return this.video.paused}},{key:"currentTime",get:function(){return this.video.currentTime},set:function(e){return e?this.video.currentTime=e:this.video.currentTime}},{key:"duration",get:function(){return this.video.duration}},{key:"volume",get:function(){return this.video.volume},set:function(e){return this.video.volume=e}},{key:"muted",get:function(){return this.video.muted},set:function(e){return this.video.muted=e}},{key:"src",get:function(){return this.video.src},set:function(e){return this.video.src=e}},{key:"buffered",get:function(){return this.video.buffered}},{key:"currentQuality",get:function(){return this.strategy.currentQuality}},{key:"qualityGrades",get:function(){return this.strategy.qualityGrades}}]),l}();r.VideoController=s},{"../../states/cinema/cinema-messages":719,"./common-tools":688,"./listeners-manager":691,"./video-controller-dash-strategy":699,"./video-controller-default-strategy":700,"./video-controller-dreamcam-strategy":701,"./video-controller-hls-strategy":702,"hls.js":565,is_js:580,signals:612,three:615}],705:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.messenger=e}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(t,[{key:"isSupported",value:function(){throw new Error("Not implemented")}},{key:"toggleVRMode",value:function(){throw new Error("Not implemented")}},{key:"prepare",value:function(){throw new Error("Not implemented")}},{key:"submitFrame",value:function(){throw new Error("Not implemented")}},{key:"dispose",value:function(){this.messenger=null}},{key:"enabled",get:function(){throw new Error("Not implemented")}},{key:"vrAvailable",get:function(){throw new Error("Not implemented")}}]),t}();r.default=i},{}],706:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n={SET_VR_DISPLAY:"set-vr-display",SET_XR_SESSION:"set-xr-session",VR_MODE_ENABLED:"vr-mode-enabled",VR_MODE_DISABLED:"vr-mode-disabled",VR_MODE_CHANGE:"vr-mode-change"};(0,e("../../misc/prefix-properties").prefixProperties)("vr-manager:",n);var i=n;r.default=i},{"../../misc/prefix-properties":716}],707:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=c(e("./webvr-strategy")),i=e("../utils/listeners-manager"),o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),a=c(e("../render-manager-messages")),s=c(e("./vr-manager-messages")),u=c(e("promise.allsettled")),l=c(e("./webxr-strategy"));function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=function(){function r(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.messenger=e,this.strategies=[new l.default(e),new n.default(e)],this.strategy=null,this.listenersManager=new i.ListenersManager,this.listenersManager.subscribe(e,a.default.REQUEST_SUBMIT_FRAME,function(){t.submitFrame()}),this.listenersManager.subscribe(e,s.default.VR_MODE_ENABLED,function(){t.messenger.post(s.default.VR_MODE_CHANGE,{presenting:!0})}),this.listenersManager.subscribe(e,s.default.VR_MODE_DISABLED,function(){t.messenger.post(s.default.VR_MODE_CHANGE,{presenting:!1})}),this.onDisplayPresentChange=new o.Signal,this.onVRAvailabilityChange=new o.Signal,this.selectStrategy()}return function(e,t,r){t&&d(e.prototype,t),r&&d(e,r)}(r,[{key:"toggleVRMode",value:function(){var e=this;return this.strategy?this.strategy.toggleVRMode():this.selectStrategy().then(function(){e.strategy.toggleVRMode()}).catch(console.warn)}},{key:"selectStrategy",value:function(){var i=this;return this.strategy?Promise.resolve():new Promise(function(r,n){var e=i.strategies.map(function(e){return e.isSupported()});(0,u.default)(e).then(function(e){var t=(e=e.map(function(e){return e.value})).indexOf(!0);return-1<t?(i.strategy=i.strategies[t],i.strategy.prepare().then(r)):n("No vr strategies supported")})})}},{key:"submitFrame",value:function(){this.strategy&&this.strategy.submitFrame()}},{key:"enabled",get:function(){return!(!this.strategy||!this.strategy.enabled)}},{key:"vrAvailable",get:function(){return!(!this.strategy||!this.strategy.vrAvailable)}}]),r}();r.default=f},{"../render-manager-messages":671,"../utils/listeners-manager":691,"./vr-manager-messages":706,"./webvr-strategy":708,"./webxr-strategy":709,"promise.allsettled":591,signals:612}],708:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=a(e("./base-vr-strategy")),i=a(e("./vr-manager-messages")),o=e("../utils/vendor-tools");e("../render-manager"),a(e("../render-manager-messages"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function f(e,t,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=d(this,h(r).call(this,e))).display=null,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(r,n.default),function(e,t,r){t&&c(e.prototype,t),r&&c(e,r)}(r,[{key:"isSupported",value:function(){return Promise.resolve("getVRDisplays"in navigator)}},{key:"prepare",value:function(){return this.tryGetDisplays()}},{key:"tryGetDisplays",value:function(){var r=this;return navigator.getVRDisplays().then(function(e){if(0<e.length){var t=e[0];r.display=t,r.messenger.post(i.default.SET_VR_DISPLAY,{display:t})}}).catch(function(e){throw"Couldnt get VR displays (reason: ".concat(e,")")})}},{key:"toggleVRMode",value:function(){return this.display?this.enabled?this.disableVRMode():this.enableVRMode():Promise.reject("No VR display found")}},{key:"enableVRMode",value:function(){var t=this;return this.enabled?Promise.resolve():(this.messenger.getService("loop-manager").cancelCurrentRAF(),this.display.requestPresent([function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(r,!0).forEach(function(e){l(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({source:this.messenger.getValue("dom-element")},this.getVRAttributes())]).then(function(e){t.messenger.post(i.default.VR_MODE_ENABLED),t.messenger.getService("loop-manager").setRAFSource(t.display).requestLoop()}).catch(function(e){console.warn("Couln't request present. Reason: "+e)}))}},{key:"disableVRMode",value:function(){var t=this;return this.enabled?(this.messenger.getService("loop-manager").cancelCurrentRAF(),this.display.exitPresent().then(function(e){t.messenger.post(i.default.VR_MODE_DISABLED),t.messenger.getService("loop-manager").setRAFSource(window).requestLoop()}).catch(function(e){console.warn("Couln't exit present. Reason: "+e)})):Promise.resolve()}},{key:"getVRAttributes",value:function(){return o.VendorTools.isOculusGo()?{foveationLevel:3}:(o.VendorTools.isOculusQuest(),{})}},{key:"dispose",value:function(){f(h(r.prototype),"dispose",this).call(this),this.display=null}},{key:"enabled",get:function(){return!(!this.display||!this.display.isPresenting)}},{key:"vrAvailable",get:function(){return!!this.display}}]),r}();r.default=m},{"../render-manager":672,"../render-manager-messages":671,"../utils/vendor-tools":698,"./base-vr-strategy":705,"./vr-manager-messages":706}],709:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=a(e("./base-vr-strategy")),i=a(e("./vr-manager-messages")),o=e("../utils/vendor-tools");e("../render-manager"),a(e("../render-manager-messages"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(){function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=l(this,d(r).call(this,e))).session=null,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(r,n.default),function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(r,[{key:"isSupported",value:function(){return new Promise(function(t){if(!("xr"in navigator))return t(!1);var e=o.VendorTools.loadFirstExtension(["isSessionSupported","supportsSession","supportsSessionMode"],navigator.xr);if(!e||!e.field)return t(!1);var r=e.field;navigator.xr[r].call(navigator.xr,["immersive-vr"]).then(function(e){t("boolean"!=typeof e||e)}).catch(function(e){console.log(e),console.error(JSON.stringify(e)),t(!1)})})}},{key:"prepare",value:function(){return Promise.resolve()}},{key:"toggleVRMode",value:function(){return this.enabled?this.disableVRMode():this.enableVRMode()}},{key:"enableVRMode",value:function(){var t=this;if(this.enabled)return Promise.resolve();this.messenger.getService("loop-manager").cancelCurrentRAF();return navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(function(e){t.session=e,t.messenger.post(i.default.SET_XR_SESSION,{session:e}),t.messenger.getService("loop-manager").setRAFSource(t.session).requestLoop(),t.messenger.post(i.default.VR_MODE_ENABLED)}).catch(function(e){throw"Couldnt request XRSession (reason: ".concat(e,")")})}},{key:"disableVRMode",value:function(){var t=this;return this.enabled?(this.messenger.getService("loop-manager").cancelCurrentRAF(),this.session.end().then(function(e){t.session=null,t.messenger.post(i.default.SET_XR_SESSION,{session:null}),t.messenger.post(i.default.VR_MODE_DISABLED),t.messenger.getService("loop-manager").setRAFSource(window).requestLoop()}).catch(function(e){console.warn("Couln't end XRSession. Reason: "+e)})):Promise.resolve()}},{key:"dispose",value:function(){c(d(r.prototype),"dispose",this).call(this),this.session&&(this.session.end(),this.session=null)}},{key:"enabled",get:function(){return!!this.session}},{key:"vrAvailable",get:function(){return!0}}]),r}();r.default=h},{"../render-manager":672,"../render-manager-messages":671,"../utils/vendor-tools":698,"./base-vr-strategy":705,"./vr-manager-messages":706}],710:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DEFINES=void 0;var n,i={DEO_BASE_PATH:(n="https://s3.deovr.com/version/1.7.1/","/"!==n[n.length-1]&&0<n.length?n+"/":n),DEO_BRAND_COLOR:3783397,DEO_BRAND_COLOR_LIGHT:4837372};r.DEFINES=i},{}],711:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=e("../options"),o=e("../misc/global-parameters"),a=(n=e("jquery"))&&n.__esModule?n:{default:n};function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t,r){var n=2<arguments.length&&void 0!==r?r:{};return e&&e.__deo.boot.app&&e.__deo.boot.app.bus.external.dispatchEvent(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(r,!0).forEach(function(e){u(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({type:t},n))}function c(t,r){window.DEO={initialize:function(e){if(!e||"string"!=typeof e.nodeName)throw new Error("Not one of DEO elements given");switch(e.nodeName.toLowerCase()){case"deo-video":t(e);break;case"deo-hub":r(e);break;default:throw new Error("Wrong element type given. <deo-video> or <deo-hub> expected")}},play:function(e){return l(e,i.options.externalEvents.PLAY_PRESS)},pause:function(e){return l(e,i.options.externalEvents.PAUSE_PRESS)},mute:function(e){return l(e,i.options.externalEvents.VOLUME_UPDATED,{volume:0,muted:!0})},setVolume:function(e,t){return l(e,i.options.externalEvents.VOLUME_UPDATED,{volume:t,muted:t<=0})},isStarted:function(e){return!!(0,o.getGlobalParam)(["__deo","boot","app"],e)},isInitialized:function(e){return!!(0,o.getGlobalParam)(["__deo","boot"],e)},start:function(e){return(0,a.default)(e).find(".deo-cover").click()}}}r.default=c},{"../misc/global-parameters":714,"../options":717,jquery:582}],712:[function(e,t,r){"use strict";var n=e("../options"),i=e("../bootstrap/deo-video-bootstrapper");e("babel-polyfill");var o=e("../bootstrap/deo-hub-bootstrapper"),a=e("../defines"),s=c(e("jquery")),u=c(e("./create-deo-user-api")),l=(e("three"),c(e("reqwest")));function c(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.options.colors.orange=a.DEFINES.DEO_BRAND_COLOR,n.options.colors.lightOrange=a.DEFINES.DEO_BRAND_COLOR_LIGHT;function f(o){return function e(t,r){var n=1<arguments.length&&void 0!==r&&r;if("object"!==d(t.__deo)||null===t.__deo){var i=new o(t,{dispatchInitializeEvent:!n});i.onStartup.addOnce(function(){return function(e){p&&p.dispose(),window.__boot=e,p=e}(i)}),i.onDispose.addOnce(function(){t.__deo=null,setTimeout(function(){e(i.root,!0)},0),p=null}),t.__deo={boot:i}}}}function h(){(0,s.default)("deo-video").not("deo-hub deo-video").each(function(e,t){m(t)}),(0,s.default)("deo-hub").each(function(e,t){g(t)}),(0,u.default)(m,g)}var p=null,m=f(i.DeoVideoBootstrapper),g=f(o.DeoHubBootstrapper);"interactive"===document.readyState||"complete"===document.readyState?h():(0,s.default)(window).on("DOMContentLoaded",h),(0,l.default)({url:n.options.api.thirdPartySessions,method:"post",crossOrigin:!0,data:{title:document.title,host:document.location.href,event:"player",sr:window.screen?window.screen.width+"x"+window.screen.height:void 0,vp:window.innerWidth+"x"+window.innerHeight},success:function(e){return 1},error:console.warn})},{"../bootstrap/deo-hub-bootstrapper":626,"../bootstrap/deo-video-bootstrapper":627,"../defines":710,"../options":717,"./create-deo-user-api":711,"babel-polyfill":3,jquery:582,reqwest:609,three:615}],713:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.DataLayer=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,null,[{key:"push",value:function(e){window.dataLayer&&window.dataLayer.push(e)}}]),e}();r.DataLayer=i},{}],714:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getGlobalParam=o,r.getGlobalParamFrom=function(t){return{from:t,get:function(e){return o(e,t)}}};var i=window.vrPlayerSettings;function o(e,t){if(!e)return null;if("string"==typeof e)return o([e],t);if(!t){if(!i)return null;t=i}var r=t[e.shift()],n=null==r;return n?null:0===e.length?n?null:r:o(e,r)}},{}],715:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=i,r.openStaticDeeplink=void 0;var h=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("is_js")),n=e("../bootstrap/deo-video-bootstrapper");function i(e){var t=e.schema,r=void 0===t?"deovr":t,n=e.url,i=void 0===n?void 0:n,o=e.viewAngle,a=void 0===o?180:o,s=e.title,u=void 0===s?"":s,l=e.stereomode,c=void 0===l?"sbs2l":l,d=e.videoSources,f={title:u,viewAngle:a,stereomode:g(c),encodings:[{name:"h264",videoSources:d}]};return i=i||r+"://"+JSON.stringify(f),console.log("Opening ".concat(i)),h.ios()||h.android()?m(i):p(i)}var p=function(o){return new Promise(function(e,t){function r(){i=!0,e()}var n=document.createElement("iframe"),i=!1;try{n.style.display="none",n.src=o,document.body.appendChild(n)}catch(e){document.body.removeChild(n)}finally{setTimeout(function(){window.removeEventListener("blur",r),document.body.removeChild(n),i||t()},450)}window.addEventListener("blur",r)})},m=function(i){return new Promise(function(e,t){window.location.href=i;function r(){n=!0,e()}var n=!1;setTimeout(function(){window.removeEventListener("blur",r),n||t()},700),window.addEventListener("blur",r)})},g=function(e){var t={LR:"sbs",TB:"tb",mono:"off"};return t[e]?t[e]:e};r.openStaticDeeplink=function(e){var t={root:e,showError:console.error};n.DeoVideoBootstrapper.prototype.extractAttributes.call(t);var r=n.DeoVideoBootstrapper.prototype.getSources.call(t).map(function(e){return{url:e.url,resolution:e.quality.replace(/[\D]+/i,"")}});return i({stereomode:t.attrs.get("format"),viewAngle:t.attrs.get("angle"),title:t.attrs.get("title"),videoSources:r})}},{"../bootstrap/deo-video-bootstrapper":627,is_js:580}],716:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.prefixProperties=void 0;r.prefixProperties=function(t,r){return Object.keys(r).forEach(function(e){"string"==typeof r[e]&&(r[e]=t+r[e])}),r}},{}],717:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.options=void 0;var n=e("./misc/global-parameters"),i={api:{tagsURL:"/hub_list/tags",studiosURL:"/hub_list/studios",modelsURL:"/hub_list/models",videosURL:"/hub_list/videos",videoURL:"/hub/video",timeTracker:"/hub_logs/videotracker",login:"/hub_user/login",logout:"/hub_user/logout",userStatus:"/hub_user/status",purchaseVideo:"/hub_payment/video",thirdPartySessions:"https://deovr.com/api_logs/thirdparty"},protocol:{slr:"slrvrapp://videos/%video_id%",deo:"deovr://https://oculus.2.sexlikereal.com/api_public_video/video/id/%video_id%/project/1"},internalEvents:{HIDE_GLOBAL_SPINNER:"hide_global_spinner",TIME_UPDATED:"timeupdate",PLAYING:"playing",PAUSE:"pause",BACK_BUTTON_PRESS:"back_button_press",VOLUME_UPDATED:"volume_update",QUALITE_GRADES_UPDATED:"set_quality_grades",CURRENT_QUALITY_UPDATED:"set_current_quality",VIDEO_ENDED:"video_ended",PREVIEW_VIDEO_UPDATED:"set_preview_video",PREVIEW_TEXTURE_PACK_UPDATED:"set-preview-texture-pack",ADS_PACK_UPDATED:"ads-pack-updated",VIDEO_MOMENTS_UPDATED:"set_video_moments",DEO_ERROR:"deo_error",CAMERA_ROTATION_UPDATED:"camera_rotation_update",CAMERA_MODE_UPDATED:"camera-mode-updated",PROJECTION_MODE_UPDATED:"projection-mode-updated",REQUEST_GET_DEO_MESSAGE:"request-get-deo-message"},externalEvents:{PLAY_PAUSE_PRESS:"play_pause_press",SET_CURRENT_TIME:"set_current_time",VOLUME_UPDATED:"volume_update",BACK_BUTTON_PRESS:"back_button_press",SET_CURRENT_QUALITY:"set_current_quality",PLAY_PRESS:"play_press",PAUSE_PRESS:"pause_press",SET_CAMERA_MODE:"set-camera-mode",TOGGLE_PROJECTION_MODE:"toggle-projection-mode",SET_PROJECTION_MODE:"set-projection-mode",DEEPLINK_CLICKED:"deeplink-clicked"},cornerRadius:5,clickMaxTimeMS:110,animationTimeSlow:500,animationTimeMedium:350,animationTimeFast:200,defaultGazeInputTimeout:2,cacheAssetPacks:!0,sendPlayTimeToTracker:!0,enableMagicWindowWhenSupported:!0,colors:{darkGray:(0,n.getGlobalParam)(["colors","background"])||1644825,lightGray:(0,n.getGlobalParam)(["colors","foreground"])||2631720,orange:(0,n.getGlobalParam)(["colors","accent1"])||16012545,lightOrange:(0,n.getGlobalParam)(["colors","accent2"])||16217110,premiumBlue:3654835,premiumBlueLight:5498835,green:4104193,errorRed:11470085},metersToPixelsRatio:2/1122};r.options=i;if(["192.168.0.101","185.155.19.27","shodiev.ru","localhost","195.170.44.202","s3.deovr.com","ngrok.io"].map(function(e){return window.location.hostname.toLowerCase().indexOf(e)}).some(function(e){return-1<e})){console.info("Using absolute API paths");for(var o in i.api)i.api[o].startsWith("/")&&(i.api[o]="https://slr-hub.dev.signbucks.com"+i.api[o])}},{"./misc/global-parameters":714}],718:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CinemaDEO=void 0;e("three");var n=e("../../core/state/state"),i=(e("../../core/ui/ui-group"),e("../../core/ui/image-element"),e("../../core/assets/asset-pack"),e("../common/reticle"),e("../../core/controls/camera-drag-controls"),e("../../core/ui/text-element"),e("../../core/ui/mask-360"),e("../../core/ui/rect-element"),P(e("@tweenjs/tween.js")),e("./player-controls"),e("../../core/utils/listeners-manager"),e("../common/spinner"),e("../../core/utils/video-controller"),e("../../options")),o=(e("../common/gaze-input-switch"),e("../common/controller-view"),e("../../core/utils/clock"),e("../../misc/global-parameters"),e("../../core/gamepad/gamepad-layout-manager"),e("../../core/controls/camera-magic-window-controls"),e("../../core/utils/vendor-tools"),e("../../core/utils/messenger"),e("../../core/utils/common-tools"),e("./video-surface"),e("./cinema-messages"),e("../../defines")),a=(function(e){{if(e&&e.__esModule)return;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}t.default=e}}(e("is_js")),e("./decorators/load-cinema-assets")),s=e("./decorators/create-cinema-camera"),u=e("./decorators/create-common-elements"),l=e("./decorators/create-video-controller"),c=e("./decorators/create-spinner-layer"),d=e("./decorators/fill-messenger-from-params"),f=e("./decorators/create-mask-layer"),h=e("./decorators/create-camera-controls"),p=(e("./decorators/recenter-cinema-layers"),e("./decorators/create-surface-layer")),m=e("./decorators/create-cinema-ui-layer"),g=e("./decorators/create-player-controls"),v=e("./decorators/create-static-ui-layer"),y=e("./decorators/create-controls-display"),_=e("./decorators/dispose-cinema"),b=e("./decorators/add-video-listeners"),E=e("./decorators/add-external-listeners"),w=e("./decorators/add-gamepad-listeners"),A=e("./decorators/add-local-messenger-listeners"),T=e("./decorators/verify-cinema-params"),S=e("./decorators/dispatch-initial-state"),x=P(e("../../core/assets/preview-texture-pack")),M=P(e("reqwest")),R=P(e("../../core/assets/ads-pack")),O=P(e("./decorators/create-deo-banners"));function P(e){return e&&e.__esModule?e:{default:e}}function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function I(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var k=function(){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),I(this,L(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,n.State),function(e,t,r){t&&D(e.prototype,t),r&&D(e,r)}(t,[{key:"show",value:function(e){T.verifyCinemaParams.call(this,e),this.params=e,this.initCinema(e)}},{key:"initCinema",value:function(e){var t=this;this.app.getService("render-manager").setClearColor(0),this.assetsBasePath=o.DEFINES.DEO_BASE_PATH,u.createCommonElements.call(this),d.fillMessengerFromParams.call(this,this.params),s.createCinemaCamera.call(this),l.createVideoController.call(this),f.createMaskLayer.call(this),c.createSpinnerLayer.call(this),(0,M.default)({url:i.options.api.thirdPartySessions,method:"post",crossOrigin:!0,data:{title:document.title,host:document.location.href,event:"player",sr:window.screen?window.screen.width+"x"+window.screen.height:void 0,vp:window.innerWidth+"x"+window.innerHeight},success:function(e){return 1},error:console.warn}),Promise.all([a.loadCinemaAssets.call(this,this.assetsBasePath),new Promise(function(e){return t.video.onMetadataLoad.addOnce(e)})]).then(function(){return t.onReady()})}},{key:"onReady",value:function(){if(!this._disposed){this.pack.createFont("arial","arial-descriptor",this.pack.getTexture("arial_texture")),h.createCameraControls.call(this),p.createSurfaceLayer.call(this),m.createCinemaUILayer.call(this),g.createPlayerControls.call(this),O.default.call(this),v.createStaticUILayer.call(this),y.createControlsDisplay.call(this),this.bringLayerToFront("mask"),this.bringLayerToFront("spinner"),b.addVideoListeners.call(this),E.addExternalListeners.call(this),w.addGamepadListeners.call(this),A.addLocalMessengerListeners.call(this),this.params["preview-configuration"]&&(this.previewTexturePack=new x.default(this.params["preview-configuration"].sheets,this.params["preview-configuration"].aspect));var e=this.app.getValue("global-params").get("ads");e instanceof R.default&&this.app.bus.internal.dispatchEvent({type:i.options.internalEvents.ADS_PACK_UPDATED,pack:e}),this.app.bus.internal.dispatchEvent({type:i.options.internalEvents.PREVIEW_TEXTURE_PACK_UPDATED,pack:this.previewTexturePack}),this.app.bus.internal.dispatchEvent({type:i.options.internalEvents.HIDE_GLOBAL_SPINNER}),S.dispatchInitialState.call(this)}}},{key:"update",value:function(){this.video&&this.video.onFrameEnter(),this.surface&&this.surface.onFrameEnter(),this.cameraControls&&this.cameraControls.update(),this.magicWindow&&this.magicWindow.update(),this.cameraController&&this.cameraController.update()}},{key:"dispose",value:function(){_.disposeCinema.call(this)}}]),t}();r.CinemaDEO=k},{"../../core/assets/ads-pack":633,"../../core/assets/asset-pack":634,"../../core/assets/preview-texture-pack":640,"../../core/controls/camera-drag-controls":649,"../../core/controls/camera-magic-window-controls":650,"../../core/gamepad/gamepad-layout-manager":652,"../../core/state/state":676,"../../core/ui/image-element":678,"../../core/ui/mask-360":679,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/ui/ui-group":686,"../../core/utils/clock":687,"../../core/utils/common-tools":688,"../../core/utils/listeners-manager":691,"../../core/utils/messenger":693,"../../core/utils/vendor-tools":698,"../../core/utils/video-controller":704,"../../defines":710,"../../misc/global-parameters":714,"../../options":717,"../common/controller-view":750,"../common/gaze-input-switch":753,"../common/reticle":754,"../common/spinner":756,"./cinema-messages":719,"./decorators/add-external-listeners":720,"./decorators/add-gamepad-listeners":721,"./decorators/add-local-messenger-listeners":722,"./decorators/add-video-listeners":723,"./decorators/create-camera-controls":724,"./decorators/create-cinema-camera":725,"./decorators/create-cinema-ui-layer":726,"./decorators/create-common-elements":727,"./decorators/create-controls-display":728,"./decorators/create-deo-banners":729,"./decorators/create-mask-layer":730,"./decorators/create-player-controls":731,"./decorators/create-spinner-layer":732,"./decorators/create-static-ui-layer":733,"./decorators/create-surface-layer":734,"./decorators/create-video-controller":735,"./decorators/dispatch-initial-state":736,"./decorators/dispose-cinema":737,"./decorators/fill-messenger-from-params":738,"./decorators/load-cinema-assets":739,"./decorators/recenter-cinema-layers":740,"./decorators/verify-cinema-params":741,"./player-controls":742,"./video-surface":748,"@tweenjs/tween.js":1,is_js:580,reqwest:609,three:615}],719:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.CinemaMessages=void 0;var n=e("../../misc/prefix-properties"),i={PURCHASE_CONFIRMED:"purchase-confirmed",REQUEST_CONFIRM_PURCHASE_POPUP:"request-confirm-purchase-popup",REQUEST_DELAYED_RECENTER:"request-recenter",PERFORM_RECENTER:"perform-recenter",REQUEST_RETURN_TO_HUB:"request-return-to-hub",UPDATE_CAMERA_SETTINGS:"update-camera-settings",REQUEST_STEREO:"request-stereo",REQUEST_MONO:"request-mono",VIDEO_REPLACE:"video-replace",TOGGLE_DEVTOOLS:"toggle-devtools",SET_LOOP:"set-loop",SET_AB:"set-ab",CANCEL_AB:"cancel-ab",SET_FLAT_PROJECTION:"set-flat",SET_SPHERE_PROJECTION:"set-nonflat",SET_FLAT_PROJECTION_VR:"set-flat-vr",SET_SPHERE_PROJECTION_VR:"set-nonflat-vr",TOGGLE_PROJECTION_MODE:"toggle-flat",TOGGLE_PROJECTION_MODE_VR:"toggle-flat-vr",REQUEST_DRAG_CAMERA_MODE:"request-drag-camera-mode",REQUEST_MAGIC_WINDOW_CAMERA_MODE:"request-magic-camera-mode",REQUEST_AUTO_CAMERA_MODE:"request-auto-mode",OPEN_DEEPLINK:"open-deeplink",OPEN_VIDEO:"open-video"};r.CinemaMessages=i,(0,n.prefixProperties)("cinema:",i)},{"../../misc/prefix-properties":716}],720:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addExternalListeners=function(){function t(e){n&&i.DataLayer.push(e)}var r=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).analytics,n=void 0!==e&&e;this.listenersManager.add(this.app.bus.external,o.options.externalEvents.SET_CAMERA_MODE,function(e){r.app.post("magic window"===e.state?a.CinemaMessages.REQUEST_MAGIC_WINDOW_CAMERA_MODE:a.CinemaMessages.REQUEST_DRAG_CAMERA_MODE)}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.SET_CURRENT_QUALITY,function(e){r.video.setCurrentQuality(e.quality)}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.DEEPLINK_CLICKED,function(e){r.app.post(a.CinemaMessages.OPEN_DEEPLINK)}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.TOGGLE_PROJECTION_MODE,function(e){r.app.post(a.CinemaMessages.TOGGLE_PROJECTION_MODE)}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.SET_PROJECTION_MODE,function(e){var t=e.state;t=t.toLowerCase(),r.app.post("flat"===t?a.CinemaMessages.SET_FLAT_PROJECTION:a.CinemaMessages.SET_SPHERE_PROJECTION)}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.PLAY_PAUSE_PRESS,function(){r.video.paused?(r.video.play(),t({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:r.wasVideoLaunched?"Continue":"Play",webVRlabel:r.params.title})):(r.video.pause(),t({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:"Pause",webVRlabel:r.params.title}))}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.VOLUME_UPDATED,function(e){var t=e.volume;r.video.volume=t,r.video.muted=e.muted}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.SET_CURRENT_TIME,function(e){r.video.currentTime=e.relativeTime*r.video.duration,t({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:"Seeking",webVRlabel:r.params.title})}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.PAUSE_PRESS,function(e){r.video.pause(),t({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:e.customEvent||"Pause",webVRlabel:r.params.title})}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.PLAY_PRESS,function(){r.video.play(),t({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:r.wasVideoLaunchedBefore?"Continue":"Play",webVRlabel:r.params.title})}),this.listenersManager.add(this.app.bus.external,o.options.externalEvents.BACK_BUTTON_PRESS,function(){r.mask.fadeIn(function(){r.app.getService("state-manager").show("hub")})})};var i=e("../../../misc/data-layer"),o=e("../../../options"),a=e("../cinema-messages")},{"../../../misc/data-layer":713,"../../../options":717,"../cinema-messages":719}],721:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addGamepadListeners=function(){var e=this;this.listenersManager.add(this.app.getService("input-manager").gamepad.layout,n.GamepadAction.MUTE,function(){0<e.video.volume?(e.app.storage.set("prevVolume",e.video.volume),e.video.volume=0):e.video.volume=e.app.storage.get("prevVolume",1)}),this.listenersManager.add(this.app.getService("input-manager").gamepad.layout,n.GamepadAction.FORWARD,function(){e.video.currentTime=Math.min(e.video.duration,e.video.currentTime+10),e.video.paused&&e.video.play()}),this.listenersManager.add(this.app.getService("input-manager").gamepad.layout,n.GamepadAction.BACKWARD,function(){e.video.currentTime=Math.min(e.video.duration,e.video.currentTime-10),e.video.paused&&e.video.play()}),this.listenersManager.add(this.app.getService("input-manager").gamepad.layout,n.GamepadAction.PLAY_PAUSE,function(){e.video.paused?e.video.play():e.video.pause()})};var n=e("../../../core/gamepad/gamepad-layout-manager")},{"../../../core/gamepad/gamepad-layout-manager":652}],722:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addLocalMessengerListeners=function(){var n=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).analytics,t=void 0!==e&&e;this.listenersManager.subscribe(this.app,i.CinemaMessages.REQUEST_RETURN_TO_HUB,function(){n.mask.fadeIn(function(){n.app.bus.internal.dispatchEvent({type:s.options.internalEvents.BACK_BUTTON_PRESS}),n.app.getService("state-manager").show("hub")}),t&&a.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:"Hub Button",webVRlabel:n.params.title})}),this.listenersManager.subscribe(this.app,i.CinemaMessages.REQUEST_DELAYED_RECENTER,function(e){return t&&a.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Interface",webVRAction:"Recenter",webVRlabel:"interface"}),new Promise(function(t){var r=n.camera;setTimeout(function(){var e=Math.abs(r.rotation.z)<Math.PI/2?r.rotation.y:Math.PI-r.rotation.y;n.app.post(i.CinemaMessages.PERFORM_RECENTER,{angle:e}),t()},e.timeout||1200)}).then(function(){e.callback&&e.callback()})}),this.listenersManager.subscribe(this.app,i.CinemaMessages.PERFORM_RECENTER,function(e){var t=e.angle;"number"!=typeof t||isNaN(t)||(o.recenterCinemaLayers.call(n,t),n.app.storage.set("recenter_angle",t))}),this.listenersManager.subscribe(this.app,u.VideoSurfaceMessages.PROJECTION_MODE_UPDATE,function(){n.app.storage.set("projection",n.surface.isFlat?"flat":"sphere").save(),n.app.bus.internal.dispatchEvent({type:s.options.internalEvents.PROJECTION_MODE_UPDATED,state:n.surface.isFlat?"flat":"sphere"})}),this.listenersManager.subscribe(this.app,l.CameraControllerMessages.CAMERA_MODE_CHANGE,function(){n.app.bus.internal.dispatchEvent({type:s.options.internalEvents.CAMERA_MODE_UPDATED,state:n.cameraController.currentMode})}),this.listenersManager.subscribe(this.app,i.CinemaMessages.OPEN_DEEPLINK,function(e){var t=e.showPopup,r=n.app;(0,c.default)({title:r.getValue("video-title"),stereomode:r.getValue("video-format"),viewAngle:r.getValue("video-angle"),videoSources:r.getValue("video-src").map(function(e){var t=e.quality;return{url:e.url,resolution:t.replace(/[\D]+/i,"")}})}).catch(function(e){!1!==t&&r.bus.internal.dispatchEvent({type:s.options.internalEvents.REQUEST_GET_DEO_MESSAGE})})}),this.listenersManager.subscribe(this.app,i.CinemaMessages.OPEN_VIDEO,function(e){n.mask.fadeIn(),setTimeout(function(){e.id?(console.log("Going to suggested #"+e.id),n.app.getService("state-manager").show("cinema",{id:e.id})):console.warn("Can not open video, not enough data: ",e)},100)}),window.af=function(){return n.app.post(i.CinemaMessages.OPEN_DEEPLINK)}};var n,i=e("../cinema-messages"),o=e("./recenter-cinema-layers"),a=e("../../../misc/data-layer"),s=e("../../../options"),u=e("../video-surface"),l=e("../../../core/controls/camera-controller"),c=(n=e("../../../misc/open-deeplink"))&&n.__esModule?n:{default:n}},{"../../../core/controls/camera-controller":648,"../../../misc/data-layer":713,"../../../misc/open-deeplink":715,"../../../options":717,"../cinema-messages":719,"../video-surface":748,"./recenter-cinema-layers":740}],723:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addVideoListeners=function(){var r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.saveQuality2D,n=void 0===t||t,i=e.saveQualityVR,o=void 0===i||i;this.listenersManager.add(this.video,"playing",function(e){r.app.bus.internal.dispatchEvent({type:"playing",sourceEvent:e})}),this.listenersManager.add(this.video,"ended",function(){r.app.bus.internal.dispatchEvent({type:a.options.internalEvents.VIDEO_ENDED,fullVideo:r.params.fullVideo})}),this.listenersManager.add(this.video,"pause",function(e){r.app.bus.internal.dispatchEvent({type:"pause",sourceEvent:e})}),this.wasVideoLaunched=!1,this.listenersManager.add(this.video,"timeupdate",function(e){0<r.video.currentTime&&(r.wasVideoLaunched=!0),r.app.bus.internal.dispatchEvent({type:a.options.internalEvents.TIME_UPDATED,buffered:r.video.buffered,currentTime:r.video.currentTime,duration:r.video.duration,sourceEvent:e})}),this.listenersManager.add(this.video,"volumechange",function(){r.app.storage.set("volume",r.video.volume),r.app.storage.save(),r.app.bus.internal.dispatchEvent({type:a.options.internalEvents.VOLUME_UPDATED,volume:r.video.volume})}).call(this),this.listenersManager.binding(this.video.onQualityChange,function(e){r.app.bus.internal.dispatchEvent({type:a.options.internalEvents.CURRENT_QUALITY_UPDATED,quality:r.video.currentQuality});var t=r.app.getValue("is-presenting-to-device");(t&&o||!t&&n)&&(r.app.storage.set("quality",r.video.currentQuality),r.app.storage.save())}).call(this)};var a=e("../../../options")},{"../../../options":717}],724:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createCameraControls=function(){this.cameraController=new n.CameraController(this.app,this.camera)};e("../../../core/controls/camera-drag-controls"),e("../../../core/controls/camera-magic-window-controls"),e("../../../options"),e("../../../core/utils/vendor-tools");var n=e("../../../core/controls/camera-controller")},{"../../../core/controls/camera-controller":648,"../../../core/controls/camera-drag-controls":649,"../../../core/controls/camera-magic-window-controls":650,"../../../core/utils/vendor-tools":698,"../../../options":717}],725:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createCinemaCamera=function(){var t=this;this.camera=function(){var e=new n.PerspectiveCamera(90);return e.far=15e3,e.fov=90,e.updateProjectionMatrix(),t.app.getService("input-manager").setCamera(e),e}()};var n=e("three")},{three:615}],726:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createCinemaUILayer=function(){this.createLayer("ui",{camera:this.camera,overrideDepthTest:!1,sortObjects:!1}).scene.scale.multiplyScalar(n.options.metersToPixelsRatio)};var n=e("../../../options")},{"../../../options":717}],727:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createCommonElements=function(){this.tweenGroup=new n.Group,this.listenersManager=new i.ListenersManager};var n=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("@tweenjs/tween.js")),i=(e("../../../core/utils/messenger"),e("../../../core/utils/listeners-manager"))},{"../../../core/utils/listeners-manager":691,"../../../core/utils/messenger":693,"@tweenjs/tween.js":1}],728:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createControlsDisplay=function(e){if("string"!=typeof(e=e||this.assetsBasePath))throw new Error("create-controls-display: wrong basepath error");var t=this.createLayer("top",{}),r=this.reticle=new n.Reticle(this.app);r.shouldBeVisible=!1,t.scene.add(r),this.controllerView=new i.ControllerView(this.app,this.assetsBasePath),this.controllerView.shouldBeVisible=!1,t.scene.add(this.controllerView),t.enabled=!1};var n=e("../../common/reticle"),i=e("../../common/controller-view")},{"../../common/controller-view":750,"../../common/reticle":754}],729:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){var r=this.app.getValue("global-params").get("ads");if(!r||!r.bannerCycle.exists())return;var n=this.app,e=this.getLayer("ui"),t=new s.UIGroup(this.app);t.position.copy(this.uiGroup.position),e.scene.add(t);function i(e){var t=new a.default({ads:r,font:o,app:n});return t.position.x=-343,t.position.x*=e,t}var o=this.pack.getFont("arial");1<r.bannerCycle.count()?(t.add(i(-1)),t.add(i(1))):t.add(i(0));t.position.y=-284-t.children[0].height/2};var n,a=(n=e("../../common/banner"))&&n.__esModule?n:{default:n},s=e("../../../core/ui/ui-group")},{"../../../core/ui/ui-group":686,"../../common/banner":749}],730:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createMaskLayer=function(){var e=this.createLayer("mask",{overrideDepthTest:!1});this.mask=new n.Mask360(0).fadeOut(),e.scene.add(this.mask)};var n=e("../../../core/ui/mask-360")},{"../../../core/ui/mask-360":679}],731:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createPlayerControls=function(){var r=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).noSLR,t=void 0===e||e,n=this.getLayer("ui"),i=[];this.params.studio&&i.push(this.params.studio);this.params.title&&i.push(this.params.title);var o=this.uiGroup=new u.PlayerControls(this.app,{video:this.video,videoTitle:i.join(" - "),fullVideo:this.params.fullVideo,videoId:this.params.id,videoPrice:this.params.price,pack:this.pack,alwaysShow:!1,qualityGrades:this.video.qualityGrades,noSLR:t});if(o.position.set(0,-0,-1599),this.listenersManager.binding(o.onShow,function(){if(n.enabled=!0,r.getLayer("top").enabled=!0,r.app.getService("input-manager").gaze.enabled){n.scene.rotation.set(0,0,0);var e=r.getLayer("popup");e&&e.scene.rotation.set(0,0,0)}else{n.scene.quaternion.copy(r.camera.quaternion);var t=r.getLayer("popup");t&&t.scene.quaternion.copy(r.camera.quaternion)}r.reticle&&(r.reticle.shouldBeVisible=!0),r.controllerView.shouldBeVisible=!0,r.surface.setMono()},this),this.listenersManager.binding(o.onHide,function(){n.enabled=!1,r.reticle&&(r.reticle.shouldBeVisible=!1),r.controllerView.shouldBeVisible=!1,r.getLayer("top").enabled=!1,r.surface.setStereo()},this),this.listenersManager.binding(o.onQualitySelect,function(e){r.video.setCurrentQuality(e)},this),window.allowui=function(){return o.alwaysShow=!0},n.scene.add(o),n.enabled=!1,setTimeout(function(){o.show()},150),this.params.relatedScenes){var a=this.params.relatedScenes.map(function(e){return{src:e.posterURL,title:e.title,id:e.id}}),s=new l.default({font:this.pack.getFont("arial"),messenger:this.app,data:a});o.add(s),s.position.x-=980,s.position.y-=170,s.position.z+=100,s.rotation.y=Math.PI/6}};var n,u=e("../player-controls"),l=(n=e("../suggested-window"))&&n.__esModule?n:{default:n}},{"../player-controls":742,"../suggested-window":747}],732:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createSpinnerLayer=function(){var e=this,t=this.createLayer("spinner",{camera:this.camera,overrideDepthTest:!1}),r=this.spinner=new n.Spinner({scale:.028,spinnerColor:i.options.colors.lightOrange,spinnerOpacity:1}).show();r.position.z=-5,t.scene.add(r),this.listenersManager.binding(this.video.onReady,function(){return e.spinner.hide()}),this.listenersManager.binding(this.video.onStartWaiting,function(){return e.spinner.show()}),r.hide()};var n=e("../../common/spinner"),i=e("../../../options")},{"../../../options":717,"../../common/spinner":756}],733:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createStaticUILayer=function(){var r=this,e=this.createLayer("staticui",{camera:this.camera,overrideDepthTest:!1,sortObjects:!1}),n=this.uiGroup;e.scene.scale.multiplyScalar(u.options.metersToPixelsRatio);var i=new a.UIGroup(this.app);i.position.set(0,-0,-950),e.scene.add(i),function(){var e=new o.GazeInputSwitch(r.app,{texture:r.pack.getTexture("toggle_controls_switch"),defaultVisibilityCheck:!1,camera:r.camera});e.setCallback(function(){r.uiGroup.toggle()}),i.add(e),e.position.set(0,0,-n.position.z),e.rotateY(Math.PI/2),e.translateZ(i.position.z);function t(){e.visible=r.app.getService("input-manager").gaze.enabled&&r.app.isPresentingToDevice()}r.listenersManager.binding(r.app.getService("input-manager").gaze.onStateChange,t),r.listenersManager.subscribe(r.app,l.default.VR_MODE_CHANGE,t),t()}(),function(){var e=new o.GazeInputSwitch(r.app,{texture:r.pack.getTexture("gaze_input_switch"),camera:r.camera});i.add(e),e.position.set(0,0,-n.position.z),e.rotateY(-Math.PI/2),e.translateZ(n.position.z);var t=new s.ImageElement(r.pack.getTexture("enabled_icon")).centerAnchor().markAsNonInput().setPos(0,-130,0);e.add(t),r.listenersManager.binding(e.onInvoke,function(){t.visible=r.app.getService("input-manager").gaze.enabled}).call(r)}()};var n,o=e("../../common/gaze-input-switch"),a=e("../../../core/ui/ui-group"),s=e("../../../core/ui/image-element"),u=e("../../../options"),l=(n=e("../../../core/vr/vr-manager-messages"))&&n.__esModule?n:{default:n}},{"../../../core/ui/image-element":678,"../../../core/ui/ui-group":686,"../../../core/vr/vr-manager-messages":706,"../../../options":717,"../../common/gaze-input-switch":753}],734:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createSurfaceLayer=function(){var e=this.createLayer("main",{camera:this.camera});this.surface=new i.VideoSurface(this.app,this.params.format,this.params.angle,this.video.material,this.video.videoAspect,this.camera),e.scene.add(this.surface.leftEquirectMesh),e.scene.add(this.surface.rightEquirectMesh),e.scene.add(this.surface.leftFlatMesh),e.scene.add(this.surface.rightFlatMesh),this.camera.layers.enable(1),this.camera.position.set(0,0,0),this.camera.lookAt(0,0,-10);var t=this.app.getService("render-manager"),r=t._renderer.getContext(),n=!0;this.listenersManager.binding(this.video.onStartWaiting,function(){n=!1}),this.listenersManager.binding(this.video.onReady,function(){n=!0}),t.isWebGL2&&this.listenersManager.binding(e.onBeforeRender,function(){n&&r.invalidateFramebuffer(r.FRAMEBUFFER,[r.COLOR,r.DEPTH])});this.videoTexture.onUpdate=function(){n&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)}};var i=e("../video-surface")},{"../video-surface":748}],735:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createVideoController=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=e.dispatchEvent,n=void 0===r||r,i=e.isSLR,o=void 0!==i&&i,a=e.strategySelector,s=this.params,u=o?"1080p":h.iphone()||h.ipad()||h.ios()?"1080p":"1440p",l=o?"144p":"1080p",c=o?void 0:"10000p";g.VendorTools.isStandaloneHmd()&&(u="1920p");var d=this.video=new f.VideoController(this.app,s.autoplay,1,a).setQualities(s.src,this.app.storage.get("quality",u),l,c);this.videoElement=d.element,this.videoTexture=d.texture,this.videoMaterial=this.video.material,this.qualityGrades=this.video.qualityGrades,d.volume=this.app.storage.get("volume",1),n&&this.app.bus.internal.dispatchEvent({type:p.options.internalEvents.QUALITE_GRADES_UPDATED,quality:this.video.qualityGrades});o&&(this.listenersManager.subscribe(this.app,m.AppMessages.PRESENTING_START,function(){t.app.getService("loop-manager").setFPSLimit(-1);var e=t.app.storage.get("quality","");h.ios()||d.setClosestQuality(e||"999999p")}),this.listenersManager.subscribe(this.app,m.AppMessages.PRESENTING_EXIT,function(){t.app.getService("loop-manager").setFPSLimit(30),h.ios()||d.setClosestQuality("1080p")}))};var f=e("../../../core/utils/video-controller"),h=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("is_js")),p=e("../../../options"),m=e("../../../core/app-messages"),g=e("../../../core/utils/vendor-tools")},{"../../../core/app-messages":631,"../../../core/utils/vendor-tools":698,"../../../core/utils/video-controller":704,"../../../options":717,is_js:580}],736:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.dispatchInitialState=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).forceFlatIn2D,t=void 0!==e&&e,r=this.app.isPresentingToDevice();this.app.post(o.AppMessages.PRESENTING_STATE_CHANGE,{presenting:r}),this.app.post(!0===this.params.flat?a.CinemaMessages.SET_FLAT_PROJECTION_VR:a.CinemaMessages.SET_SPHERE_PROJECTION_VR);var n=this.app.storage.get("projection",null);n?this.app.post("flat"===n?a.CinemaMessages.SET_FLAT_PROJECTION:a.CinemaMessages.SET_SPHERE_PROJECTION):t?this.app.post(200<this.params.angle?a.CinemaMessages.SET_SPHERE_PROJECTION:a.CinemaMessages.SET_FLAT_PROJECTION):this.app.post(!0===this.params.flat?a.CinemaMessages.SET_FLAT_PROJECTION:a.CinemaMessages.SET_SPHERE_PROJECTION);var i=this.app.storage.get("recenter_angle",null);null===i?this.app.post(a.CinemaMessages.REQUEST_DELAYED_RECENTER,{timeout:500}):this.app.post(a.CinemaMessages.PERFORM_RECENTER,{angle:i||0});this.app.post(a.CinemaMessages.REQUEST_AUTO_CAMERA_MODE),"drag"===this.params["camera-controls"]?this.app.post(a.CinemaMessages.REQUEST_DRAG_CAMERA_MODE):this.app.post(a.CinemaMessages.REQUEST_AUTO_CAMERA_MODE)};var o=e("../../../core/app-messages"),a=e("../cinema-messages")},{"../../../core/app-messages":631,"../cinema-messages":719}],737:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.disposeCinema=function(){this.messenger&&this.messenger.dispose();this.listenersManager&&this.listenersManager.dispose();this.video&&this.video.dispose();this.surface&&this.surface.dispose();this.cameraControls&&this.cameraControls.dispose();this.magicWindow&&this.magicWindow.dispose();this.cameraController&&this.cameraController.dispose();!n.options.cacheAssetPacks&&this.pack&&this.pack.dispose()};var n=e("../../../options")},{"../../../options":717}],738:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fillMessengerFromParams=function(e){this.app.registerValue("is-full-video",0<parseInt(e.fullVideo)),this.app.registerValue("video-title",e.title),this.app.registerValue("video-duration",e.duration),this.app.registerValue("preview-src",e.rewindVideo),this.app.registerValue("video-price",e.price),this.app.registerValue("video-angle",e.angle),this.app.registerValue("video-format",e.format),this.app.registerValue("video-src",e.src)}},{}],739:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.loadCinemaAssets=void 0;var n=e("../../../core/assets/asset-pack");r.loadCinemaAssets=function(e){var t=this,r=0<arguments.length&&void 0!==e?e:"";return new Promise(function(e){var t=new n.AssetPack(function(){return e(t)});t.loadAtlas(r+"assets/ui/cinema/cinema_atlas","main_atlas"),t.loadFile(r+"assets/arial.fnt","arial-descriptor"),t.start()}).then(function(e){return t.pack=e})}},{"../../../core/assets/asset-pack":634}],740:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.recenterCinemaLayers=function(e,t){t=t||["ui","staticui","main","spinner"];var r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=this.getLayer(s);u&&u.scene&&(u.scene.rotation.y=e)}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}this.camera.rotation.y=e}},{}],741:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.verifyCinemaParams=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.autoplay="boolean"!=typeof e.autoplay||e.autoplay,"boolean"==typeof e.loop&&this.app.storage.set("loop-enabled",e.loop);if(!(e.src&&Array.isArray(e.src)||"number"==typeof e.id&&t))throw"Expected params with src property"}},{}],742:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PlayerControls=void 0;var p=e("three"),i=(e("../../core/ui/ui-group"),e("../../core/assets/asset-pack")),m=u(e("@tweenjs/tween.js")),g=(e("../../core/utils/listeners-manager"),e("../../core/ui/nine-slice-element")),v=e("../../core/ui/text-element"),y=e("../../core/ui/image-element"),_=e("../../core/ui/progress-bar"),b=e("../../core/ui/rect-element"),E=e("../../core/ui/button-element"),w=e("./quality-selector"),A=e("../../options"),T=(e("../../core/input/input-event-source"),e("../../core/utils/clock"),e("../../core/components/basic-button-component")),S=e("../../core/components/tint-button-component"),x=e("../../misc/data-layer"),M=(e("../../misc/global-parameters"),n(e("is_js"))),R=e("../../core/components/text-over-ui-component"),O=(e("../../core/utils/messenger"),e("../common/slider")),P=(e("../../core/utils/common-tools"),e("../../core/ui/ui-dummy"),e("./preview-box")),o=n(e("signals")),C=e("./cinema-messages"),a=u(e("./pop-on-input-group")),D=u(e("./settings-window")),s=u(e("../../core/vr/vr-manager-messages"));function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function f(e,t,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(){function n(e,t){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),!(t.pack&&t.pack instanceof i.AssetPack))throw"params.pack should be instance of AssetPack";if(!t.video)throw"params.video should be a HTMLMediaElement";return(r=d(this,h(n).call(this,e,t))).pack=t.pack,r.video=t.video,r.onQualitySelect=new o.Signal,r.create(),r.setupListeners(),r.updateVolume(),r.visible=r.inputEnabled=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(n,a.default),function(e,t,r){t&&c(e.prototype,t),r&&c(e,r)}(n,[{key:"create",value:function(){var e,t,r,n,i,f=this,o=this.app;this.add(new g.NineSliceElement(this.pack.getTexture("backdrop"),10,10,10,10).setSize(1342,508).centerAnchor().setAlpha(.75).markAsInputBlocker()),e=new v.TextElement(f.pack.getFont("arial")).setText(f.params.videoTitle||"").setSize(35).setAlign("left").setRelativeAnchor(0,0).markAsNonInput().setPos(-628,-3,0),f.add(e),t=f.timeText=new v.TextElement(f.pack.getFont("arial")).setText("00:00 / 00:00").setSize(35).setAlign("right").setRelativeAnchor(1,0).markAsNonInput().setPos(628,-3,0),f.add(t),function(){var e=f.barBackground=new y.ImageElement(f.pack.getTexture("bar")).setAlpha(.5).centerAnchor().setPos(0,-69,0);f.add(e);var r=f.bar=new _.ProgressBar(f.pack.getTexture("bar")).setPos(0,0,0).setProgress(1).centerAnchor().markAsNonInput();e.add(r),f.listenerManager.binding(e.pointerSignals.up,function(e){if(e.worldPoint){r.worldToLocal(e.worldPoint);var t=(e.worldPoint.x+r.width/2)/r.width;t=Math.max(0,Math.min(1,t)),f.video.currentTime=f.video.duration*t,x.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:"Seeking",webVRlabel:f.params.videoTitle})}},f)}(),function(){var e=f.volumeBar=new O.Slider(f.app,f.pack.getTexture("volume_bar_bg"),{overlay:f.pack.getTexture("volume_bar")});e.onChange.add(function(e){f.video.volume=e,x.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Interface",webVRAction:"Volume Change",webVRlabel:f.params.videoTitle})}),e.setPos(-419-e.width/2,-203-e.height/2),f.add(e);var t=f.volumeIcon=new E.ButtonElement(f.pack.getTexture("volume_icon")).centerAnchor().setPos(-609,-203).setCallback(function(e){x.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Interface",webVRAction:"Mute Button",webVRlabel:f.params.videoTitle}),0<f.video.volume?(f.app.storage.set("prevVolume",f.video.volume),f.video.volume=0):f.video.volume=f.app.storage.get("prevVolume",1)});f.add(t)}(),function(){var e,t;e=f.params.qualityGrades,(t=f.qualitySelector=new w.QualitySelector({list:e,getCurrent:function(){return f.video.currentQuality},border:10,font:f.pack.getFont("arial"),backgroundTexture:f.pack.getTexture("backdrop"),buttonTexture:f.pack.getTexture("quality_button"),buttonTextureActive:f.pack.getTexture("quality_button_active")})).updateButtons(),t.setPos(449,230,0),f.add(t),f.listenerManager.binding(t.onShow,function(e){new m.default.Tween(r.scale,f.tweenGroup).to({x:1.15,y:1.15},500).easing(m.default.Easing.Quintic.Out).start()}),f.listenerManager.binding(t.onHide,function(e){new m.default.Tween(r.scale,f.tweenGroup).to({x:1,y:1},500).easing(m.default.Easing.Quintic.Out).start()}),t.onSelect.add(function(e){n.setText(e),f.video.setCurrentQuality(e)},f);var r=f.qualityButton=new E.ButtonElement(f.pack.getTexture("quality_selector_button")).centerAnchor().setPos(518,133).setCallback(function(e){x.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Interface",webVRAction:"Resolution Button",webVRlabel:f.params.videoTitle}),f.qualitySelector.toggle()});f.add(r);var n=new v.TextElement(f.pack.getFont("arial")).setText(f.video.currentQuality).setSize(38).setPos(0,-4,0).setRelativeAnchor(!0,!0).markAsNonInput();r.add(n),f.listenerManager.add(f.app.bus.external,A.options.externalEvents.SET_CURRENT_QUALITY,function(e){n.setText(f.video.currentQuality),f.qualitySelector.updateButtons()}),f.listenerManager.add(f.app.bus.internal,A.options.internalEvents.CURRENT_QUALITY_UPDATED,function(e){return n.setText(e.quality)})}(),function(){function e(){return r.setAlpha(t?.7:.35)}var t=f.app.storage.get("loop-enabled",!1),r=new y.ImageElement(f.pack.getTexture("loop_icon")).centerAnchor().setPos(333,161).addComponent(new T.BasicButtonComponent(function(){t=!t,f.app.storage.set("loop-enabled",t),e(),f.app.post(C.CinemaMessages.SET_LOOP,t)}));setTimeout(function(){return f.app.post(C.CinemaMessages.SET_LOOP,t)},0);function n(){null!==i?(s.setAlpha(void 0!==i.end?.7:.35),o.visible=void 0!==i.start,a.visible=void 0!==i.end,void 0!==i.start&&(o.position.x=f.bar.position.x-f.bar.width/2+f.bar.width*(i.start/f.video.element.duration)),void 0!==i.end&&(a.position.x=f.bar.position.x-f.bar.width/2+f.bar.width*(i.end/f.video.element.duration))):(s.setAlpha(.35),o.visible=a.visible=!1)}var i=null,o=new y.ImageElement(f.pack.getTexture("a_icon")).setPos(0,f.barBackground.position.y).setAnchorRelative(1,.5).markAsNonInput(),a=new y.ImageElement(f.pack.getTexture("b_icon")).setPos(0,f.barBackground.position.y).setAnchorRelative(0,.5).markAsNonInput(),s=new y.ImageElement(f.pack.getTexture("ab_icon")).centerAnchor().setPos(333,105).addComponent(new T.BasicButtonComponent(function(){!function(e){null===i?i={start:e}:void 0===i.end?i.start>=e?i.start=e:(i.end=e,f.app.post(C.CinemaMessages.SET_AB,i)):(i=null,f.app.post(C.CinemaMessages.CANCEL_AB))}(f.video.element.currentTime),n()}));e(),n(),f.add(r),f.add(s),f.add(o),f.add(a)}(),r=f.play=new E.ButtonElement(f.pack.getTexture("play")).centerAnchor().setPos(0,133).setCallback(function(e){f.video.paused?(f.video.play(),x.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:"Continue",webVRlabel:f.params.videoTitle})):(f.video.pause(),x.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:"Pause",webVRlabel:f.params.videoTitle}))}),f.add(r),n=f.forward=new E.ButtonElement(f.pack.getTexture("forward")).centerAnchor().setPos(182,133).setCallback(function(e){f.video.currentTime=Math.min(f.video.duration,f.video.currentTime+10),x.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:"Seeking",webVRlabel:f.params.videoTitle}),f.video.paused&&f.video.play()}),f.add(n),i=f.backward=new E.ButtonElement(f.pack.getTexture("backward")).centerAnchor().setPos(-182,133).setCallback(function(e){f.video.currentTime=Math.max(0,f.video.currentTime-10),x.DataLayer.push({event:"webVREvent",webVRCategory:"webVR Video",webVRAction:"Seeking",webVRlabel:f.params.videoTitle}),f.video.paused&&f.video.play()}),f.add(i);var a,s,u,l=!0===o.getValue("global-params").get(["hubOptions","disable"]);if(a=f.recenterButton=new E.ButtonElement(f.pack.getTexture("recenter")).centerAnchor().setPos(156*(l?0:1)-542,133).setCallback(function(e){var t=f.recenterMessage;t.alpha=0,t.visible=!0,new m.default.Tween(t,f.tweenGroup).to({alpha:1},500).easing(m.default.Easing.Quintic.Out).start(),f.app.post(C.CinemaMessages.REQUEST_DELAYED_RECENTER,{callback:function(){return t.visible=!1}})}),f.add(a),function(){if(!l){var e=f.hubbutton=new E.ButtonElement(f.pack.getTexture("hub")).setCallback(function(e){return f.app.post(C.CinemaMessages.REQUEST_RETURN_TO_HUB)}).centerAnchor().setPos(-542,133);f.add(e)}}(),(s=f.recenterMessage=new b.RectElement(800,200,1).centerAnchor()).add(new v.TextElement(f.pack.getFont("arial")).setText("Recentering...").setRelativeAnchor(!0,!0).setAlign("center").setSize(50).setPos(0,10,100)),s.visible=!1,f.add(s),function(){if(!f.params.noSLR){var e=new b.RectElement(1042,250,0).setCornerRadius(A.options.cornerRadius).centerAnchor().setPos(-150,-405,0).setAlpha(.75).markAsNonInput();f.add(e),e.add(new v.TextElement(f.pack.getFont("arial")).setText("For much better quality watch this video\nin SLR app or DeoVR").setLineHeight(75).setSize(55).setRelativeAnchor(.5,.5).setPos(-9,30).setAlign("center").markAsNonInput());var t=function(t){return function(){var e=f.app;e.getService("render-manager").isPresentingToDevice()?e.getService("render-manager").toggleVRMode().then(function(){window.location.replace(t)}):window.location.replace(t)}},r=new b.RectElement(270,110,6853334).centerAnchor().setPos(536,e.position.y+125-55).setCornerRadius(A.options.cornerRadius).addComponent((new S.TintButtonComponent).setCallback(t("https://sexlikereal.com/app")).setColors(14365184,16729615)).add(new v.TextElement(f.pack.getFont("arial")).setSize(45).setText("SLR APP").setRelativeAnchor(!0,!0).markAsNonInput().setPos(0,6));f.add(r);var n=new b.RectElement(270,110,14065768).centerAnchor().setPos(536,e.position.y+125-110-30-55).setCornerRadius(A.options.cornerRadius).addComponent((new S.TintButtonComponent).setCallback(t("https://deovr.com")).setColors(44283,2143737)).add(new v.TextElement(f.pack.getFont("arial")).setSize(45).setText("DEO VR").setRelativeAnchor(!0,!0).markAsNonInput().setPos(0,6));f.add(n)}}(),u=new g.NineSliceElement(f.pack.getTexture("border_button_texture"),10,10,10,10).setSize(200,80).centerAnchor().setPos(526,-169).addComponent(new R.TextOverUIComponent("Options",f.pack.getFont("arial")).setSize(40).setPos(0,7)).addComponent(new S.TintButtonComponent(function(){f.settingsGroup.visible?f.settingsGroup.hide():f.settingsGroup.show()}).setColors(12303291,16777215)),f.add(u),!0===o.getValue("global-params").get("enableVideoPurchase")&&"number"==typeof this.params.videoPrice){var c=new b.RectElement(200,80,16711680).centerAnchor().setCornerRadius(A.options.cornerRadius).setPos(311,-169).addComponent(new S.TintButtonComponent(function(){f.app.post(C.CinemaMessages.REQUEST_CONFIRM_PURCHASE_POPUP)}).setColors(A.options.colors.orange,A.options.colors.lightOrange,A.options.colors.lightOrange)).addComponent(new R.TextOverUIComponent("$"+this.params.videoPrice,this.pack.getFont("arial")).setSize(40).setPos(0,5)),d=function(){c.getComponentByType(R.TextOverUIComponent).setText("Got it!"),c.removeComponent(c.getComponentByType(S.TintButtonComponent)),c.setColor(4104193),c.inputEnabled=!1};this.params.fullVideo&&d(),this.listenerManager.subscribe(this.app,C.CinemaMessages.PURCHASE_CONFIRMED,d),this.add(c)}!function(){if(!M.mobile()||!0===o.getValue("global-params").get(["playerOptions","enableMobilePreview"])){var e=f.app.getValue("preview-src","");if(e){var r=f.previewBox=new P.PreviewBox(e);f.app.bus.internal.dispatchEvent({type:A.options.internalEvents.PREVIEW_VIDEO_UPDATED,video:r.video}),f.add(r),f.barBackground.pointerSignals.move.add(function(e){var t=(f.barBackground.worldToLocal(e.worldPoint.clone()).x+f.barBackground.anchor.x)/f.barBackground.width;r.show(t),r.position.x=f.barBackground.position.x+f.barBackground.width*(t-.5),r.position.y=f.barBackground.position.y+20,r.position.z=10}),f.barBackground.pointerSignals.out.add(function(e){r.hide()})}}}(),function(){var e=new p.MeshBasicMaterial({color:16777215});f.getMomentsGeometry=function(e){if(e&&0!=e.length){for(var t=new p.BufferGeometry,r=[],n=[],i=f.barBackground.height,o=0;o<e.length;o++){var a=I(e[o],2),s=(a[0],(a[1]-.5)*f.barBackground.width);r.push(s-5,0,0),r.push(5+s,0,0),r.push(5+s,i,0),r.push(s-5,i,0),n.push(4*o,4*o+1,4*o+2),n.push(4*o,4*o+2,4*o+3)}return t.addAttribute("position",new p.Float32BufferAttribute(r,3)),t.setIndex(n),t.computeVertexNormals(),t}},f.moments=void 0;f.momentsMesh=new p.Mesh(void 0,e),f.momentsMesh.position.copy(f.barBackground.position),f.momentsMesh.position.y-=f.barBackground.height/2,f.add(f.momentsMesh),f.updateMoments(f.moments);var c=new b.RectElement(170,55,0).setPos(0,0,10).markAsNonInput().setAlpha(.8).centerAnchor(),d=new v.TextElement(f.pack.getFont("arial")).markAsNonInput().setPos(0,5).setSize(35).setRelativeAnchor(!0,!0);c.visible=!1,c.add(d),f.add(c),f.previewBox?c.position.y=f.barBackground.position.y+20-f.previewBox.height/2-2*c.height:c.position.y=-10,f.barBackground.pointerSignals.move.add(function(e){if(f.moments){for(var t=(f.barBackground.worldToLocal(e.worldPoint.clone()).x+f.barBackground.anchor.x)/f.barBackground.width,r=null,n=0,i=1e3,o=0;o<f.moments.length;o++){var a=I(f.moments[o],2),s=a[0],u=a[1],l=Math.abs(u-t);l<i&&l<.015&&(r=s,n=u,i=l)}null!==r?(c.visible=!0,c.position.x=(n-.5)*f.barBackground.width,d.setText(r)):c.visible=!1}}),f.barBackground.pointerSignals.out.add(function(e){c.visible=!1})}();var h=this.settingsGroup=new D.default({app:o,pack:this.pack});h.rotateY(-Math.PI/6),h.translateZ(350*Math.cos(Math.PI/6)*.5),h.position.x+=896,h.visible=!1,this.listenerManager.binding(h.onParamUpdate,function(){f.timer=f.params.hideTimeOut}),this.add(h)}},{key:"setupListeners",value:function(){var t=this;this.listenerManager.add(this.video,"timeupdate",this.updateCurrentTime.bind(this)),this.listenerManager.add(this.video,"playing",this.onVideoStateChange.bind(this)),this.listenerManager.add(this.video,"pause",this.onVideoStateChange.bind(this)),this.listenerManager.add(this.video,"volumechange",this.updateVolume.bind(this)),this.listenerManager.subscribe(this.app,s.default.VR_MODE_CHANGE,function(e){e.presenting||t.hide()},this),this.listenerManager.binding(this.app.getService("input-manager").gaze.onStateChange,function(e){t.autoHide=!e},this),this.listenerManager.add(this.video,"ended",function(e){(t.app.isPresentingToDevice()||t.alwaysShow)&&(t.onVideoStateChange(),t.timer=3*t.params.hideTimeOut,t.show())})}},{key:"updateVolume",value:function(){this.volumeBar.setValue(this.video.volume),this.volumeIcon.setTexture(0<this.video.volume?this.pack.getTexture("volume_icon"):this.pack.getTexture("muted_icon"))}},{key:"updateMoments",value:function(e){e&&0!==e.length?(this.momentsMesh.visible=!0,this.moments=e,this.momentsMesh.geometry=this.getMomentsGeometry(e)):(this.momentsMesh.visible=!1,this.moments=null),this.app.bus.internal.dispatchEvent({type:A.options.internalEvents.VIDEO_MOMENTS_UPDATED,moments:this.moments})}},{key:"updateCurrentTime",value:function(){var e=this.video.currentTime,t=this.video.duration;if(t&&e){var r=e/t;this.bar.setProgress(r),this.timeText.setText(this.formatTime(e)+" / "+this.formatTime(t))}}},{key:"onVideoStateChange",value:function(e){this.play.setTexture(this.video.ended||this.video.currentTime===this.video.duration&&0<this.video.duration?this.pack.getTexture("replay"):this.video.paused?this.pack.getTexture("play"):this.pack.getTexture("pause"))}},{key:"onFrameEnter",value:function(){f(h(n.prototype),"onFrameEnter",this).call(this)}},{key:"dispose",value:function(){f(h(n.prototype),"dispose",this).call(this),this.momentsMesh&&this.momentsMesh.geometry&&this.momentsMesh.geometry.dispose()}},{key:"formatTime",value:function(e){e=e||0;var t=new Date(1e3*e);function r(e){return e<10?"0"+e:e}return(3600<e?r(t.getUTCHours())+":":"")+r(t.getUTCMinutes())+":"+r(t.getUTCSeconds())}}]),n}();r.PlayerControls=N},{"../../core/assets/asset-pack":634,"../../core/components/basic-button-component":642,"../../core/components/text-over-ui-component":646,"../../core/components/tint-button-component":647,"../../core/input/input-event-source":663,"../../core/ui/button-element":677,"../../core/ui/image-element":678,"../../core/ui/nine-slice-element":680,"../../core/ui/progress-bar":681,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/ui/ui-dummy":684,"../../core/ui/ui-group":686,"../../core/utils/clock":687,"../../core/utils/common-tools":688,"../../core/utils/listeners-manager":691,"../../core/utils/messenger":693,"../../core/vr/vr-manager-messages":706,"../../misc/data-layer":713,"../../misc/global-parameters":714,"../../options":717,"../common/slider":755,"./cinema-messages":719,"./pop-on-input-group":743,"./preview-box":744,"./quality-selector":745,"./settings-window":746,"@tweenjs/tween.js":1,is_js:580,signals:612,three:615}],743:[function(t,r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=t("../../core/ui/ui-group"),a=i(t("@tweenjs/tween.js")),s=t("../../core/utils/listeners-manager"),u=t("../../options"),l=t("../../core/input/input-event-source"),c=t("../../core/utils/clock"),d=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(t("signals")),f=i(t("../../core/vr/vr-manager-messages"));function i(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t,r){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(){function i(t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=function(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?m(e):t}(this,v(i).call(this,t))).alwaysShow="boolean"==typeof r.alwaysShow&&r.alwaysShow,n.autoHide=!t.getService("input-manager").gaze.enabled,r.hideTimeOut=r.hideTimeOut||5,n.params=r,n.timer=0,n.tweenGroup=new a.default.Group,n.listenerManager=new s.ListenersManager,n.onShow=new d.Signal,n.onHide=new d.Signal,n.visible=n.inputEnabled=!1,n.listenerManager.subscribe(n.app,f.default.VR_MODE_DISABLED,function(){e||n.hide()}),n.listenerManager.binding(n.app.getService("input-manager").gaze.onStateChange,function(e){n.autoHide=!e},m(n)),n.listenerManager.binding(n.app.getService("input-manager").onPointerDown,n.onClick,m(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(i,o.UIGroup),function(e,t,r){t&&p(e.prototype,t),r&&p(e,r)}(i,[{key:"onFrameEnter",value:function(){g(v(i.prototype),"onFrameEnter",this).call(this),this.tweenGroup.update(),this.inputEnabled&&(this.timer-=c.Time.dt,this.timer<=0&&this.autoHide&&this.hide())}},{key:"onClick",value:function(e){e.source!==l.InputEventSource.GAZE&&(this.app.isPresentingToDevice()||this.alwaysShow?this.inputEnabled?e.target?this.timer=this.params.hideTimeOut:(this.hide(),this.timer=0):(this.show(),this.timer=this.params.hideTimeOut):this.visible=!1)}},{key:"show",value:function(){this.tweenGroup.removeAll(),this.alpha=0,this.visible=!0,this.inputEnabled=!0,new a.default.Tween(this,this.tweenGroup).to({alpha:1},u.options.animationTimeMedium).easing(a.default.Easing.Quintic.Out).start(),this.onShow.dispatch()}},{key:"hide",value:function(){var e=this;this.tweenGroup.removeAll(),this.inputEnabled=!1,new a.default.Tween(this,this.tweenGroup).to({alpha:0},u.options.animationTimeMedium).easing(a.default.Easing.Quintic.Out).onComplete(function(){e.visible=!1}).start(),this.onHide.dispatch()}},{key:"toggle",value:function(){return this.inputEnabled?(this.hide(),!1):(this.show(),!0)}},{key:"dispose",value:function(){this.tweenGroup.removeAll(),this.listenerManager.dispose()}}]),i}();n.default=_},{"../../core/input/input-event-source":663,"../../core/ui/ui-group":686,"../../core/utils/clock":687,"../../core/utils/listeners-manager":691,"../../core/vr/vr-manager-messages":706,"../../options":717,"@tweenjs/tween.js":1,signals:612}],744:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PreviewBox=void 0;var n,i=e("three"),o=e("../../core/ui/image-element"),a=e("../../options"),s=(n=e("@tweenjs/tween.js"))&&n.__esModule?n:{default:n};function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e,t,r){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(){function n(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.7;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),e=(t=c(this,f(n).call(this))).processSrc(e),t.src=e,t.video=document.createElement("video"),t.video.autoplay=!1,t.video.src=e,t.video.crossOrigin="anonymous",t.video.onloadedmetadata=function(){t.setSize(t.video.videoWidth*r,t.video.videoHeight*r),t.setAnchorRelative(.5,.5),t.locked=!1},t.setSrc(e),t.markAsNonInput(),t.tweenGroup=new s.default.Group,t.locked=!0,t.visible=!1,t.setAlpha(0),t.scale.multiplyScalar(.75),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(n,o.ImageElement),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(n,[{key:"lock",value:function(){this.visible=!1,this.setAlpha(0),this.locked=!0}},{key:"show",value:function(e){if(!this.locked){if(e){var t=this.video.duration*e;.1<Math.abs(this.video.currentTime-t)&&(this.video.currentTime=t)}return this.visible||(this.visible=!0,this.tweenGroup.removeAll(),new s.default.Tween(this,this.tweenGroup).to({alpha:1},a.options.animationTimeFast).easing(s.default.Easing.Quintic.Out).start(),new s.default.Tween(this.scale,this.tweenGroup).to({x:1,y:1},a.options.animationTimeFast).easing(s.default.Easing.Quintic.Out).start()),this}}},{key:"processSrc",value:function(e){if(e&&"string"==typeof e){var t=e.indexOf("?");-1<t&&(e=e.substring(0,t))}return e}},{key:"setSrc",value:function(e){var t=this;this.lock(),this.video.src=this.processSrc(e),this.abortXHR(),this.xhr=new XMLHttpRequest,this.xhr.responseType="blob",this.xhr.open("GET",e,!0),this.xhr.send(),this.xhr.onload=function(){if(200===t.xhr.status){var e=URL.createObjectURL(t.xhr.response);t.video.src=e,t.videoTexture||(t.videoTexture=new i.VideoTexture(t.video)),t.videoTexture.minFilter=t.videoTexture.magFilter=i.LinearFilter,t.videoTexture.generateMipmaps=!1,t.setTexture(t.videoTexture)}t.xhr=null}}},{key:"hide",value:function(){var e=this;this.tweenGroup.removeAll(),new s.default.Tween(this,this.tweenGroup).to({alpha:0},a.options.animationTimeFast).easing(s.default.Easing.Quintic.Out).onComplete(function(){return e.visible=!1}).start(),new s.default.Tween(this.scale,this.tweenGroup).to({x:.75,y:.75},a.options.animationTimeFast).easing(s.default.Easing.Quintic.Out).start()}},{key:"onFrameEnter",value:function(){d(f(n.prototype),"onFrameEnter",this).call(this),this.tweenGroup.update()}},{key:"abortXHR",value:function(){this.xhr&&this.xhr.abort()}},{key:"dispose",value:function(){d(f(n.prototype),"dispose",this).call(this),this.video.src="",this.video.load(),this.video=null,this.videoTexture&&(this.videoTexture.dispose(),this.videoTexture=null),this.abortXHR(),this.xhr=null}}]),n}();r.PreviewBox=p},{"../../core/ui/image-element":678,"../../options":717,"@tweenjs/tween.js":1,three:615}],745:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.QualitySelector=void 0;e("../../core/ui/ui-element");var n,s=e("../../core/ui/button-element"),u=e("../../core/ui/text-element"),l=(n=e("@tweenjs/tween.js"))&&n.__esModule?n:{default:n},i=e("../../core/ui/nine-slice-element"),c=e("../../core/assets/font"),d=e("../../core/assets/asset-pack"),o=e("../../core/utils/clock"),f=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function m(e,t,r){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(){function a(t){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),!(t.backgroundTexture instanceof d.TextureDef))throw"Background texture not set";if(!(t.buttonTexture instanceof d.TextureDef))throw"Button texture not set";if(!(t.buttonTextureActive instanceof d.TextureDef))throw"Button texture not set";if("function"!=typeof t.getCurrent)throw"getCurrent should be a function returning current quality string";if(!(t.font instanceof c.Font))throw"options.font should be instance of Font";if(!Array.isArray(t.list))throw"List should be an array of string";t.border=t.border||10,t.padding=t.padding||10,(r=p(this,g(a).call(this,t.backgroundTexture,t.border,t.border,t.border,t.border))).buttonTextureActive=t.buttonTextureActive,r.buttonTexture=t.buttonTexture,r.getCurrent=t.getCurrent,r.setSize(r.buttonTexture.size.width+2*t.border*0+2*t.padding*0,t.list.length*r.buttonTexture.size.height+2*t.border+2*t.padding),r.markAsNonInput();for(var e=function(e){i=new s.ButtonElement(t.buttonTexture).centerAnchor().setCallback(function(){return r.onClick(t.list[e])}),o=new u.TextElement(t.font).setText(t.list[e]).setSize(40).setRelativeAnchor(!0,!0).markAsNonInput().setPos(0,6,0),i.add(o),i.position.x=0*t.border+0*t.padding+r.buttonTexture.size.width/2,i.position.y=t.border+t.padding+r.buttonTexture.size.height*(e+.5),r.add(i)},n=0;n<t.list.length;n++){var i,o;e(n)}return r.onSelect=new f.Signal,r.onShow=new f.Signal,r.onHide=new f.Signal,r.tweenGroup=new l.default.Group,r.timer=0,r.inputEnabled=!1,r.alpha=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(a,i.NineSliceElement),function(e,t,r){t&&h(e.prototype,t),r&&h(e,r)}(a,[{key:"show",value:function(){this.updateButtons(),this.timer=10,this.tweenGroup.removeAll(),new l.default.Tween(this,this.tweenGroup).to({alpha:1},300).easing(l.default.Easing.Quintic.Out).start(),void 0===this._savedPosition&&(this._savedPosition=this.position.y),this.position.y-=60,new l.default.Tween(this.position,this.tweenGroup).to({y:this._savedPosition},300).easing(l.default.Easing.Quintic.Out).start(),this.inputEnabled=!0,this.onShow.dispatch()}},{key:"hide",value:function(e){e=void 0===e?0:e,this.tweenGroup.removeAll(),new l.default.Tween(this,this.tweenGroup).to({alpha:0},300).easing(l.default.Easing.Quintic.Out).delay(e).start(),new l.default.Tween(this.position,this.tweenGroup).to({y:this.position.y-60},300).easing(l.default.Easing.Quintic.Out).delay(e).start(),this.inputEnabled=!1,this.onHide.dispatch()}},{key:"onClick",value:function(e){this.hide(300),this.getCurrent()!=e&&(this.onSelect.dispatch(e),this.updateButtons())}},{key:"toggle",value:function(){.1<this.alpha?this.hide():this.show()}},{key:"updateButtons",value:function(){for(var e=this.getCurrent(),t=0;t<this.children.length;t++){var r=this.children[t];r.children[0].text==e?r.setTexture(this.buttonTextureActive):r.setTexture(this.buttonTexture)}}},{key:"onFrameEnter",value:function(){m(g(a.prototype),"onFrameEnter",this).call(this),this.tweenGroup.update(),0<this.alpha&&(this.timer-=o.Time.dt)}}]),a}();r.QualitySelector=y},{"../../core/assets/asset-pack":634,"../../core/assets/font":638,"../../core/ui/button-element":677,"../../core/ui/nine-slice-element":680,"../../core/ui/text-element":683,"../../core/ui/ui-element":685,"../../core/utils/clock":687,"@tweenjs/tween.js":1,signals:612}],746:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,o=(n=e("@tweenjs/tween.js"))&&n.__esModule?n:{default:n},c=e("../../core/ui/text-element"),d=e("../../core/ui/image-element"),f=e("../../core/ui/rect-element"),h=e("../../options"),p=e("../../core/components/tint-button-component"),m=e("../common/slider"),a=e("../../core/ui/ui-dummy"),g=e("./cinema-messages"),s=e("three"),u=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function y(e,t,r){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(){function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.app,n=t.pack;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=v(this,_(i).call(this))).app=r,e.pack=n,e.settingsTweenGroup=new o.default.Group,e.defaultPos=new s.Vector3,setTimeout(function(){e.defaultPos=e.position.clone()},0),e.create(),e.onParamUpdate=new u.Signal,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(i,a.UIDummy),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(i,[{key:"create",value:function(){var i=this,e=this,t=new f.RectElement(350,508,0).setAlpha(.75).setCornerRadius(h.options.cornerRadius).centerAnchor();e.add(t);for(var o=["zoom","tilt","height","slide","rotation","offsetX","offsetY"],a=["icon_zoom","icon_tilt","icon_height","icon_slide","icon_rotation","icon_horizontal_offset","icon_vertical_offset"],s=[],r=function(r){var n=new m.Slider(i.app,i.pack.getTexture("settings_bar"),{minValue:-1,maxValue:1,overlay:i.pack.getTexture("settings_bar_overlay"),sensitivity:.15}).setValue(0);n.onChange.add(function(e){var t={};t[o[r]]=e,i.app.post(g.CinemaMessages.UPDATE_CAMERA_SETTINGS,t),i.onParamUpdate.dispatch(n)}),n.onGrab.add(function(){i.app.post(g.CinemaMessages.REQUEST_STEREO)}),n.onRelease.add(function(){i.app.post(g.CinemaMessages.REQUEST_MONO)}),n.position.x=-104,n.position.y=-33-n.height-10-59*r+254,s.push(n),e.add(n),u=new d.ImageElement(i.pack.getTexture(a[r])).setSize(32,32).markAsNonInput().centerAnchor().setPos(-129,-33-n.height-10-59*r+254+13),e.add(u)},n=0;n<7;n++){var u;r(n)}var l=new c.TextElement(this.pack.getFont("arial")).setSize(30).setText("RESET").setPos(0,-199).setRelativeAnchor(!0,!0).addComponent(new p.TintButtonComponent(function(){for(var e=0,t=s;e<t.length;e++){t[e].setValue(0)}}).setColors(13421772,16777215));l.position.x=100,e.add(l)}},{key:"show",value:function(){this.settingsTweenGroup.removeAll();var e=this.defaultPos;this.visible=!0,new o.default.Tween(this,this.settingsTweenGroup).to({alpha:1},h.options.animationTimeMedium).easing(o.default.Easing.Quintic.Out).start(),this.position.x=e.x+100,new o.default.Tween(this.position,this.settingsTweenGroup).to({x:e.x},h.options.animationTimeMedium).easing(o.default.Easing.Quintic.Out).start()}},{key:"hide",value:function(){var e=this.defaultPos,t=this;this.settingsTweenGroup.removeAll(),new o.default.Tween(t,this.settingsTweenGroup).to({alpha:0},h.options.animationTimeMedium).easing(o.default.Easing.Quintic.Out).onComplete(function(){return t.visible=!1}).start(),new o.default.Tween(t.position,this.settingsTweenGroup).to({x:e.x+100},h.options.animationTimeMedium).easing(o.default.Easing.Quintic.Out).start()}},{key:"onFrameEnter",value:function(){y(_(i.prototype),"onFrameEnter",this).call(this),this.settingsTweenGroup.update()}}]),i}();r.default=E},{"../../core/components/tint-button-component":647,"../../core/ui/image-element":678,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/ui/ui-dummy":684,"../../options":717,"../common/slider":755,"./cinema-messages":719,"@tweenjs/tween.js":1,signals:612,three:615}],747:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var v=e("../../core/ui/rect-element"),y=(e("../hub/hub-item"),i(e("../common/dynamic-image"))),_=e("../../core/ui/text-element"),b=e("../../core/ui/ui-dummy"),E=e("../../core/components/tint-button-component"),w=e("../../options"),n=e("./cinema-messages"),A=i(e("../common/dot-paginator"));function i(e){return e&&e.__esModule?e:{default:e}}function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(){function g(){var o,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.width,a=void 0===t?600:t,r=e.height,s=void 0===r?700:r,n=e.numItems,u=void 0===n?4:n,l=e.font,i=e.data,c=e.messenger;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(o=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?x(e):t}(this,S(g).call(this))).messenger=c;var d=141.6,f=new v.RectElement(a,80+161.6*u+10*(u-1),0).setPos(0,40).setColor(0).setAlpha(.7).centerAnchor().setCornerRadius(w.options.cornerRadius).markAsInputBlocker().addTo(x(o));new _.TextElement(l).setPos(-f.width/2+30,f.height/2+10).setSize(45).setText("Up next").markAsNonInput().addTo(x(o));o.index=0,o.items=[],o.data=i;for(var h=function(e){var t=new b.UIDummy,r=new v.RectElement(a,161.6,0),n=new _.TextElement(l),i=new y.default;t.setPos(-a/2,-s/2+10+171.6*(u-e-1)),r.setAlpha(.2).setPos(0,0).addTo(t).addComponent(new E.TintButtonComponent(function(){o.onClick(e)}).setColors(0,13421772)),i.setSize(230.4,d).setPos(125.2,80.8).markAsNonInput().addTo(t),n.setSize(40).setPos(i.position.x+115.2+10,d).setWidth(a-230.4-30).markAsNonInput().addTo(t),o.add(t),o.items.push({image:i,text:n,backdrop:r,group:t})},p=0;p<u;p++)h(p);var m=o.paginator=new A.default({getTotalPages:function(){return o.data?Math.ceil(o.data.length/u):0},getCurrentPage:function(){return Math.floor(o.index/u)},align:"right"});return m.position.set(f.width/2-30,f.height/2-10,0),m.onSelect.add(function(e){o.index=e*u,o.updateDisplay()}),o.add(m),o.updateDisplay(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(g,b.UIDummy),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(g,[{key:"setData",value:function(e){return this.data=e,this.updateDisplay(),this}},{key:"updateDisplay",value:function(){if(this.data){for(var e=this.index;e<this.index+this.items.length;e++){var t=this.data[e],r=this.items[e-this.index];t?(r.image.setSrc(t.src),r.text.setText(t.title),r.group.visible=!0):r.group.visible=!1}return this.paginator.updateLayout(),this}}},{key:"onClick",value:function(e){if(this.data&&this.messenger){var t=(this.index+e)%this.data.length,r=this.data[t];this.messenger.post(n.CinemaMessages.OPEN_VIDEO,r)}}},{key:"dispose",value:function(){this.data=null}}]),g}();r.default=s},{"../../core/components/tint-button-component":647,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/ui/ui-dummy":684,"../../options":717,"../common/dot-paginator":751,"../common/dynamic-image":752,"../hub/hub-item":767,"./cinema-messages":719}],748:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.VideoSurfaceMessages=r.VideoSurface=void 0;var u=e("three"),n=e("../../core/utils/math-tools"),c=e("./cinema-messages"),d=e("../../core/app-messages"),f=e("../../core/utils/listeners-manager"),i=e("../../misc/prefix-properties");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a={zoom:{min:-350,max:350},offsetX:{min:-75,max:75},offsetY:{min:-75,max:75},slide:{min:-250,max:250},height:{min:-250,max:250},tilt:{min:-Math.PI/2,max:Math.PI/2},rotation:{min:-Math.PI,max:Math.PI}},s=function(){function l(e,t,r,n,i,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var s=this.leftEquirectMesh=this.getEquirectMesh(t,r,"left"),u=this.rightEquirectMesh=this.getEquirectMesh(t,r,"right");s.material=u.material=n,this.videoAspect=i,this.leftFlatMesh=this.getFlatMesh(t,i,"left"),this.rightFlatMesh=this.getFlatMesh(t,i,"right"),this.leftFlatMesh.material=this.rightFlatMesh.material=n,this.flatFitCropFactor=.9,this.flatFillDownscaleFactor=1,this.listenersManager=new f.ListenersManager,this.camera=o,this.cameraParams={zoom:0,offsetX:0,offsetY:0,slide:0,height:0,tilt:0,rotation:0},this.projectionMode="stereo",this.isFlat=!1,this.isFlatInVR=!1,this.isPresenting=!1,this._dirty=!0,this.app=e,this.listenersManager.subscribe(this.app,c.CinemaMessages.REQUEST_MONO,function(){a._stereoMode="mono;",a._dirty=!0,a.app.post(h.STEREO_MODE_UPDATE,{isStereo:"stereo"===a.projectionMode})}),this.listenersManager.subscribe(this.app,c.CinemaMessages.REQUEST_STEREO,function(){a.projectionMode="stereo",a._dirty=!0,a.app.post(h.STEREO_MODE_UPDATE,{isStereo:"stereo"===a.projectionMode})}),this.listenersManager.subscribe(this.app,c.CinemaMessages.SET_FLAT_PROJECTION,function(){a.isFlat=!0,a._dirty=!0,a.app.post(h.PROJECTION_MODE_UPDATE,{isFlat:a.isFlat})}),this.listenersManager.subscribe(this.app,c.CinemaMessages.SET_SPHERE_PROJECTION,function(){a.isFlat=!1,a._dirty=!0,a.app.post(h.PROJECTION_MODE_UPDATE,{isFlat:a.isFlat})}),this.listenersManager.subscribe(this.app,c.CinemaMessages.TOGGLE_PROJECTION_MODE,function(){a.isFlat=!a.isFlat,a._dirty=!0,a.app.post(h.PROJECTION_MODE_UPDATE,{isFlat:a.isFlat})}),this.listenersManager.subscribe(this.app,c.CinemaMessages.SET_FLAT_PROJECTION_VR,function(){a.isFlatInVR=!0,a._dirty=!0,a.app.post(h.PROJECTION_MODE_UPDATE_VR,{isFlat:a.isFlatInVR})}),this.listenersManager.subscribe(this.app,c.CinemaMessages.SET_SPHERE_PROJECTION_VR,function(){a.isFlatInVR=!1,a._dirty=!0,a.app.post(h.PROJECTION_MODE_UPDATE_VR,{isFlat:a.isFlatInVR})}),this.listenersManager.subscribe(this.app,c.CinemaMessages.TOGGLE_PROJECTION_MODE_VR,function(){a.isFlatInVR=!a.isFlatInVR,a._dirty=!0,a.app.post(h.PROJECTION_MODE_UPDATE_VR,{isFlat:a.isFlatInVR})}),this.listenersManager.subscribe(this.app,d.AppMessages.PRESENTING_STATE_CHANGE,function(e){var t=e.presenting;a.isPresenting=t,a._dirty=!0}),this.listenersManager.subscribe(this.app,d.AppMessages.CANVAS_SIZE_CHANGE,function(){a._dirty=!0}),this.listenersManager.subscribe(this.app,c.CinemaMessages.UPDATE_CAMERA_SETTINGS,function(e){return a.updateCameraSettings(e)})}return function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(l,[{key:"updateCameraSettings",value:function(e){var t=e;void 0!==t.zoom&&(this.cameraParams.zoom=t.zoom),void 0!==t.offsetX&&(this.cameraParams.offsetX=t.offsetX),void 0!==t.offsetY&&(this.cameraParams.offsetY=t.offsetY),void 0!==t.slide&&(this.cameraParams.slide=t.slide),void 0!==t.height&&(this.cameraParams.height=t.height),void 0!==t.tilt&&(this.cameraParams.tilt=t.tilt),void 0!==t.rotation&&(this.cameraParams.rotation=t.rotation)}},{key:"onFrameEnter",value:function(){if(this._dirty&&this.reconfigure(),this.leftEquirectMesh.position.multiplyScalar(0),this.leftEquirectMesh.rotation.set(0,0,0),this.rightEquirectMesh.position.multiplyScalar(0),this.rightEquirectMesh.rotation.set(0,0,0),this.camera){this.leftEquirectMesh.position.x=n.MathTools.map(this.cameraParams.offsetX,-1,1,a.offsetX.min,a.offsetX.max),this.rightEquirectMesh.position.x=-this.leftEquirectMesh.position.x,this.leftEquirectMesh.position.y=n.MathTools.map(this.cameraParams.offsetY,-1,1,a.offsetY.min,a.offsetY.max),this.rightEquirectMesh.position.y=-this.leftEquirectMesh.position.y,this.leftEquirectMesh.position.y+=n.MathTools.map(this.cameraParams.height,-1,1,a.height.min,a.height.max),this.rightEquirectMesh.position.y+=n.MathTools.map(this.cameraParams.height,-1,1,a.height.min,a.height.max),this.leftEquirectMesh.position.x+=n.MathTools.map(this.cameraParams.slide,-1,1,a.slide.min,a.slide.max),this.rightEquirectMesh.position.x+=n.MathTools.map(this.cameraParams.slide,-1,1,a.slide.min,a.slide.max);var e=new u.Vector3(0,0,-1);(e=e.applyQuaternion(this.camera.quaternion)).multiplyScalar(-1),e.multiplyScalar(n.MathTools.map(this.cameraParams.zoom,-1,1,a.zoom.min,a.zoom.max)),this.leftEquirectMesh.position.add(e),this.rightEquirectMesh.position.add(e),this.leftEquirectMesh.rotateX(n.MathTools.map(this.cameraParams.tilt,-1,1,a.tilt.min,a.tilt.max)),this.rightEquirectMesh.rotateX(n.MathTools.map(this.cameraParams.tilt,-1,1,a.tilt.min,a.tilt.max)),this.leftEquirectMesh.rotateZ(n.MathTools.map(this.cameraParams.rotation,-1,1,a.rotation.min,a.rotation.max)),this.rightEquirectMesh.rotateZ(n.MathTools.map(this.cameraParams.rotation,-1,1,a.rotation.min,a.rotation.max))}}},{key:"reconfigure",value:function(){switch(this.projectionMode){case"mono":this.setMono();break;case"stereo":this.setStereo();break;default:throw new Error("Unknown projection mode: "+this.projectionMode)}if(this.setMode(this.isPresenting?this.isFlatInVR?"flat":"nonflat":this.isFlat?"flat":"nonflat"),this.isFlat&&!this.isPresenting){var e=this.camera.fov,t=this.camera.aspect,r=this.meshAspect;if("number"!=typeof e||"number"!=typeof t)throw new Error("VideoSurface expects THREE.PerspectiveCamera");var n=0,i=0;i=t<r?900:900*r/t,n=this.flatFillDownscaleFactor*i/2/Math.tan(e/2*Math.PI/180)-500,this.leftFlatMesh.position.z=-n,this.rightFlatMesh.position.z=-n}else this.leftFlatMesh.position.multiplyScalar(0),this.rightFlatMesh.position.multiplyScalar(0);this._dirty=!1}},{key:"setMode",value:function(e){switch(this.leftFlatMesh.visible=this.rightFlatMesh.visible=!1,this.leftEquirectMesh.visible=this.rightEquirectMesh.visible=!1,e){case"flat":this.leftFlatMesh.visible=this.rightFlatMesh.visible=!0;break;default:this.leftEquirectMesh.visible=this.rightEquirectMesh.visible=!0}return this}},{key:"dispose",value:function(){this.listenersManager.dispose(),this.listenersManager=null,this.leftEquirectMesh.geometry.dispose(),this.rightEquirectMesh.geometry.dispose(),this.leftFlatMesh.geometry.dispose(),this.rightFlatMesh.geometry.dispose(),this.camera=null,this.app=null,this.material=null}},{key:"updateWithValues",value:function(e,t){this.leftEquirectMesh.geometry.dispose(),this.rightEquirectMesh.geometry.dispose(),this.leftEquirectMesh.geometry=this.getEquirectMesh(e,t,"left").geometry,this.rightEquirectMesh.geometry=this.getEquirectMesh(e,t,"right").geometry}},{key:"getEquirectMesh",value:function(e,t,r){var n=new u.SphereGeometry(500,30,15,0,t*(Math.PI/180));n.scale(-1,1,1),this.scaleUVBySide(n,e,r);var i=new u.Mesh(n);return i.layers.set("left"===r?1:2),i.geometry.rotateY(Math.PI*((6+t/30)/12)),i}},{key:"getFlatMesh",value:function(e,t,r,n){var i=null;switch(e){case"sbs":case"sbs2l":case"LR":i=t/2;break;case"ab":case"ab2l":case"TB":i=2*t;break;case"mono":default:i=t}var o=900*(this.meshAspect=i),a=new u.PlaneGeometry(o,900,2,2);a.translate(0,0,-500),this.scaleUVBySide(a,e,r);var s=new u.Mesh(a);return s.layers.set("left"===r?1:2),s}},{key:"scaleUVBySide",value:function(e,t,r){var n=e.faceVertexUvs[0],i=0,o=0;switch(t){case"sbs":case"sbs2l":case"LR":switch(r.toLowerCase()){case"left":for(i=0;i<n.length;i++)for(o=0;o<3;o++)n[i][o].x*=.5;break;case"right":for(i=0;i<n.length;i++)for(o=0;o<3;o++)n[i][o].x*=.5,n[i][o].x+=.5}break;case"ab":case"ab2l":case"TB":switch(r.toLowerCase()){case"left":for(i=0;i<n.length;i++)for(o=0;o<3;o++)n[i][o].y*=.5;break;case"right":for(i=0;i<n.length;i++)for(o=0;o<3;o++)n[i][o].y*=.5,n[i][o].y+=.5}}}},{key:"setMono",value:function(){this.leftEquirectMesh.layers.set(1),this.leftEquirectMesh.layers.enable(2),this.rightEquirectMesh.layers.set(3),this.leftFlatMesh.layers.set(1),this.leftFlatMesh.layers.enable(2),this.rightFlatMesh.layers.set(3)}},{key:"setStereo",value:function(){this.leftEquirectMesh.layers.set(1),this.rightEquirectMesh.layers.set(2),this.leftFlatMesh.layers.set(1),this.rightFlatMesh.layers.set(2)}}]),l}();r.VideoSurface=s;var h={PROJECTION_MODE_UPDATE:"projection-mode-update",PROJECTION_MODE_UPDATE_VR:"projection-mode-update-vr",STEREO_MODE_UPDATE:"stereo-mode-update"};r.VideoSurfaceMessages=h,(0,i.prefixProperties)("video-surface:",h)},{"../../core/app-messages":631,"../../core/utils/listeners-manager":691,"../../core/utils/math-tools":692,"../../misc/prefix-properties":716,"./cinema-messages":719,three:615}],749:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=e("../../core/ui/rect-element"),a=(n=e("../../core/assets/ads-pack"))&&n.__esModule?n:{default:n},s=e("../../core/ui/image-element"),u=(e("../../core/assets/asset-pack"),e("../../core/assets/font")),l=e("../../core/ui/text-element"),c=e("../../options"),d=e("../../core/utils/listeners-manager"),f=e("../../core/app");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(){function o(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=e.ads,n=e.font,i=e.app;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),!(r instanceof a.default))throw new Error("ads should be instance of AdsPack");if(!(n instanceof u.Font))throw new Error("font should be instance of Font");if(!(i instanceof f.App))throw new Error("app should be instance of App");return(t=p(this,m(o).call(this,656,200,0))).ads=r,t.image=null,t.padding=20,t.centerAnchor().setCornerRadius(c.options.cornerRadius).setAlpha(.75),t.title=new l.TextElement(n).setSize(45).setPos(0,t.height/2-t.padding-20).markAsNonInput(),t.text=new l.TextElement(n).setSize(45).setPos(0,t.height/2-t.padding-25-45).markAsNonInput(),t.currentConfig=null,t.add(t.title),t.add(t.text),t.next(),t._disposed=!1,t.listeners=new d.ListenersManager,t.listeners.binding(t.pointerSignals.in,function(){return t.alpha=.9}),t.listeners.binding(t.pointerSignals.out,function(){return t.alpha=.75}),t.listeners.binding(t.pointerSignals.up,function(){function e(){return window.open(t.currentConfig.url)}i.getValue("is-presenting-to-device")?i.toggleVRMode().then(e):e()}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(o,i.RectElement),function(e,t,r){t&&h(e.prototype,t),r&&h(e,r)}(o,[{key:"next",value:function(){var t=this;this.disposed||(this.visible=!1,this.currentConfig=this.ads.bannerCycle.next(),this.ads.loadTexture(this.currentConfig.thumb).then(function(e){t.disposed||(t.reconfigure(t.currentConfig.title,t.currentConfig.text,e),t.visible=!0)}).catch(function(e){t.visible=!1}))}},{key:"reconfigure",value:function(e,t,r){this.title.setText(e),this.text.setText(t),this.setThumbnail(r)}},{key:"setThumbnail",value:function(e){this.image?this.image.setTexture(e):(this.image=new s.ImageElement(e).centerAnchor().markAsNonInput(),this.add(this.image));var t=this.padding,r=this.width,n=this.height-2*t,i=n/(this.image.height/this.image.width);this.image.setSize(i,n).centerAnchor().setCornerRadius(c.options.cornerRadius),this.image.position.x=-r/2+t+i/2,this.text.position.x=this.title.position.x=this.image.position.x+i/2+t,this.text.setWidth(r-i-3*t)}},{key:"dispose",value:function(){this._disposed=!0,this.listeners.dispose()}}]),o}();r.default=v},{"../../core/app":632,"../../core/assets/ads-pack":633,"../../core/assets/asset-pack":634,"../../core/assets/font":638,"../../core/ui/image-element":678,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/utils/listeners-manager":691,"../../options":717}],750:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ControllerView=void 0;var u=e("three"),n=e("../../core/utils/math-tools"),o=e("../../core/assets/asset-pack"),i=e("../../core/input/ray-source-manager"),l=e("../../core/utils/listeners-manager"),a=e("../../core/utils/vendor-tools");function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(){function s(n){var i,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);(i=function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?h(e):t}(this,f(s).call(this))).basePath=e,i.app=n,i.defaultDistance=2e3,i.armLength=.2,i._disposed=!1;var t=i.laserLength=250,r=new u.PlaneGeometry(.01,t).translate(0,t/2,0).rotateX(-Math.PI/2),o=i.laser=new u.Mesh(r,new u.MeshBasicMaterial({map:_(),side:u.DoubleSide,transparent:!0,blending:u.AdditiveBlending}));o.position.z=-i.armLength,i.add(o);var a=i.pointer=new u.Mesh(new u.SphereGeometry(.5),new u.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.6,depthTest:!1}));return i.add(a),i._updateControllerMesh(),i._lm=new l.ListenersManager,i._lm.binding(n.getService("input-manager").gamepad.onCurrentGamepadChanged,i._updateControllerMesh.bind(h(i))),i._lm.binding(n.getService("input-manager").onPointerMove,function(e){if(n.isPresentingToDevice()){var t=e.worldPoint;if(n.getService("input-manager").gamepad.transformObject(h(i)),t){var r=i.position.distanceTo(t);a.position.z=-r}else a.position.z=-i.defaultDistance;i._updateScale()}}),i.shouldBeVisible=!0,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(s,u.Group),function(e,t,r){t&&d(e.prototype,t),r&&d(e,r)}(s,[{key:"onFrameEnter",value:function(){this.visible=this.app.isPresentingToDevice()&&this.app.getService("ray-source-manager").lastRaySource===i.RaySource.LASER_GAMEPAD,this.visible=this.visible&&this.shouldBeVisible}},{key:"_updateControllerMesh",value:function(){var t=this;if(this.controller&&this.remove(this.controller),this.app.getService("input-manager").gamepad.current){var e=this.app.getService("input-manager").gamepad.current.id;if("string"==typeof e){var r="generic";-1<(e=e.toLowerCase()).indexOf("daydream")&&(r="daydream"),-1<e.indexOf("gear vr controller")&&(r="gearvr"),-1<e.indexOf("oculus touch")&&-1<e.indexOf("left")&&(r=a.VendorTools.isOculusQuest()?"oculusQuestLeft":"oculusTouchLeft"),-1<e.indexOf("oculus touch")&&-1<e.indexOf("right")&&(r=a.VendorTools.isOculusQuest()?"oculusQuestRight":"oculusTouchRight"),-1<e.indexOf("oculus go")&&(r="oculusGo"),-1<e.indexOf("openvr gamepad")&&(r="vive"),b(r,this.basePath).then(function(e){t._disposed||(t.app.getService("input-manager").gamepad.hasPosition()?(e.position.z=0,t.laser.position.z=0):(e.position.z=-t.armLength,t.laser.position.z=-t.armLength),t.add(e),t.controller=e)}).catch(function(e){console.log("Cant get controller mesh: ".concat(e))})}}}},{key:"_updateScale",value:function(){var e=Math.abs(this.pointer.position.z),t=n.MathTools.map(e,0,this.defaultDistance,.02,1);this.pointer.scale.set(1,1,1),this.pointer.scale.multiplyScalar(t),this.laser.scale.z=n.MathTools.clamp01(e/this.laserLength),this.laser.scale.z*=.9}},{key:"dispose",value:function(){this._disposed=!0,this.controller&&this.remove(this.controller),this._lm.dispose(),this.controller=null,this.pointer.geometry.dispose(),this.pointer.material.dispose(),this.laser.geometry.dispose(),this.laser.material.dispose()}}]),s}();r.ControllerView=s;var m,g,v,y,_=function(){var e=document.createElement("canvas");e.width=256,e.height=256;var t=e.getContext("2d"),r=t.createLinearGradient(0,0,0,256);r.addColorStop(0,"rgba(255, 255, 255, 0)"),r.addColorStop(.99,"rgba(255, 255, 255, 1)"),r.addColorStop(.9,"rgba(255, 255, 255, 0.2)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=r,t.fillRect(0,0,256,256);var n=t.createLinearGradient(0,0,256,0);n.addColorStop(0,"rgba(255, 255, 255, 0)"),n.addColorStop(.3,"rgba(255, 255, 255, 0.2)"),n.addColorStop(.5,"rgba(255, 255, 255, 1)"),n.addColorStop(.8,"rgba(255, 255, 255, 0.2)"),n.addColorStop(1,"rgba(255, 255, 255, 0)"),t.globalCompositeOperation="destination-in",t.fillStyle=n,t.fillRect(0,0,256,256);var i=new u.CanvasTexture(e);return function(){return i}}(),b=(m=new u.ShaderMaterial({uniforms:{},vertexShader:"\n        varying float factor;\n\n        void main() {\n\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n            vec3 viewDir = normalize(gl_Position.xyz - cameraPosition);\n            vec3 worldNormal = normalize(modelViewMatrix * vec4(normal, 1.0)).xyz;\n\n            factor = dot(worldNormal, viewDir);\n\n        }\n    ",fragmentShader:"\n        varying float factor;\n        \n        void main() {\n            gl_FragColor = 0.2 * (vec4(1,1,1,1) * (0.8 * (1.0 - factor) + 0.2)) + (1.0-step(0.4, factor)) * vec4(1,1,1,1) * 0.08 * 0.0 ;\n        }\n    "}),g={},v={},y={daydream:"assets/meshes/controllers/daydream.obj",generic:"assets/meshes/controllers/generic.obj",gearvr:"assets/meshes/controllers/gearvr.obj",oculusTouchLeft:"assets/meshes/controllers/oculus_touch_left.obj",oculusTouchRight:"assets/meshes/controllers/oculus_touch_right.obj",oculusQuestLeft:"assets/meshes/controllers/quest_left.obj",oculusQuestRight:"assets/meshes/controllers/quest_right.obj",oculusGo:"assets/meshes/controllers/oculus_go.obj",vive:"assets/meshes/controllers/vive.obj"},function(r,n){return new Promise(function(t,e){if(!g[r])return E(r,n).then(function(e){g[r]=e,t(e)}).catch(function(e){console.warn("Cant load controller mesh: ".concat(e))});t(g[r])})});function E(n,e){var i=1<arguments.length&&void 0!==e?e:"";if(v[n]&&v[n]instanceof Promise)return v[n];var t=new Promise(function(e,t){var r=new o.AssetPack;r.onCompleteCallback=function(){!function(e){e.scale.multiplyScalar(1),e.rotateY(Math.PI),e.traverse(function(e){return e.material=m})}(r.getObject(n)),e(r.getObject(n))},r.loadObject(i+y[n],n),r.start()});return v[n]=t}},{"../../core/assets/asset-pack":634,"../../core/input/ray-source-manager":666,"../../core/utils/listeners-manager":691,"../../core/utils/math-tools":692,"../../core/utils/vendor-tools":698,three:615}],751:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../../core/ui/ui-dummy"),v=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),i=e("../../core/ui/rect-element"),o=e("../../core/components/basic-button-component");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(){function g(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.activeScale,n=void 0===r?1:r,i=t.inactiveScale,o=void 0===i?.75:i,a=t.activeAlpha,s=void 0===a?1:a,u=t.inactiveAlpha,l=void 0===u?.6:u,c=t.getTotalPages,d=t.spacing,f=void 0===d?30:d,h=t.align,p=void 0===h?"left":h,m=t.getCurrentPage;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(e=y(this,_(g).call(this))).onSelect=new v.Signal,e.items=[],e.getTotalPages=c,e.getCurrentPage=m,e.activeScale=n,e.activeAlpha=s,e.inactiveAlpha=l,e.inactiveScale=o,e.spacing=f,e.align=p,e.updateLayout(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(g,n.UIDummy),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(g,[{key:"updateLayout",value:function(){var t=this;this.items.forEach(function(e){return e.visible=!1});for(var r=this.getTotalPages(),e=this.getCurrentPage(),n=0;n<r;n++){this.items[n]||(this.items[n]=this.createItem(n));var i=this.items[n];i.visible=!0,i.scale.set(1,1,1).multiplyScalar(n===e?this.activeScale:this.inactiveScale),i.setAlpha(n===e?this.activeAlpha:this.inactiveAlpha),i.position.x=n*this.spacing}"right"===this.align?this.items.forEach(function(e){return e.position.x-=(r-1)*t.spacing}):"center"===this.align&&this.items.forEach(function(e){return e.position.x-=(r-1)*t.spacing*.5})}},{key:"createItem",value:function(e){var t=this,r=new i.RectElement(20,20,16777215).setCornerRadius(1500).centerAnchor().addComponent(new o.BasicButtonComponent(function(){return t.onClick(e)}));return this.add(r),r}},{key:"onClick",value:function(e){this.onSelect.dispatch(e)}},{key:"dispose",value:function(){this.onSelect.dispose()}}]),g}();r.default=l},{"../../core/components/basic-button-component":642,"../../core/ui/rect-element":682,"../../core/ui/ui-dummy":684,signals:612}],752:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=e("../../core/ui/ui-dummy"),o=e("./spinner"),a=e("../../core/ui/image-element"),s=e("three");function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var n=function(){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=(t.spinnerScale,t.onLoadCallback);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?d(e):t}(this,c(n).call(this))).spinner=new o.Spinner,e.image=new a.ImageElement,e.image.visible=!1,e.element=document.createElement("img"),e.element.crossOrigin="anonymous",e.element.onload=e.onImageElementLoad.bind(d(e)),e.texture=null,e.add(e.image),e.add(e.spinner),e.onLoadCallback=r,e.width=0,e.height=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(n,i.UIDummy),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(n,[{key:"setSrc",value:function(e){return this.element.src=e,this.image.visible=!1,this.spinner.visible=!0,this}},{key:"onImageElementLoad",value:function(){this.texture&&(this.texture.dispose(),this.texture=null);var e=new s.Texture(this.element);e.magFilter=e.minFilter=s.LinearFilter,e.generateMipmaps=!1,e.needsUpdate=!0,this.image.setTexture(e),this.texture=e,this.spinner.visible=!1,this.image.visible=!0,this.updateImageSize()}},{key:"updateImageSize",value:function(){var e=this.width,t=this.height,r=this.element.naturalWidth,n=this.element.naturalHeight;if(0<e&&0<t)this.image.setSize(e,t);else if(0<e){var i=e/r;this.image.setSize(e,n*i)}else if(0<t){var o=t/n;this.image.setSize(r*o,t)}else this.image.setSize(r,n);this.image.centerAnchor()}},{key:"setSize",value:function(e,t){var r=0<arguments.length&&void 0!==e?e:0,n=1<arguments.length&&void 0!==t?t:0;return this.width=r||0,this.height=n||0,this.updateImageSize(),this.onLoadCallback&&this.onLoadCallback(this),this}},{key:"addTo",value:function(e){return e.add(this),this}},{key:"dispose",value:function(){this.texture&&(this.texture.dispose(),this.texture=null),this.element=null}}]),n}();r.default=n},{"../../core/ui/image-element":678,"../../core/ui/ui-dummy":684,"./spinner":756,three:615}],753:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GazeInputSwitch=void 0;var n,i=e("three"),o=e("../../core/ui/image-element"),a=e("../../core/utils/listeners-manager"),s=(e("../../core/ui/progress-bar"),e("../../core/ui/rect-element")),u=e("../../core/utils/clock"),l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),c=(n=e("../../core/vr/vr-manager-messages"))&&n.__esModule?n:{default:n};function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,r){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=function(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?h(e):t}(this,m(n).call(this,t.texture))).centerAnchor(),r._progressBar=new s.RectElement(100,100,16777215).setCornerRadius(1e7),r.add(r._progressBar),r._progressBar.setPos(0,-187,0),r._updateProgressBar(0),r._camera=t.camera instanceof i.Camera?t.camera:null,r._app=e,r.pointerSignals.in.add(r._onIn,h(r)),r.pointerSignals.out.add(r._onOut,h(r)),r.callback=null,r._timer=0,r._isIn=!1,r._lm=new a.ListenersManager,r._dummyVec=new i.Vector3,r._dummyVec2=new i.Vector3,r._dummyVec3=new i.Vector3,r.alpha=.2,r.onInvoke=new l.Signal,"boolean"==typeof t.defaultVisibilityCheck&&!0!==t.defaultVisibilityCheck||(r._lm.subscribe(e,c.default.VR_MODE_CHANGE,function(e){r.visible=e.presenting}),r.visible=e.isPresentingToDevice()),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(n,o.ImageElement),function(e,t,r){t&&f(e.prototype,t),r&&f(e,r)}(n,[{key:"_onIn",value:function(){this._isIn=!0}},{key:"_onOut",value:function(){this._isIn=!1}},{key:"_invoke",value:function(){this.callback?this.callback():this._app.getService("input-manager").gaze.enabled=!this._app.getService("input-manager").gaze.enabled,this.onInvoke.dispatch()}},{key:"_updateProgressBar",value:function(e){this._progressBar.setSize(384*e,10),this._progressBar.centerAnchor()}},{key:"onFrameEnter",value:function(){p(m(n.prototype),"onFrameEnter",this).call(this),this.visible&&(this._isActivating()?(this._timer+=u.Time.dt,this._updateProgressBar(this._timer/this._app.getService("input-manager").gaze.timeout),this._timer>this._app.getService("input-manager").gaze.timeout&&(this._invoke(),this._isIn=!1,this._timer=0,this._updateProgressBar(0))):0<this._timer&&(this._timer=0,this._updateProgressBar(0)))}},{key:"_isActivating",value:function(){var e=!1;if(null!==this._camera){var t=this._camera,r=this.getWorldPosition(this._dummyVec),n=t.getWorldPosition(this._dummyVec2),i=r.sub(n).normalize(),o=t.getWorldDirection(this._dummyVec2).normalize(),a=i.angleTo(o);Math.abs(a)<.1*Math.PI&&(e=!0)}return this._isIn||e}},{key:"setCallback",value:function(e){return this.callback=e,this}},{key:"dispose",value:function(){p(m(n.prototype),"dispose",this).call(this),this._lm.dispose()}}]),n}();r.GazeInputSwitch=v},{"../../core/ui/image-element":678,"../../core/ui/progress-bar":681,"../../core/ui/rect-element":682,"../../core/utils/clock":687,"../../core/utils/listeners-manager":691,"../../core/vr/vr-manager-messages":706,signals:612,three:615}],754:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Reticle=void 0;var i=e("three"),s=e("../../core/utils/math-tools"),o=e("../../core/app"),u=e("../../core/input/ray-source-manager");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e,t,r){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(){function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var r=new i.RingBufferGeometry(.001,.015,20,1),n=new i.RingBufferGeometry(.075-.0195,.075,20,1);if(r.morphAttributes.position=[],r.morphAttributes.position[0]=n.attributes.position,(t=c(this,f(a).call(this,r,new i.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.5,morphTargets:!0,depthTest:!1})))).activeRing=n,t.distance=3,t.shouldBeVisible=!0,t.updateMorphTargets(),!(e instanceof o.App))throw"Expecting App instance";return t.app=e,t.targetPosition=new i.Vector3,t.timer=new i.Mesh(new i.RingGeometry(.075-.0195,.075,20,1,0,Math.PI),new i.MeshBasicMaterial({color:16777215,transparent:!0,opacity:1,morphTargets:!1,wireframe:!1,depthTest:!1})),t.add(t.timer),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(a,i.Mesh),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(a,[{key:"updateMatrixWorld",value:function(e){if(this.app.getValue("is-presenting-to-device")){var t=this.app.getService("input-manager").getCamera();t?(this.targetPosition.set(0,0,-this.distance),t.localToWorld(this.targetPosition),this.position.copy(this.targetPosition),this.quaternion.copy(t.quaternion),this.visible=!0):this.visible=!1;var r=this.app.getService("input-manager").gaze.progress;if(this.app.getService("input-manager").hasTarget){if(this.app.getService("input-manager").gaze.enabled){this.timer.visible=!0;for(var n=this.timer.geometry,i=0;i<=n.parameters.thetaSegments;i++){var o=i/n.parameters.thetaSegments*2*Math.PI*r+Math.PI/2;n.vertices[i].set(n.parameters.innerRadius*Math.cos(o),n.parameters.innerRadius*Math.sin(o),0),n.vertices[i+n.parameters.thetaSegments+1].set(n.parameters.outerRadius*Math.cos(o),n.parameters.outerRadius*Math.sin(o),0)}n.verticesNeedUpdate=!0}this.morphTargetInfluences[0]=s.MathTools.lerpClamped(.6,this.morphTargetInfluences[0],1)}else this.morphTargetInfluences[0]=s.MathTools.lerpClamped(.6,this.morphTargetInfluences[0],0),this.timer.visible=!1}else this.visible=!1;this.visible=this.visible&&this.shouldBeVisible&&this.app.getService("ray-source-manager").lastRaySource===u.RaySource.GAZE,d(f(a.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose(),this.activeRing.dispose(),this.timer.geometry.dispose(),this.timer.material.dispose()}}]),a}();r.Reticle=a},{"../../core/app":632,"../../core/input/ray-source-manager":666,"../../core/utils/math-tools":692,three:615}],755:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Slider=void 0;var o=e("three"),a=e("../../core/ui/image-element"),s=e("../../core/ui/progress-bar"),u=e("../../core/utils/math-tools"),l=e("../../core/utils/listeners-manager"),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals"));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var i=function(){function i(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n=f(this,h(i).call(this,t)),r.minValue=r.minValue||0,r.maxValue=r.maxValue||1,r.sensitivity=r.sensitivity||1,n.app=e,n.params=r,n.params.overlay&&(n.overlay=new s.ProgressBar(n.params.overlay).markAsNonInput(),n.add(n.overlay)),n.params.knob&&(n.knob=new a.ImageElement(n.params.knob).centerAnchor().markAsNonInput(),n.add(n.knob)),n.onGrab=new c.Signal,n.onRelease=new c.Signal,n.onChange=new c.Signal,n.setValue(r.maxValue),n._isDragging=!1,n._plane=new o.Plane,n._normal=new o.Vector3(0,0,1),n._lm=new l.ListenersManager,n._lm.binding(n.pointerSignals.down,function(e){return n._onPointerDown(e)}),n._lm.binding(e.getService("input-manager").onPointerMove,function(e){return n._onPointerMove(e)}),n._lm.binding(e.getService("input-manager").onPointerUp,function(e){return n._onPointerUp(e)}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(i,a.ImageElement),function(e,t,r){t&&d(e.prototype,t),r&&d(e,r)}(i,[{key:"setValueNormalized",value:function(e){return e=u.MathTools.clamp01(e),e=u.MathTools.lerp(e,this.params.minValue,this.params.maxValue),this.setValue(e),this}},{key:"setValue",value:function(e){return this.value=u.MathTools.clamp(e,this.params.minValue,this.params.maxValue),this.updateView(),this.onChange.dispatch(this.value),this}},{key:"updateView",value:function(){var e=u.MathTools.map(this.value,this.params.minValue,this.params.maxValue,0,1);this.overlay&&this.overlay.setProgress(e),this.knob&&this.knob.setPos(this.width*e,0,0)}},{key:"_findIntersectionWithRay",value:function(e){var t=this._plane.set(this._normal,0).applyMatrix4(this.matrixWorld),r=new o.Vector3;return e.intersectPlane(t,r),r}},{key:"_onPointerDown",value:function(e){if(!this._isDragging){var t=this._findIntersectionWithRay(e.ray);null!==t&&(this.startDrag(),this.worldToLocal(t),this.setValueNormalized(this._mapValueToImaginaryWidth(t.x,this.width,this.params.sensitivity)))}}},{key:"_mapValueToImaginaryWidth",value:function(e,t,r){var n=t/(r="number"==typeof r&&0<r?r:1),i=-(n-t)/2,o=i+n;return u.MathTools.map(e,i,o,0,1)}},{key:"_onPointerMove",value:function(e){if(this._isDragging){var t=this._findIntersectionWithRay(e.ray);null!==t?(this.worldToLocal(t),this.setValueNormalized(this._mapValueToImaginaryWidth(t.x,this.width,this.params.sensitivity))):this.stopDrag()}}},{key:"_onPointerUp",value:function(e){this._isDragging&&this.stopDrag()}},{key:"startDrag",value:function(){this._isDragging=!0,this.onGrab.dispatch()}},{key:"stopDrag",value:function(){this._isDragging=!1,this.onRelease.dispatch(this.value)}},{key:"dispose",value:function(){this._lm.dispose()}}]),i}();r.Slider=i},{"../../core/ui/image-element":678,"../../core/ui/progress-bar":681,"../../core/utils/listeners-manager":691,"../../core/utils/math-tools":692,signals:612,three:615}],756:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Spinner=void 0;var n,m=e("three"),g=(n=e("@tweenjs/tween.js"))&&n.__esModule?n:{default:n},i=(e("../../core/utils/math-tools"),e("../../core/utils/clock"));function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(){function p(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.scale,n=void 0===r?1:r,i=t.spinnerColor,o=void 0===i?16777215:i,a=t.ringColor,s=void 0===a?16777215:a,u=t.spinnerOpacity,l=void 0===u?.5:u,c=t.ringOpacity,d=void 0===c?.3:c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);var f=10*n,h=f+3*n;return(e=v(this,y(p).call(this,new m.RingGeometry(f,h,36),new m.MeshBasicMaterial({transparent:!0,opacity:d,color:s})))).spinner=new m.Mesh(new m.RingGeometry(f,h,36,1,0,2*Math.PI*.3),new m.MeshBasicMaterial({transparent:!0,opacity:l,color:o})),e.tweenGroup=new g.default.Group,e.angularVelocity=1.5*Math.PI*2,e.add(e.spinner),e.delay=0,e.targetOpacity=0,e.currentOpacity=0,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(p,m.Mesh),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(p,[{key:"onFrameEnter",value:function(){this.spinner.rotation.z+=i.Time.dt*this.angularVelocity,this.tweenGroup.update()}},{key:"show",value:function(e){return this.visible=!0,this}},{key:"hide",value:function(e){return this.visible=!1,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose(),this.spinner.geometry.dispose(),this.spinner.material.dispose()}}]),p}();r.Spinner=u},{"../../core/utils/clock":687,"../../core/utils/math-tools":692,"@tweenjs/tween.js":1,three:615}],757:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;e("three"),e("../../core/ui/ui-element");var y=e("../../core/ui/button-element"),_=e("../../core/ui/text-element"),n=(e("../../core/ui/rect-element"),e("../../core/assets/font"),e("../../core/assets/asset-pack"),e("../../core/ui/ui-dummy"));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(){function v(e){var t,r=e.forwardTexture,n=e.backwardTexture,i=e.rewindTexture,o=e.fastForwardTexture,a=e.font,s=e.fontSize,u=e.onPageChange,l=e.getCurrentPage,c=e.getTotalPages,d=e.configurator;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),(t=b(this,E(v).call(this))).getCurrentPage=l,t.getTotalPages=c,t.onPageChange=u;var f=new y.ButtonElement(r).centerAnchor().setCallback(function(){return t.onClick(1)}).setPos(80,0,0).setScale(.8),h=new y.ButtonElement(n).centerAnchor().setCallback(function(){return t.onClick(-1)}).setPos(-80,0,0).setScale(.8),p=new y.ButtonElement(o).centerAnchor().setCallback(function(){return t.onClick(1e6)}).setPos(150,0,0).setScale(.8),m=new y.ButtonElement(i).centerAnchor().setCallback(function(){return t.onClick(-1e6)}).setPos(-150,0,0).setScale(.8),g=t.number=new _.TextElement(a).setSize(s||45).setRelativeAnchor(!0,!0).setPos(0,5).markAsNonInput();return t.add(f),t.add(h),t.add(p),t.add(m),t.add(g),"function"==typeof d&&d(m,h,g,f,p),t.updateText(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(v,n.UIDummy),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(v,[{key:"onClick",value:function(e){this.onPageChange&&this.onPageChange(e),this.updateText()}},{key:"updateText",value:function(){var e=""+this.getCurrentPage();this.getTotalPages&&(e+="/"+this.getTotalPages()),this.number.setText(e)}}]),v}();r.default=s},{"../../core/assets/asset-pack":634,"../../core/assets/font":638,"../../core/ui/button-element":677,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/ui/ui-dummy":684,"../../core/ui/ui-element":685,three:615}],758:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DEOCONST=void 0;r.DEOCONST={RADIUS:2e3,HEIGHT:1100,METERS_TO_PIXELS:2/1122}},{}],759:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoHubGridItem=void 0;var n=e("../../core/ui/image-element"),i=e("three"),h=(e("../../core/ui/rect-element"),e("../common/spinner")),u=e("../../options"),o=e("../../core/utils/task-runner"),p=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("@tweenjs/tween.js")),l=e("../../core/input/input-event-source"),a=e("../../core/utils/common-tools"),s=e("../../core/ui/text-element");function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(){function f(e){var t,r=e.width,n=e.height,i=e.index,o=e.callback,a=e.font,s=e.padding,u=e.thumbMask;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=function(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?v(e):t}(this,g(f).call(this))).font=a,t.padding=s||20,t.index=i,t.width=r,t.height=n,t.callback=o,t.thumbMask=u;var l=t.image=document.createElement("img"),c=t.canvas=document.createElement("canvas");t.context=c.getContext("2d");l.crossOrigin="anonymous;",l.onload=t.onImageLoad.bind(v(t)),c.width=r,c.height=n,t.tweenGroup=new p.Group,t.isLoading=!0;var d=t.spinner=new h.Spinner({scale:2});return t.createElements(),t.add(d),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(f,i.Group),function(e,t,r){t&&c(e.prototype,t),r&&c(e,r)}(f,[{key:"onImageLoad",value:function(){var e=this;this.createPosterIfNotExists().then(function(){return e.drawPoster()}).then(function(){return e.setReadyState()})}},{key:"createPosterIfNotExists",value:function(){return this.poster||(this.texture=new i.Texture(this.canvas),this.texture.generateMipmaps=!1,this.texture.minFilter=this.texture.magFilter=i.LinearFilter,this.poster=new n.ImageElement(this.texture).setCornerRadius(u.options.cornerRadius).setSize(this.width,this.height).centerAnchor().setAlpha(0).setPos(0,0,-70),this.addPosterListeners(),this.add(this.poster)),Promise.resolve()}},{key:"addPosterListeners",value:function(){var o=this,a=!1,s=new i.Vector2;this.poster.pointerSignals.in.add(function(){o.isLoading||new p.Tween(o.poster.position,o.tweenGroup).easing(p.Easing.Quintic.Out).to({z:70},u.options.animationTimeFast).start()}),this.poster.pointerSignals.out.add(function(){o.isLoading||(a=!1,new p.Tween(o.poster.position,o.tweenGroup).easing(p.Easing.Quintic.Out).to({z:0},u.options.animationTimeFast).start())}),this.poster.pointerSignals.down.add(function(e){s.set(e.viewX,e.viewY),a=!0,Date.now()}),this.poster.pointerSignals.up.add(function(e){var t=e.source===l.InputEventSource.MOUSE||e.source===l.InputEventSource.TOUCH,r=e.viewX-s.x,n=e.viewY-s.y,i=Math.sqrt(r*r+n*n);a&&(i<50||!t)&&o.callback&&o.callback(o.index,o.data)})}},{key:"drawPoster",value:function(){var e=this;return this.nameTextField.updateLayout(),o.TaskRunner.run("hubitem",[function(){return e.context.drawImage(e.image,0,0,e.width,e.height)},function(){return a.CommonTools.drawTextureDefToCanvas(e.canvas,e.thumbMask,0,0,e.width,e.height)},function(){return a.CommonTools.drawTextElementToCanvas(e.canvas,e.nameTextField,e.padding-3,e.height-e.padding-2)},function(){return e.texture.needsUpdate=!0}])}},{key:"createElements",value:function(){(this.nameTextField=new s.TextElement(this.font).setSize(40).setMode("pre").setPos(-this.width/2+this.padding,-this.height/2+this.padding+15,0).setWidth(this.width-2*this.padding).markAsNonInput()).updateLayout()}},{key:"setLoadingState",value:function(){this.visible=!0,this.isLoading=!0,this.spinner.show(),this.tweenGroup.removeAll(),this.poster&&(new p.Tween(this.poster.position,this.tweenGroup).easing(p.Easing.Quintic.Out).to({z:-100},u.options.animationTimeFast).start(),new p.Tween(this.poster,this.tweenGroup).easing(p.Easing.Quintic.Out).to({alpha:0},u.options.animationTimeFast).start())}},{key:"setData",value:function(e){this.data=e,this.image.src=e["cover-image"]||"",this.nameTextField.setText(e.title||"")}},{key:"setReadyState",value:function(){this.visible=!0,this.isLoading=!1,this.tweenGroup.removeAll(),new p.Tween(this.poster.position,this.tweenGroup).easing(p.Easing.Quintic.Out).to({z:0},u.options.animationTimeFast).start(),new p.Tween(this.poster,this.tweenGroup).easing(p.Easing.Quintic.Out).to({alpha:1},u.options.animationTimeFast).start(),this.spinner.hide()}},{key:"setHiddenState",value:function(){this.visible=!1}},{key:"onFrameEnter",value:function(){this.tweenGroup.update()}}]),f}();r.DeoHubGridItem=f},{"../../core/input/input-event-source":663,"../../core/ui/image-element":678,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/utils/common-tools":688,"../../core/utils/task-runner":696,"../../options":717,"../common/spinner":756,"@tweenjs/tween.js":1,three:615}],760:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoHubGrid=void 0;var n=e("../../core/ui/ui-dummy"),v=e("./deo-hub-grid-item"),y=e("./deo-hub-const"),_=e("three"),b=e("../../core/utils/common-tools"),E=e("../../core/utils/math-tools"),w=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}}(e("signals")),A=e("../../core/ui/rect-element"),T=(e("../../core/components/basic-button-component"),e("../../core/components/text-over-ui-component")),S=e("../../options"),x=e("../../core/components/alpha-button-component"),M=e("../../core/ui/image-element");function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(){function g(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),t=function(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?P(e):t}(this,O(g).call(this)),"string"==typeof e.aspect&&(e.aspect=b.CommonTools.parseAspect(e.aspect)),t.columns=e.columns||4,t.rows=e.rows||3,t.aspect=e.aspect||1.6,t.spacing=e.spacing||35,t.totalHeight=e.totalHeight||y.DEOCONST.HEIGHT,t.radius=e.radius||y.DEOCONST.RADIUS,t.contentProvider=e.contentProvider,t.flat=!!e.flat,"function"!=typeof t.contentProvider||4!==t.contentProvider.length)throw new Error("Wrong content provider given!");t.itemsPerPage=t.columns*t.rows,t.itemHeight=(t.totalHeight-(t.rows-1)*t.spacing)/t.rows,t.itemWidth=t.itemHeight*t.aspect,t.totalWidth=(t.itemWidth+t.spacing)*t.columns-t.spacing,t.totalPages=10,t.currentPage=1,t.filters={},t.onFilterUpdate=new w.Signal,t.onPageChangeRequest=new w.Signal,t.onPageChange=new w.Signal,t.onThumbClick=new w.Signal,t.items=[];var r=E.MathTools.chordToAngle(e.radius,t.spacing),n=E.MathTools.chordToAngle(e.radius,t.itemWidth),i=E.MathTools.centerOfChordByAngle(n,e.radius),o=r*(t.columns-1)+n*t.columns,a=E.MathTools.chordToAngle(e.radius,100);o+=2*r+2*a;for(var s=0;s<t.rows;s++)for(var u=0;u<t.columns;u++){var l=new v.DeoHubGridItem({width:t.itemWidth,height:t.itemHeight,index:u+s*(t.rows+1),callback:t.onThumbClickCallback.bind(P(t)),font:e.font,thumbMask:e.thumbnailMask});l.rotateY(o/2-u*r-u*n-n/2-r-a),l.position.y=t.totalHeight/2-t.spacing*s-t.itemHeight*s-t.itemHeight/2,l.translateZ(-i),l.position.z+=e.radius*Math.cos(o/2),t.items.push(l),t.add(l)}var c=new M.ImageElement(e.arrowLeft).centerAnchor().markAsNonInput();c.scale.multiplyScalar(.7);var d=new M.ImageElement(e.arrowRight).centerAnchor().markAsNonInput();d.scale.multiplyScalar(.7);function f(e,t,r,n){e.updateMatrixWorld(),r.updateMatrixWorld();var i=e.localToWorld(new _.Vector3(-t/2,0,0)),o=r.localToWorld(new _.Vector3(n/2,0,0));return i.sub(o),Math.abs(i.x)}if(e.vertical){var h=Math.min(500,t.itemWidth);t.nextPageButton=new A.RectElement(h,100,0).setCornerRadius(S.options.cornerRadius).centerAnchor().setPos(0,-t.totalHeight/2-t.spacing-50,0),t.prevPageButton=new A.RectElement(h,100,0).setCornerRadius(S.options.cornerRadius).centerAnchor().setPos(0,t.totalHeight/2+t.spacing+50,0),c.rotateZ(-Math.PI/2),d.rotateZ(-Math.PI/2),t.totalWidth=f(t.items[0],t.itemWidth,t.items[t.columns-1],t.itemWidth)}else{t.prevPageButton=new A.RectElement(100,t.totalHeight,0).setCornerRadius(S.options.cornerRadius).centerAnchor().setPos(-t.totalWidth/2-t.spacing-50,0,0),t.nextPageButton=new A.RectElement(100,t.totalHeight,0).setCornerRadius(S.options.cornerRadius).centerAnchor().setPos(t.totalWidth/2+t.spacing+50,0,0),t.totalWidth+=2*(t.spacing+100);var p=E.MathTools.chordToAngle(e.radius,100),m=E.MathTools.centerOfChordByAngle(p,e.radius);t.nextPageButton.rotation.set(0,0,0),t.prevPageButton.rotation.set(0,0,0),t.nextPageButton.position.multiplyScalar(0),t.prevPageButton.position.multiplyScalar(0),t.nextPageButton.rotateY(-o/2+p/2),t.prevPageButton.rotateY(o/2-p/2),t.nextPageButton.translateZ(-m),t.prevPageButton.translateZ(-m),t.nextPageButton.position.z+=e.radius*Math.cos(o/2),t.prevPageButton.position.z+=e.radius*Math.cos(o/2),t.totalWidth=f(t.prevPageButton,100,t.nextPageButton,100)}return t.add(t.prevPageButton),t.add(t.nextPageButton),t.prevPageButton.add(c),t.nextPageButton.add(d),t.prevPageButton.addComponent(new x.AlphaButtonComponent(function(){return t.turnPage(-1)})),t.nextPageButton.addComponent(new x.AlphaButtonComponent(function(){return t.turnPage(1)})),t.nothingFoundMessage=new A.RectElement(t.itemWidth,t.itemHeight,0).setCornerRadius(S.options.cornerRadius).centerAnchor().markAsNonInput(),t.nothingFoundMessage.addComponent(new T.TextOverUIComponent("No videos found!",e.font).setSize(40)),t.add(t.nothingFoundMessage),t.nothingFoundMessage.visible=!1,t.updateData(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(g,n.UIDummy),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(g,[{key:"onThumbClickCallback",value:function(e,t){this.onThumbClick.dispatch(t)}},{key:"getFilterValue",value:function(e){return this.filters[e]}},{key:"setFilterValue",value:function(e,t){return this.filters[e]=t,this.setPage(1),this.onFilterUpdate.dispatch({name:e,value:t}),this}},{key:"turnPage",value:function(e){this.setPage(this.currentPage+e)}},{key:"setPage",value:function(e){this.currentPage=E.MathTools.clamp(e,0,this.totalPages),this.onPageChangeRequest.dispatch(),this.updateData()}},{key:"updateData",value:function(){var i=this;this.items.forEach(function(e){return e.setLoadingState()}),this.contentProvider.call(null,this.filters,this.currentPage,this.rows*this.columns,function(e){if(!e||!Array.isArray(e.items)||"number"!=typeof e.totalPages||e.totalPages<0)throw new Error("Hub grid: callback called with wrong arguments:"+JSON.stringify(e));i.nothingFoundMessage.visible=e.items.length<=0,i.totalPages=e.totalPages;for(var t=0;t<i.items.length;t++){var r=i.items[t],n=e.items[t];n?r.setData(n):r.setHiddenState()}i.onPageChange.dispatch()})}},{key:"dispose",value:function(){}}]),g}();r.DeoHubGrid=a},{"../../core/components/alpha-button-component":641,"../../core/components/basic-button-component":642,"../../core/components/text-over-ui-component":646,"../../core/ui/image-element":678,"../../core/ui/rect-element":682,"../../core/ui/ui-dummy":684,"../../core/utils/common-tools":688,"../../core/utils/math-tools":692,"../../options":717,"./deo-hub-const":758,"./deo-hub-grid-item":759,signals:612,three:615}],761:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoHubLayout=void 0;var n=e("./deo-hub-const"),C=e("../../core/utils/math-tools"),D=e("three");function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.widgets=e,this.spacing=50,this.radius=1500,this.contentOffset={alpha:0,z:0}}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"setRadius",value:function(e){return this.radius=e,this}},{key:"setSpacing",value:function(e){return this.spacing=e,this}},{key:"setContentOffsetFromString",value:function(e){return this.validPosition(e)&&(this.contentOffset=this.parsePosition(e)),this}},{key:"layout",value:function(){function n(e,t){var r=!(1<arguments.length&&void 0!==t)||t;if(i.validPosition(e.def.offset)){var n=i.parsePosition(e.def.offset);e.main.rotateOnWorldAxis(new D.Vector3(0,1,0),n.alpha),e.main.position.y+=n.z}r&&(e.main.rotateOnWorldAxis(new D.Vector3(0,1,0),+i.contentOffset.alpha),e.main.position.y+=i.contentOffset.z)}var i=this,e=this.spacing,t=0,r=C.MathTools.chordToAngle(this.radius,e),o=!0,a=!1,s=void 0;try{for(var u,l=this.widgets[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;if("number"!=typeof c.width)throw new Error("This widget has no width defined");if(c.main.position.multiplyScalar(0),c.main.rotation.set(0,0,0),!this.validPosition(c.def.position)&&!c.def.alignedTo){var d=C.MathTools.chordToAngle(this.radius,c.width);C.MathTools.centerOfChordByAngle(d,this.radius);c.main.rotateOnWorldAxis(new D.Vector3(0,1,0),-t-r-d/2),t+=d+r}}}catch(e){a=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}var f=!0,h=!1,p=void 0;try{for(var m,g=this.widgets[Symbol.iterator]();!(f=(m=g.next()).done);f=!0){var v=m.value,y=this.validPosition(v.def.position),_=!!v.def.alignedTo;if(y||_){if(y){var b=this.parsePosition(v.def.position),E=C.MathTools.chordToAngle(this.radius,v.width),w=C.MathTools.centerOfChordByAngle(E,this.radius);v.main.rotateOnWorldAxis(new D.Vector3(0,1,0),b.alpha),v.main.position.y=b.z,n(v),v.main.translateZ(-w)}}else{v.main.rotateOnWorldAxis(new D.Vector3(0,1,0),t/2);var A=C.MathTools.chordToAngle(this.radius,v.width),T=C.MathTools.centerOfChordByAngle(A,this.radius);n(v),v.main.translateZ(-T)}}}catch(e){h=!0,p=e}finally{try{f||null==g.return||g.return()}finally{if(h)throw p}}var S=!0,x=!1,M=void 0;try{for(var R,O=function(){var e=R.value,t=e.def.alignedTo;if(t){var r=i.widgets.find(function(e){return e.def.id===t});if(!r)throw new Error("Cant align to "+t);e.main.rotation.copy(r.main.rotation),e.main.position.copy(r.main.position),n(e,!1)}},P=this.widgets[Symbol.iterator]();!(S=(R=P.next()).done);S=!0)O()}catch(e){x=!0,M=e}finally{try{S||null==P.return||P.return()}finally{if(x)throw M}}return this}},{key:"validPosition",value:function(e){return!(!e||"string"!=typeof e)&&/([\-\d\.]+)\s?,\s?([\-\d\.]+)/i.test(e)}},{key:"parsePosition",value:function(e){var t=/([\-\d\.]+)\s?,\s?([\-\d\.]+)/i.exec(e);return{alpha:parseFloat(t[1]),z:parseFloat(t[2])/n.DEOCONST.METERS_TO_PIXELS}}},{key:"dispose",value:function(){this.widgets=null}}]),t}();r.DeoHubLayout=o},{"../../core/utils/math-tools":692,"./deo-hub-const":758,three:615}],762:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoHubWidgetCollection=void 0;var s=n(e("../../bootstrap/attr-extractor")),u=e("../../misc/global-parameters"),a=n(e("jquery"));function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this._defs=e||[],this._links=t||[],this._lastId=0}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(r,[{key:"setErrorCallback",value:function(e){return this.onError=e,this}},{key:"emitError",value:function(e){this.onError(e)}},{key:"getNextIndex",value:function(){return this._lastId++}},{key:"addDef",value:function(e){return this._defs.push(e),this}},{key:"addLink",value:function(e){return this._links.push(e),this}},{key:"extractCommonWidgetAttrs",value:function(e){var t=new s.default(e,this.emitError.bind(this));return t.extract("id"),t.extract("position"),t.extract("aligned-to").stringLongerThan(0),t.extract("offset"),t.extract("order"),t.extract("content-height").number().greaterThan(.7).lessThan(3),{index:this.getNextIndex(),id:t.id,contentHeight:parseFloat(t["content-height"]),alignedTo:t["aligned-to"],position:t.position,order:t.order,offset:t.offset}}},{key:"addPagedList",value:function(e){var t=new s.default(e,this.emitError.bind(this));t.extract("title").stringLongerThan(0),t.extract("attached-to").mandatory(),t.extract("filter").stringLongerThan(0).mandatory();var r=this.extractCommonWidgetAttrs(e),n=[];(0,a.default)(e).children().each(function(e,t){var r=(0,a.default)(t).text();r&&"string"==typeof r&&0<r.length&&n.push(r)});var i={type:"list",title:t.title,filter:t.filter,attachedTo:t["attached-to"],items:n},o=Object.assign(r,i);this.addLink({fromIndex:o.index,toId:t["attached-to"],from:o}),this.addDef(o)}},{key:"addGrid",value:function(e){var t=new s.default(e,this.emitError.bind(this));t.extract("id").default(""),t.extract("columns").number().positive().default(4).lessThan(10),t.extract("rows").number().positive().default(3).lessThan(10),t.extract("aspect").aspect().default("16:10"),t.extract("vertical").boolean(),t.extract("content-provider").stringLongerThan(0).mandatory();var r=(0,u.getGlobalParam)(t["content-provider"].split("."),window);r&&"function"==typeof r&&4===r.length||this.emitError("content-provider should be a function with 4 arguments");var n=this.extractCommonWidgetAttrs(e),i={type:"grid",columns:t.columns,rows:t.rows,aspect:t.aspect,vertical:t.vertical,contentProvider:r},o=Object.assign(n,i);this.addDef(o)}},{key:"addPaginator",value:function(e){var t=this.extractCommonWidgetAttrs(e),r=new s.default(e,this.emitError.bind(this));r.extract("attached-to").mandatory();var n={type:"paginator",attachedTo:r["attached-to"]},i=Object.assign(t,n);this.addLink({fromIndex:i.index,toId:r["attached-to"],from:i}),this.addDef(i)}},{key:"addImg",value:function(e){var t=this.extractCommonWidgetAttrs(e),r=new s.default(e,this.emitError.bind(this));r.extract("src").stringLongerThan(0).mandatory(),r.extract("scale").number().positive().default(1),r.extract("onclick").stringLongerThan(0);var n=r.get("onclick"),i=(0,u.getGlobalParam)(n,window);"function"!=typeof i&&n&&this.emitError("Can't find onclick handler in window: "+r.get("onclick"));var o={type:"img",src:r.get("src"),scale:r.get("scale"),onclick:i},a=Object.assign(t,o);this.addDef(a)}},{key:"addSpacer",value:function(e){var t=this.extractCommonWidgetAttrs(e),r=new s.default(e,this.emitError.bind(this));r.extract("width").number().greaterThan(0).lessThan(2).default(.2);var n=Object.assign(t,{type:"spacer",width:r.get("width")});this.addDef(n)}},{key:"fromHTML",value:function(e){var r=this;(0,a.default)(e).children().each(function(e,t){switch(t.tagName.toLowerCase()){case"deo-list":r.addPagedList(t);break;case"deo-grid":r.addGrid(t);break;case"deo-paginator":r.addPaginator(t);break;case"deo-spacer":r.addSpacer(t);break;case"deo-img":r.addImg(t)}})}},{key:"getDefs",value:function(){return this._defs}},{key:"getLinks",value:function(){return this._links}}]),r}();r.DeoHubWidgetCollection=o},{"../../bootstrap/attr-extractor":622,"../../misc/global-parameters":714,jquery:582}],763:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoHubWidgetFactory=void 0;var n,u=e("./paged-list"),l=e("../../core/ui/rect-element"),c=e("../../options"),d=e("./deo-hub-const"),f=e("../../core/ui/text-element"),h=e("./paginator"),i=e("./deo-hub-grid"),o=e("./grid-paginator"),a=e("three"),s=y(e("signals")),p=e("../../core/ui/image-element"),m=y(e("@tweenjs/tween.js")),g=(e("../../core/utils/common-tools"),e("../../core/utils/math-tools")),v=e("../../core/utils/listeners-manager");(n=e("../hub-v2/list-paginator"))&&n.__esModule;function y(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var E=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.pack=e,this.contentHeight=d.DEOCONST.HEIGHT,this.spacing=.05,this.radius=d.DEOCONST.RADIUS,this.onDispose=new s.Signal,this.listenersManager=new v.ListenersManager}return function(e,t,r){t&&b(e.prototype,t),r&&b(e,r)}(t,[{key:"setContentHeight",value:function(e){return this.contentHeight=e,this}},{key:"setSpacing",value:function(e){return this.spacing=e,this}},{key:"setRadius",value:function(e){return this.radius=e,this}},{key:"createList",value:function(e){var t=this.pack,r=e.contentHeight/d.DEOCONST.METERS_TO_PIXELS||this.contentHeight,n=new l.RectElement(400,r,0).centerAnchor().setCornerRadius(c.options.cornerRadius).markAsNonInput(),i=new f.TextElement(t.getFont("arial")).setSize(60).setText(e.title||"List").markAsNonInput().setRelativeAnchor(.5,.5).setPos(0,r/2-60,0),o=(r-150-120)/80.5-1,a=new u.PagedList({items:e.items,padding:80.5,showAmount:o,font:t.getFont("arial"),buttonTexture:t.getTexture("button_bg"),buttonTextureHover:t.getTexture("button_bg_hover"),buttonTextureActive:t.getTexture("button_bg_active")});a.position.y=r/2-120;var s=new h.Paginator(t.getTexture("left_arrow"),t.getTexture("right_arrow"),200,t.getFont("arial"),function(e){return a.turnPage(e)},function(){return a.currentPage+1});return s.position.y=-r/2+75,n.add(i),n.add(s),n.add(a),{def:e,width:400,main:n,elements:{backdrop:n,list:a,paginator:s,title:i}}}},{key:"createGrid",value:function(e){var t=this.pack,r=new i.DeoHubGrid({totalHeight:e.contentHeight/d.DEOCONST.METERS_TO_PIXELS||this.contentHeight,aspect:e.aspect,rows:e.rows,columns:e.columns,font:t.getFont("arial"),thumbnailMask:t.getTexture("thumb_mask"),arrowLeft:t.getTexture("page_arrow_left"),arrowRight:t.getTexture("page_arrow_right"),spacing:this.spacing,vertical:!!e.vertical,contentProvider:e.contentProvider,radius:this.radius});return{def:e,width:r.totalWidth,main:r,elements:{grid:r}}}},{key:"createPaginator",value:function(e){var t=this.pack,r=new o.GridPaginator({buttonTexture:t.getTexture("paginator_button"),buttonTextureActive:t.getTexture("paginator_button_active"),skipButtonTexture:t.getTexture("skip_button"),font:t.getFont("arial")});return{def:e,width:700,main:r,elements:{paginator:r}}}},{key:"createSpacer",value:function(e){return{def:e,width:e.width/d.DEOCONST.METERS_TO_PIXELS,main:new a.Group,elements:{}}}},{key:"createImg",value:function(t){var r=this,n=document.createElement("img");n.crossOrigin="anonymous",n.src=t.src;var i=new p.ImageElement;return i.scale.multiplyScalar(t.scale||1),i.alpha=0,n.onload=function(){var e=new a.Texture(n);g.MathTools.isPoT(n.width)&&g.MathTools.isPoT(n.height)||(e.magFilter=e.minFilter=a.LinearFilter,e.generateMipmaps=!1),i.setTexture(e),i.centerAnchor(),e.needsUpdate=!0,new m.Tween(i).to({alpha:1},350).easing(m.Easing.Quadratic.Out).start(),"function"==typeof t.onclick&&r.listenersManager.binding(i.pointerSignals.down,function(){return t.onclick()}),r.onDispose.addOnce(function(){e.dispose(),n.src="",e=n=null})},{def:t,width:100,main:i,elements:{img:i}}}},{key:"verifyWidgetInterface",value:function(e){if(!e)throw new Error("No widget given");if("number"!=typeof e.width||e.width<=0||isNaN(e.width))throw console.log(e),new Error("Wrong widget width");if(!e.main)throw console.log(e),new Error("Widget main element is undefined");if(!e.def||"object"!==_(e.def))throw console.log(e),new Error("No def reference in widget");return e}},{key:"attachListToGrid",value:function(e,t,r){e.setCallbacks(function(){return t.getFilterValue(r)},function(e){return t.setFilterValue(e)})}},{key:"createWidgetByDef",value:function(e){var t=null;switch(e.type){case"list":t=this.createList(e);break;case"grid":t=this.createGrid(e);break;case"paginator":t=this.createPaginator(e);break;case"spacer":t=this.createSpacer(e);break;case"img":t=this.createImg(e)}return this.verifyWidgetInterface(t)}},{key:"dispose",value:function(){this.pack=null,this.onDispose.dispatch(),this.listenersManager.dispose()}}]),t}();r.DeoHubWidgetFactory=E},{"../../core/ui/image-element":678,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/utils/common-tools":688,"../../core/utils/listeners-manager":691,"../../core/utils/math-tools":692,"../../options":717,"../hub-v2/list-paginator":757,"./deo-hub-const":758,"./deo-hub-grid":760,"./grid-paginator":766,"./paged-list":769,"./paginator":770,"@tweenjs/tween.js":1,signals:612,three:615}],764:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoHubWidgetLinker=void 0;var i=e("../../core/utils/listeners-manager");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function n(e,t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.widgets=e,this.links=t,this.idMap={},this.indexMap={},this.listenersManager=new i.ListenersManager,e.forEach(function(e){if("string"==typeof e.def.id&&0<e.def.id.length&&(r.idMap[e.def.id]=e),"number"!=typeof e.def.index)throw new Error("Widget index is not set. This should happen at all");r.indexMap[e.def.index]=e,r.processWidget(e)}),this.linkFuncs=[{from:"paginator",to:"grid",fn:this.linkPaginatorToGrid},{from:"list",to:"grid",fn:this.linkListToGrid}],t.forEach(function(e){return r.processLink(e)})}return function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(n,[{key:"setThumbnailClickCallback",value:function(e){return this.thumbClickCallback=e,this}},{key:"processWidget",value:function(e){var t=this;e&&"grid"===e.def.type&&this.listenersManager.binding(e.main.onThumbClick,function(e){t.thumbClickCallback&&t.thumbClickCallback(e)})}},{key:"processLink",value:function(e){var t=this.indexMap[e.fromIndex],r=this.idMap[e.toId];if(!r)throw new Error("No target found to attach to: "+e.toId);var n=this.linkFuncs.find(function(e){return e.from===t.def.type&&e.to===r.def.type});if(!n)throw new Error("Can't link ".concat(t.def.type," to ").concat(r.def.type));n.fn.call(this,t,r)}},{key:"linkPaginatorToGrid",value:function(e,t){var r=e.main,n=t.main;this.listenersManager.binding(n.onPageChangeRequest,function(){return r.updateButtons()}),this.listenersManager.binding(n.onPageChange,function(){return r.updateButtons()}),r.setGetters(function(){return n.currentPage},function(){return n.totalPages}),r.setSelectPageCallback(function(e){return n.setPage(e)}),r.updateButtons(!0)}},{key:"linkListToGrid",value:function(t,e){var r=t.elements.list,n=e.main;r.setCallbacks(function(){return n.getFilterValue(t.def.filter)},function(e){return n.setFilterValue(t.def.filter,e)}),this.listenersManager.binding(n.onFilterUpdate,function(){return r.updateButtonsState()})}},{key:"dispose",value:function(){this.listenersManager.dispose(),this.widgets=null,this.linkFuncs=null,this.idMap=this.indexMap=null}}]),n}();r.DeoHubWidgetLinker=n},{"../../core/utils/listeners-manager":691}],765:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DeoHub=void 0;var n,_=e("../../options"),i=e("../../core/state/state"),o=e("../../defines"),b=e("./deo-hub-widget-factory"),a=e("../../core/assets/asset-pack"),E=e("../../core/controls/camera-drag-controls"),w=e("../../core/ui/ui-group"),A=e("./deo-hub-layout"),T=(e("three"),e("./deo-hub-const")),s=e("../common/controller-view"),S=(e("../common/reticle"),e("./deo-hub-widget-linker")),u=e("../../core/ui/mask-360"),x=e("../../core/utils/vendor-tools"),M=e("../../core/controls/camera-magic-window-controls"),l=(n=e("reqwest"))&&n.__esModule?n:{default:n};function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var R=T.DEOCONST.METERS_TO_PIXELS,m=function(){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,h(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,i.State),function(e,t,r){t&&d(e.prototype,t),r&&d(e,r)}(t,[{key:"show",value:function(e){var t=this;this.app.getService("render-manager").setClearColor(_.options.colors.darkGray),this.loadAssets().then(function(e){return t.pack=e}).then(function(){return t.pack.createFont("arial","arial-descriptor",t.pack.getTexture("arial_texture"))}).then(function(){t.createWidgets(),t.createControllers(),t.createMask();var e=t.app.storage.get("recenter_angle",0);t.getLayer("main").scene.rotation.y=e,t.camera.rotation.y=e}).then(function(){return t.app.bus.internal.dispatchEvent({type:_.options.internalEvents.HIDE_GLOBAL_SPINNER})}).then(function(){return t.ready=!0}),(0,l.default)({url:_.options.api.thirdPartySessions,method:"post",crossOrigin:!0,data:{title:document.title,host:document.location.href,event:"hub",sr:window.screen?window.screen.width+"x"+window.screen.height:void 0,vp:window.innerWidth+"x"+window.innerHeight},success:function(e){return 1},error:console.warn})}},{key:"loadAssets",value:function(){var n=this;return new Promise(function(e){var t=n.basePath=o.DEFINES.DEO_BASE_PATH,r=new a.AssetPack(function(){return e(r)});r.loadFile(t+"assets/arial.fnt","arial-descriptor"),r.loadAtlas(t+"assets/ui/hub/hub_atlas","main_atlas"),r.start()})}},{key:"createWidgets",value:function(){var e=this.app.getValue("global-params").get("contentHeight")/R||T.DEOCONST.HEIGHT,t=this.app.getValue("global-params").get("contentSpacing")/R||50,r=this.app.getValue("global-params").get("contentOffset"),n=T.DEOCONST.RADIUS,i=this.app.getValue("global-params").get("hubWidgets");i||this.app.bus.internal.dispatchEvent({type:_.options.internalEvents.DEO_ERROR,message:"No widgets provided for hub"});var o=this.createLayer("main",{clearBeforeRender:WebGLRenderingContext.COLOR_BUFFER_BIT});o.scene.scale.multiplyScalar(R);var a=this.camera=o.camera;this.app.getService("input-manager").setCamera(a);var s=this.cameraDragControls=new E.CameraDragControls(this.app,this.camera),u=this.magicWindow=new M.CameraMagicWindowControls(this.app,this.camera);u.active=!1,_.options.enableMagicWindowWhenSupported&&x.VendorTools.getDeviceOrientationSupported().then(function(e){s.active=!e,u.active=e});var l=this.uiGroup=new w.UIGroup(this.app);o.scene.add(l),l.position.set(0,0,0);var c=this.factory=new b.DeoHubWidgetFactory(this.pack).setRadius(n).setContentHeight(e).setSpacing(t),d=[],f=!0,h=!1,p=void 0;try{for(var m,g=i.getDefs()[Symbol.iterator]();!(f=(m=g.next()).done);f=!0){var v=m.value,y=c.createWidgetByDef(v);l.add(y.main),d.push(y)}}catch(e){h=!0,p=e}finally{try{f||null==g.return||g.return()}finally{if(h)throw p}}this.linker=new S.DeoHubWidgetLinker(d,i.getLinks()).setThumbnailClickCallback(this.onThumbClick.bind(this)),this.layout=new A.DeoHubLayout(d).setContentOffsetFromString(r).setRadius(n).setSpacing(t).layout()}},{key:"createControllers",value:function(){var e=this.createLayer("controllers",{camera:this.camera}),t=this.controllerView=new s.ControllerView(this.app,o.DEFINES.DEO_BASE_PATH);e.scene.add(t)}},{key:"createMask",value:function(){var e=this.createLayer("mask",{camera:this.camera}),t=this.mask=new u.Mask360(0);e.scene.add(t),t.fadeOut()}},{key:"update",value:function(){this.ready&&(this.cameraDragControls.update(),this.magicWindow.update())}},{key:"onThumbClick",value:function(e){var t=this;this.mask.fadeIn(function(){e.autoplay=!0,t.app.getService("state-manager").show("cinema",e)})}},{key:"dispose",value:function(){this.ready&&(this.pack.dispose(),this.layout.dispose(),this.linker.dispose(),this.factory.dispose())}}]),t}();r.DeoHub=m},{"../../core/assets/asset-pack":634,"../../core/controls/camera-drag-controls":649,"../../core/controls/camera-magic-window-controls":650,"../../core/state/state":676,"../../core/ui/mask-360":679,"../../core/ui/ui-group":686,"../../core/utils/vendor-tools":698,"../../defines":710,"../../options":717,"../common/controller-view":750,"../common/reticle":754,"./deo-hub-const":758,"./deo-hub-layout":761,"./deo-hub-widget-factory":763,"./deo-hub-widget-linker":764,reqwest:609,three:615}],766:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GridPaginator=void 0;var n,i=e("../../core/ui/ui-element"),s=e("../../core/ui/button-element"),u=e("../../core/ui/text-element"),l=e("../../core/assets/font"),b=(n=e("@tweenjs/tween.js"))&&n.__esModule?n:{default:n},E=e("../../options"),c=e("../../core/assets/asset-pack"),d=e("../../core/ui/image-element"),f=e("../../core/components/tint-button-component");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function m(e,t,r){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(){function a(n){var i;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i=p(this,g(a).call(this)),!n)throw"Options object expected";if(!(n.buttonTexture instanceof c.TextureDef))throw"buttonTexture should be Texture";if(!(n.buttonTextureActive instanceof c.TextureDef))throw"buttonTextureActive should be Texture";if(!(n.skipButtonTexture instanceof c.TextureDef))throw"skipButtonTexture should be Texture";if(!(n.font instanceof l.Font))throw"font should be instance of Font";i.font=n.font,i.buttonTexture=n.buttonTexture,i.buttonTextureActive=n.buttonTextureActive,i.skipButtonTexture=n.skipButtonTexture,i.setPageCallback=n.setPageCallback,i.getTotalPagesMethod=n.getTotalPagesMethod,i.getCurrentPageMethod=n.getCurrentPageMethod,i.tweenGroup=new b.default.Group,i.tweenButtonsGroup=new b.default.Group,i.buttons=[];for(var o=i.padding=20,e=function(e){var t=new u.TextElement(i.font).setText(""+e).setSize(n.fontSize||60).setAlign("center").setColor(n.fontColor||16777215);t.relativeAnchorX=t.relativeAnchorY=!0,t.noInput=!0,t.position.y+=5;var r=new d.ImageElement(i.buttonTexture).setCornerRadius(E.options.cornerRadius).centerAnchor().addComponent(new f.TintButtonComponent(function(){i.onButtonPress(e)}).setColors(E.options.colors.orange,E.options.colors.lightOrange));r.position.x=e*(100+o),i.add(r),r.add(t),i.buttons.push(r)},t=0;t<9;t++)e(t);i.skip5=new s.ButtonElement(i.skipButtonTexture,function(){return i.skip(5)}).setCornerRadius(E.options.cornerRadius).centerAnchor();var r=new u.TextElement(i.font).setText("Skip 5").setSize(n.fontSize||60).setAlign("center");return r.relativeAnchorX=r.relativeAnchorY=!0,r.noInput=!0,r.position.y+=5,i.skip5.add(r),i.skip5.position.x=i.buttons[i.buttons.length-1].position.x+50+i.skipButtonTexture.size.width/2+o,i.add(i.skip5),i.buttons.push(i.skip5),i.skip10=new s.ButtonElement(i.skipButtonTexture,function(){return i.skip(10)}).setCornerRadius(E.options.cornerRadius).centerAnchor(),(r=new u.TextElement(i.font).setText("Skip 10").setSize(n.fontSize||60).setAlign("center")).relativeAnchorX=r.relativeAnchorY=!0,r.noInput=!0,r.position.y+=5,i.skip10.add(r),i.skip10.position.x=i.buttons[i.buttons.length-1].position.x+i.skipButtonTexture.size.width+o,i.add(i.skip10),i.buttons.push(i.skip10),i.updateButtons(!0),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(a,i.UIElement),function(e,t,r){t&&h(e.prototype,t),r&&h(e,r)}(a,[{key:"setGetters",value:function(e,t){return this.getCurrentPageMethod=e,this.getTotalPagesMethod=t,this}},{key:"setSelectPageCallback",value:function(e){return this.setPageCallback=e,this}},{key:"skip",value:function(e){if(this.getCurrentPageMethod&&this.getTotalPagesMethod){var t=this.getCurrentPageMethod();this.setPageCallback&&this.setPageCallback(t+e,e),this.updateButtons()}}},{key:"onButtonPress",value:function(e){if(this.getCurrentPageMethod&&this.getTotalPagesMethod){var t=parseInt(this.buttons[e].children[0].text);this.getCurrentPageMethod()!=t&&this.setPageCallback&&this.setPageCallback(t)}}},{key:"updateButtons",value:function(e){if(this.getCurrentPageMethod&&this.getTotalPagesMethod){e="boolean"==typeof e&&e;var t=this.getCurrentPageMethod(),r=this.getTotalPagesMethod();if(!(1<r))return this.tweenGroup.removeAll(),this.inputEnabled=!1,void new b.default.Tween(this,this.tweenGroup).easing(b.default.Easing.Quintic.Out).to({alpha:0},E.options.animationTimeFast).start();if(this.inputEnabled=!0,this.tweenGroup.removeAll(),new b.default.Tween(this,this.tweenGroup).easing(b.default.Easing.Quintic.Out).to({alpha:1},E.options.animationTimeFast).start(),6<r){for(var n=0;n<5;n++){var i=this.buttons[n+2],o=i.children[0],a=-1;i.visible=!0,(a=r-3<=t?r-5+n+1:5<=t?t-2+n:n+1)==t?this.buttons[n+2].setTexture(this.buttonTextureActive):this.buttons[n+2].setTexture(this.buttonTexture),o.setText(""+a)}this.buttons[0].children[0].setText("1"),this.buttons[1].children[0].setText("..."),this.buttons[1].inputEnabled=!1,this.buttons[8].children[0].setText(r+""),this.buttons[7].children[0].setText("..."),this.buttons[7].inputEnabled=!1,this.buttons[0].visible=5<=t,this.buttons[1].visible=5<=t,this.buttons[7].visible=t<r-3,this.buttons[8].visible=t<r-3,this.skip5.visible=5<=r-t,this.skip10.visible=10<=r-t}else{this.buttons[0].visible=!1,this.buttons[1].visible=!1,this.buttons[8].visible=!1,this.buttons[9].visible=!1,this.buttons[10].visible=!1;for(var s=0;s<6;s++){var u=this.buttons[s+2].children[0],l=s+1;this.buttons[s+2].visible=s<r,l==t?this.buttons[s+2].setTexture(this.buttonTextureActive):this.buttons[s+2].setTexture(this.buttonTexture),u.setText(""+l)}}for(var c=!1,d=r=0;d<this.buttons.length;d++){var f=this.buttons[d];f.visible&&(r+=f.texture.size.width),c&&(r+=this.padding),c=f.visible}var h=-r/2,p=!0,m=!1,g=void 0;try{for(var v,y=this.buttons[Symbol.iterator]();!(p=(v=y.next()).done);p=!0){var _=v.value;_.visible&&(h+=_.texture.size.width/2,e?_.position.x=h:new b.default.Tween(_.position,this.tweenButtonsGroup).easing(b.default.Easing.Quintic.Out).to({x:h},E.options.animationTimeFast).start(),h+=_.texture.size.width/2+this.padding)}}catch(e){m=!0,g=e}finally{try{p||null==y.return||y.return()}finally{if(m)throw g}}}}},{key:"onFrameEnter",value:function(){m(g(a.prototype),"onFrameEnter",this).call(this),this.tweenButtonsGroup.update(),this.tweenGroup.update()}},{key:"dispose",value:function(){this.tweenButtonsGroup.removeAll(),this.tweenGroup.removeAll()}}]),a}();r.GridPaginator=a},{"../../core/assets/asset-pack":634,"../../core/assets/font":638,"../../core/components/tint-button-component":647,"../../core/ui/button-element":677,"../../core/ui/image-element":678,"../../core/ui/text-element":683,"../../core/ui/ui-element":685,"../../options":717,"@tweenjs/tween.js":1}],767:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HubItemState=r.HubItem=void 0;var n,i=e("three"),u=e("../../core/ui/image-element"),o=e("../../core/ui/text-element"),l=(n=e("@tweenjs/tween.js"))&&n.__esModule?n:{default:n},a=e("../../core/assets/font"),c=e("../../core/ui/rect-element"),s=e("../common/spinner"),d=e("../../options"),f=e("../../core/utils/math-tools"),h=e("../../core/utils/common-tools"),p=e("../../core/utils/task-runner"),m=e("../../core/input/input-event-source"),g=e("../../core/components/tint-button-component"),v=e("../../core/components/text-over-ui-component"),y=(e("../../core/utils/messenger"),e("./hub-messages"));function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=function(){function n(e,t){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),!(e.font&&e.font instanceof a.Font))throw"params.font should be Font";return e.width=e.width||200,e.height=e.height||200,e.padding=e.padding||15,(r=E(this,w(n).call(this))).index=t,r.messenger=e.messenger,r.params=e,r.price=-1,r.tweenGroup=new l.default.Group,r.image=document.createElement("img"),r.image.crossOrigin="Anonymous",r.isFull=!1,r.isPremium=!1,r.isLoading=!0,r.texture=null,r.canvas=document.createElement("canvas"),r.canvas.width=f.MathTools.toNextPoT(e.width),r.canvas.height=f.MathTools.toNextPoT(e.height),r.canvasContext=r.canvas.getContext("2d"),r.createElements(),r.image.onload=function(){null===r.texture&&r.createPoster(),r.drawPoster().then(function(){r.isLoading=!1,r.poster.alpha=0,r.tweenGroup.removeAll(),new l.default.Tween(r.poster.position,r.tweenGroup).easing(l.default.Easing.Quintic.Out).to({z:0},d.options.animationTimeFast).start(),new l.default.Tween(r.poster,r.tweenGroup).easing(l.default.Easing.Quintic.Out).to({alpha:1},d.options.animationTimeFast).start(),r.spinner.hide(),r.texture.needsUpdate=!0})},r.image.onabort=r.image.onerror=r.image.onsuspend=function(e){console.warn("Thumbnail loading failed:"),console.warn(e)},r.spinner=new s.Spinner({scale:2}).show(),r.add(r.spinner),r.loading(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(n,i.Group),function(e,t,r){t&&b(e.prototype,t),r&&b(e,r)}(n,[{key:"createElements",value:function(){var e=this.params;(this.nameTextField=new o.TextElement(e.font).setSize(40).setMode("pre").setPos(-e.width/2+e.padding,-e.height/2+e.padding+15,0).setWidth(e.width-2*e.padding).markAsNonInput()).updateLayout();this.likesTextField=new o.TextElement(e.font).setSize(35).setLineHeight(40).setMode("nowrap").setText("13:22").setPos(-e.width/2+e.padding+40,e.height/2-e.padding,0).setRelativeAnchor(0,0).markAsNonInput(),this.timeTextField=new o.TextElement(e.font).setSize(35).setLineHeight(40).setMode("nowrap").setText("13:22").setPos(-e.width/2+e.padding+40,e.height/2-e.padding,0).setRelativeAnchor(0,0).markAsNonInput()}},{key:"createPoster",value:function(){var t=this,o=this.params;this.texture=new i.Texture(this.canvas),this.texture.minFilter=i.LinearMipMapLinearFilter,this.texture.anisotropy=16;var e=this.poster=new u.ImageElement(this.texture).setCornerRadius(d.options.cornerRadius);e.position.z=-100,this.add(e),e.setSize(o.width,o.height),e.texture.uv={umin:0,vmax:1,umax:o.width/this.canvas.width,vmin:1-o.height/this.canvas.height},e.texture.size={width:o.width,height:o.height},e.centerAnchor();var a=!1,s=new i.Vector2;if(this.messenger&&!0===this.params.app.getValue("global-params").get("enableVideoPurchase")){var r=this.buyButton=new c.RectElement(110,50).setPos(o.width/2-55-15,o.height/2-25-15).setCornerRadius(1e3).centerAnchor().setAlpha(.6).addComponent(new g.TintButtonComponent(function(e){t.messenger.post(y.HubMessages.REQUEST_CONFIRM_PURCHASE_POPUP,{id:t.videoId}),e.stopped=!0}).setColors(0,d.options.colors.lightOrange)).addComponent(new v.TextOverUIComponent("$14.99",o.font).setSize(30).setPos(0,6));this.setBuyButtonState(!!this.isFull,this.price),e.add(r)}this.messenger&&this.messenger.subscribe(y.HubMessages.PURCHASE_CONFIRMED,function(e){e.id&&t.videoId===e.id&&t.setIsFull(!0)}),e.pointerSignals.down.add(function(e){s.set(e.viewX,e.viewY),a=!0,Date.now()}),e.pointerSignals.in.add(function(){t.isLoading||new l.default.Tween(t.poster.position,t.tweenGroup).easing(l.default.Easing.Quintic.Out).to({z:70},d.options.animationTimeFast).start()}),e.pointerSignals.out.add(function(){t.isLoading||(a=!1,new l.default.Tween(t.poster.position,t.tweenGroup).easing(l.default.Easing.Quintic.Out).to({z:0},d.options.animationTimeFast).start())}),e.pointerSignals.up.add(function(e){var t=e.source===m.InputEventSource.MOUSE||e.source===m.InputEventSource.TOUCH,r=e.viewX-s.x,n=e.viewY-s.y,i=Math.sqrt(r*r+n*n);a&&(i<50||!t)&&o.callback&&o.callback()})}},{key:"drawPoster",value:function(){var e=this,t=this.params,r=t.padding;return p.TaskRunner.remove("hubitem"+this.index),p.TaskRunner.run("hubitem"+this.index,[function(){return e.canvasContext.drawImage(e.image,0,0,e.image.naturalWidth,e.image.naturalHeight,0,0,t.width,t.height)},function(){return t.thumbMask?h.CommonTools.drawTextureDefToCanvas(e.canvas,t.thumbMask,0,0):null},function(){e.isFull,e.isPremium&&t.premiumVideoIcon&&h.CommonTools.drawTextureDefToCanvas(e.canvas,t.premiumVideoIcon,r,r+2),t.likeTimeIcon&&h.CommonTools.drawTextureDefToCanvas(e.canvas,t.likeTimeIcon,r,t.height-r-21-2),h.CommonTools.drawTextElementToCanvas(e.canvas,e.likesTextField,2*t.padding+21-4,t.height-r-2-2),h.CommonTools.drawTextElementToCanvas(e.canvas,e.timeTextField,t.width-t.padding-e.timeTextField.realWidth,t.height-r-2-2)},function(){h.CommonTools.drawTextElementToCanvas(e.canvas,e.nameTextField,t.padding-3,t.height-r-21-r-5-2)}])}},{key:"setPoster",value:function(e){this.texture&&(this.texture.needsUpdate=!1),this.lastSrc=e,this.image.src=e}},{key:"setState",value:function(e){switch(e){case S.HIDDEN:case S.LOADING:case S.READY:}}},{key:"setPrice",value:function(e){return this.price=e,this.setBuyButtonState(this.isFull,e),this}},{key:"setName",value:function(e,t){return this.nameTextField.setText((t?t+" - ":"")+e),this.nameTextField.updateLayout(),this}},{key:"setMeta",value:function(e,t){this.likesTextField.setText(""+(t||0)),this.likesTextField.updateLayout(),this.timeTextField.setText(f.MathTools.formatTime(e)+""),this.timeTextField.updateLayout()}},{key:"setId",value:function(e){this.videoId=e}},{key:"setIsFull",value:function(e){this.isFull=e,this.setBuyButtonState(e,this.price)}},{key:"setBuyButtonState",value:function(e,t){this.buyButton&&(e?(this.buyButton.visible=!0,this.buyButton.getComponentByType(g.TintButtonComponent).setColors(d.options.colors.green),this.buyButton.getComponentByType(v.TextOverUIComponent).setText("Got it!")):"number"==typeof t&&0<this.price?(this.buyButton.visible=!0,this.buyButton.getComponentByType(g.TintButtonComponent).setColors(0,d.options.colors.lightOrange),this.buyButton.getComponentByType(v.TextOverUIComponent).setText("$"+t)):this.buyButton.visible=!1,this.buyButton.inputEnabled=!e)}},{key:"setIsPremium",value:function(e){this.isPremium=e}},{key:"loading",value:function(){this.show(),this.tweenGroup.removeAll(),this.isLoading=!0,this.poster&&(new l.default.Tween(this.poster.position,this.tweenGroup).easing(l.default.Easing.Quintic.Out).to({z:-100},d.options.animationTimeFast).start(),new l.default.Tween(this.poster,this.tweenGroup).easing(l.default.Easing.Quintic.Out).to({alpha:0},d.options.animationTimeFast).start()),this.spinner.show()}},{key:"hide",value:function(){this.visible=!1}},{key:"show",value:function(){this.visible=!0}},{key:"onFrameEnter",value:function(){this.tweenGroup.update()}},{key:"dispose",value:function(){this.tweenGroup.removeAll(),p.TaskRunner.remove("hubitem"+this.index),this.texture&&this.texture.dispose()}}]),n}();r.HubItem=T;var S={HIDDEN:0,LOADING:1,READY:2};r.HubItemState=S},{"../../core/assets/font":638,"../../core/components/text-over-ui-component":646,"../../core/components/tint-button-component":647,"../../core/input/input-event-source":663,"../../core/ui/image-element":678,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/utils/common-tools":688,"../../core/utils/math-tools":692,"../../core/utils/messenger":693,"../../core/utils/task-runner":696,"../../options":717,"../common/spinner":756,"./hub-messages":768,"@tweenjs/tween.js":1,three:615}],768:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HubMessages=void 0;var n=(0,e("../../misc/prefix-properties").prefixProperties)("hub:",{REQUEST_DELAYED_RECENTER:"request-recenter",PURCHASE_CONFIRMED:"purchase-confirmed",REQUEST_CONFIRM_PURCHASE_POPUP:"request-confirm-purchase-popup",REQUEST_SIGNIN_POPUP:"request-signin-popup"});r.HubMessages=n},{"../../misc/prefix-properties":716}],769:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PagedList=void 0;var n,d=e("three"),i=e("../../core/ui/ui-element"),f=e("../../core/ui/text-element"),h=(n=e("@tweenjs/tween.js"))&&n.__esModule?n:{default:n},p=e("../../core/ui/rect-element"),m=e("../../core/assets/font"),g=(e("../../core/ui/button-element"),e("../../core/assets/asset-pack")),v=e("../../core/components/basic-button-component"),y=e("../../core/ui/image-element"),_=e("../../options"),b=e("signals");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}function w(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=A(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=function(){function c(e){var n;if(E(this,c),n=w(this,A(c).call(this)),!e)throw"Options object expected";var t=Math.round(e.showAmount||6),i=e.padding||100;if(!Array.isArray(e.items))throw"items: array of list items expected";var r=e.items;if(!(e.font instanceof m.Font))throw"font: Font expected";var o=e.font;if(!(e.buttonTexture instanceof g.TextureDef))throw"buttonTexture: Texture expected";var a=n.buttonTexture=e.buttonTexture;if(!(e.buttonTextureHover instanceof g.TextureDef))throw"buttonTextureHover: Texture expected";var s=n.buttonTextureHover=e.buttonTextureHover;if(!(e.buttonTextureActive instanceof g.TextureDef))throw"buttonTextureActive: Texture expected";var u=n.buttonTextureActive=e.buttonTextureActive;n.allowToggle="boolean"!=typeof e.allowToggle||e.allowToggle,n.setCurrent=e.setCurrent,n.getCurrent=e.getCurrent,n.tweenGroup=new h.default.Group,n.padding=i,n.showAmount=t,n.currentPage=0,n.items=r,n.animationTime=600,n.fontSize=e.fontSize||46,n.onSelect=new b.Signal,n._dummyVec=new d.Vector3;var l=n.backdrop=new p.RectElement(a.size.width,t*i-(i-a.size.height),16711680);return l.alpha=0,l.position.x-=a.size.width/2,l.setAnchor(0,i*t-(i-a.size.height)),n.add(l),n.activeButtonBackground=new y.ImageElement(u).setColor(_.options.colors.orange).setAlpha(0).setAnchorRelative(.5,1).markAsNonInput(),n.hoverButtonBackground=new y.ImageElement(s).setColor(_.options.colors.lightOrange).setAnchorRelative(.5,1).markAsNonInput(),n.hoverButtonBackground.visible=!1,n.add(n.hoverButtonBackground),n.add(n.activeButtonBackground),n.updateButtonsState(),l.addComponent(new v.BasicButtonComponent(function(e){var t=l.worldToLocal(n._dummyVec.copy(e.worldPoint)),r=Math.floor(Math.abs(t.y)/i);n.onButtonInput(r)})),l.pointerSignals.move.add(function(e){var t=l.worldToLocal(n._dummyVec.copy(e.worldPoint)),r=Math.floor(Math.abs(t.y)/i);n.currentPage*n.showAmount+r<n.items.length&&(n.hoverButtonBackground.position.y=-r*n.padding,n.hoverButtonBackground.visible=!0)}),l.pointerSignals.out.add(function(){n.hoverButtonBackground.visible=!1}),n.text=new f.TextElement(o).setSize(n.fontSize).setPos(-150,15-a.size.height/2+1,0),n.text.setMode("pre"),n.text.setWidth(300),n.text.setLineHeight(i),n.text.noInput=!0,n.add(n.text),n.updateText(),n}return l(c,i.UIElement),s(c,[{key:"setPage",value:function(e){var t=this.currentPage;this.currentPage=e,this.currentPage=Math.min(Math.ceil(this.items.length/this.showAmount)-1,this.currentPage),this.currentPage=Math.max(0,this.currentPage),this.currentPage!=t&&this.startAnimation()}},{key:"turnPage",value:function(e){this.setPage(this.currentPage+e)}},{key:"startAnimation",value:function(){var e=this;this.tweenGroup.removeAll(),new h.default.Tween(this.text.position,this.tweenGroup).easing(h.default.Easing.Quintic.Out).to({x:-100},this.animationTime/2).start(),new h.default.Tween(this.text,this.tweenGroup).easing(h.default.Easing.Quintic.Out).to({alpha:0},this.animationTime/2).onComplete(function(){return e.endAnimation()}).start()}},{key:"endAnimation",value:function(){this.updateText(),this.updateButtonsState(),new h.default.Tween(this.text.position,this.tweenGroup).easing(h.default.Easing.Quintic.Out).to({x:-150},this.animationTime/2).start(),new h.default.Tween(this.text,this.tweenGroup).easing(h.default.Easing.Quintic.Out).to({alpha:1},this.animationTime/2).start()}},{key:"updateText",value:function(){for(var e="",t=0;t<this.showAmount;t++){var r=this.currentPage*this.showAmount+t;if(r>=this.items.length)break;e+=this.items[r]+"\n"}this.text.setText(e)}},{key:"updateButtonsState",value:function(){if(this.getCurrent){var e=this.getCurrent(),t=!1;this.activeButtonBackground.visible=!0;for(var r=0;r<this.showAmount;r++){var n=this.currentPage*this.showAmount+r;if(n<this.items.length&&this.items[n]===e){var i=-this.padding*r;0<this.activeButtonBackground.alpha?new h.default.Tween(this.activeButtonBackground.position,this.tweenGroup).easing(h.default.Easing.Quintic.Out).to({y:i},this.animationTime/2).start():this.activeButtonBackground.position.y=i,t=!0;break}}new h.default.Tween(this.activeButtonBackground,this.tweenGroup).easing(h.default.Easing.Quintic.Out).to({alpha:t?1:0},this.animationTime/2).start()}}},{key:"setCallbacks",value:function(e,t){return this.getCurrent=e,this.setCurrent=t,this.updateButtonsState(),this}},{key:"onButtonInput",value:function(e){if(this.getCurrent&&this.setCurrent){var t=e+this.currentPage*this.showAmount,r=this.items[t];t>=this.items.length||(this.allowToggle&&this.getCurrent()===r?(this.setCurrent(""),this.onSelect.dispatch("")):(this.setCurrent(r),this.onSelect.dispatch(r)),this.updateButtonsState())}}},{key:"onFrameEnter",value:function(){u(A(c.prototype),"onFrameEnter",this).call(this),this.tweenGroup.update()}}]),c}();r.PagedList=T},{"../../core/assets/asset-pack":634,"../../core/assets/font":638,"../../core/components/basic-button-component":642,"../../core/ui/button-element":677,"../../core/ui/image-element":678,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/ui/ui-element":685,"../../options":717,"@tweenjs/tween.js":1,signals:612,three:615}],770:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Paginator=void 0;e("three");var n=e("../../core/ui/ui-element"),l=e("../../core/ui/button-element"),c=e("../../core/ui/text-element"),d=e("../../core/ui/rect-element"),f=e("../../core/assets/font"),h=e("../../core/assets/asset-pack");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(){function u(e,t,r,n,i,o,a){var s;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),!(e instanceof h.TextureDef))throw"leftTexture: Texture expected";if(!(t instanceof h.TextureDef))throw"rightTexture: Texture expected";if(r=r||100,!(n instanceof f.Font))throw"font: Font expected";if(!o||"function"!=typeof o)throw"getCurrentPage: function expected";if(a&&"function"!=typeof a)throw"getTotalPages: function expected";return(s=p(this,m(u).call(this))).getCurrentPage=o,s.getTotalPages=a,s.callback=i,s.leftButton=new l.ButtonElement(e,function(){return s.onClick(-1)}).centerAnchor(),s.rightButton=new l.ButtonElement(t,function(){return s.onClick(1)}).centerAnchor(),s.leftButton.position.x-=r/2,s.rightButton.position.x+=r/2,s.add(s.leftButton),s.add(s.rightButton),s.underlay=new d.RectElement(120,100,1118481),s.underlay.noInput=!0,s.underlay.centerAnchor(),s.add(s.underlay),s.text=new c.TextElement(n).setAlign("center").setSize(80),s.text.relativeAnchorY=s.text.relativeAnchorX=!0,s.text.noInput=!0,s.updateText(),s.add(s.text),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(u,n.UIElement),function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(u,[{key:"onClick",value:function(e){this.callback&&this.callback(e),this.updateText()}},{key:"updateText",value:function(){var e=""+this.getCurrentPage();this.getTotalPages&&(e+="/"+this.getTotalPages()),this.text.setText(e)}}]),u}();r.Paginator=s},{"../../core/assets/asset-pack":634,"../../core/assets/font":638,"../../core/ui/button-element":677,"../../core/ui/rect-element":682,"../../core/ui/text-element":683,"../../core/ui/ui-element":685,three:615}]},{},[712]);